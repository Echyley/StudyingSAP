/*! For license information please see smarteditcontainer.js.LICENSE.txt */
(()=>{var e={80824:(e,t,i)=>{"use strict";var o=i(32709);var n=i(54526);var s=i(12549);var a=i(18681);var r=i(49437);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}(function(){function MerchandisingSmartEditContainerModule(e,t){var i=this;this.loadConfigManagerService=e;this.sharedDataService=t;this.loadConfigManagerService.loadAsObject().then((function(e){i.sharedDataService.set("merchandisingUrl",e.merchandisingUrl)}))}MerchandisingSmartEditContainerModule=__decorate([s.SeEntryModule("merchandisingsmarteditContainer"),o.NgModule({imports:[],declarations:[],entryComponents:[],providers:[{provide:n.HTTP_INTERCEPTORS,useClass:r.MerchandisingExperienceInterceptor,multi:true}]}),__metadata("design:paramtypes",[a.LoadConfigManagerService,s.ISharedDataService])],MerchandisingSmartEditContainerModule);return MerchandisingSmartEditContainerModule})()},49437:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(32709);var n=i(67564);var s=i(66791);var a=i(12549);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}var r=function(){function MerchandisingExperienceInterceptor(e){this.sharedDataService=e}e=MerchandisingExperienceInterceptor;MerchandisingExperienceInterceptor.prototype.intercept=function(t,i){if(e.MERCHCMSWEBSERVICES_PATH.test(t.url)){return n.from(this.sharedDataService.get("experience")).pipe(s.switchMap((function(e){if(e){if(t.url.indexOf(a.CONTEXT_SITE_ID)>-1){var o=t.params;if(o){o=o.delete("catalogId").delete("catalogVersion").delete("mask")}var n=t.clone({url:t.url.replace(a.CONTEXT_SITE_ID,e.catalogDescriptor.siteId),params:o});return i.handle(n)}}return i.handle(t)})))}else{return i.handle(t)}};var e;MerchandisingExperienceInterceptor.MERCHCMSWEBSERVICES_PATH=/\/merchandisingcmswebservices/;MerchandisingExperienceInterceptor=e=__decorate([o.Injectable(),__metadata("design:paramtypes",[a.ISharedDataService])],MerchandisingExperienceInterceptor);return MerchandisingExperienceInterceptor}();t.MerchandisingExperienceInterceptor=r},72372:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(32709);var n=i(9501);var s=i(38102);var a=i(30520);var r=i(98575);var l=i(12549);var d=i(22630);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}const p="cxPromotionActionData";window.__smartedit__.addDecoratorPayload("Component","PromotionsSmarteditPromotionComponent",{selector:"promotions-smartedit-promotion",template:`<div *ngIf="getSelectedTypeCode() === getPromotionCode()"><label for="promotion-selector-1" class="fd-form-label" translate="personalization.modal.commercecustomization.promotion.label"></label><se-select [id]="promotion-selector-1" class="fd-form__control" [placeholder]="'personalization.modal.commercecustomization.promotion.search.placeholder'" [fetchStrategy]="fetchStrategy" [(model)]="selectedPromotion" [onSelect]="promotionSelectedEvent" [searchEnabled]="true"></se-select></div>`});t.PromotionsSmarteditPromotionComponent=class PromotionsSmarteditPromotionComponent{constructor(e,t,i,o,n){this.personlizationPromotionExtensionInjector=e;this.translateService=t;this.experienceService=i;this.promotionssmarteditRestService=o;this.personalizationsmarteditMessageHandler=n;this.selectedPromotion=null;this.allPromotions=[];this.availablePromotions=[];this.fetchStrategy={fetchAll:()=>{this.availablePromotions=[];this.allPromotions.forEach((e=>{const t=this.buildAction(e);if(this.isActionInSelectDisabled(t,this.comparer)===undefined){this.availablePromotions.push(d.cloneDeep(e))}}));return Promise.resolve(this.availablePromotions)}};this.comparer=(e,t)=>e.type===t.type&&e.promotionId===t.promotionId;this.promotionSelectedEvent=e=>{const t=this.buildAction(e);this.addAction(t,this.comparer)};this.addAction=e.addAction;this.isActionInSelectDisabled=e.isActionInSelectDisabled;this.getSelectedTypeCode=e.getSelectedTypeCode}ngOnInit(){this.getAvailablePromotions()}getAvailablePromotions(){return __awaiter(this,void 0,void 0,(function*(){try{const e=yield this.getPromotions();this.allPromotions=e.promotions;this.allPromotions.forEach((e=>{e.id=e.code;e.label=e.code+"("+e.promotionGroup+")"}))}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingpromotions"))}}))}getPromotionCode(){return p}getPromotions(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getCatalogs();const t=yield this.promotionssmarteditRestService.getPromotions(e);return Promise.resolve(t)}))}getCatalogs(){return __awaiter(this,void 0,void 0,(function*(){const e=[];const t=yield this.experienceService.getCurrentExperience();e.push({catalog:t.catalogDescriptor.catalogId,catalogVersion:t.catalogDescriptor.catalogVersion});t.productCatalogVersions.forEach((t=>{e.push({catalog:t.catalog,catalogVersion:t.catalogVersion})}));return Promise.resolve(e)}))}buildAction(e){return{type:"cxPromotionActionData",promotionId:e.code}}};t.PromotionsSmarteditPromotionComponent=__decorate([o.Component({selector:"promotions-smartedit-promotion",template:`<div *ngIf="getSelectedTypeCode() === getPromotionCode()"><label for="promotion-selector-1" class="fd-form-label" translate="personalization.modal.commercecustomization.promotion.label"></label><se-select [id]="promotion-selector-1" class="fd-form__control" [placeholder]="'personalization.modal.commercecustomization.promotion.search.placeholder'" [fetchStrategy]="fetchStrategy" [(model)]="selectedPromotion" [onSelect]="promotionSelectedEvent" [searchEnabled]="true"></se-select></div>`}),__param(0,o.Inject(a.PERSONLIZATION_PROMOTION_EXTENSION_INJECTOR_TOKEN)),__metadata("design:paramtypes",[Object,s.TranslateService,l.IExperienceService,r.PromotionsSmarteditRestService,a.PersonalizationsmarteditMessageHandler])],t.PromotionsSmarteditPromotionComponent);t.PersonalizationPromotionsSmarteditContainer=class PersonalizationPromotionsSmarteditContainer{};t.PersonalizationPromotionsSmarteditContainer=__decorate([l.SeEntryModule("personalizationpromotionssmarteditContainer"),o.NgModule({imports:[l.TranslationModule.forChild(),l.SelectModule,r.PersonalizationPromotionsSmarteditCommonsModule,n.BrowserModule],declarations:[t.PromotionsSmarteditPromotionComponent],entryComponents:[t.PromotionsSmarteditPromotionComponent],providers:[{provide:a.PERSONLIZATION_PROMOTION_EXTENSION_TOKEN,useValue:{component:t.PromotionsSmarteditPromotionComponent}},l.moduleUtils.bootstrap(((e,t)=>{t.registerType({type:p,text:"personalization.modal.commercecustomization.action.type.promotion",confProperty:"personalizationsmartedit.commercecustomization.promotions.enabled",getName:t=>e.instant("personalization.modal.commercecustomization.promotion.display.name")+" - "+t.promotionId})}),[s.TranslateService,a.PersonalizationsmarteditCommerceCustomizationService])]})],t.PersonalizationPromotionsSmarteditContainer);t.PROMOTION_ACTION_TYPE=p},98575:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(30178);var n=i(32709);var s=i(9501);var a=i(30520);var r=i(12549);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}var l;t.PromotionsSmarteditRestService=l=class PromotionsSmarteditRestService{constructor(e,t){this.restServiceFactory=e;this.smarteditUtils=t}getPromotions(e){const t=this.restServiceFactory.get(l.AVAILABLE_PROMOTIONS);const i=[];e=e||[];e.forEach(((e,t)=>{this.smarteditUtils.pushToArrayIfValueExists(i,"catalog"+t,e.catalog);this.smarteditUtils.pushToArrayIfValueExists(i,"version"+t,e.catalogVersion)}));const o={params:{entry:i}};return t.save(o)}};t.PromotionsSmarteditRestService.AVAILABLE_PROMOTIONS="/personalizationwebservices/v1/query/cxpromotionsforcatalog";t.PromotionsSmarteditRestService=l=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.IRestServiceFactory,a.PersonalizationsmarteditUtils])],t.PromotionsSmarteditRestService);t.PersonalizationPromotionsSmarteditCommonsModule=class PersonalizationPromotionsSmarteditCommonsModule{};t.PersonalizationPromotionsSmarteditCommonsModule=__decorate([n.NgModule({imports:[o.CommonModule,s.BrowserModule],providers:[t.PromotionsSmarteditRestService]})],t.PersonalizationPromotionsSmarteditCommonsModule)},30520:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(30178);var n=i(32709);var s=i(19662);var a=i(47692);var r=i(78471);var l=i(22389);var d=i(12549);var p=i(72093);var m=i(38102);var g=i(51132);var u=i(67564);var h=i(22630);var _=i(66791);function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}function _interopNamespace(e){if(e&&e.__esModule)return e;var t=Object.create(null);if(e){Object.keys(e).forEach((function(i){if(i!=="default"){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,o.get?o:{enumerable:true,get:function(){return e[i]}})}}))}t["default"]=e;return Object.freeze(t)}var v=_interopDefaultLegacy(g);var f=_interopNamespace(h);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}const y={SHORT_DATE_FORMAT:"M/D/YY",MODEL_DATE_FORMAT:"YYYY-MM-DDTHH:mm:SSZ"};const S={ANGULAR_FORMAT:"short",MOMENT_FORMAT:"M/D/YY h:mm A",MOMENT_ISO:"YYYY-MM-DDTHH:mm:00ZZ",ISO:"yyyy-MM-ddTHH:mm:00Z"};t.PERSONALIZATION_MODEL_STATUS_CODES=void 0;(function(e){e["ENABLED"]="ENABLED";e["DISABLED"]="DISABLED";e["DELETED"]="DELETED"})(t.PERSONALIZATION_MODEL_STATUS_CODES||(t.PERSONALIZATION_MODEL_STATUS_CODES={}));const b={ALL:"ALL",ENABLED:"ENABLED",DISABLED:"DISABLED"};const E={0:{borderClass:"personalizationsmarteditComponentSelected0",listClass:"personalizationsmarteditComponentSelectedList0"},1:{borderClass:"personalizationsmarteditComponentSelected1",listClass:"personalizationsmarteditComponentSelectedList1"},2:{borderClass:"personalizationsmarteditComponentSelected2",listClass:"personalizationsmarteditComponentSelectedList2"},3:{borderClass:"personalizationsmarteditComponentSelected3",listClass:"personalizationsmarteditComponentSelectedList3"},4:{borderClass:"personalizationsmarteditComponentSelected4",listClass:"personalizationsmarteditComponentSelectedList4"},5:{borderClass:"personalizationsmarteditComponentSelected5",listClass:"personalizationsmarteditComponentSelectedList5"},6:{borderClass:"personalizationsmarteditComponentSelected6",listClass:"personalizationsmarteditComponentSelectedList6"},7:{borderClass:"personalizationsmarteditComponentSelected7",listClass:"personalizationsmarteditComponentSelectedList7"},8:{borderClass:"personalizationsmarteditComponentSelected8",listClass:"personalizationsmarteditComponentSelectedList8"},9:{borderClass:"personalizationsmarteditComponentSelected9",listClass:"personalizationsmarteditComponentSelectedList9"},10:{borderClass:"personalizationsmarteditComponentSelected10",listClass:"personalizationsmarteditComponentSelectedList10"},11:{borderClass:"personalizationsmarteditComponentSelected11",listClass:"personalizationsmarteditComponentSelectedList11"},12:{borderClass:"personalizationsmarteditComponentSelected12",listClass:"personalizationsmarteditComponentSelectedList12"},13:{borderClass:"personalizationsmarteditComponentSelected13",listClass:"personalizationsmarteditComponentSelectedList13"},14:{borderClass:"personalizationsmarteditComponentSelected14",listClass:"personalizationsmarteditComponentSelectedList14"}};const w="personalizationsmartedit.container.combinedview.toolbar";const A="personalizationsmartedit.container.pagecustomizations.toolbar";const R={OLD:"old",NEW:"new",DELETE:"delete",UPDATE:"update"};const N={ALL:"all",ONLY_THIS_PAGE:"onlythispage"};const L={ALL:"all",CURRENT:"current",PARENTS:"parents"};const B="CxCmsComponentContainer";const j="data-smartedit-container-source-id";const G={BASIC_INFO_TAB_NAME:"basicinfotab",BASIC_INFO_TAB_FORM_NAME:"form.basicinfotab",TARGET_GROUP_TAB_NAME:"targetgrptab",TARGET_GROUP_TAB_FORM_NAME:"form.targetgrptab"};const H={CONFIRM_OK:"confirmOk",CONFIRM_CANCEL:"confirmCancel",CONFIRM_NEXT:"confirmNext"};const W={CRITERIA_AND:"AND",CRITERIA_OR:"OR"};t.PersonalizationsmarteditDateUtils=class PersonalizationsmarteditDateUtils{constructor(e){this.translateService=e}formatDate(e,t){t=t||S.MOMENT_FORMAT;if(e){if(e.match&&e.match(/^(\d{4})\-(\d{2})\-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\+|\-)(\d{4})$/)){e=`${e.slice(0,-2)}:${e.slice(-2)}`}return v["default"](new Date(e)).format(t)}else{return""}}formatDateWithMessage(e,t){t=t||y.SHORT_DATE_FORMAT;if(e){return this.formatDate(e,t)}else{return this.translateService.instant("personalization.toolbar.pagecustomizations.nodatespecified")}}isDateInThePast(e){if(d.stringUtils.isBlank(e)){return false}else{return v["default"](e,S.MOMENT_FORMAT).isBefore()}}isDateValidOrEmpty(e){return d.stringUtils.isBlank(e)||this.isDateValid(e)}isDateValid(e){return v["default"](e,S.MOMENT_FORMAT).isValid()}isDateRangeValid(e,t){if(d.stringUtils.isBlank(e)||d.stringUtils.isBlank(t)){return true}else{return v["default"](new Date(e)).isSameOrBefore(v["default"](new Date(t)))}}isDateStrFormatValid(e,t){t=t||S.MOMENT_FORMAT;if(d.stringUtils.isBlank(e)){return false}else{return v["default"](e,t,true).isValid()}}};t.PersonalizationsmarteditDateUtils=__decorate([n.Injectable(),__metadata("design:paramtypes",[m.TranslateService])],t.PersonalizationsmarteditDateUtils);window.__smartedit__.addDecoratorPayload("Component","DatetimePickerRangeComponent",{selector:"datetime-picker-range",template:`<fd-layout-grid class="pe-datetime-range"><div [fdLayoutGridCol]="6" class="pe-datetime-range__from" [ngClass]="{ 'has-error': !isFromDateValid }"><label for="pe-start-date" fd-form-label class="perso__datetimepicker__label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.details.startdate' | translate }}</label><se-help><span translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.startdate.help"></span></se-help><fd-datetime-picker [allowNull]="true" id="pe-start-date" name="pe-dateFrom" [placeholder]="placeholderText | translate" [disabled]="!isEditable" [(ngModel)]="fdDateFrom" (ngModelChange)="dateFromOnChange(fdDateFrom)"></fd-datetime-picker><span *ngIf="!isFromDateValid" class="pe-datetime__error-msg pe-datetime__msg" translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.wrongdateformatfrom.description"></span></div><div [fdLayoutGridCol]="6" class="pe-datetime-range__to" [ngClass]="{ 'has-error': !isToDateValid, 'has-warning': isEndDateInThePast }"><label for="pe-end-date" fd-form-label class="perso__datetimepicker__label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddate' | translate }}</label><se-help><span translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddate.help"></span></se-help><fd-datetime-picker [allowNull]="true" id="pe-end-date" name="pe-dateTo" [placeholder]="placeholderText | translate" [disabled]="!isEditable" [(ngModel)]="fdDateTo" (ngModelChange)="dateToOnChange(fdDateTo)"></fd-datetime-picker><span *ngIf="!isToDateValid" class="pe-datetime__error-msg pe-datetime__msg" translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.wrongdateformatfrom.description"></span> <span *ngIf="isEndDateInThePast" class="help-block pe-datetime__warning-msg pe-datetime__msg"><span translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddateinthepast.description"></span></span></div></fd-layout-grid>`,changeDetection:n.ChangeDetectionStrategy.OnPush});t.DatetimePickerRangeComponent=class DatetimePickerRangeComponent{constructor(e,t){this.dateUtil=e;this.cdr=t;this.placeholderText="personalization.commons.datetimepicker.placeholder";this.dateFromChange=new n.EventEmitter;this.dateToChange=new n.EventEmitter;this.isFromDateValid=true;this.isToDateValid=true;this.isEndDateInThePast=false}ngAfterViewInit(){this._initDateTime()}dateFromOnChange(e){if(!!e){this.isFromDateValid=e.isDateValid();this.dateFrom=this.dateUtil.formatDate(e.toString(),undefined)}else{this.isFromDateValid=true;this.dateFrom=""}this.dateFromChange.emit(this.dateFrom)}dateToOnChange(e){if(!!e){this.isToDateValid=e.isDateValid();this.dateTo=this.dateUtil.formatDate(e.toString(),undefined)}else{this.isToDateValid=true;this.dateTo=""}this.isEndDateInThePast=this.dateUtil.isDateInThePast(this.dateTo);this.dateToChange.emit(this.dateTo)}_initDateTime(){if(!!this.dateFrom){this.fdDateFrom=p.FdDate.getFdDateByDate(new Date(this.dateFrom))}else{this.fdDateFrom=p.FdDate.getToday();this.dateFromOnChange(this.fdDateFrom)}if(!!this.dateTo){this.fdDateTo=p.FdDate.getFdDateByDate(new Date(this.dateTo))}else{this.fdDateTo=p.FdDate.getToday();this.dateToOnChange(this.fdDateTo)}this.cdr.detectChanges()}};__decorate([n.Input(),__metadata("design:type",String)],t.DatetimePickerRangeComponent.prototype,"dateFrom",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.DatetimePickerRangeComponent.prototype,"dateTo",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],t.DatetimePickerRangeComponent.prototype,"isEditable",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.DatetimePickerRangeComponent.prototype,"dateFromChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.DatetimePickerRangeComponent.prototype,"dateToChange",void 0);t.DatetimePickerRangeComponent=__decorate([n.Component({selector:"datetime-picker-range",template:`<fd-layout-grid class="pe-datetime-range"><div [fdLayoutGridCol]="6" class="pe-datetime-range__from" [ngClass]="{ 'has-error': !isFromDateValid }"><label for="pe-start-date" fd-form-label class="perso__datetimepicker__label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.details.startdate' | translate }}</label><se-help><span translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.startdate.help"></span></se-help><fd-datetime-picker [allowNull]="true" id="pe-start-date" name="pe-dateFrom" [placeholder]="placeholderText | translate" [disabled]="!isEditable" [(ngModel)]="fdDateFrom" (ngModelChange)="dateFromOnChange(fdDateFrom)"></fd-datetime-picker><span *ngIf="!isFromDateValid" class="pe-datetime__error-msg pe-datetime__msg" translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.wrongdateformatfrom.description"></span></div><div [fdLayoutGridCol]="6" class="pe-datetime-range__to" [ngClass]="{ 'has-error': !isToDateValid, 'has-warning': isEndDateInThePast }"><label for="pe-end-date" fd-form-label class="perso__datetimepicker__label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddate' | translate }}</label><se-help><span translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddate.help"></span></se-help><fd-datetime-picker [allowNull]="true" id="pe-end-date" name="pe-dateTo" [placeholder]="placeholderText | translate" [disabled]="!isEditable" [(ngModel)]="fdDateTo" (ngModelChange)="dateToOnChange(fdDateTo)"></fd-datetime-picker><span *ngIf="!isToDateValid" class="pe-datetime__error-msg pe-datetime__msg" translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.wrongdateformatfrom.description"></span> <span *ngIf="isEndDateInThePast" class="help-block pe-datetime__warning-msg pe-datetime__msg"><span translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddateinthepast.description"></span></span></div></fd-layout-grid>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[t.PersonalizationsmarteditDateUtils,n.ChangeDetectorRef])],t.DatetimePickerRangeComponent);t.DatetimePickerRangeModule=class DatetimePickerRangeModule{};t.DatetimePickerRangeModule=__decorate([n.NgModule({imports:[o.CommonModule,s.FormsModule,r.FormModule,d.SeTranslationModule.forChild(),d.HelpModule,a.DatetimePickerModule,l.LayoutGridModule],declarations:[t.DatetimePickerRangeComponent],entryComponents:[t.DatetimePickerRangeComponent],exports:[t.DatetimePickerRangeComponent]})],t.DatetimePickerRangeModule);t.PersonalizationInfiniteScrollDirective=class PersonalizationInfiniteScrollDirective{constructor(e){this.element=e;this.scrollPercent=75;this.onScrollAction=new n.EventEmitter}ngOnInit(){this.scrollEvent=u.fromEvent(this.element.nativeElement,"scroll");this.subscription=this.scrollEvent.subscribe((e=>{if((e.target.scrollTop+e.target.offsetHeight)/e.target.scrollHeight>this.scrollPercent/100){this.onScrollAction.emit(null)}}))}ngOnDestroy(){if(this.subscription){this.subscription.unsubscribe()}}};__decorate([n.Input(),__metadata("design:type",Object)],t.PersonalizationInfiniteScrollDirective.prototype,"scrollPercent",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.PersonalizationInfiniteScrollDirective.prototype,"onScrollAction",void 0);t.PersonalizationInfiniteScrollDirective=__decorate([n.Directive({selector:"[persoInfiniteScroll]"}),__param(0,n.Inject(n.ElementRef)),__metadata("design:paramtypes",[n.ElementRef])],t.PersonalizationInfiniteScrollDirective);window.__smartedit__.addDecoratorPayload("Component","PersonalizationsmarteditInfiniteScrollingComponent",{selector:"personalization-infinite-scrolling",template:`<div [ngClass]="dropDownContainerClass" persoInfiniteScroll (onScrollAction)="nextPage()" [scrollPercent]="distance" *ngIf="initiated"><div [ngClass]="dropDownClass"><ng-content></ng-content></div></div>`});t.PersonalizationsmarteditInfiniteScrollingComponent=class PersonalizationsmarteditInfiniteScrollingComponent{constructor(){this.distance=80;this.initiated=false}ngOnInit(){this.init()}ngOnChanges(){this.init()}nextPage(){this.fetchPage()}init(){const e=this.initiated;this.initiated=true;if(e){this.nextPage()}}};__decorate([n.Input(),__metadata("design:type",String)],t.PersonalizationsmarteditInfiniteScrollingComponent.prototype,"dropDownContainerClass",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.PersonalizationsmarteditInfiniteScrollingComponent.prototype,"dropDownClass",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.PersonalizationsmarteditInfiniteScrollingComponent.prototype,"distance",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.PersonalizationsmarteditInfiniteScrollingComponent.prototype,"fetchPage",void 0);t.PersonalizationsmarteditInfiniteScrollingComponent=__decorate([n.Component({selector:"personalization-infinite-scrolling",template:`<div [ngClass]="dropDownContainerClass" persoInfiniteScroll (onScrollAction)="nextPage()" [scrollPercent]="distance" *ngIf="initiated"><div [ngClass]="dropDownClass"><ng-content></ng-content></div></div>`})],t.PersonalizationsmarteditInfiniteScrollingComponent);window.__smartedit__.addDecoratorPayload("Component","PersonalizationPreventParentScrollComponent",{selector:"personalization-prevent-parent-scroll",template:`<div persoPreventParentScroll><ng-content></ng-content></div>`});t.PersonalizationPreventParentScrollComponent=class PersonalizationPreventParentScrollComponent{};t.PersonalizationPreventParentScrollComponent=__decorate([n.Component({selector:"personalization-prevent-parent-scroll",template:`<div persoPreventParentScroll><ng-content></ng-content></div>`})],t.PersonalizationPreventParentScrollComponent);t.PersonalizationPreventParentScrollDirective=class PersonalizationPreventParentScrollDirective{constructor(e){this.element=e;this.mouseWheelEventHandler=e=>this.onMouseWheel(e)}ngOnInit(){const e=this.element.nativeElement;e.addEventListener("mousewheel",this.mouseWheelEventHandler);e.addEventListener("DOMMouseScroll",this.mouseWheelEventHandler)}ngOnDestroy(){const e=this.element.nativeElement;e.removeEventListener("mousewheel",this.mouseWheelEventHandler);e.removeEventListener("DOMMouseScroll",this.mouseWheelEventHandler)}onMouseWheel(e){const t=this.element.nativeElement;const i=e.originalEvent&&(e.originalEvent.wheelDeltaY||e.originalEvent.wheelDelta);const o=-(e.deltaY||e.delta)||0;t.parentElement.parentElement.parentElement.scrollTop-=e.wheelDeltaY||i||e.wheelDelta||o;e.stopPropagation();e.preventDefault();e.returnValue=false}};t.PersonalizationPreventParentScrollDirective=__decorate([n.Directive({selector:"[persoPreventParentScroll]"}),__param(0,n.Inject(n.ElementRef)),__metadata("design:paramtypes",[n.ElementRef])],t.PersonalizationPreventParentScrollDirective);window.__smartedit__.addDecoratorPayload("Component","ScrollZoneComponent",{selector:"personalizationsmartedit-scroll-zone",template:`<ng-template #scrollZoneBody><personalizationsmartedit-scroll-zone-body-container><personalizationsmartedit-scroll-zone-body [hidden]="!scrollZoneTop" [isTransparent]="isTransparent" [additionalClasses]="['perso__scrollzone--top']" (scrollZoneBodyMouseenter)="onScrollTopMouseenter()" (scrollZoneBodyMouseleave)="stopScroll()"></personalizationsmartedit-scroll-zone-body><personalizationsmartedit-scroll-zone-body [hidden]="!scrollZoneBottom" [isTransparent]="isTransparent" [additionalClasses]="['perso__scrollzone--bottom']" (scrollZoneBodyMouseenter)="onScrollBottomMouseenter()" (scrollZoneBodyMouseleave)="stopScroll()"></personalizationsmartedit-scroll-zone-body></personalizationsmartedit-scroll-zone-body-container></ng-template>`});t.ScrollZoneComponent=class ScrollZoneComponent{constructor(e,t){this.viewContainerRef=e;this.document=t;this.scrollZoneTop=false;this.scrollZoneBottom=false;this.scrollZoneVisible=false;this.isTransparent=false}ngAfterViewInit(){if(this.scrollZoneVisible){this.createScrollZoneBody()}}ngOnChanges(e){const t=e.scrollZoneVisible;if(t&&!t.firstChange){if(t.currentValue){this.createScrollZoneBody()}else{this.destroyScrollZoneBody()}}}ngOnDestroy(){this.destroyScrollZoneBody()}onScrollTopMouseenter(){this.isScrolling=true;this.scrollTop()}onScrollBottomMouseenter(){this.isScrolling=true;this.scrollBottom()}stopScroll(){this.isScrolling=false;clearTimeout(this.scrollZoneTopTimeout);clearTimeout(this.scrollZoneBottomTimeout)}scrollTop(){if(!this.isScrolling){clearTimeout(this.scrollZoneTopTimeout);return}this.scrollZoneTop=this.elementToScroll.scrollTop()<=2?false:true;this.scrollZoneBottom=true;this.elementToScroll.scrollTop(this.elementToScroll.scrollTop()-15);this.scrollZoneTopTimeout=setTimeout((()=>{this.scrollTop()}),100)}scrollBottom(){if(!this.isScrolling){clearTimeout(this.scrollZoneBottomTimeout);return}this.scrollZoneTop=true;const e=this.elementToScroll.get(0).scrollHeight-this.elementToScroll.scrollTop();this.scrollZoneBottom=Math.abs(e-this.elementToScroll.outerHeight())<2?false:true;this.elementToScroll.scrollTop(this.elementToScroll.scrollTop()+15);this.scrollZoneBottomTimeout=setTimeout((()=>{this.scrollBottom()}),100)}createScrollZoneBody(){if(this.viewRef){return}this.viewRef=this.viewContainerRef.createEmbeddedView(this.scrollZoneBody);const e=this.viewRef.rootNodes[0];this.document.body.appendChild(e);this.scrollZoneTop=true;this.scrollZoneBottom=true}destroyScrollZoneBody(){if(!this.viewRef){return}this.viewRef.destroy();this.viewRef=null}};__decorate([n.Input(),__metadata("design:type",Boolean)],t.ScrollZoneComponent.prototype,"scrollZoneVisible",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],t.ScrollZoneComponent.prototype,"isTransparent",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.ScrollZoneComponent.prototype,"elementToScroll",void 0);__decorate([n.ViewChild("scrollZoneBody",{static:true}),__metadata("design:type",n.TemplateRef)],t.ScrollZoneComponent.prototype,"scrollZoneBody",void 0);t.ScrollZoneComponent=__decorate([n.Component({selector:"personalizationsmartedit-scroll-zone",template:`<ng-template #scrollZoneBody><personalizationsmartedit-scroll-zone-body-container><personalizationsmartedit-scroll-zone-body [hidden]="!scrollZoneTop" [isTransparent]="isTransparent" [additionalClasses]="['perso__scrollzone--top']" (scrollZoneBodyMouseenter)="onScrollTopMouseenter()" (scrollZoneBodyMouseleave)="stopScroll()"></personalizationsmartedit-scroll-zone-body><personalizationsmartedit-scroll-zone-body [hidden]="!scrollZoneBottom" [isTransparent]="isTransparent" [additionalClasses]="['perso__scrollzone--bottom']" (scrollZoneBodyMouseenter)="onScrollBottomMouseenter()" (scrollZoneBodyMouseleave)="stopScroll()"></personalizationsmartedit-scroll-zone-body></personalizationsmartedit-scroll-zone-body-container></ng-template>`}),__param(1,n.Inject(o.DOCUMENT)),__metadata("design:paramtypes",[n.ViewContainerRef,Document])],t.ScrollZoneComponent);window.__smartedit__.addDecoratorPayload("Component","ScrollZoneBodyComponent",{selector:"personalizationsmartedit-scroll-zone-body",template:`<div class="perso__scrollzone" [ngClass]="cssClasses" (mouseenter)="onMouseenter()" (mouseleave)="onMouseleave()"></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let $=class ScrollZoneBodyComponent{constructor(){this.additionalClasses=[];this.isTransparent=false;this.scrollZoneBodyMouseenter=new n.EventEmitter;this.scrollZoneBodyMouseleave=new n.EventEmitter;this.cssClasses=[]}ngOnChanges(){this.cssClasses=this.getCssClasses(this.isTransparent,this.additionalClasses||[])}onMouseenter(){this.scrollZoneBodyMouseenter.emit()}onMouseleave(){this.scrollZoneBodyMouseleave.emit()}getCssClasses(e,t){const i=e?"perso__scrollzone--transparent":"perso__scrollzone--normal";return[i,...t]}};__decorate([n.Input(),__metadata("design:type",Array)],$.prototype,"additionalClasses",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],$.prototype,"isTransparent",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],$.prototype,"scrollZoneBodyMouseenter",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],$.prototype,"scrollZoneBodyMouseleave",void 0);$=__decorate([n.Component({selector:"personalizationsmartedit-scroll-zone-body",template:`<div class="perso__scrollzone" [ngClass]="cssClasses" (mouseenter)="onMouseenter()" (mouseleave)="onMouseleave()"></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[])],$);window.__smartedit__.addDecoratorPayload("Component","ScrollZoneBodyContainerComponent",{selector:"personalizationsmartedit-scroll-zone-body-container",template:`<ng-content></ng-content>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let K=class ScrollZoneBodyContainerComponent{};K=__decorate([n.Component({selector:"personalizationsmartedit-scroll-zone-body-container",template:`<ng-content></ng-content>`,changeDetection:n.ChangeDetectionStrategy.OnPush})],K);t.ScrollZoneModule=class ScrollZoneModule{};t.ScrollZoneModule=__decorate([n.NgModule({imports:[o.CommonModule,d.TranslationModule.forChild()],providers:[],declarations:[t.ScrollZoneComponent,K,$],entryComponents:[t.ScrollZoneComponent],exports:[$,t.ScrollZoneComponent]})],t.ScrollZoneModule);class IPersonalizationsmarteditContextMenuServiceProxy{openDeleteAction(e){"proxyFunction";return undefined}openAddAction(e){"proxyFunction";return undefined}openEditAction(e){"proxyFunction";return undefined}openEditComponentAction(e){"proxyFunction";return undefined}}class IPersonalizationsmarteditContextServiceProxy{setPersonalization(e){"proxyFunction";return undefined}setCustomize(e){"proxyFunction";return undefined}setCombinedView(e){"proxyFunction";return undefined}setSeData(e){"proxyFunction";return undefined}}class PaginationHelper{constructor(e={}){this.count=e.count||0;this.page=e.page||0;this.totalCount=e.totalCount||0;this.totalPages=e.totalPages||0}reset(){this.count=50;this.page=-1;this.totalPages=1;this.totalCount=0}getCount(){return this.count}getPage(){return this.page}getTotalCount(){return this.totalCount}getTotalPages(){return this.totalPages}isLastPage(){return this.getPage()===this.getTotalPages()}}class PersonalizationsmarteditCommerceCustomizationService{constructor(){this.nonCommerceActionTypes=["cxCmsActionData"];this.types=[]}isNonCommerceAction(e){return this.nonCommerceActionTypes.some((t=>t===e.type))}isCommerceAction(e){return!this.isNonCommerceAction(e)}isTypeEnabled(e,t){return t!==undefined&&t!==null&&t[e.confProperty]===true}registerType(e){const t=e.type;let i=false;this.types.forEach((e=>{if(e.type===t){i=true}}));if(!i){this.types.push(e)}}getAvailableTypes(e){return this.types.filter((t=>this.isTypeEnabled(t,e)))}isCommerceCustomizationEnabled(e){const t=this.getAvailableTypes(e);return t.length>0}getNonCommerceActionsCount(e){return(e.actions||[]).filter(this.isNonCommerceAction,this).length}getCommerceActionsCountMap(e){const t={};(e.actions||[]).filter(this.isCommerceAction,this).forEach((e=>{const i=e.type.toLowerCase();let o=t[i];if(o===undefined){o=1}else{o+=1}t[i]=o}));return t}getCommerceActionsCount(e){return(e.actions||[]).filter(this.isCommerceAction,this).length}}t.PersonalizationsmarteditMessageHandler=class PersonalizationsmarteditMessageHandler{constructor(e){this.alertService=e}sendInformation(e){this.alertService.showInfo(e)}sendError(e){this.alertService.showDanger(e)}sendWarning(e){this.alertService.showWarning(e)}sendSuccess(e){this.alertService.showSuccess(e)}};t.PersonalizationsmarteditMessageHandler=__decorate([n.Injectable(),__metadata("design:paramtypes",[d.IAlertService])],t.PersonalizationsmarteditMessageHandler);t.PersonalizationsmarteditUtils=class PersonalizationsmarteditUtils{constructor(e,t,i){this.translateService=e;this.l10nPipe=t;this.catalogService=i}pushToArrayIfValueExists(e,t,i){if(i){e.push({key:t,value:i})}}getVariationCodes(e){if(typeof e===undefined||e===null){return[]}const t=e.map((e=>e.code)).filter((e=>typeof e!=="undefined"));return t}getVariationKey(e,t){if(e===undefined||t===undefined){return[]}const i=t.map((t=>({variationCode:t.code,customizationCode:e,catalog:t.catalog,catalogVersion:t.catalogVersion})));return i}getSegmentTriggerForVariation(e){const t=e.triggers||[];const i=t.filter((e=>e.type==="segmentTriggerData"));if(i.length===0){return{}}return i[0]}isPersonalizationItemEnabled(e){return e.status===t.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED}getEnablementTextForCustomization(e,t){t=t||"personalization";if(this.isPersonalizationItemEnabled(e)){return this.translateService.instant(t+".customization.enabled")}else{return this.translateService.instant(t+".customization.disabled")}}getEnablementTextForVariation(e,t){t=t||"personalization";if(this.isPersonalizationItemEnabled(e)){return this.translateService.instant(t+".variation.enabled")}else{return this.translateService.instant(t+".variation.disabled")}}getEnablementActionTextForVariation(e,t){t=t||"personalization";if(this.isPersonalizationItemEnabled(e)){return this.translateService.instant(t+".variation.options.disable")}else{return this.translateService.instant(t+".variation.options.enable")}}getActivityStateForCustomization(e){if(e.status===t.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED){const t=new Date(e.enabledStartDate);const i=new Date(e.enabledEndDate);const o=v["default"](t).isValid();const n=v["default"](i).isValid();if(!o&&!n||o&&!n&&v["default"]().isAfter(t,"minute")||!o&&n&&v["default"]().isBefore(i,"minute")||v["default"]().isBetween(t,i,"minute","[]")){return"perso__status--enabled"}else{return"perso__status--ignore"}}else{return"perso__status--disabled"}}getActivityStateForVariation(e,t){if(t.enabled){return this.getActivityStateForCustomization(e)}else{return"perso__status--disabled"}}isItemVisible(e){return e.status!==t.PERSONALIZATION_MODEL_STATUS_CODES.DELETED}getVisibleItems(e){return e.filter((e=>this.isItemVisible(e)))}getValidRank(e,t,i){const o=e.indexOf(t);const n=i<0?-1:1;let s=o+i;while(s>=0&&s<e.length&&!this.isItemVisible(e[s])){s+=n}s=s>=e.length?e.length-1:s;s=s<0?0:s;return e[s].rank}getStatusesMapping(){const e=[];e.push({code:b.ALL,text:"personalization.context.status.all",modelStatuses:[t.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED,t.PERSONALIZATION_MODEL_STATUS_CODES.DISABLED]});e.push({code:b.ENABLED,text:"personalization.context.status.enabled",modelStatuses:[t.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED]});e.push({code:b.DISABLED,text:"personalization.context.status.disabled",modelStatuses:[t.PERSONALIZATION_MODEL_STATUS_CODES.DISABLED]});return e}getClassForElement(e){const t=e%Object.keys(E).length;return E[t].listClass}getLetterForElement(e){const t=e%Object.keys(E).length;return String.fromCharCode("a".charCodeAt(0)+t).toUpperCase()}getCommerceCustomizationTooltip(e,t,i){t=t||"";i=i||"\n";let o="";f.forEach(e.commerceCustomizations,((e,n)=>{o+=t+this.translateService.instant("personalization.modal.manager.commercecustomization."+n)+": "+e+i}));return o}getCommerceCustomizationTooltipHTML(e){return this.getCommerceCustomizationTooltip(e,"<div>","</div>")}isItemFromCurrentCatalog(e,t){const i=t.seExperienceData.catalogDescriptor;return e.catalog===i.catalogId&&e.catalogVersion===i.catalogVersion}hasCommerceActions(e){return e.numberOfCommerceActions>0}getCatalogVersionNameByUuid(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.catalogService.getCatalogVersionByUuid(e);let i=yield this.l10nPipe.transform(t.catalogName).pipe(_.take(1)).toPromise();i=i+" ("+t.version+")";return i}))}getAndSetCatalogVersionNameL10N(e){return __awaiter(this,void 0,void 0,(function*(){e.catalogVersionNameL10N=yield this.getCatalogVersionNameByUuid(e.catalog+"/"+e.catalogVersion)}))}uniqueArray(e,t,i){i=i||"code";t.forEach((t=>{if(!e.some((e=>e[i]===t[i]))){e.push(t)}}));return e}};t.PersonalizationsmarteditUtils=__decorate([n.Injectable(),__metadata("design:paramtypes",[m.TranslateService,d.L10nPipe,d.ICatalogService])],t.PersonalizationsmarteditUtils);class Customize{constructor(){this.enabled=false;this.selectedCustomization=null;this.selectedVariations=null;this.selectedComponents=null}}class CombinedView{constructor(){this.enabled=false;this.selectedItems=null;this.customize=new Customize}}class Personalization{constructor(){this.enabled=false}}class SeData{constructor(){this.pageId=null;this.seExperienceData=null;this.seConfigurationData=null}}t.PersonalizationsmarteditContextUtils=class PersonalizationsmarteditContextUtils{getContextObject(){return{personalization:new Personalization,customize:new Customize,combinedView:new CombinedView,seData:new SeData}}clearCustomizeContext(e){const t=e.getCustomize();t.enabled=false;t.selectedCustomization=null;t.selectedVariations=null;t.selectedComponents=null;e.setCustomize(t)}clearCustomizeContextAndReloadPreview(e,t){const i=h.cloneDeep(t.getCustomize().selectedVariations);this.clearCustomizeContext(t);if(h.isObject(i)&&!h.isArray(i)){e.removePersonalizationDataFromPreview()}}clearCombinedViewCustomizeContext(e){const t=e.getCombinedView();t.customize.enabled=false;t.customize.selectedCustomization=null;t.customize.selectedVariations=null;t.customize.selectedComponents=null;if(h.isArray(t.selectedItems)){t.selectedItems.forEach((e=>{delete e.highlighted}))}e.setCombinedView(t)}clearCombinedViewContext(e){const t=e.getCombinedView();t.enabled=false;t.selectedItems=null;e.setCombinedView(t)}clearCombinedViewContextAndReloadPreview(e,t){const i=h.cloneDeep(t.getCombinedView().enabled);const o=h.cloneDeep(t.getCombinedView().selectedItems);this.clearCombinedViewContext(t);if(i&&o){e.removePersonalizationDataFromPreview()}}};t.PersonalizationsmarteditContextUtils=__decorate([n.Injectable()],t.PersonalizationsmarteditContextUtils);t.PersonalizationsmarteditCommonsComponentsModule=class PersonalizationsmarteditCommonsComponentsModule{};t.PersonalizationsmarteditCommonsComponentsModule=__decorate([n.NgModule({imports:[d.TranslationModule.forChild(),o.CommonModule,d.L10nPipeModule,t.DatetimePickerRangeModule,t.ScrollZoneModule],providers:[{provide:"PaginationHelper",useFactory:()=>e=>new PaginationHelper(e)},d.L10nPipe,t.PersonalizationsmarteditUtils,t.PersonalizationsmarteditDateUtils,t.PersonalizationsmarteditContextUtils,t.PersonalizationsmarteditMessageHandler,PersonalizationsmarteditCommerceCustomizationService],declarations:[t.PersonalizationInfiniteScrollDirective,t.PersonalizationPreventParentScrollDirective,t.PersonalizationsmarteditInfiniteScrollingComponent,t.PersonalizationPreventParentScrollComponent],entryComponents:[t.PersonalizationsmarteditInfiniteScrollingComponent,t.PersonalizationPreventParentScrollComponent],exports:[t.PersonalizationInfiniteScrollDirective,t.PersonalizationPreventParentScrollDirective,t.PersonalizationsmarteditInfiniteScrollingComponent,t.PersonalizationPreventParentScrollComponent]})],t.PersonalizationsmarteditCommonsComponentsModule);var Y;t.BaseSiteHeaderInterceptor=Y=class BaseSiteHeaderInterceptor{constructor(e){this.sharedDataService=e}intercept(e,t){if(Y.PERSONALIZATION_ENDPOINT.test(e.url)){return u.from(this.sharedDataService.get("experience")).pipe(_.switchMap((i=>{if(i.catalogDescriptor.siteId){const o=e.clone({headers:e.headers.set(Y.HEADER_NAME,i.catalogDescriptor.siteId)});return t.handle(o)}return t.handle(e)})))}else{return t.handle(e)}}};t.BaseSiteHeaderInterceptor.HEADER_NAME="Basesite";t.BaseSiteHeaderInterceptor.PERSONALIZATION_ENDPOINT=/\/personalizationwebservices/;t.BaseSiteHeaderInterceptor=Y=__decorate([n.Injectable(),__metadata("design:paramtypes",[d.ISharedDataService])],t.BaseSiteHeaderInterceptor);t.TriggerActionId=void 0;(function(e){e["AND"]="AND";e["OR"]="OR";e["NOT"]="NOT"})(t.TriggerActionId||(t.TriggerActionId={}));t.TriggerType=void 0;(function(e){e["DEFAULT_TRIGGER"]="defaultTriggerData";e["SEGMENT_TRIGGER"]="segmentTriggerData";e["EXPRESSION_TRIGGER"]="expressionTriggerData";e["GROUP_EXPRESSION"]="groupExpressionData";e["SEGMENT_EXPRESSION"]="segmentExpressionData";e["NEGATION_EXPRESSION"]="negationExpressionData";e["CONTAINER_TYPE"]="container";e["ITEM_TYPE"]="item";e["DROPZONE_TYPE"]="dropzone"})(t.TriggerType||(t.TriggerType={}));const Z=new n.InjectionToken("PERSONLIZATION_SEARCH_EXTENSION_TOKEN");const Q=new n.InjectionToken("PERSONLIZATION_SEARCH_EXTENSION_INJECTOR_TOKEN");const J=new n.InjectionToken("PERSONLIZATION_PROMOTION_EXTENSION_TOKEN");const ee=new n.InjectionToken("PERSONLIZATION_PROMOTION_EXTENSION_INJECTOR_TOKEN");t.COMBINED_VIEW_TOOLBAR_ITEM_KEY=w;t.COMPONENT_CONTAINER_TYPE=B;t.CONTAINER_SOURCE_ID_ATTR=j;t.CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS=H;t.CUSTOMIZATION_VARIATION_MANAGEMENT_SEGMENTTRIGGER_GROUPBY=W;t.CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS=G;t.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY=A;t.CombinedView=CombinedView;t.Customize=Customize;t.DATE_CONSTANTS=S;t.IPersonalizationsmarteditContextMenuServiceProxy=IPersonalizationsmarteditContextMenuServiceProxy;t.IPersonalizationsmarteditContextServiceProxy=IPersonalizationsmarteditContextServiceProxy;t.PERSONALIZATION_CATALOG_FILTER=L;t.PERSONALIZATION_COMBINED_VIEW_CSS_MAPPING=E;t.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES=R;t.PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER=N;t.PERSONALIZATION_DATE_FORMATS=y;t.PERSONALIZATION_VIEW_STATUS_MAPPING_CODES=b;t.PERSONLIZATION_PROMOTION_EXTENSION_INJECTOR_TOKEN=ee;t.PERSONLIZATION_PROMOTION_EXTENSION_TOKEN=J;t.PERSONLIZATION_SEARCH_EXTENSION_INJECTOR_TOKEN=Q;t.PERSONLIZATION_SEARCH_EXTENSION_TOKEN=Z;t.PaginationHelper=PaginationHelper;t.Personalization=Personalization;t.PersonalizationsmarteditCommerceCustomizationService=PersonalizationsmarteditCommerceCustomizationService;t.SeData=SeData},41187:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(54526);var n=i(32709);var s=i(9501);var a=i(99662);var r=i(22630);var l=i(30520);var d=i(12549);var p=i(18681);var m=i(30178);var g=i(38102);var u=i(67564);var h=i(25103);var _=i(66791);var v=i(78471);var f=i(95442);var y=i(19662);var S=i(38158);var b=i(7144);var E=i(72093);var w=i(67827);var A=i(94312);var R=i(50283);function _interopNamespace(e){if(e&&e.__esModule)return e;var t=Object.create(null);if(e){Object.keys(e).forEach((function(i){if(i!=="default"){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,o.get?o:{enumerable:true,get:function(){return e[i]}})}}))}t["default"]=e;return Object.freeze(t)}var N=_interopNamespace(r);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}t.PersonalizationsmarteditContextService=class PersonalizationsmarteditContextService{constructor(e,t,i,o){this.sharedDataService=e;this.loadConfigManagerService=t;this.personalizationsmarteditContextServiceProxy=i;this.personalizationsmarteditContextUtils=o;const n=o.getContextObject();this.setPersonalization(n.personalization);this.setCustomize(n.customize);this.setCombinedView(n.combinedView);this.setSeData(n.seData);this.customizeFiltersState={}}getPersonalization(){return this.personalization}setPersonalization(e){this.personalization=e;this.personalizationsmarteditContextServiceProxy.setPersonalization(e)}getCustomize(){return this.customize}setCustomize(e){this.customize=e;this.personalizationsmarteditContextServiceProxy.setCustomize(e);window.sessionStorage.setItem("Customize",JSON.stringify(e))}getCombinedView(){return this.combinedView}setCombinedView(e){this.combinedView=e;this.personalizationsmarteditContextServiceProxy.setCombinedView(e);window.sessionStorage.setItem("CombinedView",JSON.stringify(e))}getSeData(){return this.seData}setSeData(e){this.seData=e;this.personalizationsmarteditContextServiceProxy.setSeData(e)}refreshExperienceData(){return this.sharedDataService.get("experience").then((e=>{const t=this.getSeData();t.seExperienceData=e;t.pageId=e.pageId;this.setSeData(t);return Promise.resolve("ok")}))}refreshConfigurationData(){this.loadConfigManagerService.loadAsObject().then((e=>{const t=this.getSeData();t.seConfigurationData=e;this.setSeData(t)}))}applySynchronization(){this.personalizationsmarteditContextServiceProxy.setPersonalization(this.personalization);this.personalizationsmarteditContextServiceProxy.setCustomize(this.customize);this.personalizationsmarteditContextServiceProxy.setCombinedView(this.combinedView);this.personalizationsmarteditContextServiceProxy.setSeData(this.seData);this.refreshExperienceData();this.refreshConfigurationData()}getContexServiceProxy(){return this.personalizationsmarteditContextServiceProxy}getCustomizeFiltersState(){return this.customizeFiltersState}setCustomizeFiltersState(e){this.customizeFiltersState=e}};t.PersonalizationsmarteditContextService=__decorate([n.Injectable(),__metadata("design:paramtypes",[d.ISharedDataService,p.LoadConfigManagerService,l.IPersonalizationsmarteditContextServiceProxy,l.PersonalizationsmarteditContextUtils])],t.PersonalizationsmarteditContextService);var L;t.PersonalizationsmarteditContextServiceReverseProxy=L=class PersonalizationsmarteditContextServiceReverseProxy{constructor(e,t,i){this.personalizationsmarteditContextService=e;this.workflowService=t;this.pageInfoService=i}applySynchronization(){this.personalizationsmarteditContextService.applySynchronization()}isCurrentPageActiveWorkflowRunning(){return this.pageInfoService.getPageUUID().then((e=>this.workflowService.getActiveWorkflowForPageUuid(e).then((e=>{if(e==null){return false}return e.status===L.WORKFLOW_RUNNING_STATUS}))))}};t.PersonalizationsmarteditContextServiceReverseProxy.WORKFLOW_RUNNING_STATUS="RUNNING";t.PersonalizationsmarteditContextServiceReverseProxy=L=__decorate([d.GatewayProxied("applySynchronization","isCurrentPageActiveWorkflowRunning"),n.Injectable(),__metadata("design:paramtypes",[t.PersonalizationsmarteditContextService,d.WorkflowService,d.IPageInfoService])],t.PersonalizationsmarteditContextServiceReverseProxy);t.PersonalizationsmarteditPreviewService=class PersonalizationsmarteditPreviewService{constructor(e){this.experienceService=e}removePersonalizationDataFromPreview(){return this.updatePreviewTicketWithVariations([])}updatePreviewTicketWithVariations(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.experienceService.getCurrentExperience();if(!t){return undefined}if(JSON.stringify(t.variations)===JSON.stringify(e)){return undefined}t.variations=e;yield this.experienceService.setCurrentExperience(t);return this.experienceService.updateExperience()}))}};t.PersonalizationsmarteditPreviewService=__decorate([n.Injectable(),__metadata("design:paramtypes",[d.IExperienceService])],t.PersonalizationsmarteditPreviewService);t.PersonalizationsmarteditContextServiceProxy=class PersonalizationsmarteditContextServiceProxy extends l.IPersonalizationsmarteditContextServiceProxy{constructor(){super()}};t.PersonalizationsmarteditContextServiceProxy=__decorate([d.GatewayProxied("setPersonalization","setCustomize","setCombinedView","setSeData"),n.Injectable(),__metadata("design:paramtypes",[])],t.PersonalizationsmarteditContextServiceProxy);var B;t.PersonalizationsmarteditRestService=B=class PersonalizationsmarteditRestService{constructor(e,t,i,n,s){this.restServiceFactory=e;this.personalizationsmarteditUtils=t;this.httpClient=i;this.yjQuery=n;this.personalizationsmarteditContextService=s;this.actionHeaders=new o.HttpHeaders({"Content-Type":"application/json;charset=utf-8"})}extendRequestParamObjWithCatalogAwarePathVariables(e,t){t=t||{};const i=this.personalizationsmarteditContextService.getSeData().seExperienceData;const o={catalogId:t.catalog||i.catalogDescriptor.catalogId,catalogVersion:t.catalogVersion||i.catalogDescriptor.catalogVersion};e=N.assign(e,o);return e}extendRequestParamObjWithCustomizatonCode(e,t){const i={customizationCode:t};e=N.assign(e,i);return e}extendRequestParamObjWithVariationCode(e,t){const i={variationCode:t};e=N.assign(e,i);return e}getParamsAction(e,t,i,o,n,s){const a=[];this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"oldComponentId",e);this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"newComponentId",t);this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"slotId",i);this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"containerId",o);this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"variationId",s);this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"customizationId",n);return{params:{entry:a}}}getPathVariablesObjForModifyingActionURI(e,t,i,o){const n=this.personalizationsmarteditContextService.getSeData().seExperienceData;o=o||{};return{customizationCode:e,variationCode:t,actionId:i,catalogId:o.catalog||n.catalogDescriptor.catalogId,catalogVersion:o.catalogVersion||n.catalogDescriptor.catalogVersion}}prepareURI(e,t){return e.replace(/((?:\:)(\w*)(?:\/))/g,((e,i,o)=>t[o]+"/"))}getParamsForCustomizations(e){return{code:e.code,pageId:e.pageId,pageCatalogId:e.pageCatalogId,name:e.name,negatePageId:e.negatePageId,catalogs:e.catalogs,statuses:N.isUndefined(e.statuses)?undefined:e.statuses.join(",")}}getActionsDetails(e){const t=this.restServiceFactory.get(B.ACTIONS_DETAILS);e=this.extendRequestParamObjWithCatalogAwarePathVariables(e);return t.get(e)}getCustomizations(e){e=e||{};let t={};const i=this.restServiceFactory.get(B.CUSTOMIZATIONS);t=this.extendRequestParamObjWithCatalogAwarePathVariables(t,e);t.pageSize=e.currentSize||10;t.currentPage=e.currentPage||0;this.yjQuery.extend(t,this.getParamsForCustomizations(e));return i.get(t)}getComponentsIdsForVariation(e,t,i,o){const n=this.personalizationsmarteditContextService.getSeData().seExperienceData;const s=this.restServiceFactory.get(B.CXCMSC_ACTIONS_FROM_VARIATIONS);const a=[];this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"customization",e);this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"variations",t);this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"catalog",i||n.catalogDescriptor.catalogId);this.personalizationsmarteditUtils.pushToArrayIfValueExists(a,"catalogVersion",o||n.catalogDescriptor.catalogVersion);const r={params:{entry:a}};return s.save(r)}getCxCmsActionsOnPageForCustomization(e,t){const i={type:"CXCMSACTION",catalogs:"ALL",fields:"FULL",pageId:this.personalizationsmarteditContextService.getSeData().pageId,pageCatalogId:this.personalizationsmarteditContextService.getSeData().seExperienceData.pageContext.catalogId,customizationCode:e.code||"",currentPage:t||0};return this.getActionsDetails(i)}getSegments(e){const t=this.restServiceFactory.get(B.SEGMENTS);return t.get(e)}getCustomization(e){const t=this.restServiceFactory.get(B.CUSTOMIZATION,"customizationCode");let i=this.extendRequestParamObjWithCustomizatonCode({},e.code);i=this.extendRequestParamObjWithCatalogAwarePathVariables(i,e);return t.get(i)}createCustomization(e){const t=this.restServiceFactory.get(B.CUSTOMIZATION_PACKAGES);return t.save(this.extendRequestParamObjWithCatalogAwarePathVariables(e))}updateCustomization(e){const t=this.restServiceFactory.get(B.CUSTOMIZATION,"customizationCode");e.customizationCode=e.code;return t.update(this.extendRequestParamObjWithCatalogAwarePathVariables(e))}updateCustomizationPackage(e){const t=this.restServiceFactory.get(B.CUSTOMIZATION_PACKAGE,"customizationCode");e.customizationCode=e.code;return t.update(this.extendRequestParamObjWithCatalogAwarePathVariables(e))}deleteCustomization(e){const t=this.restServiceFactory.get(B.CUSTOMIZATION,"customizationCode");const i={customizationCode:e};return t.remove(this.extendRequestParamObjWithCatalogAwarePathVariables(i))}getVariation(e,t){const i=this.restServiceFactory.get(B.VARIATION,"variationCode");let o=this.extendRequestParamObjWithVariationCode({},t);o=this.extendRequestParamObjWithCatalogAwarePathVariables(o);o=this.extendRequestParamObjWithCustomizatonCode(o,e);return i.get(o)}editVariation(e,t){const i=this.restServiceFactory.get(B.VARIATION,"variationCode");t=this.extendRequestParamObjWithCatalogAwarePathVariables(t);t=this.extendRequestParamObjWithCustomizatonCode(t,e);t.variationCode=t.code;return i.update(t)}deleteVariation(e,t){const i=this.restServiceFactory.get(B.VARIATION,"variationCode");let o=this.extendRequestParamObjWithVariationCode({},t);o=this.extendRequestParamObjWithCatalogAwarePathVariables(o);o=this.extendRequestParamObjWithCustomizatonCode(o,e);return i.remove(o)}createVariationForCustomization(e,t){const i=this.restServiceFactory.get(B.VARIATIONS);t=this.extendRequestParamObjWithCatalogAwarePathVariables(t);t=this.extendRequestParamObjWithCustomizatonCode(t,e);return i.save(t)}getVariationsForCustomization(e,t){const i=this.restServiceFactory.get(B.VARIATIONS);let o={};const n=t||{};o=this.extendRequestParamObjWithCatalogAwarePathVariables(o,n);o=this.extendRequestParamObjWithCustomizatonCode(o,e);o.fields=B.VARIATION_FOR_CUSTOMIZATION_DEFAULT_FIELDS;const s=typeof n.includeFullFields==="undefined"?false:n.includeFullFields;if(s){o.fields=B.FULL_FIELDS}return i.get(o)}replaceComponentWithContainer(e,t,i){const o=this.restServiceFactory.get(B.ADD_CONTAINER);const n=this.extendRequestParamObjWithCatalogAwarePathVariables({},i);const s=this.getParamsAction(e,null,t,null,null,null);this.personalizationsmarteditUtils.pushToArrayIfValueExists(s.params.entry,"catalog",n.catalogId);this.personalizationsmarteditUtils.pushToArrayIfValueExists(s.params.entry,"catalogVersion",n.catalogVersion);this.personalizationsmarteditUtils.pushToArrayIfValueExists(s.params.entry,"slotCatalog",i.slotCatalog);this.personalizationsmarteditUtils.pushToArrayIfValueExists(s.params.entry,"oldComponentCatalog",i.oldComponentCatalog);return o.save(s)}getActions(e,t,i){const o=this.restServiceFactory.get(B.ACTIONS);const n=this.getPathVariablesObjForModifyingActionURI(e,t,undefined,i);let s={fields:B.FULL_FIELDS};s=N.assign(s,n);return o.get(s)}createActions(e,t,i,o){const n=this.getPathVariablesObjForModifyingActionURI(e,t,undefined,o);const s=this.prepareURI(B.ACTIONS,n);const a={headers:this.actionHeaders};return this.httpClient.patch(s,i,a).toPromise()}addActionToContainer(e,t,i,o,n,s){const a=this.restServiceFactory.get(B.ACTIONS);const r=this.getPathVariablesObjForModifyingActionURI(o,n,undefined,s);let l={type:"cxCmsActionData",containerId:i,componentId:e,componentCatalog:t};l=N.assign(l,r);return a.save(l)}editAction(e,t,i,o,n,s){return __awaiter(this,void 0,void 0,(function*(){const a=this.restServiceFactory.get(B.ACTION,"actionId");const r=this.getPathVariablesObjForModifyingActionURI(e,t,i,s);let l=yield a.get(r);l=N.assign(l,r);l.componentId=o;l.componentCatalog=n;return a.update(l)}))}deleteAction(e,t,i,o){const n=this.restServiceFactory.get(B.ACTION,"actionId");const s=this.getPathVariablesObjForModifyingActionURI(e,t,i,o);return n.remove(s)}deleteActions(e,t,i,o){const n=this.getPathVariablesObjForModifyingActionURI(e,t,undefined,o);const s=this.prepareURI(B.ACTIONS,n);const a={headers:this.actionHeaders,body:i};return this.httpClient.delete(s,a).toPromise()}getComponents(e){const t=this.personalizationsmarteditContextService.getSeData().seExperienceData;const i=this.restServiceFactory.get(B.CATALOGS);let o={siteId:t.siteDescriptor.uid};o=N.assign(o,e);return i.get(this.extendRequestParamObjWithCatalogAwarePathVariables(o,e))}getComponent(e){const t=this.personalizationsmarteditContextService.getSeData().seExperienceData;const i=this.restServiceFactory.get(B.CATALOG,"itemUuid");const o={itemUuid:e,siteId:t.siteDescriptor.uid};return i.get(o)}getNewComponentTypes(){const e=this.restServiceFactory.get(B.COMPONENT_TYPES);return e.get()}updateCustomizationRank(e,t){const i=this.personalizationsmarteditContextService.getSeData().seExperienceData;const o=this.restServiceFactory.get(B.UPDATE_CUSTOMIZATION_RANK);const n=[];this.personalizationsmarteditUtils.pushToArrayIfValueExists(n,"customization",e);this.personalizationsmarteditUtils.pushToArrayIfValueExists(n,"increaseValue",t);this.personalizationsmarteditUtils.pushToArrayIfValueExists(n,"catalog",i.catalogDescriptor.catalogId);this.personalizationsmarteditUtils.pushToArrayIfValueExists(n,"catalogVersion",i.catalogDescriptor.catalogVersion);const s={params:{entry:n}};return o.save(s)}checkVersionConflict(e){const t=this.personalizationsmarteditContextService.getSeData().seExperienceData;const i=this.restServiceFactory.get(B.CHECK_VERSION);const o=[];this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"versionId",e);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"catalog",t.catalogDescriptor.catalogId);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"catalogVersion",t.catalogDescriptor.catalogVersion);const n={params:{entry:o}};return i.save(n)}};t.PersonalizationsmarteditRestService.CUSTOMIZATIONS="/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/customizations";t.PersonalizationsmarteditRestService.CUSTOMIZATION=B.CUSTOMIZATIONS+"/:customizationCode";t.PersonalizationsmarteditRestService.CUSTOMIZATION_PACKAGES="/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/customizationpackages";t.PersonalizationsmarteditRestService.CUSTOMIZATION_PACKAGE=B.CUSTOMIZATION_PACKAGES+"/:customizationCode";t.PersonalizationsmarteditRestService.ACTIONS_DETAILS="/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/actions";t.PersonalizationsmarteditRestService.VARIATIONS=B.CUSTOMIZATION+"/variations";t.PersonalizationsmarteditRestService.VARIATION=B.VARIATIONS+"/:variationCode";t.PersonalizationsmarteditRestService.ACTIONS=B.VARIATION+"/actions";t.PersonalizationsmarteditRestService.ACTION=B.ACTIONS+"/:actionId";t.PersonalizationsmarteditRestService.CXCMSC_ACTIONS_FROM_VARIATIONS="/personalizationwebservices/v1/query/cxcmscomponentsfromvariations";t.PersonalizationsmarteditRestService.SEGMENTS="/personalizationwebservices/v1/segments";t.PersonalizationsmarteditRestService.CATALOGS="/cmswebservices/v1/sites/:siteId/cmsitems";t.PersonalizationsmarteditRestService.CATALOG=B.CATALOGS+"/:itemUuid";t.PersonalizationsmarteditRestService.ADD_CONTAINER="/personalizationwebservices/v1/query/cxReplaceComponentWithContainer";t.PersonalizationsmarteditRestService.COMPONENT_TYPES="/cmswebservices/v1/types?category=COMPONENT";t.PersonalizationsmarteditRestService.UPDATE_CUSTOMIZATION_RANK="/personalizationwebservices/v1/query/cxUpdateCustomizationRank";t.PersonalizationsmarteditRestService.CHECK_VERSION="/personalizationwebservices/v1/query/cxCmsPageVersionCheck";t.PersonalizationsmarteditRestService.VARIATION_FOR_CUSTOMIZATION_DEFAULT_FIELDS="variations(active,actions,enabled,code,name,rank,status,catalog,catalogVersion)";t.PersonalizationsmarteditRestService.FULL_FIELDS="FULL";t.PersonalizationsmarteditRestService=B=__decorate([n.Injectable(),__param(3,n.Inject(d.YJQUERY_TOKEN)),__metadata("design:paramtypes",[d.RestServiceFactory,l.PersonalizationsmarteditUtils,o.HttpClient,Function,t.PersonalizationsmarteditContextService])],t.PersonalizationsmarteditRestService);t.PersonalizationsmarteditRulesAndPermissionsRegistrationService=class PersonalizationsmarteditRulesAndPermissionsRegistrationService{constructor(e,t,i,o,n){this.personalizationsmarteditContextService=e;this.personalizationsmarteditRestService=t;this.permissionService=i;this.catalogVersionPermissionService=o;this.pageService=n}registerRules(){this.permissionService.registerRule({names:["se.access.personalization"],verify:()=>__awaiter(this,void 0,void 0,(function*(){yield this.catalogVersionPermissionService.hasReadPermissionOnCurrent();yield this.personalizationsmarteditContextService.refreshExperienceData();try{yield this.personalizationsmarteditRestService.getCustomizations(this.getCustomizationFilter());return true}catch(e){if(e.status===403){return false}else{return true}}}))});this.permissionService.registerRule({names:["se.access.personalization.page"],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.pageService.getCurrentPageInfo();return e.typeCode!=="EmailPage"}))});this.permissionService.registerPermission({aliases:["se.personalization.open"],rules:["se.access.personalization"]});this.permissionService.registerPermission({aliases:["se.personalization.page"],rules:["se.access.personalization.page"]})}getCustomizationFilter(){return{currentPage:0,currentSize:1}}};t.PersonalizationsmarteditRulesAndPermissionsRegistrationService=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.PersonalizationsmarteditContextService,t.PersonalizationsmarteditRestService,d.IPermissionService,d.ICatalogVersionPermissionService,d.IPageService])],t.PersonalizationsmarteditRulesAndPermissionsRegistrationService);t.PersonalizationsmarteditVersionCheckerService=class PersonalizationsmarteditVersionCheckerService{constructor(e,t){this.restService=e;this.pageVersionSelectionService=t}setVersion(e){this.version=e}provideTranlationKey(e){const t="personalization.se.cms.actionitem.page.version.rollback.confirmation";this.version=this.version||this.pageVersionSelectionService.getSelectedPageVersion();if(!!this.version){return this.restService.checkVersionConflict(this.version.uid).then((i=>i.result?e:t),(()=>e))}else{return Promise.resolve(e)}}};t.PersonalizationsmarteditVersionCheckerService=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.PersonalizationsmarteditRestService,d.PageVersionSelectionService])],t.PersonalizationsmarteditVersionCheckerService);t.SePersonalizationsmarteditServicesModule=class SePersonalizationsmarteditServicesModule{};t.SePersonalizationsmarteditServicesModule=__decorate([n.NgModule({imports:[m.CommonModule,l.PersonalizationsmarteditCommonsComponentsModule],providers:[{provide:l.IPersonalizationsmarteditContextServiceProxy,useClass:t.PersonalizationsmarteditContextServiceProxy},t.PersonalizationsmarteditContextService,t.PersonalizationsmarteditRestService,t.PersonalizationsmarteditPreviewService,t.PersonalizationsmarteditRulesAndPermissionsRegistrationService,t.PersonalizationsmarteditContextServiceReverseProxy,t.PersonalizationsmarteditVersionCheckerService,d.moduleUtils.bootstrap((e=>{e.registerRules()}),[t.PersonalizationsmarteditRulesAndPermissionsRegistrationService])]})],t.SePersonalizationsmarteditServicesModule);let j=class CombinedViewConfigureService{constructor(){this.catalogFilterSubject=new u.Subject;this.selectedItemsSubject=new u.BehaviorSubject([]);this.selectedItems=[];this.isItemSelected=e=>!!this.selectedItems.find((t=>t.customization.code===e.customization.code&&t.variation.code===e.variation.code));this.selectedItemsSubscription=this.selectedItemsSubject.asObservable().subscribe((e=>{this.selectedItems=e}))}ngOnDestroy(){this.selectedItemsSubscription.unsubscribe()}setCatalogFilter(e){this.catalogFilterSubject.next(e)}getCatalogFilter$(){return this.catalogFilterSubject.asObservable()}setSelectedItems(e){this.selectedItemsSubject.next(e)}};j=__decorate([n.Injectable(),__metadata("design:paramtypes",[])],j);window.__smartedit__.addDecoratorPayload("Component","CombinedViewItemPrinterComponent",{selector:"combined-view-item-printer",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div [ngClass]="isItemSelected(combinedViewSelectItem) ? 'pe-combinedview-config__ui-select-item--selected': ''" class="pe-combinedview-config__ui-select-choices-layout"><div class="pe-combinedview-config__ui-select-choices-col1"><div [title]="combinedViewSelectItem.customization.name + ' > ' + combinedViewSelectItem.variation.name" [textContent]="combinedViewSelectItem.customization.name + ' > ' + combinedViewSelectItem.variation.name" class="perso-wrap-ellipsis"></div></div></div>`});let G=class CombinedViewItemPrinterComponent{constructor(e,t,i,o){this.data=e;this.contextService=t;this.personalizationsmarteditUtils=i;this.combinedViewConfigureService=o;this.isItemFromCurrentCatalog=e=>this.personalizationsmarteditUtils.isItemFromCurrentCatalog(e,this.contextService.getSeData());this.isItemSelected=e=>this.combinedViewConfigureService.isItemSelected(e);({item:this.combinedViewSelectItem,selected:this.isSelected,select:this.select}=e);this.catalogFilterSubscription=this.combinedViewConfigureService.getCatalogFilter$().subscribe((e=>{this.catalogFilter=e}))}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){if(this.catalogFilter!=="current"){yield this.personalizationsmarteditUtils.getAndSetCatalogVersionNameL10N(this.data.item.variation)}}))}ngOnDestroy(){this.catalogFilterSubscription.unsubscribe()}};G=__decorate([n.Component({selector:"combined-view-item-printer",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div [ngClass]="isItemSelected(combinedViewSelectItem) ? 'pe-combinedview-config__ui-select-item--selected': ''" class="pe-combinedview-config__ui-select-choices-layout"><div class="pe-combinedview-config__ui-select-choices-col1"><div [title]="combinedViewSelectItem.customization.name + ' > ' + combinedViewSelectItem.variation.name" [textContent]="combinedViewSelectItem.customization.name + ' > ' + combinedViewSelectItem.variation.name" class="perso-wrap-ellipsis"></div></div></div>`}),__param(0,n.Inject(d.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object,t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditUtils,j])],G);window.__smartedit__.addDecoratorPayload("Component","CombinedViewConfigureComponent",{selector:"combined-view-configure",template:`<div class="pe-combinedview-config__form"><div class="form-group"><label for="PageFilterDropdownField001" class="fd-form-label" translate="personalization.commons.filter.label"></label><div class="pe-combinedview-config__filter-layout"><page-filter-dropdown id="PageFilterDropdownField001" (onSelectCallback)="pageFilterChange($event)" class="fd-has-margin-right-small"></page-filter-dropdown><has-multicatalog class="perso-filter__wrapper perso-filter__wrapper--catalog"><catalog-filter-dropdown (onSelectCallback)="catalogFilterChange($event)"></catalog-filter-dropdown></has-multicatalog></div><div class="pe-combinedview-config__select-group-layout"><div class="pe-combinedview-config__select-group-label-layout"><label for="CombinedViewSearchField1" class="fd-form-label se-control-label required pe-combinedview-config__label" translate="personalization.modal.combinedview.search.label"></label></div><se-select id="CombinedViewSearchField1" class="fd-form__control" [(model)]="selectedCombinedViewItemId" [placeholder]="'personalization.modal.combinedview.search.placeholder'" [fetchStrategy]="combinedViewItemsFetchStrategy" [onSelect]="selectElement" [itemComponent]="combinedViewItemPrinter" [disableChoiceFn]="isItemInSelectDisabled" [(reset)]="resetSelectedItems" [additionalBodyClass]="'se-select--paged'" [resetSearchInput]="false"></se-select></div></div><div class="form-group"><p *ngIf="selectedCombinedViewItems.length === 0" translate="personalization.toolbar.combinedview.openconfigure.empty"></p><div id="CombinedViewSelectedField1" class="pe-combinedview-config__list-layout" *ngFor="let item of selectedCombinedViewItems; index as i; first as isFirst" [ngClass]="isFirst ? 'pe-combinedview-config__divider' : ''"><div class="pe-combinedview-config__letter-layout"><div [ngClass]="getClassForElement(i)" [textContent]="getLetterForElement(i)"></div></div><div class="pe-combinedview-config__names-layout"><div class="perso-wrap-ellipsis pe-combinedview-config__cname" [textContent]="item.customization.name" [title]="item.customization.name"></div><span>></span><div class="perso-wrap-ellipsis pe-combinedview-config__vname" [textContent]="item.variation.name" [title]="item.variation.name"></div></div><div class="pe-combinedview-config__hyicon-globe"><se-tooltip *ngIf="!isItemFromCurrentCatalog(item.variation)" [placement]="'top-end'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true" [appendTo]="'body'"><span class="perso__globe-icon sap-icon--globe" se-tooltip-trigger></span><div se-tooltip-body [translate]="item.variation.catalogVersionNameL10N"></div></se-tooltip></div><div class="pe-combinedview-config__hyicon-remove"><span class="sap-icon--decline" (click)="removeSelectedItem(item)" [title]="'personalization.modal.combinedview.icon.remove.title' | translate"></span></div></div></div></div>`});let H=class CombinedViewConfigureComponent{constructor(e,t,i,o,n,s,a,r){this.translateService=e;this.contextService=t;this.messageHandler=i;this.personalizationsmarteditUtils=o;this.componentMenuService=n;this.restService=s;this.modalManager=a;this.combinedViewConfigureService=r;this.selectElement=(e,t)=>__awaiter(this,void 0,void 0,(function*(){if(!e){return}this.selectedCombinedViewItems.push(e);const t=yield this.componentMenuService.getValidContentCatalogVersions();const i=t.map((e=>e.id));this.selectedCombinedViewItems.sort(((e,t)=>{const o=e.customization.catalog+"/"+e.customization.catalogVersion;const n=t.customization.catalog+"/"+t.customization.catalogVersion;if(o===n){return e.customization.rank-t.customization.rank}return i.indexOf(n)-i.indexOf(o)}));this.combinedViewConfigureService.setSelectedItems(this.selectedCombinedViewItems);this.reset()}));this.removeSelectedItem=e=>{this.selectedCombinedViewItems.splice(this.selectedCombinedViewItems.indexOf(e),1);this.combinedViewConfigureService.setSelectedItems(this.selectedCombinedViewItems);this.reset()};this.getClassForElement=e=>this.personalizationsmarteditUtils.getClassForElement(e);this.getLetterForElement=e=>this.personalizationsmarteditUtils.getLetterForElement(e);this.isItemInSelectDisabled=e=>!!this.selectedCombinedViewItems.find((t=>t.customization.code===e.customization.code));this.pageFilterChange=e=>{this.customizationPageFilter=e};this.catalogFilterChange=e=>{this.catalogFilter=e;this.combinedViewConfigureService.setCatalogFilter(this.catalogFilter)};this.isItemFromCurrentCatalog=e=>this.personalizationsmarteditUtils.isItemFromCurrentCatalog(e,this.contextService.getSeData());this.constructCombinedViewSelectItem=(e,t)=>({id:e.code+"-"+t.code,label:e.name+" > "+t.name,customization:{code:e.code,name:e.name,rank:e.rank,catalog:e.catalog,catalogVersion:e.catalogVersion},variation:{code:t.code,name:t.name,catalog:t.catalog,catalogVersion:t.catalogVersion}})}ngOnInit(){this.combinedView=this.contextService.getCombinedView();this.selectedCombinedViewItems=[];this.selectedCombinedViewItems=N.cloneDeep(this.combinedView.selectedItems||[]);this.combinedViewConfigureService.setSelectedItems(this.selectedCombinedViewItems);this.selectedCombinedViewItemId=null;this.moreCustomizationsRequestProcessing=false;this.combinedViewItemPrinter=G;this.combinedViewItemsFetchStrategy={fetchPage:(e,t,i)=>__awaiter(this,void 0,void 0,(function*(){return this.customizedVarItemsFetchPage(e,t,i)})),fetchEntity:e=>__awaiter(this,void 0,void 0,(function*(){return this.customizedVarItemsFetchEntity(e)}))};this.modalManager.addButtons([{id:"confirmOk",label:"personalization.modal.combinedview.button.ok",style:d.ModalButtonStyle.Primary,action:d.ModalButtonAction.Close,callback:()=>u.from(this.onSave()),disabledFn:()=>{const e=this.contextService.getCombinedView();let t=(e.selectedItems||[]).length===0&&this.selectedCombinedViewItems.length===0;t=t||N.isEqual(e.selectedItems,this.selectedCombinedViewItems);return t}},{id:"confirmCancel",label:"personalization.modal.combinedview.button.cancel",style:d.ModalButtonStyle.Default,action:d.ModalButtonAction.Dismiss,callback:()=>u.from(this.onCancel())}])}reset(){if(this.resetSelectedItems){this.resetSelectedItems(true)}}customizedVarItemsFetchPage(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=this.getCustomizationsCategoryFilter(e,t,i);try{const e=yield this.restService.getCustomizations(o);const t=[];e.customizations.forEach((e=>{e.variations.filter((e=>this.personalizationsmarteditUtils.isItemVisible(e))).forEach((i=>t.push(this.constructCombinedViewSelectItem(e,i))))}));return{pagination:e.pagination,results:t}}catch(e){this.messageHandler.sendError(this.translateService.instant("personalization.error.gettingcustomizations"))}}))}customizedVarItemsFetchEntity(e){return __awaiter(this,void 0,void 0,(function*(){if(!e){return}const[t,i]=e.split("-");const o=yield this.restService.getCustomization({code:t});const n=o.variations.filter((e=>e.code===i))[0];return this.constructCombinedViewSelectItem(o,n)}))}getDefaultStatus(){const e=this.personalizationsmarteditUtils.getStatusesMapping();return e.find((e=>e.code===l.PERSONALIZATION_VIEW_STATUS_MAPPING_CODES.ALL))}isCombinedViewContextPersRemoved(e){const t=e.selectedItems;return!t.find((t=>t.customization.code===e.customize.selectedCustomization.code&&t.variation.code===e.customize.selectedVariations.code))}getCustomizationsCategoryFilter(e="",t,i){const o={currentSize:t,currentPage:i,name:e,statuses:this.getDefaultStatus().modelStatuses,catalogs:this.catalogFilter,pageId:undefined,pageCatalogId:undefined};if(this.customizationPageFilter===l.PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER.ONLY_THIS_PAGE){o.pageId=this.contextService.getSeData().pageId;o.pageCatalogId=this.contextService.getSeData().seExperienceData.pageContext.catalogId}return o}onCancel(){this.modalManager.close(null);return Promise.resolve()}onSave(){const e=this.contextService.getCombinedView();e.selectedItems=this.selectedCombinedViewItems;if(e.enabled&&e.customize.selectedVariations!==null&&this.isCombinedViewContextPersRemoved(e)){e.customize.selectedCustomization=null;e.customize.selectedVariations=null;e.customize.selectedComponents=null}this.contextService.setCombinedView(e);this.modalManager.close(null);return Promise.resolve()}};H=__decorate([n.Component({selector:"combined-view-configure",template:`<div class="pe-combinedview-config__form"><div class="form-group"><label for="PageFilterDropdownField001" class="fd-form-label" translate="personalization.commons.filter.label"></label><div class="pe-combinedview-config__filter-layout"><page-filter-dropdown id="PageFilterDropdownField001" (onSelectCallback)="pageFilterChange($event)" class="fd-has-margin-right-small"></page-filter-dropdown><has-multicatalog class="perso-filter__wrapper perso-filter__wrapper--catalog"><catalog-filter-dropdown (onSelectCallback)="catalogFilterChange($event)"></catalog-filter-dropdown></has-multicatalog></div><div class="pe-combinedview-config__select-group-layout"><div class="pe-combinedview-config__select-group-label-layout"><label for="CombinedViewSearchField1" class="fd-form-label se-control-label required pe-combinedview-config__label" translate="personalization.modal.combinedview.search.label"></label></div><se-select id="CombinedViewSearchField1" class="fd-form__control" [(model)]="selectedCombinedViewItemId" [placeholder]="'personalization.modal.combinedview.search.placeholder'" [fetchStrategy]="combinedViewItemsFetchStrategy" [onSelect]="selectElement" [itemComponent]="combinedViewItemPrinter" [disableChoiceFn]="isItemInSelectDisabled" [(reset)]="resetSelectedItems" [additionalBodyClass]="'se-select--paged'" [resetSearchInput]="false"></se-select></div></div><div class="form-group"><p *ngIf="selectedCombinedViewItems.length === 0" translate="personalization.toolbar.combinedview.openconfigure.empty"></p><div id="CombinedViewSelectedField1" class="pe-combinedview-config__list-layout" *ngFor="let item of selectedCombinedViewItems; index as i; first as isFirst" [ngClass]="isFirst ? 'pe-combinedview-config__divider' : ''"><div class="pe-combinedview-config__letter-layout"><div [ngClass]="getClassForElement(i)" [textContent]="getLetterForElement(i)"></div></div><div class="pe-combinedview-config__names-layout"><div class="perso-wrap-ellipsis pe-combinedview-config__cname" [textContent]="item.customization.name" [title]="item.customization.name"></div><span>></span><div class="perso-wrap-ellipsis pe-combinedview-config__vname" [textContent]="item.variation.name" [title]="item.variation.name"></div></div><div class="pe-combinedview-config__hyicon-globe"><se-tooltip *ngIf="!isItemFromCurrentCatalog(item.variation)" [placement]="'top-end'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true" [appendTo]="'body'"><span class="perso__globe-icon sap-icon--globe" se-tooltip-trigger></span><div se-tooltip-body [translate]="item.variation.catalogVersionNameL10N"></div></se-tooltip></div><div class="pe-combinedview-config__hyicon-remove"><span class="sap-icon--decline" (click)="removeSelectedItem(item)" [title]="'personalization.modal.combinedview.icon.remove.title' | translate"></span></div></div></div></div>`}),__metadata("design:paramtypes",[g.TranslateService,t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditMessageHandler,l.PersonalizationsmarteditUtils,d.ComponentMenuService,t.PersonalizationsmarteditRestService,d.ModalManagerService,j])],H);t.CombinedViewCommonsService=class CombinedViewCommonsService{constructor(e,t,i,o,n,s,a){this.personalizationsmarteditContextUtils=e;this.personalizationsmarteditContextService=t;this.personalizationsmarteditPreviewService=i;this.personalizationsmarteditUtils=o;this.personalizationsmarteditRestService=n;this.modalService=s;this.logService=a}openManagerAction(){return __awaiter(this,void 0,void 0,(function*(){try{yield this.modalService.open({component:H,templateConfig:{title:"personalization.modal.combinedview.title",isDismissButtonVisible:true},config:{focusTrapped:false,backdropClickCloseable:false}}).afterClosed.toPromise();this.personalizationsmarteditContextUtils.clearCombinedViewCustomizeContext(this.personalizationsmarteditContextService);const e=this.personalizationsmarteditContextService.getCombinedView();e.enabled=e.selectedItems&&e.selectedItems.length>0;this.personalizationsmarteditContextService.setCombinedView(e);this.updatePreview(this.getVariationsForPreviewTicket())}catch(e){this.logService.debug("Combined View Items Select Modal dismissed",e)}}))}updatePreview(e){this.personalizationsmarteditPreviewService.updatePreviewTicketWithVariations(e);this.updateActionsOnSelectedVariations()}getVariationsForPreviewTicket(){const e=[];const t=this.personalizationsmarteditContextService.getCombinedView();(t.selectedItems||[]).forEach((t=>{e.push({customizationCode:t.customization.code,variationCode:t.variation.code,catalog:t.variation.catalog,catalogVersion:t.variation.catalogVersion})}));return e}combinedViewEnabledEvent(e){const t=this.personalizationsmarteditContextService.getCombinedView();t.enabled=e;this.personalizationsmarteditContextService.setCombinedView(t);const i=this.personalizationsmarteditContextService.getCustomize();i.selectedCustomization=null;i.selectedVariations=null;i.selectedComponents=null;this.personalizationsmarteditContextService.setCustomize(i);if(e){this.updatePreview(this.getVariationsForPreviewTicket())}else{this.updatePreview([])}}isItemFromCurrentCatalog(e){return this.personalizationsmarteditUtils.isItemFromCurrentCatalog(e,this.personalizationsmarteditContextService.getSeData())}updateActionsOnSelectedVariations(){return __awaiter(this,void 0,void 0,(function*(){const e=this.personalizationsmarteditContextService.getCombinedView();const t=(e.selectedItems||[]).map((e=>__awaiter(this,void 0,void 0,(function*(){const t=yield this.personalizationsmarteditRestService.getActions(e.customization.code,e.variation.code,e.variation);e.variation.actions=t.actions}))));yield Promise.all(t);this.personalizationsmarteditContextService.setCombinedView(e)}))}};t.CombinedViewCommonsService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.PersonalizationsmarteditContextUtils,t.PersonalizationsmarteditContextService,t.PersonalizationsmarteditPreviewService,l.PersonalizationsmarteditUtils,t.PersonalizationsmarteditRestService,d.IModalService,d.LogService])],t.CombinedViewCommonsService);window.__smartedit__.addDecoratorPayload("Component","CombinedViewMenuComponent",{selector:"combined-view-menu",template:`<div class="btn-block pe-toolbar-action--include"><div class="pe-toolbar-menu-content se-toolbar-menu-content--pe-customized se-toolbar-menu-content--pe-combine" role="menu"><div class="se-toolbar-menu-content--pe-customized__headers"><h2 class="se-toolbar-menu-content--pe-customized__headers--h2" translate="personalization.toolbar.combinedview.header.title"></h2><se-help class="se-toolbar-menu-content__y-help"><span translate="personalization.toolbar.combinedview.header.description"></span></se-help></div><div role="menuitem"><div *ngIf="!isCombinedViewConfigured"><div class="pe-combined-view-panel__wrapper pe-combined-view-panel__wrapper--empty"><img src="static-resources/images/emptyVersions.svg" alt="no Configurationss" class="pe-combined-view-panel--empty-img"> <span class="pe-combined-view-panel--empty-text" translate="personalization.toolbar.combinedview.openconfigure.empty"></span> <a class="fd-link pe-combined-view-panel--empty-link" (click)="combinedViewClick()" translate="personalization.toolbar.combinedview.openconfigure.link" [title]="'personalization.toolbar.combinedview.openconfigure.link' | translate"></a></div></div><div *ngIf="isCombinedViewConfigured"><div class="pe-combined-view-panel__wrapper"><div class="pe-combined-view-panel__configure-layout"><button fd-button [label]="'personalization.toolbar.combinedview.openconfigure.button' | translate" [title]="'personalization.toolbar.combinedview.openconfigure.button' | translate" class="pe-combined-view-panel__configure-btn perso-wrap-ellipsis" (click)="combinedViewClick()"></button> <button fd-button label="Transparent Button" class="pe-combined-view-panel__configure-btn perso-wrap-ellipsis" (click)="clearAllCombinedViewClick()" [label]="'personalization.toolbar.combinedview.clearall.button' | translate" [title]="'personalization.toolbar.combinedview.clearall.button' | translate" [fdType]="'transparent'"></button></div><div [ngClass]="combinedView.enabled ? null : 'pe-combined-view-panel--disabled'"><div class="pe-combined-view-panel__list-layout" *ngFor="let item of selectedItems; index as i" (click)="itemClick(item)" [ngClass]="{'pe-combined-view-panel-list__item--highlighted': item.highlighted}"><div class="pe-combined-view-panel-list__letter-layout"><div [ngClass]="getClassForElement(i)" [textContent]="getLetterForElement(i)"></div></div><div class="pe-combined-view-panel-list__names-layout"><div class="perso-wrap-ellipsis" [textContent]="item.customization.name" [title]="item.customization.name"></div><div class="perso-wrap-ellipsis perso-tree__primary-data" [textContent]="item.variation.name" [title]="item.variation.name"></div></div><div class="pe-combined-view-panel-list__icon"><se-tooltip *ngIf="!isItemFromCurrentCatalog(item.variation) && combinedView.enabled" [placement]="'top-end'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true" [appendTo]="'body'"><span class="perso__globe-icon sap-icon--globe" se-tooltip-trigger></span><div se-tooltip-body [translate]="item.variation.catalogVersionNameL10N"></div></se-tooltip></div></div></div></div></div></div></div></div>`});t.CombinedViewMenuComponent=class CombinedViewMenuComponent{constructor(e,t,i,o,n,s,a,r,l,d,p){this.translateService=e;this.contextService=t;this.messageHandler=i;this.restService=o;this.contextUtils=n;this.personalizationsmarteditUtils=s;this.previewService=a;this.combinedViewCommonsService=r;this.crossFrameEventService=l;this.permissionService=d;this.toolbarItem=p}ngOnInit(){this.combinedView=this.contextService.getCombinedView();this.selectedItems=this.combinedView.selectedItems||[];this.isCombinedViewConfigured=this.selectedItems.length!==0}combinedViewClick(){this.contextUtils.clearCustomizeContextAndReloadPreview(this.previewService,this.contextService);this.combinedViewCommonsService.openManagerAction();this.toolbarItem.isOpen=false}getAndSetComponentsForElement(e,t,i,o){return __awaiter(this,void 0,void 0,(function*(){try{const n=yield this.restService.getComponentsIdsForVariation(e,t,i,o);const s=this.contextService.getCombinedView();s.customize.selectedComponents=n.components;this.contextService.setCombinedView(s)}catch(e){this.messageHandler.sendError(this.translateService.instant("personalization.error.gettingcomponentsforvariation"))}}))}itemClick(e){return __awaiter(this,void 0,void 0,(function*(){const t=this.contextService.getCombinedView();if(!t.enabled){return}this.selectedItems.forEach((e=>{e.highlighted=false}));e.highlighted=true;t.customize.selectedCustomization=e.customization;t.customize.selectedVariations=e.variation;this.contextService.setCombinedView(t);const i=yield this.permissionService.isPermitted([{names:["se.edit.page"]}]);if(i){this.getAndSetComponentsForElement(e.customization.code,e.variation.code,e.customization.catalog,e.customization.catalogVersion)}this.combinedViewCommonsService.updatePreview(this.personalizationsmarteditUtils.getVariationKey(e.customization.code,[e.variation]));this.crossFrameEventService.publish(d.SHOW_TOOLBAR_ITEM_CONTEXT,l.COMBINED_VIEW_TOOLBAR_ITEM_KEY)}))}getClassForElement(e){return this.personalizationsmarteditUtils.getClassForElement(e)}getLetterForElement(e){return this.personalizationsmarteditUtils.getLetterForElement(e)}isItemFromCurrentCatalog(e){return this.combinedViewCommonsService.isItemFromCurrentCatalog(e)}clearAllCombinedViewClick(){this.selectedItems=[];this.combinedView.selectedItems=[];this.combinedView.enabled=false;this.contextService.setCombinedView(this.combinedView);this.combinedViewCommonsService.combinedViewEnabledEvent(this.combinedView.enabled)}};t.CombinedViewMenuComponent=__decorate([n.Component({selector:"combined-view-menu",template:`<div class="btn-block pe-toolbar-action--include"><div class="pe-toolbar-menu-content se-toolbar-menu-content--pe-customized se-toolbar-menu-content--pe-combine" role="menu"><div class="se-toolbar-menu-content--pe-customized__headers"><h2 class="se-toolbar-menu-content--pe-customized__headers--h2" translate="personalization.toolbar.combinedview.header.title"></h2><se-help class="se-toolbar-menu-content__y-help"><span translate="personalization.toolbar.combinedview.header.description"></span></se-help></div><div role="menuitem"><div *ngIf="!isCombinedViewConfigured"><div class="pe-combined-view-panel__wrapper pe-combined-view-panel__wrapper--empty"><img src="static-resources/images/emptyVersions.svg" alt="no Configurationss" class="pe-combined-view-panel--empty-img"> <span class="pe-combined-view-panel--empty-text" translate="personalization.toolbar.combinedview.openconfigure.empty"></span> <a class="fd-link pe-combined-view-panel--empty-link" (click)="combinedViewClick()" translate="personalization.toolbar.combinedview.openconfigure.link" [title]="'personalization.toolbar.combinedview.openconfigure.link' | translate"></a></div></div><div *ngIf="isCombinedViewConfigured"><div class="pe-combined-view-panel__wrapper"><div class="pe-combined-view-panel__configure-layout"><button fd-button [label]="'personalization.toolbar.combinedview.openconfigure.button' | translate" [title]="'personalization.toolbar.combinedview.openconfigure.button' | translate" class="pe-combined-view-panel__configure-btn perso-wrap-ellipsis" (click)="combinedViewClick()"></button> <button fd-button label="Transparent Button" class="pe-combined-view-panel__configure-btn perso-wrap-ellipsis" (click)="clearAllCombinedViewClick()" [label]="'personalization.toolbar.combinedview.clearall.button' | translate" [title]="'personalization.toolbar.combinedview.clearall.button' | translate" [fdType]="'transparent'"></button></div><div [ngClass]="combinedView.enabled ? null : 'pe-combined-view-panel--disabled'"><div class="pe-combined-view-panel__list-layout" *ngFor="let item of selectedItems; index as i" (click)="itemClick(item)" [ngClass]="{'pe-combined-view-panel-list__item--highlighted': item.highlighted}"><div class="pe-combined-view-panel-list__letter-layout"><div [ngClass]="getClassForElement(i)" [textContent]="getLetterForElement(i)"></div></div><div class="pe-combined-view-panel-list__names-layout"><div class="perso-wrap-ellipsis" [textContent]="item.customization.name" [title]="item.customization.name"></div><div class="perso-wrap-ellipsis perso-tree__primary-data" [textContent]="item.variation.name" [title]="item.variation.name"></div></div><div class="pe-combined-view-panel-list__icon"><se-tooltip *ngIf="!isItemFromCurrentCatalog(item.variation) && combinedView.enabled" [placement]="'top-end'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true" [appendTo]="'body'"><span class="perso__globe-icon sap-icon--globe" se-tooltip-trigger></span><div se-tooltip-body [translate]="item.variation.catalogVersionNameL10N"></div></se-tooltip></div></div></div></div></div></div></div></div>`}),__param(10,n.Inject(d.TOOLBAR_ITEM)),__metadata("design:paramtypes",[g.TranslateService,t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditMessageHandler,t.PersonalizationsmarteditRestService,l.PersonalizationsmarteditContextUtils,l.PersonalizationsmarteditUtils,t.PersonalizationsmarteditPreviewService,t.CombinedViewCommonsService,d.CrossFrameEventService,d.IPermissionService,Object])],t.CombinedViewMenuComponent);window.__smartedit__.addDecoratorPayload("Component","CatalogFilterDropdownComponent",{selector:"catalog-filter-dropdown",template:`<se-select class="perso-filter" (click)="$event.stopPropagation()" [(model)]="selectedId" [onChange]="onChange" [fetchStrategy]="fetchStrategy" [searchEnabled]="false"></se-select>`});let W=class CatalogFilterDropdownComponent{constructor(){this.fetchStrategy={fetchAll:()=>Promise.resolve(this.items)};this.onChange=this.onChange.bind(this);this.onSelectCallback=new n.EventEmitter}ngOnInit(){this.items=[{id:l.PERSONALIZATION_CATALOG_FILTER.ALL,label:"personalization.filter.catalog.all"},{id:l.PERSONALIZATION_CATALOG_FILTER.CURRENT,label:"personalization.filter.catalog.current"},{id:l.PERSONALIZATION_CATALOG_FILTER.PARENTS,label:"personalization.filter.catalog.parents"}];this.selectedId=this.initialValue||this.items[1].id}onChange(){this.onSelectCallback.emit(this.selectedId)}};__decorate([n.Input(),__metadata("design:type",String)],W.prototype,"initialValue",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],W.prototype,"onSelectCallback",void 0);W=__decorate([n.Component({selector:"catalog-filter-dropdown",template:`<se-select class="perso-filter" (click)="$event.stopPropagation()" [(model)]="selectedId" [onChange]="onChange" [fetchStrategy]="fetchStrategy" [searchEnabled]="false"></se-select>`}),__metadata("design:paramtypes",[])],W);window.__smartedit__.addDecoratorPayload("Component","PageFilterDropdownComponent",{selector:"page-filter-dropdown",template:`<se-select class="perso-filter" (click)="$event.stopPropagation()" [(model)]="selectedId" [onChange]="onChange" [fetchStrategy]="fetchStrategy" [searchEnabled]="false"></se-select>`});let $=class PageFilterDropdownComponent{constructor(){this.fetchStrategy={fetchAll:()=>Promise.resolve(this.items)};this.onChange=this.onChange.bind(this);this.onSelectCallback=new n.EventEmitter}ngOnInit(){this.items=[{id:l.PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER.ONLY_THIS_PAGE,label:"personalization.filter.page.onlythispage"},{id:l.PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER.ALL,label:"personalization.filter.page.all"}];this.selectedId=this.initialValue||this.items[0].id}onChange(){this.onSelectCallback.emit(this.selectedId)}};__decorate([n.Input(),__metadata("design:type",String)],$.prototype,"initialValue",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],$.prototype,"onSelectCallback",void 0);$=__decorate([n.Component({selector:"page-filter-dropdown",template:`<se-select class="perso-filter" (click)="$event.stopPropagation()" [(model)]="selectedId" [onChange]="onChange" [fetchStrategy]="fetchStrategy" [searchEnabled]="false"></se-select>`}),__metadata("design:paramtypes",[])],$);window.__smartedit__.addDecoratorPayload("Component","StatusFilterDropdownComponent",{selector:"status-filter-dropdown",template:`<se-select class="perso-filter" (click)="$event.stopPropagation()" [(model)]="selectedId" [onChange]="onChange" [fetchStrategy]="fetchStrategy" [searchEnabled]="false"></se-select>`});let K=class StatusFilterDropdownComponent{constructor(e){this.personalizationsmarteditUtils=e;this.fetchStrategy={fetchAll:()=>Promise.resolve(this.items)};this.onChange=this.onChange.bind(this);this.onSelectCallback=new n.EventEmitter}ngOnInit(){this.items=this.personalizationsmarteditUtils.getStatusesMapping().map((e=>({id:e.code,label:e.text,modelStatuses:e.modelStatuses})));this.selectedId=this.initialValue||this.items[0].id}onChange(){this.onSelectCallback.emit(this.selectedId)}};__decorate([n.Input(),__metadata("design:type",String)],K.prototype,"initialValue",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],K.prototype,"onSelectCallback",void 0);K=__decorate([n.Component({selector:"status-filter-dropdown",template:`<se-select class="perso-filter" (click)="$event.stopPropagation()" [(model)]="selectedId" [onChange]="onChange" [fetchStrategy]="fetchStrategy" [searchEnabled]="false"></se-select>`}),__metadata("design:paramtypes",[l.PersonalizationsmarteditUtils])],K);window.__smartedit__.addDecoratorPayload("Component","CatalogVersionFilterItemPrinterComponent",{selector:"catalog-version-filter-item-printer",template:`\n        <div>\n            <span\n                class="perso__globe-icon sap-icon--globe"\n                *ngIf="data.item.isCurrentCatalog === false"\n            >\n            </span>\n            <span *ngIf="data.item.isCurrentCatalog === false">\n                {{ data.item.catalogName }} - {{ data.item.catalogVersionId }}\n            </span>\n            <span\n                *ngIf="data.item.isCurrentCatalog === true"\n                [translate]="'personalization.filter.catalog.current'"\n            ></span>\n        </div>\n    `});let Y=class CatalogVersionFilterItemPrinterComponent{constructor(e){this.data=e}};Y=__decorate([n.Component({selector:"catalog-version-filter-item-printer",template:`\n        <div>\n            <span\n                class="perso__globe-icon sap-icon--globe"\n                *ngIf="data.item.isCurrentCatalog === false"\n            >\n            </span>\n            <span *ngIf="data.item.isCurrentCatalog === false">\n                {{ data.item.catalogName }} - {{ data.item.catalogVersionId }}\n            </span>\n            <span\n                *ngIf="data.item.isCurrentCatalog === true"\n                [translate]="'personalization.filter.catalog.current'"\n            ></span>\n        </div>\n    `}),__param(0,n.Inject(d.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],Y);window.__smartedit__.addDecoratorPayload("Component","CatalogVersionFilterDropdownComponent",{selector:"catalog-version-filter-dropdown",template:`\n        <se-select\n            class="perso-filter"\n            (click)="$event.stopPropagation()"\n            [(model)]="selectedId"\n            [onChange]="onChange"\n            [fetchStrategy]="fetchStrategy"\n            [itemComponent]="itemComponent"\n            [searchEnabled]="false"\n        ></se-select>\n    `,providers:[d.L10nPipe]});let Z=class CatalogVersionFilterDropdownComponent{constructor(e,t,i){this.componentMenuService=e;this.personalizationsmarteditContextService=t;this.l10nPipe=i;this.onSelectCallback=new n.EventEmitter;this.itemComponent=Y;this.onChange=this.onChange.bind(this);this.fetchStrategy={fetchAll:()=>Promise.resolve(this.items)}}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.items=yield this.componentMenuService.getValidContentCatalogVersions();const e=this.personalizationsmarteditContextService.getSeData().seExperienceData;this.items.forEach((t=>__awaiter(this,void 0,void 0,(function*(){t.isCurrentCatalog=t.id===e.catalogDescriptor.catalogVersionUuid;t.catalogName=yield this.l10nPipe.transform(t.catalogName).pipe(_.take(1)).toPromise()}))));const t=yield this.componentMenuService.getInitialCatalogVersion(this.items);this.selectedId=this.initialValue||t.id}))}onChange(e){this.onSelectCallback.emit(this.selectedId)}};__decorate([n.Input(),__metadata("design:type",String)],Z.prototype,"initialValue",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Z.prototype,"onSelectCallback",void 0);Z=__decorate([n.Component({selector:"catalog-version-filter-dropdown",template:`\n        <se-select\n            class="perso-filter"\n            (click)="$event.stopPropagation()"\n            [(model)]="selectedId"\n            [onChange]="onChange"\n            [fetchStrategy]="fetchStrategy"\n            [itemComponent]="itemComponent"\n            [searchEnabled]="false"\n        ></se-select>\n    `,providers:[d.L10nPipe]}),__param(1,n.Inject(t.PersonalizationsmarteditContextService)),__metadata("design:paramtypes",[d.ComponentMenuService,t.PersonalizationsmarteditContextService,d.L10nPipe])],Z);window.__smartedit__.addDecoratorPayload("Component","HasMulticatalogComponent",{selector:"has-multicatalog",template:`\n        <div *ngIf="hasMulticatalog">\n            <ng-content></ng-content>\n        </div>\n    `});let Q=class HasMulticatalogComponent{constructor(e){this.personalizationsmarteditContextService=e}ngOnInit(){this.hasMulticatalog=this.getSeExperienceData().siteDescriptor.contentCatalogs.length>1}getSeExperienceData(){return this.personalizationsmarteditContextService.getSeData().seExperienceData}};Q=__decorate([n.Component({selector:"has-multicatalog",template:`\n        <div *ngIf="hasMulticatalog">\n            <ng-content></ng-content>\n        </div>\n    `}),__param(0,n.Inject(t.PersonalizationsmarteditContextService)),__metadata("design:paramtypes",[t.PersonalizationsmarteditContextService])],Q);let J=class PersonalizationsmarteditSharedComponentsModule{};J=__decorate([n.NgModule({imports:[m.CommonModule,d.TranslationModule.forChild(),d.SelectModule],declarations:[Q,Z,Y,K,$,W],entryComponents:[Q,Z,Y,K,$,W],exports:[Q,Z,Y,K,$,W],providers:[]})],J);let ee=class CustomizationDataFactory{constructor(e,t){this.personalizationsmarteditRestService=e;this.personalizationsmarteditUtils=t;this.items=[];this.defaultFilter={};this.defaultDataArrayName="customizations"}getCustomizations(e){return __awaiter(this,void 0,void 0,(function*(){try{const t=yield this.personalizationsmarteditRestService.getCustomizations(e);this.personalizationsmarteditUtils.uniqueArray(this.items,t[this.defaultDataArrayName]||[]);this.defaultSuccessCallbackFunction(t)}catch(e){this.defaultErrorCallbackFunction(e)}}))}updateData(e,t,i){e=e||{};this.defaultFilter=e.filter||this.defaultFilter;this.defaultDataArrayName=e.dataArrayName||this.defaultDataArrayName;if(t&&typeof t==="function"){this.defaultSuccessCallbackFunction=t}if(i&&typeof i==="function"){this.defaultErrorCallbackFunction=i}this.getCustomizations(this.defaultFilter)}refreshData(){if(this.defaultFilter==={}){return}const e=N.cloneDeep(this.defaultFilter);e.currentSize=this.items.length;e.currentPage=0;this.resetData();this.getCustomizations(e)}resetData(){this.items.length=0}};ee=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.PersonalizationsmarteditRestService,l.PersonalizationsmarteditUtils])],ee);let te=class PersonalizationsmarteditDataFactoryModule{};te=__decorate([n.NgModule({imports:[m.CommonModule,t.SePersonalizationsmarteditServicesModule],providers:[ee]})],te);t.CombinedViewModule=class CombinedViewModule{};t.CombinedViewModule=__decorate([n.NgModule({imports:[d.TranslationModule.forChild(),m.CommonModule,h.ButtonModule,d.SelectModule,d.TooltipModule,d.HelpModule,l.PersonalizationsmarteditCommonsComponentsModule,te,t.SePersonalizationsmarteditServicesModule,J],providers:[t.CombinedViewCommonsService,j],declarations:[H,G,t.CombinedViewMenuComponent],entryComponents:[H,G,t.CombinedViewMenuComponent]})],t.CombinedViewModule);window.__smartedit__.addDecoratorPayload("Component","ContextMenuDeleteActionComponent",{selector:"context-menu-delete-action",template:`<div id="confirmationModalDescription">\n        {{ 'personalization.modal.deleteaction.content' | translate }}\n    </div>`});let ie=class ContextMenuDeleteActionComponent{};ie=__decorate([n.Component({selector:"context-menu-delete-action",template:`<div id="confirmationModalDescription">\n        {{ 'personalization.modal.deleteaction.content' | translate }}\n    </div>`})],ie);window.__smartedit__.addDecoratorPayload("Component","ComponentDropdownItemPrinterComponent",{selector:"component-item-printer",template:`\n        <div class="pe-customize-component__se-select-choices-layout">\n            <div class="pe-customize-component__se-select-choices-col1">\n                <div class="perso-wrap-ellipsis" title="{{ data.item.name }}">\n                    {{ data.item.name }}\n                </div>\n            </div>\n            <div class="pe-customize-component__se-select-choices-col2">\n                <div class="perso-wrap-ellipsis" title="{{ data.item.typeCode }}">\n                    {{ data.item.typeCode }}\n                </div>\n            </div>\n        </div>\n    `});let oe=class ComponentDropdownItemPrinterComponent{constructor(e){this.data=e}};oe=__decorate([n.Component({selector:"component-item-printer",template:`\n        <div class="pe-customize-component__se-select-choices-layout">\n            <div class="pe-customize-component__se-select-choices-col1">\n                <div class="perso-wrap-ellipsis" title="{{ data.item.name }}">\n                    {{ data.item.name }}\n                </div>\n            </div>\n            <div class="pe-customize-component__se-select-choices-col2">\n                <div class="perso-wrap-ellipsis" title="{{ data.item.typeCode }}">\n                    {{ data.item.typeCode }}\n                </div>\n            </div>\n        </div>\n    `}),__param(0,n.Inject(d.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],oe);window.__smartedit__.addDecoratorPayload("Component","PersonalizationsmarteditContextMenuAddEditActionComponent",{template:`<div class="perso-customize-component"><div class="perso-customize-component__title-layout"><div *ngIf="letterIndicatorForElement" class="perso-customize-component__title-layout__letter-block"><span [ngClass]="colorIndicatorForElement">{{letterIndicatorForElement}}</span></div><div class="perso-customize-component__title-layout__cust-name perso-wrap-ellipsis" title="{{selectedCustomization.name}}">{{selectedCustomization.name}}</div><div class="perso-customize-component__title-layout__target-group-name perso-wrap-ellipsis" title="{{selectedVariation.name}}">{{'> '+ selectedVariation.name}}</div></div><dl class="perso-customize-component__data-list"><label fd-form-label for="perso-customize-component-type-desc">{{ "personalization.modal.addeditaction.selected.mastercomponent.title" | translate }}</label><dd id="perso-customize-component-type-desc">{{componentType}}</dd></dl><label fd-form-label class="se-control-label" [required]="true" for="perso-customize-component-action-select">{{ "personalization.modal.addeditaction.selected.actions.title" | translate }}</label><se-tooltip [placement]="'top-start'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true"><span class="sap-icon--question-mark sap-icon" style="margin-left: 10px; padding-top: 1px" se-tooltip-trigger></span><div se-tooltip-body [translate]="'personalization.modal.addeditaction.selected.actions.help.label'"></div></se-tooltip><se-select id="perso-customize-component-action-select" class="perso-customize-component__select2-container" [placeholder]="'personalization.modal.addeditaction.dropdown.placeholder'" [(model)]="actionSelected" [searchEnabled]="false" [showRemoveButton]="false" [fetchStrategy]="actionFetchStrategy"></se-select><div class="perso-customize-component__select-group-label-layout"><div *ngIf="actionSelected == 'use'"><label fd-form-label class="se-control-label" [required]="true" for="perso-customize-component-saved-component-select">{{ "personalization.modal.addeditaction.selected.component.title" | translate }}</label></div><has-multicatalog *ngIf="actionSelected == 'use'"><div class="perso-customize-component__filter-layout"><label fd-form-label class="perso-customize-component__filter-label" for="perso-customize-component-catalog-version-filter-dropdown">{{ 'personalization.commons.filter.label' | translate }}</label><catalog-version-filter-dropdown id="perso-customize-component-catalog-version-filter-dropdown" class="pe-customize-component__catalog-version-filter-dropdown" (onSelectCallback)="catalogVersionFilterChange($event)"></catalog-version-filter-dropdown></div></has-multicatalog></div><se-select id="perso-customize-component-saved-component-select" class="perso-customize-component__select2-container" *ngIf="actionSelected == 'use'" [placeholder]="'personalization.modal.addeditaction.dropdown.componentlist.placeholder'" [(model)]="idComponentSelected" [onSelect]="componentSelectedEvent" [searchEnabled]="true" [showRemoveButton]="false" [fetchStrategy]="componentsFetchStrategy" [itemComponent]="itemComponent"></se-select><se-select class="perso-customize-component__select2-container" *ngIf="actionSelected == 'create'" [placeholder]="'personalization.modal.addeditaction.dropdown.componenttype.placeholder'" [(model)]="newComponentSelected" [onSelect]="newComponentTypeSelectedEvent" [searchEnabled]="false" [fetchStrategy]="componentTypesFetchStrategy"></se-select></div>`});let ne=class PersonalizationsmarteditContextMenuAddEditActionComponent{constructor(e,t,i,o,s,a,r){this.modalManager=e;this.translateService=t;this.personalizationsmarteditRestService=i;this.personalizationsmarteditMessageHandler=o;this.personalizationsmarteditContextService=s;this.slotRestrictionsService=a;this.editorModalService=r;this.actionSelected="";this.idComponentSelected="";this.selectedCustomization={};this.selectedVariation={};this.newComponentSelected="";this.componentSelected={};this.actionCreated=new n.EventEmitter;this.itemComponent=oe;this.modalButtons=[{id:"submit",style:d.ModalButtonStyle.Primary,label:"personalization.modal.addeditaction.button.submit",action:d.ModalButtonAction.Close,disabledFn:()=>!Boolean(this.idComponentSelected)||Boolean(this.componentUuid)&&this.componentUuid===this.idComponentSelected,callback:()=>{this.idComponentSelected=undefined;const e=this.componentSelected.catalogVersion.substring(0,this.componentSelected.catalogVersion.indexOf("/"));const t={catalog:this.selectedCustomization.catalog,catalogVersion:this.selectedCustomization.catalogVersion};const i={slotCatalog:this.slotCatalog,oldComponentCatalog:this.componentCatalog};Object.assign(i,t);if(this.editEnabled){this.editAction(this.selectedCustomization.code,this.selectedVariation.code,this.actionId,this.componentSelected.uid,e,t)}else{this.personalizationsmarteditRestService.replaceComponentWithContainer(this.defaultComponentId,this.slotId,i).then((i=>{this.addActionToContainer(this.componentSelected.uid,e,i.sourceId,this.selectedCustomization.code,this.selectedVariation.code,t)}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.replacingcomponent"))}))}return this.actionCreated}},{id:"cancel",label:"personalization.modal.addeditaction.button.cancel",style:d.ModalButtonStyle.Default,action:d.ModalButtonAction.Dismiss}];this.initNewComponentTypes=()=>this.slotRestrictionsService.getSlotRestrictions(this.slotId).then((e=>this.personalizationsmarteditRestService.getNewComponentTypes().then((t=>{this.newComponentTypes=t.componentTypes.filter((t=>e.indexOf(t.code)>-1)).map((e=>{e.id=e.code;return e}));return this.newComponentTypes}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcomponentstypes"))}))),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingslotrestrictions"))}));this.getAndSetComponentById=e=>{this.personalizationsmarteditRestService.getComponent(e).then((e=>{this.idComponentSelected=e.uuid}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcomponents"))}))};this.getAndSetColorAndLetter=()=>{const e=this.personalizationsmarteditContextService.getCombinedView();if(e.enabled){(e.selectedItems||[]).forEach(((e,t)=>{let i=this.selectedCustomizationCode===e.customization.code;i=i&&this.selectedVariationCode===e.variation.code;const o=t%Object.keys(l.PERSONALIZATION_COMBINED_VIEW_CSS_MAPPING).length;if(i){this.letterIndicatorForElement=String.fromCharCode("a".charCodeAt(0)+o).toUpperCase();this.colorIndicatorForElement=l.PERSONALIZATION_COMBINED_VIEW_CSS_MAPPING[o].listClass}}))}};this.componentSelectedEvent=e=>{if(!e){return}this.componentSelected=e;this.idComponentSelected=e.uuid};this.newComponentTypeSelectedEvent=e=>{if(!e){return}const t={smarteditComponentType:e.code,catalogVersionUuid:this.personalizationsmarteditContextService.getSeData().seExperienceData.pageContext.catalogVersionUuid};this.editorModalService.open(t).then((e=>{this.actionSelected=this.actions.filter((e=>e.id==="use"))[0].id;this.idComponentSelected=e.uuid;this.componentSelected=e}),(()=>{this.newComponentSelected=""}))};this.editAction=(e,t,i,o,n,s)=>{this.personalizationsmarteditRestService.editAction(e,t,i,o,n,s).then((()=>{this.personalizationsmarteditMessageHandler.sendSuccess(this.translateService.instant("personalization.info.updatingaction"));this.actionCreated.emit()}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.updatingaction"));this.actionCreated.emit()}))};this.addActionToContainer=(e,t,i,o,n,s)=>{this.personalizationsmarteditRestService.addActionToContainer(e,t,i,o,n,s).then((()=>{this.personalizationsmarteditMessageHandler.sendSuccess(this.translateService.instant("personalization.info.creatingaction"));this.actionCreated.emit(i)}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.creatingaction"));this.actionCreated.emit()}))};this.catalogVersionFilterChange=e=>{if(!e){return}const t=e.split("/");this.catalogFilter=t[0];this.catalogVersionFilter=t[1]};this.components=[];this.modalManager.addButton(this.modalButtons[0]);this.modalManager.addButton(this.modalButtons[1]);this.actionFetchStrategy={fetchAll:()=>Promise.resolve(this.actions)};this.componentsFetchStrategy={fetchPage:(e,t,i)=>this.componentTypesFetchStrategy.fetchAll().then((t=>{const o=t.map((e=>e.code)).join(",");const n={currentPage:i,mask:e,typeCodes:o,pageSize:30,sort:"name",catalog:this.catalogFilter,catalogVersion:this.catalogVersionFilter};return this.personalizationsmarteditRestService.getComponents(n).then((e=>{const t=e.response.filter((e=>!e.restricted));return Promise.resolve({results:t,pagination:e.pagination})}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcomponents"));return Promise.reject()}))})),fetchEntity:e=>this.personalizationsmarteditRestService.getComponent(e).then((e=>Promise.resolve({id:e.uuid,name:e.name,typeCode:e.typeCode})))};this.componentTypesFetchStrategy={fetchAll:()=>{if(this.newComponentTypes){return Promise.resolve(this.newComponentTypes)}else{return this.initNewComponentTypes()}}}}get modalData(){return this.modalManager.getModalData()}ngOnInit(){this.init()}init(){this.actions=[{id:"create",name:this.translateService.instant("personalization.modal.addeditaction.createnewcomponent")},{id:"use",name:this.translateService.instant("personalization.modal.addeditaction.usecomponent")}];this.modalData.subscribe((e=>{this.colorIndicatorForElement=e.colorIndicatorForElement;this.slotId=e.slotId;this.actionId=e.actionId;this.componentUuid=e.componentUuid;this.defaultComponentId=e.componentId;this.editEnabled=e.editEnabled;this.slotCatalog=e.slotCatalog;this.componentCatalog=e.componentCatalog;this.selectedCustomizationCode=e.selectedCustomizationCode;this.selectedVariationCode=e.selectedVariationCode;this.componentType=e.componentType;this.personalizationsmarteditRestService.getCustomization({code:this.selectedCustomizationCode}).then((e=>{this.selectedCustomization=e;this.selectedVariation=e.variations.filter((e=>e.code===this.selectedVariationCode))[0]}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcustomization"))}));if(this.editEnabled){this.getAndSetComponentById(this.componentUuid);this.actionSelected=this.actions.filter((e=>e.id==="use"))[0].id}else{this.actionSelected=""}}));this.initNewComponentTypes();this.getAndSetColorAndLetter()}};ne=__decorate([n.Component({template:`<div class="perso-customize-component"><div class="perso-customize-component__title-layout"><div *ngIf="letterIndicatorForElement" class="perso-customize-component__title-layout__letter-block"><span [ngClass]="colorIndicatorForElement">{{letterIndicatorForElement}}</span></div><div class="perso-customize-component__title-layout__cust-name perso-wrap-ellipsis" title="{{selectedCustomization.name}}">{{selectedCustomization.name}}</div><div class="perso-customize-component__title-layout__target-group-name perso-wrap-ellipsis" title="{{selectedVariation.name}}">{{'> '+ selectedVariation.name}}</div></div><dl class="perso-customize-component__data-list"><label fd-form-label for="perso-customize-component-type-desc">{{ "personalization.modal.addeditaction.selected.mastercomponent.title" | translate }}</label><dd id="perso-customize-component-type-desc">{{componentType}}</dd></dl><label fd-form-label class="se-control-label" [required]="true" for="perso-customize-component-action-select">{{ "personalization.modal.addeditaction.selected.actions.title" | translate }}</label><se-tooltip [placement]="'top-start'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true"><span class="sap-icon--question-mark sap-icon" style="margin-left: 10px; padding-top: 1px" se-tooltip-trigger></span><div se-tooltip-body [translate]="'personalization.modal.addeditaction.selected.actions.help.label'"></div></se-tooltip><se-select id="perso-customize-component-action-select" class="perso-customize-component__select2-container" [placeholder]="'personalization.modal.addeditaction.dropdown.placeholder'" [(model)]="actionSelected" [searchEnabled]="false" [showRemoveButton]="false" [fetchStrategy]="actionFetchStrategy"></se-select><div class="perso-customize-component__select-group-label-layout"><div *ngIf="actionSelected == 'use'"><label fd-form-label class="se-control-label" [required]="true" for="perso-customize-component-saved-component-select">{{ "personalization.modal.addeditaction.selected.component.title" | translate }}</label></div><has-multicatalog *ngIf="actionSelected == 'use'"><div class="perso-customize-component__filter-layout"><label fd-form-label class="perso-customize-component__filter-label" for="perso-customize-component-catalog-version-filter-dropdown">{{ 'personalization.commons.filter.label' | translate }}</label><catalog-version-filter-dropdown id="perso-customize-component-catalog-version-filter-dropdown" class="pe-customize-component__catalog-version-filter-dropdown" (onSelectCallback)="catalogVersionFilterChange($event)"></catalog-version-filter-dropdown></div></has-multicatalog></div><se-select id="perso-customize-component-saved-component-select" class="perso-customize-component__select2-container" *ngIf="actionSelected == 'use'" [placeholder]="'personalization.modal.addeditaction.dropdown.componentlist.placeholder'" [(model)]="idComponentSelected" [onSelect]="componentSelectedEvent" [searchEnabled]="true" [showRemoveButton]="false" [fetchStrategy]="componentsFetchStrategy" [itemComponent]="itemComponent"></se-select><se-select class="perso-customize-component__select2-container" *ngIf="actionSelected == 'create'" [placeholder]="'personalization.modal.addeditaction.dropdown.componenttype.placeholder'" [(model)]="newComponentSelected" [onSelect]="newComponentTypeSelectedEvent" [searchEnabled]="false" [fetchStrategy]="componentTypesFetchStrategy"></se-select></div>`}),__param(0,n.Inject(d.ModalManagerService)),__param(1,n.Inject(g.TranslateService)),__param(2,n.Inject(t.PersonalizationsmarteditRestService)),__param(3,n.Inject(l.PersonalizationsmarteditMessageHandler)),__param(4,n.Inject(t.PersonalizationsmarteditContextService)),__metadata("design:paramtypes",[d.ModalManagerService,g.TranslateService,t.PersonalizationsmarteditRestService,l.PersonalizationsmarteditMessageHandler,t.PersonalizationsmarteditContextService,d.ISlotRestrictionsService,d.IEditorModalService])],ne);const se=[{id:"confirmOk",label:"personalization.modal.deleteaction.button.ok",style:d.ModalButtonStyle.Primary,action:d.ModalButtonAction.Close},{id:"confirmCancel",label:"personalization.modal.deleteaction.button.cancel",style:d.ModalButtonStyle.Default,action:d.ModalButtonAction.Dismiss}];t.PersonalizationsmarteditContextMenuServiceProxy=class PersonalizationsmarteditContextMenuServiceProxy extends l.IPersonalizationsmarteditContextMenuServiceProxy{constructor(e,t,i,o,n,s,a,r){super();this.modalService=e;this.renderService=t;this.editorModalService=i;this.personalizationsmarteditContextService=o;this.personalizationsmarteditRestService=n;this.personalizationsmarteditMessageHandler=s;this.translateService=a;this.logService=r}openDeleteAction(e){return __awaiter(this,void 0,void 0,(function*(){if(!(yield this.confirmDelete())){return}yield this.deleteContext(e);const t=this.personalizationsmarteditContextService.getCombinedView();if(t.enabled){try{const i=yield this.personalizationsmarteditRestService.getActions(e.selectedCustomizationCode,e.selectedVariationCode,e);if(t.customize.selectedComponents){t.customize.selectedComponents=this.removeItemFromCollection(t.customize.selectedComponents,e.containerSourceId)}t.selectedItems=this.addActionsToVariation(t.selectedItems,e,i.actions);this.personalizationsmarteditContextService.setCombinedView(t)}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingactions"))}}else{const t=this.personalizationsmarteditContextService.getCustomize();t.selectedComponents=this.removeItemFromCollection(t.selectedComponents,e.containerSourceId);this.personalizationsmarteditContextService.setCustomize(t)}this.renderService.renderSlots(e.slotsToRefresh)}))}openAddAction(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.modalService.open({component:ne,data:e,templateConfig:{title:"personalization.modal.addaction.title",isDismissButtonVisible:true},config:{focusTrapped:false,backdropClickCloseable:false,dialogPanelClass:"yPersonalizationContextModal"}}).afterClosed.toPromise();const i=this.personalizationsmarteditContextService.getCombinedView();if(i.enabled){i.customize.selectedComponents.push(t);this.personalizationsmarteditContextService.setCombinedView(i)}else{const e=this.personalizationsmarteditContextService.getCustomize();e.selectedComponents.push(t);this.personalizationsmarteditContextService.setCustomize(e)}this.renderService.renderSlots(e.slotsToRefresh)}))}openEditAction(e){return __awaiter(this,void 0,void 0,(function*(){e.editEnabled=true;yield this.modalService.open({component:ne,data:e,templateConfig:{title:"personalization.modal.editaction.title",isDismissButtonVisible:true},config:{focusTrapped:false,backdropClickCloseable:false,dialogPanelClass:"yPersonalizationContextModal"}}).afterClosed.toPromise();this.renderService.renderSlots(e.slotsToRefresh)}))}openEditComponentAction(e){this.editorModalService.open(e)}deleteContext(e){return __awaiter(this,void 0,void 0,(function*(){const t={catalog:e.catalog,catalogVersion:e.catalogVersion};try{yield this.personalizationsmarteditRestService.deleteAction(e.selectedCustomizationCode,e.selectedVariationCode,e.actionId,t)}catch(e){this.logService.error("An error occurred while deleting context",e)}}))}removeItemFromCollection(e,t){return e.filter((e=>e!==t))}addActionsToVariation(e,t,i){return e.map((e=>{if(e.customization.code===t.selectedCustomizationCode&&e.variation.code===t.selectedVariationCode){e.variation.actions=i}return e}))}confirmDelete(){return __awaiter(this,void 0,void 0,(function*(){try{yield this.modalService.open({component:ie,config:{dialogPanelClass:"yFrontModal modal-md"},templateConfig:{buttons:se,title:"personalization.modal.deleteaction.title"}}).afterClosed.toPromise();return true}catch(e){return false}}))}};t.PersonalizationsmarteditContextMenuServiceProxy=__decorate([d.GatewayProxied("openDeleteAction","openAddAction","openEditAction","openEditComponentAction"),n.Injectable(),__metadata("design:paramtypes",[d.IModalService,d.IRenderService,d.IEditorModalService,t.PersonalizationsmarteditContextService,t.PersonalizationsmarteditRestService,l.PersonalizationsmarteditMessageHandler,g.TranslateService,d.LogService])],t.PersonalizationsmarteditContextMenuServiceProxy);let ae=class PersonalizationsmarteditContextMenuModule{};ae=__decorate([n.NgModule({imports:[m.CommonModule,d.TranslationModule.forChild(),d.SharedComponentsModule,v.FormModule,f.InlineHelpModule,d.SelectModule,d.TooltipModule,J],declarations:[ne,oe,ie],entryComponents:[ne,oe,ie],exports:[ne,oe]})],ae);t.CustomizeViewServiceProxy=class CustomizeViewServiceProxy{getSourceContainersInfo(){"proxyFunction";return null}};t.CustomizeViewServiceProxy=__decorate([d.GatewayProxied("getSourceContainersInfo"),n.Injectable()],t.CustomizeViewServiceProxy);const re={name:"",enabledStartDate:"",enabledEndDate:"",status:l.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED,statusBoolean:true,variations:[],catalog:"",catalogVersion:"",code:"",rank:null};const le={customization:re,visibleVariations:[]};t.CustomizationViewService=class CustomizationViewService{constructor(e){this.persoUtils=e;this.editVariationActionSubject=new u.BehaviorSubject(undefined);this.stateSubject=new u.BehaviorSubject(le)}getState$(){return this.stateSubject.asObservable()}getState(){return this.stateSubject.getValue()}setState(e){this.stateSubject.next(e)}addVariation(e){const t=this.selectCustomization();const i=[...t.variations,e];this.setVariations(i)}setVariations(e){const t=this.selectCustomization();t.variations=e.map(((e,t)=>{e.rank=t;return e}));this.setState(this.prepareState(t))}setCustomization(e){this.setState(this.prepareState(e))}getCustomization$(){return this.getState$().pipe(_.map((e=>e.customization)))}editVariationAction(e){this.editVariationActionSubject.next(e)}editVariationAction$(){return this.editVariationActionSubject.asObservable()}selectCustomization(){return this.getState().customization}selectVisibleVariations(){return this.getState().visibleVariations}selectVariationByCode(e){return this.getState().customization.variations.find((t=>t.code===e))}prepareState(e){return{customization:e,visibleVariations:this.persoUtils.getVisibleItems(e.variations)}}};t.CustomizationViewService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.PersonalizationsmarteditUtils])],t.CustomizationViewService);window.__smartedit__.addDecoratorPayload("Component","BasicInfoTabComponent",{selector:"basic-info-tab",template:`<div class="pe-customization-modal" *ngIf="(customization$ | async) as customization"><form><div fd-form-item><label fd-form-label [required]="true" for="customization-name" class="se-control-label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.name' | translate }}</label> <input fd-form-control type="text" [placeholder]="'personalization.modal.customizationvariationmanagement.basicinformationtab.name.placeholder' | translate" [name]="customization.name + '_key'" [ngModel]="customization.name" (ngModelChange)="changeName($event)" id="customization-name"/></div><div fd-form-item><label fd-form-label for="customization-description" class="se-control-label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.details' | translate }}</label> <textarea fd-form-control rows="2" class="fd-form__control pe-customization-modal__textarea" [placeholder]="'personalization.modal.customizationvariationmanagement.basicinformationtab.details.placeholder' | translate" [name]="customization.description + '_key'" [ngModel]="customization.description" (ngModelChange)="changeDescription($event)" id="customization-description"></textarea></div><div fd-form-item class="fd-has-padding-bottom-tiny"><label fd-form-label for="customization-status" class="se-control-label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.status' | translate }}</label><fd-switch [compact]="true" [ngModel]="customization.statusBoolean" id="test-checkbox" (ngModelChange)="toggleCustomizationStatus($event)"></fd-switch></div><div fd-form-item><div><button *ngIf="!datetimeConfigurationEnabled" class="se-button--text se-button--link fd-link" (click)="toggleDatetimeConfiguration()" type="button" translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.showdateconfigdata"></button> <button *ngIf="datetimeConfigurationEnabled" class="se-button--text se-button--link fd-link" (click)="toggleDatetimeConfiguration(true)" type="button" translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.hidedateconfigdata"></button></div><div translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.statusfortimeframe.description" class="fd-has-padding-top-tiny"></div></div><div fd-form-item><datetime-picker-range *ngIf="datetimeConfigurationEnabled" [dateFrom]="customization.enabledStartDate" [dateTo]="customization.enabledEndDate" [isEditable]="true" (dateFromChange)="onEnabledStartDateChange($event)" (dateToChange)="onEnabledEndDateChange($event)"></datetime-picker-range></div></form></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});t.BasicInfoTabComponent=class BasicInfoTabComponent{constructor(e,t){this.customizationViewService=e;this.cdr=t;this.datetimeConfigurationEnabled=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.customization$=this.customizationViewService.getCustomization$();const e=yield this.customizationViewService.getCustomization$().pipe(_.take(1)).toPromise();this.datetimeConfigurationEnabled=!!e.enabledStartDate||!!e.enabledEndDate;this.cdr.detectChanges()}))}changeName(e){const t=this.customizationViewService.selectCustomization();this.customizationViewService.setCustomization(Object.assign(Object.assign({},t),{name:e}))}changeDescription(e){const t=this.customizationViewService.selectCustomization();this.customizationViewService.setCustomization(Object.assign(Object.assign({},t),{description:e}))}toggleDatetimeConfiguration(e=false){this.datetimeConfigurationEnabled=!this.datetimeConfigurationEnabled;if(e){this.resetDatetimeConfiguration()}}toggleCustomizationStatus(e){const t=this.customizationViewService.selectCustomization();this.customizationViewService.setCustomization(Object.assign(Object.assign({},t),{statusBoolean:e,status:e?l.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED:l.PERSONALIZATION_MODEL_STATUS_CODES.DISABLED}))}onEnabledStartDateChange(e){const t=this.customizationViewService.selectCustomization();this.customizationViewService.setCustomization(Object.assign(Object.assign({},t),{enabledStartDate:e}))}onEnabledEndDateChange(e){const t=this.customizationViewService.selectCustomization();this.customizationViewService.setCustomization(Object.assign(Object.assign({},t),{enabledEndDate:e}))}resetDatetimeConfiguration(){const e=this.customizationViewService.selectCustomization();this.customizationViewService.setCustomization(Object.assign(Object.assign({},e),{enabledStartDate:undefined,enabledEndDate:undefined}))}};t.BasicInfoTabComponent=__decorate([n.Component({selector:"basic-info-tab",template:`<div class="pe-customization-modal" *ngIf="(customization$ | async) as customization"><form><div fd-form-item><label fd-form-label [required]="true" for="customization-name" class="se-control-label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.name' | translate }}</label> <input fd-form-control type="text" [placeholder]="'personalization.modal.customizationvariationmanagement.basicinformationtab.name.placeholder' | translate" [name]="customization.name + '_key'" [ngModel]="customization.name" (ngModelChange)="changeName($event)" id="customization-name"/></div><div fd-form-item><label fd-form-label for="customization-description" class="se-control-label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.details' | translate }}</label> <textarea fd-form-control rows="2" class="fd-form__control pe-customization-modal__textarea" [placeholder]="'personalization.modal.customizationvariationmanagement.basicinformationtab.details.placeholder' | translate" [name]="customization.description + '_key'" [ngModel]="customization.description" (ngModelChange)="changeDescription($event)" id="customization-description"></textarea></div><div fd-form-item class="fd-has-padding-bottom-tiny"><label fd-form-label for="customization-status" class="se-control-label">{{ 'personalization.modal.customizationvariationmanagement.basicinformationtab.status' | translate }}</label><fd-switch [compact]="true" [ngModel]="customization.statusBoolean" id="test-checkbox" (ngModelChange)="toggleCustomizationStatus($event)"></fd-switch></div><div fd-form-item><div><button *ngIf="!datetimeConfigurationEnabled" class="se-button--text se-button--link fd-link" (click)="toggleDatetimeConfiguration()" type="button" translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.showdateconfigdata"></button> <button *ngIf="datetimeConfigurationEnabled" class="se-button--text se-button--link fd-link" (click)="toggleDatetimeConfiguration(true)" type="button" translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.hidedateconfigdata"></button></div><div translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.statusfortimeframe.description" class="fd-has-padding-top-tiny"></div></div><div fd-form-item><datetime-picker-range *ngIf="datetimeConfigurationEnabled" [dateFrom]="customization.enabledStartDate" [dateTo]="customization.enabledEndDate" [isEditable]="true" (dateFromChange)="onEnabledStartDateChange($event)" (dateToChange)="onEnabledEndDateChange($event)"></datetime-picker-range></div></form></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[t.CustomizationViewService,n.ChangeDetectorRef])],t.BasicInfoTabComponent);let ce=class ModalFullScreenButtonService{constructor(e){this.className="sliderPanelParentModal";this.renderer=e.createRenderer(null,null)}toggleClassOnCustomizationModal(e,t,i){const o=this.findModal(e);if(!o){return}if(i){this.renderer.addClass(o,t)}else{this.renderer.removeClass(o,t)}}findModal(e){return e.closest(`.${this.className}`)}};ce=__decorate([n.Injectable(),__metadata("design:paramtypes",[n.RendererFactory2])],ce);window.__smartedit__.addDecoratorPayload("Component","ModalFullScreenButtonComponent",{selector:"perso-modal-full-screen-button",template:`<button class="fd-button fd-button--light pe-customization-modal__sliderpanel__btn-link" (click)="toggle()"><fd-icon class="icon_padding_end" *ngIf="!isFullscreen" glyph="full-screen"></fd-icon><fd-icon class="icon_padding_end" *ngIf="isFullscreen" glyph="exitfullscreen"></fd-icon>{{(isFullscreen ? 'personalization.modal.customizationvariationmanagement.targetgrouptab.fullscreen.close' : 'personalization.modal.customizationvariationmanagement.targetgrouptab.fullscreen.open') | translate}}</button>`,changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[ce]});let de=class ModalFullScreenButtonComponent{constructor(e,t){this.element=e;this.modalFullScreenButtonService=t;this.isFullscreen=false}toggle(e){this.isFullscreen=typeof e==="undefined"?!this.isFullscreen:e;this.modalFullScreenButtonService.toggleClassOnCustomizationModal(this.element.nativeElement,"modal-fullscreen",this.isFullscreen)}};de=__decorate([n.Component({selector:"perso-modal-full-screen-button",template:`<button class="fd-button fd-button--light pe-customization-modal__sliderpanel__btn-link" (click)="toggle()"><fd-icon class="icon_padding_end" *ngIf="!isFullscreen" glyph="full-screen"></fd-icon><fd-icon class="icon_padding_end" *ngIf="isFullscreen" glyph="exitfullscreen"></fd-icon>{{(isFullscreen ? 'personalization.modal.customizationvariationmanagement.targetgrouptab.fullscreen.close' : 'personalization.modal.customizationvariationmanagement.targetgrouptab.fullscreen.open') | translate}}</button>`,changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[ce]}),__metadata("design:paramtypes",[n.ElementRef,ce])],de);let pe=class ModalFullScreenButtonModule{};pe=__decorate([n.NgModule({imports:[E.FundamentalNgxCoreModule,m.CommonModule,d.TranslationModule.forChild()],providers:[ce],declarations:[de],exports:[de]})],pe);window.__smartedit__.addDecoratorPayload("Component","EditVariationItemComponent",{selector:"perso-edit-variation-item",template:`\n        <a\n            (click)="editVariation()"\n            class="se-dropdown-item fd-list__link"\n            translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.edit"\n        ></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush});let me=class EditVariationItemComponent{constructor(e,t){this.customizationViewService=t;({selectedItem:this.selectedItem}=e)}editVariation(){this.customizationViewService.editVariationAction(this.selectedItem.variation)}};me=__decorate([n.Component({selector:"perso-edit-variation-item",template:`\n        <a\n            (click)="editVariation()"\n            class="se-dropdown-item fd-list__link"\n            translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.edit"\n        ></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(d.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,t.CustomizationViewService])],me);t.TriggerService=class TriggerService{constructor(){this.actions=[{id:l.TriggerActionId.AND,name:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.and"},{id:l.TriggerActionId.OR,name:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.or"},{id:l.TriggerActionId.NOT,name:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.not"}];this.supportedTypes=[l.TriggerType.DEFAULT_TRIGGER,l.TriggerType.SEGMENT_TRIGGER,l.TriggerType.EXPRESSION_TRIGGER]}isContainer(e){return this.isElementOfType(e,l.TriggerType.CONTAINER_TYPE)}isEmptyContainer(e){return this.isContainer(e)&&e.nodes.length===0}isNotEmptyContainer(e){return this.isContainer(e)&&e.nodes.length>0}isDropzone(e){return this.isElementOfType(e,l.TriggerType.DROPZONE_TYPE)}isItem(e){return this.isElementOfType(e,l.TriggerType.ITEM_TYPE)}isValidExpression(e){if(!e){return false}if(this.isContainer(e)){return e.nodes&&e.nodes.length>0&&e.nodes.every((e=>this.isValidExpression(e)))}else{return e.selectedSegment!==undefined}}buildTriggers(e,t){let i={};if(this.isDefaultData(e)){i=this.buildDefaultTrigger()}else if(!!(e===null||e===void 0?void 0:e.expression)&&e.expression.length>0){const t=e.expression[0];if(this.isEmptyContainer(t)){i={}}else if(this.isExpressionData(t)){i=this.buildExpressionTrigger(t)}else{i=this.buildSegmentTrigger(t)}}return this.mergeTriggers(t,i)}buildData(e){let t={};let i=this.getBaseData();if(e&&Array.isArray(e)&&e.length>0){t=e.filter((e=>this.isSupportedTrigger(e)))[0]}if(this.isDefaultTrigger(t));else if(this.isExpressionTrigger(t)){i=this.buildExpressionTriggerData(t)}else if(this.isSegmentTrigger(t)){i=this.buildSegmentTriggerData(t)}return i}isDefault(e){const t=(e||[]).filter((e=>this.isDefaultTrigger(e)))[0];return e&&t?true:false}getExpressionAsString(e){let t="";if(e===undefined){return t}const i=this.getCurrOperator(e);t=this.getRetStr(t,e)+"(";if(this.isEmptyContainer(e)){t+=" [] "}else{e.nodes.forEach(((e,o)=>{if(this.isEmptyContainer(e)){t=this.getEmptyEleContainerRetStr(t,o,i)}else{t=this.getNonEmptyEleContainerRetStr(t,o,i);t+=this.isItem(e)?e.selectedSegment.code:this.getExpressionAsString(e)}}))}t+=")";return t}getCurrOperator(e){return this.isNegation(e)?"AND":e.operation.id}getRetStr(e,t){e+=this.isNegation(t)?" NOT ":"";return e}getEmptyEleContainerRetStr(e,t,i){const o=" ";const n=" ( [] )";const s="( [] )";e+=t>0?o+i+n:s;return e}getNonEmptyEleContainerRetStr(e,t,i){const o=" ";e+=t>0?o+i+o:"";return e}isElementOfType(e,t){return typeof e!=="undefined"?e.type===t:false}isNegation(e){return this.isContainer(e)&&e.operation.id==="NOT"}isDefaultData(e){return!!(e===null||e===void 0?void 0:e.isDefault)}isExpressionData(e){return e.operation.id===l.TriggerActionId.NOT||e.nodes.some((e=>!this.isItem(e)))}isSupportedTrigger(e){return this.supportedTypes.indexOf(e.type)>=0}isDefaultTrigger(e){return this.isElementOfType(e,l.TriggerType.DEFAULT_TRIGGER)}isSegmentTrigger(e){return this.isElementOfType(e,l.TriggerType.SEGMENT_TRIGGER)}isExpressionTrigger(e){return this.isElementOfType(e,l.TriggerType.EXPRESSION_TRIGGER)}isGroupExpressionData(e){return this.isElementOfType(e,l.TriggerType.GROUP_EXPRESSION)}isSegmentExpressionData(e){return this.isElementOfType(e,l.TriggerType.SEGMENT_EXPRESSION)}isNegationExpressionData(e){return this.isElementOfType(e,l.TriggerType.NEGATION_EXPRESSION)}buildSegmentsForTrigger(e){return e.nodes.filter((e=>this.isItem(e))).map((e=>e.selectedSegment))}buildExpressionForTrigger(e){if(this.isNegation(e)){const t=[];e.nodes.forEach((e=>{t.push(this.buildExpressionForTrigger(e))}));return{type:l.TriggerType.NEGATION_EXPRESSION,element:{type:l.TriggerType.GROUP_EXPRESSION,operator:l.TriggerActionId.AND,elements:t}}}else if(this.isContainer(e)){const t=[];e.nodes.forEach((e=>{t.push(this.buildExpressionForTrigger(e))}));return{type:l.TriggerType.GROUP_EXPRESSION,operator:e.operation.id,elements:t}}else{return{type:l.TriggerType.SEGMENT_EXPRESSION,code:e.selectedSegment.code}}}buildDefaultTrigger(){return{type:l.TriggerType.DEFAULT_TRIGGER}}buildExpressionTrigger(e){return{type:l.TriggerType.EXPRESSION_TRIGGER,expression:this.buildExpressionForTrigger(e)}}buildSegmentTrigger(e){return{type:l.TriggerType.SEGMENT_TRIGGER,groupBy:e.operation.id,segments:this.buildSegmentsForTrigger(e)}}mergeTriggers(e,t){if(typeof e==="undefined"){return[t]}const i=e.findIndex((e=>e.type===t.type));if(i>=0){t.code=e[i].code}const o=e.filter((e=>!this.isSupportedTrigger(e)));o.push(t);return o}buildContainer(e){const t=this.actions.filter((t=>t.id===e))[0];return{type:l.TriggerType.CONTAINER_TYPE,operation:t,nodes:[],uid:d.stringUtils.generateIdentifier()}}buildItem(e){return{type:l.TriggerType.ITEM_TYPE,operation:null,selectedSegment:{code:e},nodes:[],uid:d.stringUtils.generateIdentifier()}}getBaseData(){const e=this.buildContainer(l.TriggerActionId.AND);return[e]}buildExpressionFromTrigger(e){let t;if(this.isGroupExpressionData(e)){t=this.buildContainer(e.operator);t.nodes=e.elements.map((e=>this.buildExpressionFromTrigger(e)))}else if(this.isNegationExpressionData(e)){t=this.buildContainer(l.TriggerActionId.NOT);const i=this.buildExpressionFromTrigger(e.element);if(this.isGroupExpressionData(e.element)&&e.element.operator==="AND"){t.nodes=i.nodes}else{t.nodes.push(i)}}else if(this.isSegmentExpressionData(e)){t=this.buildItem(e.code)}return t}buildSegmentTriggerData(e){const t=this.buildContainer(e.groupBy);e.segments.forEach((e=>{t.nodes.push(this.buildItem(e.code))}));return[t]}buildExpressionTriggerData(e){const t=this.buildExpressionFromTrigger(e.expression);return[t]}};t.TriggerService=__decorate([n.Injectable()],t.TriggerService);window.__smartedit__.addDecoratorPayload("Component","TargetGroupTabComponent",{selector:"perso-target-group-tab",template:`<div class="pe-customization-modal" *ngIf="customization"><div class="pe-customization-modal__title"><div class="pe-customization-modal__title-header"><div class="pe-customization-modal__title-header-name perso-wrap-ellipsis" [attr.title]="customization.name">{{ customization.name }}</div><div><span class="pe-customization-modal__title-header-badge badge badge-success" [ngClass]="[getActivityStateForCustomization(customization)]">{{'personalization.modal.customizationvariationmanagement.targetgrouptab.customization.' + customization.status | lowercase | translate}}</span></div></div><div class="pe-customization-modal__title-subarea"><div *ngIf="isCustomizationEnabled(customization)" class="pe-customization-modal__title-dates"><span *ngIf="!customization.enabledStartDate && customization.enabledEndDate">...</span> <span [ngClass]="{'perso__datetimepicker--error-text': !persoDateUtils.isDateValidOrEmpty(customization.enabledStartDate)}">{{ customization.enabledStartDate }}</span> <span *ngIf="customization.enabledStartDate || customization.enabledEndDate">- </span><span [ngClass]="{'perso__datetimepicker--error-text':!persoDateUtils.isDateValidOrEmpty(customization.enabledEndDate)}">{{ customization.enabledEndDate }}</span> <span *ngIf="persoDateUtils.isDateInThePast(customization.enabledEndDate)" class="section-help help-inline help-inline--section help-inline--tooltip"><span class="pe-datetime__warning-icon"></span> <span class="pe-help-block--inline help-block-inline help-block-inline--text" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.datetooltip"></span> </span><span *ngIf="customization.enabledStartDate && !customization.enabledEndDate">...</span></div></div></div><div class="pe-customization-modal__y-add-btn"><button fd-button label="{{ 'personalization.modal.customizationvariationmanagement.targetgrouptab.addtargetgroup.button' | translate }}" (click)="showAddVariationPanel()"></button></div><perso-target-group-variation-list *ngIf="visibleVariations.length > 0" [customization]="customization" [variations]="visibleVariations"></perso-target-group-variation-list><se-slider-panel [sliderPanelConfiguration]="sliderPanelConfiguration" [(sliderPanelHide)]="sliderPanelHide" [(sliderPanelShow)]="sliderPanelShow" class="pe-customization-modal__sliderpanel"><div *ngIf="isVariationLoaded"><div class="pe-customization-modal__sliderpanel__btn-layout"><perso-modal-full-screen-button></perso-modal-full-screen-button></div><div fd-form-item><label fd-form-label for="targetgroup-name" [required]="true">{{ 'personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupname' | translate }}</label> <input fd-form-control type="text" name="variationname_key" id="targetgroup-name" class="fd-form__control" [placeholder]="'personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupname.placeholder' | translate" [(ngModel)]="edit.name"/></div><fd-checkbox label="{{ 'personalization.modal.customizationvariationmanagement.targetgrouptab.variation.default' | translate }}" [(ngModel)]="edit.isDefault" (ngModelChange)="showConfirmForDefaultTrigger($event)" id="targetgroup-isDefault-001"></fd-checkbox><div *ngIf="edit.showExpression"><segment-view [targetGroupState]="edit" (expressionChange)="onSegmentViewExpressionChange($event)"></segment-view></div></div></se-slider-panel></div>`});let ge=class TargetGroupTabComponent{constructor(e,t,i,o,n,s,a){this.persoDateUtils=e;this.persoUtils=t;this.persoTriggerService=i;this.confirmationModalService=o;this.customizationViewService=n;this.logService=s;this.cdr=a;this.visibleVariations=[];this.isVariationLoaded=false;this.isFullscreen=false;this.sliderPanelConfiguration={modal:{showDismissButton:true,title:"personalization.modal.customizationvariationmanagement.targetgrouptab.slidingpanel.title",cancel:{label:"personalization.modal.customizationvariationmanagement.targetgrouptab.cancelchanges",onClick:()=>{this.cancelChangesClick()},isDisabledFn:()=>false},dismiss:{onClick:()=>{this.cancelChangesClick()},label:"",isDisabledFn:()=>false},save:{onClick:()=>{},label:"",isDisabledFn:()=>false}},cssSelector:"#y-modal-dialog"};this.edit={code:"",name:"",expression:[],isDefault:false,showExpression:true,selectedVariation:undefined}}ngOnInit(){this.customizationViewStateSubscription=this.customizationViewService.getState$().subscribe((({customization:e,visibleVariations:t})=>{this.customization=e;this.visibleVariations=t;this.cdr.detectChanges()}));this.editVariationSubscription=this.customizationViewService.editVariationAction$().pipe(_.filter((e=>!!e))).subscribe((e=>{setTimeout((()=>{this.showEditVariationPanel(e)}),100)}))}ngOnDestroy(){var e,t;(e=this.editVariationSubscription)===null||e===void 0?void 0:e.unsubscribe();(t=this.customizationViewStateSubscription)===null||t===void 0?void 0:t.unsubscribe()}isCustomizationEnabled(e){return e.status===l.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED}getActivityStateForCustomization(e){return this.persoUtils.getActivityStateForCustomization(e)}toggleSliderFullscreen(e){this.modalFullScreenButtonCmp.toggle(e)}onSegmentViewExpressionChange(e){this.edit.expression=e}setVariationRank(e,t,i,o){if(o){i.stopPropagation()}else{let i;if(e.isNew){i=this.customization.variations.findIndex((({tempcode:t})=>t===e.tempcode))}else{i=this.customization.variations.findIndex((({code:t})=>t===e.code))}const o=this.customization.variations[i];const n=this.persoUtils.getValidRank(this.customization.variations,o,t);const s=[...this.customization.variations];if(n>=0&&n<s.length){s.splice(n,0,s.splice(i,1)[0]);this.setVariations(s)}}}showConfirmForDefaultTrigger(e){return __awaiter(this,void 0,void 0,(function*(){if(e&&this.persoTriggerService.isValidExpression(this.edit.expression[0])){try{yield this.confirmationModalService.confirm({description:"personalization.modal.manager.targetgrouptab.defaulttrigger.content"});this.edit.showExpression=false}catch(e){this.edit.isDefault=false}}else{this.edit.showExpression=!e}}))}removeVariation(e){return __awaiter(this,void 0,void 0,(function*(){try{yield this.confirmationModalService.confirm({description:"personalization.modal.manager.targetgrouptab.deletevariation.content"});if(e.isNew){const t=this.customization.variations.filter((t=>t.tempcode!==e.tempcode));this.setVariations(t)}else{e.status=l.PERSONALIZATION_MODEL_STATUS_CODES.DELETED;this.updateVariation(e)}}catch(e){this.logService.log("Remove Variation canceled")}}))}updateVariation(e){const t=this.customization.variations.map((t=>e.isNew&&t.tempcode===e.tempcode||!e.isNew&&t.code===e.code?e:t));this.setVariations(t)}showAddVariationPanel(){this.clearEditedVariationDetails();this.setSliderConfigForAdd();this.sliderPanelShow();this.edit.selectedVariation={triggers:[]};setTimeout((()=>{this.isVariationLoaded=true}),0)}showEditVariationPanel(e){this.setSliderConfigForEditing();this.edit.selectedVariation=e;this.edit.code=e.code;this.edit.name=e.name;this.edit.isDefault=this.persoTriggerService.isDefault(e.triggers);this.edit.showExpression=!this.edit.isDefault;this.isVariationLoaded=true;this.sliderPanelShow()}setSliderConfigForAdd(){this.sliderPanelConfiguration.modal.save.label="personalization.modal.customizationvariationmanagement.targetgrouptab.addvariation";this.sliderPanelConfiguration.modal.save.isDisabledFn=()=>!this.canSaveVariation();this.sliderPanelConfiguration.modal.save.onClick=()=>{this.onAddVariation()}}setSliderConfigForEditing(){this.sliderPanelConfiguration.modal.save.label="personalization.modal.customizationvariationmanagement.targetgrouptab.savechanges";this.sliderPanelConfiguration.modal.save.isDisabledFn=()=>!this.canSaveVariation();this.sliderPanelConfiguration.modal.save.onClick=()=>{this.onSaveEditedVariation()}}canSaveVariation(){const e=this.isSavedVariationValidOrEmpty();const t=this.persoTriggerService.isValidExpression(this.edit.expression[0]);const i=!d.stringUtils.isBlank(this.edit.name);const o=i&&(this.edit.isDefault||t&&e);return o}isSavedVariationValidOrEmpty(){this.edit.expression=this.edit.expression||[{nodes:[]}];return this.persoTriggerService.isValidExpression(this.edit.expression[0])||this.edit.expression.length===0||this.edit.expression[0].nodes.length===0}setVariations(e){this.customizationViewService.setVariations(e)}onAddVariation(){const e=1e4;this.customizationViewService.addVariation({tempcode:"Temp"+(Math.random()*e).toFixed(0),code:this.edit.code,name:this.edit.name,enabled:true,status:l.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED,triggers:this.persoTriggerService.buildTriggers(this.edit,this.edit.selectedVariation.triggers||[]),rank:this.customization.variations.length,isNew:true,catalog:null,catalogVersion:null});this.clearEditedVariationDetails();this.toggleSliderFullscreen(false);this.sliderPanelHide();this.isVariationLoaded=false}onSaveEditedVariation(){const e=this.persoTriggerService.buildTriggers(this.edit,this.edit.selectedVariation.triggers||[]);const t=this.customization.variations.map((t=>t.code===this.edit.selectedVariation.code?Object.assign(Object.assign({},t),{triggers:e,name:this.edit.name}):t));this.setVariations(t);this.toggleSliderFullscreen(false);this.sliderPanelHide();this.isVariationLoaded=false}cancelChangesClick(){if(this.isVariationSelected()){this.edit.selectedVariation=undefined}else{this.clearEditedVariationDetails()}this.toggleSliderFullscreen(false);this.sliderPanelHide();this.isVariationLoaded=false}isVariationSelected(){return typeof this.edit.selectedVariation!=="undefined"}clearEditedVariationDetails(){this.edit.code="";this.edit.name="";this.edit.expression=[];this.edit.isDefault=false;this.edit.showExpression=true}};__decorate([n.ViewChild(de,{static:false}),__metadata("design:type",de)],ge.prototype,"modalFullScreenButtonCmp",void 0);ge=__decorate([n.Component({selector:"perso-target-group-tab",template:`<div class="pe-customization-modal" *ngIf="customization"><div class="pe-customization-modal__title"><div class="pe-customization-modal__title-header"><div class="pe-customization-modal__title-header-name perso-wrap-ellipsis" [attr.title]="customization.name">{{ customization.name }}</div><div><span class="pe-customization-modal__title-header-badge badge badge-success" [ngClass]="[getActivityStateForCustomization(customization)]">{{'personalization.modal.customizationvariationmanagement.targetgrouptab.customization.' + customization.status | lowercase | translate}}</span></div></div><div class="pe-customization-modal__title-subarea"><div *ngIf="isCustomizationEnabled(customization)" class="pe-customization-modal__title-dates"><span *ngIf="!customization.enabledStartDate && customization.enabledEndDate">...</span> <span [ngClass]="{'perso__datetimepicker--error-text': !persoDateUtils.isDateValidOrEmpty(customization.enabledStartDate)}">{{ customization.enabledStartDate }}</span> <span *ngIf="customization.enabledStartDate || customization.enabledEndDate">- </span><span [ngClass]="{'perso__datetimepicker--error-text':!persoDateUtils.isDateValidOrEmpty(customization.enabledEndDate)}">{{ customization.enabledEndDate }}</span> <span *ngIf="persoDateUtils.isDateInThePast(customization.enabledEndDate)" class="section-help help-inline help-inline--section help-inline--tooltip"><span class="pe-datetime__warning-icon"></span> <span class="pe-help-block--inline help-block-inline help-block-inline--text" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.datetooltip"></span> </span><span *ngIf="customization.enabledStartDate && !customization.enabledEndDate">...</span></div></div></div><div class="pe-customization-modal__y-add-btn"><button fd-button label="{{ 'personalization.modal.customizationvariationmanagement.targetgrouptab.addtargetgroup.button' | translate }}" (click)="showAddVariationPanel()"></button></div><perso-target-group-variation-list *ngIf="visibleVariations.length > 0" [customization]="customization" [variations]="visibleVariations"></perso-target-group-variation-list><se-slider-panel [sliderPanelConfiguration]="sliderPanelConfiguration" [(sliderPanelHide)]="sliderPanelHide" [(sliderPanelShow)]="sliderPanelShow" class="pe-customization-modal__sliderpanel"><div *ngIf="isVariationLoaded"><div class="pe-customization-modal__sliderpanel__btn-layout"><perso-modal-full-screen-button></perso-modal-full-screen-button></div><div fd-form-item><label fd-form-label for="targetgroup-name" [required]="true">{{ 'personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupname' | translate }}</label> <input fd-form-control type="text" name="variationname_key" id="targetgroup-name" class="fd-form__control" [placeholder]="'personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupname.placeholder' | translate" [(ngModel)]="edit.name"/></div><fd-checkbox label="{{ 'personalization.modal.customizationvariationmanagement.targetgrouptab.variation.default' | translate }}" [(ngModel)]="edit.isDefault" (ngModelChange)="showConfirmForDefaultTrigger($event)" id="targetgroup-isDefault-001"></fd-checkbox><div *ngIf="edit.showExpression"><segment-view [targetGroupState]="edit" (expressionChange)="onSegmentViewExpressionChange($event)"></segment-view></div></div></se-slider-panel></div>`}),__metadata("design:paramtypes",[l.PersonalizationsmarteditDateUtils,l.PersonalizationsmarteditUtils,t.TriggerService,d.IConfirmationModalService,t.CustomizationViewService,d.LogService,n.ChangeDetectorRef])],ge);window.__smartedit__.addDecoratorPayload("Component","ToggleVariationActiveItemComponent",{selector:"perso-toggle-variation-active-item",template:`\n        <a (click)="toggle()" class="se-dropdown-item fd-list__link" [translate]="label"></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush});let ue=class ToggleVariationActiveItemComponent{constructor(e,t){this.targetGroupTabComponent=t;({selectedItem:this.selectedItem}=e)}ngOnInit(){this.label=this.selectedItem.variation.enabled?"personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.disable":"personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.enable"}toggle(){this.toggleVariationActive(this.selectedItem.variation)}toggleVariationActive(e){const t=!e.enabled;const i=t?l.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED:l.PERSONALIZATION_MODEL_STATUS_CODES.DISABLED;const o=Object.assign(Object.assign({},e),{enabled:t,status:i});this.targetGroupTabComponent.updateVariation(o)}};ue=__decorate([n.Component({selector:"perso-toggle-variation-active-item",template:`\n        <a (click)="toggle()" class="se-dropdown-item fd-list__link" [translate]="label"></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(d.DROPDOWN_MENU_ITEM_DATA)),__param(1,n.Inject(n.forwardRef((()=>ge)))),__metadata("design:paramtypes",[Object,ge])],ue);window.__smartedit__.addDecoratorPayload("Component","RemoveVariationItemComponent",{selector:"perso-remove-variation-item",template:`\n        <a\n            (click)="remove()"\n            class="se-dropdown-item fd-list__link fd-has-color-status-3"\n            translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.remove"\n        ></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush});let he=class RemoveVariationItemComponent{constructor(e,t){this.targetGroupTabComponent=t;({selectedItem:this.selectedItem}=e)}remove(){this.targetGroupTabComponent.removeVariation(this.selectedItem.variation)}};he=__decorate([n.Component({selector:"perso-remove-variation-item",template:`\n        <a\n            (click)="remove()"\n            class="se-dropdown-item fd-list__link fd-has-color-status-3"\n            translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.remove"\n        ></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(d.DROPDOWN_MENU_ITEM_DATA)),__param(1,n.Inject(n.forwardRef((()=>ge)))),__metadata("design:paramtypes",[Object,ge])],he);window.__smartedit__.addDecoratorPayload("Component","MoveVariationUpItemComponent",{selector:"perso-set-variation-rank-up-item",template:`\n        <a\n            (click)="moveUp($event)"\n            [ngClass]="{ 'perso-dropdown-menu__item--disabled disabled': isFirst }"\n            class="se-dropdown-item fd-list__link"\n            translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.moveup"\n        ></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush});let _e=class MoveVariationUpItemComponent{constructor(e,t){this.targetGroupTabComponent=t;this.isFirst=false;({selectedItem:this.selectedItem}=e)}ngOnInit(){this.isFirst=this.selectedItem.variation.rank===0}moveUp(e){if(this.isFirst){e.stopPropagation();return}this.targetGroupTabComponent.setVariationRank(this.selectedItem.variation,-1,e,this.isFirst)}};_e=__decorate([n.Component({selector:"perso-set-variation-rank-up-item",template:`\n        <a\n            (click)="moveUp($event)"\n            [ngClass]="{ 'perso-dropdown-menu__item--disabled disabled': isFirst }"\n            class="se-dropdown-item fd-list__link"\n            translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.moveup"\n        ></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(d.DROPDOWN_MENU_ITEM_DATA)),__param(1,n.Inject(n.forwardRef((()=>ge)))),__metadata("design:paramtypes",[Object,ge])],_e);window.__smartedit__.addDecoratorPayload("Component","MoveVariationDownItemComponent",{selector:"perso-set-variation-rank-down-item",template:`\n        <a\n            (click)="moveDown($event)"\n            [ngClass]="{ 'perso-dropdown-menu__item--disabled disabled': isLast }"\n            class="se-dropdown-item fd-list__link"\n            translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.movedown"\n        ></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush});let ve=class MoveVariationDownItemComponent{constructor(e,t){this.targetGroupTabComponent=t;({selectedItem:this.selectedItem}=e);this.isLast=false}ngOnInit(){this.isLast=this.selectedItem.variation.rank===this.targetGroupTabComponent.visibleVariations.length-1}moveDown(e){if(this.isLast){e.stopPropagation();return}this.targetGroupTabComponent.setVariationRank(this.selectedItem.variation,1,e,this.isLast)}};ve=__decorate([n.Component({selector:"perso-set-variation-rank-down-item",template:`\n        <a\n            (click)="moveDown($event)"\n            [ngClass]="{ 'perso-dropdown-menu__item--disabled disabled': isLast }"\n            class="se-dropdown-item fd-list__link"\n            translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.movedown"\n        ></a>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(d.DROPDOWN_MENU_ITEM_DATA)),__param(1,n.Inject(n.forwardRef((()=>ge)))),__metadata("design:paramtypes",[Object,ge])],ve);window.__smartedit__.addDecoratorPayload("Component","TargetGroupVariationListComponent",{selector:"perso-target-group-variation-list",template:`<ul class="pe-customization-modal__list-group"><li class="pe-customization-modal__list-group__item" *ngFor="let variation of variationsForView"><div class="pe-customization-modal__list-group__item-col1"><a class="pe-customization-modal__list-group__item-link perso-wrap-ellipsis" (click)="editVariation(variation)">{{ variation.name }}</a><span [ngClass]="variation.activityState">{{ variation.enablementText }}</span><div *ngIf="variation.isDefault"><span class="pe-customization-modal__title-label-segments" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.colon"></span> <span translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.default"></span></div><div *ngIf="!variation.isDefault"><div><span class="pe-customization-modal__title-label-segments" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.colon"></span><segment-expression-as-html [segmentExpression]="variation.triggers"></segment-expression-as-html></div></div></div><div><se-dropdown-menu [dropdownItems]="dropdownItems" [selectedItem]="{ variation: variation }" class="pull-right"></se-dropdown-menu></div></li></ul>`});let fe=class TargetGroupVariationListComponent{constructor(e,t,i){this.customizationViewService=e;this.triggerService=t;this.persoUtils=i;this.dropdownItems=[{component:me},{component:ue},{component:_e},{component:ve},{component:he}];this.variationsForView=[]}ngOnChanges(e){const t=e.variations;if(t){const e=t.currentValue;this.variationsForView=e.map((e=>{const t=this.getEnablementTextForVariation(e);const i=this.getActivityStateForVariation(this.customization,e);const o=this.isDefaultTrigger(e.triggers);return Object.assign(Object.assign({},e),{enablementText:t,activityState:i,isDefault:o})}))}}editVariation(e){this.customizationViewService.editVariationAction(e)}isDefaultTrigger(e){return this.triggerService.isDefault(e)}getActivityStateForVariation(e,t){return this.persoUtils.getActivityStateForVariation(e,t)}getEnablementTextForVariation(e){const t=this.persoUtils.getEnablementTextForVariation(e,"personalization.modal.customizationvariationmanagement.targetgrouptab");return`(${t})`}};__decorate([n.Input(),__metadata("design:type",Array)],fe.prototype,"variations",void 0);__decorate([n.Input(),__metadata("design:type",Object)],fe.prototype,"customization",void 0);fe=__decorate([n.Component({selector:"perso-target-group-variation-list",template:`<ul class="pe-customization-modal__list-group"><li class="pe-customization-modal__list-group__item" *ngFor="let variation of variationsForView"><div class="pe-customization-modal__list-group__item-col1"><a class="pe-customization-modal__list-group__item-link perso-wrap-ellipsis" (click)="editVariation(variation)">{{ variation.name }}</a><span [ngClass]="variation.activityState">{{ variation.enablementText }}</span><div *ngIf="variation.isDefault"><span class="pe-customization-modal__title-label-segments" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.colon"></span> <span translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.default"></span></div><div *ngIf="!variation.isDefault"><div><span class="pe-customization-modal__title-label-segments" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.colon"></span><segment-expression-as-html [segmentExpression]="variation.triggers"></segment-expression-as-html></div></div></div><div><se-dropdown-menu [dropdownItems]="dropdownItems" [selectedItem]="{ variation: variation }" class="pull-right"></se-dropdown-menu></div></li></ul>`}),__metadata("design:paramtypes",[t.CustomizationViewService,t.TriggerService,l.PersonalizationsmarteditUtils])],fe);window.__smartedit__.addDecoratorPayload("Component","ManageCustomizationViewComponent",{selector:"perso-manage-customization-view",template:`<div class="pe-customization-modal__tabs"><se-tabs *ngIf="isReady" [tabsList]="tabs" [numTabsDisplayed]="2" (onTabSelected)="onTabSelected($event)"></se-tabs></div>`,providers:[t.CustomizationViewService]});let ye=class ManageCustomizationViewComponent{constructor(e,i,o,n,s,a,r,d,p,m,g,u,h){this.persoDateUtils=e;this.persoCommerceCustomizationService=i;this.persoMessageHandler=o;this.persoCustomizationViewService=n;this.persoRestService=s;this.confirmationModalService=a;this.systemEventService=r;this.modalManager=d;this.translateService=p;this.logService=m;this.cdr=g;this.renderer=u;this.document=h;this.isReady=false;this.savingCustomizationView=false;this.tabs=[];this.isReady=false;this.isEditMode=false;this.tabs=[{id:l.CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS.BASIC_INFO_TAB_FORM_NAME,title:"personalization.modal.customizationvariationmanagement.basicinformationtab",component:t.BasicInfoTabComponent,hasErrors:false,active:true},{id:l.CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS.TARGET_GROUP_TAB_NAME,title:"personalization.modal.customizationvariationmanagement.targetgrouptab",component:ge,hasErrors:false,active:false}]}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.modalManager.getModalData().pipe(_.take(1)).toPromise();if(e){({customizationCode:this.customizationCode,variationCode:this.variationCode}=e)}this.initModalButtons();yield this.initCustomization();if(this.customizationCode){this.isEditMode=true;if(this.variationCode){this.persoCustomizationViewService.editVariationAction(this.persoCustomizationViewService.selectVariationByCode(this.variationCode))}}if(this.variationCode){this.tabs[0].active=false;this.tabs[1].active=true;this.modalManager.addButtons(this.modalButtons.targetGroupTabComponent)}else{this.modalManager.addButtons(this.modalButtons.basicInfoTabComponent)}this.isReady=true;this.cdr.detectChanges()}))}onTabSelected(e){this.modalManager.removeAllButtons();if(e===l.CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS.BASIC_INFO_TAB_FORM_NAME){this.modalManager.addButtons([...this.modalButtons.basicInfoTabComponent])}else if(e===l.CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS.TARGET_GROUP_TAB_NAME){this.modalManager.addButtons([...this.modalButtons.targetGroupTabComponent])}}initModalButtons(){const e={id:"cancel",label:"se.cms.component.confirmation.modal.cancel",style:d.ModalButtonStyle.Default,action:d.ModalButtonAction.None,callback:()=>u.from(this.onCancel())};this.modalButtons={basicInfoTabComponent:[{id:l.CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS.CONFIRM_NEXT,label:"personalization.modal.customizationvariationmanagement.basicinformationtab.button.next",style:d.ModalButtonStyle.Primary,action:d.ModalButtonAction.None,callback:()=>u.from(this.selectTargetGroupTab()),disabledFn:()=>{const e=this.isBasicInfoTabValid();this.fixDisabledTabStyles(e);return!e}},e],targetGroupTabComponent:[{id:l.CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS.CONFIRM_OK,label:"personalization.modal.customizationvariationmanagement.targetgrouptab.button.submit",style:d.ModalButtonStyle.Primary,action:d.ModalButtonAction.None,callback:()=>u.from(this.save()),disabledFn:()=>{const e=this.persoCustomizationViewService.selectVisibleVariations();return e.length===0||this.savingCustomizationView}},e]}}selectTargetGroupTab(){return new Promise((()=>{this.tabsCmp.selectTab(this.tabs[1])}))}fixDisabledTabStyles(e){const t=this.document.querySelector(`[tab-id="targetgrptab"]`);if(!t){return}if(e){this.renderer.setStyle(t,"pointer-events","unset");this.renderer.setStyle(t,"opacity","unset")}else{this.renderer.setStyle(t,"pointer-events","none");this.renderer.setStyle(t,"opacity",.4)}}isBasicInfoTabValid(){const{name:e}=this.persoCustomizationViewService.selectCustomization();return!!e}initCustomization(){return __awaiter(this,void 0,void 0,(function*(){if(!this.customizationCode){this.initialCustomization=r.cloneDeep(re);return}const e=yield this.getCustomization();if(e){this.persoCustomizationViewService.setCustomization(e);this.initialCustomization=r.cloneDeep(e)}}))}fetchCustomizationAndSetDates(){return __awaiter(this,void 0,void 0,(function*(){try{const e=yield this.persoRestService.getCustomization({code:this.customizationCode});e.enabledStartDate=this.persoDateUtils.formatDate(e.enabledStartDate,undefined);e.enabledEndDate=this.persoDateUtils.formatDate(e.enabledEndDate,undefined);e.statusBoolean=e.status===l.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED;return e}catch(e){this.persoMessageHandler.sendError(this.translateService.instant("personalization.error.gettingsegments"))}}))}getCustomization(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.fetchCustomizationAndSetDates();if(!e){return}const t=yield this.fetchVariations(this.customizationCode);if(!t){return}e.variations=t;return e}))}fetchVariations(e){return __awaiter(this,void 0,void 0,(function*(){try{const t={includeFullFields:true};const i=yield this.persoRestService.getVariationsForCustomization(e,t);i.variations.forEach((e=>{e.commerceCustomizations=this.persoCommerceCustomizationService.getCommerceActionsCountMap(e);e.numberOfCommerceActions=this.persoCommerceCustomizationService.getCommerceActionsCount(e);delete e.actions}));return i.variations}catch(e){this.persoMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcomponents"))}}))}onCancel(){return __awaiter(this,void 0,void 0,(function*(){if(!this.isModalDirty()){this.modalManager.dismiss();return}try{yield this.confirmationModalService.confirm({description:"personalization.modal.customizationvariationmanagement.targetgrouptab.cancelconfirmation"});this.modalManager.dismiss()}catch(e){this.logService.log("Confirmation Modal cancelled")}}))}isModalDirty(){const e=this.persoCustomizationViewService.selectCustomization();return!r.isEqual(this.initialCustomization,e)}save(){return __awaiter(this,void 0,void 0,(function*(){this.savingCustomizationView=true;const e=Object.assign({},this.persoCustomizationViewService.selectCustomization());const t=this.prepareCustomizationPayload(e,this.isEditMode);if(this.isEditMode){try{yield this.persoRestService.updateCustomizationPackage(t);this.systemEventService.publishAsync("CUSTOMIZATIONS_MODIFIED",{});this.persoMessageHandler.sendSuccess(this.translateService.instant("personalization.info.updatingcustomization"));this.modalManager.dismiss()}catch(e){this.savingCustomizationView=false;this.persoMessageHandler.sendError(this.translateService.instant("personalization.error.updatingcustomization"))}}else{try{yield this.persoRestService.createCustomization(t);this.systemEventService.publishAsync("CUSTOMIZATIONS_MODIFIED",{});this.persoMessageHandler.sendSuccess(this.translateService.instant("personalization.info.creatingcustomization"));this.modalManager.dismiss()}catch(e){this.savingCustomizationView=false;this.persoMessageHandler.sendError(this.translateService.instant("personalization.error.creatingcustomization"))}}}))}prepareCustomizationPayload(e,t){e.enabledStartDate=e.enabledStartDate?this.persoDateUtils.formatDate(e.enabledStartDate,l.PERSONALIZATION_DATE_FORMATS.MODEL_DATE_FORMAT):undefined;e.enabledEndDate=e.enabledEndDate?this.persoDateUtils.formatDate(e.enabledEndDate,l.PERSONALIZATION_DATE_FORMATS.MODEL_DATE_FORMAT):undefined;if(!t){delete e.catalog;delete e.code;delete e.rank}return e}};__decorate([n.ViewChild(d.TabsComponent,{static:false}),__metadata("design:type",d.TabsComponent)],ye.prototype,"tabsCmp",void 0);ye=__decorate([n.Component({selector:"perso-manage-customization-view",template:`<div class="pe-customization-modal__tabs"><se-tabs *ngIf="isReady" [tabsList]="tabs" [numTabsDisplayed]="2" (onTabSelected)="onTabSelected($event)"></se-tabs></div>`,providers:[t.CustomizationViewService]}),__param(12,n.Inject(m.DOCUMENT)),__metadata("design:paramtypes",[l.PersonalizationsmarteditDateUtils,l.PersonalizationsmarteditCommerceCustomizationService,l.PersonalizationsmarteditMessageHandler,t.CustomizationViewService,t.PersonalizationsmarteditRestService,d.IConfirmationModalService,d.SystemEventService,d.ModalManagerService,g.TranslateService,d.LogService,n.ChangeDetectorRef,n.Renderer2,Document])],ye);t.ManageCustomizationViewManager=class ManageCustomizationViewManager{constructor(e){this.modalService=e;this.className="sliderPanelParentModal";this.modalTitle="personalization.modal.customizationvariationmanagement.title"}openCreateCustomizationModal(){this.modalService.open({component:ye,config:{dialogPanelClass:`lg ${this.className}`,width:"650px",backdropClickCloseable:false,focusTrapped:false},templateConfig:{title:this.modalTitle,isDismissButtonVisible:true}})}openEditCustomizationModal(e,t){this.modalService.open({component:ye,data:{customizationCode:e,variationCode:t},config:{dialogPanelClass:`lg ${this.className}`,width:"650px",backdropClickCloseable:false,focusTrapped:false},templateConfig:{title:this.modalTitle,isDismissButtonVisible:true}})}};t.ManageCustomizationViewManager=__decorate([n.Injectable(),__metadata("design:paramtypes",[d.IModalService])],t.ManageCustomizationViewManager);window.__smartedit__.addDecoratorPayload("Component","SegmentExpressionAsHtmlComponent",{selector:"segment-expression-as-html",template:`<span *ngFor="let word of expression"><span *ngIf="operators.includes(word)" class="pe-customization-modal__expression-text">&nbsp;{{ segmentActionI18n[word] | translate }}&nbsp;</span><se-tooltip *ngIf="word === emptyGroup" [triggers]="['mouseenter', 'mouseleave']"><span se-tooltip-trigger class="pe-customization-modal__expression-alert-icon sap-icon--alert"></span> <span se-tooltip-body translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.group.tooltip"></span></se-tooltip><span *ngIf="!emptyGroupAndOperators.includes(word)">{{ word }}</span></span>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let Se=class SegmentExpressionAsHtmlComponent{constructor(e){this.triggerService=e;this.expression=[];this.segmentActionI18n={[l.TriggerActionId.AND]:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.and",[l.TriggerActionId.OR]:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.or",[l.TriggerActionId.NOT]:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.not"};this.operators=["AND","OR","NOT"];this.emptyGroup="[]";this.emptyGroupAndOperators=this.operators.concat(this.emptyGroup)}ngOnInit(){if(!this.segmentExpression){return}this.update()}ngOnChanges(){this.update()}update(){this.expression=this.isSegmentExpression(this.segmentExpression)?this.buildExpression(this.segmentExpression):this.mapExpressionToString(this.segmentExpression)}buildExpression(e){const t=this.triggerService.buildData(e)[0];return this.mapExpressionToString(t)}mapExpressionToString(e){return this.triggerService.getExpressionAsString(e).split(" ")}isSegmentExpression(e){return typeof e.operation==="undefined"}};__decorate([n.Input(),__metadata("design:type",Object)],Se.prototype,"segmentExpression",void 0);Se=__decorate([n.Component({selector:"segment-expression-as-html",template:`<span *ngFor="let word of expression"><span *ngIf="operators.includes(word)" class="pe-customization-modal__expression-text">&nbsp;{{ segmentActionI18n[word] | translate }}&nbsp;</span><se-tooltip *ngIf="word === emptyGroup" [triggers]="['mouseenter', 'mouseleave']"><span se-tooltip-trigger class="pe-customization-modal__expression-alert-icon sap-icon--alert"></span> <span se-tooltip-body translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.group.tooltip"></span></se-tooltip><span *ngIf="!emptyGroupAndOperators.includes(word)">{{ word }}</span></span>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[t.TriggerService])],Se);let Ce=class SegmentExpressionAsHtmlModule{};Ce=__decorate([n.NgModule({imports:[m.CommonModule,d.TooltipModule,d.TranslationModule.forChild()],declarations:[Se],exports:[Se]})],Ce);let be=class ActionsDataFactory{constructor(){this.actions=[];this.removedActions=[]}getActions(){return this.actions}getRemovedActions(){return this.removedActions}resetActions(){this.actions.length=0}resetRemovedActions(){this.removedActions.length=0}addAction(e,t){let i=false;this.actions.forEach((o=>{i=i||t(e,o.action)}));if(!i){let i=l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.NEW;let o=-1;this.removedActions.forEach(((i,n)=>{if(t(e,i.action)){o=n}}));if(o>=0){i=l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.OLD;this.removedActions.splice(o,1)}this.actions.push({action:e,status:i})}}isItemInSelectedActions(e,t){return this.actions.find((i=>t(e,i.action)))}};be=__decorate([n.Injectable()],be);window.__smartedit__.addDecoratorPayload("Component","CommerceCustomizationViewComponent",{selector:"commerce-customization-view",template:`<div id="commerceCustomizationBody-002" class="perso-cc-modal"><div class="perso-cc-modal__title-layout"><div class="perso-wrap-ellipsis perso-cc-modal__title-cname" [textContent]="customization.name" title="{{customization.name}}"></div><div class="perso-cc-modal__title-status" [ngClass]="customizationStatus" [textContent]="' (' + customizationStatusText + ') '"></div><span>></span><div class="perso-wrap-ellipsis perso-cc-modal__title-vname" [textContent]="variation.name" title="{{variation.name}}"></div><div class="perso-cc-modal__title-status" [ngClass]="variationStatus" [textContent]="' (' + variationStatusText + ')'"></div></div><div class="form-group perso-cc-modal__content-layout"><label for="commerce-customization-type-1" class="fd-form-label" translate="personalization.modal.commercecustomization.action.type"></label><se-select [id]="commerce-customization-type-1" class="fd-form__control" [fetchStrategy]="customizationTypeFetchStrategy" [searchEnabled]="false" [(model)]="select.typeId" [onChange]="onActionTypeChange"></se-select></div><ng-container><ng-container *ngComponentOutlet="promotionComponent.component; injector: promotionComponent.injector"></ng-container></ng-container><ng-container><ng-container *ngComponentOutlet="searchProfileComponent.component; injector: searchProfileComponent.injector"></ng-container></ng-container><div class="select2-choices"><div class="ui-select-match-item select2-search-choice" *ngFor="let action of getActionsToDisplay()"><span [textContent]="displayAction(action)"></span> <span class="ui-select-match-close select2-search-choice-close sap-icon--decline" (click)="removeSelectedAction(action)"></span></div></div></div>`,encapsulation:n.ViewEncapsulation.None});t.CommerceCustomizationViewComponent=class CommerceCustomizationViewComponent{constructor(e,t,i,o,n,s,a,r,l,d,p,m,g){this.injector=e;this.translateService=o;this.actionsDataFactory=n;this.personalizationsmarteditRestService=s;this.personalizationsmarteditMessageHandler=a;this.systemEventService=r;this.personalizationsmarteditCommerceCustomizationService=l;this.personalizationsmarteditContextService=d;this.personalizationsmarteditUtils=p;this.modalManager=m;this.logService=g;this.availableTypes=[];this.select={};this.customizationTypeFetchStrategy={fetchAll:()=>{this.availableTypes=[];this.availableTypes=this.personalizationsmarteditCommerceCustomizationService.getAvailableTypes(this.personalizationsmarteditContextService.getSeData().seConfigurationData);this.availableTypes.forEach((e=>{e.id=e.type;e.label=e.text}));return Promise.resolve(this.availableTypes)}};this.isItemInSelectedActions=(e,t)=>this.actionsDataFactory.isItemInSelectedActions(e,t);this.addAction=(e,t)=>{this.actionsDataFactory.addAction(e,t)};this.availableTypes=this.personalizationsmarteditCommerceCustomizationService.getAvailableTypes(this.personalizationsmarteditContextService.getSeData().seConfigurationData);this.availableTypes.forEach((e=>{e.id=e.type;e.label=e.text}));this.select={typeId:this.availableTypes[0].id,template:this.availableTypes[0].template};this.promotionCode="cxPromotionActionData";this.searchProfilesCode="cxSearchProfileActionData";this.actionsDataFactory.resetActions();this.actionsDataFactory.resetRemovedActions();this.actions=this.actionsDataFactory.getActions();this.removedActions=this.actionsDataFactory.getRemovedActions();this.onActionTypeChange=this.onActionTypeChange.bind(this);if(t){this.initPersonlizationSearchExtensionComponent(t)}if(i){this.initPersonlizationPromotionExtensionComponent(i)}}ngOnInit(){this.modalManager.getModalData().pipe(_.take(1)).subscribe((e=>{this.customization=e.customization;this.variation=e.variation}));this.customizationStatusText=this.personalizationsmarteditUtils.getEnablementTextForCustomization(this.customization,"personalization.modal.commercecustomization");this.variationStatusText=this.personalizationsmarteditUtils.getEnablementTextForVariation(this.variation,"personalization.modal.commercecustomization");this.customizationStatus=this.personalizationsmarteditUtils.getActivityStateForCustomization(this.customization);this.variationStatus=this.personalizationsmarteditUtils.getActivityStateForVariation(this.customization,this.variation);this.modalManager.addButtons([{id:"confirmOk",label:"personalization.modal.commercecustomization.button.submit",style:d.ModalButtonStyle.Primary,action:d.ModalButtonAction.Close,callback:()=>u.from(this.onSave()),disabledFn:()=>!this.isDirty()},{id:"confirmCancel",label:"personalization.modal.commercecustomization.button.cancel",style:d.ModalButtonStyle.Default,action:d.ModalButtonAction.Close,callback:()=>u.from(this.onCancel())}]);this.populateActions()}onActionTypeChange(){this.availableTypes.forEach((e=>{if(e.id===this.select.typeId){this.select.template=e.template}}))}getSeData(){return this.personalizationsmarteditContextService.getSeData()}removeSelectedAction(e){const t=this.actions.indexOf(e);if(t<0){return}const i=this.actions.splice(t,1);if(i[0].status===l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.OLD||i[0].status===l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.UPDATE){i[0].status=l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.DELETE;this.removedActions.push(i[0])}}displayAction(e){const t=e.action;const i=this.getType(t.type);if(i.getName){return i.getName(t)}else{return t.code}}getActionsToDisplay(){return this.actionsDataFactory.getActions()}isDirty(){let e=false;this.actions.forEach((t=>{e=e||t.status===l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.NEW||t.status===l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.UPDATE}));e=e||this.removedActions.length>0;return e}getSelectedTypeCode(){return this.select.typeId}getCustomization(){return this.customization}getVariation(){return this.variation}initPersonlizationSearchExtensionComponent({component:e}){this.searchProfileComponent={component:e,injector:n.Injector.create({parent:this.injector,providers:[{provide:l.PERSONLIZATION_SEARCH_EXTENSION_INJECTOR_TOKEN,useValue:{seData:this.getSeData(),actions:this.actions,addAction:(e,t)=>this.addAction(e,t),isActionInSelectDisabled:(e,t)=>this.isItemInSelectedActions(e,t),getSelectedTypeCode:()=>this.getSelectedTypeCode(),getCustomization:()=>this.getCustomization(),getVariation:()=>this.getVariation()}}]})}}initPersonlizationPromotionExtensionComponent({component:e}){this.promotionComponent={component:e,injector:n.Injector.create({parent:this.injector,providers:[{provide:l.PERSONLIZATION_PROMOTION_EXTENSION_INJECTOR_TOKEN,useValue:{addAction:(e,t)=>this.addAction(e,t),isActionInSelectDisabled:(e,t)=>this.isItemInSelectedActions(e,t),getSelectedTypeCode:()=>this.getSelectedTypeCode()}}]})}}populateActions(){return __awaiter(this,void 0,void 0,(function*(){try{const e=yield this.personalizationsmarteditRestService.getActions(this.customization.code,this.variation.code,{});const t=e.actions.filter((e=>e.type!=="cxCmsActionData")).map((e=>({code:e.code,action:e,status:l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.OLD})));this.actionsDataFactory.resetActions();this.personalizationsmarteditUtils.uniqueArray(this.actionsDataFactory.actions,t||[])}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingactions"))}}))}getType(e){for(const t of this.availableTypes){if(t.type===e){return t}}return{}}sendRefreshEvent(){this.systemEventService.publishAsync("CUSTOMIZATIONS_MODIFIED",{})}onCancel(){this.modalManager.close(null);return Promise.resolve()}onSave(){const e={actions:this.actions.filter((e=>e.status===l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.NEW)).map((e=>e.action))};const t=this.removedActions.filter((e=>e.status===l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.DELETE)).map((e=>e.action.code));const i={actions:this.actions.filter((e=>e.status===l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.UPDATE)).map((e=>e.action))};const o=e.actions.length>0;const n=t.length>0;const s=i.actions.length>0;(()=>{if(o){return this.createActions(this.customization.code,this.variation.code,e)}else{return Promise.resolve()}})().then((e=>{(()=>{if(n){return this.deleteActions(this.customization.code,this.variation.code,t)}else{return Promise.resolve()}})().then((t=>{if(s){this.updateActions(this.customization.code,this.variation.code,i,e,t)}else{return Promise.resolve()}}))}));this.modalManager.close(null);return Promise.resolve()}getActionTypesForActions(e){return e.map((e=>e.type)).filter(((e,t,i)=>i.indexOf(e)===t)).map((e=>this.availableTypes.filter((t=>t.type===e))[0]))}createActions(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=d.promiseUtils.defer();try{const n=yield this.personalizationsmarteditRestService.createActions(e,t,i,{});this.personalizationsmarteditMessageHandler.sendSuccess(this.translateService.instant("personalization.info.creatingaction"));this.sendRefreshEvent();o.resolve(n)}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.creatingaction"));o.reject()}return o.promise}))}deleteActions(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=d.promiseUtils.defer();try{const n=yield this.personalizationsmarteditRestService.deleteActions(e,t,i,{});this.personalizationsmarteditMessageHandler.sendSuccess(this.translateService.instant("personalization.info.removingaction"));this.sendRefreshEvent();o.resolve(n)}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.removingaction"));o.resolve()}return o.promise}))}updateActions(e,t,i,o,n){const s=this.getActionTypesForActions(i.actions);s.forEach((s=>{if(s.updateActions){const a=i.actions.filter((e=>this.getType(e.type)===s));s.updateActions(e,t,a,o,n).then((()=>{this.personalizationsmarteditMessageHandler.sendSuccess(this.translateService.instant("personalization.info.updatingactions"));this.sendRefreshEvent()}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.updatingactions"))}))}else{this.logService.debug(this.translateService.instant("personalization.error.noupdatingactions"))}}))}};t.CommerceCustomizationViewComponent=__decorate([n.Component({selector:"commerce-customization-view",template:`<div id="commerceCustomizationBody-002" class="perso-cc-modal"><div class="perso-cc-modal__title-layout"><div class="perso-wrap-ellipsis perso-cc-modal__title-cname" [textContent]="customization.name" title="{{customization.name}}"></div><div class="perso-cc-modal__title-status" [ngClass]="customizationStatus" [textContent]="' (' + customizationStatusText + ') '"></div><span>></span><div class="perso-wrap-ellipsis perso-cc-modal__title-vname" [textContent]="variation.name" title="{{variation.name}}"></div><div class="perso-cc-modal__title-status" [ngClass]="variationStatus" [textContent]="' (' + variationStatusText + ')'"></div></div><div class="form-group perso-cc-modal__content-layout"><label for="commerce-customization-type-1" class="fd-form-label" translate="personalization.modal.commercecustomization.action.type"></label><se-select [id]="commerce-customization-type-1" class="fd-form__control" [fetchStrategy]="customizationTypeFetchStrategy" [searchEnabled]="false" [(model)]="select.typeId" [onChange]="onActionTypeChange"></se-select></div><ng-container><ng-container *ngComponentOutlet="promotionComponent.component; injector: promotionComponent.injector"></ng-container></ng-container><ng-container><ng-container *ngComponentOutlet="searchProfileComponent.component; injector: searchProfileComponent.injector"></ng-container></ng-container><div class="select2-choices"><div class="ui-select-match-item select2-search-choice" *ngFor="let action of getActionsToDisplay()"><span [textContent]="displayAction(action)"></span> <span class="ui-select-match-close select2-search-choice-close sap-icon--decline" (click)="removeSelectedAction(action)"></span></div></div></div>`,encapsulation:n.ViewEncapsulation.None}),__param(1,n.Optional()),__param(1,n.Inject(l.PERSONLIZATION_SEARCH_EXTENSION_TOKEN)),__param(2,n.Inject(l.PERSONLIZATION_PROMOTION_EXTENSION_TOKEN)),__metadata("design:paramtypes",[n.Injector,Object,Object,g.TranslateService,be,t.PersonalizationsmarteditRestService,l.PersonalizationsmarteditMessageHandler,d.SystemEventService,l.PersonalizationsmarteditCommerceCustomizationService,t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditUtils,d.ModalManagerService,d.LogService])],t.CommerceCustomizationViewComponent);t.PersonalizationsmarteditCommerceCustomizationView=class PersonalizationsmarteditCommerceCustomizationView{constructor(e){this.modalService=e;this.openCommerceCustomizationAction=(e,i)=>{this.modalService.open({component:t.CommerceCustomizationViewComponent,data:{customization:e,variation:i},templateConfig:{title:"personalization.modal.commercecustomization.title",isDismissButtonVisible:true},config:{width:"700px",focusTrapped:false,backdropClickCloseable:false}})}}};t.PersonalizationsmarteditCommerceCustomizationView=__decorate([n.Injectable(),__metadata("design:paramtypes",[d.IModalService])],t.PersonalizationsmarteditCommerceCustomizationView);let Ie=class PersonalizationsmarteditCommerceCustomizationModule{};Ie=__decorate([n.NgModule({imports:[d.TranslationModule.forChild(),m.CommonModule,y.FormsModule,d.SelectModule,l.PersonalizationsmarteditCommonsComponentsModule],declarations:[t.CommerceCustomizationViewComponent],entryComponents:[t.CommerceCustomizationViewComponent],providers:[t.PersonalizationsmarteditCommerceCustomizationView,be]})],Ie);let Ee=class SegmentDragAndDropService{constructor(e){this.document=e}dragMoved(e){const t=this.document.elementFromPoint(e.pointerPosition.x,e.pointerPosition.y);if(!t){this.currentHoverDropListId=null;return}const i=t.classList.contains("cdk-drop-list")?t:t.closest(".cdk-drop-list");if(!i){this.currentHoverDropListId=null;return}this.currentHoverDropListId=i.id}dragReleased(){this.currentHoverDropListId=null}};Ee=__decorate([n.Injectable(),__param(0,n.Inject(m.DOCUMENT)),__metadata("design:paramtypes",[Document])],Ee);window.__smartedit__.addDecoratorPayload("Component","SegmentItemPrinterComponent",{selector:"segment-item-printer",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`\n        <div>\n            <div class="perso__item-name">{{ data.item.code }}</div>\n            <div\n                class="perso-wrap-ellipsis perso__wrapper-description"\n                [attr.title]="data.item.description"\n            >\n                {{ data.item.description }}\n            </div>\n        </div>\n    `});let we=class SegmentItemPrinterComponent{constructor(e){this.data=e}};we=__decorate([n.Component({selector:"segment-item-printer",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`\n        <div>\n            <div class="perso__item-name">{{ data.item.code }}</div>\n            <div\n                class="perso-wrap-ellipsis perso__wrapper-description"\n                [attr.title]="data.item.description"\n            >\n                {{ data.item.description }}\n            </div>\n        </div>\n    `}),__param(0,n.Inject(d.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],we);window.__smartedit__.addDecoratorPayload("Component","SegmentNodeComponent",{selector:"segment-node",template:`<div cdkDropList [id]="node.uid" [cdkDropListData]="node" [cdkDropListConnectedTo]="connectedDropListsIds" (cdkDropListDropped)="onDragDrop($event)" [cdkDropListSortingDisabled]="false" [cdkDropListEnterPredicate]="canBeDropped" [ngClass]="{'perso-segments-tree__layout': isContainer(node), 'perso-segments-tree__empty-container': isEmptyContainer(node), 'perso-segments-tree__collapsed-container': collapsed }"><div><div class="perso-segments-tree" [ngClass]="{'perso-segments-tree__node': isItem(node), 'perso-segments-tree__container': isContainer(node)}"><div *ngIf="isContainer(node)"><div class="perso-segments-tree__toggle" (click)="toggle()" title="{{collapsed ? 'personalization.commons.icon.title.expand' : 'personalization.commons.icon.title.collapse' | translate}}" [ngClass]="collapsed ? 'sap-icon--navigation-right-arrow' : 'sap-icon--navigation-down-arrow'"></div><div class="perso-segments-tree__dropdown"><label class="fd-form-label perso-segments-tree__creategroupselect__label" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.select.label"></label><se-select class="se-select-creategroup" [model]="node.operation.id" (modelChange)="operationChange($event)" [fetchStrategy]="fetchStrategy" [resetSearchInput]="false" [searchEnabled]="false"></se-select></div></div><div *ngIf="isItem(node)" class="perso-segments-tree__node-content">{{ node.selectedSegment.code }}</div><div *ngIf="isContainer(node)" class="perso-segments-tree__angular-ui-tree-handle--empty"></div><div><span class="perso-segments-tree__pull-right"><a *ngIf="isItem(node)" class="fd-link perso-segments-tree__actions perso-segments-tree__node-icon" (click)="duplicateItem(node)" title="{{'personalization.commons.icon.title.duplicate' | translate}}"><span class="sap-icon--duplicate"></span> </a><a *ngIf="!isTopContainer()" class="fd-link perso-segments-tree__actions" (click)="removeItem(node?.uid)"><div *ngIf="isContainer(node)" class="btn btn-link perso-segments-tree__container-btn-icon fd-has-margin-left-tiny" title="{{'personalization.commons.icon.title.remove' | translate}}"><span class="btn sap-icon--decline"></span></div><div *ngIf="isItem(node)" class="perso-segments-tree__node-icon" title="{{'personalization.commons.icon.title.remove' | translate}}"><span class="sap-icon--decline"></span></div></a></span><button *ngIf="isContainer(node)" class="fd-button fd-button--light perso-segments-tree__btn" (click)="newSubItem('container')"><span translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.group.button"></span></button></div></div><div *ngIf="isEmptyContainer(node) && !collapsed" class="perso-segments-tree__empty-container-node"><div class="perso-segments-tree__empty-container-node-text" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.dropzone"></div></div><ol *ngIf="!collapsed"><li cdkDrag [id]="innerNode.uid" [cdkDragData]="innerNode" (cdkDragStarted)="onDragStarted($event)" (cdkDragMoved)="onDragMoved($event)" (cdkDragReleased)="onDragReleased()" *ngFor="let innerNode of node.nodes"><segment-node [node]="innerNode" [expression]="expression" [connectedDropListsIds]="connectedDropListsIds" (expressionChange)="handleUpdate($event)" (onDrop)="onDragDrop($event)" (onDragStart)="onDragStarted($event)"></segment-node></li></ol></div></div>`,styles:[`ol{position:relative;margin:0;padding:0;list-style:none}.cdk-drag{list-style-type:none}.cdk-drag-preview{z-index:2000!important}.cdk-drag-placeholder{opacity:0!important}.cdk-drop-list-dragging{border-top:2px dashed rgba(0,0,0,.4);border-right:2px dashed rgba(0,0,0,.4);border-bottom:2px dashed rgba(0,0,0,.4)}.se-select-creategroup{display:inline-block;width:5rem}`]});let Te=class SegmentNodeComponent{constructor(e,t,i,o){this.triggerService=e;this.confirmationModalService=t;this.translateService=i;this.dragDropService=o;this.canBeDropped=(e,t)=>{const i=!this.isItem(this.node);if(this.dragDropService.currentHoverDropListId===null){return i}return t.id===this.dragDropService.currentHoverDropListId&&i};this.connectedDropListsIds=[];this.expressionChange=new n.EventEmitter;this.onDrop=new n.EventEmitter;this.onDragStart=new n.EventEmitter;this.collapsed=false;this.elementToDuplicate=null}ngOnInit(){this.fetchStrategy={fetchAll:()=>Promise.resolve(this.triggerService.actions)}}onDragDrop(e){this.onDrop.emit(e)}onDragStarted(e){e.source.element.nativeElement.style.zIndex="2000";this.onDragStart.emit(e)}onDragMoved(e){this.dragDropService.dragMoved(e)}onDragReleased(){this.dragDropService.dragReleased()}newSubItem(e){this.node.nodes.unshift({uid:d.stringUtils.generateIdentifier(),type:e,operation:e===l.TriggerType.ITEM_TYPE?{}:r.cloneDeep(this.triggerService.actions[0]),nodes:[]});this.collapsed=false;this.expressionChange.emit(this.expression)}removeItem(e){return __awaiter(this,void 0,void 0,(function*(){if(this.triggerService.isNotEmptyContainer(this.node)){yield this.confirmationModalService.confirm({description:this.translateService.instant("personalization.modal.customizationvariationmanagement.targetgrouptab.segments.removecontainerconfirmation")});this.removeFromNode(e);this.expressionChange.emit(this.expression)}else{this.removeFromNode(e);this.expressionChange.emit(this.expression)}}))}operationChange(e){this.node.operation=this.triggerService.actions.find((t=>t.id===e));this.expressionChange.emit(this.expression)}toggle(){this.collapsed=!this.collapsed}duplicateItem(e){this.elementToDuplicate=e;this.expression[0].nodes.some(this.findElementAndDuplicate,this);this.expressionChange.emit(this.expression)}handleUpdate(e){this.expressionChange.emit(e)}isContainerWithDropzone(e){return this.isContainer(e)&&e.nodes.length===1}isItem(e){return this.triggerService.isItem(e)}isContainer(e){return this.triggerService.isContainer(e)}isTopContainer(){return r.isEqual(this.expression[0],this.node)}isEmptyContainer(e){return this.isContainer(e)&&e.nodes.length===0}findElementAndDuplicate(e,t,i){if(this.elementToDuplicate===e){i.splice(t,0,r.cloneDeep(Object.assign(Object.assign({},this.elementToDuplicate),{uid:d.stringUtils.generateIdentifier()})));return true}if(this.isContainer(e)){e.nodes.some(this.findElementAndDuplicate,this)}return false}removeFromNode(e){const t=this.findParentByUid(e);t.nodes=t.nodes.filter((t=>t.uid!==e))}findParentByUid(e){let t=null;const findParent=i=>{const o=(i.nodes||[]).find((t=>t.uid===e));if(o){t=i;return}for(let e=0;e<i.nodes.length;e++){if(i.nodes[e].uid){findParent(i.nodes[e])}}};findParent(this.expression[0]);return t}};__decorate([n.Input(),__metadata("design:type",Array)],Te.prototype,"expression",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Te.prototype,"node",void 0);__decorate([n.Input(),__metadata("design:type",Array)],Te.prototype,"connectedDropListsIds",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Te.prototype,"expressionChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Te.prototype,"onDrop",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Te.prototype,"onDragStart",void 0);Te=__decorate([n.Component({selector:"segment-node",template:`<div cdkDropList [id]="node.uid" [cdkDropListData]="node" [cdkDropListConnectedTo]="connectedDropListsIds" (cdkDropListDropped)="onDragDrop($event)" [cdkDropListSortingDisabled]="false" [cdkDropListEnterPredicate]="canBeDropped" [ngClass]="{'perso-segments-tree__layout': isContainer(node), 'perso-segments-tree__empty-container': isEmptyContainer(node), 'perso-segments-tree__collapsed-container': collapsed }"><div><div class="perso-segments-tree" [ngClass]="{'perso-segments-tree__node': isItem(node), 'perso-segments-tree__container': isContainer(node)}"><div *ngIf="isContainer(node)"><div class="perso-segments-tree__toggle" (click)="toggle()" title="{{collapsed ? 'personalization.commons.icon.title.expand' : 'personalization.commons.icon.title.collapse' | translate}}" [ngClass]="collapsed ? 'sap-icon--navigation-right-arrow' : 'sap-icon--navigation-down-arrow'"></div><div class="perso-segments-tree__dropdown"><label class="fd-form-label perso-segments-tree__creategroupselect__label" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.select.label"></label><se-select class="se-select-creategroup" [model]="node.operation.id" (modelChange)="operationChange($event)" [fetchStrategy]="fetchStrategy" [resetSearchInput]="false" [searchEnabled]="false"></se-select></div></div><div *ngIf="isItem(node)" class="perso-segments-tree__node-content">{{ node.selectedSegment.code }}</div><div *ngIf="isContainer(node)" class="perso-segments-tree__angular-ui-tree-handle--empty"></div><div><span class="perso-segments-tree__pull-right"><a *ngIf="isItem(node)" class="fd-link perso-segments-tree__actions perso-segments-tree__node-icon" (click)="duplicateItem(node)" title="{{'personalization.commons.icon.title.duplicate' | translate}}"><span class="sap-icon--duplicate"></span> </a><a *ngIf="!isTopContainer()" class="fd-link perso-segments-tree__actions" (click)="removeItem(node?.uid)"><div *ngIf="isContainer(node)" class="btn btn-link perso-segments-tree__container-btn-icon fd-has-margin-left-tiny" title="{{'personalization.commons.icon.title.remove' | translate}}"><span class="btn sap-icon--decline"></span></div><div *ngIf="isItem(node)" class="perso-segments-tree__node-icon" title="{{'personalization.commons.icon.title.remove' | translate}}"><span class="sap-icon--decline"></span></div></a></span><button *ngIf="isContainer(node)" class="fd-button fd-button--light perso-segments-tree__btn" (click)="newSubItem('container')"><span translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.group.button"></span></button></div></div><div *ngIf="isEmptyContainer(node) && !collapsed" class="perso-segments-tree__empty-container-node"><div class="perso-segments-tree__empty-container-node-text" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.dropzone"></div></div><ol *ngIf="!collapsed"><li cdkDrag [id]="innerNode.uid" [cdkDragData]="innerNode" (cdkDragStarted)="onDragStarted($event)" (cdkDragMoved)="onDragMoved($event)" (cdkDragReleased)="onDragReleased()" *ngFor="let innerNode of node.nodes"><segment-node [node]="innerNode" [expression]="expression" [connectedDropListsIds]="connectedDropListsIds" (expressionChange)="handleUpdate($event)" (onDrop)="onDragDrop($event)" (onDragStart)="onDragStarted($event)"></segment-node></li></ol></div></div>`,styles:[`ol{position:relative;margin:0;padding:0;list-style:none}.cdk-drag{list-style-type:none}.cdk-drag-preview{z-index:2000!important}.cdk-drag-placeholder{opacity:0!important}.cdk-drop-list-dragging{border-top:2px dashed rgba(0,0,0,.4);border-right:2px dashed rgba(0,0,0,.4);border-bottom:2px dashed rgba(0,0,0,.4)}.se-select-creategroup{display:inline-block;width:5rem}`]}),__metadata("design:paramtypes",[t.TriggerService,d.IConfirmationModalService,g.TranslateService,Ee])],Te);window.__smartedit__.addDecoratorPayload("Component","SegmentViewComponent",{selector:"segment-view",template:`<label class="fd-form-label" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupexpression"></label><div><div class="form-group"><segment-expression-as-html [segmentExpression]="expression[0]"></segment-expression-as-html></div><div class="form-group"><label fd-form-label for="segment-select">{{ 'personalization.modal.customizationvariationmanagement.targetgrouptab.segments' | translate }}</label><se-select id="segment-select" [model]="singleSegment.code" (modelChange)="segmentSelectedEvent($event)" [fetchStrategy]="segmentFetchStrategy" [itemComponent]="segmentPrinterComponent" [(reset)]="resetSelect" [placeholder]="'personalization.modal.customizationvariationmanagement.targetgrouptab.segments.placeholder'"></se-select></div><segment-node *ngFor="let node of expression" [node]="node" [expression]="expression" [connectedDropListsIds]="connectedDropListsIds" (expressionChange)="handleTreeUpdated($event)" (onDrop)="onDropHandler($event)" (onDragStart)="onDragStart($event)"></segment-node></div>`});let Pe=class SegmentViewComponent{constructor(e,t,i,o,s,a){this.personalizationsmarteditRestService=e;this.personalizationsmarteditMessageHandler=t;this.triggerService=i;this.personalizationsmarteditUtils=o;this.translateService=s;this.yjQuery=a;this.expressionChange=new n.EventEmitter;this.segments=[];this.singleSegment={code:null};this.triggerLookupMap={};this.actions=this.triggerService.actions;this.segmentPrinterComponent=we;this.nodeTemplate=Te;this.connectedDropListsIds=[]}ngOnInit(){this.triggers=this.triggers||(this.targetGroupState.selectedVariation||{}).triggers;this.expression=this.expression||this.targetGroupState.expression;if(this.triggers&&this.triggers.length>0){this.expression=this.triggerService.buildData(this.triggers)}else{this.expression=[{uid:d.stringUtils.generateIdentifier(),type:l.TriggerType.CONTAINER_TYPE,operation:this.actions[0],nodes:[]}]}this.syncExpressionOnTriggerData();this.elementToScroll=this.yjQuery(".se-slider-panel__body");this.segmentFetchStrategy={fetchPage:(e,t,i)=>this.loadSegmentItems(e,t,i),fetchEntity:e=>Promise.resolve(this.segments.find((t=>t.code===e)))};this.getIdsRecursive(this.rootExpression)}get rootExpression(){var e;return((e=this.expression)===null||e===void 0?void 0:e.length)?this.expression[0]:null}segmentSelectedEvent(e){if(!e){this.singleSegment={code:null};return}const t=this.segments.find((t=>t.code===e));this.expression=[Object.assign(Object.assign({},this.rootExpression),{nodes:[{type:l.TriggerType.ITEM_TYPE,operation:null,selectedSegment:t,nodes:[],uid:d.stringUtils.generateIdentifier()}].concat(this.rootExpression.nodes)})];this.getIdsRecursive(this.rootExpression);setTimeout((()=>{this.resetSelect()}));this.syncExpressionOnTriggerData()}handleTreeUpdated(e){this.triggerLookupMap={};this.expression=r.cloneDeep(e);this.getIdsRecursive(this.rootExpression);this.syncExpressionOnTriggerData()}onDropHandler(e){this.scrollZoneVisible=false;if(e.container.id===e.previousContainer.id){const t=this.triggerLookupMap[e.container.id];w.moveItemInArray(t.nodes,e.previousIndex,e.currentIndex)}else{const t=this.triggerLookupMap[e.container.id];t.nodes.splice(e.currentIndex,0,e.item.data);const i=this.triggerLookupMap[e.previousContainer.id];i.nodes.splice(i.nodes.findIndex((t=>t.uid===e.item.data.uid)),1)}this.handleTreeUpdated(this.expression)}onDragStart(){this.scrollZoneVisible=this.isScrollZoneVisible()}loadSegmentItems(e,t,i){return __awaiter(this,void 0,void 0,(function*(){try{const o=yield this.personalizationsmarteditRestService.getSegments({code:e,pageSize:t,currentPage:i});this.personalizationsmarteditUtils.uniqueArray(this.segments,o.segments||[]);return Object.assign(Object.assign({},o),{results:o.results.map((e=>Object.assign(Object.assign({},e),{id:e.code})))})}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingsegments"))}}))}syncExpressionOnTriggerData(){this.expressionChange.emit(this.expression)}getIdsRecursive(e){this.triggerLookupMap[e.uid]=e;(e.nodes||[]).forEach((e=>{if(!this.triggerService.isItem(e)){this.getIdsRecursive(e)}}));this.connectedDropListsIds=Object.keys(this.triggerLookupMap).reverse()}isScrollZoneVisible(){const e=this.yjQuery(".se-slider-panel__body").get(0);if(e){return e.scrollHeight>e.clientHeight}return false}};__decorate([n.Input(),__metadata("design:type",Object)],Pe.prototype,"targetGroupState",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Pe.prototype,"expressionChange",void 0);Pe=__decorate([n.Component({selector:"segment-view",template:`<label class="fd-form-label" translate="personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupexpression"></label><div><div class="form-group"><segment-expression-as-html [segmentExpression]="expression[0]"></segment-expression-as-html></div><div class="form-group"><label fd-form-label for="segment-select">{{ 'personalization.modal.customizationvariationmanagement.targetgrouptab.segments' | translate }}</label><se-select id="segment-select" [model]="singleSegment.code" (modelChange)="segmentSelectedEvent($event)" [fetchStrategy]="segmentFetchStrategy" [itemComponent]="segmentPrinterComponent" [(reset)]="resetSelect" [placeholder]="'personalization.modal.customizationvariationmanagement.targetgrouptab.segments.placeholder'"></se-select></div><segment-node *ngFor="let node of expression" [node]="node" [expression]="expression" [connectedDropListsIds]="connectedDropListsIds" (expressionChange)="handleTreeUpdated($event)" (onDrop)="onDropHandler($event)" (onDragStart)="onDragStart($event)"></segment-node></div>`}),__param(5,n.Inject(d.YJQUERY_TOKEN)),__metadata("design:paramtypes",[t.PersonalizationsmarteditRestService,l.PersonalizationsmarteditMessageHandler,t.TriggerService,l.PersonalizationsmarteditUtils,g.TranslateService,Function])],Pe);let Oe=class PersonalizationsmarteditSegmentViewModule{};Oe=__decorate([n.NgModule({imports:[m.CommonModule,l.PersonalizationsmarteditCommonsComponentsModule,t.SePersonalizationsmarteditServicesModule,Ie,Ce,l.ScrollZoneModule,d.SelectModule,d.NgTreeModule,d.TranslationModule.forChild(),w.DragDropModule],providers:[Ee],declarations:[Pe,Te,we],entryComponents:[Pe,Te,we],exports:[Pe]})],Oe);t.ManageCustomizationViewModule=class ManageCustomizationViewModule{};t.ManageCustomizationViewModule=__decorate([n.NgModule({imports:[m.CommonModule,y.FormsModule,d.TranslationModule.forChild(),l.DatetimePickerRangeModule,d.TabsModule,d.TooltipModule,d.SliderPanelModule,d.DropdownMenuModule,Ce,Oe,pe,h.ButtonModule,v.FormModule,b.SwitchModule,S.CheckboxModule],providers:[t.ManageCustomizationViewManager,t.CustomizationViewService,t.TriggerService],declarations:[t.BasicInfoTabComponent,ge,fe,me,ue,_e,ve,he,ye],entryComponents:[t.BasicInfoTabComponent,ge,me,ue,_e,ve,he,ye],exports:[t.BasicInfoTabComponent,ge]})],t.ManageCustomizationViewModule);window.__smartedit__.addDecoratorPayload("Component","CustomizationsListComponent",{selector:"customizations-list",template:`<div class="pe-customize-panel-list"><div class="pe-customize-panel-list__header"><span class="pe-customize-panel-list__header--name" translate="personalization.toolbar.pagecustomizations.list.title"></span> <span class="pe-customize-panel-list__header--status" translate="personalization.toolbar.pagecustomizations.list.status"></span></div><div *ngFor="let customization of customizationsList; last as isLast; trackBy: customizationsListTrackBy" [ngClass]="isLast && customization.collapsed && isCustomizationFromCurrentCatalog(customization, isLast) ? 'pe-customize-panel-list__item-last':''"><div class="pe-customize-panel-list__row-layout" [ngClass]="getSelectedCustomizationClass(customization)"><div class="pe-customize-panel-list__icon-layout pe-customize-panel-list__icon-divider" (click)="customizationRowClick(customization)"><a class="pe-customize-panel-list__btn-link btn btn-link" title="{{(customization.collapsed ? 'personalization.commons.icon.title.expand' : 'personalization.commons.icon.title.collapse') | translate}}"><span [ngClass]="customization.collapsed ? 'sap-icon--navigation-right-arrow' : 'sap-icon--navigation-down-arrow'"></span></a></div><div class="pe-customize-panel-list__row" (click)="customizationRowClick(customization,true)"><div class="pe-customize-panel-list__col-lg"><div class="perso-wrap-ellipsis pe-customize-panel-list__parent-layout perso-tree__primary-data" [textContent]="customization.name" title="{{customization.name}}"></div></div><div class="pe-customize-panel-list__col-md"></div><div class="pe-customize-panel-list__col-md"><div class="perso-tree__status" [ngClass]="getActivityStateForCustomization(customization)" [textContent]="getEnablementTextForCustomization(customization)"></div><div class="perso-tree__dates-layout" *ngIf="isEnabled(customization)" [textContent]="getDatesForCustomization(customization)"></div></div><div class="pe-customize-panel-list__col-sm"><span *ngIf="!isCustomizationFromCurrentCatalog(customization)" class="perso__globe-icon sap-icon--globe"></span></div></div><div class="pe-customize-panel-list__col-xs pe-customize-panel-list__dropdown"><div *ngIf="isCustomizationFromCurrentCatalog(customization)" class="y-dropdown-more-menu dropdown open"><button type="button" class="pe-customize-panel-list__btn-link fd-button fd-button--light customization-rank-{{customization.rank}}-dropdown-toggle" (click)="customizationSubMenuAction(customization)"><span class="perso__more-icon sap-icon--overflow"></span></button><ul *ngIf="customization.subMenu" class="se-y-dropdown-menu__list fd-menu__list dropdown-menu" role="menu"><li><a class="se-dropdown-item fd-menu__item cutomization-rank-{{customization.rank}}-edit-button" (click)="clearAllSubMenu();editCustomizationAction(customization)" translate="personalization.toolbar.pagecustomizations.customization.options.edit"></a></li></ul></div></div></div><div *ngIf="!customization.collapsed"><div class="pe-customize-panel-list__row-layout" *ngFor="let variation of customization.variations" [ngClass]="getSelectedVariationClass(variation)" (click)="clearAllSubMenu();variationClick(customization, variation)"><div class="pe-customize-panel-list__icon-layout"><div class="pe-customize-panel-list__btn-link btn btn-link"></div></div><div class="pe-customize-panel-list__row"><div class="pe-customize-panel-list__col-lg"><div class="perso-wrap-ellipsis pe-customize-panel-list__child-layout" [textContent]="variation.name" title="{{variation.name}}"></div></div><div class="pe-customize-panel-list__col-md"><div class="pe-customize-panel-list__components-layout"><div [hidden]="variation.numberOfAffectedComponents &lt; 0" class="pe-customize-panel-list__number-layout">{{variation.numberOfAffectedComponents}}</div><div [hidden]="variation.numberOfAffectedComponents >= 0" class="pe-customize-panel-list__number-layout">#</div><div class="perso-wrap-ellipsis" translate="personalization.toolbar.pagecustomizations.variation.numberofaffectedcomponents.label" title="{{'personalization.toolbar.pagecustomizations.variation.numberofaffectedcomponents.label' | translate}}"></div></div></div><div class="pe-customize-panel-list__col-md perso-tree__status" [ngClass]="getActivityStateForVariation(customization, variation)" [textContent]="getEnablementTextForVariation(variation)"></div><div class="pe-customize-panel-list__col-sm"><span class="perso__cc-icon sap-icon--tag" [ngClass]="{'perso__cc-icon--hidden': !hasCommerceActions(variation)}" [title]="getCommerceCustomizationTooltip(variation)"></span></div></div><div class="pe-customize-panel-list__col-xs pe-customize-panel-list__dropdown"></div></div></div></div></div><div *ngIf="requestProcessing" class="se-spinner fd-busy-indicator-extended"><div class="spinner"><fd-busy-indicator [loading]="true" size="m"></fd-busy-indicator></div></div>`});t.CustomizationsListComponent=class CustomizationsListComponent{constructor(e,t,i,o,n,s,a,r,l,d,p,m,g,u){this.translateService=e;this.personalizationsmarteditContextService=t;this.personalizationsmarteditRestService=i;this.personalizationsmarteditCommerceCustomizationService=o;this.personalizationsmarteditMessageHandler=n;this.personalizationsmarteditUtils=s;this.personalizationsmarteditDateUtils=a;this.personalizationsmarteditContextUtils=r;this.personalizationsmarteditPreviewService=l;this.personalizationsmarteditManager=d;this.customizeViewServiceProxy=p;this.systemEventService=m;this.crossFrameEventService=g;this.toolbarItem=u;this.sourceContainersComponentsInfo={};this.customizationsListPreCount=0}ngOnDestroy(){if(this.customizationsModifiedUnsubscribe){this.customizationsModifiedUnsubscribe()}}ngOnInit(){this.sourceContainersComponentsInfo={};this.customizationsModifiedUnsubscribe=this.systemEventService.subscribe("CUSTOMIZATIONS_MODIFIED",(()=>{this.refreshCustomizeContext()}))}ngDoCheck(){if(this.customizationsListPreCount!==this.customizationsList.length){this.updateCustomizationList();this.customizationsListPreCount=this.customizationsList.length}}updateCustomizationList(){this.customizationsList.forEach((e=>{e.collapsed=true;if((this.personalizationsmarteditContextService.getCustomize().selectedCustomization||{}).code===e.code){e.collapsed=false;this.updateCustomizationData(e)}this.personalizationsmarteditUtils.getAndSetCatalogVersionNameL10N(e)}))}editCustomizationAction(e){this.personalizationsmarteditContextUtils.clearCombinedViewContextAndReloadPreview(this.personalizationsmarteditPreviewService,this.personalizationsmarteditContextService);this.personalizationsmarteditManager.openEditCustomizationModal(e.code,"");this.toolbarItem.isOpen=false}customizationRowClick(e,t){this.clearAllSubMenu();e.collapsed=!e.collapsed;if(!e.collapsed){this.updateCustomizationData(e)}if(t){this.customizationClick(e)}this.customizationsList.filter((t=>e.code!==t.code)).forEach((e=>{e.collapsed=true}))}customizationClick(e){const t=this.personalizationsmarteditContextService.getCombinedView();const i=this.personalizationsmarteditContextService.getCustomize().selectedVariations;const o=this.getVisibleVariations(e);const n=this.personalizationsmarteditContextService.getCustomize();n.selectedCustomization=e;n.selectedVariations=o;this.personalizationsmarteditContextService.setCustomize(n);if(o.length>0){const t=this.personalizationsmarteditUtils.getVariationCodes(o).join(",");this.getAndSetComponentsForVariation(e.code,t,e.catalog,e.catalogVersion)}if(N.isObjectLike(i)&&!N.isArray(i)||t.enabled){this.updatePreviewTicket()}this.personalizationsmarteditContextUtils.clearCombinedViewContext(this.personalizationsmarteditContextService);this.crossFrameEventService.publish(d.SHOW_TOOLBAR_ITEM_CONTEXT,l.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY)}getSelectedVariationClass(e){if(N.isEqual(e.code,(this.personalizationsmarteditContextService.getCustomize().selectedVariations||{}).code)){return"selectedVariation"}else{return""}}getSelectedCustomizationClass(e){if(N.isEqual(e.code,(this.personalizationsmarteditContextService.getCustomize().selectedCustomization||{}).code)&&N.isArray(this.personalizationsmarteditContextService.getCustomize().selectedVariations)){return"selectedCustomization"}else{return""}}variationClick(e,t){const i=this.personalizationsmarteditContextService.getCustomize();i.selectedCustomization=e;i.selectedVariations=t;this.personalizationsmarteditContextService.setCustomize(i);this.personalizationsmarteditContextUtils.clearCombinedViewContext(this.personalizationsmarteditContextService);this.getAndSetComponentsForVariation(e.code,t.code,e.catalog,e.catalogVersion);this.updatePreviewTicket(e.code,[t]);this.crossFrameEventService.publish(d.SHOW_TOOLBAR_ITEM_CONTEXT,l.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY)}hasCommerceActions(e){return this.personalizationsmarteditUtils.hasCommerceActions(e)}getCommerceCustomizationTooltip(e){return this.personalizationsmarteditUtils.getCommerceCustomizationTooltip(e,"","")}getActivityStateForCustomization(e){return this.personalizationsmarteditUtils.getActivityStateForCustomization(e)}customizationsListTrackBy(e,t){return e}getActivityStateForVariation(e,t){return this.personalizationsmarteditUtils.getActivityStateForVariation(e,t)}clearAllSubMenu(){for(const e of this.customizationsList){e.subMenu=false}}getEnablementTextForCustomization(e){return this.personalizationsmarteditUtils.getEnablementTextForCustomization(e,"personalization.toolbar.pagecustomizations")}getEnablementTextForVariation(e){return this.personalizationsmarteditUtils.getEnablementTextForVariation(e,"personalization.toolbar.pagecustomizations")}isEnabled(e){return this.personalizationsmarteditUtils.isPersonalizationItemEnabled(e)}getDatesForCustomization(e){let t="";let i="";let o="";if(e.enabledStartDate||e.enabledEndDate){i=this.personalizationsmarteditDateUtils.formatDateWithMessage(e.enabledStartDate);o=this.personalizationsmarteditDateUtils.formatDateWithMessage(e.enabledEndDate);if(!e.enabledStartDate){i=" ..."}if(!e.enabledEndDate){o="... "}t+=" ("+i+" - "+o+") "}return t}customizationSubMenuAction(e){if(!e.subMenu){this.clearAllSubMenu()}e.subMenu=!e.subMenu}isCustomizationFromCurrentCatalog(e){return this.personalizationsmarteditUtils.isItemFromCurrentCatalog(e,this.personalizationsmarteditContextService.getSeData())}statusNotDeleted(e){return this.personalizationsmarteditUtils.isItemVisible(e)}matchActionForVariation(e,t){return e.variationCode===t.code&&e.actionCatalog===t.catalog&&e.actionCatalogVersion===t.catalogVersion}numberOfAffectedComponentsForActions(e){let t=0;e.forEach((e=>{t+=parseInt(this.sourceContainersComponentsInfo[e.containerId],10)||0}));return t}initSourceContainersComponentsInfo(){const e=d.promiseUtils.defer();this.customizeViewServiceProxy.getSourceContainersInfo().then((t=>{this.sourceContainersComponentsInfo=t;e.resolve()}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingnumberofaffectedcomponentsforvariation"));e.reject()}));return e.promise}paginatedGetAndSetNumberOfAffectedComponentsForVariations(e,t){this.personalizationsmarteditRestService.getCxCmsActionsOnPageForCustomization(e,t).then((i=>{e.variations.forEach((e=>{const o=i.actions.filter((t=>this.matchActionForVariation(t,e)));e.numberOfAffectedComponents=t===0?0:e.numberOfAffectedComponents;e.numberOfAffectedComponents+=this.numberOfAffectedComponentsForActions(o)}));const o=t+1;if(o<i.pagination.totalPages){this.paginatedGetAndSetNumberOfAffectedComponentsForVariations(e,o)}}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingnumberofaffectedcomponentsforvariation"))}))}getAndSetNumberOfAffectedComponentsForVariations(e){const t=this.personalizationsmarteditContextService.getCustomize();const i=(t.selectedComponents||[]).every((e=>this.sourceContainersComponentsInfo[e]!==undefined));if(!i||t.selectedComponents===null||N.isEqual(this.sourceContainersComponentsInfo,{})){this.initSourceContainersComponentsInfo().finally((()=>{this.paginatedGetAndSetNumberOfAffectedComponentsForVariations(e,0)}))}else if(i){this.paginatedGetAndSetNumberOfAffectedComponentsForVariations(e,0)}}getNumberOfAffectedComponentsForCorrespondingVariation(e,t){const i=e.filter((e=>e.code===t));return(i[0]||{}).numberOfAffectedComponents}updateCustomizationData(e){this.personalizationsmarteditRestService.getVariationsForCustomization(e.code,e).then((t=>{const i=t.variations?N.cloneDeep(t.variations):[];i.forEach(((t,o)=>{if(!this.statusNotDeleted(t)){i.splice(o,1)}else{t.numberOfAffectedComponents=this.getNumberOfAffectedComponentsForCorrespondingVariation(e.variations,t.code);t.numberOfCommerceActions=this.personalizationsmarteditCommerceCustomizationService.getCommerceActionsCount(t);t.commerceCustomizations=this.personalizationsmarteditCommerceCustomizationService.getCommerceActionsCountMap(t)}}));e.variations=i||[];this.getAndSetNumberOfAffectedComponentsForVariations(e)}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcustomization"))}))}getVisibleVariations(e){return this.personalizationsmarteditUtils.getVisibleItems(e.variations)}getAndSetComponentsForVariation(e,t,i,o){this.personalizationsmarteditRestService.getComponentsIdsForVariation(e,t,i,o).then((e=>{const t=this.personalizationsmarteditContextService.getCustomize();t.selectedComponents=e.components;this.personalizationsmarteditContextService.setCustomize(t)}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcomponentsforvariation"))}))}updatePreviewTicket(e,t){const i=this.personalizationsmarteditUtils.getVariationKey(e,t);this.personalizationsmarteditPreviewService.updatePreviewTicketWithVariations(i)}refreshCustomizeContext(){const e=N.cloneDeep(this.personalizationsmarteditContextService.getCustomize());if(e.selectedCustomization){this.personalizationsmarteditRestService.getCustomization(e.selectedCustomization).then((t=>{e.selectedCustomization=t;if(e.selectedVariations&&!N.isArray(e.selectedVariations)){t.variations.filter((t=>e.selectedVariations.code===t.code)).forEach((t=>{e.selectedVariations=t;if(!this.personalizationsmarteditUtils.isItemVisible(t)){e.selectedCustomization=null;e.selectedVariations=null;this.personalizationsmarteditPreviewService.removePersonalizationDataFromPreview()}}))}this.personalizationsmarteditContextService.setCustomize(e)}),(()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcustomization"))}))}}};__decorate([n.Input(),__metadata("design:type",Array)],t.CustomizationsListComponent.prototype,"customizationsList",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],t.CustomizationsListComponent.prototype,"requestProcessing",void 0);t.CustomizationsListComponent=__decorate([n.Component({selector:"customizations-list",template:`<div class="pe-customize-panel-list"><div class="pe-customize-panel-list__header"><span class="pe-customize-panel-list__header--name" translate="personalization.toolbar.pagecustomizations.list.title"></span> <span class="pe-customize-panel-list__header--status" translate="personalization.toolbar.pagecustomizations.list.status"></span></div><div *ngFor="let customization of customizationsList; last as isLast; trackBy: customizationsListTrackBy" [ngClass]="isLast && customization.collapsed && isCustomizationFromCurrentCatalog(customization, isLast) ? 'pe-customize-panel-list__item-last':''"><div class="pe-customize-panel-list__row-layout" [ngClass]="getSelectedCustomizationClass(customization)"><div class="pe-customize-panel-list__icon-layout pe-customize-panel-list__icon-divider" (click)="customizationRowClick(customization)"><a class="pe-customize-panel-list__btn-link btn btn-link" title="{{(customization.collapsed ? 'personalization.commons.icon.title.expand' : 'personalization.commons.icon.title.collapse') | translate}}"><span [ngClass]="customization.collapsed ? 'sap-icon--navigation-right-arrow' : 'sap-icon--navigation-down-arrow'"></span></a></div><div class="pe-customize-panel-list__row" (click)="customizationRowClick(customization,true)"><div class="pe-customize-panel-list__col-lg"><div class="perso-wrap-ellipsis pe-customize-panel-list__parent-layout perso-tree__primary-data" [textContent]="customization.name" title="{{customization.name}}"></div></div><div class="pe-customize-panel-list__col-md"></div><div class="pe-customize-panel-list__col-md"><div class="perso-tree__status" [ngClass]="getActivityStateForCustomization(customization)" [textContent]="getEnablementTextForCustomization(customization)"></div><div class="perso-tree__dates-layout" *ngIf="isEnabled(customization)" [textContent]="getDatesForCustomization(customization)"></div></div><div class="pe-customize-panel-list__col-sm"><span *ngIf="!isCustomizationFromCurrentCatalog(customization)" class="perso__globe-icon sap-icon--globe"></span></div></div><div class="pe-customize-panel-list__col-xs pe-customize-panel-list__dropdown"><div *ngIf="isCustomizationFromCurrentCatalog(customization)" class="y-dropdown-more-menu dropdown open"><button type="button" class="pe-customize-panel-list__btn-link fd-button fd-button--light customization-rank-{{customization.rank}}-dropdown-toggle" (click)="customizationSubMenuAction(customization)"><span class="perso__more-icon sap-icon--overflow"></span></button><ul *ngIf="customization.subMenu" class="se-y-dropdown-menu__list fd-menu__list dropdown-menu" role="menu"><li><a class="se-dropdown-item fd-menu__item cutomization-rank-{{customization.rank}}-edit-button" (click)="clearAllSubMenu();editCustomizationAction(customization)" translate="personalization.toolbar.pagecustomizations.customization.options.edit"></a></li></ul></div></div></div><div *ngIf="!customization.collapsed"><div class="pe-customize-panel-list__row-layout" *ngFor="let variation of customization.variations" [ngClass]="getSelectedVariationClass(variation)" (click)="clearAllSubMenu();variationClick(customization, variation)"><div class="pe-customize-panel-list__icon-layout"><div class="pe-customize-panel-list__btn-link btn btn-link"></div></div><div class="pe-customize-panel-list__row"><div class="pe-customize-panel-list__col-lg"><div class="perso-wrap-ellipsis pe-customize-panel-list__child-layout" [textContent]="variation.name" title="{{variation.name}}"></div></div><div class="pe-customize-panel-list__col-md"><div class="pe-customize-panel-list__components-layout"><div [hidden]="variation.numberOfAffectedComponents &lt; 0" class="pe-customize-panel-list__number-layout">{{variation.numberOfAffectedComponents}}</div><div [hidden]="variation.numberOfAffectedComponents >= 0" class="pe-customize-panel-list__number-layout">#</div><div class="perso-wrap-ellipsis" translate="personalization.toolbar.pagecustomizations.variation.numberofaffectedcomponents.label" title="{{'personalization.toolbar.pagecustomizations.variation.numberofaffectedcomponents.label' | translate}}"></div></div></div><div class="pe-customize-panel-list__col-md perso-tree__status" [ngClass]="getActivityStateForVariation(customization, variation)" [textContent]="getEnablementTextForVariation(variation)"></div><div class="pe-customize-panel-list__col-sm"><span class="perso__cc-icon sap-icon--tag" [ngClass]="{'perso__cc-icon--hidden': !hasCommerceActions(variation)}" [title]="getCommerceCustomizationTooltip(variation)"></span></div></div><div class="pe-customize-panel-list__col-xs pe-customize-panel-list__dropdown"></div></div></div></div></div><div *ngIf="requestProcessing" class="se-spinner fd-busy-indicator-extended"><div class="spinner"><fd-busy-indicator [loading]="true" size="m"></fd-busy-indicator></div></div>`}),__param(13,n.Inject(d.TOOLBAR_ITEM)),__metadata("design:paramtypes",[g.TranslateService,t.PersonalizationsmarteditContextService,t.PersonalizationsmarteditRestService,l.PersonalizationsmarteditCommerceCustomizationService,l.PersonalizationsmarteditMessageHandler,l.PersonalizationsmarteditUtils,l.PersonalizationsmarteditDateUtils,l.PersonalizationsmarteditContextUtils,t.PersonalizationsmarteditPreviewService,t.ManageCustomizationViewManager,t.CustomizeViewServiceProxy,d.SystemEventService,d.CrossFrameEventService,Object])],t.CustomizationsListComponent);window.__smartedit__.addDecoratorPayload("Component","CustomizeViewComponent",{selector:"customize-view",template:`<div class="btn-block pe-toolbar-action--include"><div class="pe-toolbar-menu-content se-toolbar-menu-content--pe-customized-customizations-panel" role="menu"><div class="se-toolbar-menu-content--pe-customized__headers"><div class="se-toolbar-menu-content--pe-customized__headers--wrapper"><h2 class="se-toolbar-menu-content--pe-customized__headers--h2"><span translate="personalization.toolbar.pagecustomizations.header.title"></span> ({{pagination.totalCount}})</h2><se-help class="se-toolbar-menu-content__y-help"><span translate="personalization.toolbar.pagecustomizations.header.description"></span></se-help></div><div class="se-input-group se-component-search"><input type="text" id="customization-search-name" class="se-input-group--input se-component-search--input fd-input" [(ngModel)]="nameFilter" [placeholder]="'personalization.toolbar.pagecustomizations.search.placeholder' | translate" (ngModelChange)="nameInputKeypress()"/> <span class="sap-icon--search se-input-group__addon"></span><span *ngIf="showResetButton" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="resetSearch($event)"></span></div></div><div role="menuitem"><div id="personalizationsmartedit-right-toolbar-item-template"><div class="pe-customize-panel__filter-label-layout"><div class="pe-customize-panel__filter-layout"><page-filter-dropdown (onSelectCallback)="pageFilterChange($event)" [initialValue]="pageFilter" class="perso-filter__wrapper perso-filter__wrapper--page"></page-filter-dropdown><has-multicatalog class="perso-filter__wrapper perso-filter__wrapper--catalog"><catalog-filter-dropdown (onSelectCallback)="catalogFilterChange($event)" [initialValue]="catalogFilter"></catalog-filter-dropdown></has-multicatalog><status-filter-dropdown (onSelectCallback)="statusFilterChange($event)" [initialValue]="statusFilter" class="perso-filter__wrapper perso-filter__wrapper--status"></status-filter-dropdown></div></div><personalization-infinite-scrolling [dropDownContainerClass]="'pe-customize-panel__wrapper'" [fetchPage]="getPage"><customizations-list [customizationsList]="customizationsList" [requestProcessing]="moreCustomizationsRequestProcessing"></customizations-list></personalization-infinite-scrolling></div></div></div></div>`});t.CustomizeViewComponent=class CustomizeViewComponent{constructor(e,t,i,o,n,s){this.toolbarItem=e;this.translateService=t;this.customizationDataFactory=i;this.personalizationsmarteditContextService=o;this.personalizationsmarteditMessageHandler=n;this.personalizationsmarteditUtils=s;this.getPage=()=>this.addMoreCustomizationItems()}ngOnInit(){this.personalizationsmarteditContextService.refreshExperienceData();this.moreCustomizationsRequestProcessing=false;this.customizationsList=this.customizationDataFactory.items;this.customizationDataFactory.resetData();this.pagination=new l.PaginationHelper({});this.pagination.reset();this.filters=this.personalizationsmarteditContextService.getCustomizeFiltersState();this.catalogFilter=this.filters.catalogFilter;this.pageFilter=this.filters.pageFilter;this.statusFilter=this.filters.statusFilter;this.nameFilter=this.filters.nameFilter;this.showResetButton=false;this.oldIsOpen=this.toolbarItem.isOpen}ngOnDestroy(){const e=this.personalizationsmarteditContextService.getCustomizeFiltersState();e.catalogFilter=this.catalogFilter;e.pageFilter=this.pageFilter;e.statusFilter=this.statusFilter;e.nameFilter=this.nameFilter;this.personalizationsmarteditContextService.setCustomizeFiltersState(e)}ngDoCheck(){if(this.toolbarItem.isOpen!==this.oldIsOpen){if(this.toolbarItem.isOpen){this.refreshList()}this.oldIsOpen=this.toolbarItem.isOpen}}catalogFilterChange(e){this.catalogFilter=e;this.refreshList()}pageFilterChange(e){this.pageFilter=e;this.refreshList()}statusFilterChange(e){this.statusFilter=e;this.refreshList()}nameInputKeypress(){if(this.nameFilter.length>0){this.showResetButton=true}if(this.nameFilter.length>2||this.nameFilter.length===0){this.refreshList()}}resetSearch(e){if(e){e.stopPropagation()}this.nameFilter="";this.showResetButton=false;this.refreshList()}addMoreCustomizationItems(){if(this.pagination.getPage()<this.pagination.getTotalPages()-1&&!this.moreCustomizationsRequestProcessing){this.moreCustomizationsRequestProcessing=true;this.getCustomizations(this.getCustomizationsFilterObject())}}errorCallback(){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcustomizations"));this.moreCustomizationsRequestProcessing=false}successCallback(e){this.pagination=new l.PaginationHelper(e.pagination);this.moreCustomizationsRequestProcessing=false}getStatus(){if(this.statusFilter===undefined){return this.personalizationsmarteditUtils.getStatusesMapping()[0]}return this.personalizationsmarteditUtils.getStatusesMapping().filter((e=>e.code===this.statusFilter))[0]}getCustomizations(e){const t={filter:e,dataArrayName:"customizations"};this.customizationDataFactory.updateData(t,this.successCallback.bind(this),this.errorCallback.bind(this))}getCustomizationsFilterObject(){const e={currentSize:this.pagination.getCount(),currentPage:this.pagination.getPage()+1,name:this.nameFilter,statuses:this.getStatus().modelStatuses,catalogs:this.catalogFilter};if(this.pageFilter===l.PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER.ONLY_THIS_PAGE){e.pageId=this.personalizationsmarteditContextService.getSeData().pageId;e.pageCatalogId=(this.personalizationsmarteditContextService.getSeData().seExperienceData.pageContext||{}).catalogId}return e}refreshList(){if(this.moreCustomizationsRequestProcessing===false){this.moreCustomizationsRequestProcessing=true;this.pagination.reset();this.customizationDataFactory.resetData();this.getCustomizations(this.getCustomizationsFilterObject())}}};t.CustomizeViewComponent=__decorate([n.Component({selector:"customize-view",template:`<div class="btn-block pe-toolbar-action--include"><div class="pe-toolbar-menu-content se-toolbar-menu-content--pe-customized-customizations-panel" role="menu"><div class="se-toolbar-menu-content--pe-customized__headers"><div class="se-toolbar-menu-content--pe-customized__headers--wrapper"><h2 class="se-toolbar-menu-content--pe-customized__headers--h2"><span translate="personalization.toolbar.pagecustomizations.header.title"></span> ({{pagination.totalCount}})</h2><se-help class="se-toolbar-menu-content__y-help"><span translate="personalization.toolbar.pagecustomizations.header.description"></span></se-help></div><div class="se-input-group se-component-search"><input type="text" id="customization-search-name" class="se-input-group--input se-component-search--input fd-input" [(ngModel)]="nameFilter" [placeholder]="'personalization.toolbar.pagecustomizations.search.placeholder' | translate" (ngModelChange)="nameInputKeypress()"/> <span class="sap-icon--search se-input-group__addon"></span><span *ngIf="showResetButton" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="resetSearch($event)"></span></div></div><div role="menuitem"><div id="personalizationsmartedit-right-toolbar-item-template"><div class="pe-customize-panel__filter-label-layout"><div class="pe-customize-panel__filter-layout"><page-filter-dropdown (onSelectCallback)="pageFilterChange($event)" [initialValue]="pageFilter" class="perso-filter__wrapper perso-filter__wrapper--page"></page-filter-dropdown><has-multicatalog class="perso-filter__wrapper perso-filter__wrapper--catalog"><catalog-filter-dropdown (onSelectCallback)="catalogFilterChange($event)" [initialValue]="catalogFilter"></catalog-filter-dropdown></has-multicatalog><status-filter-dropdown (onSelectCallback)="statusFilterChange($event)" [initialValue]="statusFilter" class="perso-filter__wrapper perso-filter__wrapper--status"></status-filter-dropdown></div></div><personalization-infinite-scrolling [dropDownContainerClass]="'pe-customize-panel__wrapper'" [fetchPage]="getPage"><customizations-list [customizationsList]="customizationsList" [requestProcessing]="moreCustomizationsRequestProcessing"></customizations-list></personalization-infinite-scrolling></div></div></div></div>`}),__param(0,n.Inject(d.TOOLBAR_ITEM)),__metadata("design:paramtypes",[Object,g.TranslateService,ee,t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditMessageHandler,l.PersonalizationsmarteditUtils])],t.CustomizeViewComponent);t.SePersonalizationsmarteditCustomizeViewModule=class SePersonalizationsmarteditCustomizeViewModule{};t.SePersonalizationsmarteditCustomizeViewModule=__decorate([n.NgModule({imports:[m.CommonModule,y.FormsModule,d.TranslationModule.forChild(),d.SharedComponentsModule,A.BusyIndicatorModule,t.SePersonalizationsmarteditServicesModule,te,J,l.PersonalizationsmarteditCommonsComponentsModule,R.MenuModule],declarations:[t.CustomizationsListComponent,t.CustomizeViewComponent],entryComponents:[t.CustomizationsListComponent,t.CustomizeViewComponent],providers:[t.CustomizeViewServiceProxy],exports:[]})],t.SePersonalizationsmarteditCustomizeViewModule);t.ManagerViewUtilsService=class ManagerViewUtilsService{constructor(e,t,i,o,n,s){this.personalizationsmarteditRestService=e;this.personalizationsmarteditMessageHandler=t;this.personalizationsmarteditCommerceCustomizationService=i;this.waitDialogService=o;this.confirmationModalService=n;this.translateService=s}deleteCustomizationAction(e,t){return __awaiter(this,void 0,void 0,(function*(){yield this.confirmationModalService.confirm({description:"personalization.modal.manager.deletecustomization.content"});try{const i=yield this.personalizationsmarteditRestService.getCustomization(e);yield this.markCustomizationAsDeleted(i,e,t)}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.deletingcustomization"))}}))}deleteVariationAction(e,t){return __awaiter(this,void 0,void 0,(function*(){yield this.confirmationModalService.confirm({description:"personalization.modal.manager.deletevariation.content"});try{const i=yield this.personalizationsmarteditRestService.getVariation(e.code,t.code);i.status=l.PERSONALIZATION_MODEL_STATUS_CODES.DELETED;yield this.updateVariationStatus(i,t,e)}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.deletingvariation"))}}))}toggleVariationActive(e,t){return __awaiter(this,void 0,void 0,(function*(){try{const i=yield this.personalizationsmarteditRestService.getVariation(e.code,t.code);i.enabled=!i.enabled;i.status=i.enabled?l.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED:l.PERSONALIZATION_MODEL_STATUS_CODES.DISABLED;yield this.updateVariationStatusAndEnablement(i,t,e)}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingvariation"))}}))}customizationClickAction(e){return __awaiter(this,void 0,void 0,(function*(){try{const t=yield this.personalizationsmarteditRestService.getVariationsForCustomization(e.code,e);e.variations.forEach((e=>{e.actions=this.getActionsForVariation(e.code,t.variations);e.numberOfComponents=this.personalizationsmarteditCommerceCustomizationService.getNonCommerceActionsCount(e);e.commerceCustomizations=this.personalizationsmarteditCommerceCustomizationService.getCommerceActionsCountMap(e);e.numberOfCommerceActions=this.personalizationsmarteditCommerceCustomizationService.getCommerceActionsCount(e)}))}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingcustomization"))}}))}getCustomizations(e){return this.personalizationsmarteditRestService.getCustomizations(e)}updateCustomizationRank(e,t){return this.personalizationsmarteditRestService.updateCustomizationRank(e,t).catch((()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.updatingcustomization"))}))}updateVariationRank(e,t,i){return __awaiter(this,void 0,void 0,(function*(){try{const o=yield this.personalizationsmarteditRestService.getVariation(e.code,t);o.rank=o.rank+i;return this.personalizationsmarteditRestService.editVariation(e.code,o).catch((()=>{this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.editingvariation"))}))}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.gettingvariation"))}}))}setCustomizationRank(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=i[i.indexOf(e)+t];this.waitDialogService.showWaitModal();try{yield this.updateCustomizationRank(e.code,o.rank-e.rank);e.rank+=t;o.rank-=t;const n=i.indexOf(e);const s=i.splice(n,1);i.splice(n+t,0,s[0]);this.waitDialogService.hideWaitModal()}catch(e){this.waitDialogService.hideWaitModal()}}))}setVariationRank(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=e.variations[e.variations.indexOf(t)+i];this.waitDialogService.showWaitModal();try{yield this.updateVariationRank(e,t.code,i);t.rank+=i;o.rank-=i;const n=e.variations.indexOf(t);const s=e.variations.splice(n,1);e.variations.splice(n+i,0,s[0])}catch(e){console.log("Unexpected error occurred while updating variation rank",e)}finally{this.waitDialogService.hideWaitModal()}}))}getActionsForVariation(e,t){t=t||[];const i=t.filter((t=>e===t.code))[0];return i?i.actions:[]}markCustomizationAsDeleted(e,t,i){return __awaiter(this,void 0,void 0,(function*(){e.status=l.PERSONALIZATION_MODEL_STATUS_CODES.DELETED;try{yield this.personalizationsmarteditRestService.updateCustomization(e);i.splice(i.indexOf(t),1)}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.deletingcustomization"))}}))}updateVariationStatus(e,t,i){return __awaiter(this,void 0,void 0,(function*(){try{const o=yield this.personalizationsmarteditRestService.editVariation(i.code,e);t.status=o.status}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.deletingvariation"))}}))}updateVariationStatusAndEnablement(e,t,i){return __awaiter(this,void 0,void 0,(function*(){try{const o=yield this.personalizationsmarteditRestService.editVariation(i.code,e);t.enabled=o.enabled;t.status=o.status}catch(e){this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalization.error.editingvariation"))}}))}};t.ManagerViewUtilsService=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.PersonalizationsmarteditRestService,l.PersonalizationsmarteditMessageHandler,l.PersonalizationsmarteditCommerceCustomizationService,d.IWaitDialogService,d.IConfirmationModalService,g.TranslateService])],t.ManagerViewUtilsService);window.__smartedit__.addDecoratorPayload("Component","ManagerViewComponent",{selector:"customizations-list",template:`<div id="editConfigurationsBody-001" class="perso-library"><personalization-infinite-scrolling [fetchPage]="getPage"><div #managerScrollZone id="managerScrollZone" class="perso-library__scroll-zone perso__scrollbar--hidden"><div class="perso-library__header"><div class="perso-library__title"><span [textContent]="catalogName"></span> | {{'personalization.toolbar.pagecustomizations.header.title' | translate}} ({{pagination.totalCount}})</div><div class="se-input-group"><div class="perso-input-group"><input fd-form-control id="customizationSearchInput" name="customizationSearchInput" type="text" class="se-input-group--input se-component-search--input" [placeholder]="'personalization.modal.manager.search.placeholder' | translate" [(ngModel)]="customizationSearch.name" (ngModelChange)="searchInputKeypress()"><span class="sap-icon--search se-input-group__addon"></span><span *ngIf="showResetButton" (click)="resetSearch($event)" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline"></span></div></div><status-filter-dropdown (onSelectCallback)="statusFilterChange($event)" [initialValue]="customizationSearch.status" class="perso-library__header-space"></status-filter-dropdown><div class="perso-library__header-space"><button class="fd-button" type="button" id="ps_manager_add_btn" (click)="openNewModal()"><span translate="personalization.modal.manager.add.button"></span></button></div></div><div class="y-tree perso-library__y-tree"><div class="y-tree-header"><manager-view-grid-header></manager-view-grid-header></div><manager-view-tree [customizations]="customizations"></manager-view-tree><div *ngIf="moreCustomizationsRequestProcessing" class="se-spinner fd-busy-indicator-extended"><div class="spinner"><fd-busy-indicator [loading]="true" size="m"></fd-busy-indicator></div></div></div></div></personalization-infinite-scrolling><personalizationsmartedit-scroll-zone *ngIf="scrollZoneElement != null && elementToScroll" [isTransparent]="true" [scrollZoneVisible]="scrollZoneVisible" [elementToScroll]="elementToScroll"></personalizationsmartedit-scroll-zone><a class="perso-library__back-to-top fd-link" translate="personalization.commons.button.title.backtotop" [hidden]="!isReturnToTopButtonVisible()" (click)="scrollZoneReturnToTop()"><span class="sap-icon--back-to-top"></span></a></div>`,styles:[`.se-component-search--input{margin:0}.perso-library__y-tree .fd-busy-indicator-extended{margin-top:0;margin-bottom:0}`]});t.ManagerViewComponent=class ManagerViewComponent{constructor(e,t,i,o,n,s,a){this.translateService=e;this.managerViewUtilsService=t;this.messageHandler=i;this.contextService=o;this.utils=n;this.manageCustomizationViewManager=s;this.systemEventService=a;this.getPage=()=>this.addMoreItems();const r=this.contextService.getSeData().seExperienceData;const d=r.languageDescriptor.isocode;this.catalogName=`${r.catalogDescriptor.name[d]} - ${r.catalogDescriptor.catalogVersion}`;this.customizations=[];this.showResetButton=false;this.customizationSearch={name:"",status:""};this.moreCustomizationsRequestProcessing=false;this.pagination=new l.PaginationHelper;this.pagination.reset();this.scrollZoneObject={scrollZoneElement:undefined,filteredCustomizationsCount:0}}ngOnDestroy(){if(this.customizationsModifiedUnsubscribe){this.customizationsModifiedUnsubscribe()}}ngOnInit(){this.customizationsModifiedUnsubscribe=this.systemEventService.subscribe("CUSTOMIZATIONS_MODIFIED",(()=>{this.refreshGrid()}))}ngAfterViewInit(){this.scrollZoneObject.scrollZoneElement=this.managerScrollZone.nativeElement}searchInputKeypress(){if(this.customizationSearch.name.length>0){this.showResetButton=true}if(this.customizationSearch.name.length>2||this.customizationSearch.name.length===0){this.refreshGrid()}}resetSearch(e){if(e){e.stopPropagation()}this.customizationSearch.name="";this.showResetButton=false;this.refreshGrid()}statusFilterChange(e){this.customizationSearch.status=e;this.refreshGrid()}addMoreItems(){if(this.pagination.getPage()<this.pagination.getTotalPages()-1&&!this.moreCustomizationsRequestProcessing){this.moreCustomizationsRequestProcessing=true;this.getCustomizations(this.getCustomizationsFilterObject())}}openNewModal(){this.manageCustomizationViewManager.openCreateCustomizationModal()}isSearchGridHeaderHidden(){if(!this.scrollZoneObject.scrollZoneElement){return false}return this.scrollZoneObject.scrollZoneElement.scrollTop>=120}scrollZoneReturnToTop(){setTimeout((()=>{this.scrollZoneObject.scrollZoneElement.scrollTop=0}),500)}isReturnToTopButtonVisible(){if(!this.scrollZoneObject.scrollZoneElement){return false}else{return this.scrollZoneObject.scrollZoneElement.scrollTop>50}}refreshGrid(){this.pagination.reset();this.customizations=[];this.addMoreItems()}getCustomizations(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.managerViewUtilsService.getCustomizations(e);try{this.utils.uniqueArray(this.customizations,t.customizations||[]);this.scrollZoneObject.filteredCustomizationsCount=t.pagination.totalCount;this.pagination=new l.PaginationHelper(t.pagination);this.moreCustomizationsRequestProcessing=false}catch(e){this.messageHandler.sendError(this.translateService.instant("personalization.error.gettingcustomizations"));this.moreCustomizationsRequestProcessing=false}}))}getCustomizationsFilterObject(){return{active:"all",name:this.customizationSearch.name,currentSize:this.pagination.getCount(),currentPage:this.pagination.getPage()+1,statuses:this.getStatus().modelStatuses}}getStatus(){if(this.customizationSearch.status===""){return this.utils.getStatusesMapping()[0]}return this.utils.getStatusesMapping().filter((e=>e.code===this.customizationSearch.status))[0]}};__decorate([n.ViewChild("managerScrollZone",{static:false}),__metadata("design:type",n.ElementRef)],t.ManagerViewComponent.prototype,"managerScrollZone",void 0);t.ManagerViewComponent=__decorate([n.Component({selector:"customizations-list",template:`<div id="editConfigurationsBody-001" class="perso-library"><personalization-infinite-scrolling [fetchPage]="getPage"><div #managerScrollZone id="managerScrollZone" class="perso-library__scroll-zone perso__scrollbar--hidden"><div class="perso-library__header"><div class="perso-library__title"><span [textContent]="catalogName"></span> | {{'personalization.toolbar.pagecustomizations.header.title' | translate}} ({{pagination.totalCount}})</div><div class="se-input-group"><div class="perso-input-group"><input fd-form-control id="customizationSearchInput" name="customizationSearchInput" type="text" class="se-input-group--input se-component-search--input" [placeholder]="'personalization.modal.manager.search.placeholder' | translate" [(ngModel)]="customizationSearch.name" (ngModelChange)="searchInputKeypress()"><span class="sap-icon--search se-input-group__addon"></span><span *ngIf="showResetButton" (click)="resetSearch($event)" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline"></span></div></div><status-filter-dropdown (onSelectCallback)="statusFilterChange($event)" [initialValue]="customizationSearch.status" class="perso-library__header-space"></status-filter-dropdown><div class="perso-library__header-space"><button class="fd-button" type="button" id="ps_manager_add_btn" (click)="openNewModal()"><span translate="personalization.modal.manager.add.button"></span></button></div></div><div class="y-tree perso-library__y-tree"><div class="y-tree-header"><manager-view-grid-header></manager-view-grid-header></div><manager-view-tree [customizations]="customizations"></manager-view-tree><div *ngIf="moreCustomizationsRequestProcessing" class="se-spinner fd-busy-indicator-extended"><div class="spinner"><fd-busy-indicator [loading]="true" size="m"></fd-busy-indicator></div></div></div></div></personalization-infinite-scrolling><personalizationsmartedit-scroll-zone *ngIf="scrollZoneElement != null && elementToScroll" [isTransparent]="true" [scrollZoneVisible]="scrollZoneVisible" [elementToScroll]="elementToScroll"></personalizationsmartedit-scroll-zone><a class="perso-library__back-to-top fd-link" translate="personalization.commons.button.title.backtotop" [hidden]="!isReturnToTopButtonVisible()" (click)="scrollZoneReturnToTop()"><span class="sap-icon--back-to-top"></span></a></div>`,styles:[`.se-component-search--input{margin:0}.perso-library__y-tree .fd-busy-indicator-extended{margin-top:0;margin-bottom:0}`]}),__metadata("design:paramtypes",[g.TranslateService,t.ManagerViewUtilsService,l.PersonalizationsmarteditMessageHandler,t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditUtils,t.ManageCustomizationViewManager,d.SystemEventService])],t.ManagerViewComponent);window.__smartedit__.addDecoratorPayload("Component","ManagerViewGridHeader",{selector:"manager-view-grid-header",template:`\n        <div class="tree-head hidden-sm hidden-xs">\n            <div\n                class="tree-head__col--lg perso-wrap-ellipsis"\n                translate="personalization.modal.manager.grid.header.customization"\n                title="{{ 'personalization.modal.manager.grid.header.customization' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--xs"\n                translate="personalization.modal.manager.grid.header.variations"\n                title="{{ 'personalization.modal.manager.grid.header.variations' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--xs perso-wrap-ellipsis"\n                translate="personalization.modal.manager.grid.header.components"\n                title="{{ 'personalization.modal.manager.grid.header.components' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--md"\n                translate="personalization.modal.manager.grid.header.status"\n                title="{{ 'personalization.modal.manager.grid.header.status' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--sm perso-wrap-ellipsis"\n                translate="personalization.modal.manager.grid.header.startdate"\n                title="{{ 'personalization.modal.manager.grid.header.startdate' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--sm perso-wrap-ellipsis"\n                translate="personalization.modal.manager.grid.header.enddate"\n                title="{{ 'personalization.modal.manager.grid.header.enddate' | translate }}"\n            ></div>\n        </div>\n    `});let Ae=class ManagerViewGridHeader{};Ae=__decorate([n.Component({selector:"manager-view-grid-header",template:`\n        <div class="tree-head hidden-sm hidden-xs">\n            <div\n                class="tree-head__col--lg perso-wrap-ellipsis"\n                translate="personalization.modal.manager.grid.header.customization"\n                title="{{ 'personalization.modal.manager.grid.header.customization' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--xs"\n                translate="personalization.modal.manager.grid.header.variations"\n                title="{{ 'personalization.modal.manager.grid.header.variations' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--xs perso-wrap-ellipsis"\n                translate="personalization.modal.manager.grid.header.components"\n                title="{{ 'personalization.modal.manager.grid.header.components' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--md"\n                translate="personalization.modal.manager.grid.header.status"\n                title="{{ 'personalization.modal.manager.grid.header.status' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--sm perso-wrap-ellipsis"\n                translate="personalization.modal.manager.grid.header.startdate"\n                title="{{ 'personalization.modal.manager.grid.header.startdate' | translate }}"\n            ></div>\n            <div\n                class="tree-head__col--sm perso-wrap-ellipsis"\n                translate="personalization.modal.manager.grid.header.enddate"\n                title="{{ 'personalization.modal.manager.grid.header.enddate' | translate }}"\n            ></div>\n        </div>\n    `})],Ae);let xe=class ManagerViewService{constructor(e){this.modalService=e}openManagerAction(){this.modalService.open({templateConfig:{title:"personalization.modal.manager.title",isDismissButtonVisible:true},config:{height:"100%",width:"100%",dialogPanelClass:"perso-library",focusTrapped:false},component:t.ManagerViewComponent})}};xe=__decorate([n.Injectable(),__metadata("design:paramtypes",[d.IModalService])],xe);var De;(function(e){e["customization"]="CUSTOMIZATION";e["variation"]="VARIATION"})(De||(De={}));const Re="personalization.modal.manager";window.__smartedit__.addDecoratorPayload("Component","ManagerViewTreeComponent",{selector:"manager-view-tree",template:`<div cdkDropList [cdkDropListData]="customizations" [id]="treeRoot" [cdkDropListConnectedTo]="dragDroppedTargetIds" (cdkDropListDropped)="dragDropped($event)" [cdkDropListSortingDisabled]="true"><div *ngFor="let customization of customizations" cdkDrag [cdkDragData]="customization.code" (cdkDragMoved)="dragMoved($event)"><div class="node-item" [attr.data-id]="customization.code" [attr.type]="'CUSTOMIZATION'" [attr.id]=" 'node-' + customization.code"><div class="y-tree-row" [ngClass]="allCustomizationsCollapsed()? 'active-level' : 'inactive-level'"><div class="cdk-drag-row-layout desktop-layout hidden-sm hidden-xs customization-rank-{{customization.rank}}-row"><div (click)="customizationCollapseAction(customization)" class="expand-arrow"><a fd-link title="{{(customization.collapsed ? 'personalization.commons.icon.title.expand' : 'personalization.commons.icon.title.collapse') | translate}}"><span [ngClass]="customization.collapsed ? 'sap-icon--navigation-right-arrow' : 'sap-icon--navigation-down-arrow'" class="perso__toggle-icon"></span></a></div><div class="y-tree-row__angular-ui-tree-handle"><div class="y-tree__col--lg"><div class="perso-wrap-ellipsis perso-tree__primary-data" title="{{customization.name}}" [textContent]="customization.name"></div></div><div class="y-tree__col--xs" [textContent]="getStatusNotDeleted(customization) || 0"></div><div class="y-tree__col--xs"></div><div class="y-tree__col--md perso-tree__status" [ngClass]="getActivityStateForCustomization(customization)"><span [textContent]="getEnablementTextForCustomization(customization)"></span></div><div class="y-tree__col--sm"><div [hidden]="isNotEnabled(customization)" class="perso-tree__dates-layout"><span [textContent]="getFormattedDate(customization.enabledStartDate)" class="perso-library__status-layout"></span></div></div><div class="y-tree__col--sm"><div [hidden]="isNotEnabled(customization)" class="perso-tree__dates-layout"><span [textContent]="getFormattedDate(customization.enabledEndDate)"></span></div></div></div><fd-popover [isOpen]="customization.subMenu" [closeOnOutsideClick]="true" [triggers]="[]"><fd-popover-control><button type="button" class="fd-button--light fd-button" (click)="updateSubMenuAction(customization)" title="{{'personalization.modal.manager.customization.moremenu' | translate}}"><span class="perso__more-icon sap-icon--overflow"></span></button></fd-popover-control><fd-popover-body><div *ngIf="customization.subMenu" class="toolbar-action--include pe-manager-view-tree-more-list__dropdown"><div class="pe-manager-view-tree-more-list__item" (click)="clearAllCustomizationSubMenuAndEditCustomizationAction(customization)"><span class="pe-manager-view-tree-more-list__item-active" translate="personalization.modal.manager.customization.options.edit"></span></div><div class="pe-manager-view-tree-more-list__item" (click)="deleteCustomizationAction(customization)"><span class="pe-manager-view-tree-more-list__item-deletion" translate="personalization.modal.manager.customization.options.delete"></span></div></div></fd-popover-body></fd-popover></div></div></div><div *ngIf="!customization.collapsed" cdkDropList [cdkDropListData]="customization.variations" [id]="customization.code" [cdkDropListConnectedTo]="dropTargetIds" (cdkDropListDropped)="dragDropped($event)" [cdkDropListSortingDisabled]="true"><div *ngFor="let variation of customization.variations" cdkDrag [cdkDragData]="variation.code" (cdkDragMoved)="dragMoved($event)" class="y-tree-row child-row active-level"><div class="node-item" [attr.data-id]="variation.code" [attr.type]="'VARIATION'" [attr.id]=" 'node-' + variation.code"><div *ngIf="statusNotDeleted(variation)" class="cdk-drag-row-layout desktop-layout variation-rank-{{variation.rank}}-row hidden-sm hidden-xs"><div class="y-tree-row__angular-ui-tree-handle"><div class="y-tree__col--xl perso-wrap-ellipsis" title="{{variation.name}}"><div><se-tooltip *ngIf="hasCommerceActions(variation)" [triggers]="['mouseenter','mouseleave']"><span class="perso__cc-icon sap-icon--tag perso__cc-icon-padding" [ngClass]="{'perso__cc-icon--hidden': !hasCommerceActions(variation)}" se-tooltip-trigger></span> <span se-tooltip-body [textContent]="getCommerceCustomizationTooltip(variation)"></span></se-tooltip></div><span [textContent]="variation.name"></span></div><div class="y-tree__col--xs" [textContent]="variation.numberOfComponents"></div><div class="y-tree__col--md perso-tree__status" [ngClass]="getActivityStateForVariation(customization,variation)"><span [textContent]="getEnablementTextForVariation(variation)" class="perso-library__status-layout"></span></div><div class="y-tree__col--lg"></div></div><fd-popover [isOpen]="variation.subMenu" [closeOnOutsideClick]="true" [triggers]="[]"><fd-popover-control><button type="button" class="fd-button--light fd-button" (click)="updateSubMenuAction(variation)" title="{{'personalization.modal.manager.customization.moremenu' | translate}}"><span class="perso__more-icon sap-icon--overflow"></span></button></fd-popover-control><fd-popover-body><div *ngIf="variation.subMenu" class="toolbar-action--include pe-manager-view-tree-more-list__dropdown"><div class="pe-manager-view-tree-more-list__item" (click)="clearAllVariationSubMenuAndEditVariationAction(customization, variation)"><span class="pe-manager-view-tree-more-list__item-active" translate="personalization.modal.manager.variation.options.edit"></span></div><div class="pe-manager-view-tree-more-list__item" (click)="toogleVariationActive(customization,variation)"><span class="pe-manager-view-tree-more-list__item-active" [textContent]="getEnablementActionTextForVariation(variation)"></span></div><div [hidden]="!variation.isCommerceCustomizationEnabled" class="pe-manager-view-tree-more-list__item" (click)="clearAllVariationSubMenuAndmanageCommerceCustomization(customization, variation)"><span class="pe-manager-view-tree-more-list__item-active" translate="personalization.modal.manager.variation.options.commercecustomization"></span></div><div class="pe-manager-view-tree-more-list__item" (click)="deleteVariationAction(customization, variation, $event)"><span [ngClass]="isDeleteVariationEnabled(customization) ? 'pe-manager-view-tree-more-list__item-deletion' : 'pe-manager-view-tree-more-list__item-inactive' " translate="personalization.modal.manager.variation.options.delete"></span></div></div></fd-popover-body></fd-popover></div></div></div></div></div></div>`,styles:[`.cdk-drag-preview{z-index:2000!important}.cdk-drag-row-layout{display:flex}.pe-manager-view-tree-more-list__item{padding:10px 10px;cursor:pointer}.pe-manager-view-tree-more-list__item:first-child:hover{border-top-left-radius:var(--sapElement_BorderCornerRadius);border-top-right-radius:var(--sapElement_BorderCornerRadius)}.pe-manager-view-tree-more-list__item:last-child:hover{border-bottom-left-radius:var(--sapElement_BorderCornerRadius);border-bottom-right-radius:var(--sapElement_BorderCornerRadius)}.pe-manager-view-tree-more-list__item:hover{background-color:var(--sapList_Hover_Background);cursor:pointer}.pe-manager-view-tree-more-list__item-active{color:fd-color("text", 1);cursor:pointer}.pe-manager-view-tree-more-list__item-inactive{color:fd-color("text", 4);cursor:not-allowed}.pe-manager-view-tree-more-list__item-deletion{color:fd-color("status", 3);cursor:pointer}.pe-manager-view-tree-more-list__dropdown{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;left:initial!important;right:0}.pe-manager-view-tree-more-list__dropdown::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.pe-manager-view-tree-more-list__dropdown::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.pe-manager-view-tree-more-list__dropdown::after,.pe-manager-view-tree-more-list__dropdown::before{right:10px}.pe-manager-view-tree-more-list__dropdown::after,.pe-manager-view-tree-more-list__dropdown::before{display:none}.drop-before{border-top:1px solid #000;z-index:2000!important}.drop-after{border-bottom:1px solid #000;z-index:2000!important}.perso__cc-icon-padding{padding-right:15px}`],encapsulation:n.ViewEncapsulation.None});let Me=class ManagerViewTreeComponent{constructor(e,t,i,o,n,s,a,r,l){this.document=e;this.managerViewUtilsService=t;this.personalizationsmarteditUtils=i;this.personalizationsmarteditDateUtils=o;this.manageCustomizationViewManager=n;this.personalizationsmarteditCommerceCustomizationView=s;this.personalizationsmarteditCommerceCustomizationService=a;this.personalizationsmarteditContextService=r;this.waitDialogService=l;this.treeRoot="tree-root";this.uncollapsedCustomizations=[];this.customizationsPreCount=0;this.dropTargetIds=[];this.nodeLookup={};this.dropAction=null;this.dragMovedSubject=new u.Subject}ngOnDestroy(){var e;(e=this.dragMovedSubscription)===null||e===void 0?void 0:e.unsubscribe()}ngOnInit(){this.dragMovedSubscription=this.dragMovedSubject.pipe(_.debounceTime(50)).subscribe((e=>{this.performDragMoved(e)}))}ngDoCheck(){if(this.customizationsPreCount!==this.customizations.length){this.updateCustomizations();this.resetCustomizationsDragDrop();this.updateCustomizationsDragDrop(this.customizations,0);this.customizationsPreCount=this.customizations.length}}dragMoved(e){this.dragMovedSubject.next(e)}dragDropped(e){const t=e.item.data;const i=this.dropAction.targetId;const o=e.previousContainer.id;const n=this.getParentNodeId(i,this.customizations,this.treeRoot);if(!this.dropAction.action||this.nodeLookup[t].itemLevel!==this.nodeLookup[i].itemLevel||o!==n){return}const s=this.getDropItem(this.dropAction.itemType,t,n,this.customizations);const a=this.nodeLookup[t];const l=o!==this.treeRoot?this.nodeLookup[o].variations:this.customizations;const d=n!==this.treeRoot?this.nodeLookup[n].variations:this.customizations;const p=l.findIndex((e=>e.code===t));l.splice(p,1);const m=d.findIndex((e=>e.code===this.dropAction.targetId));if(this.dropAction.action==="before"){d.splice(m,0,a)}else{d.splice(m+1,0,a)}d.forEach(((e,t)=>e.rank=t));if(this.dropAction.itemType===De.customization){this.updateChangedCustomization(s,d)}else if(this.dropAction.itemType===De.variation){const e=r.cloneDeep(this.nodeLookup[n]);this.updateChangedVariation(e,s,d)}this.clearDragInfo(true)}customizationCollapseAction(e){this.clearAllCustomizationSubMenu();this.clearAllVariationSubMenu();e.collapsed=!e.collapsed;if(e.collapsed===false){this.uncollapsedCustomizations.push(e.code)}else{this.uncollapsedCustomizations.splice(this.uncollapsedCustomizations.indexOf(e.code),1)}this.updateCustomizationVariations(e);this.resetCustomizationsDragDrop();this.updateCustomizationsDragDrop(this.customizations,0)}allCustomizationsCollapsed(){return this.customizations.map((e=>e.collapsed)).reduce(((e,t)=>e&&t),true)}getStatusNotDeleted(e){return e.variations.filter((e=>this.personalizationsmarteditUtils.isItemVisible(e))).length}getActivityStateForCustomization(e){return this.personalizationsmarteditUtils.getActivityStateForCustomization(e)}getEnablementTextForCustomization(e){return this.personalizationsmarteditUtils.getEnablementTextForCustomization(e,Re)}getFormattedDate(e){return e?this.personalizationsmarteditDateUtils.formatDate(e,null):""}clearAllCustomizationSubMenuAndEditCustomizationAction(e){this.clearAllCustomizationSubMenu();this.editCustomizationAction(e)}clearAllVariationSubMenuAndEditVariationAction(e,t){this.clearAllVariationSubMenu();this.editVariationAction(e,t)}clearAllVariationSubMenuAndmanageCommerceCustomization(e,t){this.clearAllVariationSubMenu();this.manageCommerceCustomization(e,t)}editCustomizationAction(e){this.manageCustomizationViewManager.openEditCustomizationModal(e.code,null)}isNotEnabled(e){return e.status!==l.PERSONALIZATION_MODEL_STATUS_CODES.ENABLED}deleteCustomizationAction(e){this.managerViewUtilsService.deleteCustomizationAction(e,this.customizations)}updateSubMenuAction(e){if(!e.subMenu){this.clearAllCustomizationSubMenu();this.clearAllVariationSubMenu()}e.subMenu=!e.subMenu}clearAllCustomizationSubMenu(){for(const e of this.customizations){e.subMenu=false}}clearAllVariationSubMenu(){for(const e of this.customizations){for(const t of e.variations){t.subMenu=false}}}hasCommerceActions(e){return this.personalizationsmarteditUtils.hasCommerceActions(e)}getCommerceCustomizationTooltip(e){return this.personalizationsmarteditUtils.getCommerceCustomizationTooltip(e,"","")}getActivityStateForVariation(e,t){return this.personalizationsmarteditUtils.getActivityStateForVariation(e,t)}getEnablementTextForVariation(e){return this.personalizationsmarteditUtils.getEnablementTextForVariation(e,Re)}editVariationAction(e,t){this.manageCustomizationViewManager.openEditCustomizationModal(e.code,t.code)}toogleVariationActive(e,t){this.managerViewUtilsService.toggleVariationActive(e,t)}getEnablementActionTextForVariation(e){return this.personalizationsmarteditUtils.getEnablementActionTextForVariation(e,Re)}manageCommerceCustomization(e,t){this.personalizationsmarteditCommerceCustomizationView.openCommerceCustomizationAction(e,t)}isDeleteVariationEnabled(e){return this.personalizationsmarteditUtils.getVisibleItems(e.variations).length>1}deleteVariationAction(e,t,i){if(this.isDeleteVariationEnabled(e)){this.clearAllVariationSubMenu();this.managerViewUtilsService.deleteVariationAction(e,t)}else{i.stopPropagation()}}statusNotDeleted(e){return this.personalizationsmarteditUtils.isItemVisible(e)}performDragMoved(e){this.clearAllCustomizationSubMenu();this.clearAllVariationSubMenu();const t=this.document.elementFromPoint(e.pointerPosition.x,e.pointerPosition.y);if(!t){this.clearDragInfo();return}const i=t.classList.contains("node-item")?t:t.closest(".node-item");if(!i){this.clearDragInfo();return}this.dropAction={targetId:i.getAttribute("data-id")};this.dropAction.itemType=i.getAttribute("type");const o=i.getBoundingClientRect();const n=o.height/2;if(e.pointerPosition.y-o.top<n){this.dropAction.action="before"}else if(e.pointerPosition.y-o.top>n){this.dropAction.action="after"}this.showDragInfo()}resetCustomizationsDragDrop(){this.dropTargetIds.length=0;this.nodeLookup={}}updateCustomizationsDragDrop(e,t){e.forEach((e=>{this.dropTargetIds.push(e.code);this.nodeLookup[e.code]=e;this.nodeLookup[e.code].itemLevel=t;if(e.variations){this.updateCustomizationsDragDrop(e.variations,t+1)}}))}getParentNodeId(e,t,i){for(const o of t){if(o.code===e){return i}if(o.variations){const t=this.getParentNodeId(e,o.variations,o.code);if(t){return t}}}return null}updateCustomizations(){this.customizations.forEach((e=>{if(this.uncollapsedCustomizations.includes(e.code)){e.collapsed=false;this.updateCustomizationVariations(e)}else{e.collapsed=true}}))}showDragInfo(){this.clearDragInfo();if(this.dropAction){this.document.getElementById("node-"+this.dropAction.targetId).classList.add("drop-"+this.dropAction.action)}}clearDragInfo(e=false){if(e){this.dropAction=null}this.document.querySelectorAll(".drop-before").forEach((e=>e.classList.remove("drop-before")));this.document.querySelectorAll(".drop-after").forEach((e=>e.classList.remove("drop-after")))}isCommerceCustomizationEnabled(){return this.personalizationsmarteditCommerceCustomizationService.isCommerceCustomizationEnabled(this.personalizationsmarteditContextService.getSeData().seConfigurationData)}updateCustomizationVariations(e){this.managerViewUtilsService.customizationClickAction(e);const t=this.isCommerceCustomizationEnabled();e.variations.forEach((e=>{e.statusNotDeleted=this.statusNotDeleted(e);e.isCommerceCustomizationEnabled=t}))}updateChangedVariation(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=i.filter((e=>e.code===t.code))[0].rank;const n=o-t.rank;if(n!==0){this.waitDialogService.showWaitModal();yield this.updateVariationRank(e,t.code,n);this.waitDialogService.hideWaitModal()}}))}updateChangedCustomization(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=t.filter((t=>t.code===e.code))[0].rank;const o=i-e.rank;if(o!==0){this.waitDialogService.showWaitModal();yield this.updateCustomizationRank(e.code,o);this.waitDialogService.hideWaitModal()}}))}updateCustomizationRank(e,t){return this.managerViewUtilsService.updateCustomizationRank(e,t)}updateVariationRank(e,t,i){return this.managerViewUtilsService.updateVariationRank(e,t,i)}getDropItem(e,t,i,o){if(e===De.customization){return r.cloneDeep(o.filter((e=>e.code===t))[0])}else if(e===De.variation){const e=o.filter((e=>e.code===i))[0];return r.cloneDeep(e.variations.filter((e=>e.code===t))[0])}}};__decorate([n.Input(),__metadata("design:type",Array)],Me.prototype,"customizations",void 0);Me=__decorate([n.Component({selector:"manager-view-tree",template:`<div cdkDropList [cdkDropListData]="customizations" [id]="treeRoot" [cdkDropListConnectedTo]="dragDroppedTargetIds" (cdkDropListDropped)="dragDropped($event)" [cdkDropListSortingDisabled]="true"><div *ngFor="let customization of customizations" cdkDrag [cdkDragData]="customization.code" (cdkDragMoved)="dragMoved($event)"><div class="node-item" [attr.data-id]="customization.code" [attr.type]="'CUSTOMIZATION'" [attr.id]=" 'node-' + customization.code"><div class="y-tree-row" [ngClass]="allCustomizationsCollapsed()? 'active-level' : 'inactive-level'"><div class="cdk-drag-row-layout desktop-layout hidden-sm hidden-xs customization-rank-{{customization.rank}}-row"><div (click)="customizationCollapseAction(customization)" class="expand-arrow"><a fd-link title="{{(customization.collapsed ? 'personalization.commons.icon.title.expand' : 'personalization.commons.icon.title.collapse') | translate}}"><span [ngClass]="customization.collapsed ? 'sap-icon--navigation-right-arrow' : 'sap-icon--navigation-down-arrow'" class="perso__toggle-icon"></span></a></div><div class="y-tree-row__angular-ui-tree-handle"><div class="y-tree__col--lg"><div class="perso-wrap-ellipsis perso-tree__primary-data" title="{{customization.name}}" [textContent]="customization.name"></div></div><div class="y-tree__col--xs" [textContent]="getStatusNotDeleted(customization) || 0"></div><div class="y-tree__col--xs"></div><div class="y-tree__col--md perso-tree__status" [ngClass]="getActivityStateForCustomization(customization)"><span [textContent]="getEnablementTextForCustomization(customization)"></span></div><div class="y-tree__col--sm"><div [hidden]="isNotEnabled(customization)" class="perso-tree__dates-layout"><span [textContent]="getFormattedDate(customization.enabledStartDate)" class="perso-library__status-layout"></span></div></div><div class="y-tree__col--sm"><div [hidden]="isNotEnabled(customization)" class="perso-tree__dates-layout"><span [textContent]="getFormattedDate(customization.enabledEndDate)"></span></div></div></div><fd-popover [isOpen]="customization.subMenu" [closeOnOutsideClick]="true" [triggers]="[]"><fd-popover-control><button type="button" class="fd-button--light fd-button" (click)="updateSubMenuAction(customization)" title="{{'personalization.modal.manager.customization.moremenu' | translate}}"><span class="perso__more-icon sap-icon--overflow"></span></button></fd-popover-control><fd-popover-body><div *ngIf="customization.subMenu" class="toolbar-action--include pe-manager-view-tree-more-list__dropdown"><div class="pe-manager-view-tree-more-list__item" (click)="clearAllCustomizationSubMenuAndEditCustomizationAction(customization)"><span class="pe-manager-view-tree-more-list__item-active" translate="personalization.modal.manager.customization.options.edit"></span></div><div class="pe-manager-view-tree-more-list__item" (click)="deleteCustomizationAction(customization)"><span class="pe-manager-view-tree-more-list__item-deletion" translate="personalization.modal.manager.customization.options.delete"></span></div></div></fd-popover-body></fd-popover></div></div></div><div *ngIf="!customization.collapsed" cdkDropList [cdkDropListData]="customization.variations" [id]="customization.code" [cdkDropListConnectedTo]="dropTargetIds" (cdkDropListDropped)="dragDropped($event)" [cdkDropListSortingDisabled]="true"><div *ngFor="let variation of customization.variations" cdkDrag [cdkDragData]="variation.code" (cdkDragMoved)="dragMoved($event)" class="y-tree-row child-row active-level"><div class="node-item" [attr.data-id]="variation.code" [attr.type]="'VARIATION'" [attr.id]=" 'node-' + variation.code"><div *ngIf="statusNotDeleted(variation)" class="cdk-drag-row-layout desktop-layout variation-rank-{{variation.rank}}-row hidden-sm hidden-xs"><div class="y-tree-row__angular-ui-tree-handle"><div class="y-tree__col--xl perso-wrap-ellipsis" title="{{variation.name}}"><div><se-tooltip *ngIf="hasCommerceActions(variation)" [triggers]="['mouseenter','mouseleave']"><span class="perso__cc-icon sap-icon--tag perso__cc-icon-padding" [ngClass]="{'perso__cc-icon--hidden': !hasCommerceActions(variation)}" se-tooltip-trigger></span> <span se-tooltip-body [textContent]="getCommerceCustomizationTooltip(variation)"></span></se-tooltip></div><span [textContent]="variation.name"></span></div><div class="y-tree__col--xs" [textContent]="variation.numberOfComponents"></div><div class="y-tree__col--md perso-tree__status" [ngClass]="getActivityStateForVariation(customization,variation)"><span [textContent]="getEnablementTextForVariation(variation)" class="perso-library__status-layout"></span></div><div class="y-tree__col--lg"></div></div><fd-popover [isOpen]="variation.subMenu" [closeOnOutsideClick]="true" [triggers]="[]"><fd-popover-control><button type="button" class="fd-button--light fd-button" (click)="updateSubMenuAction(variation)" title="{{'personalization.modal.manager.customization.moremenu' | translate}}"><span class="perso__more-icon sap-icon--overflow"></span></button></fd-popover-control><fd-popover-body><div *ngIf="variation.subMenu" class="toolbar-action--include pe-manager-view-tree-more-list__dropdown"><div class="pe-manager-view-tree-more-list__item" (click)="clearAllVariationSubMenuAndEditVariationAction(customization, variation)"><span class="pe-manager-view-tree-more-list__item-active" translate="personalization.modal.manager.variation.options.edit"></span></div><div class="pe-manager-view-tree-more-list__item" (click)="toogleVariationActive(customization,variation)"><span class="pe-manager-view-tree-more-list__item-active" [textContent]="getEnablementActionTextForVariation(variation)"></span></div><div [hidden]="!variation.isCommerceCustomizationEnabled" class="pe-manager-view-tree-more-list__item" (click)="clearAllVariationSubMenuAndmanageCommerceCustomization(customization, variation)"><span class="pe-manager-view-tree-more-list__item-active" translate="personalization.modal.manager.variation.options.commercecustomization"></span></div><div class="pe-manager-view-tree-more-list__item" (click)="deleteVariationAction(customization, variation, $event)"><span [ngClass]="isDeleteVariationEnabled(customization) ? 'pe-manager-view-tree-more-list__item-deletion' : 'pe-manager-view-tree-more-list__item-inactive' " translate="personalization.modal.manager.variation.options.delete"></span></div></div></fd-popover-body></fd-popover></div></div></div></div></div></div>`,styles:[`.cdk-drag-preview{z-index:2000!important}.cdk-drag-row-layout{display:flex}.pe-manager-view-tree-more-list__item{padding:10px 10px;cursor:pointer}.pe-manager-view-tree-more-list__item:first-child:hover{border-top-left-radius:var(--sapElement_BorderCornerRadius);border-top-right-radius:var(--sapElement_BorderCornerRadius)}.pe-manager-view-tree-more-list__item:last-child:hover{border-bottom-left-radius:var(--sapElement_BorderCornerRadius);border-bottom-right-radius:var(--sapElement_BorderCornerRadius)}.pe-manager-view-tree-more-list__item:hover{background-color:var(--sapList_Hover_Background);cursor:pointer}.pe-manager-view-tree-more-list__item-active{color:fd-color("text", 1);cursor:pointer}.pe-manager-view-tree-more-list__item-inactive{color:fd-color("text", 4);cursor:not-allowed}.pe-manager-view-tree-more-list__item-deletion{color:fd-color("status", 3);cursor:pointer}.pe-manager-view-tree-more-list__dropdown{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;left:initial!important;right:0}.pe-manager-view-tree-more-list__dropdown::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.pe-manager-view-tree-more-list__dropdown::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.pe-manager-view-tree-more-list__dropdown::after,.pe-manager-view-tree-more-list__dropdown::before{right:10px}.pe-manager-view-tree-more-list__dropdown::after,.pe-manager-view-tree-more-list__dropdown::before{display:none}.drop-before{border-top:1px solid #000;z-index:2000!important}.drop-after{border-bottom:1px solid #000;z-index:2000!important}.perso__cc-icon-padding{padding-right:15px}`],encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(m.DOCUMENT)),__metadata("design:paramtypes",[Document,t.ManagerViewUtilsService,l.PersonalizationsmarteditUtils,l.PersonalizationsmarteditDateUtils,t.ManageCustomizationViewManager,t.PersonalizationsmarteditCommerceCustomizationView,l.PersonalizationsmarteditCommerceCustomizationService,t.PersonalizationsmarteditContextService,d.IWaitDialogService])],Me);let ke=class ManagerViewModule{};ke=__decorate([n.NgModule({imports:[d.TranslationModule.forChild(),m.CommonModule,d.SelectModule,d.TooltipModule,l.ScrollZoneModule,y.FormsModule,v.FormModule,w.DragDropModule,E.PopoverModule,A.BusyIndicatorModule,l.PersonalizationsmarteditCommonsComponentsModule,J],declarations:[t.ManagerViewComponent,Ae,Me],entryComponents:[t.ManagerViewComponent,Ae,Me],providers:[t.ManagerViewUtilsService,xe]})],ke);window.__smartedit__.addDecoratorPayload("Component","CombinedViewToolbarContextComponent",{selector:"combined-view-toolbar-context",template:`<div *ngIf="visible" class="pe-toolbar-item-context"><span class="sap-icon--slim-arrow-right pe-toolbar-item-context__icon"></span><div class="pe-toolbar-item-context__btn"><div class="pe-toolbar-item-context__btn-txt"><div title="{{title}}" class="perso-wrap-ellipsis pe-toolbar-item-context__btn-title">{{title}}</div><div title="{{subtitle}}" class="perso-wrap-ellipsis pe-toolbar-item-context__btn-subtitle">{{subtitle}}</div></div></div><div class="pe-toolbar-item-context__btn-hyicon" (click)="clear()"><span class="sap-icon--decline"></span></div></div>`});let Ne=class CombinedViewToolbarContextComponent{constructor(e,t,i,o){this.combinedViewCommonsService=e;this.personalizationsmarteditContextService=t;this.personalizationsmarteditContextUtils=i;this.crossFrameEventService=o}ngOnInit(){const e=this.personalizationsmarteditContextService.getCombinedView();this.visible=false;this.selectedCustomization=N.cloneDeep(e.customize.selectedCustomization);if(this.selectedCustomization){this.title=e.customize.selectedCustomization.name;this.subtitle=e.customize.selectedVariations.name;this.visible=true}this.oldSelectedCustomization=e.customize.selectedCustomization;this.oldSelectedCustomizationEnabled=e.enabled}ngDoCheck(){const e=this.personalizationsmarteditContextService.getCombinedView();const t=e.customize.selectedCustomization;if(t&&t!==this.oldSelectedCustomization){this.oldSelectedCustomization=t;this.title=t.name;this.subtitle=e.customize.selectedVariations.name;this.visible=true;this.crossFrameEventService.publish(d.SHOW_TOOLBAR_ITEM_CONTEXT,l.COMBINED_VIEW_TOOLBAR_ITEM_KEY)}else if(!t){this.visible=false;this.crossFrameEventService.publish(d.HIDE_TOOLBAR_ITEM_CONTEXT,l.COMBINED_VIEW_TOOLBAR_ITEM_KEY)}const i=e.enabled;if(i&&i!==this.oldSelectedCustomizationEnabled){this.oldSelectedCustomizationEnabled=i;this.personalizationsmarteditContextUtils.clearCombinedViewCustomizeContext(this.personalizationsmarteditContextService)}}clear(){this.personalizationsmarteditContextUtils.clearCombinedViewCustomizeContext(this.personalizationsmarteditContextService);const e=this.personalizationsmarteditContextService.getCombinedView();const t=[];(e.selectedItems||[]).forEach((e=>{t.push({customizationCode:e.customization.code,variationCode:e.variation.code,catalog:e.variation.catalog,catalogVersion:e.variation.catalogVersion})}));this.combinedViewCommonsService.updatePreview(t);this.crossFrameEventService.publish(d.HIDE_TOOLBAR_ITEM_CONTEXT,l.COMBINED_VIEW_TOOLBAR_ITEM_KEY)}};Ne=__decorate([n.Component({selector:"combined-view-toolbar-context",template:`<div *ngIf="visible" class="pe-toolbar-item-context"><span class="sap-icon--slim-arrow-right pe-toolbar-item-context__icon"></span><div class="pe-toolbar-item-context__btn"><div class="pe-toolbar-item-context__btn-txt"><div title="{{title}}" class="perso-wrap-ellipsis pe-toolbar-item-context__btn-title">{{title}}</div><div title="{{subtitle}}" class="perso-wrap-ellipsis pe-toolbar-item-context__btn-subtitle">{{subtitle}}</div></div></div><div class="pe-toolbar-item-context__btn-hyicon" (click)="clear()"><span class="sap-icon--decline"></span></div></div>`}),__metadata("design:paramtypes",[t.CombinedViewCommonsService,t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditContextUtils,d.CrossFrameEventService])],Ne);window.__smartedit__.addDecoratorPayload("Component","CustomizeToolbarContextComponent",{selector:"personalizationsmartedit-customize-toolbar-context",template:`<div *ngIf="visible" class="pe-toolbar-item-context"><span class="sap-icon--slim-arrow-right pe-toolbar-item-context__icon"></span><div class="pe-toolbar-item-context__btn"><div class="pe-toolbar-item-context__btn-txt"><div title="{{title}}" class="perso-wrap-ellipsis pe-toolbar-item-context__btn-title">{{title}}</div><div title="{{subtitle}}" class="perso-wrap-ellipsis pe-toolbar-item-context__btn-subtitle">{{subtitle}}</div></div></div><div class="pe-toolbar-item-context__btn-hyicon" (click)="clear()"><span class="sap-icon--decline"></span></div></div>`});let Fe=class CustomizeToolbarContextComponent{constructor(e,t,i,o){this.personalizationsmarteditContextService=e;this.personalizationsmarteditContextUtils=t;this.personalizationsmarteditPreviewService=i;this.crossFrameEventService=o}ngOnInit(){this.selectedCustomization=N.cloneDeep(this.personalizationsmarteditContextService.getCustomize().selectedCustomization);this.selectedVariations=N.cloneDeep(this.personalizationsmarteditContextService.getCustomize().selectedVariations);this.visible=false;if(this.selectedCustomization){this.title=this.personalizationsmarteditContextService.getCustomize().selectedCustomization.name;this.visible=true;if(!N.isArray(this.selectedVariations)){this.subtitle=this.selectedVariations.name}}this.oldSelectedCustomization=this.personalizationsmarteditContextService.getCustomize().selectedCustomization;this.oldSelectedVariations=this.personalizationsmarteditContextService.getCustomize().selectedVariations}ngDoCheck(){const e=this.personalizationsmarteditContextService.getCustomize().selectedCustomization;if(e&&e!==this.oldSelectedCustomization){this.oldSelectedCustomization=e;this.title=e.name;this.visible=true;this.crossFrameEventService.publish(d.SHOW_TOOLBAR_ITEM_CONTEXT,l.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY)}else if(!e){this.visible=false;this.crossFrameEventService.publish(d.HIDE_TOOLBAR_ITEM_CONTEXT,l.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY)}const t=this.personalizationsmarteditContextService.getCustomize().selectedVariations;if(t&&t!==this.oldSelectedVariations){this.oldSelectedVariations=t;if(!N.isArray(t)){this.subtitle=t.name}}}clear(){this.personalizationsmarteditContextUtils.clearCustomizeContextAndReloadPreview(this.personalizationsmarteditPreviewService,this.personalizationsmarteditContextService);this.crossFrameEventService.publish(d.HIDE_TOOLBAR_ITEM_CONTEXT,l.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY)}};Fe=__decorate([n.Component({selector:"personalizationsmartedit-customize-toolbar-context",template:`<div *ngIf="visible" class="pe-toolbar-item-context"><span class="sap-icon--slim-arrow-right pe-toolbar-item-context__icon"></span><div class="pe-toolbar-item-context__btn"><div class="pe-toolbar-item-context__btn-txt"><div title="{{title}}" class="perso-wrap-ellipsis pe-toolbar-item-context__btn-title">{{title}}</div><div title="{{subtitle}}" class="perso-wrap-ellipsis pe-toolbar-item-context__btn-subtitle">{{subtitle}}</div></div></div><div class="pe-toolbar-item-context__btn-hyicon" (click)="clear()"><span class="sap-icon--decline"></span></div></div>`}),__metadata("design:paramtypes",[t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditContextUtils,t.PersonalizationsmarteditPreviewService,d.CrossFrameEventService])],Fe);window.__smartedit__.addDecoratorPayload("Component","ManageCustomizationViewMenuComponent",{selector:"manage-customization-view-menu",template:`<div class="btn-block pe-toolbar-action--include"><div class="se-toolbar-menu-content se-toolbar-menu-content--pe-customized" role="menu"><div class="se-toolbar-menu-content--pe-customized__headers"><h2 class="se-toolbar-menu-content--pe-customized__headers--h2" translate="personalization.toolbar.library.header.title"></h2><se-help class="se-toolbar-menu-content__y-help"><span translate="personalization.toolbar.library.header.description"></span></se-help></div><div class="se-toolbar-menu-content--pe-customized__item"><a class="se-toolbar-menu-content--pe-customized__item__link fd-link" id="personalizationsmartedit-pagecustomizations-toolbar-customization-anchor" translate="personalization.toolbar.library.manager.name" (click)="managerViewClick()"></a></div><div class="se-toolbar-menu-content--pe-customized__item se-toolbar-menu-content--pe-customized__item--last"><a class="se-toolbar-menu-content--pe-customized__item__link fd-link" id="personalizationsmartedit-pagecustomizations-toolbar-customization-anchor" translate="personalization.toolbar.library.customizationvariationmanagement.name" (click)="createCustomizationClick()"></a></div></div></div>`,styles:[`\n            .se-toolbar-menu-content--pe-customized__item__link {\n                color: var(--sapLinkColor);\n                cursor: pointer;\n            }\n        `],changeDetection:n.ChangeDetectionStrategy.OnPush});let ze=class ManageCustomizationViewMenuComponent{constructor(e,t,i,o,n,s){this.personalizationsmarteditContextService=e;this.personalizationsmarteditContextUtils=t;this.personalizationsmarteditPreviewService=i;this.manageCustomizationViewManager=o;this.personalizationsmarteditManagerView=n;this.toolbarItem=s}createCustomizationClick(){this.manageCustomizationViewManager.openCreateCustomizationModal();this.toolbarItem.isOpen=false}managerViewClick(){this.personalizationsmarteditContextUtils.clearCombinedViewCustomizeContext(this.personalizationsmarteditContextService);this.personalizationsmarteditContextUtils.clearCustomizeContextAndReloadPreview(this.personalizationsmarteditPreviewService,this.personalizationsmarteditContextService);this.personalizationsmarteditContextUtils.clearCombinedViewContextAndReloadPreview(this.personalizationsmarteditPreviewService,this.personalizationsmarteditContextService);this.personalizationsmarteditManagerView.openManagerAction();this.toolbarItem.isOpen=false}};ze=__decorate([n.Component({selector:"manage-customization-view-menu",template:`<div class="btn-block pe-toolbar-action--include"><div class="se-toolbar-menu-content se-toolbar-menu-content--pe-customized" role="menu"><div class="se-toolbar-menu-content--pe-customized__headers"><h2 class="se-toolbar-menu-content--pe-customized__headers--h2" translate="personalization.toolbar.library.header.title"></h2><se-help class="se-toolbar-menu-content__y-help"><span translate="personalization.toolbar.library.header.description"></span></se-help></div><div class="se-toolbar-menu-content--pe-customized__item"><a class="se-toolbar-menu-content--pe-customized__item__link fd-link" id="personalizationsmartedit-pagecustomizations-toolbar-customization-anchor" translate="personalization.toolbar.library.manager.name" (click)="managerViewClick()"></a></div><div class="se-toolbar-menu-content--pe-customized__item se-toolbar-menu-content--pe-customized__item--last"><a class="se-toolbar-menu-content--pe-customized__item__link fd-link" id="personalizationsmartedit-pagecustomizations-toolbar-customization-anchor" translate="personalization.toolbar.library.customizationvariationmanagement.name" (click)="createCustomizationClick()"></a></div></div></div>`,styles:[`\n            .se-toolbar-menu-content--pe-customized__item__link {\n                color: var(--sapLinkColor);\n                cursor: pointer;\n            }\n        `],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(5,n.Inject(d.TOOLBAR_ITEM)),__metadata("design:paramtypes",[t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditContextUtils,t.PersonalizationsmarteditPreviewService,t.ManageCustomizationViewManager,xe,Object])],ze);let Le=class SePersonalizationsmarteditToolbarContextModule{};Le=__decorate([n.NgModule({imports:[m.CommonModule,d.HelpModule,l.PersonalizationsmarteditCommonsComponentsModule,t.SePersonalizationsmarteditServicesModule,d.TranslationModule.forChild(),p.ToolbarModule],declarations:[Fe,ze,Ne],entryComponents:[Fe,ze,Ne],providers:[xe]})],Le);const Ve="se.edit.page";t.PersonalizationsmarteditContainerModule=class PersonalizationsmarteditContainerModule{};t.PersonalizationsmarteditContainerModule=__decorate([d.SeEntryModule("personalizationsmarteditcontainer"),n.NgModule({imports:[d.TranslationModule.forChild(),s.BrowserModule,l.ScrollZoneModule,a.LinkModule,t.ManageCustomizationViewModule,t.CombinedViewModule,te,l.PersonalizationsmarteditCommonsComponentsModule,ae,J,t.SePersonalizationsmarteditServicesModule,Le,t.SePersonalizationsmarteditCustomizeViewModule,Ie,ke,Oe],providers:[{provide:o.HTTP_INTERCEPTORS,useClass:l.BaseSiteHeaderInterceptor,multi:true,deps:[d.ISharedDataService]},{provide:l.IPersonalizationsmarteditContextMenuServiceProxy,useClass:t.PersonalizationsmarteditContextMenuServiceProxy},d.moduleUtils.bootstrap(((e,i,o,n,s,a,p,m,g,u,h,_,v)=>{const f="personalizationsmartedit.perspective";const clearAllContextsAndReloadPreview=()=>{u.clearCombinedViewCustomizeContext(m);u.clearCustomizeContextAndReloadPreview(h,m);u.clearCombinedViewContextAndReloadPreview(h,m)};const clearAllContexts=()=>{u.clearCombinedViewCustomizeContext(m);u.clearCustomizeContext(m);u.clearCombinedViewContext(m)};i.subscribe(d.EVENT_PERSPECTIVE_UNLOADING,((e,t)=>{if(t===f){clearAllContextsAndReloadPreview()}}));a.subscribe(d.EVENTS.EXPERIENCE_UPDATE,(()=>{clearAllContexts();m.setCustomizeFiltersState({catalogFilter:l.PERSONALIZATION_CATALOG_FILTER.CURRENT,pageFilter:l.PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER.ONLY_THIS_PAGE,statusFilter:l.PERSONALIZATION_VIEW_STATUS_MAPPING_CODES.ALL,nameFilter:""});return d.promiseUtils.promise}));a.subscribe(d.EVENT_PERSPECTIVE_ADDED,(()=>{h.removePersonalizationDataFromPreview();return d.promiseUtils.promise}));a.subscribe(d.SWITCH_LANGUAGE_EVENT,(()=>{const e=m.getCombinedView();r.forEach(e.selectedItems,(function(e){p.getAndSetCatalogVersionNameL10N(e.variation)}));m.setCombinedView(e);return d.promiseUtils.promise}));s.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:l.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY,type:"HYBRID_ACTION",nameI18nKey:"personalization.toolbar.pagecustomizations",priority:4,section:"left",component:t.CustomizeViewComponent,contextComponent:Fe,keepAliveOnClose:false,iconClassName:"sap-icon--palette se-toolbar-menu-ddlb--button__icon",permissions:[Ve,"se.personalization.page"]});s.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:"personalizationsmartedit.container.manager.toolbar",type:"HYBRID_ACTION",nameI18nKey:"personalization.toolbar.library.name",priority:8,section:"left",component:ze,keepAliveOnClose:false,iconClassName:"sap-icon--bbyd-active-sales se-toolbar-menu-ddlb--button__icon",permissions:[Ve]});s.register({key:"personalizationsmartedit.context.service",nameI18nKey:"personalization.context.service.name",descriptionI18nKey:"personalization.context.service.description",enablingCallback:()=>{const e=m.getPersonalization();e.enabled=true;m.setPersonalization(e)},disablingCallback:()=>{const e=m.getPersonalization();e.enabled=false;m.setPersonalization(e)},permissions:[Ve]});s.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:l.COMBINED_VIEW_TOOLBAR_ITEM_KEY,type:"HYBRID_ACTION",nameI18nKey:"personalization.toolbar.combinedview.name",priority:6,section:"left",component:t.CombinedViewMenuComponent,contextComponent:Ne,keepAliveOnClose:false,iconClassName:"sap-icon--switch-views se-toolbar-menu-ddlb--button__icon",permissions:["se.read.page","se.personalization.page"]});n.register({key:f,nameI18nKey:"personalization.perspective.name",features:["personalizationsmartedit.context.service",l.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY,"personalizationsmartedit.container.manager.toolbar",l.COMBINED_VIEW_TOOLBAR_ITEM_KEY,"personalizationsmarteditSharedSlot","personalizationsmarteditComponentLightUp","personalizationsmarteditCombinedViewComponentLightUp","personalizationsmartedit.context.add.action","personalizationsmartedit.context.edit.action","personalizationsmartedit.context.delete.action","personalizationsmartedit.context.info.action","personalizationsmartedit.context.component.edit.action","personalizationsmartedit.context.show.action.list","externalcomponentbutton","se.contextualMenu","se.slotContextualMenu","se.emptySlotFix","se.cms.pageDisplayStatus"],perspectives:[],permissions:["se.personalization.open"]});o.subscribe("smartEditReady",((t,o)=>{i.publish(d.SHOW_TOOLBAR_ITEM_CONTEXT,l.CUSTOMIZE_VIEW_TOOLBAR_ITEM_KEY);i.publish(d.SHOW_TOOLBAR_ITEM_CONTEXT,l.COMBINED_VIEW_TOOLBAR_ITEM_KEY);const s=m.getCustomize().selectedCustomization;const a=m.getCombinedView().customize.selectedCustomization;const r=m.getCombinedView().selectedItems;e.getCurrentExperience().then((e=>{if(!e.variations&&(s||a||r)){clearAllContexts()}}));m.refreshExperienceData().then((()=>{const e=m.getSeData().seExperienceData;const t=n.getActivePerspective()||{key:"",nameI18nKey:"",features:[]};if(t.key===f&&e.pageContext.catalogVersionUuid!==e.catalogDescriptor.catalogVersionUuid){const e={message:"personalization.warning.pagefromparent",timeout:-1};g.sendWarning(e)}})).finally((()=>{m.applySynchronization()}))}))}),[d.IExperienceService,d.CrossFrameEventService,d.SmarteditBootstrapGateway,d.IPerspectiveService,d.IFeatureService,d.SystemEventService,l.PersonalizationsmarteditUtils,t.PersonalizationsmarteditContextService,l.PersonalizationsmarteditMessageHandler,l.PersonalizationsmarteditContextUtils,t.PersonalizationsmarteditPreviewService,l.IPersonalizationsmarteditContextMenuServiceProxy,t.PersonalizationsmarteditContextServiceReverseProxy])]})],t.PersonalizationsmarteditContainerModule);t.defaultCustomization=re},85951:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(67827);var n=i(32709);var s=i(9501);var a=i(72093);var r=i(38102);var l=i(30520);var d=i(30178);var p=i(22630);var m=i(12549);var g=i(67564);var u=i(66791);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}t.SearchProfilesContextService=class SearchProfilesContextService{constructor(){this.searchProfileActionComparer=(e,t)=>e.type===t.type&&e.searchProfileCode===t.searchProfileCode&&e.searchProfileCatalog===t.searchProfileCatalog;this.updateSearchActionContext=e=>{e.forEach((e=>{const t=this.searchProfileActionContext.searchProfilesOrder.filter((t=>this.searchProfileActionComparer(e,t)));if(t.length>0){t[0].code=e.code}}))};this.isDirty=()=>false;this.searchProfileActionContext={customizationCode:undefined,variationCode:undefined,initialOrder:[],searchProfilesOrder:[]}}};t.SearchProfilesContextService=__decorate([n.Injectable(),__metadata("design:paramtypes",[])],t.SearchProfilesContextService);t.SearchRestService=class SearchRestService{constructor(e,t){this.personalizationsmarteditUtils=e;this.restServiceFactory=t;this.SEARCH_PROFILES="/adaptivesearchwebservices/v1/searchprofiles";this.UPDATE_CUSTOMIZATION_RANK="/personalizationwebservices/v1/query/cxUpdateSearchProfileActionRank";this.GET_INDEX_TYPES_FOR_SITE="/personalizationwebservices/v1/query/cxGetIndexTypesForSite"}initSeData(e){this.seData=e}getSeExperienceData(){return this.seData.seExperienceData}getSearchProfiles(e){const t=this.getSeExperienceData();const i=(t.productCatalogVersions||[]).map((function(e){return e.catalog+":"+e.catalogVersion})).join(",");const o=this.restServiceFactory.get(this.SEARCH_PROFILES);e=Object.assign({catalogVersions:i},e);return o.get(e)}updateSearchProfileActionRank(e){const t=this.getSeExperienceData();const i=this.restServiceFactory.get(this.UPDATE_CUSTOMIZATION_RANK);const o=[];this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"customization",e.customizationCode);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"variation",e.variationCode);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"rankBeforeAction",e.rankBeforeAction);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"rankAfterAction",e.rankAfterAction);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"actions",e.actions);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"catalog",t.catalogDescriptor.catalogId);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"catalogVersion",t.catalogDescriptor.catalogVersion);const n={params:{entry:o}};return i.save(n)}getIndexTypesForCatalogVersion(e){const t=this.getSeExperienceData();const i=this.restServiceFactory.get(this.GET_INDEX_TYPES_FOR_SITE);const o=[];this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"baseSiteId",t.catalogDescriptor.siteId);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"catalog",e.catalog);this.personalizationsmarteditUtils.pushToArrayIfValueExists(o,"catalogVersion",e.catalogVersion);const n={params:{entry:o}};return i.save(n)}};t.SearchRestService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.PersonalizationsmarteditUtils,m.IRestServiceFactory])],t.SearchRestService);const h="cxSearchProfileActionData";window.__smartedit__.addDecoratorPayload("Component","SearchProfilesSmarteditComponent",{selector:"search-profiles-smartedit",template:`<div *ngIf="getSelectedTypeCode() === getSearchProfileCode()" class="form-group"><label for="search-profile-selector-1" class="fd-form-label" translate="personalizationsearchsmartedit.commercecustomization.search.label"></label><personalization-infinite-scrolling [fetchPage]="getPage"><se-select [id]="search-profile-selector-1" class="fd-form__control" [placeholder]="'personalizationsearchsmartedit.commercecustomization.search.placeholder'" [searchEnabled]="true" [fetchStrategy]="fetchStrategy" [(model)]="selectedSearchProfile" [onSelect]="searchProfileSelectedEvent"></se-select><div class="pe-spinner--outer" [hidden]="!requestProcessing"><div class="spinner-md spinner-light"></div></div></personalization-infinite-scrolling><div *ngIf="searchProfileActions.length !== 0" class="ps-search-profile__selection"><label class="control-label ps-control-label"><span translate="personalizationsearchsmartedit.commercecustomization.search.selection.label"></span></label><se-help><span translate="personalizationsearchsmartedit.commercecustomization.search.helpmsg"></span></se-help><div cdkDropList [cdkDropListData]="searchProfileActions" [cdkDropListConnectedTo]="dragDroppedTargetIds" (cdkDropListDropped)="dragDropped($event)" [cdkDropListSortingDisabled]="true" class="ps-search-profile__sel-tree"><div class="ps-search-profile__sel-tbody"><div *ngFor="let searchProfileAction of searchProfileActions" cdkDrag [cdkDragData]="searchProfileAction.searchProfileCode" (cdkDragMoved)="dragMoved($event)" class="ps-search-profile__sel-tree-row"><div class="node-item" [attr.data-id]="searchProfileAction.searchProfileCode" [attr.id]=" 'node-' + searchProfileAction.searchProfileCode"><div class="ps-search-profile__sel-tree-row-wrapper"><div class="ps-search-profile__sel-profile ps-search-profile-height"><span class="ps-search-profile__sel-profile-code" [textContent]="searchProfileAction.searchProfileCode"></span></div></div></div></div></div></div></div><label class="control-label ps-control-label__cust"><span translate="personalizationsearchsmartedit.commercecustomization.search.label.cust"></span></label></div>`,styles:[`.cdk-drag-placeholder{display:none}.cdk-drag-preview{z-index:2000!important}.node-item{z-index:2100!important;cursor:move}.cdk-drag-row-layout{display:flex}.drop-before{border-top:1px solid #000;z-index:2000!important}.drop-after{border-bottom:1px solid #000;z-index:2000!important}.ps-search-profile-height{height:40px}`],encapsulation:n.ViewEncapsulation.None});t.SearchProfilesSmarteditComponent=class SearchProfilesSmarteditComponent{constructor(e,t,i,o,n,s){this.personlizationSearchExtensionInjector=e;this.document=t;this.translateService=i;this.searchRestService=o;this.searchProfilesContextService=n;this.personalizationsmarteditMessageHandler=s;this.selectedSearchProfile=null;this.allSearchProfiles=[];this.availableSearchProfiles=[];this.searchProfileActions=[];this.fetchStrategy={fetchAll:()=>{this.availableSearchProfiles=[];this.allSearchProfiles.forEach((e=>{if(this.isItemInSelectDisabled(e)){this.availableSearchProfiles.push(this.formateSearchProfileItem(e))}}));return Promise.resolve(this.availableSearchProfiles)}};this.actionsPreCount=0;this.draggedItemCss="node-item";this.dropTargetIds=[];this.nodeLookup={};this.dropAction=null;this.dragMovedSubject=new g.Subject;this.getPage=()=>this.addMoreSearchProfilesItems();this.searchProfileSelectedEvent=e=>{this.selectedSearchProfile=e;const t=this.buildAction(e);this.addAction(t,this.searchProfilesContextService.searchProfileActionComparer)};this.seData=e.seData;this.getCustomization=e.getCustomization;this.getVariation=e.getVariation;this.actions=e.actions;this.addAction=e.addAction;this.isActionInSelectDisabled=e.isActionInSelectDisabled;this.getSelectedTypeCode=e.getSelectedTypeCode}ngOnInit(){this.searchRestService.initSeData(this.seData);this.moreSearchProfilestRequestProcessing=false;this.paginationHelper=new l.PaginationHelper({});this.paginationHelper.reset();this.searchProfileFilter={code:"",pageSize:0,currentPage:0};this.searchProfileContext=this.searchProfilesContextService.searchProfileActionContext;this.dragMovedSubscription=this.dragMovedSubject.pipe(u.debounceTime(50)).subscribe((e=>{this.performDragMoved(e)}))}ngDoCheck(){if(this.actionsPreCount!==this.actions.length){const e=this.actions||[];this.searchProfileActions=e.filter((function(e){return e.action.type===h})).map((function(t){return Object.assign(Object.assign({},t.action),{baseIndex:e.indexOf(t)})}));this.searchProfileContext.searchProfilesOrder=this.searchProfileActions;this.resetSearchProfileActionsDragDrop();this.updateSearchProfileActionsDragDrop();this.actionsPreCount=this.actions.length}if(this.customizationPreCode!==this.getCustomization().code){if(this.getCustomization()&&this.getCustomization().code){this.searchProfileContext.customizationCode=this.getCustomization().code}else{this.searchProfileContext.customizationCode=undefined}this.customizationPreCode=this.getCustomization().code}if(this.variationPreCode!==this.getVariation().code){if(this.getVariation()&&this.getVariation().code){this.searchProfileContext.variationCode=this.getVariation().code}else{this.searchProfileContext.variationCode=undefined}this.variationPreCode=this.getVariation().code}}ngOnDestroy(){var e;(e=this.dragMovedSubscription)===null||e===void 0?void 0:e.unsubscribe()}getSearchProfileCode(){return h}dragMoved(e){this.dragMovedSubject.next(e)}dragDropped(e){if(this.checkDragDrop(e.item.data)){const t=e.item.data;const i=this.dropAction.targetId;const o=this.nodeLookup[t];const n=this.nodeLookup[i];if(this.dropAction.action==="before"){this.actions.splice(n.baseIndex,0,this.actions.splice(o.baseIndex,1)[0])}else{this.actions.splice(n.baseIndex+1,0,this.actions.splice(o.baseIndex,1)[0])}this.searchProfileActions.splice(this.searchProfileActions.findIndex((e=>e.searchProfileCode===t)),1);const s=this.searchProfileActions.findIndex((e=>e.searchProfileCode===this.dropAction.targetId));if(this.dropAction.action==="before"){this.searchProfileActions.splice(s,0,o)}else{this.searchProfileActions.splice(s+1,0,o)}this.updateSearchProfileActionsBaseIndex();const a=e.previousIndex<e.currentIndex?e.previousIndex:e.currentIndex;const r=Math.abs(e.currentIndex-e.previousIndex)+1;const l=this.searchProfileActions.slice(a,r);const d=[];l.forEach((e=>{d.push(this.getWrapperActionForAction(e))}));this.setStatusForUpdatedActions(d)}}getWrapperActionForAction(e){const t=[];this.actions.forEach((i=>{if(this.searchProfilesContextService.searchProfileActionComparer(e,i.action)){t.push(i)}}));return t[0]}checkDragDrop(e){return this.dropAction!==null&&this.dropAction.action!==null&&this.dropAction.targetId!==null&&e!==this.dropAction.targetId&&this.checkDragDropIndex(e)}checkDragDropIndex(e){const t=this.searchProfileActions.findIndex((t=>t.searchProfileCode===e));let i=this.searchProfileActions.findIndex((e=>e.searchProfileCode===this.dropAction.targetId));if(this.dropAction.action==="before"){i-=1}else{i+=1}return t!==i}updateSearchProfileActionsBaseIndex(){this.actions.forEach(((e,t)=>{if(e.action.type===h){this.nodeLookup[e.action.searchProfileCode].baseIndex=t}}))}setStatusForUpdatedActions(e){e.forEach((e=>{if(e.status!==l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.NEW){e.status=l.PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES.UPDATE}}))}updateSearchProfileActionsDragDrop(){this.searchProfileActions.forEach((e=>{this.dropTargetIds.push(e.searchProfileCode);this.nodeLookup[e.searchProfileCode]=e}))}resetSearchProfileActionsDragDrop(){this.dropTargetIds.length=0;this.nodeLookup={}}performDragMoved(e){this.dropAction={targetId:null,action:null};const t=this.document.elementFromPoint(e.pointerPosition.x,e.pointerPosition.y);if(!t){this.clearDragInfo();return}const i=t.classList.contains(this.draggedItemCss)?t:t.closest(".node-item");if(!i){this.clearDragInfo();return}this.dropAction={targetId:i.getAttribute("data-id")};const o=i.getBoundingClientRect();const n=o.height/2;if(e.pointerPosition.y-o.top<n){this.dropAction.action="before"}else if(e.pointerPosition.y-o.top>n){this.dropAction.action="after"}this.showDragInfo()}showDragInfo(){this.clearDragInfo();if(this.dropAction){this.document.getElementById("node-"+this.dropAction.targetId).classList.add("drop-"+this.dropAction.action)}}clearDragInfo(e=false){if(e){this.dropAction=null}this.document.querySelectorAll(".drop-before").forEach((e=>e.classList.remove("drop-before")));this.document.querySelectorAll(".drop-after").forEach((e=>e.classList.remove("drop-after")))}addMoreSearchProfilesItems(){return __awaiter(this,void 0,void 0,(function*(){try{if(this.paginationHelper.getPage()<this.paginationHelper.getTotalPages()-1&&!this.moreSearchProfilestRequestProcessing){this.moreSearchProfilestRequestProcessing=true;const e=yield this.getIndexTypes();let t=this.getSearchProfileFilterObject();const i={indexTypes:e.indexTypeIds||[]};t=Object.assign({indexTypes:i.indexTypes},t);const o=yield this.searchRestService.getSearchProfiles(t);this.allSearchProfiles=p.cloneDeep(o.searchProfiles);this.paginationHelper=new l.PaginationHelper(o.pagination);this.moreSearchProfilestRequestProcessing=false}}catch(e){this.moreSearchProfilestRequestProcessing=false;this.personalizationsmarteditMessageHandler.sendError(this.translateService.instant("personalizationsearchsmartedit.commercecustomization.search.error.gettingsearchprofiles"))}}))}getIndexTypes(){const e=m.promiseUtils.defer();const t=[];const i=this.searchRestService.getSeExperienceData();i.productCatalogVersions.forEach((e=>{t.push(this.searchRestService.getIndexTypesForCatalogVersion(e))}));Promise.all(t).then((function successCallback(t){const i={indexTypeIds:[]};t.forEach((e=>{i.indexTypeIds=i.indexTypeIds.concat(e.indexTypeIds.filter((function(e){return i.indexTypeIds.indexOf(e)<0})))}));e.resolve(i)}),(function errorCallback(t){e.reject(t)}));return e.promise}isItemInSelectDisabled(e){const t=this.buildAction(e);return this.isActionInSelectDisabled(t,this.searchProfilesContextService.searchProfileActionComparer)===undefined?true:false}getSearchProfileFilterObject(){return{code:this.searchProfileFilter.code,pageSize:this.paginationHelper.getCount(),currentPage:this.paginationHelper.getPage()+1}}buildAction(e){return{type:h,searchProfileCode:e.code,searchProfileCatalog:e.catalogVersion.split(":")[0]}}formateSearchProfileItem(e){const t=p.cloneDeep(e);t.id=t.code;t.label=t.name;return t}};t.SearchProfilesSmarteditComponent=__decorate([n.Component({selector:"search-profiles-smartedit",template:`<div *ngIf="getSelectedTypeCode() === getSearchProfileCode()" class="form-group"><label for="search-profile-selector-1" class="fd-form-label" translate="personalizationsearchsmartedit.commercecustomization.search.label"></label><personalization-infinite-scrolling [fetchPage]="getPage"><se-select [id]="search-profile-selector-1" class="fd-form__control" [placeholder]="'personalizationsearchsmartedit.commercecustomization.search.placeholder'" [searchEnabled]="true" [fetchStrategy]="fetchStrategy" [(model)]="selectedSearchProfile" [onSelect]="searchProfileSelectedEvent"></se-select><div class="pe-spinner--outer" [hidden]="!requestProcessing"><div class="spinner-md spinner-light"></div></div></personalization-infinite-scrolling><div *ngIf="searchProfileActions.length !== 0" class="ps-search-profile__selection"><label class="control-label ps-control-label"><span translate="personalizationsearchsmartedit.commercecustomization.search.selection.label"></span></label><se-help><span translate="personalizationsearchsmartedit.commercecustomization.search.helpmsg"></span></se-help><div cdkDropList [cdkDropListData]="searchProfileActions" [cdkDropListConnectedTo]="dragDroppedTargetIds" (cdkDropListDropped)="dragDropped($event)" [cdkDropListSortingDisabled]="true" class="ps-search-profile__sel-tree"><div class="ps-search-profile__sel-tbody"><div *ngFor="let searchProfileAction of searchProfileActions" cdkDrag [cdkDragData]="searchProfileAction.searchProfileCode" (cdkDragMoved)="dragMoved($event)" class="ps-search-profile__sel-tree-row"><div class="node-item" [attr.data-id]="searchProfileAction.searchProfileCode" [attr.id]=" 'node-' + searchProfileAction.searchProfileCode"><div class="ps-search-profile__sel-tree-row-wrapper"><div class="ps-search-profile__sel-profile ps-search-profile-height"><span class="ps-search-profile__sel-profile-code" [textContent]="searchProfileAction.searchProfileCode"></span></div></div></div></div></div></div></div><label class="control-label ps-control-label__cust"><span translate="personalizationsearchsmartedit.commercecustomization.search.label.cust"></span></label></div>`,styles:[`.cdk-drag-placeholder{display:none}.cdk-drag-preview{z-index:2000!important}.node-item{z-index:2100!important;cursor:move}.cdk-drag-row-layout{display:flex}.drop-before{border-top:1px solid #000;z-index:2000!important}.drop-after{border-bottom:1px solid #000;z-index:2000!important}.ps-search-profile-height{height:40px}`],encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(l.PERSONLIZATION_SEARCH_EXTENSION_INJECTOR_TOKEN)),__param(1,n.Inject(d.DOCUMENT)),__metadata("design:paramtypes",[Object,Document,r.TranslateService,t.SearchRestService,t.SearchProfilesContextService,l.PersonalizationsmarteditMessageHandler])],t.SearchProfilesSmarteditComponent);t.PersonalizationsearchSmarteditContainerModule=class PersonalizationsearchSmarteditContainerModule{};t.PersonalizationsearchSmarteditContainerModule=__decorate([m.SeEntryModule("personalizationsearchsmarteditContainer"),n.NgModule({imports:[m.TranslationModule.forChild(),m.SelectModule,a.PopoverModule,s.BrowserModule,m.SharedComponentsModule,o.DragDropModule,l.PersonalizationsmarteditCommonsComponentsModule],declarations:[t.SearchProfilesSmarteditComponent],entryComponents:[t.SearchProfilesSmarteditComponent],exports:[],providers:[t.SearchProfilesContextService,t.SearchRestService,{provide:l.PERSONLIZATION_SEARCH_EXTENSION_TOKEN,useValue:{component:t.SearchProfilesSmarteditComponent}},m.moduleUtils.bootstrap(((e,t,i,o,n)=>{n.registerType({type:h,text:"personalizationsearchsmartedit.commercecustomization.action.type.search",confProperty:"personalizationsearch.commercecustomization.search.profile.enabled",getName:t=>e.instant("personalizationsearchsmartedit.commercecustomization.search.display.name")+" - "+t.searchProfileCode,updateActions(e,n,s,a){const r=m.promiseUtils.defer();if(a!==undefined){t.updateSearchActionContext(a.actions)}const l=t.searchProfileActionContext;const d=l.searchProfilesOrder.splice(0,1)[0];const p=l.searchProfilesOrder.map((function(e){return e.code})).join(",");const g={customizationCode:l.customizationCode,variationCode:l.variationCode,rankAfterAction:d.code,actions:p};i.updateSearchProfileActionRank(g).then((function successCallback(){r.resolve()}),(function errorCallback(){o.sendError(this.translateService.instant("personalization.error.updatingcustomization"));r.reject()}));return r.promise}})}),[r.TranslateService,t.SearchProfilesContextService,t.SearchRestService,l.PersonalizationsmarteditMessageHandler,l.PersonalizationsmarteditCommerceCustomizationService])]})],t.PersonalizationsearchSmarteditContainerModule)},3490:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(32709);var n=i(12549);var s=i(38102);var a=i(30178);var r=i(19662);var l=i(72093);var d=i(51132);var p=i(67564);var m=i(66791);var g=i(22630);var u=i(99662);function _interopNamespace(e){if(e&&e.__esModule)return e;var t=Object.create(null);if(e){Object.keys(e).forEach((function(i){if(i!=="default"){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,o.get?o:{enumerable:true,get:function(){return e[i]}})}}))}t["default"]=e;return Object.freeze(t)}var h=_interopNamespace(d);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}t.AssetsService=class AssetsService{constructor(){this.PROD_ASSETS_SRC="/cmssmartedit"}getAssetsRoot(){return this.PROD_ASSETS_SRC}};t.AssetsService=__decorate([o.Injectable()],t.AssetsService);const _="WORKFLOW_CREATED_EVENT";const v="WORKFLOW_FINISHED_EVENT";const f=new n.EvictionTag({event:_});const y=new n.EvictionTag({event:v});const S=new n.EvictionTag({event:"WORKFLOW_TASKS_MENU_OPENED_EVENT"});const b=new n.EvictionTag({event:"SLOT_UPDATE_EVENT"});class IContextAwareEditableItemService{isItemEditable(e){"proxyFunction";return null}}const E="CURRENT_CONTEXT_CATALOG";const w="CURRENT_CONTEXT_CATALOG_VERSION";const A="CURRENT_CONTEXT_SITE_ID";const R="CURRENT_PAGE_CONTEXT_CATALOG";const N="CURRENT_PAGE_CONTEXT_CATALOG_VERSION";const L="/cmswebservices/v1/types";const B=`/cmswebservices/v1/sites/${A}/catalogs/${E}/versions/${w}/items`;const j=`/cmswebservices/v1/sites/${n.PAGE_CONTEXT_SITE_ID}/catalogs/${R}/versions/${N}/pagescontentslotscomponents`;const G=`/cmswebservices/v1/catalogs/${R}/versions/${N}/pages/:pageUid/contentslots/:slotUid/typerestrictions`;const H=`/cmswebservices/v1/catalogs/${R}/versions/${N}/pages/:pageUid/typerestrictions`;const W=`/cmswebservices/v1/sites/${A}/catalogs/${E}/versions/${w}/pages`;const $="pages/:siteId/:catalogId/:catalogVersion";const K="trashedpages/:siteId/:catalogId/:catalogVersion";const Y=`/cmswebservices/v1/sites/${n.PAGE_CONTEXT_SITE_ID}/catalogs/${R}/versions/${N}/pagescontentslots`;const Z=`/cmswebservices/v1/sites/:${A}/catalogs/:${E}/versions/:${w}/pagetemplates`;const Q="navigations/:siteId/:catalogId/:catalogVersion";const J=`/cmswebservices/v1/sites/:${A}/catalogs/:${E}/versions/:${w}/navigations`;const ee=`/cmswebservices/v1/sites/:${A}/catalogs/:${E}/versions/:${w}/navigations/:navigationUid/entries`;const te="/cmswebservices/v1/navigationentrytypes";const ie=`/cmswebservices/v1/sites/${n.PAGE_CONTEXT_SITE_ID}/catalogs/${R}/versions/${N}/pagesrestrictions`;const oe="/cmswebservices/v1/sites/:siteUID/catalogs/:catalogId/versions/:catalogVersion/pagesrestrictions";const ne="/cmswebservices/v1/restrictiontypes";const se="/cmswebservices/v1/pagetypesrestrictiontypes";const ae="/cmswebservices/v1/pagetypes";const re=`/cmssmarteditwebservices/v1/sites/${n.PAGE_CONTEXT_SITE_ID}/catalogs/${R}/versions/${N}/synchronizations/versions/:target/pages/:pageUid`;const le=`/cmssmarteditwebservices/v1/sites/${A}/catalogs/${E}/versions/${w}/synchronizations/versions/:target`;class IPageContentSlotsComponentsRestService{clearCache(){"proxyFunction"}getSlotsToComponentsMapForPageUid(e){"proxyFunction";return null}getComponentsForSlot(e){"proxyFunction";return null}}t.SynchronizationResourceService=class SynchronizationResourceService{constructor(e){this.restServiceFactory=e}getPageSynchronizationGetRestService(e){const t=new n.URIBuilder(re).replaceParams(e).build();return this.restServiceFactory.get(t)}getPageSynchronizationPostRestService(e){const t=new n.URIBuilder(le).replaceParams(e).build();return this.restServiceFactory.get(t)}};t.SynchronizationResourceService=__decorate([o.Injectable(),__metadata("design:paramtypes",[n.IRestServiceFactory])],t.SynchronizationResourceService);t.ComponentService=class ComponentService{constructor(e,t,i,o){this.restServiceFactory=e;this.cmsitemsRestService=t;this.pageInfoService=i;this.pageContentSlotsComponentsRestService=o;this.pageComponentTypesRestServiceURI="/cmssmarteditwebservices/v1/catalogs/:catalogId/versions/:catalogVersion/pages/:pageId/types";this.pageComponentTypesRestService=this.restServiceFactory.get(this.pageComponentTypesRestServiceURI);this.restServiceForAddExistingComponent=this.restServiceFactory.get(j)}getSupportedComponentTypesForCurrentPage(e){return this.pageComponentTypesRestService.get(e)}createNewComponent(e,t){const i={name:e.name,slotId:e.targetSlotId,pageId:e.pageId,position:e.position,typeCode:e.componentType,itemtype:e.componentType,catalogVersion:e.catalogVersionUuid,uid:"",uuid:""};if(typeof t==="object"){for(const e in t){if(t.hasOwnProperty(e)){i[e]=t[e]}}}else if(t){throw new Error(`ComponentService.createNewComponent() - Illegal componentPayload - [${t}]`)}return this.cmsitemsRestService.create(i)}updateComponent(e){return this.cmsitemsRestService.update(e)}addExistingComponent(e,t,i,o){return this.restServiceForAddExistingComponent.save({pageId:e,slotId:i,componentId:t,position:o})}loadComponentItem(e){return this.cmsitemsRestService.getById(e)}loadPagedComponentItemsByCatalogVersion(e){const t={pageSize:e.pageSize,currentPage:e.page,mask:e.mask,sort:"name",typeCode:"AbstractCMSComponent",catalogId:e.catalogId,catalogVersion:e.catalogVersion,itemSearchParams:""};return this.cmsitemsRestService.get(t)}getSlotsForComponent(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getContentSlotsForComponents();return Object.entries(t).filter((([,t])=>t.find((t=>t.uuid===e)))).map((([e])=>e))}))}getContentSlotsForComponents(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageInfoService.getPageUID();return yield this.pageContentSlotsComponentsRestService.getSlotsToComponentsMapForPageUid(e)}))}};__decorate([n.Cached({actions:[n.rarelyChangingContent],tags:[n.pageChangeEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],t.ComponentService.prototype,"getSupportedComponentTypesForCurrentPage",null);t.ComponentService=__decorate([o.Injectable(),__metadata("design:paramtypes",[n.IRestServiceFactory,n.CmsitemsRestService,n.IPageInfoService,IPageContentSlotsComponentsRestService])],t.ComponentService);t.SlotStatus=void 0;(function(e){e["TEMPLATE"]="TEMPLATE";e["PAGE"]="PAGE";e["OVERRIDE"]="OVERRIDE"})(t.SlotStatus||(t.SlotStatus={}));t.JOB_STATUS=void 0;(function(e){e["RUNNING"]="RUNNING";e["ERROR"]="ERROR";e["FAILURE"]="FAILURE";e["FINISHED"]="FINISHED";e["UNKNOWN"]="UNKNOWN";e["ABORTED"]="ABORTED";e["PENDING"]="PENDING"})(t.JOB_STATUS||(t.JOB_STATUS={}));t.StructureTypeCategory=void 0;(function(e){e["COMPONENT"]="COMPONENT";e["PREVIEW"]="PREVIEW";e["PAGE"]="PAGE";e["RESTRICTION"]="RESTRICTION"})(t.StructureTypeCategory||(t.StructureTypeCategory={}));const ce={UNAVAILABLE:"UNAVAILABLE",IN_SYNC:"IN_SYNC",NOT_SYNC:"NOT_SYNC",IN_PROGRESS:"IN_PROGRESS",SYNC_FAILED:"SYNC_FAILED"};const de={SLOW_POLLING_TIME:2e4,FAST_POLLING_TIME:4e3,SPEED_UP:"syncPollingSpeedUp",SLOW_DOWN:"syncPollingSlowDown",FAST_FETCH:"syncFastFetch",FETCH_STATUS:"fetchStatus",FETCH_SYNC_STATUS_ONCE:"fetchSyncStatusOnce"};const pe={CATALOG_SYNCHRONIZED:"CATALOG_SYNCHRONIZED_EVENT"};t.SynchronizationStatus=void 0;(function(e){e["Unavailable"]="UNAVAILABLE";e["InSync"]="IN_SYNC";e["NotSync"]="NOT_SYNC";e["InProgress"]="IN_PROGRESS";e["SyncFailed"]="SYNC_FAILED"})(t.SynchronizationStatus||(t.SynchronizationStatus={}));class SynchronizationUtils{isInSync(e){return e.status===t.SynchronizationStatus.InSync}isInNotSync(e){return e.status===t.SynchronizationStatus.NotSync}isSyncInFailed(e){return e.status===t.SynchronizationStatus.SyncFailed}isSyncInProgress(e){return e.status===t.SynchronizationStatus.InProgress}isExternalItem(e){return!!e.isExternal}}const me=new SynchronizationUtils;class SyncQueue{constructor(){this.items=[]}getItems(){return this.items}addItems(e){this.items=this.items.concat(e)}removeItem(e){this.items=this.items.filter((t=>t!==e.itemId))}itemExists(e){return this.getItems().includes(e.itemId)}isEmpty(){return this.getItems().length===0}hasAtLeastOneItem(){return this.getItems().length>0}emptyItems(){this.items=[]}}window.__smartedit__.addDecoratorPayload("Component","SynchronizationPanelComponent",{selector:"se-synchronization-panel",template:`<div class="se-sync-panel"><se-message *ngIf="message" [type]="message.type"><ng-container se-message-description>{{ message.description }}</ng-container></se-message><div class="se-sync-panel__sync-info" [style.visibility]="showItemList ? 'visible': 'hidden'"><se-spinner [isSpinning]="isLoading"></se-spinner><se-synchronization-panel-item *ngFor="let item of getAllItems(); let i = index" class="se-sync-panel__row" [index]="i" [item]="item" [rootItem]="getRootItem()" [selectAllLabel]="selectAllLabel" [disableList]="disableList" [disableItem]="api.disableItem" (selectionChange)="selectionChange($event)"></se-synchronization-panel-item></div><div class="se-sync-panel__footer" *ngIf="showFooter"><button fd-button class="se-sync-panel__sync-btn fd-button--compact fd-button--emphasized" [disabled]="isSyncButtonDisabled()" (click)="syncItems()" label="{{ 'se.cms.actionitem.page.sync' | translate }}"></button></div></div>`,styles:[`.se-sync-panel__sync-info{max-height:300px;overflow-y:auto}.se-sync-panel__row{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:0 20px;height:40px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}.se-sync-panel__row:first-child{height:50px}.se-sync-panel__row:last-child{border-bottom:none}.se-sync-panel__footer{padding:20px;border-top:1px solid var(--sapGroup_ContentBorderColor);display:flex;flex-direction:row;align-items:center;justify-content:flex-end}.se-sync-panel__sync-btn{text-transform:capitalize;padding:0 20px;margin-left:8px}`]});t.SynchronizationPanelComponent=class SynchronizationPanelComponent{constructor(e,t,i,n,s,a,r,l,d,p){this.waitDialogService=e;this.logService=t;this.crossFrameEventService=i;this.systemEventService=n;this.timerService=s;this.alertService=a;this.translateService=r;this.sharedDataService=l;this.catalogService=d;this.userTrackingService=p;this.getApi=new o.EventEmitter;this.selectedItemsUpdate=new o.EventEmitter;this.syncStatusReady=new o.EventEmitter;this.syncItemsUpdated=new o.EventEmitter;this.showFooter=true;this.showItemList=true;this.message=null;this.disableList=false;this.isLoading=false;this.SYNC_POLLING_SPEED_PREFIX="syncPanel-";this.syncQueue=new SyncQueue;this.api={selectAll:()=>{if(!this.isRootItemExist()){throw new Error("Synchronization status is not available. The 'selectAll' function should be used with 'onSyncStatusReady' event.")}this.toggleRootItem(true)},displayItemList:e=>{this.showItemList=e},disableItemList:e=>{this.disableList=e},setMessage:e=>{this.message=e},disableItem:null}}ngOnInit(){this.getApi.emit(this.api);this.unsubscribeFastFetch=this.crossFrameEventService.subscribe(de.FAST_FETCH,((e,t)=>this.fetchSyncStatus(t)));this.fetchSyncStatus();this.reSyncTimer=this.timerService.createTimer((()=>this.fetchSyncStatus()),de.SLOW_POLLING_TIME);this.reSyncTimer.start()}ngOnDestroy(){const e=this.timerService.createTimer((()=>{if(this.syncQueue.isEmpty()){this.reSyncTimer.teardown();this.unsubscribeFastFetch();this.systemEventService.publishAsync(de.SLOW_DOWN,this.SYNC_POLLING_SPEED_PREFIX+this.itemId);this.toggleRootItem(false);this.toggleWaitModal(false);e.teardown()}else{this.toggleWaitModal(true)}}),200);e.start()}syncItems(){const e=this.getSelectedItemPayloads();const t=e.map((e=>e.itemId));this.userTrackingService.trackingUserAction(n.USER_TRACKING_FUNCTIONALITY.TOOL_BAR,"Sync");this.syncQueue.addItems(t);if(this.atLeastOneSelectedItemExists()){this.toggleWaitModal(true);return this.performSync(e).then((()=>{this.speedUpPolling()}),(()=>{this.logService.warn("[synchronizationPanel] - Could not perform synchronization.");this.toggleWaitModal(false);this.syncQueue.emptyItems()}))}else{return Promise.resolve()}}selectionChange(e){if(e===0){this.toggleAllDependentItems()}this.saveCurrentlySelectedItemsInStorage();this.selectedItemsUpdate.emit(this.getSelectedItems())}isSyncButtonDisabled(){return this.disableList||this.noSelectedItems()||this.syncQueue.hasAtLeastOneItem()}fetchSyncStatus(e){return __awaiter(this,void 0,void 0,(function*(){if(e&&e.itemId!==this.itemId){return}this.isLoading=true;const t=yield this.getSyncStatus(this.itemId);this.setRootItem(t);this.restoreSelectionAfterFetchingUpdatedItems();this.markExternalItems();this.showSyncErrors();this.updateSyncQueue();this.setExternalItemsCatalogVersionName();if(this.syncQueue.isEmpty()){this.slowDownPolling();this.toggleWaitModal(false)}this.syncStatusReady.emit(this.getRootItem());this.syncItemsUpdated.emit();this.isLoading=false}))}markExternalItems(){const e=this.getRootItem();const t=e.catalogVersionUuid;const i=this.getDependentItems();i.forEach((e=>{e.isExternal=e.catalogVersionUuid!==t}))}getAllItems(){return this.isRootItemExist()?[this.getRootItem(),...this.getDependentItems()]:[]}getRootItem(){return this.rootItem}setExternalItemsCatalogVersionName(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getCurrentExperience();const t=this.getAllItems();const i=t.filter((e=>me.isExternalItem(e)));const o=i.map((t=>new Promise((i=>__awaiter(this,void 0,void 0,(function*(){const{catalogName:o}=yield this.catalogService.getCatalogVersionByUuid(t.catalogVersionUuid,e.siteDescriptor.uid);t.catalogVersionName=o;i(t)}))))));yield Promise.all(o)}))}slowDownPolling(){this.reSyncTimer.restart(de.SLOW_POLLING_TIME);this.systemEventService.publishAsync(de.SLOW_DOWN,this.SYNC_POLLING_SPEED_PREFIX+this.itemId)}speedUpPolling(){this.reSyncTimer.restart(de.FAST_POLLING_TIME);this.systemEventService.publishAsync(de.SPEED_UP,this.SYNC_POLLING_SPEED_PREFIX+this.itemId)}setRootItem(e){this.rootItem=e}isRootItemExist(){return this.getRootItem()!=null}getDependentItems(){return this.isRootItemExist()?this.getRootItem().selectedDependencies:[]}getCurrentExperience(){return this.sharedDataService.get(n.EXPERIENCE_STORAGE_KEY)}getSelectedItemPayloads(){return this.getSelectedItems().map((({itemId:e,itemType:t})=>({itemId:e,itemType:t})))}getSelectedItems(){return this.getAllItems().filter((e=>e.selected))}toggleRootItem(e){if(this.isRootItemExist()){const t=this.getRootItem();t.selected=e;this.selectionChange(0)}}toggleAllDependentItems(){this.getDependentItems().filter((e=>!me.isInSync(e))).filter((e=>!me.isExternalItem(e))).forEach((e=>{e.selected=this.getRootItem().selected}))}toggleWaitModal(e){if(e){this.waitDialogService.showWaitModal("se.sync.synchronizing")}else{this.waitDialogService.hideWaitModal()}}saveCurrentlySelectedItemsInStorage(){this.selectedItemsStorage=this.getSelectedItems()}getSelectedItemsFromStorage(){return this.selectedItemsStorage||[]}restoreSelectionAfterFetchingUpdatedItems(){const e=this.getSelectedItemsFromStorage();const t=e.map((e=>e.itemId));this.getAllItems().filter((e=>!me.isInSync(e))).filter((e=>t.indexOf(e.itemId)>-1)).forEach((e=>e.selected=true))}updateSyncQueue(){const e=this.syncQueue.hasAtLeastOneItem();const t=this.getAllItems();t.filter((e=>this.syncQueue.itemExists(e))).filter((e=>!(me.isSyncInProgress(e)||me.isInNotSync(e)))).forEach((e=>this.syncQueue.removeItem(e)));t.filter((e=>!this.syncQueue.itemExists(e))).filter((e=>me.isSyncInProgress(e))).forEach((e=>this.syncQueue.addItems([e.itemId])));const i=this.syncQueue.isEmpty();if(e&&i){this.systemEventService.publishAsync(n.EVENT_CONTENT_CATALOG_UPDATE)}}showSyncErrors(){const e=this.getAllItems().filter((e=>this.syncQueue.itemExists(e))).filter((e=>me.isSyncInFailed(e))).map((e=>e.itemId));if(e.length>0){this.alertService.showDanger({message:this.translateService.instant("se.cms.synchronization.panel.failure.message",{items:e.join(" ")}),minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"})}}atLeastOneSelectedItemExists(){return this.getSelectedItems().length>0}noSelectedItems(){return this.getSelectedItems().length===0}};__decorate([o.Input(),__metadata("design:type",String)],t.SynchronizationPanelComponent.prototype,"itemId",void 0);__decorate([o.Input(),__metadata("design:type",String)],t.SynchronizationPanelComponent.prototype,"selectAllLabel",void 0);__decorate([o.Input(),__metadata("design:type",Function)],t.SynchronizationPanelComponent.prototype,"getSyncStatus",void 0);__decorate([o.Input(),__metadata("design:type",Function)],t.SynchronizationPanelComponent.prototype,"performSync",void 0);__decorate([o.Input(),__metadata("design:type",Boolean)],t.SynchronizationPanelComponent.prototype,"showFooter",void 0);__decorate([o.Output(),__metadata("design:type",Object)],t.SynchronizationPanelComponent.prototype,"getApi",void 0);__decorate([o.Output(),__metadata("design:type",Object)],t.SynchronizationPanelComponent.prototype,"selectedItemsUpdate",void 0);__decorate([o.Output(),__metadata("design:type",Object)],t.SynchronizationPanelComponent.prototype,"syncStatusReady",void 0);__decorate([o.Output(),__metadata("design:type",o.EventEmitter)],t.SynchronizationPanelComponent.prototype,"syncItemsUpdated",void 0);t.SynchronizationPanelComponent=__decorate([o.Component({selector:"se-synchronization-panel",template:`<div class="se-sync-panel"><se-message *ngIf="message" [type]="message.type"><ng-container se-message-description>{{ message.description }}</ng-container></se-message><div class="se-sync-panel__sync-info" [style.visibility]="showItemList ? 'visible': 'hidden'"><se-spinner [isSpinning]="isLoading"></se-spinner><se-synchronization-panel-item *ngFor="let item of getAllItems(); let i = index" class="se-sync-panel__row" [index]="i" [item]="item" [rootItem]="getRootItem()" [selectAllLabel]="selectAllLabel" [disableList]="disableList" [disableItem]="api.disableItem" (selectionChange)="selectionChange($event)"></se-synchronization-panel-item></div><div class="se-sync-panel__footer" *ngIf="showFooter"><button fd-button class="se-sync-panel__sync-btn fd-button--compact fd-button--emphasized" [disabled]="isSyncButtonDisabled()" (click)="syncItems()" label="{{ 'se.cms.actionitem.page.sync' | translate }}"></button></div></div>`,styles:[`.se-sync-panel__sync-info{max-height:300px;overflow-y:auto}.se-sync-panel__row{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:0 20px;height:40px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}.se-sync-panel__row:first-child{height:50px}.se-sync-panel__row:last-child{border-bottom:none}.se-sync-panel__footer{padding:20px;border-top:1px solid var(--sapGroup_ContentBorderColor);display:flex;flex-direction:row;align-items:center;justify-content:flex-end}.se-sync-panel__sync-btn{text-transform:capitalize;padding:0 20px;margin-left:8px}`]}),__metadata("design:paramtypes",[n.IWaitDialogService,n.LogService,n.CrossFrameEventService,n.SystemEventService,n.TimerService,n.IAlertService,s.TranslateService,n.ISharedDataService,n.ICatalogService,n.IUserTrackingService])],t.SynchronizationPanelComponent);window.__smartedit__.addDecoratorPayload("Component","SynchronizationPanelItemComponent",{selector:"se-synchronization-panel-item",template:`<div class="se-sync-panel-item-checkbox fd-form__item"><input *ngIf="!item.isExternal" type="checkbox" [id]="'sync-info__checkbox_' + index" class="se-sync-panel-item-checkbox__field fd-form__control" [(ngModel)]="item.selected" (ngModelChange)="onSelectionChange()" [attr.disabled]="isItemDisabled() ? true : null"/> <label *ngIf="index === 0" [for]="'sync-info__checkbox_' + index" class="se-sync-panel-item-checkbox__label se-sync-panel-item-checkbox__label--select-all fd-form-label" [title]="getSelectAllLabel() | translate" [translate]="getSelectAllLabel()"></label> <label *ngIf="index !== 0 && !item.isExternal" [for]="'sync-info__checkbox_' + index" class="se-sync-panel-item-checkbox__label fd-form-label" [title]="item.name | translate" [translate]="item.name"></label><se-tooltip *ngIf="index !== 0 && item.isExternal" [isChevronVisible]="true" [triggers]="['mouseenter', 'mouseleave']"><label se-tooltip-trigger [for]="'sync-info__checkbox_' + index" class="se-sync-panel-item-checkbox__label fd-form-label" [translate]="item.name"></label><div se-tooltip-body translate="se.cms.synchronization.slot.external.component"></div></se-tooltip></div><span *ngIf="showPopoverOverSyncIcon()"><se-tooltip [isChevronVisible]="true" [placement]="'left'" [triggers]="['mouseenter', 'mouseleave']" [title]="getInfoTitle()" class="pull-right se-sync-panel-item-info-icon" [ngClass]="{ 'se-sync-panel--icon-globe': item.isExternal }"><ng-container *ngIf="!item.isExternal" se-tooltip-trigger><ng-container *ngTemplateOutlet="syncInfoIcon"></ng-container></ng-container><span *ngIf="item.isExternal" class="sap-icon--globe" se-tooltip-trigger></span><div se-tooltip-body><ng-container *ngIf="!item.isExternal"><div *ngFor="let dependentItem of item.dependentItemTypesOutOfSync">{{ dependentItem.i18nKey | translate }}</div></ng-container><div *ngIf="item.isExternal">{{ item.catalogVersionName | seL10n | async }}</div></div></se-tooltip></span><span *ngIf="!showPopoverOverSyncIcon()" class="pull-right se-sync-panel-item-info-icon"><ng-container *ngTemplateOutlet="syncInfoIcon"></ng-container></span><ng-template #syncInfoIcon><span [attr.status]="item.status" class="se-sync-panel-item-info-icon__icon" [ngClass]="{\n                'sap-icon--accept': isInSync(),\n                'sap-icon--message-warning': !isInSync()\n            }"></span></ng-template>`,styles:[`.se-sync-panel-item-checkbox{display:flex;flex-direction:row;align-items:center;margin:0!important}.se-sync-panel-item-checkbox__field{margin:0!important}.se-sync-panel-item-checkbox input[type=checkbox]{height:13px;width:13px;position:relative}.se-sync-panel-item-checkbox__label{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:190px;margin:0!important;padding-left:8px!important;text-transform:capitalize}.se-sync-panel-item-checkbox__label--select-all{font-weight:700!important}.se-sync-panel-item-info-icon{font-size:1rem!important;line-height:1.25;font-weight:400}.se-sync-panel-item-info-icon__icon[class*=sap-icon].sap-icon--accept{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapIndicationColor_4)!important}.se-sync-panel-item-info-icon__icon.sap-icon--message-warning{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapIndicationColor_3)}`]});t.SynchronizationPanelItemComponent=class SynchronizationPanelItemComponent{constructor(){this.selectionChange=new o.EventEmitter}getSelectAllLabel(){return this.selectAllLabel||"se.cms.synchronization.page.select.all.slots"}isItemDisabled(){var e;if(this.disableList||this.disableItem&&this.disableItem(this.item)){return true}return this.item!==this.rootItem&&!!((e=this.rootItem)===null||e===void 0?void 0:e.selected)||me.isInSync(this.item)}showPopoverOverSyncIcon(){var e;return((e=this.item.dependentItemTypesOutOfSync)===null||e===void 0?void 0:e.length)>0||me.isExternalItem(this.item)}getInfoTitle(){return!me.isExternalItem(this.item)?"se.cms.synchronization.panel.update.title":""}isInSync(){return me.isInSync(this.item)}onSelectionChange(){this.selectionChange.emit(this.index)}};__decorate([o.Input(),__metadata("design:type",Number)],t.SynchronizationPanelItemComponent.prototype,"index",void 0);__decorate([o.Input(),__metadata("design:type",Object)],t.SynchronizationPanelItemComponent.prototype,"item",void 0);__decorate([o.Input(),__metadata("design:type",Object)],t.SynchronizationPanelItemComponent.prototype,"rootItem",void 0);__decorate([o.Input(),__metadata("design:type",String)],t.SynchronizationPanelItemComponent.prototype,"selectAllLabel",void 0);__decorate([o.Input(),__metadata("design:type",Boolean)],t.SynchronizationPanelItemComponent.prototype,"disableList",void 0);__decorate([o.Input(),__metadata("design:type",Function)],t.SynchronizationPanelItemComponent.prototype,"disableItem",void 0);__decorate([o.Output(),__metadata("design:type",Object)],t.SynchronizationPanelItemComponent.prototype,"selectionChange",void 0);t.SynchronizationPanelItemComponent=__decorate([o.Component({selector:"se-synchronization-panel-item",template:`<div class="se-sync-panel-item-checkbox fd-form__item"><input *ngIf="!item.isExternal" type="checkbox" [id]="'sync-info__checkbox_' + index" class="se-sync-panel-item-checkbox__field fd-form__control" [(ngModel)]="item.selected" (ngModelChange)="onSelectionChange()" [attr.disabled]="isItemDisabled() ? true : null"/> <label *ngIf="index === 0" [for]="'sync-info__checkbox_' + index" class="se-sync-panel-item-checkbox__label se-sync-panel-item-checkbox__label--select-all fd-form-label" [title]="getSelectAllLabel() | translate" [translate]="getSelectAllLabel()"></label> <label *ngIf="index !== 0 && !item.isExternal" [for]="'sync-info__checkbox_' + index" class="se-sync-panel-item-checkbox__label fd-form-label" [title]="item.name | translate" [translate]="item.name"></label><se-tooltip *ngIf="index !== 0 && item.isExternal" [isChevronVisible]="true" [triggers]="['mouseenter', 'mouseleave']"><label se-tooltip-trigger [for]="'sync-info__checkbox_' + index" class="se-sync-panel-item-checkbox__label fd-form-label" [translate]="item.name"></label><div se-tooltip-body translate="se.cms.synchronization.slot.external.component"></div></se-tooltip></div><span *ngIf="showPopoverOverSyncIcon()"><se-tooltip [isChevronVisible]="true" [placement]="'left'" [triggers]="['mouseenter', 'mouseleave']" [title]="getInfoTitle()" class="pull-right se-sync-panel-item-info-icon" [ngClass]="{ 'se-sync-panel--icon-globe': item.isExternal }"><ng-container *ngIf="!item.isExternal" se-tooltip-trigger><ng-container *ngTemplateOutlet="syncInfoIcon"></ng-container></ng-container><span *ngIf="item.isExternal" class="sap-icon--globe" se-tooltip-trigger></span><div se-tooltip-body><ng-container *ngIf="!item.isExternal"><div *ngFor="let dependentItem of item.dependentItemTypesOutOfSync">{{ dependentItem.i18nKey | translate }}</div></ng-container><div *ngIf="item.isExternal">{{ item.catalogVersionName | seL10n | async }}</div></div></se-tooltip></span><span *ngIf="!showPopoverOverSyncIcon()" class="pull-right se-sync-panel-item-info-icon"><ng-container *ngTemplateOutlet="syncInfoIcon"></ng-container></span><ng-template #syncInfoIcon><span [attr.status]="item.status" class="se-sync-panel-item-info-icon__icon" [ngClass]="{\n                'sap-icon--accept': isInSync(),\n                'sap-icon--message-warning': !isInSync()\n            }"></span></ng-template>`,styles:[`.se-sync-panel-item-checkbox{display:flex;flex-direction:row;align-items:center;margin:0!important}.se-sync-panel-item-checkbox__field{margin:0!important}.se-sync-panel-item-checkbox input[type=checkbox]{height:13px;width:13px;position:relative}.se-sync-panel-item-checkbox__label{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:190px;margin:0!important;padding-left:8px!important;text-transform:capitalize}.se-sync-panel-item-checkbox__label--select-all{font-weight:700!important}.se-sync-panel-item-info-icon{font-size:1rem!important;line-height:1.25;font-weight:400}.se-sync-panel-item-info-icon__icon[class*=sap-icon].sap-icon--accept{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapIndicationColor_4)!important}.se-sync-panel-item-info-icon__icon.sap-icon--message-warning{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapIndicationColor_3)}`]})],t.SynchronizationPanelItemComponent);t.SynchronizationPanelModule=class SynchronizationPanelModule{};t.SynchronizationPanelModule=__decorate([o.NgModule({imports:[a.CommonModule,r.FormsModule,n.TranslationModule.forChild(),n.TooltipModule,n.MessageModule,n.SpinnerModule,l.ButtonModule,n.L10nPipeModule],declarations:[t.SynchronizationPanelComponent,t.SynchronizationPanelItemComponent],entryComponents:[t.SynchronizationPanelComponent],exports:[t.SynchronizationPanelComponent]})],t.SynchronizationPanelModule);const ge=5e3;t.SynchronizationService=class SynchronizationService{constructor(e,t,i,o,n,s){this.restServiceFactory=e;this.timerService=t;this.translateService=i;this.alertService=o;this.authenticationService=n;this.crossFrameEventService=s;this.BASE_URL="/cmswebservices";this.SYNC_JOB_INFO_BY_TARGET_URI="/cmswebservices/v1/catalogs/:catalog/synchronizations/targetversions/:target";this.SYNC_JOB_INFO_BY_SOURCE_AND_TARGET_URI="/cmswebservices/v1/catalogs/:catalog/versions/:source/synchronizations/versions/:target";this.intervalHandle={};this.syncRequested=[];this.syncJobInfoByTargetRestService=this.restServiceFactory.get(this.SYNC_JOB_INFO_BY_TARGET_URI);this.syncJobInfoBySourceAndTargetRestService=this.restServiceFactory.get(this.SYNC_JOB_INFO_BY_SOURCE_AND_TARGET_URI,"catalog")}updateCatalogSync(e){return __awaiter(this,void 0,void 0,(function*(){const t=this._getJobKey(e.catalogId,e.sourceCatalogVersion,e.targetCatalogVersion);this.addCatalogSyncRequest(t);try{const t=yield this.syncJobInfoBySourceAndTargetRestService.save({catalog:e.catalogId,source:e.sourceCatalogVersion,target:e.targetCatalogVersion});return t}catch(t){const i=this.translateService.instant("sync.running.error.msg",{catalogName:e.name});if(t.statusText==="Conflict"){this.alertService.showDanger({message:i,minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"})}return null}}))}getCatalogSyncStatus(e){if(e.sourceCatalogVersion){return this.getSyncJobInfoBySourceAndTarget(e)}else{return this.getLastSyncJobInfoByTarget(e)}}getSyncJobInfoBySourceAndTarget(e){return this.syncJobInfoBySourceAndTargetRestService.get({catalog:e.catalogId,source:e.sourceCatalogVersion,target:e.targetCatalogVersion})}getLastSyncJobInfoByTarget(e){return this.syncJobInfoByTargetRestService.get({catalog:e.catalogId,target:e.targetCatalogVersion})}startAutoGetSyncData(e,t){const{catalogId:i,sourceCatalogVersion:o,targetCatalogVersion:n}=e;const s=this._getJobKey(i,o,n);const a=this.timerService.createTimer((()=>this._autoSyncCallback(e,t,s)),ge);a.start();this.intervalHandle[s]=a}stopAutoGetSyncData(e){const t=this._getJobKey(e.catalogId,e.sourceCatalogVersion,e.targetCatalogVersion);if(this.intervalHandle[t]){if(this.syncRequested.indexOf(t)>-1){this.intervalHandle[t].discardWhenNextSynced=true}else{this.intervalHandle[t].stop();this.intervalHandle[t]=undefined}}}_autoSyncCallback(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.authenticationService.isAuthenticated(this.BASE_URL);if(!o){this.stopAutoGetSyncData(e)}const n=yield this.getCatalogSyncStatus(e);const s=this.syncRequestedCallback(e)(n);t(s);if(!this.intervalHandle[i]){this.startAutoGetSyncData(e,t)}}))}syncRequestedCallback(e){const t=this._getJobKey(e.catalogId,e.sourceCatalogVersion,e.targetCatalogVersion);return i=>{if(this.catalogSyncInProgress(t)){if(this.catalogSyncFinished(i)){this.removeCatalogSyncRequest(t);this.crossFrameEventService.publish(pe.CATALOG_SYNCHRONIZED,e)}if(this.intervalHandle[t].discardWhenNextSynced&&this.catalogSyncFinished(i)||this.catalogSyncAborted(i)){this.intervalHandle[t].stop();this.intervalHandle[t]=undefined;this.removeCatalogSyncRequest(t)}}return i}}catalogSyncInProgress(e){return this.syncRequested.indexOf(e)>-1}catalogSyncFinished(e){return e.syncStatus===t.JOB_STATUS.FINISHED}catalogSyncAborted(e){return e.syncStatus===t.JOB_STATUS.ABORTED}removeCatalogSyncRequest(e){const t=this.syncRequested.indexOf(e);if(t>-1){this.syncRequested.splice(t,1)}}addCatalogSyncRequest(e){if(this.syncRequested.indexOf(e)===-1){this.syncRequested.push(e)}}_getJobKey(e,t,i){return e+"_"+t+"_"+i}};t.SynchronizationService=__decorate([n.OperationContextRegistered("/cmswebservices/v1/catalogs/:catalog/synchronizations/targetversions/:target",n.OPERATION_CONTEXT.CMS),n.OperationContextRegistered("/cmswebservices/v1/catalogs/:catalog/versions/:source/synchronizations/versions/:target",n.OPERATION_CONTEXT.CMS),o.Injectable(),__metadata("design:paramtypes",[n.IRestServiceFactory,n.TimerService,s.TranslateService,n.IAlertService,n.IAuthenticationService,n.CrossFrameEventService])],t.SynchronizationService);t.CMSTimeService=class CMSTimeService{constructor(e){this.translate=e}getTimeAgo(e){const t=Math.floor(h.duration(e).asDays());const i=Math.floor(h.duration(e).asHours());if(t>=1){return t+" "+this.translate.instant("se.cms.actionitem.page.workflow.action.started.days.ago")}else if(i>=1){return i+" "+this.translate.instant("se.cms.actionitem.page.workflow.action.started.hours.ago")}return"<1 "+this.translate.instant("se.cms.actionitem.page.workflow.action.started.hours.ago")}};t.CMSTimeService=__decorate([o.Injectable(),__metadata("design:paramtypes",[s.TranslateService])],t.CMSTimeService);var ue;t.VersionExperienceInterceptor=ue=class VersionExperienceInterceptor{constructor(e){this.sharedDataService=e}intercept(e,t){if(this.isGET(e)&&this.isPreviewDataTypeResourceEndpoint(e.url)){return p.from(this.sharedDataService.get(n.EXPERIENCE_STORAGE_KEY)).pipe(m.switchMap((i=>{if(i.versionId){const i=e.clone({url:e.url.replace(ue.MODE_DEFAULT,ue.MODE_PREVIEW_VERSION)});return t.handle(i)}else{return t.handle(e)}})))}else{return t.handle(e)}}isGET(e){return e.method==="GET"}isPreviewDataTypeResourceEndpoint(e){return e.indexOf(L)>-1&&e.indexOf(ue.PREVIEW_DATA_TYPE)>-1}};t.VersionExperienceInterceptor.MODE_DEFAULT="DEFAULT";t.VersionExperienceInterceptor.MODE_PREVIEW_VERSION="PREVIEWVERSION";t.VersionExperienceInterceptor.PREVIEW_DATA_TYPE="PreviewData";t.VersionExperienceInterceptor=ue=__decorate([o.Injectable(),__metadata("design:paramtypes",[n.ISharedDataService])],t.VersionExperienceInterceptor);class IComponentSharedService{isComponentShared(e){"proxyFunction";return null}}t.TypePermissionNames=void 0;(function(e){e["CREATE"]="create";e["READ"]="read";e["CHANGE"]="change";e["REMOVE"]="remove"})(t.TypePermissionNames||(t.TypePermissionNames={}));t.TypePermissionsRestService=class TypePermissionsRestService{constructor(e,t,i){this.logService=e;this.sessionService=t;this.URI="/permissionswebservices/v1/permissions/types/search";this.resource=i.get(this.URI)}hasCreatePermissionForTypes(e){return this.getPermissionsForTypesAndName(e,t.TypePermissionNames.CREATE)}hasReadPermissionForTypes(e){return this.getPermissionsForTypesAndName(e,t.TypePermissionNames.READ)}hasUpdatePermissionForTypes(e){return this.getPermissionsForTypesAndName(e,t.TypePermissionNames.CHANGE)}hasDeletePermissionForTypes(e){return this.getPermissionsForTypesAndName(e,t.TypePermissionNames.REMOVE)}hasAllPermissionsForTypes(e){return __awaiter(this,void 0,void 0,(function*(){const i={};const o=yield this.getAllPermissionsForTypes(e);return o.reduce(((e,i)=>{if(i.permissions){e[i.id]={};e[i.id][t.TypePermissionNames.READ]=this.getPermissionByNameAndResult(i,t.TypePermissionNames.READ);e[i.id][t.TypePermissionNames.CHANGE]=this.getPermissionByNameAndResult(i,t.TypePermissionNames.CHANGE);e[i.id][t.TypePermissionNames.CREATE]=this.getPermissionByNameAndResult(i,t.TypePermissionNames.CREATE);e[i.id][t.TypePermissionNames.REMOVE]=this.getPermissionByNameAndResult(i,t.TypePermissionNames.REMOVE)}return e}),i)}))}getAllPermissionsForTypes(e){return __awaiter(this,void 0,void 0,(function*(){if(e.length===0){return[]}const i=yield this.sessionService.getCurrentUsername();if(!i){return[]}try{const o=[t.TypePermissionNames.CREATE,t.TypePermissionNames.CHANGE,t.TypePermissionNames.READ,t.TypePermissionNames.REMOVE].join(",");const n=yield this.resource.queryByPost({principalUid:i},{types:e.join(","),permissionNames:o});return n.permissionsList||[]}catch(t){if(t){this.logService.error(`TypePermissionsRestService - no composed types ${e} exist`)}return Promise.reject(t)}}))}getPermissionByNameAndResult(e,t){const i=e.permissions.find((e=>e.key===t));return JSON.parse(i.value)}getPermissionsForTypesAndName(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getAllPermissionsForTypes(e);return i.reduce(((e,i)=>{if(i.permissions){e[i.id]=this.getPermissionByNameAndResult(i,t)}return e}),{})}))}};__decorate([n.Cached({actions:[n.rarelyChangingContent],tags:[n.authorizationEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Array]),__metadata("design:returntype",Promise)],t.TypePermissionsRestService.prototype,"getAllPermissionsForTypes",null);t.TypePermissionsRestService=__decorate([o.Injectable(),__metadata("design:paramtypes",[n.LogService,n.ISessionService,n.IRestServiceFactory])],t.TypePermissionsRestService);var he;(function(e){e["READ"]="read";e["CHANGE"]="change"})(he||(he={}));t.AttributePermissionsRestService=class AttributePermissionsRestService{constructor(e,t,i){this.sessionService=t;this.logService=i;this.ATTRIBUTE_PERMISSIONS_URI="/permissionswebservices/v1/permissions/attributes/search";this.permissionRestService=e.get(this.ATTRIBUTE_PERMISSIONS_URI)}hasReadPermissionOnAttributesInType(e,t){return this.getPermissionsForAttributesAndNameByType(e,t,he.READ)}hasChangePermissionOnAttributesInType(e,t){return this.getPermissionsForAttributesAndNameByType(e,t,he.CHANGE)}getAllPermissionsForAttributes(e){return __awaiter(this,void 0,void 0,(function*(){if(e.length<=0){return[]}const t=yield this.sessionService.getCurrentUsername();if(!t){return[]}try{const i=yield this.permissionRestService.queryByPost({principalUid:t},{attributes:e.join(","),permissionNames:he.CHANGE+","+he.READ});return i.permissionsList||[]}catch(t){if(t){this.logService.error(`AttributePermissionsRestService - couldn't retrieve attribute permissions ${e}`)}return[]}}))}getPermissionsForAttributesAndNameByType(e,t,i){const o=t.map((t=>e+"."+t));return this.getPermissionsForAttributesAndName(o,i).then((t=>t[e]))}getPermissionsForAttributesAndName(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getAllPermissionsForAttributes(e);const o=this.concatPermissionsNotFound(e,i);return o.reduce(((e,i)=>{if(i.permissions){const o=this.parsePermissionsResultId(i.id);if(!e[o.type]){e[o.type]={}}e[o.type][o.attribute]=this.getPermissionByNameFromResult(i,t)}return e}),{})}))}parsePermissionsResultId(e){const t=e.split(".");if(t.length!==2){throw new Error("AttributePermissionsRestService - Received invalid attribute permissions")}return{type:t[0],attribute:t[1]}}getPermissionByNameFromResult(e,t){const i=e.permissions.find((e=>e.key===t));return JSON.parse(i.value)}concatPermissionsNotFound(e,t){const i=t.map((e=>e.id));const o=g.difference(e,i);return t.concat(o.map((e=>({id:e,permissions:[{key:he.READ,value:"false"},{key:he.CHANGE,value:"false"}]}))))}};__decorate([n.Cached({actions:[n.rarelyChangingContent],tags:[n.authorizationEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Array]),__metadata("design:returntype",Promise)],t.AttributePermissionsRestService.prototype,"getAllPermissionsForAttributes",null);t.AttributePermissionsRestService=__decorate([o.Injectable(),__metadata("design:paramtypes",[n.IRestServiceFactory,n.ISessionService,n.LogService])],t.AttributePermissionsRestService);class IRemoveComponentService{removeComponent(e){"proxyFunction";return null}}class ISlotVisibilityService{getHiddenComponents(e){"proxyFunction";return null}reloadSlotsInfo(){"proxyFunction";return null}}class IEditorEnablerService{enableForComponents(e){"proxyFunction"}onClickEditButton({slotUuid:e,componentAttributes:t}){"proxyFunction";return null}isSlotEditableForNonExternalComponent(e){"proxyFunction";return null}}class IComponentMenuConditionAndCallbackService{externalCondition(e){"proxyFunction";return null}sharedCondition(e){"proxyFunction";return null}removeCondition(e){"proxyFunction";return null}removeCallback(e,t){"proxyFunction";return null}cloneCondition(e){"proxyFunction";return null}cloneCallback(e){"proxyFunction";return null}editConditionForHiddenComponent(e){"proxyFunction";return null}dragCondition(e){"proxyFunction";return null}}t.SlotSynchronizationService=class SlotSynchronizationService{constructor(e){this.syncPollingService=e}getSyncStatus(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.syncPollingService.getSyncStatus(e);const o=this.findSlotStatus(i.selectedDependencies||[],t);if(o!==null){o.fromSharedDependency=false;return o}else{const e=this.findSlotStatus(i.sharedDependencies||[],t);if(e!==null){e.fromSharedDependency=true;return e}}return null}))}performSync(e,t){return this.syncPollingService.performSync(e,t)}syncStatusExists(e){return!!e}findSlotStatus(e,t){return e.find((e=>e.name===t))||null}};t.SlotSynchronizationService=__decorate([o.Injectable(),__metadata("design:paramtypes",[n.ISyncPollingService])],t.SlotSynchronizationService);t.SlotUnsharedService=class SlotUnsharedService{constructor(e,t){this.cmsItemsRestService=e;this.pageContentSlotsService=t;this.slotUnsharedStatus="OVERRIDE"}isSlotUnshared(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageContentSlotsService.getSlotStatus(e);return t===this.slotUnsharedStatus}))}isSlotShared(e){return this.pageContentSlotsService.isSlotShared(e)}revertToSharedSlot(e){return this.cmsItemsRestService.delete(e)}};t.SlotUnsharedService=__decorate([o.Injectable(),__metadata("design:paramtypes",[n.CmsitemsRestService,n.PageContentSlotsService])],t.SlotUnsharedService);class IComponentEditingFacade{addNewComponentToSlot(e,t,i,o){"proxyFunction";return null}addExistingComponentToSlot(e,t,i){"proxyFunction";return null}cloneExistingComponentToSlot(e){"proxyFunction";return null}moveComponent(e,t,i,o){"proxyFunction";return null}}window.__smartedit__.addDecoratorPayload("Component","ActionableAlertComponent",{selector:"se-actionable-alert",changeDetection:o.ChangeDetectionStrategy.OnPush,template:`<div>\n        <p>{{ description | translate : descriptionDetails }}</p>\n        <div>\n            <a fd-link href (click)="onHyperLinkClick($event)">{{\n                hyperlinkLabel | translate : hyperlinkDetails\n            }}</a>\n        </div>\n    </div> `});t.ActionableAlertComponent=class ActionableAlertComponent{constructor(){this.hyperLinkClick=new o.EventEmitter}onHyperLinkClick(e){e.preventDefault();this.hyperLinkClick.emit()}};__decorate([o.Input(),__metadata("design:type",String)],t.ActionableAlertComponent.prototype,"description",void 0);__decorate([o.Input(),__metadata("design:type",Object)],t.ActionableAlertComponent.prototype,"descriptionDetails",void 0);__decorate([o.Input(),__metadata("design:type",String)],t.ActionableAlertComponent.prototype,"hyperlinkLabel",void 0);__decorate([o.Input(),__metadata("design:type",Object)],t.ActionableAlertComponent.prototype,"hyperlinkDetails",void 0);__decorate([o.Output(),__metadata("design:type",o.EventEmitter)],t.ActionableAlertComponent.prototype,"hyperLinkClick",void 0);t.ActionableAlertComponent=__decorate([o.Component({selector:"se-actionable-alert",changeDetection:o.ChangeDetectionStrategy.OnPush,template:`<div>\n        <p>{{ description | translate : descriptionDetails }}</p>\n        <div>\n            <a fd-link href (click)="onHyperLinkClick($event)">{{\n                hyperlinkLabel | translate : hyperlinkDetails\n            }}</a>\n        </div>\n    </div> `}),__metadata("design:paramtypes",[])],t.ActionableAlertComponent);window.__smartedit__.addDecoratorPayload("Component","SharedComponentButtonComponent",{selector:"shared-component-button",template:`<div class="se-ctx-menu-btn__msg"><div class="se-ctx-menu-btn__msg-title" translate="se.cms.contextmenu.shared.component.info.title"></div><div *ngIf="isReady" class="se-ctx-menu-btn__msg-description" [translate]="message"></div><se-spinner [isSpinning]="!isReady"></se-spinner></div>`,changeDetection:o.ChangeDetectionStrategy.OnPush});t.SharedComponentButtonComponent=class SharedComponentButtonComponent{constructor(e,t,i){this.contextAwareEditableItemService=t;this.cdr=i;this.isReady=false;({componentAttributes:{smarteditComponentId:this.smarteditComponentId}}=e)}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.contextAwareEditableItemService.isItemEditable(this.smarteditComponentId);this.message=`se.cms.contextmenu.shared.component.info.msg${e?".editable":""}`;this.isReady=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}};t.SharedComponentButtonComponent=__decorate([o.Component({selector:"shared-component-button",template:`<div class="se-ctx-menu-btn__msg"><div class="se-ctx-menu-btn__msg-title" translate="se.cms.contextmenu.shared.component.info.title"></div><div *ngIf="isReady" class="se-ctx-menu-btn__msg-description" [translate]="message"></div><se-spinner [isSpinning]="!isReady"></se-spinner></div>`,changeDetection:o.ChangeDetectionStrategy.OnPush}),__param(0,o.Inject(n.CONTEXTUAL_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,IContextAwareEditableItemService,o.ChangeDetectorRef])],t.SharedComponentButtonComponent);window.__smartedit__.addDecoratorPayload("Component","ExternalComponentButtonComponent",{selector:"se-external-component-button",template:`<div class="se-ctx-menu-btn__msg" *ngIf="isReady">{{ catalogVersion }}</div>`,providers:[n.L10nPipe],changeDetection:o.ChangeDetectionStrategy.OnPush});t.ExternalComponentButtonComponent=class ExternalComponentButtonComponent{constructor(e,t,i,o){this.catalogService=t;this.l10nPipe=i;this.cdr=o;this.isReady=false;({componentAttributes:{smarteditCatalogVersionUuid:this.catalogVersionUuid}}=e)}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.getCatalogVersionByUuid(this.catalogVersionUuid);const t=yield this.l10nPipe.transform(e.catalogName).pipe(m.take(1)).toPromise();this.catalogVersion=`${t} (${e.version})`;this.isReady=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}};t.ExternalComponentButtonComponent=__decorate([o.Component({selector:"se-external-component-button",template:`<div class="se-ctx-menu-btn__msg" *ngIf="isReady">{{ catalogVersion }}</div>`,providers:[n.L10nPipe],changeDetection:o.ChangeDetectionStrategy.OnPush}),__param(0,o.Inject(n.CONTEXTUAL_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,n.ICatalogService,n.L10nPipe,o.ChangeDetectorRef])],t.ExternalComponentButtonComponent);class IComponentVisibilityAlertService{checkAndAlertOnComponentVisibility(e){"proxyFunction";return null}}window.__smartedit__.addDecoratorPayload("Component","ComponentVisibilityAlertComponent",{selector:"se-component-visibility-alert",template:`<div>\n        <p [translate]="message"></p>\n        <div>\n            <a fd-link style="cursor:pointer" (click)="onClick()" [translate]="hyperlinkLabel"></a>\n        </div>\n    </div>`,changeDetection:o.ChangeDetectionStrategy.OnPush});t.ComponentVisibilityAlertComponent=class ComponentVisibilityAlertComponent{constructor(e,t,i){this.editorModalService=e;this.componentVisibilityAlertService=t;this.alertRef=i;this.hyperlinkLabel="se.cms.component.visibility.alert.hyperlink";({component:this.component,message:this.message}=this.alertRef.data)}onClick(){return __awaiter(this,void 0,void 0,(function*(){this.alertRef.dismiss();this.checkProvidedArguments(this.component);const e=yield this.editorModalService.openAndRerenderSlot(this.component.itemType,this.component.itemId,"visibilityTab");this.componentVisibilityAlertService.checkAndAlertOnComponentVisibility({itemId:e.uuid,itemType:e.itemtype,catalogVersion:e.catalogVersion,restricted:e.restricted,slotId:this.component.slotId,visible:e.visible})}))}checkProvidedArguments(e){const t=[e.itemId,e.itemType,e.slotId];const i=t.filter((e=>e&&!n.stringUtils.isBlank(e)));if(i.length!==t.length){throw new Error("componentVisibilityAlertService.checkAndAlertOnComponentVisibility - missing properly typed parameters")}}};t.ComponentVisibilityAlertComponent=__decorate([o.Component({selector:"se-component-visibility-alert",template:`<div>\n        <p [translate]="message"></p>\n        <div>\n            <a fd-link style="cursor:pointer" (click)="onClick()" [translate]="hyperlinkLabel"></a>\n        </div>\n    </div>`,changeDetection:o.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[n.IEditorModalService,IComponentVisibilityAlertService,l.AlertRef])],t.ComponentVisibilityAlertComponent);t.ComponentVisibilityAlertModule=class ComponentVisibilityAlertModule{};t.ComponentVisibilityAlertModule=__decorate([o.NgModule({imports:[n.TranslationModule.forChild(),u.LinkModule],declarations:[t.ComponentVisibilityAlertComponent],entryComponents:[t.ComponentVisibilityAlertComponent]})],t.ComponentVisibilityAlertModule);window.__smartedit__.addDecoratorPayload("Component","SlotSyncButtonComponent",{selector:"slot-sync-button",template:`<div class="se-slot-sync-button-template" *ngIf="isReady"><se-popup-overlay #popupOverlayComponent [popupOverlay]="popupConfig" [popupOverlayTrigger]="isPopupOpened" (popupOverlayOnHide)="onPopupHide()"><div><se-tooltip *ngIf="newSlotIsNotSynchronized && !slotIsShared" [triggers]="['mouseenter', 'mouseleave']" [placement]="'bottom'" [additionalClasses]="['se-slot-ctx-menu__tooltip-area']"><span class="se-slot-ctx-menu__popover-ancor" se-tooltip-trigger></span><div class="se-popover--inner-content" se-tooltip-body translate="se.cms.slot.sync.from.page.level"></div></se-tooltip><se-tooltip *ngIf="newSlotIsNotSynchronized && slotIsShared" [triggers]="['mouseenter', 'mouseleave']" [placement]="'bottom'" [additionalClasses]="['se-slot-ctx-menu__tooltip-area']"><span class="se-slot-ctx-menu__popover-ancor" se-tooltip-trigger></span><div se-tooltip-body class="se-popover--inner-content" translate="se.cms.slot.sync.from.catalog.level"></div></se-tooltip><button type="button" (click)="dropdownToggle()" class="se-slot-ctx-menu__dropdown-toggle" [ngClass]="{\n                'se-slot-ctx-menu__dropdown-toggle--open': isPopupOpened,\n                'se-slot-ctx-menu__dropdown-toggle--disabled': newSlotIsNotSynchronized\n            }" id="slot-sync-button-{{slotId}}"><span class="sap-icon--synchronize se-slot-ctx-menu__dropdown-toggle-icon" title="{{ 'se.cms.pagetree.slot.node.menu.icon.synchronize.title' | translate }}"></span> <span *ngIf="!isSlotInSync" class="sap-icon--alert se-slot-sync__btn-status se-slot-ctx-menu__dropdown-toggle-add-on"></span></button></div><div class="se-slot__dropdown-menu" se-popup-overlay-body><div class="se-toolbar-menu-content__wrapper" *ngIf="isPopupOpened"><div class="se-slot-contextual-menu__header" translate="se.cms.synchronization.slot.header"></div><div class="se-slot-sync__body"><se-slot-synchronization-panel-wrapper [slotId]="slotId" (slotSyncItemsUpdated)="updatePosition()"></se-slot-synchronization-panel-wrapper></div></div></div></se-popup-overlay></div>`,styles:[`slot-sync-button .se-slot-ctx-menu__tooltip-area{position:absolute}slot-sync-button .se-slot-ctx-menu__tooltip-area,slot-sync-button .se-slot-ctx-menu__tooltip-area .fd-popover__control,slot-sync-button .se-slot-ctx-menu__tooltip-area>div{width:100%;height:100%}`],encapsulation:o.ViewEncapsulation.None});t.SlotSyncButtonComponent=class SlotSyncButtonComponent{constructor(e,t,i,o,n){this.contextualMenuItem=e;this.slotSynchronizationService=t;this.pageInfoService=i;this.crossFrameEventService=o;this.cdr=n;this.buttonName="slotSyncButton";this.isPopupOpened=false;this.isReady=false;this.isSlotInSync=true;this.newSlotIsNotSynchronized=false;this.slotIsShared=false;this.popupConfig={halign:"left",valign:"bottom",additionalClasses:["se-slot-ctx-menu__divider","se-slot-ctx-menu__dropdown-toggle-wrapper"]}}ngOnInit(){this.unregisterSyncPolling=this.crossFrameEventService.subscribe(de.FAST_FETCH,(()=>this.getSyncStatus()));this.unregisterOuterFrameClicked=this.crossFrameEventService.subscribe(n.EVENT_OUTER_FRAME_CLICKED,(()=>{if(this.crossFrameEventService.isIframe()){this.isPopupOpened=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}}));this.unregisterInnerFrameClicked=this.crossFrameEventService.subscribe(n.EVENT_INNER_FRAME_CLICKED,(()=>{if(!this.crossFrameEventService.isIframe()){this.isPopupOpened=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}}));return this.getSyncStatus()}ngOnDestroy(){if(this.unregisterSyncPolling){this.unregisterSyncPolling()}if(this.unregisterOuterFrameClicked){this.unregisterOuterFrameClicked()}if(this.unregisterInnerFrameClicked){this.unregisterInnerFrameClicked()}}ngDoCheck(){if(this.isPopupOpenedPreviousValue!==this.isPopupOpened){this.contextualMenuItem.setRemainOpen(this.buttonName,this.isPopupOpened);this.isPopupOpenedPreviousValue=this.isPopupOpened}}get slotId(){return this.contextualMenuItem.componentAttributes.smarteditComponentId}dropdownToggle(){this.isPopupOpened=!this.isPopupOpened}onPopupHide(){this.isPopupOpened=false}updatePosition(){setTimeout((()=>this.popupOverlay.updatePosition()))}getSyncStatus(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageInfoService.getPageUUID();const t=yield this.slotSynchronizationService.getSyncStatus(e,this.slotId);if(this.slotSynchronizationService.syncStatusExists(t)){this.isSlotInSync=this.statusIsInSync(t);this.newSlotIsNotSynchronized=this.slotHasBeenSynchronizedAtLeastOnce(t);this.slotIsShared=t.fromSharedDependency;this.isReady=true}else{this.isReady=false}if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}statusIsInSync(e){return(e===null||e===void 0?void 0:e.status)===ce.IN_SYNC}slotHasBeenSynchronizedAtLeastOnce(e){return!e.lastSyncStatus}};__decorate([o.ViewChild("popupOverlayComponent"),__metadata("design:type",n.PopupOverlayComponent)],t.SlotSyncButtonComponent.prototype,"popupOverlay",void 0);t.SlotSyncButtonComponent=__decorate([o.Component({selector:"slot-sync-button",template:`<div class="se-slot-sync-button-template" *ngIf="isReady"><se-popup-overlay #popupOverlayComponent [popupOverlay]="popupConfig" [popupOverlayTrigger]="isPopupOpened" (popupOverlayOnHide)="onPopupHide()"><div><se-tooltip *ngIf="newSlotIsNotSynchronized && !slotIsShared" [triggers]="['mouseenter', 'mouseleave']" [placement]="'bottom'" [additionalClasses]="['se-slot-ctx-menu__tooltip-area']"><span class="se-slot-ctx-menu__popover-ancor" se-tooltip-trigger></span><div class="se-popover--inner-content" se-tooltip-body translate="se.cms.slot.sync.from.page.level"></div></se-tooltip><se-tooltip *ngIf="newSlotIsNotSynchronized && slotIsShared" [triggers]="['mouseenter', 'mouseleave']" [placement]="'bottom'" [additionalClasses]="['se-slot-ctx-menu__tooltip-area']"><span class="se-slot-ctx-menu__popover-ancor" se-tooltip-trigger></span><div se-tooltip-body class="se-popover--inner-content" translate="se.cms.slot.sync.from.catalog.level"></div></se-tooltip><button type="button" (click)="dropdownToggle()" class="se-slot-ctx-menu__dropdown-toggle" [ngClass]="{\n                'se-slot-ctx-menu__dropdown-toggle--open': isPopupOpened,\n                'se-slot-ctx-menu__dropdown-toggle--disabled': newSlotIsNotSynchronized\n            }" id="slot-sync-button-{{slotId}}"><span class="sap-icon--synchronize se-slot-ctx-menu__dropdown-toggle-icon" title="{{ 'se.cms.pagetree.slot.node.menu.icon.synchronize.title' | translate }}"></span> <span *ngIf="!isSlotInSync" class="sap-icon--alert se-slot-sync__btn-status se-slot-ctx-menu__dropdown-toggle-add-on"></span></button></div><div class="se-slot__dropdown-menu" se-popup-overlay-body><div class="se-toolbar-menu-content__wrapper" *ngIf="isPopupOpened"><div class="se-slot-contextual-menu__header" translate="se.cms.synchronization.slot.header"></div><div class="se-slot-sync__body"><se-slot-synchronization-panel-wrapper [slotId]="slotId" (slotSyncItemsUpdated)="updatePosition()"></se-slot-synchronization-panel-wrapper></div></div></div></se-popup-overlay></div>`,styles:[`slot-sync-button .se-slot-ctx-menu__tooltip-area{position:absolute}slot-sync-button .se-slot-ctx-menu__tooltip-area,slot-sync-button .se-slot-ctx-menu__tooltip-area .fd-popover__control,slot-sync-button .se-slot-ctx-menu__tooltip-area>div{width:100%;height:100%}`],encapsulation:o.ViewEncapsulation.None}),__param(0,o.Inject(n.CONTEXTUAL_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,t.SlotSynchronizationService,n.IPageInfoService,n.CrossFrameEventService,o.ChangeDetectorRef])],t.SlotSyncButtonComponent);window.__smartedit__.addDecoratorPayload("Component","SlotSynchronizationPanelWrapperComponent",{selector:"se-slot-synchronization-panel-wrapper",template:`<se-synchronization-panel [itemId]="slotId" [getSyncStatus]="getSyncStatus" [performSync]="performSync" [selectAllLabel]="'se.cms.synchronization.slots.select.all.components'" (getApi)="getApi($event)" (syncItemsUpdated)="syncItemsUpdated()"></se-synchronization-panel>`});t.SlotSynchronizationPanelWrapperComponent=class SlotSynchronizationPanelWrapperComponent{constructor(e,t,i,n,s){this.pageService=e;this.pageInfoService=t;this.slotSynchronizationService=i;this.pageContentSlotsService=n;this.translateService=s;this.slotSyncItemsUpdated=new o.EventEmitter;this.getSyncStatus=()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.pageInfoService.getPageUID();const t=yield this.slotSynchronizationService.getSyncStatus(e,this.slotId);if(!this.slotSynchronizationService.syncStatusExists(t)){throw new Error("The SlotSynchronizationPanel must only be called for the slot whose sync status is available.")}const i=yield this.isSyncDisallowed();if(i){this.disableSync()}return t}));this.performSync=e=>this.slotSynchronizationService.performSync(e,null)}getApi(e){this.synchronizationPanelApi=e}syncItemsUpdated(){this.slotSyncItemsUpdated.emit()}isSyncDisallowed(){return __awaiter(this,void 0,void 0,(function*(){const[e,t]=yield Promise.all([this.isPageSlot(),this.isPageApproved()]);return e&&!t}))}isPageSlot(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageContentSlotsService.getSlotStatus(this.slotId);return e===t.SlotStatus.PAGE||e===t.SlotStatus.OVERRIDE}))}isPageApproved(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageInfoService.getPageUUID();return this.pageService.isPageApproved(e)}))}disableSync(){this.synchronizationPanelApi.setMessage({type:n.IAlertServiceType.WARNING,description:this.translateService.instant("se.cms.synchronization.slot.disabled.msg")});this.synchronizationPanelApi.disableItemList(true)}};__decorate([o.Input(),__metadata("design:type",String)],t.SlotSynchronizationPanelWrapperComponent.prototype,"slotId",void 0);__decorate([o.Output(),__metadata("design:type",o.EventEmitter)],t.SlotSynchronizationPanelWrapperComponent.prototype,"slotSyncItemsUpdated",void 0);t.SlotSynchronizationPanelWrapperComponent=__decorate([o.Component({selector:"se-slot-synchronization-panel-wrapper",template:`<se-synchronization-panel [itemId]="slotId" [getSyncStatus]="getSyncStatus" [performSync]="performSync" [selectAllLabel]="'se.cms.synchronization.slots.select.all.components'" (getApi)="getApi($event)" (syncItemsUpdated)="syncItemsUpdated()"></se-synchronization-panel>`}),__metadata("design:paramtypes",[n.IPageService,n.IPageInfoService,t.SlotSynchronizationService,n.PageContentSlotsService,s.TranslateService])],t.SlotSynchronizationPanelWrapperComponent);window.__smartedit__.addDecoratorPayload("Component","SlotSharedButtonComponent",{selector:"slot-shared-button",template:`<div class="se-shared-slot-button-template" *ngIf="isGlobalSlot || isSlotShared"><se-popup-overlay [popupOverlay]="popupConfig" [popupOverlayTrigger]="isPopupOpened" (popupOverlayOnHide)="hidePopup()"><button type="button" id="sharedSlotButton-{{ slotId }}" class="se-slot-ctx-menu__dropdown-toggle se-slot-ctx-menu__dropdown-toggle-icon" [ngClass]="{\n                'se-slot-ctx-menu__dropdown-toggle--open': isPopupOpened,\n                'sap-icon--chain-link': isSlotShared,\n                'sap-icon--globe': isGlobalSlot\n            }" (click)="onButtonClick()" title="{{ getSlotSharedButtonComponentIconTitle() | translate }}"></button><div class="se-slot__dropdown-menu" se-popup-overlay-body><div class="se-slot-contextual-menu__header" [translate]="labelL10nKey"></div><div class="se-shared-slot__body"><div class="se-shared-slot__description" translate="se.cms.slot.shared.popover.commonmessage"></div><div class="se-shared-slot__description" [translate]="descriptionL10nKey" [translateParams]="{ catalogVersion: componentAttributes.smarteditCatalogVersionUuid }"></div><div *seHasOperationPermission="'se.shared.slot.override.options'"><div class="se-shared-slot__option"><a href="#" class="se-shared-slot__link replace-slot-link fd-link" translate="se.cms.slot.shared.popover.button.replaceslot" (click)="replaceSlot($event)"></a></div></div></div></div></se-popup-overlay></div>`});t.SlotSharedButtonComponent=class SlotSharedButtonComponent{constructor(e,t,i,o,n,s,a){this.contextualMenuItem=e;this.catalogService=t;this.componentHandlerService=i;this.crossFrameEventService=o;this.pageInfoService=n;this.slotSharedService=s;this.cdr=a;this.popupConfig={halign:"left",valign:"bottom",additionalClasses:["se-slot-ctx-menu__divider","se-slot-ctx-menu__dropdown-toggle-wrapper"]};this.buttonName="slotSharedButton";this.isPopupOpened=false;this.isPopupOpenedPreviousValue=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.unRegOuterFrameClicked=this.crossFrameEventService.subscribe(n.EVENT_OUTER_FRAME_CLICKED,(()=>{if(this.crossFrameEventService.isIframe()){this.hidePopup()}}));this.unRegInnerFrameClicked=this.crossFrameEventService.subscribe(n.EVENT_INNER_FRAME_CLICKED,(()=>{if(!this.crossFrameEventService.isIframe()){this.hidePopup()}}));this.isExternalSlot=yield this.componentHandlerService.isExternalComponent(this.slotId,this.componentAttributes.smarteditComponentType);const[e,t,i,o]=yield Promise.all([this.slotSharedService.isSlotShared(this.slotId),this.catalogService.isCurrentCatalogMultiCountry(),this.slotSharedService.isGlobalSlot(this.slotId,this.componentAttributes.smarteditComponentType),this.pageInfoService.isSameCatalogVersionOfPageAndPageTemplate()]);const s=t;this.isSlotShared=(!s||s&&o)&&!this.isExternalSlot&&e;this.isGlobalSlot=i;this.labelL10nKey=this.isGlobalSlot?"se.parentslot.decorator.label":"se.sharedslot.decorator.label";this.descriptionL10nKey=this.isGlobalSlot?"se.cms.slot.shared.parent.popover.message":"se.cms.slot.shared.popover.message";if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}getSlotSharedButtonComponentIconTitle(){if(!this.isGlobalSlot){return this.isSlotShared?"se.cms.pagetree.slot.node.menu.icon.chain.link.title":"se.cms.pagetree.slot.node.menu.icon.chain.dislink.title"}return"se.cms.pagetree.slot.node.menu.icon.chain.globalicon.title"}ngOnDestroy(){if(this.unRegOuterFrameClicked){this.unRegOuterFrameClicked()}if(this.unRegInnerFrameClicked){this.unRegInnerFrameClicked()}}ngDoCheck(){if(this.isPopupOpenedPreviousValue!==this.isPopupOpened){this.contextualMenuItem.setRemainOpen(this.buttonName,this.isPopupOpened);this.isPopupOpenedPreviousValue=this.isPopupOpened}}get componentAttributes(){return this.contextualMenuItem.componentAttributes}get slotId(){return this.componentAttributes.smarteditComponentId}onButtonClick(){this.isPopupOpened=!this.isPopupOpened}hidePopup(){this.isPopupOpened=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}replaceSlot(e){return __awaiter(this,void 0,void 0,(function*(){e.preventDefault();this.hidePopup();let t;if(this.isGlobalSlot){t=this.slotSharedService.replaceGlobalSlot(this.componentAttributes)}else{t=this.slotSharedService.replaceSharedSlot(this.componentAttributes)}yield t;this.reload()}))}reload(){this.componentHandlerService.reloadInner()}};t.SlotSharedButtonComponent=__decorate([o.Component({selector:"slot-shared-button",template:`<div class="se-shared-slot-button-template" *ngIf="isGlobalSlot || isSlotShared"><se-popup-overlay [popupOverlay]="popupConfig" [popupOverlayTrigger]="isPopupOpened" (popupOverlayOnHide)="hidePopup()"><button type="button" id="sharedSlotButton-{{ slotId }}" class="se-slot-ctx-menu__dropdown-toggle se-slot-ctx-menu__dropdown-toggle-icon" [ngClass]="{\n                'se-slot-ctx-menu__dropdown-toggle--open': isPopupOpened,\n                'sap-icon--chain-link': isSlotShared,\n                'sap-icon--globe': isGlobalSlot\n            }" (click)="onButtonClick()" title="{{ getSlotSharedButtonComponentIconTitle() | translate }}"></button><div class="se-slot__dropdown-menu" se-popup-overlay-body><div class="se-slot-contextual-menu__header" [translate]="labelL10nKey"></div><div class="se-shared-slot__body"><div class="se-shared-slot__description" translate="se.cms.slot.shared.popover.commonmessage"></div><div class="se-shared-slot__description" [translate]="descriptionL10nKey" [translateParams]="{ catalogVersion: componentAttributes.smarteditCatalogVersionUuid }"></div><div *seHasOperationPermission="'se.shared.slot.override.options'"><div class="se-shared-slot__option"><a href="#" class="se-shared-slot__link replace-slot-link fd-link" translate="se.cms.slot.shared.popover.button.replaceslot" (click)="replaceSlot($event)"></a></div></div></div></div></se-popup-overlay></div>`}),__param(0,o.Inject(n.CONTEXTUAL_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,n.ICatalogService,n.IComponentHandlerService,n.CrossFrameEventService,n.IPageInfoService,n.SlotSharedService,o.ChangeDetectorRef])],t.SlotSharedButtonComponent);window.__smartedit__.addDecoratorPayload("Component","SlotUnsharedButtonComponent",{selector:"slot-unshared-button",template:`<div class="slot-unshared-button-template" *ngIf="isLocalSlot || isNonSharedSlot"><se-popup-overlay [popupOverlay]="popupConfig" [popupOverlayTrigger]="isPopupOpened" (popupOverlayOnHide)="hidePopup()"><button type="button" id="slot-unshared-button-{{ slotId }}" class="se-slot-ctx-menu__dropdown-toggle se-slot-ctx-menu__dropdown-toggle-icon" [ngClass]="{\n                'se-slot-ctx-menu__dropdown-toggle--open': isPopupOpened,\n                'sap-icon--chain-link': isLocalSlot,\n                'sap-icon--broken-link': isNonSharedSlot\n            }" (click)="toggle()" title="{{ getSlotNotSharedButtonComponentIconTitle() | translate }}"></button><div class="se-toolbar-menu-content se-slot__dropdown-menu" se-popup-overlay-body><div class="se-slot-contextual-menu__header" [translate]="getHeader()"></div><div class="se-shared-slot__body"><div class="se-shared-slot__description" translate="se.cms.slot.unshared.popover.commonmessage"></div><div *seHasOperationPermission="'se.shared.slot.override.options'" class="se-shared-slot-replace__div"><div *ngIf="isLocalSlot" class="se-shared-slot__option"><a href="#" class="se-shared-slot__link replace-slot-link fd-link" translate="se.cms.slot.shared.popover.button.replaceslot" (click)="replaceSlot($event)"></a></div></div><div *seHasOperationPermission="'se.revert.to.global.or.shared.slot.link'" class="se-shared-slot__option"><a href="#" class="se-shared-slot__link revert-slot-link fd-link" [translate]="removeSlotLinkLabel" (click)="removeSlot($event)"></a></div></div></div></se-popup-overlay></div>`,changeDetection:o.ChangeDetectionStrategy.OnPush});t.SlotUnsharedButtonComponent=class SlotUnsharedButtonComponent{constructor(e,t,i,o,n,s,a,r,l,d,p,m,g){this.contextualMenuItem=e;this.catalogService=t;this.confirmationModalService=i;this.componentHandlerService=o;this.crossFrameEventService=n;this.slotUnsharedService=s;this.sharedDataService=a;this.slotSharedService=r;this.translateService=l;this.pageInfoService=d;this.logService=p;this.windowUtils=m;this.cdr=g;this.isPopupOpened=false;this.isPopupOpenedPreviousValue=this.isPopupOpened;this.popupConfig={halign:"left",valign:"bottom",additionalClasses:["se-slot-ctx-menu__dropdown-toggle-wrapper","se-slot-ctx-menu__divider"]};this.buttonName="slotUnsharedButton"}ngOnInit(){var e,t;return __awaiter(this,void 0,void 0,(function*(){this.unRegOuterFrameClicked=this.crossFrameEventService.subscribe(n.EVENT_OUTER_FRAME_CLICKED,(()=>{if(this.windowUtils.isIframe()){this.hidePopup()}}));this.unRegInnerFrameClicked=this.crossFrameEventService.subscribe(n.EVENT_INNER_FRAME_CLICKED,(()=>{if(!this.windowUtils.isIframe()){this.hidePopup()}}));this.isExternalSlot=yield this.componentHandlerService.isExternalComponent(this.slotId,this.componentAttributes.smarteditComponentType);const[i,o,s,a,r]=yield Promise.all([this.slotUnsharedService.isSlotShared(this.slotId),this.catalogService.isCurrentCatalogMultiCountry(),this.slotUnsharedService.isSlotUnshared(this.slotId),this.pageInfoService.isSameCatalogVersionOfPageAndPageTemplate(),this.sharedDataService.get("experience")]);this.isSlotShared=i;this.isMultiCountry=o;this.isSlotUnshared=s;const l=((e=r===null||r===void 0?void 0:r.pageContext)===null||e===void 0?void 0:e.catalogVersionUuid)||"";const d=((t=r===null||r===void 0?void 0:r.catalogDescriptor)===null||t===void 0?void 0:t.catalogVersionUuid)||"";this.isCurrentPageFromParent=d!==l;this.isLocalSlot=this.isMultiCountry&&!a&&!this.isExternalSlot&&!this.isCurrentPageFromParent&&this.isSlotShared;this.isNonSharedSlot=!this.isExternalSlot&&!this.isSlotShared&&this.isSlotUnshared;this.removeSlotLinkLabel=this.getRemoveSlotLinkLabel();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}getSlotNotSharedButtonComponentIconTitle(){return this.isSlotShared?"se.cms.pagetree.slot.node.menu.icon.chain.link.title":"se.cms.pagetree.slot.node.menu.icon.chain.dislink.title"}ngOnDestroy(){if(this.unRegOuterFrameClicked){this.unRegOuterFrameClicked()}if(this.unRegInnerFrameClicked){this.unRegInnerFrameClicked()}}ngDoCheck(){if(this.isPopupOpenedPreviousValue!==this.isPopupOpened){this.isPopupOpenedPreviousValue=this.isPopupOpened;this.contextualMenuItem.setRemainOpen(this.buttonName,this.isPopupOpened)}}get componentAttributes(){return this.contextualMenuItem.componentAttributes}get slotId(){return this.componentAttributes.smarteditComponentId}getHeader(){return this.isLocalSlot?"se.localslot.decorator.label":"se.nonshared.decorator.label"}toggle(){this.isPopupOpened=!this.isPopupOpened}hidePopup(){this.isPopupOpened=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}removeSlot(e){return __awaiter(this,void 0,void 0,(function*(){e.preventDefault();this.hidePopup();const t=yield this.confirmationModalService.confirm({title:this.removeSlotLinkLabel,description:this.isLocalSlot?"se.cms.local.slot.remove.description":"se.cms.slot.remove.description",message:{id:"removeSlotYMessage",text:this.isLocalSlot?"se.cms.local.slot.remove.sync.ymessage":"se.cms.slot.remove.sync.ymessage",type:n.MessageType.info}}).catch((()=>{this.logService.log("Confirmation cancelled")}));if(!t){return}yield this.slotUnsharedService.revertToSharedSlot(this.componentAttributes.smarteditComponentUuid);this.reload()}))}replaceSlot(e){return __awaiter(this,void 0,void 0,(function*(){e.preventDefault();this.hidePopup();let t;if(this.isLocalSlot){t=this.slotSharedService.replaceSharedSlot(this.componentAttributes)}yield t;this.reload()}))}getRemoveSlotLinkLabel(){return this.isLocalSlot?"se.cms.slot.shared.remove.local.slot.title":"se.cms.slot.shared.remove.nonshard.slot.title"}reload(){this.componentHandlerService.reloadInner()}};t.SlotUnsharedButtonComponent=__decorate([o.Component({selector:"slot-unshared-button",template:`<div class="slot-unshared-button-template" *ngIf="isLocalSlot || isNonSharedSlot"><se-popup-overlay [popupOverlay]="popupConfig" [popupOverlayTrigger]="isPopupOpened" (popupOverlayOnHide)="hidePopup()"><button type="button" id="slot-unshared-button-{{ slotId }}" class="se-slot-ctx-menu__dropdown-toggle se-slot-ctx-menu__dropdown-toggle-icon" [ngClass]="{\n                'se-slot-ctx-menu__dropdown-toggle--open': isPopupOpened,\n                'sap-icon--chain-link': isLocalSlot,\n                'sap-icon--broken-link': isNonSharedSlot\n            }" (click)="toggle()" title="{{ getSlotNotSharedButtonComponentIconTitle() | translate }}"></button><div class="se-toolbar-menu-content se-slot__dropdown-menu" se-popup-overlay-body><div class="se-slot-contextual-menu__header" [translate]="getHeader()"></div><div class="se-shared-slot__body"><div class="se-shared-slot__description" translate="se.cms.slot.unshared.popover.commonmessage"></div><div *seHasOperationPermission="'se.shared.slot.override.options'" class="se-shared-slot-replace__div"><div *ngIf="isLocalSlot" class="se-shared-slot__option"><a href="#" class="se-shared-slot__link replace-slot-link fd-link" translate="se.cms.slot.shared.popover.button.replaceslot" (click)="replaceSlot($event)"></a></div></div><div *seHasOperationPermission="'se.revert.to.global.or.shared.slot.link'" class="se-shared-slot__option"><a href="#" class="se-shared-slot__link revert-slot-link fd-link" [translate]="removeSlotLinkLabel" (click)="removeSlot($event)"></a></div></div></div></se-popup-overlay></div>`,changeDetection:o.ChangeDetectionStrategy.OnPush}),__param(0,o.Inject(n.CONTEXTUAL_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,n.ICatalogService,n.IConfirmationModalService,n.IComponentHandlerService,n.CrossFrameEventService,t.SlotUnsharedService,n.ISharedDataService,n.SlotSharedService,s.TranslateService,n.IPageInfoService,n.LogService,n.WindowUtils,o.ChangeDetectorRef])],t.SlotUnsharedButtonComponent);t.CmsCommonsModule=class CmsCommonsModule{};t.CmsCommonsModule=__decorate([o.NgModule({imports:[a.CommonModule,n.SpinnerModule,u.LinkModule,s.TranslateModule.forChild(),t.SynchronizationPanelModule,t.ComponentVisibilityAlertModule,n.TooltipModule,n.PopupOverlayModule,n.HasOperationPermissionDirectiveModule],providers:[t.AttributePermissionsRestService,t.CMSTimeService,t.SynchronizationService,t.TypePermissionsRestService,t.ComponentService,t.SynchronizationResourceService,t.AssetsService],declarations:[t.ActionableAlertComponent,t.SharedComponentButtonComponent,t.ExternalComponentButtonComponent,t.SlotSyncButtonComponent,t.SlotSynchronizationPanelWrapperComponent,t.SlotSharedButtonComponent,t.SlotUnsharedButtonComponent],entryComponents:[t.SharedComponentButtonComponent,t.ExternalComponentButtonComponent,t.SlotSyncButtonComponent,t.SlotSynchronizationPanelWrapperComponent,t.SlotSharedButtonComponent,t.SlotUnsharedButtonComponent],exports:[t.ActionableAlertComponent,t.SharedComponentButtonComponent,t.ExternalComponentButtonComponent,t.SlotSyncButtonComponent,t.SlotSharedButtonComponent,t.SlotUnsharedButtonComponent,t.SynchronizationPanelModule,t.ComponentVisibilityAlertModule]})],t.CmsCommonsModule);t.DRAG_AND_DROP_EVENTS=void 0;(function(e){e["DRAG_STARTED"]="CMS_DRAG_STARTED";e["DRAG_STOPPED"]="CMS_DRAG_STOPPED";e["DRAG_OVER"]="CMS_DRAG_OVER";e["DRAG_LEAVE"]="CMS_DRAG_LEAVE";e["SCROLL_TO_MODIFIED_SLOT"]="SCROLL_TO_MODIFIED_SLOT"})(t.DRAG_AND_DROP_EVENTS||(t.DRAG_AND_DROP_EVENTS={}));const _e="COMPONENT_CREATED_EVENT";const ve="COMPONENT_REMOVED_EVENT";const fe="COMPONENT_UPDATED_EVENT";const ye="CMSITEMS_UPDATE";const Se="EVENT_PAGE_STATUS_UPDATED_IN_ACTIVE_CV";const Ce="CMSNavigationNode";const be="root";const Ie="/cmssmartedit/images";t.CATALOG_SYNC_INTERVAL_IN_MILLISECONDS=ge;t.CMSITEMS_UPDATE_EVENT=ye;t.COMPONENT_CREATED_EVENT=_e;t.COMPONENT_REMOVED_EVENT=ve;t.COMPONENT_UPDATED_EVENT=fe;t.CONTENT_SLOTS_TYPE_RESTRICTION_RESOURCE_URI=H;t.CONTENT_SLOT_TYPE_RESTRICTION_RESOURCE_URI=G;t.CONTEXTUAL_PAGES_RESTRICTIONS_RESOURCE_URI=ie;t.CONTEXT_CATALOG=E;t.CONTEXT_CATALOG_VERSION=w;t.CONTEXT_SITE_ID=A;t.DEFAULT_SYNCHRONIZATION_EVENT=pe;t.DEFAULT_SYNCHRONIZATION_POLLING=de;t.DEFAULT_SYNCHRONIZATION_STATUSES=ce;t.EVENT_PAGE_STATUS_UPDATED_IN_ACTIVE_CV=Se;t.GET_PAGE_SYNCHRONIZATION_RESOURCE_URI=re;t.IComponentEditingFacade=IComponentEditingFacade;t.IComponentMenuConditionAndCallbackService=IComponentMenuConditionAndCallbackService;t.IComponentSharedService=IComponentSharedService;t.IComponentVisibilityAlertService=IComponentVisibilityAlertService;t.IContextAwareEditableItemService=IContextAwareEditableItemService;t.IEditorEnablerService=IEditorEnablerService;t.IMAGES_URL=Ie;t.IPageContentSlotsComponentsRestService=IPageContentSlotsComponentsRestService;t.IRemoveComponentService=IRemoveComponentService;t.ISlotVisibilityService=ISlotVisibilityService;t.ITEMS_RESOURCE_URI=B;t.NAVIGATION_MANAGEMENT_ENTRIES_RESOURCE_URI=ee;t.NAVIGATION_MANAGEMENT_ENTRY_TYPES_RESOURCE_URI=te;t.NAVIGATION_MANAGEMENT_PAGE_PATH=Q;t.NAVIGATION_MANAGEMENT_RESOURCE_URI=J;t.NAVIGATION_NODE_ROOT_NODE_UID=be;t.NAVIGATION_NODE_TYPECODE=Ce;t.PAGES_CONTENT_SLOT_COMPONENT_RESOURCE_URI=j;t.PAGES_CONTENT_SLOT_RESOURCE_URI=Y;t.PAGES_LIST_RESOURCE_URI=W;t.PAGES_RESTRICTIONS_RESOURCE_URI=oe;t.PAGE_CONTEXT_CATALOG=R;t.PAGE_CONTEXT_CATALOG_VERSION=N;t.PAGE_LIST_PATH=$;t.PAGE_TEMPLATES_URI=Z;t.PAGE_TYPES_RESTRICTION_TYPES_URI=se;t.PAGE_TYPES_URI=ae;t.POST_PAGE_SYNCHRONIZATION_RESOURCE_URI=le;t.RESTRICTION_TYPES_URI=ne;t.SynchronizationUtils=SynchronizationUtils;t.TRASHED_PAGE_LIST_PATH=K;t.TYPES_RESOURCE_URI=L;t.WORKFLOW_CREATED_EVENT=_;t.WORKFLOW_FINISHED_EVENT=v;t.slotEvictionTag=b;t.synchronizationUtils=me;t.workflowCompletedEvictionTag=y;t.workflowCreatedEvictionTag=f;t.workflowTasksMenuOpenedEvictionTag=S},70448:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(54526);var n=i(32709);var s=i(19662);var a=i(9501);var r=i(3490);var l=i(12549);var d=i(66791);var p=i(22630);var m=i(38102);var g=i(30178);var u=i(72093);var h=i(67564);var _=i(18681);var v=i(40849);var f=i(78471);var y=i(99662);var S=i(37100);var b=i(93620);var E=i(58877);function _interopNamespace(e){if(e&&e.__esModule)return e;var t=Object.create(null);if(e){Object.keys(e).forEach((function(i){if(i!=="default"){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,o.get?o:{enumerable:true,get:function(){return e[i]}})}}))}t["default"]=e;return Object.freeze(t)}var w=_interopNamespace(p);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}window.__smartedit__.addDecoratorPayload("Component","SubTypeSelectorComponent",{selector:"se-sub-type-selector",template:`<ul class="se-sub-type__selector"><li class="cms-sub-type__selector-link fd-menu__item" *ngFor="let subType of subTypes" (click)="select(subType)" [translate]="subType.label"></li></ul>`,styles:[`.cms-sub-type__selector-link{display:flex;flex-direction:row;align-items:center;color:var(--sapLinkColor);height:46px}.cms-sub-type__selector-link.fd-menu__item:hover{border-radius:unset}`],changeDetection:n.ChangeDetectionStrategy.OnPush});t.SubTypeSelectorComponent=class SubTypeSelectorComponent{constructor(){this.onSubTypeSelect=new n.EventEmitter}select({id:e}){this.onSubTypeSelect.emit(e)}};__decorate([n.Input(),__metadata("design:type",Array)],t.SubTypeSelectorComponent.prototype,"subTypes",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.SubTypeSelectorComponent.prototype,"onSubTypeSelect",void 0);t.SubTypeSelectorComponent=__decorate([n.Component({selector:"se-sub-type-selector",template:`<ul class="se-sub-type__selector"><li class="cms-sub-type__selector-link fd-menu__item" *ngFor="let subType of subTypes" (click)="select(subType)" [translate]="subType.label"></li></ul>`,styles:[`.cms-sub-type__selector-link{display:flex;flex-direction:row;align-items:center;color:var(--sapLinkColor);height:46px}.cms-sub-type__selector-link.fd-menu__item:hover{border-radius:unset}`],changeDetection:n.ChangeDetectionStrategy.OnPush})],t.SubTypeSelectorComponent);window.__smartedit__.addDecoratorPayload("Component","SelectComponentTypeModalComponent",{selector:"se-select-component-type-modal",template:`\n        <se-sub-type-selector\n            class="sub-type-selector"\n            [subTypes]="subTypes"\n            (onSubTypeSelect)="closeWithSelectedId($event)">\n        </se-sub-type-selector>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush});t.SelectComponentTypeModalComponent=class SelectComponentTypeModalComponent{constructor(e){this.modalManager=e}ngOnInit(){this.modalManager.getModalData().pipe(d.take(1)).subscribe((({subTypes:e})=>this.subTypes=this.mapSubTypesToIdWithLabel(e)))}closeWithSelectedId(e){this.modalManager.close(e)}mapSubTypesToIdWithLabel(e){return Object.keys(e).map((t=>({id:t,label:e[t]})))}};t.SelectComponentTypeModalComponent=__decorate([n.Component({selector:"se-select-component-type-modal",template:`\n        <se-sub-type-selector\n            class="sub-type-selector"\n            [subTypes]="subTypes"\n            (onSubTypeSelect)="closeWithSelectedId($event)">\n        </se-sub-type-selector>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.ModalManagerService])],t.SelectComponentTypeModalComponent);const A="ON_EDIT_NESTED_COMPONENT";const R="CREATE_NESTED_COMPONENT_BUTTON_PRESSED_EVENT";window.__smartedit__.addDecoratorPayload("Component","CmsDropdownItemComponent",{selector:"se-cms-dropdown-item",template:`<div class="cms-nested-component" *ngIf="item" [attr.data-component-id]="item.uid"><span class="cms-nested-component__item" *ngIf="isSelected" (click)="onClick($event);"><span class="sap-icon--card cms-nested-component__item-icon"></span><div class="cms-nested-component__item-data"><p class="cms-nested-component__item-name" [title]="item.name">{{ item.name }}</p><p class="cms-nested-component__item-type" [title]="item.typeCode">{{ item.typeCode }}</p></div></span><div class="cms-nested-component__result-item" *ngIf="!isSelected"><span class="cms-nested-component__result-name" [title]="item.name">{{ item.name }}</span> <span class="cms-nested-component__result-code" [title]="item.typeCode">{{ item.typeCode }}</span></div></div>`,styles:[`.cms-nested-component__item{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;color:var(--sapIndicationColor_5)}.cms-nested-component__item-icon{display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:var(--sapIndicationColor_5);height:28px;flex:0 0 28px;border-radius:4px;margin-right:16px}.cms-nested-component__item-data{width:100%;display:grid;grid-template-columns:auto auto;grid-gap:0 16px}.cms-nested-component__item-name,.cms-nested-component__item-type{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;margin-bottom:0}.cms-nested-component__result-item{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:0 16px}.cms-nested-component__result-code,.cms-nested-component__result-name{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all}.cms-nested-component__item[draggable=true],.ui-select-match-item[draggable=true]{cursor:move}.y-select-item-printer{width:100%}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None});t.CmsDropdownItemComponent=class CmsDropdownItemComponent{constructor(e,t){this.systemEventService=t;({item:this.item,select:{id:this.qualifier},selected:this.isSelected}=e)}onClick(e){e.stopPropagation();if(this.isSelected){this.systemEventService.publishAsync(A,{qualifier:this.qualifier,item:this.item})}}};t.CmsDropdownItemComponent=__decorate([n.Component({selector:"se-cms-dropdown-item",template:`<div class="cms-nested-component" *ngIf="item" [attr.data-component-id]="item.uid"><span class="cms-nested-component__item" *ngIf="isSelected" (click)="onClick($event);"><span class="sap-icon--card cms-nested-component__item-icon"></span><div class="cms-nested-component__item-data"><p class="cms-nested-component__item-name" [title]="item.name">{{ item.name }}</p><p class="cms-nested-component__item-type" [title]="item.typeCode">{{ item.typeCode }}</p></div></span><div class="cms-nested-component__result-item" *ngIf="!isSelected"><span class="cms-nested-component__result-name" [title]="item.name">{{ item.name }}</span> <span class="cms-nested-component__result-code" [title]="item.typeCode">{{ item.typeCode }}</span></div></div>`,styles:[`.cms-nested-component__item{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;color:var(--sapIndicationColor_5)}.cms-nested-component__item-icon{display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:var(--sapIndicationColor_5);height:28px;flex:0 0 28px;border-radius:4px;margin-right:16px}.cms-nested-component__item-data{width:100%;display:grid;grid-template-columns:auto auto;grid-gap:0 16px}.cms-nested-component__item-name,.cms-nested-component__item-type{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;margin-bottom:0}.cms-nested-component__result-item{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:0 16px}.cms-nested-component__result-code,.cms-nested-component__result-name{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all}.cms-nested-component__item[draggable=true],.ui-select-match-item[draggable=true]{cursor:move}.y-select-item-printer{width:100%}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object,l.SystemEventService])],t.CmsDropdownItemComponent);let N=class SelectComponentTypeModalService{constructor(e,t){this.logService=e;this.modalService=t}open(e){return __awaiter(this,void 0,void 0,(function*(){return yield this.modalService.open({component:t.SelectComponentTypeModalComponent,data:{subTypes:e},config:{dialogPanelClass:"modal-lg"},templateConfig:{title:"se.cms.nestedcomponenteditor.select.type"}}).afterClosed.toPromise().catch((e=>{this.logService.debug("Select Component Type Modal dismissed",e)}))}))}};N=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.LogService,l.ModalService])],N);let L=class NestedComponentManagementService{constructor(e){this.editorModalService=e}openNestedComponentEditor(e,t){const i=this.prepareComponentAttributes(e);return this.editorModalService.open(i,null,null,null,null,t)}prepareComponentAttributes({componentUuid:e,componentType:t,content:i}){return{smarteditComponentUuid:e,smarteditComponentType:t,content:p.defaultsDeep({},i,{typeCode:t,itemtype:t,visible:true})}}};L=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IEditorModalService])],L);let B=class CMSItemDropdownDropdownPopulator extends l.DropdownPopulatorInterface{constructor(e,t,i,o){super(w,t,i);this.genericEditorStackService=e;this.uriDropdownPopulator=o;this.CMS_ITEMS_URI="/cmswebservices/v1/sites/CURRENT_CONTEXT_SITE_ID/cmsitems"}fetchAll(e){return __awaiter(this,void 0,void 0,(function*(){this.preparePayload(e);const t=yield this.uriDropdownPopulator.fetchAll(e);return this.getNonNestedComponents(e.field.editorStackId,t)}))}fetchPage(e){return __awaiter(this,void 0,void 0,(function*(){this.preparePayload(e);const t=yield this.uriDropdownPopulator.fetchPage(e);t.response=this.getNonNestedComponents(e.field.editorStackId,t.response);return t}))}getItem(e){this.preparePayload(e);return this.uriDropdownPopulator.getItem(e)}preparePayload(e){e.field.uri=this.CMS_ITEMS_URI}getNonNestedComponents(e,t){const i=this.genericEditorStackService.getEditorsStack(e).filter((e=>e.component.uuid)).map((e=>e.component.uuid));t=t.filter((e=>!e.uuid||!i.includes(e.uuid)));return t}};B=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.GenericEditorStackService,l.LanguageService,m.TranslateService,l.UriDropdownPopulator])],B);window.__smartedit__.addDecoratorPayload("Component","CmsComponentDropdownComponent",{selector:"se-cms-component-dropdown",template:`<div class="cms-nested-component-template"><div class="cms-nested-component-select"><ng-container *ngIf="forceRecompile"><se-generic-editor-dropdown [field]="field" [qualifier]="qualifier" [model]="model" [id]="id" [itemComponent]="itemComponent" [actionableSearchItem]="actionableSearchItem" [showRemoveButton]="true"></se-generic-editor-dropdown></ng-container></div></div>`,styles:[`se-cms-component-dropdown div.se-actionable-search-item{display:flex;align-items:center;justify-content:space-between;padding:0 0 0 13px}se-cms-component-dropdown se-item-printer{width:100%}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});t.CmsComponentDropdownComponent=class CmsComponentDropdownComponent{constructor(e,t,i,o,n,s,a){this.systemEventService=t;this.genericEditorStackService=i;this.nestedComponentManagementService=o;this.selectComponentTypeModalService=n;this.logService=s;this.cdr=a;({field:this.field,model:this.model,id:this.id,qualifier:this.qualifier}=e);this.editorStackId=e.editor.editorStackId;this.forceRecompile=true}ngOnInit(){this.itemComponent=t.CmsDropdownItemComponent;this.field.params=this.field.params||{};this.field.editorStackId=this.editorStackId;this.field.params.catalogId=r.CONTEXT_CATALOG;this.field.params.catalogVersion=r.CONTEXT_CATALOG_VERSION;this.componentButtonPressedEventId=`${R}_${this.qualifier}`;this.actionableSearchItem=!!this.field.subTypes&&Object.keys(this.field.subTypes).length>0?{eventId:this.componentButtonPressedEventId}:undefined;this.createComponentButtonUnRegFn=this.systemEventService.subscribe(this.componentButtonPressedEventId,((e,t)=>this.onCreateComponentButtonPressed(t)));this.editComponentClickedUnRegFn=this.systemEventService.subscribe(A,((e,t)=>this.onEditComponentClicked(t)))}ngOnDestroy(){this.createComponentButtonUnRegFn();this.editComponentClickedUnRegFn()}onCreateComponentButtonPressed(e){return __awaiter(this,void 0,void 0,(function*(){this.searchQuery=e;if(!this.genericEditorStackService.isTopEditorInStack(this.editorStackId,this.id)){return}if(this.field.subTypes){const e=Object.keys(this.field.subTypes);if(e.length>1){const e=yield this.selectComponentTypeModalService.open(this.field.subTypes);if(!!e){this.createNestedComponent(e)}}else{this.createNestedComponent(e[0])}}}))}onEditComponentClicked(e){if(this.genericEditorStackService.isTopEditorInStack(this.editorStackId,this.id)){if(this.qualifier===e.qualifier){this.editComponent(e.item)}}}createNestedComponent(e){return __awaiter(this,void 0,void 0,(function*(){const t={componentId:null,componentUuid:null,componentType:e,content:{name:this.searchQuery,catalogVersion:this.model.catalogVersion}};yield this.nestedComponentEditorHandler(t)}))}editComponent(e){return __awaiter(this,void 0,void 0,(function*(){const t={componentId:e.uid,componentUuid:e.uuid,componentType:e.typeCode||e.itemtype,content:e};yield this.nestedComponentEditorHandler(t)}))}nestedComponentEditorHandler(e){return __awaiter(this,void 0,void 0,(function*(){try{const t=yield this.nestedComponentManagementService.openNestedComponentEditor(e,this.editorStackId);if(this.field.collection){if(!this.model[this.qualifier]){this.model[this.qualifier]=[]}if(this.model[this.qualifier].indexOf(t.uuid)===-1){this.model[this.qualifier]=this.model[this.qualifier].concat(t.uuid)}else{this.forceRecompile=false;setTimeout((()=>{this.forceRecompile=true;this._detectChanges()}))}}else{this.forceRecompile=false;setTimeout((()=>{this.forceRecompile=true;this.model[this.qualifier]=t.uuid;this._detectChanges()}))}this._detectChanges()}catch(t){if(t){this.logService.warn(`Something went wrong when creating or editing Nested component (${e.componentType})`,t)}}}))}_detectChanges(){if(!this.cdr.destroyed){this.cdr.detectChanges()}}};t.CmsComponentDropdownComponent=__decorate([n.Component({selector:"se-cms-component-dropdown",template:`<div class="cms-nested-component-template"><div class="cms-nested-component-select"><ng-container *ngIf="forceRecompile"><se-generic-editor-dropdown [field]="field" [qualifier]="qualifier" [model]="model" [id]="id" [itemComponent]="itemComponent" [actionableSearchItem]="actionableSearchItem" [showRemoveButton]="true"></se-generic-editor-dropdown></ng-container></div></div>`,styles:[`se-cms-component-dropdown div.se-actionable-search-item{display:flex;align-items:center;justify-content:space-between;padding:0 0 0 13px}se-cms-component-dropdown se-item-printer{width:100%}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,l.SystemEventService,l.GenericEditorStackService,L,N,l.LogService,n.ChangeDetectorRef])],t.CmsComponentDropdownComponent);const j="ySEComponentMenuOpen";const G="RESET_COMPONENT_MENU_EVENT";var H;(function(e){e["information"]="showInfo";e["success"]="showSuccess";e["warning"]="showWarning";e["error"]="showDanger"})(H||(H={}));t.ActionableAlertService=class ActionableAlertService{constructor(e){this.alertService=e}displayActionableAlert(e,t){const i=this.getMethodNameByAlertType(t);return this.alertService[i](e)}getMethodNameByAlertType(e){if(e&&H[e]){return H[e]}return H.information}};t.ActionableAlertService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IAlertService])],t.ActionableAlertService);window.__smartedit__.addDecoratorPayload("Component","PageRestoredAlertComponent",{selector:"se-page-restored-alert-component",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<se-actionable-alert\n        [description]="message"\n        [hyperlinkLabel]="hyperlinkLabel"\n        [hyperlinkDetails]="hyperLinkDetails"\n        (hyperLinkClick)="onClick()"></se-actionable-alert>`});t.PageRestoredAlertComponent=class PageRestoredAlertComponent{constructor(e,t){this.alertRef=e;this.experienceService=t;this.hyperlinkLabel="se.cms.page.restored.alert.info.hyperlink";this.message="se.cms.page.restored.alert.info.description"}ngOnInit(){const{pageInfo:e}=this.alertRef.data;this.hyperLinkDetails={pageName:e.name}}onClick(){const{catalogVersion:e,pageInfo:t}=this.alertRef.data;this.alertRef.dismiss();this.experienceService.loadExperience({siteId:e.siteId,catalogId:e.catalogId,catalogVersion:e.version,pageId:t.uid})}};t.PageRestoredAlertComponent=__decorate([n.Component({selector:"se-page-restored-alert-component",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<se-actionable-alert\n        [description]="message"\n        [hyperlinkLabel]="hyperlinkLabel"\n        [hyperlinkDetails]="hyperLinkDetails"\n        (hyperLinkClick)="onClick()"></se-actionable-alert>`}),__metadata("design:paramtypes",[u.AlertRef,l.IExperienceService])],t.PageRestoredAlertComponent);t.PageRestoredAlertService=class PageRestoredAlertService{constructor(e,t){this.catalogService=e;this.actionableAlertService=t}displayPageRestoredSuccessAlert(e){return __awaiter(this,void 0,void 0,(function*(){if(!e){throw new Error("[pageRestoredAlertService] - page info not provided.")}const i=yield this.catalogService.getCatalogVersionByUuid(e.catalogVersion);const o={component:t.PageRestoredAlertComponent,data:{catalogVersion:i,pageInfo:e},minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"};return this.actionableAlertService.displayActionableAlert(o,l.IAlertServiceType.SUCCESS)}))}};t.PageRestoredAlertService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ICatalogService,t.ActionableAlertService])],t.PageRestoredAlertService);window.__smartedit__.addDecoratorPayload("Component","ClonePageAlertComponent",{selector:"se-clone-page-alert",template:`\n        <se-actionable-alert\n            [description]="description"\n            [descriptionDetails]="descriptionDetails"\n            [hyperlinkLabel]="hyperlinkLabel"\n            (hyperLinkClick)="onClick()"></se-actionable-alert>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[l.L10nPipe]});t.ClonePageAlertComponent=class ClonePageAlertComponent{constructor(e,t,i,o){this.alertRef=e;this.experienceService=t;this.cdr=i;this.l10n=o;this.description="se.cms.clonepage.alert.info.description";this.hyperlinkLabel="se.cms.clonepage.alert.info.hyperlink"}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){({clonedPageInfo:this.clonedPageInfo,catalogVersion:this.catalogVersion}=this.alertRef.data);this.description="se.cms.clonepage.alert.info.description";this.descriptionDetails={catalogName:yield this.getTranslatedName(this.catalogVersion.catalogName),catalogVersion:this.catalogVersion.version};this.hyperlinkLabel="se.cms.clonepage.alert.info.hyperlink";if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}onClick(){if(l.stringUtils.isBlank(this.clonedPageInfo.uid)){throw new Error("ClonePageAlertService.displayClonePageAlert - missing required parameter 'uid'")}this.experienceService.loadExperience({siteId:this.catalogVersion.siteId,catalogId:this.catalogVersion.catalogId,catalogVersion:this.catalogVersion.version,pageId:this.clonedPageInfo.uid})}getTranslatedName(e){return this.l10n.transform(e).pipe(d.take(1)).toPromise()}};t.ClonePageAlertComponent=__decorate([n.Component({selector:"se-clone-page-alert",template:`\n        <se-actionable-alert\n            [description]="description"\n            [descriptionDetails]="descriptionDetails"\n            [hyperlinkLabel]="hyperlinkLabel"\n            (hyperLinkClick)="onClick()"></se-actionable-alert>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[l.L10nPipe]}),__metadata("design:paramtypes",[u.AlertRef,l.IExperienceService,n.ChangeDetectorRef,l.L10nPipe])],t.ClonePageAlertComponent);t.ClonePageAlertService=class ClonePageAlertService{constructor(e,t){this.actionableAlertService=e;this.catalogService=t}displayClonePageAlert(e){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.catalogService.getCatalogVersionByUuid(e.catalogVersion);return this.actionableAlertService.displayActionableAlert({component:t.ClonePageAlertComponent,mousePersist:true,data:{catalogVersion:i,clonedPageInfo:e},minWidth:"",duration:1e3,dismissible:true,width:"300px"})}))}};t.ClonePageAlertService=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.ActionableAlertService,l.ICatalogService])],t.ClonePageAlertService);var W;(function(e){e["HIDDEN"]="se.cms.component.visibility.alert.description.hidden";e["RESTRICTED"]="se.cms.component.visibility.alert.description.restricted"})(W||(W={}));t.ComponentVisibilityAlertService=class ComponentVisibilityAlertService extends r.IComponentVisibilityAlertService{constructor(e,t,i,o){super();this.sharedDataService=e;this.alertService=t;this.actionableAlertService=i;this.crossFrameEventService=o}checkAndAlertOnComponentVisibility(e){return __awaiter(this,void 0,void 0,(function*(){yield this.crossFrameEventService.publish(l.EVENT_PAGE_TREE_SLOT_NEED_UPDATE,e.slotId);const t=!e.visible||e.restricted;if(!t){return}const i=yield this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY);const o=!e.visible?W.HIDDEN:W.RESTRICTED;const n=e.catalogVersion!==i.pageContext.catalogVersionUuid;if(n){this.alertService.showAlert({message:o,minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"})}else{const t={component:r.ComponentVisibilityAlertComponent,duration:6e3,data:{component:e,message:o},minWidth:"",mousePersist:true,dismissible:true,width:"300px"};this.actionableAlertService.displayActionableAlert(t,l.IAlertServiceType.INFO)}}))}};t.ComponentVisibilityAlertService=__decorate([l.GatewayProxied("checkAndAlertOnComponentVisibility"),n.Injectable(),__metadata("design:paramtypes",[l.ISharedDataService,l.IAlertService,t.ActionableAlertService,l.CrossFrameEventService])],t.ComponentVisibilityAlertService);t.ComponentSharedService=class ComponentSharedService extends r.IComponentSharedService{};t.ComponentSharedService=__decorate([l.GatewayProxied()],t.ComponentSharedService);const $="cms-link-to-reload-structure";const K="clear_mediaContainer_selected_option";const Y="maxUploadFileSize";const Z="se.read.page";const Q="se.read.slot";const J="se.read.component";const ee="se.read.current.catalog.version";const te="se.write.page";const ie="se.write.slot";const oe="se.write.component";const ne="se.write.to.current.catalog.version";const se="se.content.catalog.non.active";const ae="se.not.versioning.perspective";const re="se.version.page.selected";const le="se.current.page.has.active.workflow";const ce="se.has.change.type.permissions.on.current.page";const de="se.has.read.type.permissions.on.current.page";const pe="se.has.read.permission.on.version.type";const me="se.has.create.permission.on.version.type";const ge="se.has.change.permission.on.workflow.type";const ue="se.current.user.can.act.on.page.in.workflow";const he="se.current.user.can.act.on.workflow.current.action";const _e="se.sync.catalog";const ve="se.page.belongs.to.experience";const fe="se.cms.componentMenuTemplate";const ye="se.cms.pageInfoMenu";const Se="se.cms.clonePageMenu";const Ce="se.cms.pageVersionsMenu";const be="se.version.page";const Ie="se.cms.pageWorkflowMenu";const Ee="se.cms.pageDisplayStatus";const we="se.cms.pageApprovalSelector";const Te="se.cms.html5DragAndDrop.outer";window.__smartedit__.addDecoratorPayload("Component","GenericEditorModalComponent",{selector:"se-generic-editor-modal",template:`\n        <se-message\n            class="se-ge-modal--messages"\n            *ngIf="showDisclaimer"\n            type="info"\n            messageId="VisibilityTab.DisplayComponentOffDisclaimer">\n            <ng-container se-message-description>\n                {{ 'se.cms.editortabset.visibilitytab.disclaimer' | translate }}\n            </ng-container>\n        </se-message>\n\n        <ng-container *ngIf="data && data.messages">\n            <se-message\n                class="se-ge-modal--messages"\n                *ngFor="let msg of data.messages; let i = index"\n                [type]="msg.type"\n                messageId="generic-editor-model-message-{{ i }}">\n                <ng-container se-message-description> {{ msg.message }} </ng-container>\n            </se-message>\n        </ng-container>\n\n        <se-generic-editor\n            *ngIf="isSetupCompleted"\n            [id]="genericEditorId"\n            [smarteditComponentId]="data.componentUuid"\n            [smarteditComponentType]="data.componentType"\n            [structure]="structure"\n            [structureApi]="structureApi"\n            [content]="data.content"\n            [contentApi]="contentApi"\n            [(submit)]="controls.submit"\n            [(reset)]="controls.reset"\n            [(isDirty)]="controls.isDirty"\n            [editorStackId]="editorStackId"\n            (getApi)="getApi($event)">\n        </se-generic-editor>\n    `});t.GenericEditorModalComponent=class GenericEditorModalComponent{constructor(e,t,i,o){this.modalManager=e;this.confirmationModalService=t;this.crossFrameEventService=i;this.systemEventService=o;this.data={};this.controls={};this.genericEditorId=l.stringUtils.generateIdentifier();this.showDisclaimer=false;this.STRUCTURE_API_BASE_URL=`${r.TYPES_RESOURCE_URI}?code=:smarteditComponentType&mode=:structureApiMode`;this.isSetupCompleted=false;this.isReset=false;this.isEscapeInProgress=false}onEscapeDown(){if(this.isEscapeInProgress){return}this.onEscapeClicked()}getApi(e){this.controls.genericEditorAPI=e;if(this.data.targetedQualifier){e.switchToTabContainingQualifier(this.data.targetedQualifier)}if(this.data.initialDirty){e.considerFormDirty()}}onSave(){return this.controls.submit().then((e=>{this.crossFrameEventService.publish(r.CMSITEMS_UPDATE_EVENT);if(this.saveCallback){this.saveCallback(e)}this.removeEventListeners();return e}))}onCancel(){return new Promise(((e,t)=>{if(this.genericEditorIsDirty()&&!this.isReset){this.confirmationModalService.confirm({description:"se.editor.cancel.confirm"}).then((()=>{this.controls.reset().then((()=>{this.markAsReset();this.removeEventListeners();e()}),(()=>{t()}));this.crossFrameEventService.publish("GENERIC_EDITOR_CANCEL",{confirmed:true})}),(()=>{t();this.crossFrameEventService.publish("GENERIC_EDITOR_CANCEL",{confirmed:false})}))}else{this.removeEventListeners();e()}}))}setup(){this.structure=this.data.structure;if(!this.structure){this.structureApi=this.getStructureApiByMode("DEFAULT");if(this.isGenericEditorInReadOnlyMode()){this.structureApi=this.applyReadOnlyModeToStructureApiUrl(this.structureApi)}}else if(this.isGenericEditorInReadOnlyMode()){this.structure=this.makeStructureReadOnly(this.structure)}this.changeStructureEventListener=this.systemEventService.subscribe($,((e,t)=>this.onChangeStructureEvent(e,t)));this.unrelatedValidationErrorsEvent=this.systemEventService.subscribe(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,((e,t)=>this.onUnrelatedErrors(e,t)));this.contentApi=this.data.contentApi||`/cmswebservices/v1/sites/${l.CONTEXT_SITE_ID}/cmsitems`;this.modalManager.setDismissCallback((()=>this.onCancel()));this.modalManager.addButtons([{id:"save",label:this.data.saveLabel||"se.cms.component.confirmation.modal.save",style:l.ModalButtonStyle.Primary,action:l.ModalButtonAction.Close,callback:()=>h.from(this.onSave()),disabledFn:()=>this.controls.genericEditorAPI&&this.controls.genericEditorAPI.isSubmitDisabled()||this.isGenericEditorInReadOnlyMode()},{id:"cancel",label:this.data.cancelLabel||"se.cms.component.confirmation.modal.cancel",style:l.ModalButtonStyle.Default,action:l.ModalButtonAction.Dismiss,callback:()=>h.from(this.onCancel())}]);this.isSetupCompleted=true}makeStructureReadOnly(e){e.attributes=e.attributes||[];e.attributes.forEach((function(e){e.editable=false}));return e}isGenericEditorInReadOnlyMode(){return!!this.data.readOnlyMode}getGenericEditorContent(){return this.controls.genericEditorAPI&&this.controls.genericEditorAPI.getContent()}genericEditorIsDirty(){return this.controls.isDirty&&this.controls.isDirty()}onChangeStructureEvent(e,t){if(this.genericEditorId===t.editorId){if(t.structureApiMode){this.structure=null;this.structureApi=this.getStructureApiByMode(t.structureApiMode);if(this.isGenericEditorInReadOnlyMode()){this.structureApi=this.applyReadOnlyModeToStructureApiUrl(this.structureApi)}}else if(t.structure){this.structureApi=null;this.structure=t.structure;if(this.isGenericEditorInReadOnlyMode()){this.structure=this.makeStructureReadOnly(this.structure)}}this.data.content=t.content}}onUnrelatedErrors(e,t){if(t.sourceGenericEditorId===this.data.componentUuid&&this.errorCallback){this.errorCallback(t.messages,this)}}applyReadOnlyModeToStructureApiUrl(e){return`${e}&readOnly=true`}getStructureApiByMode(e){return this.STRUCTURE_API_BASE_URL.replace(/:structureApiMode/gi,e)}removeEventListeners(){this.unrelatedValidationErrorsEvent();this.changeStructureEventListener()}ngOnInit(){this.modalManager.getModalData().subscribe((e=>{this.data=e.data;this.saveCallback=e.saveCallback;this.errorCallback=e.errorCallback;this.editorStackId=e.data.editorStackId;if(!this.isSetupCompleted){this.setup()}}))}markAsReset(){this.isReset=true}onEscapeClicked(){this.isEscapeInProgress=true;this.onCancel().then((()=>this.modalManager.dismiss())).finally((()=>{this.isEscapeInProgress=false}))}};__decorate([n.HostListener("document:keyup.escape"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.GenericEditorModalComponent.prototype,"onEscapeDown",null);t.GenericEditorModalComponent=__decorate([n.Component({selector:"se-generic-editor-modal",template:`\n        <se-message\n            class="se-ge-modal--messages"\n            *ngIf="showDisclaimer"\n            type="info"\n            messageId="VisibilityTab.DisplayComponentOffDisclaimer">\n            <ng-container se-message-description>\n                {{ 'se.cms.editortabset.visibilitytab.disclaimer' | translate }}\n            </ng-container>\n        </se-message>\n\n        <ng-container *ngIf="data && data.messages">\n            <se-message\n                class="se-ge-modal--messages"\n                *ngFor="let msg of data.messages; let i = index"\n                [type]="msg.type"\n                messageId="generic-editor-model-message-{{ i }}">\n                <ng-container se-message-description> {{ msg.message }} </ng-container>\n            </se-message>\n        </ng-container>\n\n        <se-generic-editor\n            *ngIf="isSetupCompleted"\n            [id]="genericEditorId"\n            [smarteditComponentId]="data.componentUuid"\n            [smarteditComponentType]="data.componentType"\n            [structure]="structure"\n            [structureApi]="structureApi"\n            [content]="data.content"\n            [contentApi]="contentApi"\n            [(submit)]="controls.submit"\n            [(reset)]="controls.reset"\n            [(isDirty)]="controls.isDirty"\n            [editorStackId]="editorStackId"\n            (getApi)="getApi($event)">\n        </se-generic-editor>\n    `}),__metadata("design:paramtypes",[l.ModalManagerService,l.IConfirmationModalService,l.CrossFrameEventService,l.SystemEventService])],t.GenericEditorModalComponent);let Pe=class CatalogVersionRestService{constructor(e){this.restServiceFactory=e;this.URI=`/cmswebservices/v1/sites/:${l.CONTEXT_SITE_ID}/catalogs/:${l.CONTEXT_CATALOG}/versions/:${l.CONTEXT_CATALOG_VERSION}/targets?mode=cloneableTo`}getCloneableTargets(e){const t=this.restServiceFactory.get(this.URI);return t.get(e)}};Pe=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],Pe);let Oe=class PageRestrictionsRestService{constructor(e){this.restServiceFactory=e;this.contextualPageRestrictionsRestService=this.restServiceFactory.get(r.CONTEXTUAL_PAGES_RESTRICTIONS_RESOURCE_URI);this.pageRestrictionsRestService=this.restServiceFactory.get(r.PAGES_RESTRICTIONS_RESOURCE_URI)}getPagesRestrictionsForPageId(e){return this.contextualPageRestrictionsRestService.get({pageId:e})}getPagesRestrictionsForCatalogVersion(e,t,i){return this.pageRestrictionsRestService.get({siteUID:e,catalogId:t,catalogVersion:i})}};Oe=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],Oe);let Ae=class PageTypesRestrictionTypesRestService{constructor(e){this.restServiceFactory=e;this.restService=this.restServiceFactory.get(r.PAGE_TYPES_RESTRICTION_TYPES_URI)}getPageTypesRestrictionTypes(){return this.restService.get()}};Ae=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],Ae);let xe=class PageContentSlotsComponentsRestService extends r.IPageContentSlotsComponentsRestService{constructor(){super()}};xe=__decorate([l.GatewayProxied("clearCache","getSlotsToComponentsMapForPageUid","getComponentsForSlot"),n.Injectable(),__metadata("design:paramtypes",[])],xe);let De=class PagesFallbacksRestService{constructor(e){this.restServiceFactory=e;this.fallbacksForPageIdResource=e.get(this.getUri())}getFallbacksForPageId(e){return this.fallbacksForPageIdResource.get({pageId:e}).then((e=>e.uids))}getFallbacksForPageIdAndContext(e,t){const i=this.getUri(t[l.CONTEXT_SITE_ID],t[l.CONTEXT_CATALOG],t[l.CONTEXT_CATALOG_VERSION]);const o=this.restServiceFactory.get(i);return o.get({pageId:e}).then((e=>e.uids))}getUri(e=l.PAGE_CONTEXT_SITE_ID,t=l.PAGE_CONTEXT_CATALOG,i=l.PAGE_CONTEXT_CATALOG_VERSION){return`/cmswebservices/v1/sites/${e}/catalogs/${t}/versions/${i}/pages/:pageId/fallbacks`}};De=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],De);let Re=class PagesRestService{constructor(e){this.restServiceFactory=e;this.URI=`/cmswebservices/v1/sites/${l.PAGE_CONTEXT_SITE_ID}/catalogs/${l.PAGE_CONTEXT_CATALOG}/versions/${l.PAGE_CONTEXT_CATALOG_VERSION}/pages/:pageUid`}get(e){return this.restServiceFactory.get(this.URI,"pageUid").get({uids:e}).then((e=>e.pages))}getById(e){return this.restServiceFactory.get(this.URI,"pageUid").get({pageUid:e})}update(e,t){const i=new l.URIBuilder(this.URI).replaceParams(t).build();const o=p.assign({pageUid:e},t);return this.restServiceFactory.get(i,"pageUid").update(o)}};Re=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],Re);let Me=class PagesVariationsRestService{constructor(e){this.URI=`/cmswebservices/v1/sites/${l.PAGE_CONTEXT_SITE_ID}/catalogs/${l.PAGE_CONTEXT_CATALOG}/versions/${l.PAGE_CONTEXT_CATALOG_VERSION}/pages/:pageId/variations`;this.resource=e.get(this.URI)}getVariationsForPrimaryPageId(e){return this.resource.get({pageId:e}).then((e=>e.uids))}};Me=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],Me);let ke=class PageTypeService{constructor(e){this.pageTypeRestService=e.get(r.PAGE_TYPES_URI)}getPageTypes(){this.pageTypesResponse=this.pageTypesResponse||this.pageTypeRestService.get();return this.pageTypesResponse.then((e=>e.pageTypes))}};ke=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],ke);let Ne=class RestrictionTypesRestService{constructor(e){this.restServiceFactory=e;this.restrictionTypesRestService=this.restServiceFactory.get(r.RESTRICTION_TYPES_URI)}getRestrictionTypes(){return this.restrictionTypesRestService.get()}};Ne=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],Ne);class ModeManager{constructor(e){this.modes=e}validateMode(e){if(!this.modes.includes(e)){throw new Error(`ModeManager.validateMode() - mode [${e}] not in list of supported modes: ${this.modes}`)}return true}}let Fe=class StructureModeManagerFactory{createModeManager(e){return new ModeManager(e)}};Fe=__decorate([n.Injectable()],Fe);let ze=class StructuresRestService{constructor(e){this.TYPE_PLACEHOLDER=":smarteditComponentType";this.URI=`${l.TYPES_RESOURCE_URI}/`;e.register(this.URI,l.OPERATION_CONTEXT.CMS)}getUriForContext(e,t){const i=t||this.TYPE_PLACEHOLDER;const o=`${l.TYPES_RESOURCE_URI}?code=${i}&mode=${e.toUpperCase()}`;return o}};ze=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.OperationContextService])],ze);let Le=class TypeStructureRestService{constructor(e){this.structureRestService=e.get(l.TYPES_RESOURCE_URI)}getStructureByType(e){return this.structureRestService.getById(e).then((e=>e.attributes))}getStructureByTypeAndMode(e,t,i=false){return this.structureRestService.get({code:e,mode:t}).then((e=>{const t=e.componentTypes[0];return!t||i?t:t.attributes}))}getStructuresByCategory(e){return this.structureRestService.get({category:e}).then((e=>e.componentTypes))}};Le=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory])],Le);t.PageRestrictionsService=class PageRestrictionsService{constructor(e){this.pageRestrictionsRestService=e}getPageRestrictionsCountForPageUID(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageRestrictionsRestService.getPagesRestrictionsForPageId(e);return t.pageRestrictionList.length}))}};t.PageRestrictionsService=__decorate([n.Injectable(),__metadata("design:paramtypes",[Oe])],t.PageRestrictionsService);let Ve=class DisplayConditionsFacade{constructor(e,t,i){this.pageService=e;this.pageRestrictionsService=t;this.logService=i}getPageInfoForPageUid(e){return __awaiter(this,void 0,void 0,(function*(){const t=this.pageService.getPageById(e);const i=this.pageService.isPagePrimary(e);const[o,n]=yield Promise.all([t,i]);return{pageName:o.name,pageType:o.typeCode,isPrimary:n}}))}getVariationsForPageUid(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageService.getVariationPages(e);if(t.length===0){return[]}const i=yield Promise.all(t.map((e=>this.pageRestrictionsService.getPageRestrictionsCountForPageUID(e.uid))));return t.map(((e,t)=>({pageName:e.name,creationDate:e.creationtime,restrictions:i[t]})))}))}updatePage(e,t){return this.pageService.updatePageById(e,t)}isPagePrimary(e){return this.pageService.isPagePrimary(e)}getPrimaryPageForVariationPage(e){return this.pageService.getPrimaryPage(e).then((e=>({uid:e.uid,name:e.name,label:e.label})))}getPrimaryPagesForPageType(e,t,i){return __awaiter(this,void 0,void 0,(function*(){try{const o=yield this.pageService.getPaginatedPrimaryPagesForPageType(e,t,i);return{pagination:o.pagination,results:o.response.map((e=>({id:e.uid,label:e.name||e.label})))}}catch(e){this.logService.warn(`[getPrimaryPagesForPageType] - Cannot retrieve list of primary pages. ${e}`);return Promise.reject()}}))}};Ve=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IPageService,t.PageRestrictionsService,l.LogService])],Ve);t.DisplayConditionsEditorModel=class DisplayConditionsEditorModel{constructor(e){this.displayConditionsFacade=e;this.variations=[]}initModel(e){return __awaiter(this,void 0,void 0,(function*(){this.pageUid=e;const t=yield this.displayConditionsFacade.getPageInfoForPageUid(e);({pageName:this.pageName,pageType:this.pageType,isPrimary:this.isPrimary}=t);if(this.isPrimary){return this.initModelForPrimary(e)}return this.initModelForVariation(e)}))}initModelForPrimary(e){return __awaiter(this,void 0,void 0,(function*(){this.variations=yield this.displayConditionsFacade.getVariationsForPageUid(e)}))}initModelForVariation(e){return __awaiter(this,void 0,void 0,(function*(){this.isAssociatedPrimaryReadOnly=this.pageType!=="ContentPage";const t=yield this.displayConditionsFacade.getPrimaryPageForVariationPage(e);this.associatedPrimaryPage=t;this.originalPrimaryPage=t}))}};t.DisplayConditionsEditorModel=__decorate([n.Injectable(),__metadata("design:paramtypes",[Ve])],t.DisplayConditionsEditorModel);const Ue="CMS_EVENT_SHOW_REPLACE_PARENT_HOMEPAGE_INFO";const Be="CMS_EVENT_HIDE_REPLACE_PARENT_HOMEPAGE_INFO";t.CatalogHomepageDetailsStatus=void 0;(function(e){e["PENDING"]="PENDING";e["NO_HOMEPAGE"]="NO_HOMEPAGE";e["LOCAL"]="LOCAL";e["OLD"]="OLD";e["PARENT"]="PARENT"})(t.CatalogHomepageDetailsStatus||(t.CatalogHomepageDetailsStatus={}));t.HomepageType=void 0;(function(e){e["OLD"]="old";e["CURRENT"]="current";e["FALLBACK"]="fallback"})(t.HomepageType||(t.HomepageType={}));t.HomepageService=class HomepageService{constructor(e,t){this.catalogService=e;this.systemEventService=t}sendEventHideReplaceParentHomePageInfo(e){this.systemEventService.publish(Be,e)}sendEventShowReplaceParentHomePageInfo(e){this.systemEventService.publish(Ue,e)}getHomepageDetailsForContext(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.catalogService.getContentCatalogVersion(e);const i=t.homepage?t.homepage.current:null;return this.buildHomepageDetailsForContext(i,e)}))}isCurrentHomepage(e,i){return this.isHomepageType(e,i,t.HomepageType.CURRENT)}isOldHomepage(e,i){return this.isHomepageType(e,i,t.HomepageType.OLD)}getHomepageType(e,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.catalogService.getContentCatalogVersion(i);if(!o||!o.homepage){return null}if(o.homepage.current&&o.homepage.current.uid===e.uid&&o.homepage.current.catalogVersionUuid===e.catalogVersion){return t.HomepageType.CURRENT}else if(o.homepage.old&&o.homepage.old.uid===e.uid){return this.compareCatalogVersions(o.homepage.old.catalogVersionUuid,e.catalogVersion,((e,i)=>e.catalogId===i.catalogId?t.HomepageType.OLD:null))}else if(o.homepage.fallback&&o.homepage.fallback.uid===e.uid){return this.compareCatalogVersions(o.homepage.fallback.catalogVersionUuid,e.catalogVersion,((e,i)=>e.uuid===i.uuid?t.HomepageType.FALLBACK:null))}return null}))}hasFallbackHomePage(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.catalogService.getContentCatalogVersion(e);if(!t||!t.homepage){throw Error(`HomepageService.hasFallbackHomePage - Catalog does not have homepage fallback property`)}return!!t.homepage.fallback}))}canSyncHomepage(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.isOldHomepage(e,t);if(!i){return true}const o=yield this.catalogService.getContentCatalogVersion(t);return this.compareCatalogVersions(o.homepage.current.catalogVersionUuid,e.catalogVersion,((t,i)=>e.uid!==o.homepage.current.uid&&t.catalogId!==i.catalogId))}))}compareCatalogVersions(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const[o,n]=yield Promise.all([this.catalogService.getCatalogVersionByUuid(e),this.catalogService.getCatalogVersionByUuid(t)]);return i(o,n)}))}isHomepageType(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.getHomepageType(e,t);return o===i}))}buildHomepageDetailsForContext(e,i){return __awaiter(this,void 0,void 0,(function*(){if(!e){return{status:t.CatalogHomepageDetailsStatus.NO_HOMEPAGE}}const o=yield this.catalogService.getCatalogVersionByUuid(e.catalogVersionUuid);const n=o.catalogId!==i[r.CONTEXT_CATALOG];const s=yield this.catalogService.getContentCatalogVersion(i);if(n){return{status:t.CatalogHomepageDetailsStatus.PARENT,parentCatalogName:o.catalogName,parentCatalogVersion:o.version,targetCatalogName:s.catalogName,targetCatalogVersion:s.version}}return{status:t.CatalogHomepageDetailsStatus.LOCAL,currentHomepageName:e.name,currentHomepageUid:e.uid,oldHomepageUid:o.homepage?o.homepage.old?o.homepage.old.uid:null:null}}))}};t.HomepageService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ICatalogService,l.SystemEventService])],t.HomepageService);t.PageDisplayConditionsService=class PageDisplayConditionsService{constructor(e){this.catalogService=e}getNewPageConditions(e,t){return this.getPageDisplayConditionsByPageType(e,t)}fetchDisplayConditionsForPageType(e,t){return this.catalogService.getContentCatalogVersion(t).then((t=>t.pageDisplayConditions.find((t=>t.typecode===e))))}getPageDisplayConditionsByPageType(e,t){return this.fetchDisplayConditionsForPageType(e,t).then((e=>{if(!e||!e.options){return[]}return e.options.map((e=>({label:e.label,description:e.label+".description",isPrimary:e.id==="PRIMARY"})))}))}};t.PageDisplayConditionsService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ICatalogService])],t.PageDisplayConditionsService);t.GenericEditorModalService=class GenericEditorModalService{constructor(e){this.modalService=e}open(e,i,o,n){const s=n?Object.assign({},n):{};s.dialogPanelClass=`modal-lg ${s.dialogPanelClass||""}`.trimEnd();s.escKeyCloseable=false;s.focusTrapped=false;s.backdropClickCloseable=false;const a=this.modalService.open({component:t.GenericEditorModalComponent,data:{data:e,saveCallback:i,errorCallback:o},config:s,templateConfig:{title:e.title,isDismissButtonVisible:true,titleSuffix:"se.cms.editor.title.suffix"}});return new Promise(((e,t)=>a.afterClosed.subscribe(e,t)))}};t.GenericEditorModalService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IModalService])],t.GenericEditorModalService);t.EditorModalService=class EditorModalService extends l.IEditorModalService{constructor(e,t,i,o,n,s,a){super();this.genericEditorModalService=e;this.componentService=t;this.renderService=i;this.contextAwareEditableItemService=o;this.cmsitemsRestService=n;this.translateService=s;this.genericEditorStackService=a}openAndRerenderSlot(e,t,i,o,n,s){return __awaiter(this,void 0,void 0,(function*(){const a={smarteditComponentType:e,smarteditComponentUuid:t};const r=yield this.preloadContent(t,a);const d=this.createComponentData(r,{targetedQualifier:i},s||l.stringUtils.generateIdentifier());return this.markAndOpenGenericEditor(d,n,o)}))}open(e,t,i,o,n,s,a){return __awaiter(this,void 0,void 0,(function*(){const r=yield this.preloadContent(e.smarteditComponentUuid,e);const d=this.createComponentData(r,{slotId:t,position:i,targetedQualifier:o},s||l.stringUtils.generateIdentifier());return this.markAndOpenGenericEditor(d,n,a)}))}openGenericEditor(e,t,i,o){return this.genericEditorModalService.open(e,t,i,o)}preloadContent(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getContentByUuid(e);if(i!==null&&p.isNil(t.content)){t.content=i}return t}))}markAndOpenGenericEditor(e,t,i){return __awaiter(this,void 0,void 0,(function*(){yield this.markComponentAsShared(e.content,e);return this.genericEditorModalService.open(e,(i=>{if(t){t(i)}if(e.editorStackId){const[t]=this.genericEditorStackService.getEditorsStack(e.editorStackId);const{component:{uuid:i}}=t;this.componentService.getSlotsForComponent(i).then((e=>{this.renderService.renderSlots(e)}))}}),null,i)}))}getContentByUuid(e){return __awaiter(this,void 0,void 0,(function*(){if(!p.isNil(e)){return this.cmsitemsRestService.getById(e)}return null}))}markComponentAsShared(e,t){return __awaiter(this,void 0,void 0,(function*(){if(!(e===null||e===void 0?void 0:e.uid)){return}const i=yield this.contextAwareEditableItemService.isItemEditable(e.uid);t.readOnlyMode=!i;if(t.readOnlyMode&&this.componentIsShared(e)){this.addComponentInfoMessage("se.cms.component.workflow.shared.component",t)}else if(this.componentIsShared(e)&&!t.readOnlyMode){this.addComponentInfoMessage("se.cms.component.shared.component",t)}else if(!this.componentIsShared(e)&&t.readOnlyMode){this.addComponentInfoMessage("se.cms.component.workflow.component",t)}}))}componentIsShared(e){var t;return((t=e.slots)===null||t===void 0?void 0:t.length)>1}addComponentInfoMessage(e,t){t.messages=t.messages||[];t.messages.push({type:"info",message:this.translateService.instant(e)})}prepareContentForCreate(e,t,i,o,n){const s=e?Object.assign({},e):{};s.position=!l.stringUtils.isBlank(s.position)?s.position:n;s.slotId=s.slotId||o;s.typeCode=s.typeCode||t;s.itemtype=s.itemtype||t;s.catalogVersion=s.catalogVersion||i;s.visible=!l.stringUtils.isBlank(s.visible)?s.visible:true;return s}createComponentData(e,t,i){let o;try{o=e.smarteditComponentType.toLowerCase()}catch(e){throw new Error(`editorModalService.createComponentData - invalid component type in componentAttributes. ${e}`)}const n=p.isNil(e.smarteditComponentUuid);let s;if(n){s=this.prepareContentForCreate(e.content,e.smarteditComponentType,e.catalogVersionUuid,t.slotId,t.position)}else{s=e.content}return{componentUuid:e.smarteditComponentUuid,componentType:e.smarteditComponentType,title:`type.${o}.name`,targetedQualifier:t.targetedQualifier,initialDirty:e.initialDirty,content:s,editorStackId:i}}};t.EditorModalService=__decorate([l.GatewayProxied("open","openAndRerenderSlot","openGenericEditor"),n.Injectable(),__metadata("design:paramtypes",[t.GenericEditorModalService,r.ComponentService,l.IRenderService,r.IContextAwareEditableItemService,l.CmsitemsRestService,m.TranslateService,l.GenericEditorStackService])],t.EditorModalService);t.EditorEnablerService=class EditorEnablerService extends r.IEditorEnablerService{};t.EditorEnablerService=__decorate([l.GatewayProxied("onClickEditButton","isSlotEditableForNonExternalComponent")],t.EditorEnablerService);const je=["typeCode","template","name","description","label","uid","title","fromName","fromEmail"];const Ge=["creationtime","modifiedtime"];t.ContextAwarePageStructureService=class ContextAwarePageStructureService{constructor(e,t){this.typeStructureRestService=e;this.pageService=t}getPageStructureForNewPage(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getFields(e);if(e==="ContentPage"){this.setLabelEditability(i,t)}this.removeField(i,"creationtime");this.removeField(i,"modifiedtime");this.removeField(i,"displayCondition");this.removeField(i,"restrictions");return{attributes:this.getOrderedFields(i),category:r.StructureTypeCategory.PAGE}}))}getPageStructureForPageEditing(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getFields(e);const o=["uid","creationtime","modifiedtime"];i.filter((e=>o.indexOf(e.qualifier)>=0)).forEach((e=>{e.editable=false}));if(e==="ContentPage"){const e=yield this.pageService.isPagePrimary(t);this.setLabelEditability(i,e);return{attributes:this.getOrderedFields(i),category:r.StructureTypeCategory.PAGE}}return{attributes:this.getOrderedFields(i),category:r.StructureTypeCategory.PAGE}}))}getPageStructureForViewing(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getFields(e);t.forEach((e=>{e.editable=false}));this.removeField(t,"typeCode");this.removeField(t,"template");this.removeField(t,"displayCondition");this.removeField(t,"restrictions");return{attributes:this.getOrderedFields(t),category:r.StructureTypeCategory.PAGE}}))}moveElement(e,t,i){if(t<0||t>=e.length||i<0||i>=e.length){return e}e.splice(i,0,e.splice(t,1)[0]);return e}getOrderedFields(e){let t;for(let i=je.length-1;i>=0;i--){t=e.findIndex((e=>e.qualifier===je[i]));this.moveElement(e,t,0)}for(let i=0;i<Ge.length;i++){t=e.findIndex((e=>e.qualifier===Ge[i]));this.moveElement(e,t,e.length-1)}return e}setLabelEditability(e,t){const i=e.findIndex((e=>e.qualifier==="label"));if(i!==-1&&e[i].editable!==false){e[i].editable=t}}getFields(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.typeStructureRestService.getStructureByType(e);t.push({cmsStructureType:"DisplayConditionEditor",i18nKey:"type.abstractpage.displayCondition.name",qualifier:"displayCondition",editable:false},{cmsStructureType:"ShortString",i18nKey:"se.cms.pageinfo.page.type",qualifier:"typeCode",editable:false});return t}))}removeField(e,t){const i=e.findIndex((e=>e.qualifier===t));if(i!==-1){e.splice(i,1)}}};t.ContextAwarePageStructureService=__decorate([n.Injectable(),__metadata("design:paramtypes",[Le,l.IPageService])],t.ContextAwarePageStructureService);var He;const We="enableCloneComponentOnDrop";t.CmsDragAndDropService=He=class CmsDragAndDropService{constructor(e,t,i,o,n,s,a,r,d,p){this.dragAndDropService=e;this.gatewayFactory=t;this.sharedDataService=i;this.systemEventService=o;this.yjQuery=n;this.slotRestrictionsService=s;this.waitDialogService=a;this.componentEditingFacade=r;this.pageContentSlotsComponentsRestService=d;this.crossFrameEventService=p;this.dragInfo=null;this.highlightedElement=null;this.isMouseInTopScrollArea=false;this.isMouseInBottomScrollArea=false;this._window=l.windowUtils.getWindow();this.gateway=this.gatewayFactory.createGateway("cmsDragAndDrop")}register(){this.dragAndDropService.register({id:He.CMS_DRAG_AND_DROP_ID,sourceSelector:He.SOURCE_SELECTOR,targetSelector:He.TARGET_SELECTOR,startCallback:e=>this.onStart(e),dragEnterCallback:e=>this.onDragEnter(e),dragOverCallback:e=>this.onDragOver(e),dropCallback:e=>this.onDrop(e),outCallback:e=>this.onDragLeave(e),stopCallback:()=>this.onStop(),enableScrolling:false});this.dragAndDropService.register({id:He.PAGE_TREE_DRAG_AND_DROP_ID,sourceSelector:He.PAGE_TREE_SOURCE_SELECTOR,targetSelector:He.TARGET_SELECTOR,startCallback:e=>this.onStartInPageTree(e),dragEnterCallback:e=>this.onDragEnter(e),dragOverCallback:e=>this.onDragOver(e),dropCallback:e=>this.onDrop(e),outCallback:e=>this.onDragLeave(e),stopCallback:e=>this.onStopInPageTree(e),enableScrolling:false})}unregister(){this.dragAndDropService.unregister([He.CMS_DRAG_AND_DROP_ID,He.PAGE_TREE_DRAG_AND_DROP_ID])}apply(){this.dragAndDropService.apply(null)}update(){this.dragAndDropService.update(He.CMS_DRAG_AND_DROP_ID)}updateInPageTree(){this.dragAndDropService.update(He.PAGE_TREE_DRAG_AND_DROP_ID)}onStart(e){return __awaiter(this,void 0,void 0,(function*(){e.dataTransfer.effectAllowed=He.DROP_EFFECT_COPY;this.scrollable=this.yjQuery(He.SCROLL_AREA_SELECTOR);const t=yield this.sharedDataService.get(We);const i=this.getSelector(e.target).closest(He.COMPONENT_SELECTOR);const o={componentId:i.attr(l.ID_ATTRIBUTE),componentUuid:i.attr(l.UUID_ATTRIBUTE),componentType:i.attr(l.TYPE_ATTRIBUTE),slotUuid:null,slotId:null,cloneOnDrop:t?true:false};this.dragInfo=o;this.gateway.publish(r.DRAG_AND_DROP_EVENTS.DRAG_STARTED,o);this.systemEventService.publishAsync(r.DRAG_AND_DROP_EVENTS.DRAG_STARTED);this._window.requestAnimationFrame(this.scroll.bind(this))}))}onStop(){this.gateway.publish(r.DRAG_AND_DROP_EVENTS.DRAG_STOPPED,null);this._window.cancelAnimationFrame(this.animationFrameId);this.isMouseInBottomScrollArea=false;this.isMouseInTopScrollArea=false;this.clearHighlightedElement()}onStartInPageTree(e){return __awaiter(this,void 0,void 0,(function*(){e.dataTransfer.effectAllowed=He.DROP_EFFECT_COPY;this.scrollable=this.yjQuery(He.SCROLL_AREA_SELECTOR);const t=yield this.sharedDataService.get(We);const i=this.yjQuery(e.target).closest(He.PAGE_TREE_SOURCE_SELECTOR);i.addClass(He.DRAGGED_COMPONENT_CLASS);const o={componentId:i.attr(He.COMPONENT_ID),componentUuid:i.attr(He.COMPONENT_UUID),componentType:i.attr(He.COMPONENT_TYPE),slotUuid:i.attr(He.SLOT_UUID),slotId:i.attr(He.SLOT_ID),slotOperationRelatedId:i.attr("smartedit-container-id"),slotOperationRelatedType:i.attr("smartedit-container-type"),cloneOnDrop:t?true:false};this.dragInfo=o;this._window.requestAnimationFrame(this.scroll.bind(this))}))}onStopInPageTree(e){const t=this.getSelector(e.target).closest(He.PAGE_TREE_SOURCE_SELECTOR);t.removeClass(He.DRAGGED_COMPONENT_CLASS);this.onStop()}onDragEnter(e){this.setMouseArea(e);this.highlightElement(e)}onDragOver(e){this.setMouseArea(e);this.highlightElement(e)}onDrop(e){return __awaiter(this,void 0,void 0,(function*(){if(this.highlightedElement&&this.highlightedElement.isAllowed){let e=0;const{isSlot:t,slotId:i,isBottom:o,componentUuid:n,slotCatalogVersion:s,slotUuid:a}=this.highlightedElement;if(!t){e=yield this.getComponentIndexInSlot(i,n);if(o){e++}}yield this.dropElementToSlot(i,a,e,s)}this.onStop()}))}onDragLeave(e){if(this.highlightedElement&&this.highlightedElement.original){const t=this.highlightedElement.original.get(0).getBoundingClientRect();if(!this.dragLeaveEventInRegion(e,t)){this.clearHighlightedElement()}}}dragLeaveEventInRegion(e,t){return e.pageX>Math.ceil(t.left)&&e.pageX<Math.floor(t.right)&&e.pageY>Math.ceil(t.top)&&e.pageY<Math.floor(t.bottom)}dropElementToSlot(e,t,i,o){return __awaiter(this,void 0,void 0,(function*(){const n=this.dragInfo.slotId;const s=this.dragInfo.componentUuid;const a=this.dragInfo.slotOperationRelatedId||this.dragInfo.componentId;let l;this.waitDialogService.showWaitModal();if(!n){l=this.addComponentToSlot(e,t,i,o)}else{if(n===e){const e=yield this.getComponentIndexInSlot(n,s);if(e<i){i--}if(e===i){this.waitDialogService.hideWaitModal();return}}l=this.componentEditingFacade.moveComponent(n,e,a,i)}try{yield l}catch(e){this.waitDialogService.hideWaitModal()}finally{this.waitDialogService.hideWaitModal();this.gateway.publish(r.DRAG_AND_DROP_EVENTS.SCROLL_TO_MODIFIED_SLOT,e);this.crossFrameEventService.publish(r.DRAG_AND_DROP_EVENTS.SCROLL_TO_MODIFIED_SLOT,e)}}))}addComponentToSlot(e,t,i,o){const n=this.dragInfo.componentId;const s=this.dragInfo.slotOperationRelatedType||this.dragInfo.componentType;let a;if(!n){const n={targetSlotId:e,targetSlotUUId:t};a=this.componentEditingFacade.addNewComponentToSlot(n,o,s,i)}else{const t={componentId:n,componentUuid:this.dragInfo.componentUuid,componentType:s};const o={targetSlotId:e,dragInfo:t,position:i};a=this.dragInfo.cloneOnDrop?this.componentEditingFacade.cloneExistingComponentToSlot(o):this.componentEditingFacade.addExistingComponentToSlot(e,t,i)}return a}clearHighlightedElement(){if(this.highlightedElement&&this.highlightedElement.original){this.highlightedElement.original.removeClass(He.ALLOWED_DROP_CLASS);if(!this.highlightedElement.isSlot){const e=this.highlightedElement.original.children(".se-page-tree-component-drop-area");e.css("display","none");e.css("top","");e.css("bottom","")}}this.highlightedElement=null}highlightElement(e){e.dataTransfer.dropEffect=He.DROP_EFFECT_NONE;const t=this.yjQuery(e.target).closest(He.TARGET_SELECTOR);if(t.parent().prop(He.TAG_NAME)===He.SE_PAGE_TREE_SLOT){this.highlightSlot(e,t)}else if(t.parent().prop(He.TAG_NAME)===He.SE_PAGE_TREE_COMPONENT){const i=t.children(".se-page-tree-node").first();this.highlightComponent(e,i)}}highlightSlot(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=t.attr(He.NODE_SMARTEDIT_ELEMENT_UUID);const o=t.attr(He.SLOT_ID);const n=t.attr(He.SLOT_UUID);const s=t.attr(He.SLOT_CATALOG_VERSION_UUID);const a=t.attr("expanded")==="true";if(this.highlightedElement){if(this.highlightedElement.id!==i){this.clearHighlightedElement()}else{if(this.highlightedElement.isAllowed){e.dataTransfer.dropEffect=He.DROP_EFFECT_COPY}else{e.dataTransfer.dropEffect=He.DROP_EFFECT_NONE}return}}this.highlightedElement={original:t,id:i,isSlot:true,slotId:o,slotUuid:n,slotCatalogVersion:s};const r=yield this.isAllowedSlot(o);if(this.highlightedElement&&this.highlightedElement.id===i){this.highlightedElement.isAllowed=r;if(this.highlightedElement.isAllowed){t.addClass(He.ALLOWED_DROP_CLASS);e.dataTransfer.dropEffect=He.DROP_EFFECT_COPY}else{e.dataTransfer.dropEffect=He.DROP_EFFECT_NONE}this.expandedSlotInPageTree(a,i)}}))}expandedSlotInPageTree(e,t){if(!e&&this.highlightedElement.isAllowed){setTimeout((()=>{if(this.highlightedElement&&this.highlightedElement.id===t){this.systemEventService.publish(l.PAGE_TREE_SLOT_EXPANDED_EVENT,t)}}),He.EXPAND_SLOT_TIME_OUT)}}highlightComponent(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=t.attr(He.NODE_SMARTEDIT_ELEMENT_UUID);const o=t.attr(He.SLOT_ID);const n=t.attr(He.SLOT_UUID);const s=t.attr(He.SLOT_CATALOG_VERSION_UUID);const a=t.attr(He.COMPONENT_ID);const r=t.attr(He.COMPONENT_UUID);if(this.highlightedElement){if(this.highlightedElement.id!==i){this.clearHighlightedElement()}else{this.modifyComponentClass(e,t);return}}this.highlightedElement={original:t,id:i,isSlot:false,slotId:o,slotUuid:n,slotCatalogVersion:s,componentId:a,componentUuid:r};const l=yield this.isAllowedSlot(o);if(this.highlightedElement&&this.highlightedElement.id===i){this.highlightedElement.isAllowed=l;this.modifyComponentClass(e,t)}}))}modifyComponentClass(e,t){const i=t.children(".se-page-tree-component-drop-area");if(this.highlightedElement.isAllowed&&!!i){e.dataTransfer.dropEffect=He.DROP_EFFECT_COPY;if(this.isMouseInTopHalfRegion(e,t)){i.css("top","-5px");i.css("bottom","");this.highlightedElement.isBottom=false;i.css("display","flex")}else if(this.isMouseInBottomHalfRegion(e,t)){i.css("top","");i.css("bottom","-5px");this.highlightedElement.isBottom=true;i.css("display","flex")}}else{e.dataTransfer.dropEffect=He.DROP_EFFECT_NONE}}isAllowedSlot(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.slotRestrictionsService.isSlotEditable(e);const i=yield this.slotRestrictionsService.determineComponentStatusInSlot(e,this.dragInfo);const o=i===l.COMPONENT_IN_SLOT_STATUS.ALLOWED&&t;const n=i===l.COMPONENT_IN_SLOT_STATUS.MAYBEALLOWED&&t;return o||n}))}isMouseInTopHalfRegion(e,t){const i=this._window.pageYOffset;const o=this.getTopHalfRect(t,i);return this.isMouseInRegion(e,o)}isMouseInBottomHalfRegion(e,t){const i=this._window.pageYOffset;const o=this.getBottomHalfRect(t,i);return this.isMouseInRegion(e,o)}getTopHalfRect(e,t){const i=e.get(0).getBoundingClientRect();return{left:i.left,right:i.right,bottom:i.top+t+(i.bottom-i.top)/2,top:i.top+t}}getBottomHalfRect(e,t){const i=e.get(0).getBoundingClientRect();return{left:i.left,right:i.right,bottom:i.bottom+t,top:i.top+t+(i.bottom-i.top)/2}}isMouseInRegion(e,t){return e.pageX>=t.left&&e.pageX<=t.right&&e.pageY>=t.top&&e.pageY<=t.bottom}setMouseArea(e){const t=this.scrollable.get(0).getBoundingClientRect();const i={left:t.left,right:t.right,bottom:t.top+this._window.pageYOffset+He.SCROLLING_AREA_HEIGHT,top:t.top+this._window.pageYOffset};const o={left:t.left,right:t.right,bottom:t.bottom+this._window.pageYOffset,top:t.bottom+this._window.pageYOffset-He.SCROLLING_AREA_HEIGHT};if(this.isMouseInRegion(e,i)){this.isMouseInTopScrollArea=true;this.isMouseInBottomScrollArea=false}else if(this.isMouseInRegion(e,o)){this.isMouseInTopScrollArea=false;this.isMouseInBottomScrollArea=true}else{this.isMouseInTopScrollArea=false;this.isMouseInBottomScrollArea=false}}scroll(){const e=this.scrollable.scrollTop();if(this.isMouseInTopScrollArea){if(e>0){const t=e-He.SCROLLING_STEP;this.scrollable.scrollTop(t)}}else if(this.isMouseInBottomScrollArea){const t=this.scrollable.get(0).scrollHeight;const i=this.scrollable.get(0).offsetHeight;if(e+i<t){const t=e+He.SCROLLING_STEP;this.scrollable.scrollTop(t)}}this.animationFrameId=this._window.requestAnimationFrame(this.scroll.bind(this))}getComponentIndexInSlot(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.pageContentSlotsComponentsRestService.getComponentsForSlot(e);let o=i.findIndex((e=>e.uuid===t));if(o<0){o=0}return o}))}getSelector(e){return this.yjQuery(e)}};t.CmsDragAndDropService.CMS_DRAG_AND_DROP_ID="se.cms.dragAndDrop";t.CmsDragAndDropService.TARGET_SELECTOR=".se-page-tree .se-page-tree-drop-area";t.CmsDragAndDropService.SOURCE_SELECTOR=".smartEditComponent[data-smartedit-component-type!='ContentSlot']";t.CmsDragAndDropService.COMPONENT_SELECTOR=".smartEditComponent";t.CmsDragAndDropService.DROP_EFFECT_COPY="copy";t.CmsDragAndDropService.DROP_EFFECT_NONE="none";t.CmsDragAndDropService.SCROLL_AREA_SELECTOR=".se-page-tree-scroll-area";t.CmsDragAndDropService.ALLOWED_DROP_CLASS="se-page-tree-slot-allowed-drop";t.CmsDragAndDropService.DRAGGED_COMPONENT_CLASS="se-page-tree-component-dragged";t.CmsDragAndDropService.NODE_SMARTEDIT_ELEMENT_UUID="node-smartedit-element-uuid";t.CmsDragAndDropService.SLOT_ID="smartedit-slot-id";t.CmsDragAndDropService.SLOT_UUID="smartedit-slot-uuid";t.CmsDragAndDropService.SLOT_CATALOG_VERSION_UUID="smartedit-slot-catalog-version-uuid";t.CmsDragAndDropService.COMPONENT_ID="smartedit-component-id";t.CmsDragAndDropService.COMPONENT_UUID="smartedit-component-uuid";t.CmsDragAndDropService.COMPONENT_TYPE="smartedit-component-type";t.CmsDragAndDropService.PAGE_TREE_DRAG_AND_DROP_ID="se.cms.page.tree.dragAndDrop";t.CmsDragAndDropService.PAGE_TREE_SOURCE_SELECTOR=".se-page-tree-component-node";t.CmsDragAndDropService.SE_PAGE_TREE_SLOT="SE-PAGE-TREE-SLOT";t.CmsDragAndDropService.SE_PAGE_TREE_COMPONENT="SE-PAGE-TREE-COMPONENT";t.CmsDragAndDropService.TAG_NAME="tagName";t.CmsDragAndDropService.EXPAND_SLOT_TIME_OUT=400;t.CmsDragAndDropService.SCROLLING_AREA_HEIGHT=60;t.CmsDragAndDropService.SCROLLING_STEP=10;t.CmsDragAndDropService=He=__decorate([n.Injectable(),__param(4,n.Inject(l.YJQUERY_TOKEN)),__metadata("design:paramtypes",[l.DragAndDropService,l.GatewayFactory,l.ISharedDataService,l.SystemEventService,Function,l.ISlotRestrictionsService,l.IWaitDialogService,r.IComponentEditingFacade,r.IPageContentSlotsComponentsRestService,l.CrossFrameEventService])],t.CmsDragAndDropService);const $e="/cmssmarteditwebservices/v1/sites/:siteUID/categories";const Ke=`${$e}/:categoryUID`;const qe="/cmssmarteditwebservices/v1/productcatalogs/:catalogId/versions/:catalogVersion/categories";t.ProductCategoryService=class ProductCategoryService{constructor(e,t){this.languageService=t;this.productCategoryService=e.get(Ke);this.productCategorySearchService=e.get(qe)}getCategoryById(e,t){return this.productCategoryService.get({siteUID:e,categoryUID:t})}getCategories(e){this._validateProductCatalogInfo(e);return this.languageService.getResolveLocale().then((t=>this.productCategorySearchService.page({catalogId:e.catalogId,catalogVersion:e.catalogVersion,text:e.mask,pageSize:e.pageSize,currentPage:e.currentPage,langIsoCode:t})))}_validateProductCatalogInfo(e){if(!e.siteUID){throw Error("[productService] - site UID missing.")}if(!e.catalogId){throw Error("[productService] - catalog ID missing.")}if(!e.catalogVersion){throw Error("[productService] - catalog version  missing.")}}};t.ProductCategoryService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory,l.LanguageService])],t.ProductCategoryService);t.ContextAwareCatalogService=class ContextAwareCatalogService{constructor(e,t){this.catalogService=e;this.sharedDataService=t}getProductCategorySearchUri(e){return this.getSearchUriByProductCatalogIdAndUriConstant(e,qe)}getProductCategoryItemUri(){return this.getItemUriByUriConstant($e)}getProductSearchUri(e){return this.getSearchUriByProductCatalogIdAndUriConstant(e,l.PRODUCT_LIST_RESOURCE_API)}getProductItemUri(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getItemUriByUriConstant(l.PRODUCT_RESOURCE_API);return e.replace("/:productUID","")}))}getContentPageSearchUri(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getContentPageUri();return`${e}?typeCode=ContentPage`}))}getContentPageItemUri(){return this.getContentPageUri()}getSearchUriByProductCatalogIdAndUriConstant(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.catalogService.getActiveProductCatalogVersionByCatalogId(e);return t.replace(/:catalogId/gi,e).replace(/:catalogVersion/gi,i)}))}getItemUriByUriConstant(e){return Promise.resolve(e.replace(/:siteUID/gi,"CURRENT_CONTEXT_SITE_ID"))}getContentPageUri(){return __awaiter(this,void 0,void 0,(function*(){const{catalogDescriptor:{catalogId:e}}=yield this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY);const t=yield this.catalogService.getActiveContentCatalogVersionByCatalogId(e);return r.PAGES_LIST_RESOURCE_URI.replace(/CURRENT_CONTEXT_CATALOG/gi,e).replace(/CURRENT_CONTEXT_CATALOG_VERSION/gi,t)}))}};t.ContextAwareCatalogService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ICatalogService,l.ISharedDataService])],t.ContextAwareCatalogService);t.RulesAndPermissionsRegistrationService=class RulesAndPermissionsRegistrationService{constructor(e,t,i,o,n,s,a,r,l,d,p){this.attributePermissionsRestService=e;this.catalogService=t;this.catalogVersionPermissionService=i;this.catalogVersionRestService=o;this.cMSModesService=n;this.experienceService=s;this.pageService=a;this.permissionService=r;this.sharedDataService=l;this.typePermissionsRestService=d;this.workflowService=p}register(){this.registerRules();this.registerRulesForTypeCodeFromContext();this.registerRulesForCurrentPage();this.registerRulesForTypeCode();this.registerRulesForTypeAndQualifier();this.registerPermissions()}onSuccess(e){return e.every((e=>e))}onError(){return false}getCurrentPageActiveWorkflow(){return __awaiter(this,void 0,void 0,(function*(){if(!l.windowUtils.getGatewayTargetFrame()){return null}const{uuid:e}=yield this.pageService.getCurrentPageInfo();return this.workflowService.getActiveWorkflowForPageUuid(e)}))}registerRules(){this.permissionService.registerRule({names:[te,ie,oe,ne],verify:e=>{const t=e.map((e=>{if(e.context){return this.catalogVersionPermissionService.hasWritePermission(e.context.catalogId,e.context.catalogVersion)}else{return this.catalogVersionPermissionService.hasWritePermissionOnCurrent()}}));return Promise.all(t).then(this.onSuccess,this.onError)}});this.permissionService.registerRule({names:[ue],verify:e=>{const isAvailableForCurrentPrincipal=e=>e===null?true:e.isAvailableForCurrentPrincipal;const t=e.map((e=>{if(e.context){return this.workflowService.getActiveWorkflowForPageUuid(e.context.pageInfo.uuid).then((e=>isAvailableForCurrentPrincipal(e)))}else{return this.getCurrentPageActiveWorkflow().then((e=>isAvailableForCurrentPrincipal(e)),(()=>true))}}));return Promise.all(t).then(this.onSuccess,this.onError)}});this.permissionService.registerRule({names:[he],verify:e=>{const isUserParticipant=e=>__awaiter(this,void 0,void 0,(function*(){return e===null?true:this.workflowService.isUserParticipanInActiveAction(e.workflowCode)}));const t=e.map((e=>{if(e.context){return this.workflowService.getActiveWorkflowForPageUuid(e.context.pageInfo.uuid).then((e=>isUserParticipant(e)))}else{return this.getCurrentPageActiveWorkflow().then((e=>isUserParticipant(e)),(()=>true))}}));return Promise.all(t).then(this.onSuccess,this.onError)}});this.permissionService.registerRule({names:[_e],verify:e=>{const t=e.map((e=>{if(e.context){return this.catalogVersionPermissionService.hasSyncPermission(e.context.catalogId,e.context.catalogVersion,e.context.targetCatalogVersion)}else{return this.catalogVersionPermissionService.hasSyncPermissionFromCurrentToActiveCatalogVersion()}}));return Promise.all(t).then(this.onSuccess,this.onError)}});this.permissionService.registerRule({names:["se.approval.status.page"],verify:()=>__awaiter(this,void 0,void 0,(function*(){const{approvalStatus:e}=yield this.pageService.getCurrentPageInfo();return e==="APPROVED"}))});this.permissionService.registerRule({names:[Z,Q,J,ee],verify:()=>this.catalogVersionPermissionService.hasReadPermissionOnCurrent()});this.permissionService.registerRule({names:[ve],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY);return e.pageContext&&e.pageContext.catalogVersionUuid===e.catalogDescriptor.catalogVersionUuid}))});this.permissionService.registerRule({names:["se.cloneable.page"],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY);if(!e.pageContext){return false}const t={CURRENT_CONTEXT_SITE_ID:e.pageContext.siteId,CURRENT_CONTEXT_CATALOG:e.pageContext.catalogId,CURRENT_CONTEXT_CATALOG_VERSION:e.pageContext.catalogVersion};const i=yield this.pageService.getCurrentPageInfo();const o=yield this.catalogVersionRestService.getCloneableTargets(t);if(e.pageContext.active){return o.versions.length>0&&!i.copyToCatalogsDisabled}return o.versions.length>0}))});this.permissionService.registerRule({names:[se],verify:()=>this.catalogService.isContentCatalogVersionNonActive()});this.permissionService.registerRule({names:[ae],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.cMSModesService.isVersioningPerspectiveActive();return!e}))});this.permissionService.registerRule({names:[re],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.experienceService.getCurrentExperience();return!!e.versionId}))});this.permissionService.registerRule({names:["se.version.page.not.selected"],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.experienceService.getCurrentExperience();return!e.versionId}))});this.permissionService.registerRule({names:["se.catalogversion.has.workflows.enabled"],verify:()=>this.workflowService.areWorkflowsEnabledOnCurrentCatalogVersion()});this.permissionService.registerRule({names:[le],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.getCurrentPageActiveWorkflow();return e!==null}))});this.permissionService.registerRule({names:["se.current.page.has.no.active.workflow"],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.getCurrentPageActiveWorkflow();return e===null}))});this.permissionService.registerRule({names:["se.has.change.permission.on.page.approval.status"],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e="approvalStatus";const t=yield this.pageService.getCurrentPageInfo();const i=yield this.attributePermissionsRestService.hasChangePermissionOnAttributesInType(t.typeCode,[e]);return i[e]}))})}registerRulesForTypeCodeFromContext(){const registerTypePermissionRuleForTypeCodeFromContext=(e,t)=>{this.permissionService.registerRule({names:[e],verify:e=>{const i=e.map((e=>t([e.context.typeCode]).then((t=>t[e.context.typeCode]))));return Promise.all(i).then(this.onSuccess,this.onError)}})};registerTypePermissionRuleForTypeCodeFromContext("se.has.change.permissions.on.type",(e=>this.typePermissionsRestService.hasUpdatePermissionForTypes(e)));registerTypePermissionRuleForTypeCodeFromContext("se.has.create.permissions.on.type",(e=>this.typePermissionsRestService.hasCreatePermissionForTypes(e)));registerTypePermissionRuleForTypeCodeFromContext("se.has.remove.permissions.on.type",(e=>this.typePermissionsRestService.hasDeletePermissionForTypes(e)))}registerRulesForCurrentPage(){const registerTypePermissionRuleOnCurrentPage=(e,t)=>{this.permissionService.registerRule({names:[e],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.pageService.getCurrentPageInfo();const i=yield t([e.typeCode]);return i[e.typeCode]}))})};registerTypePermissionRuleOnCurrentPage(ce,(e=>this.typePermissionsRestService.hasUpdatePermissionForTypes(e)));registerTypePermissionRuleOnCurrentPage("se.has.create.type.permissions.on.current.page",(e=>this.typePermissionsRestService.hasCreatePermissionForTypes(e)));registerTypePermissionRuleOnCurrentPage(de,(e=>this.typePermissionsRestService.hasReadPermissionForTypes(e)))}registerRulesForTypeCode(){const registerTypePermissionRuleForTypeCode=(e,t,i)=>{this.permissionService.registerRule({names:[e],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield i([t]);return e[t]}))})};registerTypePermissionRuleForTypeCode(pe,"CMSVersion",(e=>this.typePermissionsRestService.hasReadPermissionForTypes(e)));registerTypePermissionRuleForTypeCode(me,"CMSVersion",(e=>this.typePermissionsRestService.hasCreatePermissionForTypes(e)));registerTypePermissionRuleForTypeCode("se.has.remove.permission.on.version.type","CMSVersion",(e=>this.typePermissionsRestService.hasDeletePermissionForTypes(e)));registerTypePermissionRuleForTypeCode("se.has.change.permission.on.version.type","CMSVersion",(e=>this.typePermissionsRestService.hasUpdatePermissionForTypes(e)));registerTypePermissionRuleForTypeCode("se.has.create.permission.on.abstractcomponent.type","AbstractCMSComponent",(e=>this.typePermissionsRestService.hasCreatePermissionForTypes(e)));registerTypePermissionRuleForTypeCode("se.has.change.permission.on.contentslotforpage.type","ContentSlotForPage",(e=>this.typePermissionsRestService.hasUpdatePermissionForTypes(e)));registerTypePermissionRuleForTypeCode("se.has.create.permission.on.workflow.type","Workflow",(e=>this.typePermissionsRestService.hasCreatePermissionForTypes(e)));registerTypePermissionRuleForTypeCode(ge,"Workflow",(e=>this.typePermissionsRestService.hasUpdatePermissionForTypes(e)));registerTypePermissionRuleForTypeCode("se.has.read.permission.on.workflow.type","Workflow",(e=>this.typePermissionsRestService.hasReadPermissionForTypes(e)));registerTypePermissionRuleForTypeCode("se.has.create.permission.on.contentslot.type","ContentSlot",(e=>this.typePermissionsRestService.hasCreatePermissionForTypes(e)));registerTypePermissionRuleForTypeCode("se.has.delete.permission.on.contentslot.type","ContentSlot",(e=>this.typePermissionsRestService.hasDeletePermissionForTypes(e)))}registerRulesForTypeAndQualifier(){const registerAttributePermissionRuleForTypeAndQualifier=(e,t,i,o)=>{this.permissionService.registerRule({names:[e],verify:()=>__awaiter(this,void 0,void 0,(function*(){const e=yield o(t,[i]);return e[i]}))})};registerAttributePermissionRuleForTypeAndQualifier("se.has.change.permission.on.workflow.status","Workflow","status",((e,t)=>this.attributePermissionsRestService.hasChangePermissionOnAttributesInType(e,t)));registerAttributePermissionRuleForTypeAndQualifier("se.has.change.permission.on.workflow.description","Workflow","description",((e,t)=>this.attributePermissionsRestService.hasChangePermissionOnAttributesInType(e,t)))}registerPermissions(){this.permissionService.registerPermission({aliases:["se.add.component"],rules:[ie,oe,ve,ce,ue,he,"se.has.create.permission.on.abstractcomponent.type"]});this.permissionService.registerPermission({aliases:["se.clone.component"],rules:[oe,ve,ue,he]});this.permissionService.registerPermission({aliases:[_e],rules:[_e]});this.permissionService.registerPermission({aliases:["se.edit.navigation"],rules:[oe]});this.registerPagePermissions();this.registerSlotContextMenuPermissions();this.registerVersionPermissions();this.registerWorkflowPermissions()}registerPagePermissions(){this.permissionService.registerPermission({aliases:[Z],rules:[Z]});this.permissionService.registerPermission({aliases:["se.edit.page"],rules:[te,ue]});this.permissionService.registerPermission({aliases:["se.sync.page"],rules:[ve,ue]});this.permissionService.registerPermission({aliases:["se.clone.page"],rules:["se.cloneable.page","se.has.create.type.permissions.on.current.page"]});this.permissionService.registerPermission({aliases:["se.edit.page.link","se.delete.page.menu"],rules:[te,ve,ae,ce,ue]});this.permissionService.registerPermission({aliases:["se.edit.page.type","se.delete.page.type","se.restore.page.type"],rules:["se.has.change.permissions.on.type"]});this.permissionService.registerPermission({aliases:["se.clone.page.type"],rules:["se.has.create.permissions.on.type"]});this.permissionService.registerPermission({aliases:["se.permanently.delete.page.type"],rules:["se.has.remove.permissions.on.type"]})}registerSlotContextMenuPermissions(){this.permissionService.registerPermission({aliases:["se.sync.slot.context.menu","se.sync.slot.indicator"],rules:[_e,ve,ue]});this.permissionService.registerPermission({aliases:["se.context.menu.remove.component"],rules:[ie,ve,ue,he]});this.permissionService.registerPermission({aliases:["se.slot.context.menu.shared.icon","se.slot.context.menu.unshared.icon"],rules:["se.read.slot",ue,he]});this.permissionService.registerPermission({aliases:["se.slot.context.menu.visibility"],rules:[ve]});this.permissionService.registerPermission({aliases:["se.context.menu.edit.component"],rules:[oe,ve,ue]});this.permissionService.registerPermission({aliases:["se.context.menu.drag.and.drop.component"],rules:[ie,oe,ve,ue,he,"se.has.change.permission.on.contentslotforpage.type"]});this.permissionService.registerPermission({aliases:["se.shared.slot.override.options"],rules:[te,ve,ae,ue,"se.has.create.permission.on.contentslot.type"]});this.permissionService.registerPermission({aliases:["se.revert.to.global.or.shared.slot.link"],rules:[te,ve,ae,ue,"se.has.delete.permission.on.contentslot.type"]})}registerVersionPermissions(){this.permissionService.registerPermission({aliases:["se.version.page"],rules:[te,ve,se,pe,de]});this.permissionService.registerPermission({aliases:["se.edit.version.page"],rules:["se.write.to.current.catalog.version","se.has.change.permission.on.version.type",ue]});this.permissionService.registerPermission({aliases:["se.create.version.page"],rules:["se.version.page.not.selected",ve,me,de]});const e=[re,ve,pe,me,ce];this.permissionService.registerPermission({aliases:["se.rollback.version.page"],rules:e});this.permissionService.registerPermission({aliases:["se.rollback.version.page.versions.menu"],rules:e.filter((e=>e!==re))});this.permissionService.registerPermission({aliases:["se.delete.version.page"],rules:["se.has.remove.permission.on.version.type"]})}registerWorkflowPermissions(){this.permissionService.registerPermission({aliases:["se.start.page.workflow"],rules:["se.has.create.permission.on.workflow.type","se.catalogversion.has.workflows.enabled","se.current.page.has.no.active.workflow"]});this.permissionService.registerPermission({aliases:["se.view.page.workflowMenu"],rules:["se.has.read.permission.on.workflow.type",le]});this.permissionService.registerPermission({aliases:["se.cancel.page.workflowMenu"],rules:[ge,le,"se.has.change.permission.on.workflow.status"]});this.permissionService.registerPermission({aliases:["se.edit.workflow.workflowMenu"],rules:[ge,le,"se.has.change.permission.on.workflow.description"]});this.permissionService.registerPermission({aliases:["se.force.page.approval"],rules:[_e,"se.has.change.permission.on.page.approval.status",ve]});this.permissionService.registerPermission({aliases:["se.show.page.status"],rules:[se,ve]});this.permissionService.registerPermission({aliases:["se.act.on.page.in.workflow"],rules:[ue]})}};t.RulesAndPermissionsRegistrationService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.AttributePermissionsRestService,l.ICatalogService,l.ICatalogVersionPermissionService,Pe,l.CMSModesService,l.IExperienceService,l.IPageService,l.IPermissionService,l.ISharedDataService,r.TypePermissionsRestService,l.WorkflowService])],t.RulesAndPermissionsRegistrationService);t.ContextAwareEditableItemService=class ContextAwareEditableItemService extends r.IContextAwareEditableItemService{constructor(e,t){super();this.workflowService=e;this.pageService=t}isItemEditable(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.workflowService.getWorkflowEditableItems([e]);const i=t.find((t=>t.uid===e));if(i.editableInWorkflow){const e=yield this.editableInCurrentPageContext(i.editableInWorkflow);return i.editableByUser&&e}return i.editableByUser}))}editableInCurrentPageContext(e){return __awaiter(this,void 0,void 0,(function*(){try{const t=yield this.pageService.getCurrentPageInfo();const i=yield this.workflowService.getActiveWorkflowForPageUuid(t.uid);return i!==null&&i.workflowCode===e}catch(e){return true}}))}};t.ContextAwareEditableItemService=__decorate([l.GatewayProxied(),n.Injectable(),__metadata("design:paramtypes",[l.WorkflowService,l.IPageService])],t.ContextAwareEditableItemService);t.ExperienceGuard=class ExperienceGuard{constructor(e,t){this.catalogAwareRouteResolverHelper=e;this.routing=t}canActivate(e){return this.catalogAwareRouteResolverHelper.experienceFromPathResolve(e.params).catch((()=>{this.routing.go("/");return false}))}};t.ExperienceGuard=__decorate([n.Injectable(),__metadata("design:paramtypes",[_.CatalogAwareRouteResolverHelper,l.SmarteditRoutingService])],t.ExperienceGuard);t.PageRestrictionsCriteriaService=class PageRestrictionsCriteriaService{constructor(){this.ALL={};this.ANY={};this.restrictionCriteriaOptions=[this.ALL,this.ANY];this.setupCriteria(this.ALL,"all",false);this.setupCriteria(this.ANY,"any",true)}getMatchCriteriaLabel(e){if(e){return this.ANY.label}return this.ALL.label}getRestrictionCriteriaOptions(){return this.restrictionCriteriaOptions}getRestrictionCriteriaOptionFromPage(e){if(e&&typeof e.onlyOneRestrictionMustApply==="boolean"){if(e.onlyOneRestrictionMustApply){return this.ANY}}return this.ALL}setupCriteria(e,t,i){Object.defineProperty(e,"id",{writable:false,value:t});Object.defineProperty(e,"label",{writable:false,value:"se.cms.restrictions.criteria."+t});Object.defineProperty(e,"editLabel",{writable:false,value:"se.cms.restrictions.criteria.select."+t});Object.defineProperty(e,"value",{writable:false,value:i})}};t.PageRestrictionsCriteriaService=__decorate([n.Injectable(),__metadata("design:paramtypes",[])],t.PageRestrictionsCriteriaService);t.PageTypesRestrictionTypesService=class PageTypesRestrictionTypesService{constructor(e){this.pageTypesRestrictionTypesRestService=e}getRestrictionTypeCodesForPageType(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getPageTypesRestrictionTypes();return t.filter((t=>t.pageType===e)).map((e=>e.restrictionType))}))}getPageTypesRestrictionTypes(){if(this.cache){return this.cache}else{this.cache=this.pageTypesRestrictionTypesRestService.getPageTypesRestrictionTypes().then((e=>e.pageTypeRestrictionTypeList))}return this.cache}};t.PageTypesRestrictionTypesService=__decorate([n.Injectable(),__metadata("design:paramtypes",[Ae])],t.PageTypesRestrictionTypesService);t.RestrictionTypesService=class RestrictionTypesService{constructor(e,t){this.pageTypesRestrictionTypesService=e;this.restrictionTypesRestService=t}getRestrictionTypesByPageType(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getRestrictionTypes();const i=yield this.pageTypesRestrictionTypesService.getRestrictionTypeCodesForPageType(e);return t.filter((e=>i.indexOf(e.code)>=0))}))}getRestrictionTypeForTypeCode(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getRestrictionTypes();return t.find((t=>t.code===e))}))}getRestrictionTypes(){if(this.cache){return this.cache}else{this.cache=this.restrictionTypesRestService.getRestrictionTypes().then((e=>e.restrictionTypes))}return this.cache}};t.RestrictionTypesService=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.PageTypesRestrictionTypesService,Ne])],t.RestrictionTypesService);const Ye=[{subject:"name",errorCode:"field.already.exist",structure:{cmsStructureType:"ShortString",collection:false,editable:true,i18nKey:"type.cmsitem.name.name",localized:false,paged:false,qualifier:"name",required:true}},{subject:"label",errorCode:"default.page.label.already.exist",structure:{cmsStructureType:"DuplicatePrimaryContentPage",collection:false,editable:true,i18nKey:"se.cms.page.restore.content.duplicate.primaryforvariation.label",localized:false,paged:false,qualifier:"label",required:true}},{subject:"label",errorCode:"default.page.does.not.exist",structure:{cmsStructureType:"MissingPrimaryContentPage",collection:false,editable:true,i18nKey:"se.cms.page.restore.content.noprimaryforvariation.label",localized:false,paged:false,qualifier:"label",required:true}},{subject:"typeCode",errorCode:"default.page.already.exist",structure:{cmsStructureType:"DuplicatePrimaryNonContentPageMessage",collection:false,editable:true,i18nKey:"type.cmsitem.label.name",localized:false,paged:false,qualifier:"replace",required:true}}];const Ze=[{subject:"typeCode",errorCode:"default.page.does.not.exist",messageKey:"se.cms.page.restore.noprimaryforvariation.error"}];t.PageRestoreModalService=class PageRestoreModalService{constructor(e,t,i,o,n,s){this.alertService=e;this.confirmationModalService=t;this.genericEditorModalService=i;this.crossFrameEventService=o;this.pageRestoredAlertService=n;this.translate=s}handleRestoreValidationErrors(e,t){const i=this.getActionableErrors(t);const o=this.getNonActionableError(t);const n=p.difference(t,i,o);if(n.length>0){this.showErrorAlert(n)}else if(o.length>0){this.showConfirmationMessage(o)}else{this.showRestoreEditor(e,i).then((()=>{this.crossFrameEventService.publish(l.EVENT_CONTENT_CATALOG_UPDATE)}))}}showRestoreEditor(e,t){let i=this.getRestoreEditorStructureFields(t);const o={content:e,title:"se.cms.page.restore.page.title",componentId:e.uid,componentUuid:e.uuid,componentType:e.typeCode,structure:this.buildStructure(i)};this.forceErrorsDisplayInEditor(e.componentUuid,t);return this.genericEditorModalService.open(o,(()=>{this.pageRestoredAlertService.displayPageRestoredSuccessAlert(e);this.crossFrameEventService.publish(l.EVENTS.PAGE_RESTORED)}),((t,o)=>{const n=this.getActionableErrors(t);const s=p.difference(t,n);if(s.length>0){this.showErrorAlert(s)}else{i=p.concat(i,this.getRestoreEditorStructureFields(t));o.structure=this.buildStructure(i);this.forceErrorsDisplayInEditor(e.componentUuid,t)}}),{dialogPanelClass:"modal-stretched"})}forceErrorsDisplayInEditor(e,t){setTimeout((()=>{this.crossFrameEventService.publish(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,{messages:t,targetGenericEditorId:e})}),0)}buildStructure(e){return{attributes:e,category:"PAGE"}}getRestoreEditorStructureFields(e){return e.reduce(((e,t)=>{const i=Ye.find((e=>this.isSupportedError(t)&&this.isEqualTo(t,e)));e.push(i.structure);return e}),[])}showConfirmationMessage(e){const t=e.reduce(((e,t)=>{const i=Ze.find((e=>this.isSupportedError(t)&&this.isEqualTo(t,e)));return e+this.translate.instant(i.messageKey)+" "}),"");const i={description:t.trim(),showOkButtonOnly:true,title:"se.cms.page.restore.error.confirmationmodal.title"};this.confirmationModalService.confirm(i)}showErrorAlert(e){const t=e.reduce(((e,t)=>e+t.message+" "),"");this.alertService.showDanger(t.trim())}getActionableErrors(e){return e.filter((e=>Ye.some((t=>this.isSupportedError(e)&&this.isEqualTo(e,t)))))}getNonActionableError(e){return e.filter((e=>Ze.some((t=>this.isSupportedError(e)&&this.isEqualTo(e,t)))))}isSupportedError(e){return e.type==="ValidationError"}isEqualTo(e,t){return e.subject===t.subject&&e.errorCode===t.errorCode}};t.PageRestoreModalService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IAlertService,l.IConfirmationModalService,t.GenericEditorModalService,l.CrossFrameEventService,t.PageRestoredAlertService,m.TranslateService])],t.PageRestoreModalService);t.PageService=class PageService extends l.IPageService{constructor(e,t,i,o,n,s,a){super();this.pagesRestService=e;this.pagesFallbacksRestService=t;this.pagesVariationsRestService=i;this.pageInfoService=o;this.cmsitemsRestService=n;this.experienceService=s;this.urlService=a}getPageByUuid(e){return this.cmsitemsRestService.getById(e)}getCurrentPageInfo(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageInfoService.getPageUUID();return this.cmsitemsRestService.getById(e)}))}getPageById(e){return this.pagesRestService.getById(e)}getCurrentPageInfoByVersion(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageInfoService.getPageUUID();return this.cmsitemsRestService.getByIdAndVersion(t,e)}))}primaryPageForPageTypeExists(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getPaginatedPrimaryPagesForPageType(e,t,{search:null,pageSize:1,currentPage:0});return i.response.length>0}))}getPaginatedPrimaryPagesForPageType(e,t,i){const o="defaultPage:true,pageStatus:ACTIVE";const n=p.assign({},t||{},i||{},{typeCode:e,itemSearchParams:o});if(n.search){n.mask=n.search;delete n.search}if(!p.isNumber(n.pageSize)){n.pageSize=10}if(!p.isNumber(n.currentPage)){n.currentPage=0}return this.cmsitemsRestService.get(n)}isPagePrimary(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pagesFallbacksRestService.getFallbacksForPageId(e);return t.length===0}))}isPagePrimaryWithContext(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.pagesFallbacksRestService.getFallbacksForPageIdAndContext(e,t);return i.length===0}))}getPrimaryPage(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pagesFallbacksRestService.getFallbacksForPageId(e);return t[0]?this.pagesRestService.getById(t[0]):Promise.resolve(null)}))}getVariationPages(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pagesVariationsRestService.getVariationsForPrimaryPageId(e);return t.length>0?this.pagesRestService.get(t):Promise.resolve([])}))}updatePageById(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.pagesRestService.getById(e);const o=l.objectUtils.copy(i);t=Object.assign(Object.assign({},o),t);return this.pagesRestService.update(e,t)}))}forcePageApprovalStatus(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getCurrentPageInfo();const i=Object.assign({},t);i.approvalStatus=e;i.identifier=t.uuid;return this.cmsitemsRestService.update(i)}))}isPageApproved(e){return __awaiter(this,void 0,void 0,(function*(){let t;if(typeof e==="string"){t=yield this.getPageByUuid(e)}else{t=e}return t.approvalStatus===l.CmsApprovalStatus.APPROVED}))}buildUriContextForCurrentPage(e,t,i){return __awaiter(this,void 0,void 0,(function*(){let o={};if(e&&t&&i){o=this.urlService.buildUriContext(e,t,i)}if(!p.isEmpty(o)){return o}const n=yield this.experienceService.getCurrentExperience();return this.urlService.buildUriContext(n.pageContext.siteId,n.pageContext.catalogId,n.pageContext.catalogVersion)}))}};__decorate([l.Cached({actions:[l.rarelyChangingContent],tags:[l.pageEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],t.PageService.prototype,"getPageByUuid",null);__decorate([l.Cached({actions:[l.rarelyChangingContent],tags:[l.pageEvictionTag,l.pageChangeEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],t.PageService.prototype,"getCurrentPageInfo",null);t.PageService=__decorate([l.GatewayProxied(),n.Injectable(),__metadata("design:paramtypes",[Re,De,Me,l.IPageInfoService,l.CmsitemsRestService,l.IExperienceService,l.IUrlService])],t.PageService);let Xe=class PageFacade{constructor(e,t,i,o,n){this.cmsitemsRestService=e;this.crossFrameEventService=t;this.sharedDataService=i;this.urlService=o;this.catalogService=n}contentPageWithLabelExists(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o={pageSize:10,currentPage:0,typeCode:"ContentPage",itemSearchParams:"label:"+e,catalogId:t,catalogVersion:i};const n=yield this.cmsitemsRestService.get(o);return n&&!p.isEmpty(n.response)}))}retrievePageUriContext(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY);if(!e){throw new Error("pageFacade - could not retrieve an experience from sharedDataService")}if(!e.pageContext){return null}return this.urlService.buildUriContext(e.pageContext.siteId,e.pageContext.catalogId,e.pageContext.catalogVersion)}))}createPage(e){return __awaiter(this,void 0,void 0,(function*(){if(!e.catalogVersion){e.catalogVersion=yield this.catalogService.getCatalogVersionUUid()}if(e.onlyOneRestrictionMustApply===undefined){e.onlyOneRestrictionMustApply=false}if(e.restrictions===undefined){e.restrictions=[]}const t=yield this.cmsitemsRestService.create(e);this.crossFrameEventService.publish(l.EVENTS.PAGE_CREATED,e);return t}))}createPageForSite(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.catalogService.getCatalogVersionUUid();e.catalogVersion=e.catalogVersion||i;if(e.onlyOneRestrictionMustApply===undefined){e.onlyOneRestrictionMustApply=false}e=p.cloneDeep(e);e[r.CONTEXT_SITE_ID]=t;const o=yield this.cmsitemsRestService.create(e);this.crossFrameEventService.publish(l.EVENTS.PAGE_CREATED,e);return o}))}};Xe=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.CmsitemsRestService,l.CrossFrameEventService,l.ISharedDataService,l.IUrlService,l.ICatalogService])],Xe);class PageBuilder{constructor(e,t,i,o){this.catalogService=e;this.contextAwarePageStructureService=t;this.restrictionsStepHandler=i;this.uriContext=o;this.model={};this.page={restrictions:[]};this.catalogService.getCatalogVersionUUid(this.uriContext).then((e=>{this.page.catalogVersion=e}))}pageTypeSelected(e){this.model.pageType=e;this.model.pageTemplate=null;return this.updatePageInfoFields()}pageTemplateSelected(e){this.model.pageTemplate=e}getPageTypeCode(){var e;return((e=this.model.pageType)===null||e===void 0?void 0:e.code)||null}getTemplateUuid(){var e;return((e=this.model.pageTemplate)===null||e===void 0?void 0:e.uuid)||""}getPage(){var e,t;this.page.typeCode=this.getPageTypeCode();this.page.itemtype=this.page.typeCode;this.page.type=((e=this.model.pageType)===null||e===void 0?void 0:e.type)||null;this.page.masterTemplate=this.getTemplateUuid()||null;this.page.template=((t=this.model.pageTemplate)===null||t===void 0?void 0:t.uid)||null;return this.page}getPageRestrictions(){return this.page.restrictions}setPageUid(e){this.page.uid=e}setRestrictions(e,t){this.page.onlyOneRestrictionMustApply=e;this.page.restrictions=t}getPageInfoStructure(){return this.model.pageInfoFields}displayConditionSelected(e){const t=e.isPrimary;this.page.defaultPage=t;this.page.homepage=e.homepage;if(t){this.page.label=null;this.restrictionsStepHandler.hideStep()}else{this.page.label=e.primaryPage?e.primaryPage.label:"";this.restrictionsStepHandler.showStep()}return this.updatePageInfoFields()}updatePageInfoFields(){return __awaiter(this,void 0,void 0,(function*(){if(this.page.defaultPage!==undefined){if(this.model.pageType){const e=yield this.contextAwarePageStructureService.getPageStructureForNewPage(this.model.pageType.code,this.page.defaultPage);this.model.pageInfoFields=e}else{this.model.pageInfoFields={}}}}))}}let Qe=class PageBuilderFactory{constructor(e,t){this.catalogService=e;this.contextAwarePageStructureService=t}createPageBuilder(e,t){return new PageBuilder(this.catalogService,this.contextAwarePageStructureService,e,t)}};Qe=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ICatalogService,t.ContextAwarePageStructureService])],Qe);class RestrictionsStepHandler{constructor(e,t,i){this.wizardManager=e;this.restrictionsEditorFunctionBindings=t;this.stepDetails=i}hideStep(){if(this.isStepOnWizard()){this.wizardManager.removeStepById(this.getStepId())}}showStep(){if(!this.isStepOnWizard()){this.wizardManager.addStep(this.stepDetails,this.wizardManager.getStepsCount())}}isStepValid(){return this.restrictionsEditorFunctionBindings.isDirty&&this.restrictionsEditorFunctionBindings.isDirty()}getStepId(){return this.stepDetails.id}goToStep(){this.wizardManager.goToStepWithId(this.getStepId())}isStepOnWizard(){return this.wizardManager.containsStep(this.getStepId())}}t.RestrictionsStepHandlerFactory=class RestrictionsStepHandlerFactory{createRestrictionsStepHandler(e,t,i){return new RestrictionsStepHandler(e,t,i)}};t.RestrictionsStepHandlerFactory=__decorate([n.Injectable()],t.RestrictionsStepHandlerFactory);t.RestrictionsService=class RestrictionsService{constructor(e,t,i){this.structuresRestService=e;this.typeStructureRestService=t;this.modeManager=i.createModeManager(["add","edit","create"])}getStructureApiUri(e){this.modeManager.validateMode(e);return this.structuresRestService.getUriForContext(e)}getSupportedRestrictionTypeCodes(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.typeStructureRestService.getStructuresByCategory(r.StructureTypeCategory.RESTRICTION);return e.map((e=>e.code))}))}};t.RestrictionsService=__decorate([n.Injectable(),__metadata("design:paramtypes",[ze,Le,Fe])],t.RestrictionsService);window.__smartedit__.addDecoratorPayload("Component","PageTypeStepComponent",{selector:"se-page-type-step",template:`\n        <se-select-page-type\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            (onTypeSelected)="wizardApi.typeSelected($event)">\n        </se-select-page-type>\n    `});let Je=class PageTypeStepComponent{constructor(e){this.wizardApi=e}};Je=__decorate([n.Component({selector:"se-page-type-step",template:`\n        <se-select-page-type\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            (onTypeSelected)="wizardApi.typeSelected($event)">\n        </se-select-page-type>\n    `}),__param(0,n.Inject(l.WIZARD_API)),__metadata("design:paramtypes",[Object])],Je);window.__smartedit__.addDecoratorPayload("Component","PageTemplateStepComponent",{selector:"se-page-template-step",template:`\n        <se-select-page-template\n            [uriContext]="wizardApi.uriContext"\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            (onTemplateSelected)="wizardApi.templateSelected($event)">\n        </se-select-page-template>\n    `});let et=class PageTemplateStepComponent{constructor(e){this.wizardApi=e}};et=__decorate([n.Component({selector:"se-page-template-step",template:`\n        <se-select-page-template\n            [uriContext]="wizardApi.uriContext"\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            (onTemplateSelected)="wizardApi.templateSelected($event)">\n        </se-select-page-template>\n    `}),__param(0,n.Inject(l.WIZARD_API)),__metadata("design:paramtypes",[Object])],et);window.__smartedit__.addDecoratorPayload("Component","PageInfoStepComponent",{selector:"se-page-info-step",template:`\n        <span *ngIf="wizardApi.isPageInfoActive()">\n            <se-generic-editor\n                [structure]="wizardApi.getPageInfoStructure()"\n                [content]="wizardApi.getPageInfo()"\n                [(submit)]="wizardApi.callbacks.savePageInfo"\n                [(reset)]="wizardApi.callbacks.resetPageInfo"\n                [(isDirty)]="wizardApi.callbacks.isDirtyPageInfo"\n                [(isValid)]="wizardApi.callbacks.isValidPageInfo">\n            </se-generic-editor>\n        </span>\n    `});let tt=class PageInfoStepComponent{constructor(e){this.wizardApi=e}};tt=__decorate([n.Component({selector:"se-page-info-step",template:`\n        <span *ngIf="wizardApi.isPageInfoActive()">\n            <se-generic-editor\n                [structure]="wizardApi.getPageInfoStructure()"\n                [content]="wizardApi.getPageInfo()"\n                [(submit)]="wizardApi.callbacks.savePageInfo"\n                [(reset)]="wizardApi.callbacks.resetPageInfo"\n                [(isDirty)]="wizardApi.callbacks.isDirtyPageInfo"\n                [(isValid)]="wizardApi.callbacks.isValidPageInfo">\n            </se-generic-editor>\n        </span>\n    `}),__param(0,n.Inject(l.WIZARD_API)),__metadata("design:paramtypes",[Object])],tt);window.__smartedit__.addDecoratorPayload("Component","PageDisplayConditionStepComponent",{selector:"se-page-condition-step",template:`\n        <se-event-message\n            class="existing-homepage__ymessage"\n            [showEvent]="'CMS_EVENT_SHOW_REPLACE_PARENT_HOMEPAGE_INFO'"\n            [hideEvent]="'CMS_EVENT_HIDE_REPLACE_PARENT_HOMEPAGE_INFO'">\n        </se-event-message>\n\n        <se-new-page-display-condition\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            [uriContext]="wizardApi.uriContext"\n            [resultFn]="wizardApi.variationResult"></se-new-page-display-condition>\n    `});let it=class PageDisplayConditionStepComponent{constructor(e){this.wizardApi=e}};it=__decorate([n.Component({selector:"se-page-condition-step",template:`\n        <se-event-message\n            class="existing-homepage__ymessage"\n            [showEvent]="'CMS_EVENT_SHOW_REPLACE_PARENT_HOMEPAGE_INFO'"\n            [hideEvent]="'CMS_EVENT_HIDE_REPLACE_PARENT_HOMEPAGE_INFO'">\n        </se-event-message>\n\n        <se-new-page-display-condition\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            [uriContext]="wizardApi.uriContext"\n            [resultFn]="wizardApi.variationResult"></se-new-page-display-condition>\n    `}),__param(0,n.Inject(l.WIZARD_API)),__metadata("design:paramtypes",[Object])],it);window.__smartedit__.addDecoratorPayload("Component","PageRestrictionsStepComponent",{selector:"se-page-restrictions-step",template:`\n        <span *ngIf="wizardApi.isRestrictionsActive()" class="se-create-page-restriction-step">\n            <div *ngIf="wizardApi.getPageRestrictions().length > 1">\n                <se-page-restrictions-info-message></se-page-restrictions-info-message>\n            </div>\n            <se-restrictions-editor\n                [editable]="true"\n                [(resetFn)]="wizardApi.restrictionsEditorFunctionBindings.reset"\n                [(cancelFn)]="wizardApi.restrictionsEditorFunctionBindings.cancel"\n                [(isDirtyFn)]="wizardApi.restrictionsEditorFunctionBindings.isDirty"\n                (onRestrictionsChange)="wizardApi.restrictionsResult($event)"\n                [getRestrictionTypes]="wizardApi.getRestrictionTypes"\n                [getSupportedRestrictionTypes]="wizardApi.getSupportedRestrictionTypes"\n                [item]="wizardApi.getPageInfo()"\n                [restrictionUuids]="wizardApi.getPageRestrictions()">\n            </se-restrictions-editor>\n        </span>\n    `});let ot=class PageRestrictionsStepComponent{constructor(e){this.wizardApi=e}};ot=__decorate([n.Component({selector:"se-page-restrictions-step",template:`\n        <span *ngIf="wizardApi.isRestrictionsActive()" class="se-create-page-restriction-step">\n            <div *ngIf="wizardApi.getPageRestrictions().length > 1">\n                <se-page-restrictions-info-message></se-page-restrictions-info-message>\n            </div>\n            <se-restrictions-editor\n                [editable]="true"\n                [(resetFn)]="wizardApi.restrictionsEditorFunctionBindings.reset"\n                [(cancelFn)]="wizardApi.restrictionsEditorFunctionBindings.cancel"\n                [(isDirtyFn)]="wizardApi.restrictionsEditorFunctionBindings.isDirty"\n                (onRestrictionsChange)="wizardApi.restrictionsResult($event)"\n                [getRestrictionTypes]="wizardApi.getRestrictionTypes"\n                [getSupportedRestrictionTypes]="wizardApi.getSupportedRestrictionTypes"\n                [item]="wizardApi.getPageInfo()"\n                [restrictionUuids]="wizardApi.getPageRestrictions()">\n            </se-restrictions-editor>\n        </span>\n    `}),__param(0,n.Inject(l.WIZARD_API)),__metadata("design:paramtypes",[Object])],ot);const nt="se.cms.addpagewizard.pagetype.title";window.__smartedit__.addDecoratorPayload("Component","AddPageWizardComponent",{selector:"se-add-page-wizard",template:""});let at=class AddPageWizardComponent{constructor(e,t,i,o,n,s,a,r,l){this.wizardManager=e;this.pageBuilderFactory=t;this.restrictionsStepHandlerFactory=i;this.experienceService=o;this.confirmationModalService=n;this.systemEventService=s;this.restrictionTypesService=a;this.restrictionsService=r;this.pageFacade=l;this.getWizardConfig=()=>({isFormValid:e=>this.isFormValid(e),onNext:()=>this.onNext(),onDone:()=>this.onDone(),onCancel:()=>this.onCancel(),steps:[{id:this.ADD_PAGE_WIZARD_STEPS.PAGE_TYPE,name:"se.cms.addpagewizard.pagetype.tabname",title:nt,component:Je},{id:this.ADD_PAGE_WIZARD_STEPS.PAGE_TEMPLATE,name:"se.cms.addpagewizard.pagetemplate.tabname",title:nt,component:et},{id:this.ADD_PAGE_WIZARD_STEPS.PAGE_DISPLAY_CONDITION,name:"se.cms.addpagewizard.pageconditions.tabname",title:nt,component:it},{id:this.ADD_PAGE_WIZARD_STEPS.PAGE_INFO,name:"se.cms.addpagewizard.pageinfo.tabname",title:nt,component:tt}]});this.getRestrictionTypes=()=>this.restrictionTypesService.getRestrictionTypesByPageType(this.getPageTypeCode());this.getSupportedRestrictionTypes=()=>this.restrictionsService.getSupportedRestrictionTypeCodes();this.variationResult=e=>{this.pageBuilder.displayConditionSelected(e)};const d={};this.uriContext=this.wizardManager.properties.uriContext;this.callbacks={};this.restrictionStepProperties={id:"restrictionsStepId",name:"se.cms.restrictions.editor.tab",title:nt,component:ot};this.restrictionsEditorFunctionBindings=d;this.restrictionsStepHandler=this.restrictionsStepHandlerFactory.createRestrictionsStepHandler(this.wizardManager,d,this.restrictionStepProperties);this.pageBuilder=this.pageBuilderFactory.createPageBuilder(this.restrictionsStepHandler,this.uriContext);this.saveInProgress=false;this.typeChanged=true;this.ADD_PAGE_WIZARD_STEPS={PAGE_TYPE:"pageType",PAGE_TEMPLATE:"pageTemplate",PAGE_DISPLAY_CONDITION:"pageDisplayCondition",PAGE_INFO:"pageInfo",PAGE_RESTRICTIONS:this.restrictionsStepHandler.getStepId()}}typeSelected(e){this.typeChanged=true;this.pageBuilder.pageTypeSelected(e)}templateSelected(e){this.pageBuilder.pageTemplateSelected(e)}getPageTypeCode(){return this.pageBuilder.getPageTypeCode()}restrictionsResult(e){this.pageBuilder.setRestrictions(e.onlyOneRestrictionMustApply,e.restrictionUuids)}isRestrictionsActive(){if(!this.typeChanged||this.wizardManager.getCurrentStepId()===this.ADD_PAGE_WIZARD_STEPS.PAGE_RESTRICTIONS){this.typeChanged=false;return true}return false}getPageInfo(){const e=this.pageBuilder.getPage();e.uriContext=this.uriContext;return e}getPageRestrictions(){return this.pageBuilder.getPageRestrictions()}getPageInfoStructure(){return this.pageBuilder.getPageInfoStructure()}isPageInfoActive(){return this.wizardManager.getCurrentStepId()===this.ADD_PAGE_WIZARD_STEPS.PAGE_INFO}onNext(){return Promise.resolve(true)}onCancel(){return this.confirmationModalService.confirm({description:"se.editor.cancel.confirm"})}isFormValid(e){switch(e){case this.ADD_PAGE_WIZARD_STEPS.PAGE_TYPE:return!!this.pageBuilder.getPageTypeCode();case this.ADD_PAGE_WIZARD_STEPS.PAGE_TEMPLATE:return!!this.pageBuilder.getTemplateUuid();case this.ADD_PAGE_WIZARD_STEPS.PAGE_DISPLAY_CONDITION:return true;case this.ADD_PAGE_WIZARD_STEPS.PAGE_INFO:return!this.saveInProgress&&!!this.callbacks.isDirtyPageInfo&&this.callbacks.isDirtyPageInfo()&&!!this.callbacks.isValidPageInfo&&this.callbacks.isValidPageInfo();case this.ADD_PAGE_WIZARD_STEPS.PAGE_RESTRICTIONS:return!this.saveInProgress&&this.restrictionsStepHandler.isStepValid()}return false}onDone(){return __awaiter(this,void 0,void 0,(function*(){this.saveInProgress=true;const e=yield this.callbacks.savePageInfo();p.defaultsDeep(e,this.pageBuilder.getPage());try{const t=yield this.pageFacade.createPage(e);this.pageBuilder.setPageUid(t.uid);if(t.typeCode==="EmailPage"){this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE,t);return t}yield this.experienceService.loadExperience({siteId:this.uriContext.CURRENT_CONTEXT_SITE_ID,catalogId:this.uriContext.CURRENT_CONTEXT_CATALOG,catalogVersion:this.uriContext.CURRENT_CONTEXT_CATALOG_VERSION,pageId:this.pageBuilder.getPage().uid})}catch(e){this.saveInProgress=false;this.systemEventService.publishAsync(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,{messages:e.error.errors});const t=e.error.errors;if(!t.find((e=>e.subject.indexOf("restrictions")===0))){this.wizardManager.goToStepWithId(this.ADD_PAGE_WIZARD_STEPS.PAGE_INFO)}return Promise.reject()}return Promise.resolve()}))}};at=__decorate([n.Component({selector:"se-add-page-wizard",template:""}),__param(0,n.Inject(l.WIZARD_MANAGER)),__metadata("design:paramtypes",[l.WizardService,Qe,t.RestrictionsStepHandlerFactory,l.IExperienceService,l.IConfirmationModalService,l.SystemEventService,t.RestrictionTypesService,t.RestrictionsService,Xe])],at);t.AddPageWizardService=class AddPageWizardService{constructor(e,t){this.modalWizard=e;this.catalogService=t}openAddPageWizard(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.retrieveUriContext();return this.modalWizard.open({component:at,properties:{uriContext:e}})}))}};t.AddPageWizardService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ModalWizard,l.ICatalogService])],t.AddPageWizardService);t.CMSPageOperation=void 0;(function(e){e["TRASH_PAGE"]="TRASH_PAGE"})(t.CMSPageOperation||(t.CMSPageOperation={}));t.ManagePageService=class ManagePageService{constructor(e,t,i,o,n,s,a,d,p,m,g,u,h,_,v,f,y,S){this.logService=e;this.smarteditRoutingService=t;this.alertService=i;this.cmsitemsRestService=o;this.systemEventService=n;this.crossFrameEventService=s;this.pageInfoService=a;this.confirmationModalService=d;this.pagesVariationsRestService=p;this.waitDialogService=m;this.pageRestoreModalService=g;this.pageRestoredAlertService=u;this.homepageService=h;this.workflowService=_;this.catalogService=v;this.restServiceFactory=f;this.sharedDataService=y;this.catalogVersionRestService=S;this.resourcePageOperationsURI=`/cmssmarteditwebservices/v1/sites/${l.PAGE_CONTEXT_SITE_ID}/catalogs/${r.PAGE_CONTEXT_CATALOG}/pages/:pageId/operations`}getSoftDeletedPagesCount(e){return __awaiter(this,void 0,void 0,(function*(){const t={pageSize:10,currentPage:0,typeCode:"AbstractPage",itemSearchParams:"pageStatus:deleted",catalogId:e.CURRENT_CONTEXT_CATALOG,catalogVersion:e.CURRENT_CONTEXT_CATALOG_VERSION,fields:"BASIC"};const i=yield this.cmsitemsRestService.get(t);return i.pagination.totalCount}))}softDeletePage(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=p.cloneDeep(e);const o={catalogId:t.CURRENT_CONTEXT_CATALOG,catalogVersion:t.CURRENT_CONTEXT_CATALOG_VERSION,siteId:t.CURRENT_CONTEXT_SITE_ID};const n=yield this.getConfirmationModalDescription(i,t);const s=yield this.confirmSoftDelete(n,e.name);if(!s){return}try{i.identifier=e.uuid;i.pageStatus=l.CMSPageStatus.DELETED;yield this.cmsitemsRestService.update(i);this.crossFrameEventService.publish(l.EVENTS.PAGE_DELETED);this.alertService.showSuccess({message:"se.cms.actionitem.page.trash.alert.success.description",messagePlaceholders:{pageName:e.name},minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"});this.smarteditRoutingService.go("/pages/:siteId/:catalogId/:catalogVersion".replace(":siteId",o.siteId).replace(":catalogId",o.catalogId).replace(":catalogVersion",o.catalogVersion))}catch(e){this.logService.warn("Something went wrong when soft deleting page",e)}}))}hardDeletePage(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.confirmHardDelete(e.name);if(!t){return}yield this.cmsitemsRestService.delete(e.uuid);this.alertService.showSuccess("se.cms.page.permanently.delete.alert.success");this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE);this.crossFrameEventService.publish(l.EVENTS.PAGE_DELETED)}))}restorePage(e){return __awaiter(this,void 0,void 0,(function*(){const t=p.cloneDeep(e);t.pageStatus=l.CMSPageStatus.ACTIVE;t.identifier=e.uuid;this.waitDialogService.showWaitModal(null);try{const e=yield this.cmsitemsRestService.update(t,{headers:{"Ignore-Interceptor":"NonValidationErrorInterceptor"}});this.waitDialogService.hideWaitModal();this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE,e);this.pageRestoredAlertService.displayPageRestoredSuccessAlert(t);this.crossFrameEventService.publish(l.EVENTS.PAGE_RESTORED)}catch(e){const i=e.error.errors;this.waitDialogService.hideWaitModal();this.pageRestoreModalService.handleRestoreValidationErrors(t,i)}}))}isPageTrashable(e,t){return __awaiter(this,void 0,void 0,(function*(){try{const[i,o]=yield Promise.all([this.hasFallbackHomepageOrIsPrimaryWithoutVariations(e,t),this.workflowService.isPageInWorkflow(e)]);return i&&!o}catch(e){return false}}))}isPageCloneable(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=(yield this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY)).catalogDescriptor;const o={CURRENT_CONTEXT_SITE_ID:i.siteId,CURRENT_CONTEXT_CATALOG:i.catalogId,CURRENT_CONTEXT_CATALOG_VERSION:i.catalogVersion};const[n,s,a]=yield Promise.all([this.catalogService.getContentCatalogsForSite(i.siteId),this.cmsitemsRestService.getById(e),this.catalogVersionRestService.getCloneableTargets(o)]);const r=n.reduce(((e,t)=>{if(t.parents&&t.parents.length){e=e.concat(t.parents)}return e}),[...n]).reduce(((e,t)=>e.concat(t.versions)),[]).find((e=>e.uuid===t));if(r===null||r===void 0?void 0:r.active){return a.versions.length>0&&!s.copyToCatalogsDisabled}return a.versions.length>0}))}getDisabledTrashTooltipMessage(e,i){return __awaiter(this,void 0,void 0,(function*(){let o="se.cms.tooltip.movetotrash";const n=yield this.workflowService.isPageInWorkflow(e);const s=yield this.homepageService.getHomepageType(e,i);if(s===t.HomepageType.CURRENT){o="se.cms.tooltip.current.homepage.movetotrash"}else if(s===t.HomepageType.OLD){o="se.cms.tooltip.old.homepage.movetotrash"}else if(n){o="se.cms.tooltip.page.in.workflow.movetotrash"}return o}))}trashPageInActiveCatalogVersion(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.catalogService.retrieveUriContext();const i=yield this.catalogService.getContentCatalogActiveVersion(t);const o=yield this.confirmTrashingPageInActiveCatalogVersion(i);if(!o){return}try{this.pageOperationsRESTService=this.restServiceFactory.get(this.resourcePageOperationsURI.replace(":pageId",e));yield this.pageOperationsRESTService.save({operation:"TRASH_PAGE",sourceCatalogVersion:t.CURRENT_CONTEXT_CATALOG_VERSION,targetCatalogVersion:i});this.alertService.showSuccess({message:"se.cms.sync.page.status.success.alert",messagePlaceholders:{pageId:e,catalogVersion:i},minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"})}catch(e){this.logService.warn("trashPageInActiveCatalogVersion - page could not be trashed",e)}}))}getConfirmationModalDescription(e,t){return __awaiter(this,void 0,void 0,(function*(){try{const i=yield this.pageInfoService.getPageUUID();if(!i){this.logService.error("deletePageService::deletePage - pageUUID is undefined");return Promise.reject()}const o=yield this.homepageService.getHomepageType(e,t);if(o!==null||e.homepage){return"se.cms.actionitem.page.trash.confirmation.description.storefront.homepage"}return"se.cms.actionitem.page.trash.confirmation.description.storefront"}catch(e){return"se.cms.actionitem.page.trash.confirmation.description.pagelist"}}))}confirmSoftDelete(e,t){return __awaiter(this,void 0,void 0,(function*(){try{yield this.confirmationModalService.confirm({description:e,descriptionPlaceholders:{pageName:t},title:"se.cms.actionitem.page.trash.confirmation.title"});return true}catch(e){return false}}))}confirmHardDelete(e){return __awaiter(this,void 0,void 0,(function*(){try{yield this.confirmationModalService.confirm({title:"se.cms.actionitem.page.permanently.delete.confirmation.title",description:"se.cms.actionitem.page.permanently.delete.confirmation.description",descriptionPlaceholders:{pageName:e}});return true}catch(e){return false}}))}confirmTrashingPageInActiveCatalogVersion(e){return __awaiter(this,void 0,void 0,(function*(){try{yield this.confirmationModalService.confirm({title:"se.cms.sync.page.status.confirm.title",description:"se.cms.sync.page.status.confirm.description",descriptionPlaceholders:{catalogVersion:e}});return true}catch(e){return false}}))}hasFallbackHomepageOrIsPrimaryWithoutVariations(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.homepageService.getHomepageType(e,t);if(i!==null||e.homepage){return this.homepageService.hasFallbackHomePage(t)}const o=yield this.pagesVariationsRestService.getVariationsForPrimaryPageId(e.uid);return o.length===0}))}};__decorate([l.Cached({actions:[l.rarelyChangingContent],tags:[l.pageDeletionEvictionTag,l.pageRestoredEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],t.ManagePageService.prototype,"getSoftDeletedPagesCount",null);t.ManagePageService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.LogService,l.SmarteditRoutingService,l.IAlertService,l.CmsitemsRestService,l.SystemEventService,l.CrossFrameEventService,l.IPageInfoService,l.IConfirmationModalService,Me,l.IWaitDialogService,t.PageRestoreModalService,t.PageRestoredAlertService,t.HomepageService,l.WorkflowService,l.ICatalogService,l.IRestServiceFactory,l.ISharedDataService,Pe])],t.ManagePageService);class IPageTreeMenuBaseService{constructor(e){this.permissionService=e}getPageTreeComponentMenus(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.buildMenusByPermission();const i=t.map((t=>__awaiter(this,void 0,void 0,(function*(){if(!t.condition){return t}const i=yield t.condition(e);return i?t:null}))));return Promise.all(i)}))}buildMenusByPermission(){return __awaiter(this,void 0,void 0,(function*(){const e=yield Promise.all(this.originalMenus.map((e=>__awaiter(this,void 0,void 0,(function*(){if(!e.permissions||e.permissions.length===0){return e}const t=yield this.permissionService.isPermitted([{names:e.permissions}]);if(t){return e}return null})))));return e.filter((e=>!!e))}))}}t.PageTreeComponentMenuService=class PageTreeComponentMenuService extends IPageTreeMenuBaseService{constructor(e,t,i){super(i);this.editorEnablerService=e;this.componentMenuConditionAndCallbackService=t;this.originalMenus=[{key:"externalcomponentbutton",i18nKey:"se.cms.contextmenu.title.externalcomponentbutton",displayIconClass:"sap-icon--globe",permissions:[],condition:this.componentMenuConditionAndCallbackService.externalCondition,action:{component:r.ExternalComponentButtonComponent}},{key:"se.cms.sharedcomponentbutton",i18nKey:"se.cms.contextmenu.title.shared.component",displayIconClass:"sap-icon--chain-link",permissions:[],condition:this.componentMenuConditionAndCallbackService.sharedCondition,action:{component:r.SharedComponentButtonComponent}},{key:"se.cms.edit",i18nKey:"se.cms.contextmenu.title.edit",displayIconClass:"sap-icon--edit",permissions:["se.context.menu.edit.component"],action:{callback:this.editorEnablerService.onClickEditButton},condition:e=>__awaiter(this,void 0,void 0,(function*(){if(e.isComponentHidden){return this.componentMenuConditionAndCallbackService.editConditionForHiddenComponent(e)}else{return this.editorEnablerService.isSlotEditableForNonExternalComponent(e)}}))},{key:"se.cms.remove",i18nKey:"se.cms.contextmenu.title.remove",displayIconClass:"sap-icon--decline",permissions:["se.context.menu.remove.component"],action:{callback:this.componentMenuConditionAndCallbackService.removeCallback},condition:this.componentMenuConditionAndCallbackService.removeCondition},{key:"clonecomponentbutton",i18nKey:"se.cms.contextmenu.title.clone.component",displayIconClass:"sap-icon--duplicate",permissions:["se.clone.component"],action:{callback:this.componentMenuConditionAndCallbackService.cloneCallback},condition:this.componentMenuConditionAndCallbackService.cloneCondition}]}};t.PageTreeComponentMenuService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.IEditorEnablerService,r.IComponentMenuConditionAndCallbackService,l.IPermissionService])],t.PageTreeComponentMenuService);t.PageTreeSlotMenuService=class PageTreeSlotMenuService extends IPageTreeMenuBaseService{constructor(e){super(e);this.originalMenus=[{key:"se.slotSharedButton",nameI18nKey:"slotcontextmenu.title.shared.button",regexpKeys:["^.*Slot$"],action:{component:r.SlotSharedButtonComponent},permissions:["se.slot.context.menu.shared.icon"]},{key:"slotUnsharedButton",nameI18nKey:"slotcontextmenu.title.unshared.button",regexpKeys:["^.*Slot$"],action:{component:r.SlotUnsharedButtonComponent},permissions:["se.slot.context.menu.unshared.icon"]},{key:"se.slotSyncButton",nameI18nKey:"slotcontextmenu.title.sync.button",regexpKeys:["^.*Slot$"],action:{component:r.SlotSyncButtonComponent},permissions:["se.sync.slot.context.menu"]}]}};t.PageTreeSlotMenuService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IPermissionService])],t.PageTreeSlotMenuService);const rt=20;const lt=300;t.NodeInfoService=class NodeInfoService{constructor(e,t,i,o,n){this.crossFrameEventService=e;this.cmsitemsRestService=t;this.logService=i;this.slotVisibilityService=o;this.pageTreeNodeService=n;this.treeNodes=[]}buildNodesInfo(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageTreeNodeService.getSlotNodes();this.treeNodes=[];this.treeNodes=yield Promise.all(e.map((e=>__awaiter(this,void 0,void 0,(function*(){return this.addMoreInfoToOneNode(e)})))));return this.treeNodes}))}updatePartTreeNodesInfo(e){return __awaiter(this,void 0,void 0,(function*(){yield Promise.all(Object.keys(e).map((t=>__awaiter(this,void 0,void 0,(function*(){const i=this.treeNodes.findIndex((e=>e.elementUuid===t));if(i>-1){const o=this.treeNodes[i];o.childrenNode=e[t];this.treeNodes[i]=yield this.addMoreInfoToOneNode(o)}})))));return this.treeNodes}))}updatePartTreeNodesInfoBySlotUuid(e){return __awaiter(this,void 0,void 0,(function*(){const t=this.treeNodes.findIndex((t=>t.componentId===e));if(t>-1){const e=this.treeNodes[t];this.treeNodes[t]=yield this.addMoreInfoToOneNode(e)}return this.treeNodes}))}publishComponentSelected(e,t,i){if(t){this.crossFrameEventService.publish(l.EVENT_PAGE_TREE_SLOT_SELECTED,{elementUuid:i,active:true})}this.crossFrameEventService.publish(l.EVENT_PAGE_TREE_COMPONENT_SELECTED,{elementUuid:e.elementUuid,active:e.isExpanded})}publishSlotSelected(e){this.crossFrameEventService.publish(l.EVENT_PAGE_TREE_SLOT_SELECTED,{elementUuid:e.elementUuid,active:e.isExpanded});this.crossFrameEventService.publish(l.EVENT_PAGE_TREE_COMPONENT_SELECTED,{elementUuid:e.elementUuid,active:e.isExpanded})}getChildComponents(e){return __awaiter(this,void 0,void 0,(function*(){const t=e.children.map((e=>typeof e==="string"?e:e.uuid));const i=yield this.getComponentsDataByUUIDs(t);return i.map((e=>this.buildComponentNode(e,!e.visible||e.restricted)))}))}getComponentAttributes(e){return{smarteditCatalogVersionUuid:e.catalogVersion,smarteditComponentId:e.uid,smarteditComponentType:e.typeCode,smarteditComponentUuid:e.uuid,smarteditElementUuid:e.elementUuid}}getContextualMenuConfiguration(e,t,i,o){return{componentType:e.typeCode,componentId:e.uid,componentUuid:e.uuid,containerType:e.containerType,containerId:e.containerId,isComponentHidden:e.isHidden,componentAttributes:t,slotId:i,slotUuid:o}}addMoreInfoToOneNode(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.slotVisibilityService.getHiddenComponents(e.componentId);const i=t.length;const o=e.childrenNode.map((e=>e.componentUuid));const n=yield this.getComponentsDataByUUIDs(o);let s=n.map((t=>this.buildDisplayComponentNode(t,e)));s=s.concat(t.map((e=>this.buildComponentNode(e,true))));return Object.assign(Object.assign({},e),{componentNodes:s,hiddenComponentCount:i})}))}getComponentsDataByUUIDs(e){return __awaiter(this,void 0,void 0,(function*(){try{const t=yield this.cmsitemsRestService.getByIds(e,"DEFAULT");return Promise.resolve(t.response?t.response:[t])}catch(e){this.logService.error("SlotInfoService:: getSlotsDataByUUIDs error:",e.message);return Promise.reject()}}))}buildComponentNode(e,t){const i=l.stringUtils.generateIdentifier();return Object.assign({isExpanded:false,componentNodes:[],isHidden:t,elementUuid:i},e)}buildDisplayComponentNode(e,t){const i=t.childrenNode.find((t=>t.componentUuid===e.uuid));const{componentId:o,componentUuid:n,componentTypeFromPage:s,containerId:a,containerType:r,catalogVersionUuid:l,elementUuid:d}=i;return Object.assign({isHidden:false,isExpanded:false,componentId:o,componentUuid:n,componentTypeFromPage:s,containerId:a,containerType:r,catalogVersionUuid:l,elementUuid:d,componentNodes:[]},e)}};t.NodeInfoService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.CrossFrameEventService,l.CmsitemsRestService,l.LogService,r.ISlotVisibilityService,l.IPageTreeNodeService])],t.NodeInfoService);t.PageTreeChildComponentMenuService=class PageTreeChildComponentMenuService extends IPageTreeMenuBaseService{constructor(e,t,i){super(i);this.editorEnablerService=e;this.componentMenuConditionAndCallbackService=t;this.originalMenus=[{key:"se.cms.sharedcomponentbutton",i18nKey:"se.cms.contextmenu.title.shared.component",displayIconClass:"sap-icon--chain-link",permissions:[],condition:this.componentMenuConditionAndCallbackService.sharedCondition,action:{component:r.SharedComponentButtonComponent}},{key:"se.cms.edit",i18nKey:"se.cms.contextmenu.title.edit",displayIconClass:"sap-icon--edit",permissions:["se.context.menu.edit.component"],action:{callback:this.editorEnablerService.onClickEditButton},condition:e=>__awaiter(this,void 0,void 0,(function*(){if(e.isComponentHidden){return this.componentMenuConditionAndCallbackService.editConditionForHiddenComponent(e)}else{return this.editorEnablerService.isSlotEditableForNonExternalComponent(e)}}))}]}getPageTreeChildComponentMenus(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.buildMenusByPermission();const o=i.map((i=>__awaiter(this,void 0,void 0,(function*(){if(!i.condition){return i}let o;if(i.key==="se.cms.edit"){o=yield i.condition(e)}else{o=yield i.condition(t)}return o?i:null}))));return Promise.all(o)}))}};t.PageTreeChildComponentMenuService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.IEditorEnablerService,r.IComponentMenuConditionAndCallbackService,l.IPermissionService])],t.PageTreeChildComponentMenuService);const ct=["layout/landingLayout1Page","layout/landingLayout3Page","layout/landingLayout4Page","layout/landingLayout5Page","layout/landingLayout6Page","layout/landingLayoutPage","account/accountRegisterPage","checkout/checkoutRegisterPage"];t.PageTemplateService=class PageTemplateService{constructor(e){this.pageTemplateRestService=e.get(r.PAGE_TEMPLATES_URI)}getPageTemplatesForType(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=Object.assign({pageTypeCode:t,active:true},e);const o=yield this.pageTemplateRestService.get(i);return{templates:o.templates.filter((e=>!ct.includes(e.frontEndName)))}}))}};t.PageTemplateService=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IRestServiceFactory])],t.PageTemplateService);t.RemoveComponentService=class RemoveComponentService extends r.IRemoveComponentService{};t.RemoveComponentService=__decorate([l.GatewayProxied("removeComponent")],t.RemoveComponentService);t.SlotRestrictionsService=class SlotRestrictionsService extends l.ISlotRestrictionsService{};t.SlotRestrictionsService=__decorate([l.GatewayProxied("getAllComponentTypesSupportedOnPage","getSlotRestrictions","determineComponentStatusInSlot","isSlotEditable")],t.SlotRestrictionsService);t.SyncPollingService=class SyncPollingService extends l.ISyncPollingService{constructor(e,t,i,o,n,s,a,r,l){super();this.logService=e;this.pageInfoService=t;this.experienceService=i;this.catalogService=o;this.synchronizationResourceService=n;this.crossFrameEventService=s;this.systemEventService=a;this.timerService=r;this.smarteditBootstrapGateway=l;this.SYNC_POLLING_THROTTLE=500;this.syncStatus={};this.triggers=new Set;this.syncPollingTimer=null;this.refreshInterval=null;this.syncPageObservableMap=new Map;this.initSyncPolling()}performSync(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.isCurrentPageFromActiveCatalog();if(i){return Promise.reject()}const o=yield this.catalogService.getContentCatalogActiveVersion(t);return this.synchronizationResourceService.getPageSynchronizationPostRestService(t).save({target:o,items:e})}))}getSyncStatus(e,t,i){return __awaiter(this,void 0,void 0,(function*(){if(i){this.clearSyncPageObservableMap()}if(this.syncStatus[e]&&e===this.syncStatus[e].itemId&&!i){return this.syncStatus[e]}let o;try{o=yield this.getPageUUID(e)}catch(i){this.logService.error("syncPollingService::getSyncStatus - failed call to getPageUUID");this.syncPollingTimer.stop();return this.fetchSyncStatus(e,t)}try{const e=yield this.fetchSyncStatus(o,t);const i=this.getSyncPollingTypeFromInterval(this.refreshInterval);this.startSync(i);return e}catch(e){this.logService.error("syncPollingService::getSyncStatus - failed call to fetchSyncStatus");return Promise.reject()}}))}fetchSyncStatus(e,t){return __awaiter(this,void 0,void 0,(function*(){try{const i=yield this.getPageUUID(e);if(!i){return{}}const o=yield this.isCurrentPageFromActiveCatalog();if(o){this.logService.debug("When the content catalog is online version, don't need to get the synchronization status.");return Promise.reject()}const n=yield this.catalogService.getContentCatalogActiveVersion(t);const s=l.stringUtils.encode(i);const a=this.syncPageObservableMap.get(s);return a?a.toPromise():this.fetchPageSynchronization(n,i,t).toPromise()}catch(e){this.stopSync();this.logService.warn(e);return Promise.reject()}}))}changePollingSpeed(e,t){if(e===r.DEFAULT_SYNCHRONIZATION_POLLING.SPEED_UP){this.syncStatus={};if(t&&!this.triggers.has(t)){this.triggers.add(t)}this.refreshInterval=r.DEFAULT_SYNCHRONIZATION_POLLING.FAST_POLLING_TIME}else{if(t){this.triggers.delete(t)}if(this.triggers.size===0){this.refreshInterval=r.DEFAULT_SYNCHRONIZATION_POLLING.SLOW_POLLING_TIME}}this.syncPollingTimer.restart(this.refreshInterval)}fetchPageSynchronization(e,t,i){const o=h.from(this.getPageSlotSyncStatus(i,t,e));const n=l.stringUtils.encode(t);this.syncPageObservableMap.set(n,o);return o.pipe(v.share())}getPageSlotSyncStatus(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.synchronizationResourceService.getPageSynchronizationGetRestService(e).get({pageUid:t,target:i});const n=this.syncStatus[o.itemId];this.crossFrameEventService.publish(r.DEFAULT_SYNCHRONIZATION_POLLING.FETCH_STATUS,o);if(JSON.stringify(o)!==JSON.stringify(n)){this.crossFrameEventService.publish(r.DEFAULT_SYNCHRONIZATION_POLLING.FAST_FETCH,o);if(!n||o.lastModifiedDate!==n.lastModifiedDate||o.status!==n.status){this.crossFrameEventService.publish(r.CMSITEMS_UPDATE_EVENT);this.crossFrameEventService.publish(l.EVENTS.PAGE_UPDATED,{uuid:t})}}this.syncStatus[o.itemId]=o;this.clearSyncPageObservableMap();return o}))}stopSync(){if(this.syncPollingTimer.isActive()){this.syncPollingTimer.stop()}this.clearSyncStatus()}startSync(e){if(!this.syncPollingTimer.isActive()){this.changePollingSpeed(e||r.DEFAULT_SYNCHRONIZATION_POLLING.SLOW_DOWN)}}initSyncPolling(){this.refreshInterval=r.DEFAULT_SYNCHRONIZATION_POLLING.SLOW_POLLING_TIME;this.triggers.clear();this.syncStatus={};const e=this.changePollingSpeed.bind(this);this.systemEventService.subscribe(r.DEFAULT_SYNCHRONIZATION_POLLING.SPEED_UP,e);this.systemEventService.subscribe(r.DEFAULT_SYNCHRONIZATION_POLLING.SLOW_DOWN,e);this.crossFrameEventService.subscribe(r.DEFAULT_SYNCHRONIZATION_POLLING.FETCH_SYNC_STATUS_ONCE,((e,t)=>{this.fetchSyncStatus(t).catch((()=>{}))}));this.crossFrameEventService.subscribe(l.OVERLAY_RERENDERED_EVENT,p.throttle((()=>{if(this.syncPollingTimer.isActive()){this.fetchSyncStatus().catch((()=>{}))}}),this.SYNC_POLLING_THROTTLE));this.crossFrameEventService.subscribe(l.EVENTS.PAGE_CHANGE,(()=>{this.clearSyncStatus();this.clearSyncPageObservableMap()}));this.crossFrameEventService.subscribe(r.DEFAULT_SYNCHRONIZATION_EVENT.CATALOG_SYNCHRONIZED,(()=>{this.syncStatus={};this.fetchSyncStatus().catch((()=>{}))}));this.syncPollingTimer=this.timerService.createTimer((()=>this.fetchSyncStatus().catch((()=>{}))),this.refreshInterval);this.smarteditBootstrapGateway.getInstance().subscribe("bootstrapSmartEdit",(()=>{const e=this.getSyncPollingTypeFromInterval(this.refreshInterval);this.startSync(e)}))}clearSyncPageObservableMap(){this.syncPageObservableMap.clear()}clearSyncStatus(){this.syncStatus={}}getPageUUID(e){return!l.stringUtils.isBlank(e)?Promise.resolve(e):this.pageInfoService.getPageUUID()}isCurrentPageFromActiveCatalog(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.experienceService.getCurrentExperience();return e.pageContext?e.pageContext.active:e.catalogDescriptor.active}))}getSyncPollingTypeFromInterval(e){return e===r.DEFAULT_SYNCHRONIZATION_POLLING.FAST_POLLING_TIME?r.DEFAULT_SYNCHRONIZATION_POLLING.SPEED_UP:r.DEFAULT_SYNCHRONIZATION_POLLING.SLOW_DOWN}};__decorate([l.InvalidateCache(l.cmsitemsEvictionTag),__metadata("design:type",Function),__metadata("design:paramtypes",[Array,Object]),__metadata("design:returntype",Promise)],t.SyncPollingService.prototype,"performSync",null);t.SyncPollingService=__decorate([l.GatewayProxied("getSyncStatus","fetchSyncStatus","changePollingSpeed","registerSyncPollingEvents","performSync"),n.Injectable(),__metadata("design:paramtypes",[l.LogService,l.IPageInfoService,l.IExperienceService,l.ICatalogService,r.SynchronizationResourceService,l.CrossFrameEventService,l.SystemEventService,l.TimerService,l.SmarteditBootstrapGateway])],t.SyncPollingService);t.SlotVisibilityService=class SlotVisibilityService extends r.ISlotVisibilityService{};t.SlotVisibilityService=__decorate([l.GatewayProxied("getHiddenComponents")],t.SlotVisibilityService);t.ComponentMenuConditionAndCallbackService=class ComponentMenuConditionAndCallbackService extends r.IComponentMenuConditionAndCallbackService{};t.ComponentMenuConditionAndCallbackService=__decorate([l.GatewayProxied("externalCondition","removeCondition","removeCallback","cloneCondition","cloneCallback","sharedCondition","editConditionForHiddenComponent","dragCondition"),n.Injectable()],t.ComponentMenuConditionAndCallbackService);t.ComponentEditingFacade=class ComponentEditingFacade extends r.IComponentEditingFacade{};t.ComponentEditingFacade=__decorate([l.GatewayProxied("addNewComponentToSlot","addExistingComponentToSlot","cloneExistingComponentToSlot","moveComponent"),n.Injectable()],t.ComponentEditingFacade);window.__smartedit__.addDecoratorPayload("Component","ComponentItemComponent",{selector:"se-component-item",template:`<div class="se-component-item" [ngClass]="{ 'se-component-item--disabled': isComponentDisabled, 'smartEditComponent': !isComponentDisabled }" [attr.data-smartedit-component-id]="componentInfo.uid" [attr.data-smartedit-component-uuid]="componentInfo.uuid" [attr.data-smartedit-component-type]="componentInfo.typeCode"><se-tooltip *ngIf="isComponentDisabled" class="se-component-item__tooltip" [placement]="'bottom'" [triggers]="['mouseenter', 'mouseleave']" [additionalClasses]="['se-component-item__tooltip--for-disabled']"><div se-tooltip-trigger class="se-component-item--disabled-overlay"></div><div se-tooltip-body class="se-popover--inner-content" translate="se.cms.component.non.cloneable.tooltip" [translateParams]="{ componentName: componentInfo.name }"></div></se-tooltip><div class="se-component-item--image"><span class="sap-icon--card"></span><div *ngIf="isSharedComponent"><span class="se-component-item--image-shared--background"></span> <span class="sap-icon--chain-link se-component-item--image-shared"></span></div></div><div class="se-component-item--details-container"><div class="se-component-item--details" title="{{ componentInfo.name }} - {{ componentInfo.typeCode }}"><div class="se-component-item--details-name">{{ componentInfo.name }}</div><div class="se-component-item--details-type">{{ componentInfo.typeCode }}</div></div><se-tooltip *ngIf="!componentInfo.visible" [triggers]="['mouseenter', 'mouseleave']" [additionalClasses]="['se-component-item--visibility']"><span se-tooltip-trigger class="hyicon hyicon-unpowered"></span><div se-tooltip-body translate="se.cms.component.display.off.tooltip"></div></se-tooltip></div></div>`,styles:[`se-component-item .se-component-item--disabled,se-component-item .se-component-item--disabled:active,se-component-item .se-component-item--disabled:hover{border:2px solid transparent}se-component-item .se-component-item--disabled-overlay{cursor:not-allowed;position:absolute;z-index:1;height:100%;width:100%;left:0;top:0;background:var(--sapGroup_ContentBorderColor);border-radius:4px;opacity:.5}se-component-item .se-component-item--details-container{display:flex}se-component-item .se-component-item--details-name{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapNeutralColor);width:100%}se-component-item .se-component-item--image-shared--background{position:absolute;top:0;left:0;width:0;height:0;border-style:solid;border-width:13px;border-color:var(--sapShellColor) transparent transparent var(--sapShellColor);border-radius:4px 0 0 0}se-component-item .se-component-item--image-shared{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;position:absolute;top:2px;left:2px;transform:rotate(3deg);-webkit-font-smoothing:antialiased}se-component-item .se-component-item--visibility,se-component-item .se-component-item--visibility .fd-popover__control,se-component-item .se-component-item--visibility>div{width:100%;height:100%}se-component-item .se-component-item__tooltip{display:block;height:100%;width:100%;position:absolute;left:0;top:0}se-component-item .se-component-item__tooltip--for-disabled,se-component-item .se-component-item__tooltip--for-disabled .fd-popover__control,se-component-item .se-component-item__tooltip--for-disabled>div{width:100%;height:100%}`,``],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let dt=class ComponentItemComponent{constructor(e,t){this.componentSharedService=e;this.cdr=t}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.isSharedComponent=yield this.componentSharedService.isComponentShared(this.componentInfo);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnChanges(e){if(e.cloneOnDrop){this.isComponentDisabled=this.cloneOnDrop&&!this.componentInfo.cloneable}}};__decorate([n.Input(),__metadata("design:type",Object)],dt.prototype,"componentInfo",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],dt.prototype,"cloneOnDrop",void 0);dt=__decorate([n.Component({selector:"se-component-item",template:`<div class="se-component-item" [ngClass]="{ 'se-component-item--disabled': isComponentDisabled, 'smartEditComponent': !isComponentDisabled }" [attr.data-smartedit-component-id]="componentInfo.uid" [attr.data-smartedit-component-uuid]="componentInfo.uuid" [attr.data-smartedit-component-type]="componentInfo.typeCode"><se-tooltip *ngIf="isComponentDisabled" class="se-component-item__tooltip" [placement]="'bottom'" [triggers]="['mouseenter', 'mouseleave']" [additionalClasses]="['se-component-item__tooltip--for-disabled']"><div se-tooltip-trigger class="se-component-item--disabled-overlay"></div><div se-tooltip-body class="se-popover--inner-content" translate="se.cms.component.non.cloneable.tooltip" [translateParams]="{ componentName: componentInfo.name }"></div></se-tooltip><div class="se-component-item--image"><span class="sap-icon--card"></span><div *ngIf="isSharedComponent"><span class="se-component-item--image-shared--background"></span> <span class="sap-icon--chain-link se-component-item--image-shared"></span></div></div><div class="se-component-item--details-container"><div class="se-component-item--details" title="{{ componentInfo.name }} - {{ componentInfo.typeCode }}"><div class="se-component-item--details-name">{{ componentInfo.name }}</div><div class="se-component-item--details-type">{{ componentInfo.typeCode }}</div></div><se-tooltip *ngIf="!componentInfo.visible" [triggers]="['mouseenter', 'mouseleave']" [additionalClasses]="['se-component-item--visibility']"><span se-tooltip-trigger class="hyicon hyicon-unpowered"></span><div se-tooltip-body translate="se.cms.component.display.off.tooltip"></div></se-tooltip></div></div>`,styles:[`se-component-item .se-component-item--disabled,se-component-item .se-component-item--disabled:active,se-component-item .se-component-item--disabled:hover{border:2px solid transparent}se-component-item .se-component-item--disabled-overlay{cursor:not-allowed;position:absolute;z-index:1;height:100%;width:100%;left:0;top:0;background:var(--sapGroup_ContentBorderColor);border-radius:4px;opacity:.5}se-component-item .se-component-item--details-container{display:flex}se-component-item .se-component-item--details-name{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapNeutralColor);width:100%}se-component-item .se-component-item--image-shared--background{position:absolute;top:0;left:0;width:0;height:0;border-style:solid;border-width:13px;border-color:var(--sapShellColor) transparent transparent var(--sapShellColor);border-radius:4px 0 0 0}se-component-item .se-component-item--image-shared{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;position:absolute;top:2px;left:2px;transform:rotate(3deg);-webkit-font-smoothing:antialiased}se-component-item .se-component-item--visibility,se-component-item .se-component-item--visibility .fd-popover__control,se-component-item .se-component-item--visibility>div{width:100%;height:100%}se-component-item .se-component-item__tooltip{display:block;height:100%;width:100%;position:absolute;left:0;top:0}se-component-item .se-component-item__tooltip--for-disabled,se-component-item .se-component-item__tooltip--for-disabled .fd-popover__control,se-component-item .se-component-item__tooltip--for-disabled>div{width:100%;height:100%}`,``],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[r.IComponentSharedService,n.ChangeDetectorRef])],dt);window.__smartedit__.addDecoratorPayload("Component","ComponentTypeComponent",{selector:"se-component-type",template:`<div class="se-component-item smartEditComponent" [attr.data-smartedit-component-type]="typeInfo.code"><div class="se-component-item--image"><span class="sap-icon--card"></span></div><div class="se-component-item--details-type" [title]="typeInfo.i18nKey | translate">{{ typeInfo.name }}</div></div>`,styles:[``],changeDetection:n.ChangeDetectionStrategy.OnPush});let pt=class ComponentTypeComponent{};__decorate([n.Input(),__metadata("design:type",Object)],pt.prototype,"typeInfo",void 0);pt=__decorate([n.Component({selector:"se-component-type",template:`<div class="se-component-item smartEditComponent" [attr.data-smartedit-component-type]="typeInfo.code"><div class="se-component-item--image"><span class="sap-icon--card"></span></div><div class="se-component-item--details-type" [title]="typeInfo.i18nKey | translate">{{ typeInfo.name }}</div></div>`,styles:[``],changeDetection:n.ChangeDetectionStrategy.OnPush})],pt);window.__smartedit__.addDecoratorPayload("Component","ComponentSearchComponent",{selector:"se-component-search",template:`<div class="se-input-group se-component-menu__input-group fd-input-group"><input type="text" fd-form-control class="se-input-group__input-area fd-input-group__input fd-input" name="search-term" (ngModelChange)="onSearchQueryChange($event)" [(ngModel)]="searchQuery" placeholder="{{ placeholderI18nKey | translate }}"/> <span class="sap-icon--search se-input-group__addon"></span><div *ngIf="showResetButton" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="resetSearch($event)"></div></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let gt=class ComponentSearchComponent{constructor(e){this.systemEventService=e;this.onChange=new n.EventEmitter;this.searchQuery="";this.showResetButton=false;this.searchQuerySubject$=new h.Subject;this.searchQuerySubscription=this.searchQuerySubject$.pipe(d.debounceTime(500),d.distinctUntilChanged()).subscribe((e=>{this.searchQuery=e;this.onChange.emit(this.searchQuery)}))}ngOnInit(){this.resetSearch();this.unRegResetComponentMenuEvent=this.systemEventService.subscribe(G,(()=>this.resetSearch()))}ngOnDestroy(){this.unRegResetComponentMenuEvent();this.searchQuerySubscription.unsubscribe()}onSearchQueryChange(e){this.searchQuerySubject$.next(e);this.showResetButton=!!e.length}resetSearch(e){if(e){e.stopPropagation()}this.searchQuery="";this.showResetButton=false;this.onChange.emit(this.searchQuery)}};__decorate([n.Input(),__metadata("design:type",String)],gt.prototype,"placeholderI18nKey",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],gt.prototype,"onChange",void 0);gt=__decorate([n.Component({selector:"se-component-search",template:`<div class="se-input-group se-component-menu__input-group fd-input-group"><input type="text" fd-form-control class="se-input-group__input-area fd-input-group__input fd-input" name="search-term" (ngModelChange)="onSearchQueryChange($event)" [(ngModel)]="searchQuery" placeholder="{{ placeholderI18nKey | translate }}"/> <span class="sap-icon--search se-input-group__addon"></span><div *ngIf="showResetButton" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="resetSearch($event)"></div></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.SystemEventService])],gt);window.__smartedit__.addDecoratorPayload("Component","CatalogVersionItemComponent",{selector:"se-catalog-version-item",template:`\n        <div class="se-component-menu__select-local">\n            <span\n                class="sap-icon--globe se-component-menu__select-globe"\n                *ngIf="item.isCurrentCatalog"></span>\n            <span class="se-component-menu__select-text"\n                >{{ item.catalogName | seL10n | async }} - {{ item.catalogVersionId }}</span\n            >\n        </div>\n    `});let ut=class CatalogVersionItemComponent{constructor(e){this.item=e.item}};ut=__decorate([n.Component({selector:"se-catalog-version-item",template:`\n        <div class="se-component-menu__select-local">\n            <span\n                class="sap-icon--globe se-component-menu__select-globe"\n                *ngIf="item.isCurrentCatalog"></span>\n            <span class="se-component-menu__select-text"\n                >{{ item.catalogName | seL10n | async }} - {{ item.catalogVersionId }}</span\n            >\n        </div>\n    `}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],ut);window.__smartedit__.addDecoratorPayload("Component","ComponentsTabComponent",{selector:"se-components-tab",template:`<div class="se-component-menu__tabs-header"><div class="se-component-menu__tabs-header--upper" *ngIf="hasMultipleContentCatalogs()"><se-select id="se-components-tab-catalog-versions" class="se-component-menu__select" [(model)]="selectedCatalogVersionId" (modelChange)="onCatalogVersionChange()" [fetchStrategy]="catalogVersionsFetchStrategy" [searchEnabled]="false" [itemComponent]="itemComponent"></se-select></div><div class="se-component-menu__tabs-header--lower"><se-component-search (onChange)="onSearchTermChanged($event)" [placeholderI18nKey]="'se.cms.componentmenu.search.placeholder'" class="se-component-menu__tabs-search"></se-component-search><fieldset class="fd-form__set"><div class="fd-form__item fd-form__item--check se-component-menu__clone-on-drop"><input type="checkbox" class="fd-form__control se-component-menu__clone-check-box" id="component-clone-checkbox" name="clone-on-drop" [(ngModel)]="cloneOnDrop" (ngModelChange)="onComponentCloneOnDropChange($event)"/> <label class="fd-form__label se-component-menu__clone-label" for="component-clone-checkbox" translate="se.cms.component.clone.on.drop.label"></label></div></fieldset></div></div><div class="se-component-menu__result-container" *ngIf="forceRecompile"><se-infinite-scrolling *ngIf="isActive()" class="se-component-menu__infinite-scroll" [ngClass]="{'se-component-menu__infinite-scroll--short': hasMultipleContentCatalogs() }" [pageSize]="10" [mask]="searchTerm" [fetchPage]="loadComponentItems" [context]="componentsContext"><div class="se-component-menu__result" *ngIf="componentsContext.items.length"><se-component-item class="se-component-menu__item-wrap" *ngFor="let item of componentsContext.items; trackBy: trackById" [componentInfo]="item" [cloneOnDrop]="cloneOnDrop"></se-component-item></div></se-infinite-scrolling></div>`,styles:[`se-components-tab .se-component-menu__tabs-header{padding:0 20px 16px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}se-components-tab .se-component-menu__tabs-header .fd-form__set{margin:0!important;border:none}se-components-tab .se-component-menu__tabs-header--upper{margin-bottom:12px}se-components-tab .se-component-menu__tabs-header--lower{display:flex;flex-direction:row;align-items:center}se-components-tab .se-component-menu__tabs-search{width:78%}se-components-tab .se-component-menu__clone-on-drop.fd-form__item{display:flex;flex-direction:row;align-items:center}se-components-tab .se-component-menu__clone-check-box.fd-form__control{margin:0 4px 0 16px}se-components-tab .se-component-menu__clone-label.fd-form__label{white-space:nowrap;color:var(--sapTextColor);margin-bottom:0}se-components-tab .se-component-menu__infinite-scroll .se-infinite-scrolling__container{max-height:300px}se-components-tab .se-component-menu__infinite-scroll--short .se-infinite-scrolling__container{max-height:250px}se-components-tab .se-component-menu__result{display:grid;grid-template-columns:repeat(2,1fr)}`],encapsulation:n.ViewEncapsulation.None});let ht=class ComponentsTabComponent{constructor(e,t,i,o,n){this.tabData=e;this.componentMenuService=t;this.componentService=i;this.sharedDataService=o;this.userTrackingService=n;this.loadComponentItems=(e,t,i)=>__awaiter(this,void 0,void 0,(function*(){if(!this.selectedCatalogVersion){return{results:[]}}const o={catalogId:this.selectedCatalogVersion.catalogId,catalogVersion:this.selectedCatalogVersion.catalogVersionId,mask:e,pageSize:t,page:i};const n=yield this.componentService.loadPagedComponentItemsByCatalogVersion(o);return Object.assign(Object.assign({},n),{results:n.response})}));this.catalogVersions=[];this.catalogVersionsFetchStrategy={fetchAll:()=>this.fetchCatalogVersions()};this.componentsContext={items:[]};this.forceRecompile=true;this.itemComponent=ut;this.selectedCatalogVersionId=null;this.selectedCatalogVersion=null;this.searchTerm=""}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.cloneOnDrop=!!(yield this.sharedDataService.get(We));yield this.fetchCatalogVersions();if(!this.hasMultipleContentCatalogs()){this.onCatalogVersionChange()}}))}isActive(){return this.tabData.tab.active}hasMultipleContentCatalogs(){return this.tabData.model.componentsTab.hasMultipleContentCatalogs}trackById(e){return e.id}onCatalogVersionChange(){return __awaiter(this,void 0,void 0,(function*(){if(this.selectedCatalogVersionId){this.selectedCatalogVersion=this.catalogVersions.find((e=>e.id===this.selectedCatalogVersionId));yield this.componentMenuService.persistCatalogVersion(this.selectedCatalogVersionId);this.forceRecompile=false;setTimeout((()=>{this.forceRecompile=true}))}}))}onSearchTermChanged(e){this.searchTerm=e}onComponentCloneOnDropChange(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.ADD_COMPONENT,"Clone on Drop");this.sharedDataService.set(We,this.cloneOnDrop)}fetchCatalogVersions(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.componentMenuService.getValidContentCatalogVersions();this.catalogVersions=e;const t=yield this.componentMenuService.getInitialCatalogVersion(this.catalogVersions);this.selectedCatalogVersion=t;this.selectedCatalogVersionId=this.selectedCatalogVersion?this.selectedCatalogVersion.id:undefined;return this.catalogVersions}))}};ht=__decorate([n.Component({selector:"se-components-tab",template:`<div class="se-component-menu__tabs-header"><div class="se-component-menu__tabs-header--upper" *ngIf="hasMultipleContentCatalogs()"><se-select id="se-components-tab-catalog-versions" class="se-component-menu__select" [(model)]="selectedCatalogVersionId" (modelChange)="onCatalogVersionChange()" [fetchStrategy]="catalogVersionsFetchStrategy" [searchEnabled]="false" [itemComponent]="itemComponent"></se-select></div><div class="se-component-menu__tabs-header--lower"><se-component-search (onChange)="onSearchTermChanged($event)" [placeholderI18nKey]="'se.cms.componentmenu.search.placeholder'" class="se-component-menu__tabs-search"></se-component-search><fieldset class="fd-form__set"><div class="fd-form__item fd-form__item--check se-component-menu__clone-on-drop"><input type="checkbox" class="fd-form__control se-component-menu__clone-check-box" id="component-clone-checkbox" name="clone-on-drop" [(ngModel)]="cloneOnDrop" (ngModelChange)="onComponentCloneOnDropChange($event)"/> <label class="fd-form__label se-component-menu__clone-label" for="component-clone-checkbox" translate="se.cms.component.clone.on.drop.label"></label></div></fieldset></div></div><div class="se-component-menu__result-container" *ngIf="forceRecompile"><se-infinite-scrolling *ngIf="isActive()" class="se-component-menu__infinite-scroll" [ngClass]="{'se-component-menu__infinite-scroll--short': hasMultipleContentCatalogs() }" [pageSize]="10" [mask]="searchTerm" [fetchPage]="loadComponentItems" [context]="componentsContext"><div class="se-component-menu__result" *ngIf="componentsContext.items.length"><se-component-item class="se-component-menu__item-wrap" *ngFor="let item of componentsContext.items; trackBy: trackById" [componentInfo]="item" [cloneOnDrop]="cloneOnDrop"></se-component-item></div></se-infinite-scrolling></div>`,styles:[`se-components-tab .se-component-menu__tabs-header{padding:0 20px 16px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}se-components-tab .se-component-menu__tabs-header .fd-form__set{margin:0!important;border:none}se-components-tab .se-component-menu__tabs-header--upper{margin-bottom:12px}se-components-tab .se-component-menu__tabs-header--lower{display:flex;flex-direction:row;align-items:center}se-components-tab .se-component-menu__tabs-search{width:78%}se-components-tab .se-component-menu__clone-on-drop.fd-form__item{display:flex;flex-direction:row;align-items:center}se-components-tab .se-component-menu__clone-check-box.fd-form__control{margin:0 4px 0 16px}se-components-tab .se-component-menu__clone-label.fd-form__label{white-space:nowrap;color:var(--sapTextColor);margin-bottom:0}se-components-tab .se-component-menu__infinite-scroll .se-infinite-scrolling__container{max-height:300px}se-components-tab .se-component-menu__infinite-scroll--short .se-infinite-scrolling__container{max-height:250px}se-components-tab .se-component-menu__result{display:grid;grid-template-columns:repeat(2,1fr)}`],encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(l.TAB_DATA)),__metadata("design:paramtypes",[Object,l.ComponentMenuService,r.ComponentService,l.ISharedDataService,l.IUserTrackingService])],ht);window.__smartedit__.addDecoratorPayload("Component","ComponentTypesTabComponent",{selector:"se-component-types-tab",template:`<div class="se-component-menu__types-header"><se-component-search (onChange)="onSearchTermChanged($event)" [placeholderI18nKey]="'se.cms.componentmenu.search.type.placeholder'" class="se-component-menu__type-search"></se-component-search></div><div class="se-component-menu__result-container"><se-infinite-scrolling class="se-component-menu__infinite-scroll" *ngIf="isMenuOpen() || isTabActive()" [pageSize]="10" [mask]="searchTerm" [fetchPage]="loadComponentTypes" [context]="componentsContext"><div class="se-component-menu__result se-component-menu__result--types"><div class="se-component-menu__item-wrap" *ngFor="let componentType of componentsContext.items"><se-component-type [typeInfo]="componentType"></se-component-type></div></div></se-infinite-scrolling></div>`,styles:[`se-component-types-tab .se-component-menu__type-search{width:100%}se-component-types-tab .se-component-menu__result{display:grid;grid-template-columns:repeat(2,1fr)}se-component-types-tab .se-component-menu__infinite-scroll .se-infinite-scrolling__container{max-height:300px}se-component-types-tab .se-component-menu__types-header{padding:0 20px 16px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}se-component-types-tab .se-component-menu__types-header .fd-form__set{margin:0!important}se-component-types-tab .se-component-menu__input-group .se-input-group__addon[class*=sap-icon]{height:100%}`],encapsulation:n.ViewEncapsulation.None});let _t=class ComponentTypesTabComponent{constructor(e,t,i,o,n,s,a){this.tabData=e;this.logService=t;this.componentService=i;this.pageService=o;this.catalogService=n;this.crossFrameEventService=s;this.languageService=a;this.loadComponentTypes=(e,t,i)=>__awaiter(this,void 0,void 0,(function*(){try{const[o]=yield Promise.all([this.languageService.getResolveLocale(),this.loadPageContext()]);const n={pageId:this.pageInfo.uid,catalogId:this.uriContext.CURRENT_CONTEXT_CATALOG,catalogVersion:this.uriContext.CURRENT_CONTEXT_CATALOG_VERSION,langIsoCode:o,mask:e,pageSize:t,currentPage:i};const s=yield this.componentService.getSupportedComponentTypesForCurrentPage(n);return s}catch(e){this.logService.error("ComponentTypesTab - loadComponentTypes - error loading types.",e);return null}}));this.componentsContext={items:[]};this.pageInfo=null;this.searchTerm="";this.uriContext=null}ngOnInit(){this.unRegisterSwitchLanguageEvent=this.crossFrameEventService.subscribe(l.SWITCH_LANGUAGE_EVENT,(()=>{console.log("switch language called before",this.searchTerm);this.searchTerm=this.searchTerm!==undefined?undefined:"";console.log("switch language called after",this.searchTerm)}))}ngOnDestroy(){var e;(e=this.unRegisterSwitchLanguageEvent)===null||e===void 0?void 0:e.call(this)}onSearchTermChanged(e){this.searchTerm=e}isTabActive(){return this.tabData.tab.active}isMenuOpen(){return this.tabData.model.isOpen}loadPageContext(){return __awaiter(this,void 0,void 0,(function*(){if(this.pageInfo){return}const[e,t]=yield Promise.all([this.pageService.getCurrentPageInfo(),this.catalogService.retrieveUriContext()]);this.pageInfo=e;this.uriContext=t}))}};_t=__decorate([n.Component({selector:"se-component-types-tab",template:`<div class="se-component-menu__types-header"><se-component-search (onChange)="onSearchTermChanged($event)" [placeholderI18nKey]="'se.cms.componentmenu.search.type.placeholder'" class="se-component-menu__type-search"></se-component-search></div><div class="se-component-menu__result-container"><se-infinite-scrolling class="se-component-menu__infinite-scroll" *ngIf="isMenuOpen() || isTabActive()" [pageSize]="10" [mask]="searchTerm" [fetchPage]="loadComponentTypes" [context]="componentsContext"><div class="se-component-menu__result se-component-menu__result--types"><div class="se-component-menu__item-wrap" *ngFor="let componentType of componentsContext.items"><se-component-type [typeInfo]="componentType"></se-component-type></div></div></se-infinite-scrolling></div>`,styles:[`se-component-types-tab .se-component-menu__type-search{width:100%}se-component-types-tab .se-component-menu__result{display:grid;grid-template-columns:repeat(2,1fr)}se-component-types-tab .se-component-menu__infinite-scroll .se-infinite-scrolling__container{max-height:300px}se-component-types-tab .se-component-menu__types-header{padding:0 20px 16px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}se-component-types-tab .se-component-menu__types-header .fd-form__set{margin:0!important}se-component-types-tab .se-component-menu__input-group .se-input-group__addon[class*=sap-icon]{height:100%}`],encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(l.TAB_DATA)),__metadata("design:paramtypes",[Object,l.LogService,r.ComponentService,l.IPageService,l.ICatalogService,l.CrossFrameEventService,l.LanguageService])],_t);const yt={COMPONENT_TYPES_TAB_ID:"componentTypesTab",COMPONENTS_TAB_ID:"componentsTab"};window.__smartedit__.addDecoratorPayload("Component","ComponentMenuComponent",{selector:"se-component-menu",template:`<div class="se-component-menu" [ngClass]="{ 'se-component-menu__localized': hasMultipleContentCatalogs }"><div translate="se.cms.componentmenu.dropdown.header" class="se-component-menu__title"></div><div class="se-component-menu__tip" translate="se.cms.componentmenu.label.draganddrop"></div><se-tabs *ngIf="toolbarItem.isOpen" class="se-component-menu__tabs" [tabsList]="tabsList" [model]="model" [numTabsDisplayed]="2"></se-tabs></div>`,styles:[`se-component-menu .se-component-menu{width:640px;height:485px}se-component-menu .se-component-menu__tabs .se-tabset{margin:0 20px 20px}se-component-menu .se-component-menu__tip{font-size:.875rem!important;line-height:1.4285714286;font-weight:400;margin-bottom:16px;color:var(--sapNeutralColor);padding:0 20px}se-component-menu .se-component-menu__title{color:var(--sapTextColor);font-size:1rem!important;line-height:1.25;font-weight:400;padding:14px 20px 4px}`],encapsulation:n.ViewEncapsulation.None});t.ComponentMenuComponent=class ComponentMenuComponent{constructor(e,t,i){this.toolbarItem=e;this.crossFrameEventService=t;this.componentMenuService=i}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){yield this.initializeComponentMenu();this.unregisterPageChangeEvent=this.crossFrameEventService.subscribe(l.EVENTS.PAGE_CHANGE,(()=>this.initializeComponentMenu()));this.unregisterOpenComponentEvent=this.crossFrameEventService.subscribe(j,(()=>{this.resetComponentMenu(true)}));this.unregisterOverlapEvent=this.crossFrameEventService.subscribe(l.OVERLAY_DISABLED_EVENT,(()=>this.closeMenu()));this.unregisterDragStartEvent=this.crossFrameEventService.subscribe(l.SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_START,(()=>{this.isDragging=true;this.closeMenu()}));this.unregisterDragEndEvent=this.crossFrameEventService.subscribe(l.SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_END,(()=>{this.isDragging=false;this.crossFrameEventService.publish(l.DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.END)}))}))}ngDoCheck(){if(this.isOpenPreviousValue!==this.toolbarItem.isOpen){this.isOpenPreviousValue=this.toolbarItem.isOpen;if(this.toolbarItem.isOpen){this.crossFrameEventService.publish(l.DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.START)}else if(!this.toolbarItem.isOpen&&!this.isDragging){this.crossFrameEventService.publish(l.DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.END)}}}ngOnDestroy(){var e,t,i,o,n;(e=this.unregisterPageChangeEvent)===null||e===void 0?void 0:e.call(this);(t=this.unregisterOpenComponentEvent)===null||t===void 0?void 0:t.call(this);(i=this.unregisterDragStartEvent)===null||i===void 0?void 0:i.call(this);(o=this.unregisterOverlapEvent)===null||o===void 0?void 0:o.call(this);(n=this.unregisterDragEndEvent)===null||n===void 0?void 0:n.call(this)}initializeComponentMenu(){return __awaiter(this,void 0,void 0,(function*(){this.tabsList=null;this.hasMultipleContentCatalogs=yield this.componentMenuService.hasMultipleContentCatalogs();this.tabsList=[{id:yt.COMPONENT_TYPES_TAB_ID,title:"se.cms.compomentmenu.tabs.componenttypes",component:_t,hasErrors:false},{id:yt.COMPONENTS_TAB_ID,title:"se.cms.compomentmenu.tabs.customizedcomp",component:ht,hasErrors:false}];this.model={componentsTab:{hasMultipleContentCatalogs:this.hasMultipleContentCatalogs},isOpen:this.toolbarItem.isOpen};this.isOpenPreviousValue=this.toolbarItem.isOpen;this.resetComponentMenu(this.toolbarItem.isOpen)}))}resetComponentMenu(e){if(this.tabsList){if(!this.toolbarItem.isOpen){this.tabsList=this.tabsList.map((e=>Object.assign(Object.assign({},e),{active:e.id===yt.COMPONENT_TYPES_TAB_ID})))}this.model=Object.assign(Object.assign({},this.model),{isOpen:e});this.crossFrameEventService.publish(G)}}closeMenu(){if(this.toolbarItem){this.toolbarItem.isOpen=false}}};t.ComponentMenuComponent=__decorate([n.Component({selector:"se-component-menu",template:`<div class="se-component-menu" [ngClass]="{ 'se-component-menu__localized': hasMultipleContentCatalogs }"><div translate="se.cms.componentmenu.dropdown.header" class="se-component-menu__title"></div><div class="se-component-menu__tip" translate="se.cms.componentmenu.label.draganddrop"></div><se-tabs *ngIf="toolbarItem.isOpen" class="se-component-menu__tabs" [tabsList]="tabsList" [model]="model" [numTabsDisplayed]="2"></se-tabs></div>`,styles:[`se-component-menu .se-component-menu{width:640px;height:485px}se-component-menu .se-component-menu__tabs .se-tabset{margin:0 20px 20px}se-component-menu .se-component-menu__tip{font-size:.875rem!important;line-height:1.4285714286;font-weight:400;margin-bottom:16px;color:var(--sapNeutralColor);padding:0 20px}se-component-menu .se-component-menu__title{color:var(--sapTextColor);font-size:1rem!important;line-height:1.25;font-weight:400;padding:14px 20px 4px}`],encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(l.TOOLBAR_ITEM)),__metadata("design:paramtypes",[Object,l.CrossFrameEventService,l.ComponentMenuService])],t.ComponentMenuComponent);t.ComponentMenuModule=class ComponentMenuModule{};t.ComponentMenuModule=__decorate([n.NgModule({imports:[g.CommonModule,l.TooltipModule,l.TranslationModule.forChild(),s.FormsModule,l.SelectModule,l.InfiniteScrollingModule,l.L10nPipeModule,l.TabsModule],providers:[l.ComponentMenuService],declarations:[dt,pt,gt,ut,ht,_t,t.ComponentMenuComponent],entryComponents:[dt,pt,gt,ut,ht,_t,t.ComponentMenuComponent]})],t.ComponentMenuModule);window.__smartedit__.addDecoratorPayload("Component","ComponentRestrictionsEditorComponent",{selector:"se-component-restrictions-editor",template:`<se-restrictions-editor [editable]="isEditable" [getRestrictionTypes]="getRestrictionTypes" [getSupportedRestrictionTypes]="getSupportedRestrictionTypes" [item]="model" [restrictionUuids]="model.restrictions" (onRestrictionsChange)="onRestrictionsChange($event)"></se-restrictions-editor>`,changeDetection:n.ChangeDetectionStrategy.OnPush});t.ComponentRestrictionsEditorComponent=class ComponentRestrictionsEditorComponent{constructor(e,t,i){this.data=e;this.restrictionsService=t;this.restrictionTypesService=i;({editor:this.editor,field:this.field,model:this.model}=e);this.isEditable=!e.isFieldDisabled()}ngOnInit(){this.initGetRestrictionTypes();this.initGetSupportedRestrictionTypes();if(this.model.restrictions===undefined){this.editor.form.pristine.restrictions=[];this.editor.form.pristine.onlyOneRestrictionMustApply=false}}onRestrictionsChange({onlyOneRestrictionMustApply:e,restrictionUuids:t,alwaysEnableSubmit:i}){this.model.onlyOneRestrictionMustApply=e;this.model.restrictions=t;this.editor.api.setAlwaysEnableSubmit(i)}initGetRestrictionTypes(){this.getRestrictionTypes=()=>this.restrictionTypesService.getRestrictionTypes()}initGetSupportedRestrictionTypes(){this.getSupportedRestrictionTypes=()=>this.restrictionsService.getSupportedRestrictionTypeCodes()}};t.ComponentRestrictionsEditorComponent=__decorate([n.Component({selector:"se-component-restrictions-editor",template:`<se-restrictions-editor [editable]="isEditable" [getRestrictionTypes]="getRestrictionTypes" [getSupportedRestrictionTypes]="getSupportedRestrictionTypes" [item]="model" [restrictionUuids]="model.restrictions" (onRestrictionsChange)="onRestrictionsChange($event)"></se-restrictions-editor>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,t.RestrictionsService,t.RestrictionTypesService])],t.ComponentRestrictionsEditorComponent);window.__smartedit__.addDecoratorPayload("Component","ItemManagementComponent",{selector:"se-item-manager",template:`<div><se-generic-editor [id]="editorId" [smarteditComponentId]="itemId" [smarteditComponentType]="componentType" [structureApi]="structureApi" [content]="item" [contentApi]="contentApi" [(isDirty)]="isDirtyInternal" [(submit)]="submit" [uriContext]="uriContext" [reset]="reset"></se-generic-editor></div>`});let bt=class ItemManagementComponent{constructor(){this.supportedModes=["add","edit","create"];this.editorId="se-item-management-editor";this.isDirtyChange=new n.EventEmitter;this.submitFunctionChange=new n.EventEmitter;this.reset=true}ngOnInit(){this.validateMode();this.submitFunctionChange.emit((()=>this.submitInternal()));this.isDirtyChange.emit((()=>this.isDirtyLocal()));if(!this.componentType&&this.item){this.componentType=this.item.typeCode}if(!this.item){this.itemId=null}if(this.item&&this.item.uuid){this.itemId=this.item.uuid}else if(this.item&&this.item.uid){this.itemId=this.item.uid}}ngOnChanges(e){const t=e.item;if(t){this.itemId=null;if(this.item&&this.item.uuid){this.itemId=this.item.uuid}else if(this.item&&this.item.uid){this.itemId=this.item.uid}}}validateMode(){if(!this.supportedModes.includes(this.mode)){throw"ItemManagementComponent.ngOnInit() - Mode not supported: "+this.mode}}submitInternal(){switch(this.mode.toLowerCase()){case"add":return Promise.resolve(this.item);case"edit":return this.submit();case"create":return this.submit().then((e=>e));default:throw`ItemManagementController - The given mode [${this.mode}] has not been implemented for this component`}}isDirtyLocal(){if(this.isDirtyInternal){return this.isDirtyInternal()}return false}};__decorate([n.Input(),__metadata("design:type",Object)],bt.prototype,"item",void 0);__decorate([n.Input(),__metadata("design:type",Object)],bt.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",String)],bt.prototype,"mode",void 0);__decorate([n.Input(),__metadata("design:type",String)],bt.prototype,"contentApi",void 0);__decorate([n.Input(),__metadata("design:type",String)],bt.prototype,"structureApi",void 0);__decorate([n.Input(),__metadata("design:type",String)],bt.prototype,"componentType",void 0);__decorate([n.Input(),__metadata("design:type",Function)],bt.prototype,"isDirty",void 0);__decorate([n.Input(),__metadata("design:type",Function)],bt.prototype,"submitFunction",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],bt.prototype,"isDirtyChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],bt.prototype,"submitFunctionChange",void 0);bt=__decorate([n.Component({selector:"se-item-manager",template:`<div><se-generic-editor [id]="editorId" [smarteditComponentId]="itemId" [smarteditComponentType]="componentType" [structureApi]="structureApi" [content]="item" [contentApi]="contentApi" [(isDirty)]="isDirtyInternal" [(submit)]="submit" [uriContext]="uriContext" [reset]="reset"></se-generic-editor></div>`}),__metadata("design:paramtypes",[])],bt);class RestrictionManagementSelectModel{constructor(e,t,i,o){this.cmsitemsRestService=e;this.catalogService=t;this.fetchRestrictionTypes=i;this.getSupportedRestrictionTypes=o;this.selectedIds={};this.model={restrictionTypes:[],selectedRestrictionType:null};this.restrictions=[];this.supportedRestrictionTypes=[]}initialize(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.fetchRestrictionTypes();this.model.restrictionTypes=e.map(((e,t)=>Object.assign(Object.assign({},e),{id:t})));if(typeof this.getSupportedRestrictionTypes==="function"){this.supportedRestrictionTypes=yield this.getSupportedRestrictionTypes()}else{this.supportedRestrictionTypes=this.model.restrictionTypes.map((e=>e.code))}}))}getRestrictionsPaged(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o={pageSize:t,currentPage:i,typeCode:this.model.selectedRestrictionType.code,mask:e,itemSearchParams:""};if(i===0){this.restrictions=[]}const n=yield this.cmsitemsRestService.get(o);const s=n.response.map((e=>Object.assign(Object.assign({},e),{id:e.uid})));this.restrictions=this.restrictions.concat(s);return{pagination:n.pagination,results:s}}))}getRestrictionFromBackend(){return Promise.resolve({})}getRestrictionTypes(){return Promise.resolve(this.model.restrictionTypes)}restrictionSelected(){if(this.selectedIds.restriction){this.selectedRestriction=this.restrictions.find((e=>e.id===this.selectedIds.restriction));return true}return false}restrictionTypeSelected(){this.selectedIds.restriction=null;this.model.selectedRestrictionType=(this.model.restrictionTypes||[]).find((e=>e.id===this.selectedIds.restrictionType))||null;if(this.model.selectedRestrictionType){this.selectedRestriction={typeCode:this.model.selectedRestrictionType.code};return true}return false}createRestrictionSelected(e,t){return __awaiter(this,void 0,void 0,(function*(){this.selectedRestriction={itemtype:this.model.selectedRestrictionType.code,name:e};const i=yield this.catalogService.getCatalogVersionUUid(t);this.selectedRestriction.catalogVersion=i}))}getRestrictionTypeCode(){var e;return(e=this.model.selectedRestrictionType)===null||e===void 0?void 0:e.code}getRestriction(){return this.selectedRestriction}isTypeSupported(){if(this.getRestrictionTypeCode()){return this.supportedRestrictionTypes.includes(this.model.selectedRestrictionType.code)}return false}}let Et=class RestrictionManagementSelectModelFactory{constructor(e,t){this.cmsitemsRestService=e;this.catalogService=t}createRestrictionManagementSelectModel(e,t){const i=new RestrictionManagementSelectModel(this.cmsitemsRestService,this.catalogService,e,t);i.initialize();return i}};Et=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.CmsitemsRestService,l.ICatalogService])],Et);let wt=class RestrictionPickerConfigService{constructor(){this.MODE_EDITING="editing";this.MODE_SELECT="select"}getConfigForEditing(e,t){return{mode:this.MODE_EDITING,restriction:e,getSupportedRestrictionTypesFn:t}}getConfigForSelecting(e,t,i){return{mode:this.MODE_SELECT,getRestrictionTypesFn:t,getSupportedRestrictionTypesFn:i,existingRestrictions:e}}isEditingMode(e){return e.mode===this.MODE_EDITING}isSelectMode(e){return e.mode===this.MODE_SELECT}isValidConfig(e){switch(e.mode){case this.MODE_EDITING:return p.isObject(e.restriction);case this.MODE_SELECT:if(e.getSupportedRestrictionTypesFn){return p.isFunction(e.getRestrictionTypesFn)&&p.isFunction(e.getSupportedRestrictionTypesFn)}return p.isFunction(e.getRestrictionTypesFn);default:return false}}};wt=__decorate([n.Injectable()],wt);window.__smartedit__.addDecoratorPayload("Component","RestrictionManagementComponent",{selector:"se-restriction-management",template:`<div *ngIf="isReady"><div *ngIf="isEditMode"><se-restriction-management-edit [restriction]="config?.restriction" [getSupportedRestrictionTypes]="config?.getSupportedRestrictionTypesFn" [uriContext]="uriContext" [(isDirtyFn)]="isDirtyInternal" [(submitFn)]="submitInternal"></se-restriction-management-edit></div><div *ngIf="!isEditMode"><se-restriction-management-select [existingRestrictions]="config?.existingRestrictions" [fetchRestrictionTypes]="config?.getRestrictionTypesFn" [getSupportedRestrictionTypes]="config?.getSupportedRestrictionTypesFn" [uriContext]="uriContext" [(isDirtyFn)]="isDirtyInternal" [(submitFn)]="submitInternal"></se-restriction-management-select></div></div>`});let xt=class RestrictionManagementComponent{constructor(e){this.restrictionPickerConfigService=e;this.submitFnChange=new n.EventEmitter;this.isDirtyFnChange=new n.EventEmitter;this.isReady=false;this.isEditMode=false}ngOnInit(){setTimeout((()=>{this.submitFnChange.emit((()=>this.submitInternal().then((e=>e))));this.isDirtyFnChange.emit((()=>this.isDirtyInternal&&this.isDirtyInternal()))}))}ngOnChanges(){if(!this.config){return}if(this.restrictionPickerConfigService.isValidConfig(this.config)){this.isReady=true;this.isEditMode=this.restrictionPickerConfigService.isEditingMode(this.config)}else{throw"RestrictionManagementComponent - invalid restrictionPickerConfig"}}};__decorate([n.Input(),__metadata("design:type",Object)],xt.prototype,"config",void 0);__decorate([n.Input(),__metadata("design:type",Object)],xt.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Function)],xt.prototype,"submitFn",void 0);__decorate([n.Input(),__metadata("design:type",Function)],xt.prototype,"isDirtyFn",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],xt.prototype,"submitFnChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],xt.prototype,"isDirtyFnChange",void 0);xt=__decorate([n.Component({selector:"se-restriction-management",template:`<div *ngIf="isReady"><div *ngIf="isEditMode"><se-restriction-management-edit [restriction]="config?.restriction" [getSupportedRestrictionTypes]="config?.getSupportedRestrictionTypesFn" [uriContext]="uriContext" [(isDirtyFn)]="isDirtyInternal" [(submitFn)]="submitInternal"></se-restriction-management-edit></div><div *ngIf="!isEditMode"><se-restriction-management-select [existingRestrictions]="config?.existingRestrictions" [fetchRestrictionTypes]="config?.getRestrictionTypesFn" [getSupportedRestrictionTypes]="config?.getSupportedRestrictionTypesFn" [uriContext]="uriContext" [(isDirtyFn)]="isDirtyInternal" [(submitFn)]="submitInternal"></se-restriction-management-select></div></div>`}),__metadata("design:paramtypes",[wt])],xt);window.__smartedit__.addDecoratorPayload("Component","RestrictionManagementEditComponent",{selector:"se-restriction-management-edit",template:`<div *ngIf="ready"><div *ngIf="isTypeSupported"><div class="se-restriction-management-edit__header"><div>{{ restriction.name }}</div><div>{{ restriction.typeCode }}</div></div><div><se-item-manager [item]="restriction" [mode]="itemManagementMode" [structureApi]="structureApi" [contentApi]="contentApi" [uriContext]="uriContext" [componentType]="restriction.itemtype" [(submitFunction)]="submitInternal" [(isDirty)]="isDirtyInternal"></se-item-manager></div></div><div *ngIf="!isTypeSupported"><div class="se-restrictions-list__item-content"><div translate="se.cms.restriction.management.select.type.not.supported.warning"></div><p class="se-restriction__item-name">{{ restriction.name }}</p><div class="se-restriction__item-description">{{ restriction.description }}</div></div></div></div>`,styles:[`.se-restriction-management-edit__header{margin-bottom:16px}`,`#restrictions-label{display:none}.se-restriction__select{text-transform:capitalize;width:100%}.se-restrictions-list__item-content{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;cursor:default;flex-grow:1}#userGroups-selector .se-generic-editor-multiple-dropdown__match li[draggable=true]{display:flex;flex-direction:row;align-items:center;justify-content:center;display:inline-flex!important;border:1px solid var(--sapGroup_ContentBorderColor);margin:4px 0 4px 8px;padding:4px 8px;border-radius:4px;background-color:var(--fd-token-background-color);color:var(--sapNeutralColor);min-height:28px}`]});let Bt=class RestrictionManagementEditComponent{constructor(e){this.restrictionsService=e;this.isDirtyFnChange=new n.EventEmitter;this.submitFnChange=new n.EventEmitter;this.ready=false;this.itemManagementMode="edit";this.structureApi=this.restrictionsService.getStructureApiUri(this.itemManagementMode)}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=l.cmsitemsUri+"/:identifier";this.restriction=this.restriction||{};this.contentApi=new l.URIBuilder(e).replaceParams(this.uriContext).build();if(typeof this.getSupportedRestrictionTypes!=="undefined"){const e=yield this.getSupportedRestrictionTypes();return this.emitActions(e.includes(this.restriction.itemtype))}else{return this.emitActions(true)}}))}emitActions(e){this.isTypeSupported=e;if(e){this.submitFnChange.emit((()=>this.submitInternal().then((e=>Promise.resolve(e)))));this.isDirtyFnChange.emit((()=>this.isDirtyLocal()))}else{this.submitFnChange.emit((()=>Promise.resolve(null)));this.isDirtyFnChange.emit((()=>false))}this.ready=true}isDirtyLocal(){if(this.isDirtyInternal){return this.isDirtyInternal()}return false}};__decorate([n.Input(),__metadata("design:type",Object)],Bt.prototype,"restriction",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Bt.prototype,"getSupportedRestrictionTypes",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Bt.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Bt.prototype,"isDirtyFn",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Bt.prototype,"submitFn",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Bt.prototype,"isDirtyFnChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Bt.prototype,"submitFnChange",void 0);Bt=__decorate([n.Component({selector:"se-restriction-management-edit",template:`<div *ngIf="ready"><div *ngIf="isTypeSupported"><div class="se-restriction-management-edit__header"><div>{{ restriction.name }}</div><div>{{ restriction.typeCode }}</div></div><div><se-item-manager [item]="restriction" [mode]="itemManagementMode" [structureApi]="structureApi" [contentApi]="contentApi" [uriContext]="uriContext" [componentType]="restriction.itemtype" [(submitFunction)]="submitInternal" [(isDirty)]="isDirtyInternal"></se-item-manager></div></div><div *ngIf="!isTypeSupported"><div class="se-restrictions-list__item-content"><div translate="se.cms.restriction.management.select.type.not.supported.warning"></div><p class="se-restriction__item-name">{{ restriction.name }}</p><div class="se-restriction__item-description">{{ restriction.description }}</div></div></div></div>`,styles:[`.se-restriction-management-edit__header{margin-bottom:16px}`,`#restrictions-label{display:none}.se-restriction__select{text-transform:capitalize;width:100%}.se-restrictions-list__item-content{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;cursor:default;flex-grow:1}#userGroups-selector .se-generic-editor-multiple-dropdown__match li[draggable=true]{display:flex;flex-direction:row;align-items:center;justify-content:center;display:inline-flex!important;border:1px solid var(--sapGroup_ContentBorderColor);margin:4px 0 4px 8px;padding:4px 8px;border-radius:4px;background-color:var(--fd-token-background-color);color:var(--sapNeutralColor);min-height:28px}`]}),__metadata("design:paramtypes",[t.RestrictionsService])],Bt);window.__smartedit__.addDecoratorPayload("Component","RestrictionManagementSelectItemComponent",{selector:"se-restriction-management-select-item",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<span class="se-restriction-management-item-name">{{\n        data.item.name | seL10n | async\n    }}</span>`});let Kt=class RestrictionManagementSelectItemComponent{constructor(e){this.data=e}};Kt=__decorate([n.Component({selector:"se-restriction-management-select-item",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<span class="se-restriction-management-item-name">{{\n        data.item.name | seL10n | async\n    }}</span>`}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],Kt);window.__smartedit__.addDecoratorPayload("Component","RestrictionManagementSelectComponent",{selector:"se-restriction-management-select",template:`<div><se-message [style.display]="showWarningMessage() ? 'block' : 'none'" [type]="'warning'"><span se-message-title translate="se.cms.restriction.management.select.type.not.supported.warning"></span></se-message><div class="se-restriction-management-select__select"><label class="se-control-label">{{ 'se.cms.restriction.management.select.type.label' | translate }}</label><se-select id="restriction-type" [fetchStrategy]="fetchStrategy" [itemComponent]="itemComponent" [placeholder]="'se.cms.restriction.management.select.type.placeholder'" [(model)]="selectModel.selectedIds.restrictionType" (modelChange)="selectRestrictionType()" [searchEnabled]="false"></se-select></div><div *ngIf="viewConfig.showRestrictionSelector" class="se-restriction-management-select__restriction-info"><label class="se-control-label" translate="se.cms.restriction.management.select.restriction.label"></label><se-select id="restriction-name" [fetchStrategy]="fetchOptions" [(model)]="selectModel.selectedIds.restriction" (modelChange)="selectRestriction()" [placeholder]="'se.cms.restriction.management.select.restriction.placeholder'" [disableChoiceFn]="disableRestrictionChoice" [itemComponent]="itemComponent" [resultsHeaderLabel]="resultsHeaderLabel" [actionableSearchItem]="actionableSearchItem" [(reset)]="reset"></se-select></div><div class="se-restriction-management-select__restriction-editor" *ngIf="viewConfig.showRestrictionEditor"><p class="se-restriction-management-select__new-restriction-message" [translate]="editorHeader"></p><div *ngIf="selectModel.isTypeSupported()"><se-item-manager [item]="selectModel.getRestriction()" [mode]="viewConfig.mode" [structureApi]="viewConfig.structureApi" [contentApi]="viewConfig.contentApi" [uriContext]="uriContext" [componentType]="selectModel.getRestrictionTypeCode()" [(submitFunction)]="submitInternal" [(isDirty)]="isDirtyInternal"></se-item-manager></div><div *ngIf="!selectModel.isTypeSupported()"><p class="se-restriction__item-name">{{ selectModel.getRestriction().name }}</p><div class="se-restriction__item-description">{{ selectModel.getRestriction().description }}</div></div></div></div>`,styles:[`se-restriction-management-select .se-restriction-management-select__restriction-info,se-restriction-management-select .se-restriction-management-select__select{margin-bottom:16px}se-restriction-management-select .se-restriction-management-select__restriction-editor{border-top:1px solid var(--sapGroup_ContentBorderColor);padding-top:16px}se-restriction-management-select .se-restriction-management-select__new-restriction-message{font-weight:700}se-restriction-management-select .fd-menu__list-header{font-size:1rem!important;line-height:1.25;font-weight:400;padding:8px 12px;border-bottom:1px solid var(--sapGroup_ContentBorderColor);color:var(--sapNeutralColor);list-style:none;padding-left:24px}se-restriction-management-select .se-select-list__item.is-disabled{opacity:.65}se-restriction-management-select .se-select-list__item.is-disabled .fd-menu__item{cursor:not-allowed}se-restriction-management-select div.se-actionable-search-item{display:flex;align-items:center;justify-content:space-between;padding:0 0 0 13px}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let Xt=class RestrictionManagementSelectComponent{constructor(e,t,i,o){this.restrictionManagementSelectModelFactory=e;this.restrictionsService=t;this.systemEventService=i;this.cdr=o;this.RESTRICTION_CREATE_BUTTON_PRESSED_EVENT_ID="RESTRICTION_CREATE_BUTTON_PRESSED_EVENT_ID";this.resultsHeaderLabel="se.cms.restrictionmanagement.restrictionresults.header";this.itemComponent=Kt;this.editorHeader="";this.isDirtyFnChange=new n.EventEmitter;this.submitFnChange=new n.EventEmitter}ngOnInit(){this.selectModel=this.restrictionManagementSelectModelFactory.createRestrictionManagementSelectModel(this.fetchRestrictionTypes,this.getSupportedRestrictionTypes);const e=l.cmsitemsUri+"/:identifier";this.viewConfig={showRestrictionSelector:false,showRestrictionEditor:false,mode:"add",contentApi:new l.URIBuilder(e).replaceParams(this.uriContext).build()};this.fetchOptions={fetchPage:(e,t,i)=>this.selectModel.getRestrictionsPaged(e,t,i),fetchEntity:()=>this.selectModel.getRestrictionFromBackend()};this.fetchStrategy={fetchAll:()=>this.selectModel.getRestrictionTypes()};this.disableRestrictionChoice=e=>!!this.existingRestrictions.find((t=>e.uid===t.uid));setTimeout((()=>{this.submitFnChange.emit((()=>__awaiter(this,void 0,void 0,(function*(){if(this.selectModel.isTypeSupported()){return this.submitInternal().then((e=>e))}return this.selectModel.getRestriction()}))));this.isDirtyFnChange.emit((()=>{if(this.viewConfig.mode==="add"){return this.viewConfig.showRestrictionEditor}else if(this.isDirtyInternal){return this.isDirtyInternal()}return false}))}));this.createButtonUnsubscribe=this.systemEventService.subscribe(this.RESTRICTION_CREATE_BUTTON_PRESSED_EVENT_ID,((e,t)=>this.createButtonEventHandler(t)))}ngOnDestroy(){if(this.createButtonUnsubscribe){this.createButtonUnsubscribe()}}selectRestrictionType(){if(this.selectModel.restrictionTypeSelected()){if(this.viewConfig.showRestrictionSelector){this.resetSelector()}else{this.viewConfig.showRestrictionSelector=true}this.viewConfig.showRestrictionEditor=false}this.actionableSearchItem=this.selectModel.isTypeSupported()?{eventId:this.RESTRICTION_CREATE_BUTTON_PRESSED_EVENT_ID}:undefined}selectRestriction(){if(this.selectModel.restrictionSelected()){this.setViewConfig("se.cms.restriction.management.select.editor.header.add","add");if(!this.viewConfig.showRestrictionEditor){this.viewConfig.showRestrictionEditor=true}}}createRestriction(e){return __awaiter(this,void 0,void 0,(function*(){yield this.selectModel.createRestrictionSelected(e,this.uriContext);this.setViewConfig("se.cms.restriction.management.select.editor.header.create","create");if(this.viewConfig.showRestrictionEditor){this.resetSelector()}else{this.viewConfig.showRestrictionEditor=true}if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}showWarningMessage(){return this.selectModel.getRestriction()&&!this.selectModel.isTypeSupported()}createButtonEventHandler(e){this.createRestriction(e)}resetSelector(){if(typeof this.reset==="function"){this.reset(true)}}setViewConfig(e,t){this.editorHeader=e;this.viewConfig.mode=t;this.viewConfig.structureApi=this.restrictionsService.getStructureApiUri(this.viewConfig.mode)}};__decorate([n.Input(),__metadata("design:type",Object)],Xt.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Array)],Xt.prototype,"existingRestrictions",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Xt.prototype,"fetchRestrictionTypes",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Xt.prototype,"getSupportedRestrictionTypes",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Xt.prototype,"isDirtyFn",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Xt.prototype,"submitFn",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Xt.prototype,"isDirtyFnChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Xt.prototype,"submitFnChange",void 0);Xt=__decorate([n.Component({selector:"se-restriction-management-select",template:`<div><se-message [style.display]="showWarningMessage() ? 'block' : 'none'" [type]="'warning'"><span se-message-title translate="se.cms.restriction.management.select.type.not.supported.warning"></span></se-message><div class="se-restriction-management-select__select"><label class="se-control-label">{{ 'se.cms.restriction.management.select.type.label' | translate }}</label><se-select id="restriction-type" [fetchStrategy]="fetchStrategy" [itemComponent]="itemComponent" [placeholder]="'se.cms.restriction.management.select.type.placeholder'" [(model)]="selectModel.selectedIds.restrictionType" (modelChange)="selectRestrictionType()" [searchEnabled]="false"></se-select></div><div *ngIf="viewConfig.showRestrictionSelector" class="se-restriction-management-select__restriction-info"><label class="se-control-label" translate="se.cms.restriction.management.select.restriction.label"></label><se-select id="restriction-name" [fetchStrategy]="fetchOptions" [(model)]="selectModel.selectedIds.restriction" (modelChange)="selectRestriction()" [placeholder]="'se.cms.restriction.management.select.restriction.placeholder'" [disableChoiceFn]="disableRestrictionChoice" [itemComponent]="itemComponent" [resultsHeaderLabel]="resultsHeaderLabel" [actionableSearchItem]="actionableSearchItem" [(reset)]="reset"></se-select></div><div class="se-restriction-management-select__restriction-editor" *ngIf="viewConfig.showRestrictionEditor"><p class="se-restriction-management-select__new-restriction-message" [translate]="editorHeader"></p><div *ngIf="selectModel.isTypeSupported()"><se-item-manager [item]="selectModel.getRestriction()" [mode]="viewConfig.mode" [structureApi]="viewConfig.structureApi" [contentApi]="viewConfig.contentApi" [uriContext]="uriContext" [componentType]="selectModel.getRestrictionTypeCode()" [(submitFunction)]="submitInternal" [(isDirty)]="isDirtyInternal"></se-item-manager></div><div *ngIf="!selectModel.isTypeSupported()"><p class="se-restriction__item-name">{{ selectModel.getRestriction().name }}</p><div class="se-restriction__item-description">{{ selectModel.getRestriction().description }}</div></div></div></div>`,styles:[`se-restriction-management-select .se-restriction-management-select__restriction-info,se-restriction-management-select .se-restriction-management-select__select{margin-bottom:16px}se-restriction-management-select .se-restriction-management-select__restriction-editor{border-top:1px solid var(--sapGroup_ContentBorderColor);padding-top:16px}se-restriction-management-select .se-restriction-management-select__new-restriction-message{font-weight:700}se-restriction-management-select .fd-menu__list-header{font-size:1rem!important;line-height:1.25;font-weight:400;padding:8px 12px;border-bottom:1px solid var(--sapGroup_ContentBorderColor);color:var(--sapNeutralColor);list-style:none;padding-left:24px}se-restriction-management-select .se-select-list__item.is-disabled{opacity:.65}se-restriction-management-select .se-select-list__item.is-disabled .fd-menu__item{cursor:not-allowed}se-restriction-management-select div.se-actionable-search-item{display:flex;align-items:center;justify-content:space-between;padding:0 0 0 13px}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[Et,t.RestrictionsService,l.SystemEventService,n.ChangeDetectorRef])],Xt);window.__smartedit__.addDecoratorPayload("Component","RestrictionsTableComponent",{selector:"se-restrictions-table",template:`<div class="se-restriction-table-wrapper se-restriction-table-left" [ngClass]="customClass"><div class="se-restrictions-list fd-menu__list--separated" *ngIf="restrictions.length > 0"><div id="restriction-{{ index + 1 }}" *ngFor="let restriction of restrictions; let index = index" class="se-restriction__item fd-menu__item"><div class="se-restrictions-list__item-content"><p class="se-restriction__item-name" [ngClass]="{ 'error-input': isInError(index) }">{{ restriction.name }}</p><div class="se-restriction__item-type-and-id" [ngClass]="{ 'error-input': isInError(index) }">{{ restriction.typeCode }}</div><div class="se-restriction__item-description" [ngClass]="{ 'error-input': isInError(index) }" [title]="restriction.description">{{ restriction.description }}</div><div id="restrictionPartOfWorkflow" *ngIf="restriction.canBeEdited!==undefined && !restriction.canBeEdited" translate="se.cms.restrictions.editor.part.of.workflow"></div></div><div *ngIf="editable"><se-dropdown-menu [dropdownItems]="restriction.actions || defaultActions" [selectedItem]="restriction" [placement]="'bottom-start'"></se-dropdown-menu></div></div></div><div *ngIf="restrictions.length === 0" class="se-restrictions-list--empty"><span class="se-restrictions-list--empty__message" translate="se.cms.restrictions.emptylist.message"></span></div></div>`,styles:[`.se-restrictions-list .se-restriction__item{position:static;display:flex;flex-direction:row;align-items:center;justify-content:space-between;cursor:default;border-top-color:var(--sapList_GroupHeaderBorderColor)!important;border-top:solid;border-radius:unset;padding:20px}.se-restrictions-list .se-restriction__item:last-child{margin-bottom:42px}.se-restrictions-list .se-restriction__item:first-child{border-top-width:0}.se-restriction__item-name{font-weight:700;color:var(--sapTextColor);margin:0}.se-restriction__item-type-and-id{color:var(--sapNeutralColor);margin-top:0}.se-restriction__item-description{text-overflow:ellipsis;white-space:initial;overflow:hidden;word-break:break-all;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapNeutralColor);width:90%}.se-restrictions-list--empty__message{color:var(--sapNeutralColor)}.se-restrictions-list__item-content{width:95%}.error-input.se-restriction__item-description,.error-input.se-restriction__item-name,.error-input.se-restriction__item-type-and-id{color:var(--sapErrorColor)}`]});let ei=class RestrictionsTableComponent{constructor(e){this.pageRestrictionsCriteriaService=e;this.REMOVE_RESTRICTION_KEY="se.cms.restrictions.item.remove";this.EDIT_RESTRICTION_KEY="se.cms.restrictions.item.edit";this.onEdit=new n.EventEmitter;this.onRemove=new n.EventEmitter;this.errors=[];this.criteriaOptions=[];this.defaultActions=[];this.oldRestrictionsEditability=[]}ngOnInit(){this.oldRestrictionsEditability=this.getRestrictionsEditability(this.restrictions);this.defaultActions=this.getDefaultActions();this.provideActionsForRestrictions();this.criteriaOptions=this.pageRestrictionsCriteriaService.getRestrictionCriteriaOptions();this.resetRestrictionCriteria()}ngOnChanges(){if(this.restrictionsEditabilityChanged(this.restrictions)){this.provideActionsForRestrictions();this.oldRestrictionsEditability=this.getRestrictionsEditability(this.restrictions)}this.resetRestrictionCriteria()}resetRestrictionCriteria(){if(!this.restrictions||this.restrictions.length<2){this.restrictionCriteria=this.criteriaOptions[0]}}removeRestriction(e){const t=this.restrictions.findIndex((t=>t.uuid===e.uuid));this.onRemove.emit(t);this.removeUnnecessaryError(t);this.modifyErrorPositions(t)}editRestriction(e){this.onEdit.emit(e)}isInError(e){var t;return!!((t=this.errors)===null||t===void 0?void 0:t.some((t=>t.position===e)))}getRestrictionsEditability(e){return(e||[]).map((e=>e.canBeEdited))}modifyErrorPositions(e){this.errors=this.errors.map((t=>{if(t.position>=e){t.position=t.position-1}return t}))}removeUnnecessaryError(e){const t=this.errors.findIndex((t=>t.position===e));if(t>-1){this.errors=this.errors.filter(((e,i)=>i!==t))}}getDefaultActions(){return[{key:this.EDIT_RESTRICTION_KEY,callback:e=>this.editRestriction(e)},{key:this.REMOVE_RESTRICTION_KEY,callback:e=>this.removeRestriction(e),customCss:"se-dropdown-item__delete"}]}getRestrictionActions(e){const t=this.getDefaultActions();if(!e.canBeEdited){return t.filter((e=>e.key!==this.EDIT_RESTRICTION_KEY))}return t}provideActionsForRestrictions(){(this.restrictions||[]).forEach((e=>{e.actions=this.getRestrictionActions(e)}))}restrictionsEditabilityChanged(e){const t=this.getRestrictionsEditability(e);return!p.isEqual(t,this.oldRestrictionsEditability)}};__decorate([n.Input(),__metadata("design:type",Array)],ei.prototype,"restrictions",void 0);__decorate([n.Input(),__metadata("design:type",String)],ei.prototype,"customClass",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],ei.prototype,"editable",void 0);__decorate([n.Input(),__metadata("design:type",Object)],ei.prototype,"restrictionCriteria",void 0);__decorate([n.Input(),__metadata("design:type",Array)],ei.prototype,"errors",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],ei.prototype,"onEdit",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],ei.prototype,"onRemove",void 0);ei=__decorate([n.Component({selector:"se-restrictions-table",template:`<div class="se-restriction-table-wrapper se-restriction-table-left" [ngClass]="customClass"><div class="se-restrictions-list fd-menu__list--separated" *ngIf="restrictions.length > 0"><div id="restriction-{{ index + 1 }}" *ngFor="let restriction of restrictions; let index = index" class="se-restriction__item fd-menu__item"><div class="se-restrictions-list__item-content"><p class="se-restriction__item-name" [ngClass]="{ 'error-input': isInError(index) }">{{ restriction.name }}</p><div class="se-restriction__item-type-and-id" [ngClass]="{ 'error-input': isInError(index) }">{{ restriction.typeCode }}</div><div class="se-restriction__item-description" [ngClass]="{ 'error-input': isInError(index) }" [title]="restriction.description">{{ restriction.description }}</div><div id="restrictionPartOfWorkflow" *ngIf="restriction.canBeEdited!==undefined && !restriction.canBeEdited" translate="se.cms.restrictions.editor.part.of.workflow"></div></div><div *ngIf="editable"><se-dropdown-menu [dropdownItems]="restriction.actions || defaultActions" [selectedItem]="restriction" [placement]="'bottom-start'"></se-dropdown-menu></div></div></div><div *ngIf="restrictions.length === 0" class="se-restrictions-list--empty"><span class="se-restrictions-list--empty__message" translate="se.cms.restrictions.emptylist.message"></span></div></div>`,styles:[`.se-restrictions-list .se-restriction__item{position:static;display:flex;flex-direction:row;align-items:center;justify-content:space-between;cursor:default;border-top-color:var(--sapList_GroupHeaderBorderColor)!important;border-top:solid;border-radius:unset;padding:20px}.se-restrictions-list .se-restriction__item:last-child{margin-bottom:42px}.se-restrictions-list .se-restriction__item:first-child{border-top-width:0}.se-restriction__item-name{font-weight:700;color:var(--sapTextColor);margin:0}.se-restriction__item-type-and-id{color:var(--sapNeutralColor);margin-top:0}.se-restriction__item-description{text-overflow:ellipsis;white-space:initial;overflow:hidden;word-break:break-all;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapNeutralColor);width:90%}.se-restrictions-list--empty__message{color:var(--sapNeutralColor)}.se-restrictions-list__item-content{width:95%}.error-input.se-restriction__item-description,.error-input.se-restriction__item-name,.error-input.se-restriction__item-type-and-id{color:var(--sapErrorColor)}`]}),__metadata("design:paramtypes",[t.PageRestrictionsCriteriaService])],ei);window.__smartedit__.addDecoratorPayload("Component","RestrictionEditorCriteriaSelectItemComponent",{selector:"se-restriction-editor-criteria-select-item",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<span [translate]="data.item.editLabel"></span>`});let ti=class RestrictionEditorCriteriaSelectItemComponent{constructor(e){this.data=e}};ti=__decorate([n.Component({selector:"se-restriction-editor-criteria-select-item",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<span [translate]="data.item.editLabel"></span>`}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],ti);const ii="se-item-management-editor";window.__smartedit__.addDecoratorPayload("Component","RestrictionsEditorComponent",{selector:"se-restrictions-editor",template:`<div class="se-restrictions-container"><div class="se-restrictions-container__header" [ngClass]="{ 'se-restrictions-container__header--empty': restrictions.length === 0 }"><label class="se-restrictions__sub-header" translate="se.cms.restrictions.list.title"></label><div class="se-restrictions-container__header--right"><div *ngIf="restrictions.length > 1"><div *ngIf="editable"><se-select id="criteria-type" [fetchStrategy]="criteriaFetchStrategy" [itemComponent]="itemComponent" [placeholder]="'se.cms.restrictions.picker.type.placeholder'" [model]="criteria.id" (modelChange)="matchCriteriaChanged($event)" [searchEnabled]="false"></se-select></div><div *ngIf="!editable">{{ 'se.cms.restrictions.criteria' | translate }} {{ criteria.label | translate }}</div></div><button fd-button *ngIf="!showRestrictionPicker" type="button" class="se-restrictions__add-restriction-btn fd-button fd-button--cozy" [disabled]="!editable" (click)="onAddRestriction()"><span translate="se.cms.restrictions.editor.button.add.new"></span></button> <button fd-button class="cms-clean-btn se-restriction__clear-all__btn fd-button fd-button--transparent" *ngIf="showRemoveAllButton()" (click)="removeAllRestrictions()" label="{{ 'se.cms.restrictions.list.clear.all' | translate}}"></button></div></div><se-slider-panel [sliderPanelConfiguration]="sliderPanelConfiguration" [(sliderPanelHide)]="sliderPanelHide" [(sliderPanelShow)]="sliderPanelShow" (isShownChange)="onSliderVisibilityChange($event)" class="se-add-restriction-panel"><se-restriction-management *ngIf="isSliderVisible" class="se-se-add-restriction-panel__restriction-management" [config]="restrictionManagement.config" [uriContext]="restrictionManagement.uriContext" [(submitFn)]="restrictionManagement.submitFn" [(isDirtyFn)]="restrictionManagement.isDirtyFn"></se-restriction-management></se-slider-panel><div *ngIf="errors.length > 0"><span class="se-help-block--has-error help-block fd-form__message fd-form__message--error" *ngFor="let error of errors" [translate]="error.message"></span></div><se-restrictions-table *ngIf="isRestrictionsReady" [editable]="editable" [restrictions]="restrictions" [restrictionCriteria]="criteria" [errors]="errors" [customClass]="'ySERestrictionListLink'" (onEdit)="onEditRestriction($event)" (onRemove)="onRemoveRestriction($event)"></se-restrictions-table></div>`,styles:[`.se-restrictions-container__header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);padding-bottom:12px}.se-restrictions-container__header--right{display:flex;flex-direction:row;align-items:center}.se-restrictions-container__header--right>div,.se-restrictions-container__header--right>span{margin-left:12px;margin-right:16px;width:125px}.se-restrictions-container__header--empty{border-bottom:none}.se-restrictions__sub-header{font-weight:700;align-self:flex-start;color:var(--sapNeutralColor);margin:0}.se-restriction__clear-all__btn{text-transform:capitalize}`]});let oi=class RestrictionsEditorComponent{constructor(e,t,i,o,s,a,r){this.logService=e;this.systemEventService=t;this.restrictionPickerConfigService=i;this.pageRestrictionsCriteriaService=o;this.contextAwareEditableItemService=s;this.cmsitemsRestService=a;this.cdr=r;this.cancelFnChange=new n.EventEmitter;this.isDirtyFnChange=new n.EventEmitter;this.onRestrictionsChange=new n.EventEmitter;this.resetFnChange=new n.EventEmitter;this.errors=[];this.restrictions=[];this.originalRestrictions=[];this.restrictionUuids=[];this.isRestrictionsReady=false;this.restrictionsArrayIsDirty=false;this.showRestrictionPicker=false;this.disableAddButton=false;this.criteriaOptions=[];this.criteria={};this.itemComponent=ti;this.matchCriteriaIsDirty=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.restrictionUuids=this.restrictionUuids||[];const e=yield this.cmsitemsRestService.getByIdsNoCache(this.restrictionUuids,"FULL");const t=2;this.restrictions=e.response?e.response:[e];this.criteriaFetchStrategy={fetchAll:()=>Promise.resolve(this.criteriaOptions)};this.prepareRestrictionsCriteria();yield this.setupResults();this.sliderPanelConfiguration={modal:{showDismissButton:true,title:"",cancel:{label:"se.cms.restriction.management.panel.button.cancel",onClick:()=>{this.sliderPanelHide()},isDisabledFn:()=>false},save:{onClick:()=>{},label:"",isDisabledFn:()=>false}},cssSelector:"#y-modal-dialog"};this.restrictionManagement={uriContext:this.item.uriContext,submitFn:null,isDirtyFn:null,config:null};this.isDirtyFnChange.emit((()=>this.restrictionsArrayIsDirty||this.matchCriteriaIsDirty&&this.restrictionUuids.length>=t));this.resetFnChange.emit((()=>true));this.cancelFnChange.emit((()=>Promise.resolve(true)));this.initEvents();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnDestroy(){this.clearEvents()}ngOnChanges(e){return __awaiter(this,void 0,void 0,(function*(){if(!e.restrictionUuids){return Promise.resolve()}this.restrictionsArrayIsDirty=!e.restrictionUuids.firstChange&&JSON.stringify(this.originalRestrictions)!==JSON.stringify(this.restrictions);const t=!p.isEqual(e.restrictionUuids.previousValue,e.restrictionUuids.currentValue);if(t){this.indexRestrictions()}return this.applyIsRestrictionEditable()}))}onAddRestriction(){this.setSliderConfigForAddOrCreate();this.restrictionManagement.config=this.restrictionPickerConfigService.getConfigForSelecting([...this.restrictions],this.getRestrictionTypes,this.getSupportedRestrictionTypes);this.sliderPanelShow()}onEditRestriction(e){this.setSliderConfigForEditing();this.restrictionManagement.config=this.restrictionPickerConfigService.getConfigForEditing(Object.assign({},e),this.getSupportedRestrictionTypes);this.sliderPanelShow()}onRemoveRestriction(e){this.restrictions=this.restrictions.filter(((t,i)=>i!==e));this.updateRestrictionsData()}removeAllRestrictions(){this.restrictions=[];if(this.removeValidationMessages){this.removeValidationMessages()}this.updateRestrictionsData()}showRemoveAllButton(){return this.restrictionUuids.length>0&&this.editable}matchCriteriaChanged(e){this.criteria=this.criteriaOptions.find((t=>t.id===e));this.matchCriteriaIsDirty=this.criteria!==this.originalCriteria;this.updateRestrictionsData()}onSliderVisibilityChange(e){this.isSliderVisible=e}setupResults(){return __awaiter(this,void 0,void 0,(function*(){this.indexRestrictions();this.originalRestrictions=this.cloneRestrictions(this.restrictions);this.updateRestrictionsData();yield this.applyIsRestrictionEditable();this.isRestrictionsReady=true}))}updateRestrictionsData(e=false){this.onRestrictionsChange.emit({onlyOneRestrictionMustApply:this.criteria.value,restrictionUuids:this.restrictions.map((e=>e.uuid)),alwaysEnableSubmit:e})}prepareRestrictionsCriteria(){this.criteriaOptions=this.pageRestrictionsCriteriaService.getRestrictionCriteriaOptions();if(!!this.item.onlyOneRestrictionMustApply){this.criteria=this.criteriaOptions[1];this.originalCriteria=this.criteriaOptions[1]}else{this.criteria=this.criteriaOptions[0];this.originalCriteria=this.criteriaOptions[0]}}isRestrictionRelatedError(e){return p.includes(e.subject,"restrictions")}formatRestrictionRelatedError(e){const t=p.clone(e);if(!l.stringUtils.isBlank(t.position)){t.position=parseInt(t.position,10)}if(!l.stringUtils.isBlank(t.subject)){t.subject=t.subject.split(".").pop()}return t}handleUnrelatedValidationErrors(e){this.errors=e.messages.filter((e=>this.isRestrictionRelatedError(e))).map((e=>this.formatRestrictionRelatedError(e)))}propagateErrors(e){var t;return __awaiter(this,void 0,void 0,(function*(){const i=((t=this.restrictionManagement.config)===null||t===void 0?void 0:t.mode)===this.restrictionPickerConfigService.MODE_EDITING&&e===ii;if(!i){return}const o=this.restrictionManagement.config.restriction.restrictionIndex;const n=this.errors.filter((e=>e.position===o));this.clearEvents();yield this.systemEventService.publishAsync(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,{messages:n,targetGenericEditorId:e});this.initEvents()}))}indexRestrictions(){this.restrictions=(this.restrictions||[]).map(((e,t)=>Object.assign(Object.assign({},e),{restrictionIndex:t})))}cloneRestrictions(e){return p.cloneDeep(e)}initEvents(){this.unregisterErrorListener=this.systemEventService.subscribe(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,((e,t)=>this.handleUnrelatedValidationErrors(t)));this.unregisterErrorPropagationEvent=this.systemEventService.subscribe(l.GENERIC_EDITOR_LOADED_EVENT,((e,t)=>this.propagateErrors(t)))}clearEvents(){try{this.unregisterErrorListener();this.unregisterErrorPropagationEvent()}catch(e){}}applyIsRestrictionEditable(){return __awaiter(this,void 0,void 0,(function*(){this.restrictions=yield Promise.all(this.restrictions.map((e=>__awaiter(this,void 0,void 0,(function*(){if(e.uid){e.canBeEdited=yield this.contextAwareEditableItemService.isItemEditable(e.uid);if(!this.cdr.destroyed){this.cdr.detectChanges()}return e}e.canBeEdited=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}return e})))))}))}setSliderConfigForAddOrCreate(){this.sliderPanelConfiguration.modal.title="se.cms.restriction.management.panel.title.add";this.sliderPanelConfiguration.modal.save.label="se.cms.restriction.management.panel.button.add";this.sliderPanelConfiguration.modal.save.isDisabledFn=()=>{if(this.disableAddButton){return true}if(this.restrictionManagement.isDirtyFn){return!this.restrictionManagement.isDirtyFn()}return true};this.sliderPanelConfiguration.modal.save.onClick=()=>__awaiter(this,void 0,void 0,(function*(){try{this.disableAddButton=true;const e=yield this.restrictionManagement.submitFn();this.disableAddButton=false;this.restrictions=this.restrictions.concat(e);this.updateRestrictionsData();this.sliderPanelHide()}catch(e){this.disableAddButton=false;this.logService.warn("RestrictionsEditorComponent.setSliderConfigForAddOrCreate - Failed to create restriction")}}))}setSliderConfigForEditing(){this.sliderPanelConfiguration.modal.title="se.cms.restriction.management.panel.title.edit";this.sliderPanelConfiguration.modal.save.label="se.cms.restriction.management.panel.button.save";this.sliderPanelConfiguration.modal.save.isDisabledFn=()=>{if(this.restrictionManagement.isDirtyFn){return!this.restrictionManagement.isDirtyFn()}return true};this.sliderPanelConfiguration.modal.save.onClick=()=>__awaiter(this,void 0,void 0,(function*(){const e=yield this.restrictionManagement.submitFn();if(this.restrictionManagement.config){const t=this.restrictionManagement.config.restriction;e.restrictionIndex=t.restrictionIndex}const t=e.restrictionIndex;if(t!==-1){this.restrictions=this.restrictions.map(((i,o)=>{if(o===t){return e}return i}))}else{throw new Error("RestrictionsEditorComponent - edited restriction not found in list: "+e)}this.updateRestrictionsData(true);this.sliderPanelHide()}))}};__decorate([n.Input(),__metadata("design:type",Object)],oi.prototype,"item",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],oi.prototype,"editable",void 0);__decorate([n.Input(),__metadata("design:type",Function)],oi.prototype,"resetFn",void 0);__decorate([n.Input(),__metadata("design:type",Function)],oi.prototype,"cancelFn",void 0);__decorate([n.Input(),__metadata("design:type",Function)],oi.prototype,"isDirtyFn",void 0);__decorate([n.Input(),__metadata("design:type",Function)],oi.prototype,"getRestrictionTypes",void 0);__decorate([n.Input(),__metadata("design:type",Function)],oi.prototype,"getSupportedRestrictionTypes",void 0);__decorate([n.Input(),__metadata("design:type",Function)],oi.prototype,"removeValidationMessages",void 0);__decorate([n.Input(),__metadata("design:type",Array)],oi.prototype,"restrictionUuids",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],oi.prototype,"onRestrictionsChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],oi.prototype,"resetFnChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],oi.prototype,"cancelFnChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],oi.prototype,"isDirtyFnChange",void 0);oi=__decorate([n.Component({selector:"se-restrictions-editor",template:`<div class="se-restrictions-container"><div class="se-restrictions-container__header" [ngClass]="{ 'se-restrictions-container__header--empty': restrictions.length === 0 }"><label class="se-restrictions__sub-header" translate="se.cms.restrictions.list.title"></label><div class="se-restrictions-container__header--right"><div *ngIf="restrictions.length > 1"><div *ngIf="editable"><se-select id="criteria-type" [fetchStrategy]="criteriaFetchStrategy" [itemComponent]="itemComponent" [placeholder]="'se.cms.restrictions.picker.type.placeholder'" [model]="criteria.id" (modelChange)="matchCriteriaChanged($event)" [searchEnabled]="false"></se-select></div><div *ngIf="!editable">{{ 'se.cms.restrictions.criteria' | translate }} {{ criteria.label | translate }}</div></div><button fd-button *ngIf="!showRestrictionPicker" type="button" class="se-restrictions__add-restriction-btn fd-button fd-button--cozy" [disabled]="!editable" (click)="onAddRestriction()"><span translate="se.cms.restrictions.editor.button.add.new"></span></button> <button fd-button class="cms-clean-btn se-restriction__clear-all__btn fd-button fd-button--transparent" *ngIf="showRemoveAllButton()" (click)="removeAllRestrictions()" label="{{ 'se.cms.restrictions.list.clear.all' | translate}}"></button></div></div><se-slider-panel [sliderPanelConfiguration]="sliderPanelConfiguration" [(sliderPanelHide)]="sliderPanelHide" [(sliderPanelShow)]="sliderPanelShow" (isShownChange)="onSliderVisibilityChange($event)" class="se-add-restriction-panel"><se-restriction-management *ngIf="isSliderVisible" class="se-se-add-restriction-panel__restriction-management" [config]="restrictionManagement.config" [uriContext]="restrictionManagement.uriContext" [(submitFn)]="restrictionManagement.submitFn" [(isDirtyFn)]="restrictionManagement.isDirtyFn"></se-restriction-management></se-slider-panel><div *ngIf="errors.length > 0"><span class="se-help-block--has-error help-block fd-form__message fd-form__message--error" *ngFor="let error of errors" [translate]="error.message"></span></div><se-restrictions-table *ngIf="isRestrictionsReady" [editable]="editable" [restrictions]="restrictions" [restrictionCriteria]="criteria" [errors]="errors" [customClass]="'ySERestrictionListLink'" (onEdit)="onEditRestriction($event)" (onRemove)="onRemoveRestriction($event)"></se-restrictions-table></div>`,styles:[`.se-restrictions-container__header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);padding-bottom:12px}.se-restrictions-container__header--right{display:flex;flex-direction:row;align-items:center}.se-restrictions-container__header--right>div,.se-restrictions-container__header--right>span{margin-left:12px;margin-right:16px;width:125px}.se-restrictions-container__header--empty{border-bottom:none}.se-restrictions__sub-header{font-weight:700;align-self:flex-start;color:var(--sapNeutralColor);margin:0}.se-restriction__clear-all__btn{text-transform:capitalize}`]}),__metadata("design:paramtypes",[l.LogService,l.SystemEventService,wt,t.PageRestrictionsCriteriaService,r.IContextAwareEditableItemService,l.CmsitemsRestService,n.ChangeDetectorRef])],oi);let ni=class RestrictionsModule{};ni=__decorate([n.NgModule({imports:[g.CommonModule,m.TranslateModule.forChild(),l.SeGenericEditorModule,l.MessageModule,l.SelectModule,l.L10nPipeModule,l.DropdownMenuModule,l.SliderPanelModule,u.ButtonModule],providers:[wt,Et],declarations:[Bt,bt,Xt,Kt,xt,ei,oi,ti],entryComponents:[Bt,bt,Xt,Kt,xt,ei,oi,ti],exports:[oi]})],ni);window.__smartedit__.addDecoratorPayload("Component","PageRestrictionsEditorComponent",{selector:"se-page-restrictions-editor",template:`<se-page-restrictions-info-message *ngIf="page.restrictions?.length > 1"></se-page-restrictions-info-message><se-restrictions-editor [editable]="isEditable" [getRestrictionTypes]="getRestrictionTypes" [getSupportedRestrictionTypes]="getSupportedRestrictionTypes" [item]="page" [restrictionUuids]="page.restrictions" [removeValidationMessages]="onRemoveValidationMessages" (onRestrictionsChange)="onRestrictionsChange($event)"></se-restrictions-editor>`});t.PageRestrictionsEditorComponent=class PageRestrictionsEditorComponent{constructor(e,t,i){this.data=e;this.restrictionsService=t;this.restrictionTypesService=i;({editor:this.editor,model:this.page}=e);this.isEditable=!e.isFieldDisabled()}ngOnInit(){this.initGetRestrictionTypes();this.initSupportedRestrictionTypes();this.initOnRemoveValidationMessages()}onRestrictionsChange({onlyOneRestrictionMustApply:e,restrictionUuids:t,alwaysEnableSubmit:i}){this.page.onlyOneRestrictionMustApply=e;this.page.restrictions=t}initGetRestrictionTypes(){this.getRestrictionTypes=()=>this.restrictionTypesService.getRestrictionTypesByPageType(this.page.typeCode)}initSupportedRestrictionTypes(){this.getSupportedRestrictionTypes=()=>this.restrictionsService.getSupportedRestrictionTypeCodes()}initOnRemoveValidationMessages(){this.onRemoveValidationMessages=()=>this.editor.api.clearMessages()}};t.PageRestrictionsEditorComponent=__decorate([n.Component({selector:"se-page-restrictions-editor",template:`<se-page-restrictions-info-message *ngIf="page.restrictions?.length > 1"></se-page-restrictions-info-message><se-restrictions-editor [editable]="isEditable" [getRestrictionTypes]="getRestrictionTypes" [getSupportedRestrictionTypes]="getSupportedRestrictionTypes" [item]="page" [restrictionUuids]="page.restrictions" [removeValidationMessages]="onRemoveValidationMessages" (onRestrictionsChange)="onRestrictionsChange($event)"></se-restrictions-editor>`}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,t.RestrictionsService,t.RestrictionTypesService])],t.PageRestrictionsEditorComponent);window.__smartedit__.addDecoratorPayload("Component","PageRestrictionsInfoMessageComponent",{selector:"se-page-restrictions-info-message",template:`<se-message [type]="'info'" class="se-restrictions-info__message"><ng-container se-message-title>{{ 'se.cms.restrictions.editor.ymessage.title' | translate }}</ng-container><ng-container se-message-description>{{ 'se.cms.restrictions.editor.ymessage.description' | translate }}</ng-container></se-message>`,styles:[`.se-restrictions-info__message{margin-bottom:10px;display:block}`]});let si=class PageRestrictionsInfoMessageComponent{};si=__decorate([n.Component({selector:"se-page-restrictions-info-message",template:`<se-message [type]="'info'" class="se-restrictions-info__message"><ng-container se-message-title>{{ 'se.cms.restrictions.editor.ymessage.title' | translate }}</ng-container><ng-container se-message-description>{{ 'se.cms.restrictions.editor.ymessage.description' | translate }}</ng-container></se-message>`,styles:[`.se-restrictions-info__message{margin-bottom:10px;display:block}`]})],si);t.PageRestrictionsModule=class PageRestrictionsModule{};t.PageRestrictionsModule=__decorate([n.NgModule({imports:[g.CommonModule,l.MessageModule,ni,l.TranslationModule.forChild()],declarations:[t.PageRestrictionsEditorComponent,si],entryComponents:[t.PageRestrictionsEditorComponent,si],exports:[ni,si]})],t.PageRestrictionsModule);t.CmsComponentsModule=class CmsComponentsModule{};t.CmsComponentsModule=__decorate([n.NgModule({imports:[g.CommonModule,l.TranslationModule.forChild(),t.ComponentMenuModule,t.PageRestrictionsModule,l.GenericEditorDropdownModule],providers:[N,L,{provide:l.CustomDropdownPopulatorsToken,useClass:B,multi:true}],declarations:[t.SubTypeSelectorComponent,t.SelectComponentTypeModalComponent,t.ComponentRestrictionsEditorComponent,t.CmsDropdownItemComponent,t.CmsComponentDropdownComponent],entryComponents:[t.SubTypeSelectorComponent,t.SelectComponentTypeModalComponent,t.ComponentRestrictionsEditorComponent,t.CmsDropdownItemComponent,t.CmsComponentDropdownComponent]})],t.CmsComponentsModule);window.__smartedit__.addDecoratorPayload("Component","ItemSelectorPanelComponent",{selector:"se-item-selector-panel",template:`<se-slider-panel [sliderPanelConfiguration]="panelConfig" [(sliderPanelHide)]="hidePanel" [(sliderPanelShow)]="showPanel" class="se-item-selector-panel"><div *ngIf="catalogs.length > 0"><div *ngIf="catalogs.length > 1" class="se-item-selector-panel__selector"><label class="se-control-label" translate="se.cms.catalogaware.panel.catalogs.label"></label><se-select id="se-catalog-selector-dropdown" [(model)]="catalogInfo.catalogId" [fetchStrategy]="catalogSelectorFetchStrategy" [onChange]="onCatalogSelectorChange"></se-select><label>{{ catalogInfo.name | seL10n | async }}</label></div><div class="se-item-selector-panel__selector"><label class="se-control-label" translate="se.cms.catalogaware.panel.catalogsversion.label"></label><se-select id="se-catalog-version-selector-dropdown" [(model)]="catalogInfo.catalogVersion" [fetchStrategy]="catalogVersionSelectorFetchStrategy" [onChange]="onCatalogVersionSelectorChange" [searchEnabled]="false" [(reset)]="resetCatalogVersionSelector"></se-select></div><div class="se-item-selector-panel__selector" *ngIf="catalogInfo.catalogVersion"><label class="se-control-label" [translate]="catalogItemTypeI18nKey"></label><se-select id="se-items-selector-dropdown" [multiSelect]="true" [controls]="true" [(model)]="internalItemsSelected" [onChange]="onItemsSelectorChange" [fetchStrategy]="itemsSelectorFetchStrategy" [(reset)]="resetItemsListSelector" [itemComponent]="itemComponent" [isReadOnly]="!isItemSelectorEnabled()"></se-select></div></div></se-slider-panel>`,styles:[`.se-item-selector-panel__selector{margin-bottom:25px}`]});let ai=class ItemSelectorPanelComponent{constructor(){this.onSaveChanges=new n.EventEmitter;this.catalogs=[];this.catalogInfo={};this.saveButtonDisabled=true;this.internalItemsSelected=[];this.initOnCatalogSelectorChange();this.initOnCatalogVersionSelectorChange();this.initOnItemsSelectorChange()}ngOnInit(){this.panelConfig={cssSelector:"#y-modal-dialog",noGreyedOutOverlay:true,modal:{title:this.catalogItemTypeI18nKey,showDismissButton:false,cancel:{onClick:()=>this.cancel(),label:"se.cms.catalogaware.panel.button.cancel",isDisabledFn:()=>false},save:{onClick:()=>this.saveChanges(),label:"se.cms.catalogaware.panel.button.add",isDisabledFn:()=>this.isSaveButtonDisabled()}}};return this.initCatalogs()}initAndShowPanel(e){this.catalogInfo={};this.initCatalogs();this.internalItemsSelected=e||[];this.showPanel()}isItemSelectorEnabled(){return this.catalogInfo&&!!this.catalogInfo.catalogId&&!!this.catalogInfo.catalogVersion}initOnCatalogSelectorChange(){this.onCatalogSelectorChange=()=>{if(this.resetCatalogVersionSelector){this.resetCatalogVersionSelector()}}}initOnCatalogVersionSelectorChange(){this.onCatalogVersionSelectorChange=()=>{if(this.catalogInfo.catalogId&&this.catalogInfo.catalogVersion){if(this.resetItemsListSelector){this.resetItemsListSelector()}}}}initOnItemsSelectorChange(){this.onItemsSelectorChange=()=>{if(this.isItemSelectorEnabled()){this.saveButtonDisabled=false}}}initCatalogs(){return __awaiter(this,void 0,void 0,(function*(){this.catalogs=yield this.getCatalogs();if(this.catalogs.length===1){this.catalogInfo.catalogId=this.catalogs[0].id}this.initCatalogSelector();this.initCatalogVersionSelector();this.initItemsSelector()}))}initCatalogSelector(){this.catalogSelectorFetchStrategy={fetchAll:()=>Promise.resolve(this.catalogs)}}initCatalogVersionSelector(){this.catalogVersionSelectorFetchStrategy={fetchAll:()=>{let e=[];if(this.catalogInfo.catalogId){const t=this.catalogs.find((({id:e})=>e===this.catalogInfo.catalogId));e=t.versions.slice(0)}return Promise.resolve(e)}}}initItemsSelector(){this.itemsSelectorFetchStrategy={fetchPage:(e,t,i)=>this.itemsFetchPageAndFilter(e,t,i),fetchEntity:e=>this.itemsFetchStrategy.fetchEntity(e)}}itemsFetchPageAndFilter(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.itemsFetchStrategy.fetchPage(this.catalogInfo,e,t,i);return this.limitToNonSelectedItems(o)}))}limitToNonSelectedItems(e){let t=e.results.length;while(t--){const i=e.results[t];if(this.internalItemsSelected.includes(i.uid)){e.results.splice(t,1);e.pagination.count--}}return e}isSaveButtonDisabled(){return this.saveButtonDisabled}cancel(){this.catalogInfo={};this.hidePanel()}saveChanges(){this.onSaveChanges.emit([...this.internalItemsSelected]);this.hidePanel()}};__decorate([n.Input(),__metadata("design:type",n.Type)],ai.prototype,"itemComponent",void 0);__decorate([n.Input(),__metadata("design:type",Function)],ai.prototype,"getCatalogs",void 0);__decorate([n.Input(),__metadata("design:type",Object)],ai.prototype,"itemsFetchStrategy",void 0);__decorate([n.Input(),__metadata("design:type",String)],ai.prototype,"catalogItemTypeI18nKey",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],ai.prototype,"onSaveChanges",void 0);ai=__decorate([n.Component({selector:"se-item-selector-panel",template:`<se-slider-panel [sliderPanelConfiguration]="panelConfig" [(sliderPanelHide)]="hidePanel" [(sliderPanelShow)]="showPanel" class="se-item-selector-panel"><div *ngIf="catalogs.length > 0"><div *ngIf="catalogs.length > 1" class="se-item-selector-panel__selector"><label class="se-control-label" translate="se.cms.catalogaware.panel.catalogs.label"></label><se-select id="se-catalog-selector-dropdown" [(model)]="catalogInfo.catalogId" [fetchStrategy]="catalogSelectorFetchStrategy" [onChange]="onCatalogSelectorChange"></se-select><label>{{ catalogInfo.name | seL10n | async }}</label></div><div class="se-item-selector-panel__selector"><label class="se-control-label" translate="se.cms.catalogaware.panel.catalogsversion.label"></label><se-select id="se-catalog-version-selector-dropdown" [(model)]="catalogInfo.catalogVersion" [fetchStrategy]="catalogVersionSelectorFetchStrategy" [onChange]="onCatalogVersionSelectorChange" [searchEnabled]="false" [(reset)]="resetCatalogVersionSelector"></se-select></div><div class="se-item-selector-panel__selector" *ngIf="catalogInfo.catalogVersion"><label class="se-control-label" [translate]="catalogItemTypeI18nKey"></label><se-select id="se-items-selector-dropdown" [multiSelect]="true" [controls]="true" [(model)]="internalItemsSelected" [onChange]="onItemsSelectorChange" [fetchStrategy]="itemsSelectorFetchStrategy" [(reset)]="resetItemsListSelector" [itemComponent]="itemComponent" [isReadOnly]="!isItemSelectorEnabled()"></se-select></div></div></se-slider-panel>`,styles:[`.se-item-selector-panel__selector{margin-bottom:25px}`]}),__metadata("design:paramtypes",[])],ai);window.__smartedit__.addDecoratorPayload("Component","CatalogAwareSelectorComponent",{selector:"se-catalog-aware-selector",host:{"[class.se-catalog-aware-selector]":"true"},template:`<div *ngIf="selectedItemListIsEmpty()"><button fd-button type="button" id="catalog-aware-selector-add-item" class="fd-button--compact se-catalog-aware-selector__add-item-btn" *ngIf="editable" (click)="openItemSelectorPanel()"><span translate="se.cms.catalogaware.newbutton.title" [translateParams]="{ catalogItemType: catalogItemTypeI18nKey | translate }" class="se-catalog-aware-selector__add-item-btn-text"></span></button></div><div *ngIf="!selectedItemListIsEmpty()" class="se-catalog-aware-selector__content"><div class="se-catalog-aware-selector__add-more-btn-wrapper" *ngIf="editable"><button fd-button type="button" class="fd-button--transparent" label="{{ 'se.cms.catalogaware.list.addmore' | translate}}" (click)="openItemSelectorPanel()"></button></div><se-editable-list [id]="editableListId" [itemComponent]="nodeComponent" [(items)]="itemList" [onChange]="onListChange" [editable]="editable" [(refresh)]="refreshItemListWidget" class="se-catalog-aware-selector__list"></se-editable-list></div><se-item-selector-panel [itemComponent]="itemComponent" [getCatalogs]="getCatalogs" [itemsFetchStrategy]="itemsFetchStrategy" [catalogItemTypeI18nKey]="catalogItemTypeI18nKey" (onSaveChanges)="onItemSelectorPanelSaveChanges($event)"></se-item-selector-panel>`,styles:[`.se-catalog-aware-selector__add-item-btn{display:flex;flex-direction:row;align-items:center;color:var(--sapIndicationColor_5)}.se-catalog-aware-selector__add-more-btn-wrapper{display:flex;justify-content:flex-end;align-items:center}.se-catalog-aware-selector__list .se-tree-node{color:var(--sapList_TextColor);background-color:var(--sapBaseColor)}.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node__ol{padding-inline-start:0}.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node,.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node__ol{display:flex;flex-direction:column;align-items:center}.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node .se-tree-node__li,.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node__ol .se-tree-node__li{width:100%}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let ri=class CatalogAwareSelectorComponent{constructor(e,t){this.logService=e;this.cdr=t;this.selectedItemIds=[];this.selectedItemIdsChange=new n.EventEmitter;this.itemList=[];this.onListChange=()=>this.selectItemsFromItemList()}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){if(this.editable===undefined){this.editable=true}this.editableListId=`${this.id}_list`;if(this.selectedItemIds.length>0){return this.syncFromSelectedItemsToItemsList(this.selectedItemIds)}else{return Promise.reject()}}))}selectedItemListIsEmpty(){return this.selectedItemIds.length===0}openItemSelectorPanel(){this.itemSelectorPanel.initAndShowPanel([...this.selectedItemIds]);if(!this.cdr.destroyed){this.cdr.detectChanges()}}onItemSelectorPanelSaveChanges(e){this.selectedItemIdsChange.emit(e);return this.syncFromSelectedItemsToItemsList(e)}selectItemsFromItemList(){const e=this.itemList.map((e=>e.id));this.selectedItemIdsChange.emit(e)}syncFromSelectedItemsToItemsList(e){return __awaiter(this,void 0,void 0,(function*(){const[t,i]=this.selectItemIdsFromItemList(e,this.itemList);const o=new Map;this.itemList.filter((({id:e})=>t.includes(e))).forEach((e=>{o.set(e.id,e)}));if(i.length>0){const e=yield this.fetchItems(i);e.forEach((e=>{o.set(e.id,e)}))}this.itemList.length=0;e.forEach((e=>{const t=o.get(e);if(!t){this.logService.warn(`[${this.constructor.name}] - Cannot find item with key `,e);return}this.itemList.push(t)}));if(this.itemList.length>0){this.updatePosition()}if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}updatePosition(){if(!!this.refreshItemListWidget){this.refreshItemListWidget()}}selectItemIdsFromItemList(e,t){const i=[];const o=[];const n=new Set(t.map((({id:e})=>e)));e.forEach((e=>{if(n.has(e)){i.push(e)}else{o.push(e)}}));return[i,o]}fetchItems(e){return __awaiter(this,void 0,void 0,(function*(){const t=e.map((e=>this.itemsFetchStrategy.fetchEntity(e)));return Promise.all(t)}))}};__decorate([n.Input(),n.HostBinding("attr.id"),__metadata("design:type",String)],ri.prototype,"id",void 0);__decorate([n.Input(),__metadata("design:type",Array)],ri.prototype,"selectedItemIds",void 0);__decorate([n.Input(),__metadata("design:type",Function)],ri.prototype,"getCatalogs",void 0);__decorate([n.Input(),__metadata("design:type",Object)],ri.prototype,"itemsFetchStrategy",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],ri.prototype,"itemComponent",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],ri.prototype,"nodeComponent",void 0);__decorate([n.Input(),__metadata("design:type",String)],ri.prototype,"catalogItemTypeI18nKey",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],ri.prototype,"editable",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],ri.prototype,"selectedItemIdsChange",void 0);__decorate([n.ViewChild(ai,{static:false}),__metadata("design:type",ai)],ri.prototype,"itemSelectorPanel",void 0);ri=__decorate([n.Component({selector:"se-catalog-aware-selector",host:{"[class.se-catalog-aware-selector]":"true"},template:`<div *ngIf="selectedItemListIsEmpty()"><button fd-button type="button" id="catalog-aware-selector-add-item" class="fd-button--compact se-catalog-aware-selector__add-item-btn" *ngIf="editable" (click)="openItemSelectorPanel()"><span translate="se.cms.catalogaware.newbutton.title" [translateParams]="{ catalogItemType: catalogItemTypeI18nKey | translate }" class="se-catalog-aware-selector__add-item-btn-text"></span></button></div><div *ngIf="!selectedItemListIsEmpty()" class="se-catalog-aware-selector__content"><div class="se-catalog-aware-selector__add-more-btn-wrapper" *ngIf="editable"><button fd-button type="button" class="fd-button--transparent" label="{{ 'se.cms.catalogaware.list.addmore' | translate}}" (click)="openItemSelectorPanel()"></button></div><se-editable-list [id]="editableListId" [itemComponent]="nodeComponent" [(items)]="itemList" [onChange]="onListChange" [editable]="editable" [(refresh)]="refreshItemListWidget" class="se-catalog-aware-selector__list"></se-editable-list></div><se-item-selector-panel [itemComponent]="itemComponent" [getCatalogs]="getCatalogs" [itemsFetchStrategy]="itemsFetchStrategy" [catalogItemTypeI18nKey]="catalogItemTypeI18nKey" (onSaveChanges)="onItemSelectorPanelSaveChanges($event)"></se-item-selector-panel>`,styles:[`.se-catalog-aware-selector__add-item-btn{display:flex;flex-direction:row;align-items:center;color:var(--sapIndicationColor_5)}.se-catalog-aware-selector__add-more-btn-wrapper{display:flex;justify-content:flex-end;align-items:center}.se-catalog-aware-selector__list .se-tree-node{color:var(--sapList_TextColor);background-color:var(--sapBaseColor)}.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node__ol{padding-inline-start:0}.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node,.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node__ol{display:flex;flex-direction:column;align-items:center}.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node .se-tree-node__li,.se-catalog-aware-selector__list .se-tree__nodes--item .se-tree-node__ol .se-tree-node__li{width:100%}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.LogService,n.ChangeDetectorRef])],ri);window.__smartedit__.addDecoratorPayload("Component","ProductNodeComponent",{selector:"se-product-node",template:`<div class="se-product-row"><div class="se-product-node" [ngClass]="{\n            'se-product-node--no-drag' : !parent.dragEnabled,\n            'se-product-node--drag': parent.dragEnabled \n        }"><img class="se-product-row__img" [src]="node.thumbnail.url || '/cmssmartedit/images/product_thumbnail_default.png'" alt="product image"/><div class="se-product-row__product se-nowrap-ellipsis" [title]="node.name | seL10n  | async">{{ node.name | seL10n | async }}</div><div class="se-product-row__product se-nowrap-ellipsis" [title]="node.code">{{ node.code }}</div><div class="se-product-row__catalog se-nowrap-ellipsis" title="{{ node.catalogId }} - {{ node.catalogVersion }}">{{ node.catalogId }} - {{ node.catalogVersion }}</div><se-dropdown-menu *ngIf="parent.dragEnabled" [dropdownItems]="dropdownItems" [selectedItem]="node" class="pull-right se-tree-node__actions--more-menu"></se-dropdown-menu></div></div>`,styles:[`.se-product-node{display:grid;grid-template-columns:1fr 5fr 5fr 7fr;grid-column-gap:12px;width:100%;align-items:center;padding:0 8px}.se-product-node--no-drag{grid-template-columns:1fr 6fr 6fr 7fr;cursor:default}.se-product-node--drag{grid-template-columns:1fr 5fr 5fr 7fr 0.5fr}`,`.se-product-row__catalog,.se-product-row__product{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;text-align:left}.se-product-row__img{padding:2px;width:36px;height:36px;font-size:.35rem}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let li=class ProductNodeComponent{constructor(e,t){this.node=e;this.parent=t;const{getDropdownItems:i}=this.parent.nodeActions;this.dropdownItems=i()}};li=__decorate([n.Component({selector:"se-product-node",template:`<div class="se-product-row"><div class="se-product-node" [ngClass]="{\n            'se-product-node--no-drag' : !parent.dragEnabled,\n            'se-product-node--drag': parent.dragEnabled \n        }"><img class="se-product-row__img" [src]="node.thumbnail.url || '/cmssmartedit/images/product_thumbnail_default.png'" alt="product image"/><div class="se-product-row__product se-nowrap-ellipsis" [title]="node.name | seL10n  | async">{{ node.name | seL10n | async }}</div><div class="se-product-row__product se-nowrap-ellipsis" [title]="node.code">{{ node.code }}</div><div class="se-product-row__catalog se-nowrap-ellipsis" title="{{ node.catalogId }} - {{ node.catalogVersion }}">{{ node.catalogId }} - {{ node.catalogVersion }}</div><se-dropdown-menu *ngIf="parent.dragEnabled" [dropdownItems]="dropdownItems" [selectedItem]="node" class="pull-right se-tree-node__actions--more-menu"></se-dropdown-menu></div></div>`,styles:[`.se-product-node{display:grid;grid-template-columns:1fr 5fr 5fr 7fr;grid-column-gap:12px;width:100%;align-items:center;padding:0 8px}.se-product-node--no-drag{grid-template-columns:1fr 6fr 6fr 7fr;cursor:default}.se-product-node--drag{grid-template-columns:1fr 5fr 5fr 7fr 0.5fr}`,`.se-product-row__catalog,.se-product-row__product{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;text-align:left}.se-product-row__img{padding:2px;width:36px;height:36px;font-size:.35rem}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.TREE_NODE)),__param(1,n.Inject(n.forwardRef((()=>l.TreeComponent)))),__metadata("design:paramtypes",[Object,l.TreeComponent])],li);window.__smartedit__.addDecoratorPayload("Component","ProductSelectorItemComponent",{selector:"se-product-selector-item",template:`<div class="se-product-row"><div class="se-product-node"><img class="se-product-row__img" [src]="getThumbnailUrl(item.thumbnail?.url)" alt="product image"/><div class="se-product-row__product se-nowrap-ellipsis" [title]="item.name | seL10n | async">{{ item.name | seL10n | async }}</div><div class="se-product-row__product se-nowrap-ellipsis" [title]="item.code">{{ item.code }}</div><div class="se-product-row__catalog"><div class="se-nowrap-ellipsis" title="{{ item.catalogId }} - {{ item.catalogVersion }}">{{ item.catalogId }} - {{ item.catalogVersion }}</div></div></div></div>`,styles:[`.se-product-node{display:grid;grid-template-columns:1fr 5fr 5fr 7fr;grid-column-gap:12px;width:100%;align-items:center;padding:0 8px}.se-product-node--no-drag{grid-template-columns:1fr 6fr 6fr 7fr;cursor:default}.se-product-node--drag{grid-template-columns:1fr 5fr 5fr 7fr 0.5fr}`,`.se-product-row__catalog,.se-product-row__product{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;text-align:left}.se-product-row__img{padding:2px;width:36px;height:36px;font-size:.35rem}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let ci=class ProductSelectorItemComponent{constructor(e){this.data=e;this.defaultThumbnail=`${r.IMAGES_URL}/product_thumbnail_default.png`;({item:this.item}=e)}getThumbnailUrl(e){return e||this.defaultThumbnail}};ci=__decorate([n.Component({selector:"se-product-selector-item",template:`<div class="se-product-row"><div class="se-product-node"><img class="se-product-row__img" [src]="getThumbnailUrl(item.thumbnail?.url)" alt="product image"/><div class="se-product-row__product se-nowrap-ellipsis" [title]="item.name | seL10n | async">{{ item.name | seL10n | async }}</div><div class="se-product-row__product se-nowrap-ellipsis" [title]="item.code">{{ item.code }}</div><div class="se-product-row__catalog"><div class="se-nowrap-ellipsis" title="{{ item.catalogId }} - {{ item.catalogVersion }}">{{ item.catalogId }} - {{ item.catalogVersion }}</div></div></div></div>`,styles:[`.se-product-node{display:grid;grid-template-columns:1fr 5fr 5fr 7fr;grid-column-gap:12px;width:100%;align-items:center;padding:0 8px}.se-product-node--no-drag{grid-template-columns:1fr 6fr 6fr 7fr;cursor:default}.se-product-node--drag{grid-template-columns:1fr 5fr 5fr 7fr 0.5fr}`,`.se-product-row__catalog,.se-product-row__product{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;text-align:left}.se-product-row__img{padding:2px;width:36px;height:36px;font-size:.35rem}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],ci);let di=class CatalogInformationService{constructor(e,t,i,o){this.catalogService=e;this.sharedDataService=t;this.productCategoryService=i;this.productService=o;this.init()}get productsFetchStrategy(){return this._productsFetchStrategy}get categoriesFetchStrategy(){return this._categoriesFetchStrategy}makeGetProductCatalogsInformation(){return()=>this.getProductCatalogsInformation()}getProductCatalogsInformation(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getSiteUid();if(this.cachedSiteUid===e&&this.parsedCatalogs){return this.parsedCatalogs}else{this.cachedSiteUid=e;const t=yield this.catalogService.getProductCatalogsForSite(e);const i=this.catalogsToProductCatalogById(t);this.parsedCatalogs=p.values(i);return this.parsedCatalogs}}))}init(){this._productsFetchStrategy={fetchPage:(e,t,i,o)=>__awaiter(this,void 0,void 0,(function*(){return this.productsFetchPage(e,t,i,o)})),fetchEntity:e=>__awaiter(this,void 0,void 0,(function*(){return this.productsFetchEntity(e)}))};this._categoriesFetchStrategy={fetchPage:(e,t,i,o)=>__awaiter(this,void 0,void 0,(function*(){return this.categoriesFetchPage(e,t,i,o)})),fetchEntity:e=>__awaiter(this,void 0,void 0,(function*(){return this.categoriesFetchEntity(e)}))}}productsFetchPage(e,t,i,o){return __awaiter(this,void 0,void 0,(function*(){const n=yield this.getSiteUid();e.siteUID=n;const{products:s,pagination:a}=yield this.productService.findProducts(e,{mask:t,pageSize:i,currentPage:o});const r=s.map((e=>Object.assign(Object.assign({},e),{id:e.uid})));return{pagination:a,results:r}}))}productsFetchEntity(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getSiteUid();const i=yield this.productService.getProductById(t,e);return Object.assign(Object.assign({},i),{id:i.uid})}))}categoriesFetchPage(e,t,i,o){return __awaiter(this,void 0,void 0,(function*(){const n=yield this.getSiteUid();e.siteUID=n;const{productCategories:s,pagination:a}=yield this.productCategoryService.getCategories({catalogId:e.catalogId,catalogVersion:e.catalogVersion,siteUID:e.siteUID,mask:t,pageSize:i,currentPage:o});const r=s.map((e=>Object.assign(Object.assign({},e),{id:e.uid})));return{pagination:a,results:r}}))}categoriesFetchEntity(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getSiteUid();const i=yield this.productCategoryService.getCategoryById(t,e);i.id=i.uid;return i}))}getSiteUid(){return __awaiter(this,void 0,void 0,(function*(){return this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY).then((({siteDescriptor:{uid:e}})=>e))}))}catalogsToProductCatalogById(e){const t={};e.forEach((e=>{t[e.catalogId]={id:e.catalogId,name:e.name,versions:e.versions.map((({version:e})=>({id:e,label:e})))}}));return t}};di=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ICatalogService,l.ISharedDataService,t.ProductCategoryService,_.ProductService])],di);window.__smartedit__.addDecoratorPayload("Component","MultiProductSelectorComponent",{selector:"se-multi-product-selector",template:`<se-catalog-aware-selector [id]="id" [selectedItemIds]="selectedItemIds" (selectedItemIdsChange)="onSelectedItemIdsChange($event)" [getCatalogs]="getCatalogs" [itemComponent]="productSelectorItemComponent" [nodeComponent]="productNodeComponent" [itemsFetchStrategy]="itemsFetchStrategy" [catalogItemTypeI18nKey]="'se.cms.catalogaware.catalogitemtype.product'" [editable]="editable"></se-catalog-aware-selector>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let pi=class MultiProductSelectorComponent{constructor(e,t){this.catalogInformationService=e;({field:{qualifier:this.id},model:this.model,qualifier:this.qualifier,field:{editable:this.editable}}=t);this.productNodeComponent=li;this.productSelectorItemComponent=ci}ngOnInit(){this.getCatalogs=this.catalogInformationService.makeGetProductCatalogsInformation();this.itemsFetchStrategy=this.catalogInformationService.productsFetchStrategy;if(this.editable===undefined){this.editable=true}this.selectedItemIds=[...this.model[this.qualifier]||[]]}onSelectedItemIdsChange(e){this.selectedItemIds=[...e];this.model[this.qualifier]=this.selectedItemIds}};pi=__decorate([n.Component({selector:"se-multi-product-selector",template:`<se-catalog-aware-selector [id]="id" [selectedItemIds]="selectedItemIds" (selectedItemIdsChange)="onSelectedItemIdsChange($event)" [getCatalogs]="getCatalogs" [itemComponent]="productSelectorItemComponent" [nodeComponent]="productNodeComponent" [itemsFetchStrategy]="itemsFetchStrategy" [catalogItemTypeI18nKey]="'se.cms.catalogaware.catalogitemtype.product'" [editable]="editable"></se-catalog-aware-selector>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(1,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[di,Object])],pi);window.__smartedit__.addDecoratorPayload("Component","CategoryNodeComponent",{selector:"se-category-node",template:`<div class="se-product-row"><div class="se-category-node" [ngClass]="{\n          'se-category-node--no-drag': !parent.dragEnabled,\n          'se-category-node--drag': parent.dragEnabled\n        }"><div class="se-product-row__product" [title]="node.name | seL10n | async">{{ node.name | seL10n | async }}</div><div class="se-product-row__product" [title]="node.code">{{ node.code }}</div><div class="se-product-row__catalog" title="{{ node.catalogId }} - {{ node.catalogVersion }}">{{ node.catalogId }} - {{ node.catalogVersion }}</div><div><se-dropdown-menu *ngIf="parent.dragEnabled" [dropdownItems]="dropdownItems" [selectedItem]="node" class="pull-right se-tree-node__actions--more-menu"></se-dropdown-menu></div></div></div>`,styles:[`.se-category-node{padding:0 16px;display:grid;grid-column-gap:12px;align-items:center}.se-category-node--no-drag{grid-template-columns:6fr 6fr 8fr}.se-category-node--drag{grid-template-columns:6fr 6fr 7fr 1fr}`,`.se-product-row__catalog,.se-product-row__product{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;text-align:left}.se-product-row__img{padding:2px;width:36px;height:36px;font-size:.35rem}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let mi=class CategoryNodeComponent{constructor(e,t){this.node=e;this.parent=t;const{getDropdownItems:i}=this.parent.nodeActions;this.dropdownItems=i()}};mi=__decorate([n.Component({selector:"se-category-node",template:`<div class="se-product-row"><div class="se-category-node" [ngClass]="{\n          'se-category-node--no-drag': !parent.dragEnabled,\n          'se-category-node--drag': parent.dragEnabled\n        }"><div class="se-product-row__product" [title]="node.name | seL10n | async">{{ node.name | seL10n | async }}</div><div class="se-product-row__product" [title]="node.code">{{ node.code }}</div><div class="se-product-row__catalog" title="{{ node.catalogId }} - {{ node.catalogVersion }}">{{ node.catalogId }} - {{ node.catalogVersion }}</div><div><se-dropdown-menu *ngIf="parent.dragEnabled" [dropdownItems]="dropdownItems" [selectedItem]="node" class="pull-right se-tree-node__actions--more-menu"></se-dropdown-menu></div></div></div>`,styles:[`.se-category-node{padding:0 16px;display:grid;grid-column-gap:12px;align-items:center}.se-category-node--no-drag{grid-template-columns:6fr 6fr 8fr}.se-category-node--drag{grid-template-columns:6fr 6fr 7fr 1fr}`,`.se-product-row__catalog,.se-product-row__product{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;text-align:left}.se-product-row__img{padding:2px;width:36px;height:36px;font-size:.35rem}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.TREE_NODE)),__param(1,n.Inject(n.forwardRef((()=>l.TreeComponent)))),__metadata("design:paramtypes",[Object,l.TreeComponent])],mi);window.__smartedit__.addDecoratorPayload("Component","CategorySelectorItemComponent",{selector:"se-category-selector-item",template:`<div class="se-product-row"><div class="se-category-row-container--item"><div class="se-product-row__product" [title]="item.name | seL10n | async">{{ item.name | seL10n | async }}</div><div class="se-product-row__product" [title]="item.code">{{ item.code }}</div><div class="se-product-row__catalog" title="{{ item.catalogId }} - {{ item.catalogVersion }}">{{ item.catalogId }} - {{ item.catalogVersion }}</div></div></div>`,styles:[`.se-category-row-container--item{display:grid;grid-template-columns:6fr 6fr 8fr;grid-column-gap:12px;width:100%;padding:0 8px}`,`.se-product-row__catalog,.se-product-row__product{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;text-align:left}.se-product-row__img{padding:2px;width:36px;height:36px;font-size:.35rem}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let gi=class CategorySelectorItemComponent{constructor(e){this.data=e;({item:this.item}=e)}};gi=__decorate([n.Component({selector:"se-category-selector-item",template:`<div class="se-product-row"><div class="se-category-row-container--item"><div class="se-product-row__product" [title]="item.name | seL10n | async">{{ item.name | seL10n | async }}</div><div class="se-product-row__product" [title]="item.code">{{ item.code }}</div><div class="se-product-row__catalog" title="{{ item.catalogId }} - {{ item.catalogVersion }}">{{ item.catalogId }} - {{ item.catalogVersion }}</div></div></div>`,styles:[`.se-category-row-container--item{display:grid;grid-template-columns:6fr 6fr 8fr;grid-column-gap:12px;width:100%;padding:0 8px}`,`.se-product-row__catalog,.se-product-row__product{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;text-align:left}.se-product-row__img{padding:2px;width:36px;height:36px;font-size:.35rem}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],gi);window.__smartedit__.addDecoratorPayload("Component","MultiCategorySelectorComponent",{selector:"se-multi-category-selector",template:`<se-catalog-aware-selector [id]="id" [selectedItemIds]="selectedItemIds" (selectedItemIdsChange)="onSelectedItemIdsChange($event)" [getCatalogs]="getCatalogs" [itemComponent]="categorySelectorItemComponent" [nodeComponent]="categoryNodeComponent" [itemsFetchStrategy]="itemsFetchStrategy" [catalogItemTypeI18nKey]="'se.cms.catalogaware.catalogitemtype.category'" [editable]="editable"></se-catalog-aware-selector>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let ui=class MultiCategorySelectorComponent{constructor(e,t){this.catalogInformationService=e;({model:this.model,qualifier:this.qualifier,field:{qualifier:this.id,editable:this.editable}}=t);this.categoryNodeComponent=mi;this.categorySelectorItemComponent=gi}ngOnInit(){this.getCatalogs=this.catalogInformationService.makeGetProductCatalogsInformation();this.itemsFetchStrategy=this.catalogInformationService.categoriesFetchStrategy;if(this.editable===undefined){this.editable=true}this.selectedItemIds=[...this.model[this.qualifier]||[]]}onSelectedItemIdsChange(e){this.selectedItemIds=[...e];this.model[this.qualifier]=this.selectedItemIds}};ui=__decorate([n.Component({selector:"se-multi-category-selector",template:`<se-catalog-aware-selector [id]="id" [selectedItemIds]="selectedItemIds" (selectedItemIdsChange)="onSelectedItemIdsChange($event)" [getCatalogs]="getCatalogs" [itemComponent]="categorySelectorItemComponent" [nodeComponent]="categoryNodeComponent" [itemsFetchStrategy]="itemsFetchStrategy" [catalogItemTypeI18nKey]="'se.cms.catalogaware.catalogitemtype.category'" [editable]="editable"></se-catalog-aware-selector>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(1,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[di,Object])],ui);let hi=class CatalogModule{};hi=__decorate([n.NgModule({imports:[g.CommonModule,s.FormsModule,l.DropdownMenuModule,l.SliderPanelModule,l.SelectModule,m.TranslateModule.forChild(),l.L10nPipeModule,l.EditableListModule,u.ButtonModule],providers:[di],declarations:[ai,li,mi,ci,gi,ri,pi,ui],entryComponents:[li,mi,ci,gi,pi,ui]})],hi);const _i="pageApprovalSelectorClose";window.__smartedit__.addDecoratorPayload("Component","PageApprovalSelectorComponent",{selector:"se-page-approval-selector",template:`<fd-popover *ngIf="showDropdown" [triggers]="[]" [closeOnOutsideClick]="false" [isOpen]="isOpen" [placement]="'bottom-end'"><fd-popover-control><button fd-button (click)="onClickDropdown()" class="se-page-approval-selector__toggle-btn fd-button fd-button--transparent" [fdMenu]="true"></button></fd-popover-control><fd-popover-body><div *ngIf="showApprovalInfo" class="se-page-approval-info">{{ approvalInfo }}</div><div *ngIf="!showApprovalInfo"><ul fd-list class="se-dropdown-menu__list se-page-approval-selector-list"><se-dropdown-menu-item *ngFor="let dropdownItem of pageApprovalOptions$ | async" [dropdownItem]="dropdownItem"></se-dropdown-menu-item></ul></div></fd-popover-body></fd-popover>`,styles:[`.se-page-approval-selector__toggle-btn{color:var(--sapLinkColor);background-color:unset}.se-page-approval-selector__toggle-btn::before{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-page-approval-selector__toggle-btn:active,.se-page-approval-selector__toggle-btn:focus{box-shadow:none}.se-page-approval-selector__toggle-btn:active,.se-page-approval-selector__toggle-btn:hover{outline:0;border-color:var(--sapButton_Hover_BorderColor);background-color:var(--sapBaseColor);border:.0625rem solid}.se-page-approval-selector__icon--draft,.se-page-approval-selector__icon--ready-to-sync{width:12px;height:12px;border-radius:50%;margin-right:10px}.se-page-approval-selector__icon--draft{background-color:var(--sapNeutralColor)}.se-page-approval-selector__icon--ready-to-sync{background-color:var(--sapInformativeColor)}.se-page-approval-selector-list{margin:0;min-width:190px;border-radius:4px;padding:0}.se-page-approval-selector .se-dropdown-item{display:flex;align-items:center}.se-page-approval-selector .se-dropdown-item:hover{background-color:var(--sapBackgroundColor,#f7f7f7)}.se-page-approval-selector .fd-popover-container-custom{box-shadow:var(--sapContent_Shadow0)}.se-page-approval-selector .fd-menu{padding:0}.se-page-approval-info{width:320px;white-space:normal;padding:16px}`],host:{"[class.se-page-approval-selector]":"true"},encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let vi=class PageApprovalSelectorComponent{constructor(e,t,i,o,n,s,a,r,d){this.iframeClickDetectionService=e;this.pageService=t;this.waitDialogService=i;this.workflowService=o;this.crossFrameEventService=n;this.routingService=s;this.logService=a;this.cdr=r;this.userTrackingService=d;this.isOpen=false;this.showApprovalInfo=false;this.showDropdown=true;this.pageApprovalOptionsSubject=new h.BehaviorSubject({CHECK:{status:l.CmsApprovalStatus.CHECK,key:"se.cms.page.approval.check",icon:"se-page-approval-selector__icon--draft",component:l.DropdownMenuItemDefaultComponent,condition:()=>true,callback:(e,t)=>this.selectApprovalStatus(t)},APPROVED:{status:l.CmsApprovalStatus.APPROVED,key:"se.cms.page.approval.approved",icon:"se-page-approval-selector__icon--ready-to-sync",component:l.DropdownMenuItemDefaultComponent,condition:()=>true,callback:(e,t)=>this.selectApprovalStatus(t)}})}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.unRegWfFinishedHandler=this.crossFrameEventService.subscribe(r.WORKFLOW_FINISHED_EVENT,(()=>this.hideComponentIfWorkflowInProgress()));this.unRegPerspectiveChangedHandler=this.crossFrameEventService.subscribe(l.EVENT_PERSPECTIVE_CHANGED,(()=>this.hideComponentIfWorkflowInProgress()));this.iframeClickDetectionService.registerCallback(_i,(()=>this.closeDropdown()));this.pageApprovalOptions$=this.pageApprovalOptionsSubject.pipe(d.map((e=>Object.values(e).filter((e=>!e.selected)))));yield this.hideComponentIfWorkflowInProgress()}))}ngOnDestroy(){this.unRegWfFinishedHandler();this.unRegPerspectiveChangedHandler();this.iframeClickDetectionService.removeCallback(_i)}onClickDropdown(){return __awaiter(this,void 0,void 0,(function*(){if(!this.isOpen){const e=yield this.getCurrentPageApprovalStatus();const t=yield this.workflowService.pageHasUnavailableDependencies();if(e!==l.CmsApprovalStatus.APPROVED&&t){this.approvalInfo=yield this.workflowService.fetchPageTranslatedApprovalInfo();this.showApprovalInfo=true}else{this.showApprovalInfo=false}this.selectOption(e)}this.isOpen=!this.isOpen;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}selectApprovalStatus({status:e}){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.TOOL_BAR,"Ready To Sync");this.waitDialogService.showWaitModal(null);try{yield this.pageService.forcePageApprovalStatus(e);this.crossFrameEventService.publish(l.EVENTS.PAGE_UPDATED);this.routingService.reload()}catch(e){this.logService.warn("[PageApprovalSelector] - Can't change page status.",e)}finally{this.waitDialogService.hideWaitModal();this.unselectOptions()}}))}getCurrentPageApprovalStatus(){return __awaiter(this,void 0,void 0,(function*(){const{approvalStatus:e}=yield this.pageService.getCurrentPageInfo();return e}))}hideComponentIfWorkflowInProgress(){return __awaiter(this,void 0,void 0,(function*(){const{uuid:e}=yield this.pageService.getCurrentPageInfo();const t=yield this.workflowService.getActiveWorkflowForPageUuid(e);this.showDropdown=!t;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}selectOption(e){this.unselectOptions();const t=this.getOptions();if(t[e]){t[e].selected=true}this.pageApprovalOptionsSubject.next(t)}unselectOptions(){const e=this.getOptions();Object.keys(e).forEach((t=>{e[t].selected=false}));this.pageApprovalOptionsSubject.next(e)}getOptions(){return Object.assign({},this.pageApprovalOptionsSubject.getValue())}closeDropdown(){this.isOpen=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}};vi=__decorate([n.Component({selector:"se-page-approval-selector",template:`<fd-popover *ngIf="showDropdown" [triggers]="[]" [closeOnOutsideClick]="false" [isOpen]="isOpen" [placement]="'bottom-end'"><fd-popover-control><button fd-button (click)="onClickDropdown()" class="se-page-approval-selector__toggle-btn fd-button fd-button--transparent" [fdMenu]="true"></button></fd-popover-control><fd-popover-body><div *ngIf="showApprovalInfo" class="se-page-approval-info">{{ approvalInfo }}</div><div *ngIf="!showApprovalInfo"><ul fd-list class="se-dropdown-menu__list se-page-approval-selector-list"><se-dropdown-menu-item *ngFor="let dropdownItem of pageApprovalOptions$ | async" [dropdownItem]="dropdownItem"></se-dropdown-menu-item></ul></div></fd-popover-body></fd-popover>`,styles:[`.se-page-approval-selector__toggle-btn{color:var(--sapLinkColor);background-color:unset}.se-page-approval-selector__toggle-btn::before{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-page-approval-selector__toggle-btn:active,.se-page-approval-selector__toggle-btn:focus{box-shadow:none}.se-page-approval-selector__toggle-btn:active,.se-page-approval-selector__toggle-btn:hover{outline:0;border-color:var(--sapButton_Hover_BorderColor);background-color:var(--sapBaseColor);border:.0625rem solid}.se-page-approval-selector__icon--draft,.se-page-approval-selector__icon--ready-to-sync{width:12px;height:12px;border-radius:50%;margin-right:10px}.se-page-approval-selector__icon--draft{background-color:var(--sapNeutralColor)}.se-page-approval-selector__icon--ready-to-sync{background-color:var(--sapInformativeColor)}.se-page-approval-selector-list{margin:0;min-width:190px;border-radius:4px;padding:0}.se-page-approval-selector .se-dropdown-item{display:flex;align-items:center}.se-page-approval-selector .se-dropdown-item:hover{background-color:var(--sapBackgroundColor,#f7f7f7)}.se-page-approval-selector .fd-popover-container-custom{box-shadow:var(--sapContent_Shadow0)}.se-page-approval-selector .fd-menu{padding:0}.se-page-approval-info{width:320px;white-space:normal;padding:16px}`],host:{"[class.se-page-approval-selector]":"true"},encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.IIframeClickDetectionService,l.IPageService,l.IWaitDialogService,l.WorkflowService,l.CrossFrameEventService,l.SmarteditRoutingService,l.LogService,n.ChangeDetectorRef,l.IUserTrackingService])],vi);window.__smartedit__.addDecoratorPayload("Component","PageStatusComponent",{selector:"se-page-status",template:`<div class="se-page-status"><div class="se-page-status__icon" [ngClass]="statusIconCssClass"></div><div class="se-page-status__label">{{ statusLabel | translate }}</div></div>`,styles:[`.se-page-status{display:flex;flex-direction:row;align-items:center}.se-page-status__label{white-space:nowrap;line-height:2.4375rem}.se-page-status__icon{float:left;margin-left:10px;margin-right:10px}.se-page-status__icon--draft{width:12px;height:12px;border-radius:50%;background-color:var(--sapField_PlaceholderTextColor)}.se-page-status__icon--in_progress{width:12px;height:12px;border-radius:50%;background-color:var(--sapIndicationColor_3)}.se-page-status__icon--ready_to_sync{width:12px;height:12px;border-radius:50%;background-color:var(--sapIndicationColor_5)}.se-page-status__icon--synced{width:12px;height:12px;border-radius:50%;background-color:var(--sapPositiveColor)}.se-page-status__icon--locked{color:var(--sapTextColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let fi=class PageStatusComponent{constructor(e,t){this.workflowService=e;this.cdr=t;this.LOCALIZATION_PREFIX="se.cms.page.displaystatus."}ngOnChanges(e){return __awaiter(this,void 0,void 0,(function*(){const t=e.uuid;const i=e.displayStatus;let o=false;if(t&&t.currentValue){this.isPageLocked=yield this.isPageLockedToCurrentUser(this.uuid);o=true}if(i&&i.currentValue){const e=this.displayStatus.toLowerCase();this.statusLabel=`${this.LOCALIZATION_PREFIX}${e}`;this.statusIconCssClass=this.getStatusIconCssClass(this.isPageLocked,e)}if(o){if(!this.cdr.destroyed){this.cdr.detectChanges()}}}))}isPageLockedToCurrentUser(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.workflowService.getActiveWorkflowForPageUuid(e);return t&&!t.isAvailableForCurrentPrincipal}))}getStatusIconCssClass(e,t){return e?"sap-icon--locked se-page-status__icon--locked":`se-page-status__icon--${t}`}};__decorate([n.Input(),__metadata("design:type",Object)],fi.prototype,"uuid",void 0);__decorate([n.Input(),__metadata("design:type",Object)],fi.prototype,"displayStatus",void 0);fi=__decorate([n.Component({selector:"se-page-status",template:`<div class="se-page-status"><div class="se-page-status__icon" [ngClass]="statusIconCssClass"></div><div class="se-page-status__label">{{ statusLabel | translate }}</div></div>`,styles:[`.se-page-status{display:flex;flex-direction:row;align-items:center}.se-page-status__label{white-space:nowrap;line-height:2.4375rem}.se-page-status__icon{float:left;margin-left:10px;margin-right:10px}.se-page-status__icon--draft{width:12px;height:12px;border-radius:50%;background-color:var(--sapField_PlaceholderTextColor)}.se-page-status__icon--in_progress{width:12px;height:12px;border-radius:50%;background-color:var(--sapIndicationColor_3)}.se-page-status__icon--ready_to_sync{width:12px;height:12px;border-radius:50%;background-color:var(--sapIndicationColor_5)}.se-page-status__icon--synced{width:12px;height:12px;border-radius:50%;background-color:var(--sapPositiveColor)}.se-page-status__icon--locked{color:var(--sapTextColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.WorkflowService,n.ChangeDetectorRef])],fi);const yi="CMS_EVENT_OPEN_PAGE_WORKFLOW_MENU";const Si="WORKFLOW_TASKS_MENU_OPENED_EVENT";const Ci="WORKFLOW_DECISION_SELECTED_EVENT";const bi="CMS_EVENT_OPEN_WORKFLOW_INBOX_DROPDOWN";const Ii="WORKFLOW_ITEM_MENU_OPENED_EVENT";const Ei="WORKFLOW_REFRESH_EVENT";window.__smartedit__.addDecoratorPayload("Component","PageDisplayStatusComponent",{selector:"se-page-display-status",template:`<ng-container *ngIf="showLastSyncTime; else pageStatus"><se-tooltip [triggers]="['click']" [placement]="'left'" [isChevronVisible]="true"><ng-container se-tooltip-trigger *ngTemplateOutlet="pageStatus"></ng-container><div se-tooltip-body class="popover-tooltip"><ng-container *ngIf="hasBeenSynchedBefore(); else notPublished"><span [translate]="'se.cms.page.displaystatus.lastpublished.date'"></span> <span>&ngsp;{{ lastSynchedDate | date: 'M/d/yy h:mm a' }}</span></ng-container><ng-template #notPublished><span [translate]="'se.cms.page.displaystatus.not.published'"></span></ng-template></div></se-tooltip></ng-container><ng-template #pageStatus><se-page-status [uuid]="page?.uuid" [displayStatus]="page?.displayStatus"></se-page-status></ng-template>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let wi=class PageDisplayStatusComponent{constructor(e,t,i,o){this.pageService=e;this.crossFrameEventService=t;this.systemEventService=i;this.cdr=o;this.showLastSyncTime=true}ngOnInit(){var e;return __awaiter(this,void 0,void 0,(function*(){this.unRegPageSyncEvent=this.crossFrameEventService.subscribe(r.DEFAULT_SYNCHRONIZATION_POLLING.FETCH_STATUS,((e,t)=>this.updateLastSynchedDate(t)));this.unRegPageUpdatedEvent=this.crossFrameEventService.subscribe(l.EVENTS.PAGE_UPDATED,((e,t)=>this.updatePageInfo((t===null||t===void 0?void 0:t.uuid)||null)));const t=((e=this.cmsPage)===null||e===void 0?void 0:e.uuid)||null;yield this.initPageInfo(t)}))}ngOnDestroy(){this.unRegPageSyncEvent();this.unRegPageUpdatedEvent()}hasBeenSynchedBefore(){return this.lastSynchedDate!==undefined}initPageInfo(e){return __awaiter(this,void 0,void 0,(function*(){this.page=yield e?this.cmsPage:this.pageService.getCurrentPageInfo();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}updateLastSynchedDate(e){if(this.canUpdateLastSynchedDate(e.itemId)&&this.lastSynchedDate!==e.lastSyncStatus){this.lastSynchedDate=e.lastSyncStatus;if(!this.cdr.destroyed){this.cdr.detectChanges()}}}updatePageInfo(e){var t;return __awaiter(this,void 0,void 0,(function*(){if(!this.canUpdatePageInfo(e)){return}const i=(t=this.page)===null||t===void 0?void 0:t.displayStatus;this.page=yield this.pageService.getCurrentPageInfo();if(!!i&&this.page.displayStatus==="DRAFT"){this.systemEventService.publish(Ei)}if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}canUpdateLastSynchedDate(e){return this.page&&this.page.uuid===e}canUpdatePageInfo(e){return!e||this.page&&this.page.uuid===e}};__decorate([n.Input(),__metadata("design:type",Object)],wi.prototype,"cmsPage",void 0);__decorate([n.Input(),__metadata("design:type",Object)],wi.prototype,"showLastSyncTime",void 0);wi=__decorate([n.Component({selector:"se-page-display-status",template:`<ng-container *ngIf="showLastSyncTime; else pageStatus"><se-tooltip [triggers]="['click']" [placement]="'left'" [isChevronVisible]="true"><ng-container se-tooltip-trigger *ngTemplateOutlet="pageStatus"></ng-container><div se-tooltip-body class="popover-tooltip"><ng-container *ngIf="hasBeenSynchedBefore(); else notPublished"><span [translate]="'se.cms.page.displaystatus.lastpublished.date'"></span> <span>&ngsp;{{ lastSynchedDate | date: 'M/d/yy h:mm a' }}</span></ng-container><ng-template #notPublished><span [translate]="'se.cms.page.displaystatus.not.published'"></span></ng-template></div></se-tooltip></ng-container><ng-template #pageStatus><se-page-status [uuid]="page?.uuid" [displayStatus]="page?.displayStatus"></se-page-status></ng-template>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.IPageService,l.CrossFrameEventService,l.SystemEventService,n.ChangeDetectorRef])],wi);window.__smartedit__.addDecoratorPayload("Component","PageDisplayStatusWrapperComponent",{selector:"se-page-display-status-wrapper",template:`\n        <div class="se-page-status-toolbar-container">\n            <se-page-display-status></se-page-display-status>\n        </div>\n    `,styles:[`\n            .se-page-status-toolbar-container {\n                padding-left: 5px;\n                padding-right: 20px;\n                height: 100%;\n                display: flex;\n                align-items: center;\n                border-left: 1px solid var(--sapGroup_ContentBorderColor);\n            }\n        `],changeDetection:n.ChangeDetectionStrategy.OnPush});let Ti=class PageDisplayStatusWrapperComponent{};Ti=__decorate([n.Component({selector:"se-page-display-status-wrapper",template:`\n        <div class="se-page-status-toolbar-container">\n            <se-page-display-status></se-page-display-status>\n        </div>\n    `,styles:[`\n            .se-page-status-toolbar-container {\n                padding-left: 5px;\n                padding-right: 20px;\n                height: 100%;\n                display: flex;\n                align-items: center;\n                border-left: 1px solid var(--sapGroup_ContentBorderColor);\n            }\n        `],changeDetection:n.ChangeDetectionStrategy.OnPush})],Ti);window.__smartedit__.addDecoratorPayload("Component","PageInWorkflowNotificationComponent",{selector:"se-page-in-workflow-notification",template:`<div><span translate="se.cms.workflow.page.in.workflow"></span></div>`});let Pi=class PageInWorkflowNotificationComponent{};Pi=__decorate([l.SeCustomComponent(),n.Component({selector:"se-page-in-workflow-notification",template:`<div><span translate="se.cms.workflow.page.in.workflow"></span></div>`})],Pi);let Oi=class WorkflowFacade{constructor(e,t,i,o,n,s,a){this.alertService=e;this.workflowService=t;this.confirmationModalService=i;this.genericEditorModalService=o;this.pageInfoService=n;this.systemEventService=s;this.l10nPipe=a;this.VERSION_LABEL_QUALIFIER="versionLabel";this.CREATE_VERSION_QUALIFIER="createVersion";this.SYNC_POLLING_SPEED_PREFIX="workflow-";this.startWorkflowStructureAttributes=[{cmsStructureType:"EditableDropdown",qualifier:"templateCode",i18nKey:"se.cms.workflow.editor.template",localized:false,required:true,idAttribute:"code",labelAttributes:["name"]},{cmsStructureType:"LongString",qualifier:"description",i18nKey:"se.cms.workflow.editor.description",required:false},{cmsStructureType:"WorkflowCreateVersionField",qualifier:this.CREATE_VERSION_QUALIFIER,required:false}];this.editWorkflowStructureAttributes=[{cmsStructureType:"LongString",qualifier:"description",i18nKey:"se.cms.workflow.editor.description",required:false}];this.makeDecisionStructureAttributes=[{cmsStructureType:"LongString",qualifier:"comment",i18nKey:"se.cms.workflow.editor.comment",required:false},{cmsStructureType:"WorkflowCreateVersionField",qualifier:this.CREATE_VERSION_QUALIFIER,required:false}]}startWorkflow(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getWorkflowDataForEditor();const t=this.systemEventService.subscribe(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,((e,t)=>this.handleUnrelatedValidationErrors(e,t)));try{return yield this.genericEditorModalService.open(e,(e=>{this.alertService.showSuccess("se.cms.workflow.create.alert.success");this.systemEventService.publish(r.WORKFLOW_CREATED_EVENT);this.updateWorkflowTasksCount();return e}))}finally{t()}}))}cancelWorflow(e){return __awaiter(this,void 0,void 0,(function*(){yield this.confirmationModalService.confirm({title:"se.cms.workflow.cancel.confirmation.title",description:"se.cms.workflow.cancel.confirmation.description"});try{yield this.workflowService.cancelWorflow(e);this.alertService.showSuccess("se.cms.workflow.cancel.alert.success")}finally{this.systemEventService.publish(r.WORKFLOW_FINISHED_EVENT);this.updateWorkflowTasksCount()}}))}editWorkflow(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getWorkflowDataForEditor(e);return this.genericEditorModalService.open(t,(e=>e))}))}updateWorkflowTasksCount(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield typeof e==="undefined"?this.getTotalNumberOfTasks():e;this.workflowService.updateWorkflowTasksCount(t)}))}getAllActionsForWorkflow(e){return this.workflowService.getAllActionsForWorkflowCode(e)}getActiveActionsForWorkflow(e){return this.workflowService.getActiveActionsForWorkflowCode(e)}getCommentsForWorkflowAction(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.workflowService.getCommentsForWorkflowAction(e,t,i);o.results=o.comments;delete o.comments;return o}))}getWorkflowInboxTasks(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.workflowService.getWorkflowInboxTasks(e);t.results=t.tasks;delete t.tasks;return t}))}getTotalNumberOfTasks(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getWorkflowInboxTasks({pageSize:1,currentPage:0});return e.pagination.totalCount}))}makeDecision(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o={title:yield this.l10nPipe.transform(i.name).pipe(d.take(1)).toPromise(),structure:{attributes:this.makeDecisionStructureAttributes},contentApi:this.workflowService.getResourceWorkflowOperationsURI(),saveLabel:"se.cms.workflow.editor.button.submit",content:{operation:l.WorkflowOperations.MAKE_DECISION,workflowCode:e,actionCode:t.code,decisionCode:i.code},initialDirty:true};return this.genericEditorModalService.open(o,(e=>__awaiter(this,void 0,void 0,(function*(){yield this.confirmDecision(e.status,t,i);return e}))),null)}))}confirmDecision(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.pageInfoService.getPageUUID();yield this.systemEventService.publish(r.DEFAULT_SYNCHRONIZATION_POLLING.SPEED_UP,this.SYNC_POLLING_SPEED_PREFIX+o);if(e.toLowerCase()===l.WorkflowStatus.FINISHED){this.alertService.showSuccess("se.cms.workflow.completed.alert.success");this.systemEventService.publishAsync(r.WORKFLOW_FINISHED_EVENT)}else{this.alertService.showSuccess({message:"se.cms.workflow.make.decision.success",messagePlaceholders:{workflowDecisionName:yield this.l10nPipe.transform(i.name).pipe(d.take(1)).toPromise(),workflowActionName:yield this.l10nPipe.transform(t.name).pipe(d.take(1)).toPromise()},minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"})}this.systemEventService.publish(r.DEFAULT_SYNCHRONIZATION_POLLING.SLOW_DOWN,this.SYNC_POLLING_SPEED_PREFIX+o);const n=yield this.getTotalNumberOfTasks();this.updateWorkflowTasksCount(n)}))}getWorkflowDataForEditor(e=null){return __awaiter(this,void 0,void 0,(function*(){const t=e===null;const i={title:null,contentApi:this.workflowService.getResourceWorkflowURI()};return t?this.getComponentDataForStartingWorkflow(i):this.getComponentDataForNonStartingWorkflow(i,e.workflowCode)}))}getComponentDataForStartingWorkflow(e){return __awaiter(this,void 0,void 0,(function*(){const t=this.startWorkflowStructureAttributes.find((e=>e.qualifier==="templateCode"));const i=yield this.workflowService.getWorkflowTemplates({});t.options=i;e.title="se.cms.workflow.editor.start.workflow.title";e.saveLabel="se.cms.workflow.editor.button.start";e.structure={attributes:this.startWorkflowStructureAttributes};const o=yield this.pageInfoService.getPageUUID();e.content={attachments:[o]};return e}))}getComponentDataForNonStartingWorkflow(e,t){e.title="se.cms.workflow.editor.edit.workflow.title";e.saveLabel="se.cms.workflow.editor.button.save";e.structure={attributes:this.editWorkflowStructureAttributes};e.componentUuid=t;e.componentType="workflow";return e}handleUnrelatedValidationErrors(e,t){if(!t.sourceGenericEditorId){return}let i="";const o=[];t.messages.forEach((e=>{if(e.subject===this.VERSION_LABEL_QUALIFIER){e.subject=this.CREATE_VERSION_QUALIFIER;o.push(e)}else{i+=e.message+" "}}));if(i){this.alertService.showDanger(i)}if(o.length>0){this.systemEventService.publishAsync(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,{messages:o})}}};Oi=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IAlertService,l.WorkflowService,l.IConfirmationModalService,t.GenericEditorModalService,l.IPageInfoService,l.SystemEventService,l.L10nPipe])],Oi);window.__smartedit__.addDecoratorPayload("Component","PageWorkflowMenuAllTasksTabComponent",{selector:"se-page-workflow-menu-all-tasks-tab",template:`\n        <se-page-workflow-menu-tasks-tab\n            [actions]="actions"\n            [workflow]="workflow"\n            [canMakeDecisions]="false">\n        </se-page-workflow-menu-tasks-tab>\n    `});let Ai=class PageWorkflowMenuAllTasksTabComponent{constructor(e){({actions:this.actions,workflow:this.workflow}=e.model)}};Ai=__decorate([n.Component({selector:"se-page-workflow-menu-all-tasks-tab",template:`\n        <se-page-workflow-menu-tasks-tab\n            [actions]="actions"\n            [workflow]="workflow"\n            [canMakeDecisions]="false">\n        </se-page-workflow-menu-tasks-tab>\n    `}),__param(0,n.Inject(l.TAB_DATA)),__metadata("design:paramtypes",[Object])],Ai);window.__smartedit__.addDecoratorPayload("Component","PageWorkflowMenuCurrentTasksTabComponent",{selector:"se-page-workflow-menu-current-tasks-tab",template:`\n        <se-page-workflow-menu-tasks-tab\n            [actions]="currentActions"\n            [workflow]="workflow"\n            [canMakeDecisions]="true">\n        </se-page-workflow-menu-tasks-tab>\n    `});let xi=class PageWorkflowMenuCurrentTasksTabComponent{constructor(e){({actions:this.actions,workflow:this.workflow}=e.model)}ngOnInit(){this.currentActions=this.actions.filter((e=>e.status.toLowerCase()===l.WorkflowActionStatus.IN_PROGRESS))}};xi=__decorate([n.Component({selector:"se-page-workflow-menu-current-tasks-tab",template:`\n        <se-page-workflow-menu-tasks-tab\n            [actions]="currentActions"\n            [workflow]="workflow"\n            [canMakeDecisions]="true">\n        </se-page-workflow-menu-tasks-tab>\n    `}),__param(0,n.Inject(l.TAB_DATA)),__metadata("design:paramtypes",[Object])],xi);window.__smartedit__.addDecoratorPayload("Component","PageWorkflowMenuComponent",{selector:"se-page-workflow-menu",template:`<div *ngIf="isReady"><div *ngIf="!pageHasWorkflow && isWorkflowEnabled"><ng-container *seHasOperationPermission="'se.start.page.workflow'"><button fd-button id="smartEditPerspectiveToolbar_option_se.cms.startWorkflow_btn" class="btn toolbar-action--button" type="button" (click)="startWorkflow()" aria-expanded="false"><span id="smartEditPerspectiveToolbar_option_se.cms.startWorkflow_btn_lbl" class="toolbar-action-button__txt" translate="se.cms.workflow.toolbar.start.workflow"></span></button></ng-container></div><div *seHasOperationPermission="'se.view.page.workflowMenu'"><fd-popover *ngIf="pageHasWorkflow" class="toolbar-action" [closeOnOutsideClick]="true" [isOpen]="actionItem.isOpen" (isOpenChange)="onDropdownToggle($event)" [additionalBodyClass]="'se-page-workflow-menu-body'"><fd-popover-control><button fd-button id="pageTaskBtn" type="button" class="page-tasks-btn toolbar-action--button" [attr.aria-expanded]="actionItem.isOpen"><span class="page-tasks-btn__icon sap-icon--workflow-tasks"></span> <span class="page-tasks-btn__label" translate="se.cms.workflow.toolbar.view.workflow.menu"></span></button></fd-popover-control><fd-popover-body><div *ngIf="actionItem.isOpen" class="toolbar-action--include se-page-workflow-menu-body-content"><div class="se-page-workflow-menu-body-content__header"><div class="se-page-workflow-menu-body-content__header-text" translate="se.cms.workflow.toolbar.view.workflow.menu"></div><div class="se-page-workflow-menu-body-content__header-menu"><se-workflow-item-menu (isMenuOpenChange)="onDropdownToggle($event)" [workflowInfo]="workflow"></se-workflow-item-menu></div></div><div class="se-version-toolbar-menu-content__body"><div class="se-page-workflow-menu-body__tabs"><se-tabs *ngIf="areTabsReady; else spinner" [tabsList]="tabsList" [model]="tabsData" [numTabsDisplayed]="2"></se-tabs><ng-template #spinner><se-spinner [isSpinning]="true"></se-spinner></ng-template></div></div></div></fd-popover-body></fd-popover></div></div>`,styles:[`/*!\n * Fundamental Library Styles v0.23.0\n * Copyright (c) 2022 SAP SE or an SAP affiliate company.\n * Licensed under Apache License 2.0 (https://github.com/SAP/fundamental-styles/blob/main/LICENSE)\n *//*!\n.fd-button-split+()\n    .fd-button\n*/.fd-button-split{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;position:relative}.fd-button-split:after,.fd-button-split:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split>:first-child{margin:0;border-top-right-radius:0;border-bottom-right-radius:0}.fd-button-split>:nth-child(2){margin:0;border-top-left-radius:0;border-bottom-left-radius:0}.fd-button-split>:nth-child(2):not(.fd-button--transparent){border-left-width:0}.fd-button-split[dir=rtl]>:first-child,[dir=rtl] .fd-button-split>:first-child{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--sapButton_BorderCornerRadius);border-bottom-right-radius:var(--sapButton_BorderCornerRadius)}.fd-button-split[dir=rtl]>:nth-child(2),[dir=rtl] .fd-button-split>:nth-child(2){border-top-left-radius:var(--sapButton_BorderCornerRadius);border-bottom-left-radius:var(--sapButton_BorderCornerRadius);border-top-right-radius:0;border-bottom-right-radius:0;border-left-width:var(--sapButton_BorderWidth)}.fd-button-split[dir=rtl]>:nth-child(2):not(.fd-button--transparent),[dir=rtl] .fd-button-split>:nth-child(2):not(.fd-button--transparent){border-right-width:0}.fd-button-split>[class*="--emphasized"]:first-child{margin-right:.0625rem}.fd-button-split>[class*="--emphasized"][dir=rtl]:first-child,[dir=rtl] .fd-button-split>[class*="--emphasized"]:first-child{margin-right:0;margin-left:.0625rem}.fd-button-split>:first-child{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.fd-button-split>:first-child .fd-button-split__text{display:inline-block}.fd-button-split>:first-child:hover .fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split>:first-child:active .fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]>.fd-button-split__text{color:var(--sapButton_Emphasized_TextColor);font-weight:700}.fd-button-split--emphasized>[class*="--emphasized"]:hover>.fd-button-split__text{color:var(--sapButton_Emphasized_Hover_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--transparent>[class*="--transparent"]>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:hover>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split .fd-button-split__text{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--sapButton_TextColor);max-width:9.75rem;display:block}.fd-button-split .fd-button-split__text:after,.fd-button-split .fd-button-split__text:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split .fd-button-split__text--compact{max-width:10rem}se-page-workflow-menu .toolbar-action .page-tasks-btn[aria-expanded=true]{background-color:var(--sapList_SelectionBackgroundColor)}se-page-workflow-menu .toolbar-action .page-tasks-btn__label{font-size:14px;color:var(--sapTextColor)}se-page-workflow-menu .toolbar-action .page-tasks-btn__icon{color:var(--sapIndicationColor_5);font-size:18px;margin-right:8px}.se-page-workflow-menu-body-content{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;min-width:350px;min-height:130px;right:-126px;left:auto;font-size:16px;line-height:calc(20 / 16)}.se-page-workflow-menu-body-content::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.se-page-workflow-menu-body-content::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.se-page-workflow-menu-body-content,.se-page-workflow-menu-body-content::after,.se-page-workflow-menu-body-content::before{left:50%;transform:translate(-50%)}.se-page-workflow-menu-body-content__header{display:flex;justify-content:space-between}.se-page-workflow-menu-body-content__header-text{font-size:16px;padding:20px 0 0 16px}.se-page-workflow-menu-body-content__header-menu{padding:16px 16px 0 0}.se-page-workflow-menu-body__tabs .se-tabset{margin:0;padding:0!important}.se-page-workflow-menu-body__tabs .se-tabset__tab{margin-left:16px!important}.se-page-workflow-menu-body__tabs .se-tabset__link{color:var(--sapTextColor)}.se-page-workflow-menu-body__tabs .se-tabset__link:hover{color:var(--sapIndicationColor_5)}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let Di=class PageWorkflowMenuComponent{constructor(e,t,i,o,n,s,a){this.workflowService=e;this.workflowFacade=t;this.systemEventService=i;this.routingService=o;this.pageService=n;this.cdr=s;this.actionItem=a;this.isReady=false;this.isWorkflowEnabled=false;this.areTabsReady=false;this.pageHasWorkflow=false;this.tabsList=[{id:"currentTasksTab",title:"se.cms.page.workflow.tabs.currenttasks",hasErrors:false,component:xi},{id:"allTasksTab",title:"se.cms.page.workflow.tabs.alltasks",hasErrors:false,component:Ai}];this.tabsData={workflow:null,actions:[]}}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.unRegOpenMenuEvent=this.systemEventService.subscribe(yi,((e,t)=>this.onDropdownToggle(t)));this.unRegPerspectiveChangedEvent=this.systemEventService.subscribe(l.EVENT_PERSPECTIVE_CHANGED,(()=>this.loadWorkflow()));this.unRegWorkflowFinishedEvent=this.systemEventService.subscribe(r.WORKFLOW_FINISHED_EVENT,(()=>this.loadWorkflow()));this.unRegDecisionSelectedEvent=this.systemEventService.subscribe(Ci,(()=>this.closeDropdown()));this.unRegWorkflowRefreshEvent=this.systemEventService.subscribe(Ei,(()=>this.loadWorkflow()));yield this.loadWorkflow();this.isReady=true;this.actionItem.isOpen=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnDestroy(){this.unRegOpenMenuEvent();this.unRegPerspectiveChangedEvent();this.unRegWorkflowFinishedEvent();this.unRegDecisionSelectedEvent();this.unRegWorkflowRefreshEvent()}set workflow(e){this._workflow=e;this.tabsData.workflow=e}get workflow(){return this._workflow}onDropdownToggle(e){return __awaiter(this,void 0,void 0,(function*(){this.actionItem.isOpen=e;if(!e){return}this.systemEventService.publish(Si);yield this.loadWorkflowAndActions()}))}startWorkflow(){return __awaiter(this,void 0,void 0,(function*(){yield this.workflowFacade.startWorkflow();this.routingService.reload()}))}loadWorkflowAndActions(){return __awaiter(this,void 0,void 0,(function*(){this.areTabsReady=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}yield this.loadWorkflow(false);yield this.loadActions();this.areTabsReady=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}loadWorkflow(e=true){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageService.getCurrentPageInfo();const i=yield this.workflowService.getActiveWorkflowForPageUuid(t.uuid);this.workflow=i;this.pageHasWorkflow=!!i;this.isWorkflowEnabled=t.displayStatus==="DRAFT";if(e){if(!this.cdr.destroyed){this.cdr.detectChanges()}}}))}loadActions(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.workflowFacade.getAllActionsForWorkflow(this.workflow.workflowCode);this.setActions(e)}))}setActions(e){e.sort(((e,t)=>this.actionComparator(e,t)));this.tabsData.actions=e}closeDropdown(){this.actionItem.isOpen=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}actionComparator(e,t){const i=this.getActionPriority(e);const o=this.getActionPriority(t);return i!==o?i-o:e.startedAgoInMillis-t.startedAgoInMillis}getActionPriority(e){switch(e.status.toLowerCase()){case l.WorkflowActionStatus.IN_PROGRESS:return 1;case l.WorkflowActionStatus.PENDING:return 2;case l.WorkflowActionStatus.COMPLETED:return 3;default:return 4}}};Di=__decorate([n.Component({selector:"se-page-workflow-menu",template:`<div *ngIf="isReady"><div *ngIf="!pageHasWorkflow && isWorkflowEnabled"><ng-container *seHasOperationPermission="'se.start.page.workflow'"><button fd-button id="smartEditPerspectiveToolbar_option_se.cms.startWorkflow_btn" class="btn toolbar-action--button" type="button" (click)="startWorkflow()" aria-expanded="false"><span id="smartEditPerspectiveToolbar_option_se.cms.startWorkflow_btn_lbl" class="toolbar-action-button__txt" translate="se.cms.workflow.toolbar.start.workflow"></span></button></ng-container></div><div *seHasOperationPermission="'se.view.page.workflowMenu'"><fd-popover *ngIf="pageHasWorkflow" class="toolbar-action" [closeOnOutsideClick]="true" [isOpen]="actionItem.isOpen" (isOpenChange)="onDropdownToggle($event)" [additionalBodyClass]="'se-page-workflow-menu-body'"><fd-popover-control><button fd-button id="pageTaskBtn" type="button" class="page-tasks-btn toolbar-action--button" [attr.aria-expanded]="actionItem.isOpen"><span class="page-tasks-btn__icon sap-icon--workflow-tasks"></span> <span class="page-tasks-btn__label" translate="se.cms.workflow.toolbar.view.workflow.menu"></span></button></fd-popover-control><fd-popover-body><div *ngIf="actionItem.isOpen" class="toolbar-action--include se-page-workflow-menu-body-content"><div class="se-page-workflow-menu-body-content__header"><div class="se-page-workflow-menu-body-content__header-text" translate="se.cms.workflow.toolbar.view.workflow.menu"></div><div class="se-page-workflow-menu-body-content__header-menu"><se-workflow-item-menu (isMenuOpenChange)="onDropdownToggle($event)" [workflowInfo]="workflow"></se-workflow-item-menu></div></div><div class="se-version-toolbar-menu-content__body"><div class="se-page-workflow-menu-body__tabs"><se-tabs *ngIf="areTabsReady; else spinner" [tabsList]="tabsList" [model]="tabsData" [numTabsDisplayed]="2"></se-tabs><ng-template #spinner><se-spinner [isSpinning]="true"></se-spinner></ng-template></div></div></div></fd-popover-body></fd-popover></div></div>`,styles:[`/*!\n * Fundamental Library Styles v0.23.0\n * Copyright (c) 2022 SAP SE or an SAP affiliate company.\n * Licensed under Apache License 2.0 (https://github.com/SAP/fundamental-styles/blob/main/LICENSE)\n *//*!\n.fd-button-split+()\n    .fd-button\n*/.fd-button-split{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;position:relative}.fd-button-split:after,.fd-button-split:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split>:first-child{margin:0;border-top-right-radius:0;border-bottom-right-radius:0}.fd-button-split>:nth-child(2){margin:0;border-top-left-radius:0;border-bottom-left-radius:0}.fd-button-split>:nth-child(2):not(.fd-button--transparent){border-left-width:0}.fd-button-split[dir=rtl]>:first-child,[dir=rtl] .fd-button-split>:first-child{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--sapButton_BorderCornerRadius);border-bottom-right-radius:var(--sapButton_BorderCornerRadius)}.fd-button-split[dir=rtl]>:nth-child(2),[dir=rtl] .fd-button-split>:nth-child(2){border-top-left-radius:var(--sapButton_BorderCornerRadius);border-bottom-left-radius:var(--sapButton_BorderCornerRadius);border-top-right-radius:0;border-bottom-right-radius:0;border-left-width:var(--sapButton_BorderWidth)}.fd-button-split[dir=rtl]>:nth-child(2):not(.fd-button--transparent),[dir=rtl] .fd-button-split>:nth-child(2):not(.fd-button--transparent){border-right-width:0}.fd-button-split>[class*="--emphasized"]:first-child{margin-right:.0625rem}.fd-button-split>[class*="--emphasized"][dir=rtl]:first-child,[dir=rtl] .fd-button-split>[class*="--emphasized"]:first-child{margin-right:0;margin-left:.0625rem}.fd-button-split>:first-child{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.fd-button-split>:first-child .fd-button-split__text{display:inline-block}.fd-button-split>:first-child:hover .fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split>:first-child:active .fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]>.fd-button-split__text{color:var(--sapButton_Emphasized_TextColor);font-weight:700}.fd-button-split--emphasized>[class*="--emphasized"]:hover>.fd-button-split__text{color:var(--sapButton_Emphasized_Hover_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--transparent>[class*="--transparent"]>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:hover>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split .fd-button-split__text{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--sapButton_TextColor);max-width:9.75rem;display:block}.fd-button-split .fd-button-split__text:after,.fd-button-split .fd-button-split__text:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split .fd-button-split__text--compact{max-width:10rem}se-page-workflow-menu .toolbar-action .page-tasks-btn[aria-expanded=true]{background-color:var(--sapList_SelectionBackgroundColor)}se-page-workflow-menu .toolbar-action .page-tasks-btn__label{font-size:14px;color:var(--sapTextColor)}se-page-workflow-menu .toolbar-action .page-tasks-btn__icon{color:var(--sapIndicationColor_5);font-size:18px;margin-right:8px}.se-page-workflow-menu-body-content{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;min-width:350px;min-height:130px;right:-126px;left:auto;font-size:16px;line-height:calc(20 / 16)}.se-page-workflow-menu-body-content::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.se-page-workflow-menu-body-content::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.se-page-workflow-menu-body-content,.se-page-workflow-menu-body-content::after,.se-page-workflow-menu-body-content::before{left:50%;transform:translate(-50%)}.se-page-workflow-menu-body-content__header{display:flex;justify-content:space-between}.se-page-workflow-menu-body-content__header-text{font-size:16px;padding:20px 0 0 16px}.se-page-workflow-menu-body-content__header-menu{padding:16px 16px 0 0}.se-page-workflow-menu-body__tabs .se-tabset{margin:0;padding:0!important}.se-page-workflow-menu-body__tabs .se-tabset__tab{margin-left:16px!important}.se-page-workflow-menu-body__tabs .se-tabset__link{color:var(--sapTextColor)}.se-page-workflow-menu-body__tabs .se-tabset__link:hover{color:var(--sapIndicationColor_5)}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(6,n.Inject(l.TOOLBAR_ITEM)),__metadata("design:paramtypes",[l.WorkflowService,Oi,l.SystemEventService,l.SmarteditRoutingService,l.IPageService,n.ChangeDetectorRef,Object])],Di);window.__smartedit__.addDecoratorPayload("Component","WorkflowInboxMultipleTasksAnnouncementComponent",{selector:"se-workflow-inbox-multiple-tasks-announcement",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div (click)="onClick($event)" class="se-announcement__message--multi">{{ 'se.cms.workflow.tasks.announcement' | translate: count }}</div>`});let Ri=class WorkflowInboxMultipleTasksAnnouncementComponent{constructor(e,t,i){this.systemEventService=e;this.announcementService=t;this.count={announcementCount:null};({id:this.announcementId,tasks:this.tasks}=i)}ngOnInit(){this.count.announcementCount=String(this.tasks.length)}onClick(e){e.stopPropagation();this.systemEventService.publish(bi);this.announcementService.closeAnnouncement(this.announcementId)}};Ri=__decorate([n.Component({selector:"se-workflow-inbox-multiple-tasks-announcement",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div (click)="onClick($event)" class="se-announcement__message--multi">{{ 'se.cms.workflow.tasks.announcement' | translate: count }}</div>`}),__param(2,n.Inject(l.ANNOUNCEMENT_DATA)),__metadata("design:paramtypes",[l.SystemEventService,l.IAnnouncementService,Object])],Ri);window.__smartedit__.addDecoratorPayload("Component","WorkflowInboxSingleTaskAnnouncementComponent",{selector:"se-workflow-inbox-single-task-announcement",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div (click)="onClick($event)"><div class="se-announcement__title">{{ task.action.name | seL10n | async }}</div><div class="se-announcement__message">{{ task.attachments[0].catalogName | seL10n | async }} | {{ task.attachments[0].pageName }}</div><div class="se-announcement__time-stamp">{{ startedAgo }}</div></div>`});let Mi=class WorkflowInboxSingleTaskAnnouncementComponent{constructor(e,t,i,o){this.workflowService=e;this.cmsTimeService=t;this.announcementService=i;({id:this.announcementId,task:this.task}=o)}ngOnInit(){this.startedAgo=this.getStartedAgo()}onClick(e){e.stopPropagation();this.workflowService.loadExperienceAndOpenPageWorkflowMenu(this.task);this.announcementService.closeAnnouncement(this.announcementId)}getStartedAgo(){if(!!this.task.action.startedAgoInMillis){return this.cmsTimeService.getTimeAgo(this.task.action.startedAgoInMillis)}return null}};Mi=__decorate([n.Component({selector:"se-workflow-inbox-single-task-announcement",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div (click)="onClick($event)"><div class="se-announcement__title">{{ task.action.name | seL10n | async }}</div><div class="se-announcement__message">{{ task.attachments[0].catalogName | seL10n | async }} | {{ task.attachments[0].pageName }}</div><div class="se-announcement__time-stamp">{{ startedAgo }}</div></div>`}),__param(3,n.Inject(l.ANNOUNCEMENT_DATA)),__metadata("design:paramtypes",[l.WorkflowService,r.CMSTimeService,l.IAnnouncementService,Object])],Mi);let ki=class WorkflowInboxAnnouncementService{constructor(e,t){this.workflowTasksPollingService=e;this.announcementService=t;this.unsubscribePollingService=this.workflowTasksPollingService.addSubscriber(((e,t)=>{if(e){this.displayAnnouncement(e)}}),false)}ngOnDestroy(){this.unsubscribePollingService()}displayAnnouncement(e){if(e.length===1){this.showSingleTaskAnnouncement(e[0])}else if(e.length>1){this.showMultipleTasksAnnouncement(e)}}showSingleTaskAnnouncement(e){return __awaiter(this,void 0,void 0,(function*(){yield this.showAnnouncement(Mi,{task:e})}))}showMultipleTasksAnnouncement(e){return __awaiter(this,void 0,void 0,(function*(){yield this.showAnnouncement(Ri,{tasks:e})}))}showAnnouncement(e,t){return this.announcementService.showAnnouncement({component:e,data:t})}};ki=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.WorkflowTasksPollingService,l.IAnnouncementService])],ki);window.__smartedit__.addDecoratorPayload("Component","WorkflowInboxComponent",{selector:"se-workflow-inbox",template:`<fd-popover class="toolbar-action se-workflow-inbox-container dropdown" [class.open]="actionItem.isOpen" [(isOpen)]="actionItem.isOpen" (isOpenChange)="onDropdownToggle(isOpen)" [closeOnOutsideClick]="true" [triggers]="['click']" [noArrow]="false"><fd-popover-control class="se-workflow-inbox-toggle-control"><button fd-button type="button" class="se-workflow-inbox-toggle toolbar-action--button--compact" attr.aria-label="{{ 'se.cms.workflow.toolbar.inbox' | translate}}" [attr.aria-expanded]="actionItem.isOpen" title="{{ 'se.cms.workflow.toolbar.inbox' | translate}}"><span class="se-toolbar-actions__icon sap-icon--inbox"></span><se-workflow-inbox-badge></se-workflow-inbox-badge></button></fd-popover-control><fd-popover-body><div [ngClass]="{\n                'se-toolbar__dropdown--right': actionItem.dropdownPosition === 'right',\n                'se-toolbar__dropdown--center': actionItem.dropdownPosition === 'center',\n                'se-toolbar__dropdown--left': actionItem.dropdownPosition === 'left'\n            }" class="toolbar-action--include--compact"><div *ngIf="actionItem.isOpen" class="se-workflow-inbox"><div class="se-workflow-inbox"><div class="se-workflow-inbox-header"><div class="se-workflow-inbox-header__title" [translate]="'se.cms.workflow.toolbar.inbox'"></div></div><div class="se-workflow-inbox-tasks se-cms-dev-workflow-inbox-tasks fd-panel__body"><div *ngIf="!tasksNotReady && totalNumberOfTasks === 0" class="se-workflow-inbox-tasks__no-tasks"><img src="static-resources/images/Inbox.svg" alt="empty-inbox"/> <span class="se-workflow-inbox__empty-inbox-message" [translate]="'se.cms.workflow.toolbar.inbox.emptyinbox.message'"></span> <span class="se-workflow-inbox__empty-inbox-message-alt" [translate]="'se.cms.workflow.toolbar.inbox.emptyinbox.message.alt'"></span></div><se-infinite-scrolling class="se-version-panel__infinite-scroll se-infinite-scrolling--narrowed" [pageSize]="pageSize" [fetchPage]="fetchPageOfInboxTasks" (itemsChange)="onInboxTasksLoaded($event)"><div *ngFor="let task of workflowTasks; let i = index; let last = last; trackBy: trackByIndex" class="se-workflow-inbox-task se-cms-dev-workflow-inbox-task"><se-workflow-inbox-task id="workflow-inbox-task-{{i}}" [class.se-workflow-inbox-task-last]="last" [task]="task"></se-workflow-inbox-task></div></se-infinite-scrolling></div></div></div></div></fd-popover-body></fd-popover>`,styles:[`.se-workflow-inbox-toggle{outline:0}.se-workflow-inbox-header{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);height:53px;padding-top:15px;height:48px;font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor);border-bottom:1px solid var(--sapGroup_ContentBorderColor);padding:10px 0 15px 20px;height:46px}.se-workflow-inbox-header:first-child{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-workflow-inbox-tasks{padding:16px 0 8px;width:280px}.se-workflow-inbox-tasks__no-tasks{display:flex;flex-direction:column;align-items:center}.se-workflow-inbox__empty-inbox-message{color:var(--sapNeutralColor);padding:8px 0 4px}.se-workflow-inbox__empty-inbox-message-alt{font-size:13px;color:var(--sapNeutralColor);padding-bottom:30px}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Ni=class WorkflowInboxComponent{constructor(e,t,i,o,n,s){this.workflowFacade=e;this.systemEventService=t;this.workflowTasksPollingService=i;this.userTrackingService=o;this.actionItem=n;this.cdr=s;this.pageSize=10;this.workflowTasks=[];this.fetchPageOfInboxTasks=(e,t,i)=>this.loadInboxTasks(e,t,i)}ngOnInit(){this.tasksNotReady=true;this.unRegisterOpenDropdownEvent=this.systemEventService.subscribe(bi,(()=>this.openDropdown()));this.unRegisterWorkflowCreatedEvent=this.systemEventService.subscribe(r.WORKFLOW_CREATED_EVENT,(()=>this.loadInboxTasks("",this.pageSize,0)));this.unRegWorkflowTasksMenuOpenedEvent=this.systemEventService.subscribe(Si,(()=>this.hideDropdown()));this.workflowTasksPollingService.startPolling()}ngOnDestroy(){this.workflowTasksPollingService.stopPolling();this.unRegisterOpenDropdownEvent();this.unRegisterWorkflowCreatedEvent();this.unRegWorkflowTasksMenuOpenedEvent()}loadInboxTasks(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.workflowFacade.getWorkflowInboxTasks({currentPage:i,mask:e,pageSize:t});this.tasksNotReady=false;this.totalNumberOfTasks=o.pagination.totalCount;this.workflowFacade.updateWorkflowTasksCount(this.totalNumberOfTasks);if(!this.cdr.destroyed){this.cdr.detectChanges()}return o}))}onInboxTasksLoaded(e){this.workflowTasks=e}onDropdownToggle(e){if(e){this.workflowTasksPollingService.stopPolling();return}this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.HEADER_TOOL,"Inbox");this.workflowTasksPollingService.startPolling();this.tasksNotReady=true}trackByIndex(e){return e}openDropdown(){this.actionItem.isOpen=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}}hideDropdown(){this.actionItem.isOpen=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}};Ni=__decorate([n.Component({selector:"se-workflow-inbox",template:`<fd-popover class="toolbar-action se-workflow-inbox-container dropdown" [class.open]="actionItem.isOpen" [(isOpen)]="actionItem.isOpen" (isOpenChange)="onDropdownToggle(isOpen)" [closeOnOutsideClick]="true" [triggers]="['click']" [noArrow]="false"><fd-popover-control class="se-workflow-inbox-toggle-control"><button fd-button type="button" class="se-workflow-inbox-toggle toolbar-action--button--compact" attr.aria-label="{{ 'se.cms.workflow.toolbar.inbox' | translate}}" [attr.aria-expanded]="actionItem.isOpen" title="{{ 'se.cms.workflow.toolbar.inbox' | translate}}"><span class="se-toolbar-actions__icon sap-icon--inbox"></span><se-workflow-inbox-badge></se-workflow-inbox-badge></button></fd-popover-control><fd-popover-body><div [ngClass]="{\n                'se-toolbar__dropdown--right': actionItem.dropdownPosition === 'right',\n                'se-toolbar__dropdown--center': actionItem.dropdownPosition === 'center',\n                'se-toolbar__dropdown--left': actionItem.dropdownPosition === 'left'\n            }" class="toolbar-action--include--compact"><div *ngIf="actionItem.isOpen" class="se-workflow-inbox"><div class="se-workflow-inbox"><div class="se-workflow-inbox-header"><div class="se-workflow-inbox-header__title" [translate]="'se.cms.workflow.toolbar.inbox'"></div></div><div class="se-workflow-inbox-tasks se-cms-dev-workflow-inbox-tasks fd-panel__body"><div *ngIf="!tasksNotReady && totalNumberOfTasks === 0" class="se-workflow-inbox-tasks__no-tasks"><img src="static-resources/images/Inbox.svg" alt="empty-inbox"/> <span class="se-workflow-inbox__empty-inbox-message" [translate]="'se.cms.workflow.toolbar.inbox.emptyinbox.message'"></span> <span class="se-workflow-inbox__empty-inbox-message-alt" [translate]="'se.cms.workflow.toolbar.inbox.emptyinbox.message.alt'"></span></div><se-infinite-scrolling class="se-version-panel__infinite-scroll se-infinite-scrolling--narrowed" [pageSize]="pageSize" [fetchPage]="fetchPageOfInboxTasks" (itemsChange)="onInboxTasksLoaded($event)"><div *ngFor="let task of workflowTasks; let i = index; let last = last; trackBy: trackByIndex" class="se-workflow-inbox-task se-cms-dev-workflow-inbox-task"><se-workflow-inbox-task id="workflow-inbox-task-{{i}}" [class.se-workflow-inbox-task-last]="last" [task]="task"></se-workflow-inbox-task></div></se-infinite-scrolling></div></div></div></div></fd-popover-body></fd-popover>`,styles:[`.se-workflow-inbox-toggle{outline:0}.se-workflow-inbox-header{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);height:53px;padding-top:15px;height:48px;font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor);border-bottom:1px solid var(--sapGroup_ContentBorderColor);padding:10px 0 15px 20px;height:46px}.se-workflow-inbox-header:first-child{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-workflow-inbox-tasks{padding:16px 0 8px;width:280px}.se-workflow-inbox-tasks__no-tasks{display:flex;flex-direction:column;align-items:center}.se-workflow-inbox__empty-inbox-message{color:var(--sapNeutralColor);padding:8px 0 4px}.se-workflow-inbox__empty-inbox-message-alt{font-size:13px;color:var(--sapNeutralColor);padding-bottom:30px}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(4,n.Inject(l.TOOLBAR_ITEM)),__metadata("design:paramtypes",[Oi,l.SystemEventService,l.WorkflowTasksPollingService,l.IUserTrackingService,Object,n.ChangeDetectorRef])],Ni);window.__smartedit__.addDecoratorPayload("Component","PageWorkflowMenuTasksTabComponent",{selector:"se-page-workflow-menu-tasks-tab",template:`\n        <div class="se-page-workflow-tasks-wrapper">\n            <div *ngFor="let action of actions">\n                <div class="se-page-workflow-task fd-panel">\n                    <div>\n                        <se-workflow-action-item\n                            [workflow]="workflow"\n                            [workflowAction]="action"\n                            [canMakeDecisions]="canMakeDecisions"></se-workflow-action-item>\n                    </div>\n                </div>\n                <br />\n            </div>\n        </div>\n    `,styles:[`.se-page-workflow-tasks-wrapper{max-height:400px;overflow-y:scroll;padding:0 15px 0 15px;width:100%}.se-page-workflow-tasks-wrapper .fd-panel{box-shadow:0 0 4px 0 rgba(0,0,0,.15);max-width:320px}`]});let Fi=class PageWorkflowMenuTasksTabComponent{};__decorate([n.Input(),__metadata("design:type",Array)],Fi.prototype,"actions",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Fi.prototype,"workflow",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],Fi.prototype,"canMakeDecisions",void 0);Fi=__decorate([n.Component({selector:"se-page-workflow-menu-tasks-tab",template:`\n        <div class="se-page-workflow-tasks-wrapper">\n            <div *ngFor="let action of actions">\n                <div class="se-page-workflow-task fd-panel">\n                    <div>\n                        <se-workflow-action-item\n                            [workflow]="workflow"\n                            [workflowAction]="action"\n                            [canMakeDecisions]="canMakeDecisions"></se-workflow-action-item>\n                    </div>\n                </div>\n                <br />\n            </div>\n        </div>\n    `,styles:[`.se-page-workflow-tasks-wrapper{max-height:400px;overflow-y:scroll;padding:0 15px 0 15px;width:100%}.se-page-workflow-tasks-wrapper .fd-panel{box-shadow:0 0 4px 0 rgba(0,0,0,.15);max-width:320px}`]})],Fi);window.__smartedit__.addDecoratorPayload("Component","WorkflowInboxBadgeComponent",{selector:"se-workflow-inbox-badge",template:`<ng-container *ngIf="inboxCount$ | async as count"><div *ngIf="count > 0" aria-label="Notifications"><div class="fd-button__badge se-inbox-badge" aria-label="Unread count">{{ stringifyCount(count) }}</div></div></ng-container>`,styles:[`.se-inbox-badge{transform:none;top:-2px;left:22px;font-size:10px;border-radius:8px;padding:2px 4px}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let zi=class WorkflowInboxBadgeComponent{constructor(e){this.workflowService=e}ngOnInit(){this.inboxCount$=this.workflowService.getTotalNumberOfActiveWorkflowTasks()}stringifyCount(e){return e<=99?String(e):"99+"}};zi=__decorate([n.Component({selector:"se-workflow-inbox-badge",template:`<ng-container *ngIf="inboxCount$ | async as count"><div *ngIf="count > 0" aria-label="Notifications"><div class="fd-button__badge se-inbox-badge" aria-label="Unread count">{{ stringifyCount(count) }}</div></div></ng-container>`,styles:[`.se-inbox-badge{transform:none;top:-2px;left:22px;font-size:10px;border-radius:8px;padding:2px 4px}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.WorkflowService])],zi);window.__smartedit__.addDecoratorPayload("Component","WorkflowInboxTaskComponent",{selector:"se-workflow-inbox-task",template:`<div class="se-workflow-inbox-task-header"><a href="#" (click)="onClick($event)">{{ taskName | async }}</a></div><div class="se-workflow-inbox-task-desc">{{ taskDescription | async }}</div><div class="se-workflow-inbox-task-body">{{ getTaskCreatedAgo() }}</div>`,styles:[`:host{white-space:normal}:host(.se-workflow-inbox-task-last) .se-workflow-inbox-task-body{border-bottom:none;margin-bottom:0}.se-workflow-inbox-task-header a{font-size:.875rem!important;line-height:1.4285714286;font-weight:400;font-weight:700;text-decoration:none;margin-bottom:4px}.se-workflow-inbox-task-desc{font-size:.875rem!important;line-height:1.4285714286;font-weight:400;color:var(--sapTextColor)}.se-workflow-inbox-task-body{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapField_PlaceholderTextColor);text-transform:lowercase;margin:8px 0 20px;padding-bottom:12px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}`],providers:[l.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush});let Li=class WorkflowInboxTaskComponent{constructor(e,t,i){this.cMSTimeService=e;this.workflowService=t;this.l10nPipe=i}ngOnInit(){this.taskName=this.getTaskName();this.taskDescription=this.getTaskDescription()}getTaskName(){return __awaiter(this,void 0,void 0,(function*(){return this.l10nPipe.transform(this.task.action.name).pipe(d.take(1)).toPromise()}))}getTaskDescription(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.l10nPipe.transform(this.task.attachments[0].catalogName).pipe(d.take(1)).toPromise();return`${e} ${this.task.attachments[0].catalogVersion} | ${this.task.attachments[0].pageName}`}))}getTaskCreatedAgo(){return this.cMSTimeService.getTimeAgo(this.task.action.startedAgoInMillis)}onClick(e){e.preventDefault();this.workflowService.loadExperienceAndOpenPageWorkflowMenu(this.task)}};__decorate([n.Input(),__metadata("design:type",Object)],Li.prototype,"task",void 0);Li=__decorate([n.Component({selector:"se-workflow-inbox-task",template:`<div class="se-workflow-inbox-task-header"><a href="#" (click)="onClick($event)">{{ taskName | async }}</a></div><div class="se-workflow-inbox-task-desc">{{ taskDescription | async }}</div><div class="se-workflow-inbox-task-body">{{ getTaskCreatedAgo() }}</div>`,styles:[`:host{white-space:normal}:host(.se-workflow-inbox-task-last) .se-workflow-inbox-task-body{border-bottom:none;margin-bottom:0}.se-workflow-inbox-task-header a{font-size:.875rem!important;line-height:1.4285714286;font-weight:400;font-weight:700;text-decoration:none;margin-bottom:4px}.se-workflow-inbox-task-desc{font-size:.875rem!important;line-height:1.4285714286;font-weight:400;color:var(--sapTextColor)}.se-workflow-inbox-task-body{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapField_PlaceholderTextColor);text-transform:lowercase;margin:8px 0 20px;padding-bottom:12px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}`],providers:[l.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[r.CMSTimeService,l.WorkflowService,l.L10nPipe])],Li);window.__smartedit__.addDecoratorPayload("Component","WorkflowItemMenuComponent",{selector:"se-workflow-item-menu",template:`<se-popup-overlay class="popup-anchor" [ngClass]="{ 'popup-anchor--open': isMenuOpen }" [popupOverlay]="popupConfig" [popupOverlayTrigger]="isMenuOpen" (popupOverlayOnHide)="hideMenu()"><span *ngIf="menuItems.length > 0" (click)="toggleMenu()" class="workflow-item-menu__toggle-btn sap-icon--overflow"></span><div se-popup-overlay-body><div class="workflow-item-menu"><div class="workflow-item-menu__item" *ngFor="let dropdownItem of menuItems"><ng-container class="container" [ngSwitch]="dropdownItem.i18nKey"><div *ngSwitchCase="'se.cms.actionitem.page.workflow.description'" class="workflow-description"><div class="se-dropdown-item--label"><div class="workflow-description__label fd-has-type-1 fd-has-margin-bottom-tiny"><div [translate]="dropdownItem.i18nKey"></div><div *seHasOperationPermission="'se.edit.workflow.workflowMenu'"><a title="Edit" class="workflow-description__edit-btn sap-icon--edit fd-has-float-right" (click)="editDescription()"></a></div></div><div *ngIf="workflowInfo.description; else noDescription" class="workflow-description__text">{{ workflowInfo.description }}</div><ng-template #noDescription><div translate="se.cms.actionitem.page.workflow.no.description"></div></ng-template></div></div><div *ngSwitchCase="'se.cms.actionitem.page.workflow.cancel'" class="workflow-cancel-btn" [translate]="dropdownItem.i18nKey" (click)="cancelWorkflow()"></div></ng-container></div></div></div></se-popup-overlay>`,styles:[`.popup-anchor{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:1rem!important;line-height:1.25;font-weight:400;padding-top:5px;width:32px;height:32px;border-radius:4px}.popup-anchor--open{background-color:var(--sapNeutralColor)}.workflow-item-menu{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;left:initial!important;right:0;transform:translate(5px,8px);right:-11px;top:-8px}.workflow-item-menu::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.workflow-item-menu::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.workflow-item-menu::after,.workflow-item-menu::before{right:10px}.workflow-item-menu::after,.workflow-item-menu::before{display:none}.workflow-description{min-width:225px;padding:20px}.workflow-description__label{color:var(--sapTextColor);display:flex;justify-content:space-between}.workflow-description__label .sap-icon--edit{cursor:pointer}.workflow-description__label .sap-icon--edit:hover{text-decoration:none}.workflow-description__text{word-break:normal;word-spacing:normal;word-wrap:break-word;white-space:normal;color:var(--sapNeutralColor)}.workflow-cancel-btn{cursor:pointer;padding:12px 20px;border-top:1px solid var(--sapList_FooterBackground);color:var(--sapButton_Reject_Hover_TextColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Vi=class WorkflowItemMenuComponent{constructor(e,t,i,o,s,a){this.systemEventService=e;this.workflowFacade=t;this.routingService=i;this.permissionService=o;this.cdr=s;this.yjQuery=a;this.isMenuOpenChange=new n.EventEmitter;this.isMenuOpen=false;this.popupConfig={halign:"left",valign:"bottom"};this.menuItems=[]}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.unRegWorkflowMenuOpenedEvent=this.systemEventService.subscribe(Ii,((e,t)=>this.onWorkflowItemMenuOpen(t)));this.menuItems=yield this.getPermittedButtons([{i18nKey:"se.cms.actionitem.page.workflow.description",permissions:["se.view.page.workflowMenu"]},{i18nKey:"se.cms.actionitem.page.workflow.cancel",permissions:["se.cancel.page.workflowMenu"]}]);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnDestroy(){this.unRegWorkflowMenuOpenedEvent()}toggleMenu(){this.isMenuOpen=!this.isMenuOpen;if(this.isMenuOpen&&this.workflowInfo){this.systemEventService.publishAsync(Ii,{uid:this.workflowInfo.workflowCode})}}hideMenu(){this.isMenuOpen=false}editDescription(){return __awaiter(this,void 0,void 0,(function*(){this.hideMenu();this.closeParentPopover();this.isMenuOpenChange.emit(false);const e=yield this.workflowFacade.editWorkflow(this.workflowInfo);this.workflowInfo.description=e.description}))}cancelWorkflow(){return __awaiter(this,void 0,void 0,(function*(){this.hideMenu();this.closeParentPopover();this.isMenuOpenChange.emit(false);yield this.workflowFacade.cancelWorflow(this.workflowInfo);this.routingService.reload()}))}closeParentPopover(){if(this.yjQuery(".se-page-workflow-menu-body").toArray().length>0){this.yjQuery("#pageTaskBtn").trigger("click")}}onWorkflowItemMenuOpen(e){if(this.workflowInfo.workflowCode!==e.uid){this.hideMenu();if(!this.cdr.destroyed){this.cdr.detectChanges()}}}getPermittedButtons(e){return __awaiter(this,void 0,void 0,(function*(){const t=e.map((e=>Promise.resolve(this.permissionService.isPermitted([{names:e.permissions}]))));const i=yield Promise.all(t);return e.filter(((e,t)=>i[t]))}))}};__decorate([n.Input(),__metadata("design:type",Object)],Vi.prototype,"workflowInfo",void 0);__decorate([n.Output(),__metadata("design:type",Object)],Vi.prototype,"isMenuOpenChange",void 0);Vi=__decorate([n.Component({selector:"se-workflow-item-menu",template:`<se-popup-overlay class="popup-anchor" [ngClass]="{ 'popup-anchor--open': isMenuOpen }" [popupOverlay]="popupConfig" [popupOverlayTrigger]="isMenuOpen" (popupOverlayOnHide)="hideMenu()"><span *ngIf="menuItems.length > 0" (click)="toggleMenu()" class="workflow-item-menu__toggle-btn sap-icon--overflow"></span><div se-popup-overlay-body><div class="workflow-item-menu"><div class="workflow-item-menu__item" *ngFor="let dropdownItem of menuItems"><ng-container class="container" [ngSwitch]="dropdownItem.i18nKey"><div *ngSwitchCase="'se.cms.actionitem.page.workflow.description'" class="workflow-description"><div class="se-dropdown-item--label"><div class="workflow-description__label fd-has-type-1 fd-has-margin-bottom-tiny"><div [translate]="dropdownItem.i18nKey"></div><div *seHasOperationPermission="'se.edit.workflow.workflowMenu'"><a title="Edit" class="workflow-description__edit-btn sap-icon--edit fd-has-float-right" (click)="editDescription()"></a></div></div><div *ngIf="workflowInfo.description; else noDescription" class="workflow-description__text">{{ workflowInfo.description }}</div><ng-template #noDescription><div translate="se.cms.actionitem.page.workflow.no.description"></div></ng-template></div></div><div *ngSwitchCase="'se.cms.actionitem.page.workflow.cancel'" class="workflow-cancel-btn" [translate]="dropdownItem.i18nKey" (click)="cancelWorkflow()"></div></ng-container></div></div></div></se-popup-overlay>`,styles:[`.popup-anchor{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:1rem!important;line-height:1.25;font-weight:400;padding-top:5px;width:32px;height:32px;border-radius:4px}.popup-anchor--open{background-color:var(--sapNeutralColor)}.workflow-item-menu{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;left:initial!important;right:0;transform:translate(5px,8px);right:-11px;top:-8px}.workflow-item-menu::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.workflow-item-menu::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.workflow-item-menu::after,.workflow-item-menu::before{right:10px}.workflow-item-menu::after,.workflow-item-menu::before{display:none}.workflow-description{min-width:225px;padding:20px}.workflow-description__label{color:var(--sapTextColor);display:flex;justify-content:space-between}.workflow-description__label .sap-icon--edit{cursor:pointer}.workflow-description__label .sap-icon--edit:hover{text-decoration:none}.workflow-description__text{word-break:normal;word-spacing:normal;word-wrap:break-word;white-space:normal;color:var(--sapNeutralColor)}.workflow-cancel-btn{cursor:pointer;padding:12px 20px;border-top:1px solid var(--sapList_FooterBackground);color:var(--sapButton_Reject_Hover_TextColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(5,n.Inject(l.YJQUERY_TOKEN)),__metadata("design:paramtypes",[l.SystemEventService,Oi,l.SmarteditRoutingService,l.IPermissionService,n.ChangeDetectorRef,Function])],Vi);window.__smartedit__.addDecoratorPayload("Component","WorkflowActionCommentComponent",{selector:"se-workflow-action-comment",template:`<ng-container *ngIf="isDecisionComment; then decisionComment; else generalComment"></ng-container><ng-template #decisionComment><div class="se-workflow-action-comment"><div class="se-tile-content"><h2 class="fd-tile__title se-workflow-action-comment__header sap-icon--workflow-tasks sap-icon--m" [class.sap-icon--flip-h]="!isIncomingDecision()">{{ actionComment.decisionName }}</h2><p class="fd-has-type-minus-1 fd-tile__content-byline">{{ actionComment.authorName }} | {{ createdAgo }}</p><p *ngIf="!!actionComment.text"><strong>{{'se.cms.page.workflow.action.item.comment.header' | translate}}:</strong><ng-container *ngTemplateOutlet="comment"></ng-container></p></div></div></ng-template><ng-template #generalComment><div class="se-workflow-action-comment"><div class="fd-tile"><div class="fd-tile__content"><h2 class="fd-panel__title">{{'se.cms.page.workflow.action.item.comment.header' | translate}}</h2><p>{{ createdAgo }}</p><p class="se-workflow-action-comment__author">{{ actionComment.authorName }}</p><ng-container *ngTemplateOutlet="comment"></ng-container></div></div></div></ng-template><ng-template #comment><se-more-text class="se-workflow-action-comment__body" [ellipsis]="'...'" [text]="actionComment.text"></se-more-text></ng-template>`,styles:[`/*!\n * Fundamental Library Styles v0.23.0\n * Copyright (c) 2022 SAP SE or an SAP affiliate company.\n * Licensed under Apache License 2.0 (https://github.com/SAP/fundamental-styles/blob/main/LICENSE)\n *//*!\n.fd-button-split+()\n    .fd-button\n*/.fd-button-split{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;position:relative}.fd-button-split:after,.fd-button-split:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split>:first-child{margin:0;border-top-right-radius:0;border-bottom-right-radius:0}.fd-button-split>:nth-child(2){margin:0;border-top-left-radius:0;border-bottom-left-radius:0}.fd-button-split>:nth-child(2):not(.fd-button--transparent){border-left-width:0}.fd-button-split[dir=rtl]>:first-child,[dir=rtl] .fd-button-split>:first-child{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--sapButton_BorderCornerRadius);border-bottom-right-radius:var(--sapButton_BorderCornerRadius)}.fd-button-split[dir=rtl]>:nth-child(2),[dir=rtl] .fd-button-split>:nth-child(2){border-top-left-radius:var(--sapButton_BorderCornerRadius);border-bottom-left-radius:var(--sapButton_BorderCornerRadius);border-top-right-radius:0;border-bottom-right-radius:0;border-left-width:var(--sapButton_BorderWidth)}.fd-button-split[dir=rtl]>:nth-child(2):not(.fd-button--transparent),[dir=rtl] .fd-button-split>:nth-child(2):not(.fd-button--transparent){border-right-width:0}.fd-button-split>[class*="--emphasized"]:first-child{margin-right:.0625rem}.fd-button-split>[class*="--emphasized"][dir=rtl]:first-child,[dir=rtl] .fd-button-split>[class*="--emphasized"]:first-child{margin-right:0;margin-left:.0625rem}.fd-button-split>:first-child{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.fd-button-split>:first-child .fd-button-split__text{display:inline-block}.fd-button-split>:first-child:hover .fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split>:first-child:active .fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]>.fd-button-split__text{color:var(--sapButton_Emphasized_TextColor);font-weight:700}.fd-button-split--emphasized>[class*="--emphasized"]:hover>.fd-button-split__text{color:var(--sapButton_Emphasized_Hover_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--transparent>[class*="--transparent"]>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:hover>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split .fd-button-split__text{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--sapButton_TextColor);max-width:9.75rem;display:block}.fd-button-split .fd-button-split__text:after,.fd-button-split .fd-button-split__text:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split .fd-button-split__text--compact{max-width:10rem}.se-workflow-action-comment{margin:20px 15px 10px 45px;border-style:solid;border-width:1px;border-color:var(--sapNeutralColor);border-radius:3px;position:relative}.se-workflow-action-comment::before{height:0;width:0;border-style:solid;border-width:6.5px 8px 6.5px 0;border-bottom-color:transparent;border-right-color:var(--sapNeutralColor);border-top-color:transparent;content:"";position:absolute;top:14px;left:-9px}.se-workflow-action-comment::after{height:0;width:0;border-style:solid;border-width:6.5px 8px 6.5px 0;border-bottom-color:transparent;border-right-color:var(--sapBaseColor);border-top-color:transparent;content:"";position:absolute;top:14px;left:-7px}.se-workflow-action-comment .se-tile-content{padding:10px 16px 10px 12px}.se-workflow-action-comment__header{font-weight:700;font-size:13px;margin-bottom:3px!important}.se-workflow-action-comment__header:before{position:absolute;top:-4px;left:-40px;font-size:18px;background:var(--sapBaseColor);padding:8px}.se-workflow-action-comment__header.sap-icon--flip-h::before{transform:scaleX(-1)}.se-workflow-action-comment__author{margin-bottom:25px}.se-workflow-action-comment__body{overflow-wrap:anywhere}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Ui=class WorkflowActionCommentComponent{constructor(e){this.cMSTimeService=e}ngOnInit(){this.isDecisionComment=!!this.actionComment.decisionName}get createdAgo(){if(!!this.actionComment.createdAgoInMillis){return this.cMSTimeService.getTimeAgo(this.actionComment.createdAgoInMillis)}return null}isIncomingDecision(){return!(this.actionComment.originalActionCode===this.workflowAction.code)}};__decorate([n.Input(),__metadata("design:type",Object)],Ui.prototype,"actionComment",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Ui.prototype,"workflowAction",void 0);Ui=__decorate([n.Component({selector:"se-workflow-action-comment",template:`<ng-container *ngIf="isDecisionComment; then decisionComment; else generalComment"></ng-container><ng-template #decisionComment><div class="se-workflow-action-comment"><div class="se-tile-content"><h2 class="fd-tile__title se-workflow-action-comment__header sap-icon--workflow-tasks sap-icon--m" [class.sap-icon--flip-h]="!isIncomingDecision()">{{ actionComment.decisionName }}</h2><p class="fd-has-type-minus-1 fd-tile__content-byline">{{ actionComment.authorName }} | {{ createdAgo }}</p><p *ngIf="!!actionComment.text"><strong>{{'se.cms.page.workflow.action.item.comment.header' | translate}}:</strong><ng-container *ngTemplateOutlet="comment"></ng-container></p></div></div></ng-template><ng-template #generalComment><div class="se-workflow-action-comment"><div class="fd-tile"><div class="fd-tile__content"><h2 class="fd-panel__title">{{'se.cms.page.workflow.action.item.comment.header' | translate}}</h2><p>{{ createdAgo }}</p><p class="se-workflow-action-comment__author">{{ actionComment.authorName }}</p><ng-container *ngTemplateOutlet="comment"></ng-container></div></div></div></ng-template><ng-template #comment><se-more-text class="se-workflow-action-comment__body" [ellipsis]="'...'" [text]="actionComment.text"></se-more-text></ng-template>`,styles:[`/*!\n * Fundamental Library Styles v0.23.0\n * Copyright (c) 2022 SAP SE or an SAP affiliate company.\n * Licensed under Apache License 2.0 (https://github.com/SAP/fundamental-styles/blob/main/LICENSE)\n *//*!\n.fd-button-split+()\n    .fd-button\n*/.fd-button-split{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;position:relative}.fd-button-split:after,.fd-button-split:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split>:first-child{margin:0;border-top-right-radius:0;border-bottom-right-radius:0}.fd-button-split>:nth-child(2){margin:0;border-top-left-radius:0;border-bottom-left-radius:0}.fd-button-split>:nth-child(2):not(.fd-button--transparent){border-left-width:0}.fd-button-split[dir=rtl]>:first-child,[dir=rtl] .fd-button-split>:first-child{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--sapButton_BorderCornerRadius);border-bottom-right-radius:var(--sapButton_BorderCornerRadius)}.fd-button-split[dir=rtl]>:nth-child(2),[dir=rtl] .fd-button-split>:nth-child(2){border-top-left-radius:var(--sapButton_BorderCornerRadius);border-bottom-left-radius:var(--sapButton_BorderCornerRadius);border-top-right-radius:0;border-bottom-right-radius:0;border-left-width:var(--sapButton_BorderWidth)}.fd-button-split[dir=rtl]>:nth-child(2):not(.fd-button--transparent),[dir=rtl] .fd-button-split>:nth-child(2):not(.fd-button--transparent){border-right-width:0}.fd-button-split>[class*="--emphasized"]:first-child{margin-right:.0625rem}.fd-button-split>[class*="--emphasized"][dir=rtl]:first-child,[dir=rtl] .fd-button-split>[class*="--emphasized"]:first-child{margin-right:0;margin-left:.0625rem}.fd-button-split>:first-child{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.fd-button-split>:first-child .fd-button-split__text{display:inline-block}.fd-button-split>:first-child:hover .fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split>:first-child:active .fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]>.fd-button-split__text{color:var(--sapButton_Emphasized_TextColor);font-weight:700}.fd-button-split--emphasized>[class*="--emphasized"]:hover>.fd-button-split__text{color:var(--sapButton_Emphasized_Hover_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--transparent>[class*="--transparent"]>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:hover>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split .fd-button-split__text{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--sapButton_TextColor);max-width:9.75rem;display:block}.fd-button-split .fd-button-split__text:after,.fd-button-split .fd-button-split__text:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split .fd-button-split__text--compact{max-width:10rem}.se-workflow-action-comment{margin:20px 15px 10px 45px;border-style:solid;border-width:1px;border-color:var(--sapNeutralColor);border-radius:3px;position:relative}.se-workflow-action-comment::before{height:0;width:0;border-style:solid;border-width:6.5px 8px 6.5px 0;border-bottom-color:transparent;border-right-color:var(--sapNeutralColor);border-top-color:transparent;content:"";position:absolute;top:14px;left:-9px}.se-workflow-action-comment::after{height:0;width:0;border-style:solid;border-width:6.5px 8px 6.5px 0;border-bottom-color:transparent;border-right-color:var(--sapBaseColor);border-top-color:transparent;content:"";position:absolute;top:14px;left:-7px}.se-workflow-action-comment .se-tile-content{padding:10px 16px 10px 12px}.se-workflow-action-comment__header{font-weight:700;font-size:13px;margin-bottom:3px!important}.se-workflow-action-comment__header:before{position:absolute;top:-4px;left:-40px;font-size:18px;background:var(--sapBaseColor);padding:8px}.se-workflow-action-comment__header.sap-icon--flip-h::before{transform:scaleX(-1)}.se-workflow-action-comment__author{margin-bottom:25px}.se-workflow-action-comment__body{overflow-wrap:anywhere}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[r.CMSTimeService])],Ui);const Bi="PageApprovalPageApproved";window.__smartedit__.addDecoratorPayload("Component","WorkflowActionItemComponent",{selector:"se-workflow-action-item",template:`<div class="se-workflow-action-item" [ngClass]="getWorkflowActionStatusClass()"><se-collapsible-container class="se-catalog-details__collapse se-collapsible-container--noshadow fd-panel" [id]="workflowAction.code" (getApi)="setCollapsibleContainerApi($event)"><se-collapsible-container-header><div class="fd-panel__header"><div class="fd-panel__head"><h1 class="fd-panel__title">{{ workflowAction.name | seL10n | async }}</h1><p class="fd-panel__description">{{ getReadableStatus() | translate }} {{ getActiveSince() }}</p></div></div><div class="fd-panel__body">{{ workflowAction.description | seL10n | async }}<div *ngIf="canShowDecisionButtons()" class="se-workflow-action-item__decision-buttons fd-dropdown"><div class="fd-popover"><div class="fd-popover__control"><div [ngClass]="{ 'fd-button-split': workflowAction.decisions.length > 1 }"><button fd-button [compact]="true" class="se-workflow-action-item__decision-button" [id]="workflowAction.code + '-decision-button'" (click)="onMainButtonClick($event, workflowAction.decisions[0])">{{ workflowAction.decisions[0].name | seL10n | async }}</button><se-popup-overlay [popupOverlay]="{\n                                        halign: 'right',\n                                        valign: 'bottom'\n                                    }" [popupOverlayTrigger]="isMenuOpen" (popupOverlayOnHide)="onMenuHide()"><button fd-button [fdMenu]="true" [compact]="true" *ngIf="workflowAction.decisions.length > 1" [id]="workflowAction.code + '-decision-split-button'" class="menu-button" (click)="onSplitButtonClick($event)"></button><div se-popup-overlay-body class="fd-popover__body fd-popover__body--right fd-popover__body--no-arrow se-workflow-action-item__decision-list"><nav class="fd-menu"><ul class="fd-list"><li *ngFor="let decision of workflowAction.decisions"><a class="fd-list__item se-workflow-action-item__decision" (click)="onMainButtonClick($event, decision)">{{ decision.name | seL10n | async }}</a></li></ul></nav></div></se-popup-overlay></div></div></div></div></div></se-collapsible-container-header><se-collapsible-container-content><div class="se-workflow-action-item__content" *ngIf="canShowComments()"><span *ngIf="!hasComments" class="se-workflow-action-item__comment-list fd-has-font-style-italic fd-has-color-text-4" [translate]="'se.cms.actionitem.page.workflow.action.no.comments.available'"></span><se-infinite-scrolling [pageSize]="pageSize" [fetchPage]="fetchPageOfComments" (itemsChange)="onCommentsLoaded($event)"><div *ngFor="let actionComment of workflowActionComments; trackBy: trackByIndex"><se-workflow-action-comment [workflowAction]="workflowAction" [actionComment]="actionComment"></se-workflow-action-comment></div></se-infinite-scrolling></div></se-collapsible-container-content></se-collapsible-container><fd-popover [isOpen]="showApprovalInfo" [closeOnOutsideClick]="false"><fd-popover-body><div class="se-workflow-approval-info">{{ approvalInfo }}</div></fd-popover-body></fd-popover></div>`,styles:[`/*!\n * Fundamental Library Styles v0.23.0\n * Copyright (c) 2022 SAP SE or an SAP affiliate company.\n * Licensed under Apache License 2.0 (https://github.com/SAP/fundamental-styles/blob/main/LICENSE)\n *//*!\n.fd-button-split+()\n    .fd-button\n*/.fd-button-split{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;position:relative}.fd-button-split:after,.fd-button-split:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split>:first-child{margin:0;border-top-right-radius:0;border-bottom-right-radius:0}.fd-button-split>:nth-child(2){margin:0;border-top-left-radius:0;border-bottom-left-radius:0}.fd-button-split>:nth-child(2):not(.fd-button--transparent){border-left-width:0}.fd-button-split[dir=rtl]>:first-child,[dir=rtl] .fd-button-split>:first-child{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--sapButton_BorderCornerRadius);border-bottom-right-radius:var(--sapButton_BorderCornerRadius)}.fd-button-split[dir=rtl]>:nth-child(2),[dir=rtl] .fd-button-split>:nth-child(2){border-top-left-radius:var(--sapButton_BorderCornerRadius);border-bottom-left-radius:var(--sapButton_BorderCornerRadius);border-top-right-radius:0;border-bottom-right-radius:0;border-left-width:var(--sapButton_BorderWidth)}.fd-button-split[dir=rtl]>:nth-child(2):not(.fd-button--transparent),[dir=rtl] .fd-button-split>:nth-child(2):not(.fd-button--transparent){border-right-width:0}.fd-button-split>[class*="--emphasized"]:first-child{margin-right:.0625rem}.fd-button-split>[class*="--emphasized"][dir=rtl]:first-child,[dir=rtl] .fd-button-split>[class*="--emphasized"]:first-child{margin-right:0;margin-left:.0625rem}.fd-button-split>:first-child{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.fd-button-split>:first-child .fd-button-split__text{display:inline-block}.fd-button-split>:first-child:hover .fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split>:first-child:active .fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]>.fd-button-split__text{color:var(--sapButton_Emphasized_TextColor);font-weight:700}.fd-button-split--emphasized>[class*="--emphasized"]:hover>.fd-button-split__text{color:var(--sapButton_Emphasized_Hover_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--transparent>[class*="--transparent"]>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:hover>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split .fd-button-split__text{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--sapButton_TextColor);max-width:9.75rem;display:block}.fd-button-split .fd-button-split__text:after,.fd-button-split .fd-button-split__text:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split .fd-button-split__text--compact{max-width:10rem}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item,se-workflow-action-item .se-workflow-action-item{border-left:6px solid var(--sapBaseColor);border-radius:4px 0 0 4px}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item--started,se-workflow-action-item .se-workflow-action-item--started{border-left:6px solid var(--sapIndicationColor_3)}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item--completed,se-workflow-action-item .se-workflow-action-item--completed{border-left:6px solid var(--sapIndicationColor_4)}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-buttons,se-workflow-action-item .se-workflow-action-item__decision-buttons{margin:10px -30px 10px 0;text-align:right}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-buttons .fd-button-split .menu-button,se-workflow-action-item .se-workflow-action-item__decision-buttons .fd-button-split .menu-button{border-left:0;border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:4px;border-bottom-right-radius:4px}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-buttons .fd-button-split .menu-button:focus,se-workflow-action-item .se-workflow-action-item__decision-buttons .fd-button-split .menu-button:focus{box-shadow:none}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__content,se-workflow-action-item .se-workflow-action-item__content{min-height:30px}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__content-status,se-workflow-action-item .se-workflow-action-item__content-status{float:left;overflow:hidden}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__content se-infinite-scrolling .se-infinite-scrolling__container,se-workflow-action-item .se-workflow-action-item__content se-infinite-scrolling .se-infinite-scrolling__container{max-height:none;overflow-y:auto;position:relative;margin-top:-20px;width:100%}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__content se-infinite-scrolling .se-infinite-scrolling__container::before,se-workflow-action-item .se-workflow-action-item__content se-infinite-scrolling .se-infinite-scrolling__container::before{content:"";height:100%;border-left:1px solid var(--sapNeutralColor);position:absolute;left:20px;top:40px;height:calc(100% - 120px)}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__comment-list,se-workflow-action-item .se-workflow-action-item__comment-list{margin-left:5%;margin-top:5%;margin-bottom:5%}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-list,se-workflow-action-item .se-workflow-action-item__decision-list{right:-38px;background:var(--sapBaseColor)}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-list .fd-menu__list,se-workflow-action-item .se-workflow-action-item__decision-list .fd-menu__list{text-align:left}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision,se-workflow-action-item .se-workflow-action-item__decision{padding:10px 24px}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision:hover,se-workflow-action-item .se-workflow-action-item__decision:hover{text-decoration:none}.cdk-overlay-connected-position-bounding-box se-collapsible-container-header .fd-panel__body,.cdk-overlay-connected-position-bounding-box se-collapsible-container-header .fd-panel__header,se-workflow-action-item se-collapsible-container-header .fd-panel__body,se-workflow-action-item se-collapsible-container-header .fd-panel__header{border-bottom:none;padding:10px 16px;display:flex;flex-direction:column;align-items:flex-start;white-space:pre-wrap}.cdk-overlay-connected-position-bounding-box se-collapsible-container-header .fd-panel_body,se-workflow-action-item se-collapsible-container-header .fd-panel_body{color:var(--sapTextColor);padding-top:0}.cdk-overlay-connected-position-bounding-box se-collapsible-container-header .fd-panel__title,se-workflow-action-item se-collapsible-container-header .fd-panel__title{margin-top:0;font-size:13px;font-weight:700}.cdk-overlay-connected-position-bounding-box .se-workflow-approval-info,se-workflow-action-item .se-workflow-approval-info{width:320px;white-space:normal;padding:16px}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let ji=class WorkflowActionItemComponent{constructor(e,t,i,o,n,s){this.workflowFacade=e;this.cMSTimeService=t;this.systemEventService=i;this.routingService=o;this.cdr=n;this.workflowService=s;this.isMenuOpen=false;this.hasComments=true;this.pageSize=10;this.showApprovalInfo=false;this.fetchPageOfComments=(e,t,i)=>this.loadCommentsAndSetHasCommentsFlag(e,t,i)}ngOnInit(){this.unRegWorkflowMenuOpenedEvent=this.systemEventService.subscribe(Ii,((e,t)=>this.onOtherMenuOpening(e,t)))}ngOnDestroy(){this.unRegWorkflowMenuOpenedEvent()}onCommentsLoaded(e){this.workflowActionComments=e}setCollapsibleContainerApi(e){this.collapsibleContainerApi=e}getWorkflowActionStatusClass(){switch(this.workflowAction.status.toLowerCase()){case l.WorkflowActionStatus.IN_PROGRESS:return"se-workflow-action-item--started";case l.WorkflowActionStatus.COMPLETED:return"se-workflow-action-item--completed";default:return null}}getReadableStatus(){switch(this.workflowAction.status.toLowerCase()){case l.WorkflowActionStatus.IN_PROGRESS:return"se.cms.actionitem.page.workflow.action.status.started";case l.WorkflowActionStatus.PENDING:return"se.cms.actionitem.page.workflow.action.status.not.started";default:return this.workflowAction.status}}getActiveSince(){if(!!this.workflowAction.startedAgoInMillis){return this.cMSTimeService.getTimeAgo(this.workflowAction.startedAgoInMillis)}return null}canShowDecisionButtons(){return this.canMakeDecisions&&this.workflowAction.isCurrentUserParticipant&&this.workflowAction.decisions.length>0}canShowComments(){const e=this.collapsibleContainerApi&&this.collapsibleContainerApi.isExpanded();return e||this.workflowActionComments&&this.workflowActionComments.length>0}onMainButtonClick(e,t){return __awaiter(this,void 0,void 0,(function*(){e.preventDefault();e.stopPropagation();this.isMenuOpen=false;if(t.code===Bi){const e=yield this.workflowService.pageHasUnavailableDependencies();if(e){this.showApprovalInfo=!this.showApprovalInfo;this.approvalInfo=yield this.workflowService.fetchPageTranslatedApprovalInfo();if(!this.cdr.destroyed){this.cdr.detectChanges()}return}}this.makeDecision(t).then((()=>{this.routingService.reload()}))}))}onSplitButtonClick(e){e.preventDefault();e.stopPropagation();this.isMenuOpen=!this.isMenuOpen;if(this.isMenuOpen){this.systemEventService.publishAsync(Ii,{code:this.workflowAction.code})}}onMenuHide(){this.isMenuOpen=false}trackByIndex(e){return e}loadCommentsAndSetHasCommentsFlag(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.loadComments(e,t,i);this.hasComments=o.pagination.totalCount>0;if(!this.cdr.destroyed){this.cdr.detectChanges()}return o}))}loadComments(e,t,i){return this.workflowFacade.getCommentsForWorkflowAction(this.workflow.workflowCode,this.workflowAction.code,{mask:e,pageSize:t,currentPage:i})}makeDecision(e){this.systemEventService.publish(Ci);return this.workflowFacade.makeDecision(this.workflow.workflowCode,this.workflowAction,e)}onOtherMenuOpening(e,t){if(this.workflowAction.code!==t.code){this.isMenuOpen=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}}};__decorate([n.Input(),__metadata("design:type",Object)],ji.prototype,"workflow",void 0);__decorate([n.Input(),__metadata("design:type",Object)],ji.prototype,"workflowAction",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],ji.prototype,"canMakeDecisions",void 0);ji=__decorate([n.Component({selector:"se-workflow-action-item",template:`<div class="se-workflow-action-item" [ngClass]="getWorkflowActionStatusClass()"><se-collapsible-container class="se-catalog-details__collapse se-collapsible-container--noshadow fd-panel" [id]="workflowAction.code" (getApi)="setCollapsibleContainerApi($event)"><se-collapsible-container-header><div class="fd-panel__header"><div class="fd-panel__head"><h1 class="fd-panel__title">{{ workflowAction.name | seL10n | async }}</h1><p class="fd-panel__description">{{ getReadableStatus() | translate }} {{ getActiveSince() }}</p></div></div><div class="fd-panel__body">{{ workflowAction.description | seL10n | async }}<div *ngIf="canShowDecisionButtons()" class="se-workflow-action-item__decision-buttons fd-dropdown"><div class="fd-popover"><div class="fd-popover__control"><div [ngClass]="{ 'fd-button-split': workflowAction.decisions.length > 1 }"><button fd-button [compact]="true" class="se-workflow-action-item__decision-button" [id]="workflowAction.code + '-decision-button'" (click)="onMainButtonClick($event, workflowAction.decisions[0])">{{ workflowAction.decisions[0].name | seL10n | async }}</button><se-popup-overlay [popupOverlay]="{\n                                        halign: 'right',\n                                        valign: 'bottom'\n                                    }" [popupOverlayTrigger]="isMenuOpen" (popupOverlayOnHide)="onMenuHide()"><button fd-button [fdMenu]="true" [compact]="true" *ngIf="workflowAction.decisions.length > 1" [id]="workflowAction.code + '-decision-split-button'" class="menu-button" (click)="onSplitButtonClick($event)"></button><div se-popup-overlay-body class="fd-popover__body fd-popover__body--right fd-popover__body--no-arrow se-workflow-action-item__decision-list"><nav class="fd-menu"><ul class="fd-list"><li *ngFor="let decision of workflowAction.decisions"><a class="fd-list__item se-workflow-action-item__decision" (click)="onMainButtonClick($event, decision)">{{ decision.name | seL10n | async }}</a></li></ul></nav></div></se-popup-overlay></div></div></div></div></div></se-collapsible-container-header><se-collapsible-container-content><div class="se-workflow-action-item__content" *ngIf="canShowComments()"><span *ngIf="!hasComments" class="se-workflow-action-item__comment-list fd-has-font-style-italic fd-has-color-text-4" [translate]="'se.cms.actionitem.page.workflow.action.no.comments.available'"></span><se-infinite-scrolling [pageSize]="pageSize" [fetchPage]="fetchPageOfComments" (itemsChange)="onCommentsLoaded($event)"><div *ngFor="let actionComment of workflowActionComments; trackBy: trackByIndex"><se-workflow-action-comment [workflowAction]="workflowAction" [actionComment]="actionComment"></se-workflow-action-comment></div></se-infinite-scrolling></div></se-collapsible-container-content></se-collapsible-container><fd-popover [isOpen]="showApprovalInfo" [closeOnOutsideClick]="false"><fd-popover-body><div class="se-workflow-approval-info">{{ approvalInfo }}</div></fd-popover-body></fd-popover></div>`,styles:[`/*!\n * Fundamental Library Styles v0.23.0\n * Copyright (c) 2022 SAP SE or an SAP affiliate company.\n * Licensed under Apache License 2.0 (https://github.com/SAP/fundamental-styles/blob/main/LICENSE)\n *//*!\n.fd-button-split+()\n    .fd-button\n*/.fd-button-split{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;position:relative}.fd-button-split:after,.fd-button-split:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split>:first-child{margin:0;border-top-right-radius:0;border-bottom-right-radius:0}.fd-button-split>:nth-child(2){margin:0;border-top-left-radius:0;border-bottom-left-radius:0}.fd-button-split>:nth-child(2):not(.fd-button--transparent){border-left-width:0}.fd-button-split[dir=rtl]>:first-child,[dir=rtl] .fd-button-split>:first-child{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--sapButton_BorderCornerRadius);border-bottom-right-radius:var(--sapButton_BorderCornerRadius)}.fd-button-split[dir=rtl]>:nth-child(2),[dir=rtl] .fd-button-split>:nth-child(2){border-top-left-radius:var(--sapButton_BorderCornerRadius);border-bottom-left-radius:var(--sapButton_BorderCornerRadius);border-top-right-radius:0;border-bottom-right-radius:0;border-left-width:var(--sapButton_BorderWidth)}.fd-button-split[dir=rtl]>:nth-child(2):not(.fd-button--transparent),[dir=rtl] .fd-button-split>:nth-child(2):not(.fd-button--transparent){border-right-width:0}.fd-button-split>[class*="--emphasized"]:first-child{margin-right:.0625rem}.fd-button-split>[class*="--emphasized"][dir=rtl]:first-child,[dir=rtl] .fd-button-split>[class*="--emphasized"]:first-child{margin-right:0;margin-left:.0625rem}.fd-button-split>:first-child{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.fd-button-split>:first-child .fd-button-split__text{display:inline-block}.fd-button-split>:first-child:hover .fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split>:first-child:active .fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]>.fd-button-split__text{color:var(--sapButton_Emphasized_TextColor);font-weight:700}.fd-button-split--emphasized>[class*="--emphasized"]:hover>.fd-button-split__text{color:var(--sapButton_Emphasized_Hover_TextColor)}.fd-button-split--emphasized>[class*="--emphasized"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split--transparent>[class*="--transparent"]>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:hover>.fd-button-split__text{color:var(--sapButton_TextColor)}.fd-button-split--transparent>[class*="--transparent"]:active>.fd-button-split__text{color:var(--sapButton_Selected_TextColor)}.fd-button-split .fd-button-split__text{font-size:var(--sapFontSize);line-height:var(--sapContent_LineHeight);color:var(--sapTextColor);font-family:var(--sapFontFamily);font-weight:400;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;margin:0;border:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--sapButton_TextColor);max-width:9.75rem;display:block}.fd-button-split .fd-button-split__text:after,.fd-button-split .fd-button-split__text:before{-webkit-box-sizing:inherit;box-sizing:inherit;font-size:inherit}.fd-button-split .fd-button-split__text--compact{max-width:10rem}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item,se-workflow-action-item .se-workflow-action-item{border-left:6px solid var(--sapBaseColor);border-radius:4px 0 0 4px}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item--started,se-workflow-action-item .se-workflow-action-item--started{border-left:6px solid var(--sapIndicationColor_3)}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item--completed,se-workflow-action-item .se-workflow-action-item--completed{border-left:6px solid var(--sapIndicationColor_4)}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-buttons,se-workflow-action-item .se-workflow-action-item__decision-buttons{margin:10px -30px 10px 0;text-align:right}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-buttons .fd-button-split .menu-button,se-workflow-action-item .se-workflow-action-item__decision-buttons .fd-button-split .menu-button{border-left:0;border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:4px;border-bottom-right-radius:4px}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-buttons .fd-button-split .menu-button:focus,se-workflow-action-item .se-workflow-action-item__decision-buttons .fd-button-split .menu-button:focus{box-shadow:none}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__content,se-workflow-action-item .se-workflow-action-item__content{min-height:30px}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__content-status,se-workflow-action-item .se-workflow-action-item__content-status{float:left;overflow:hidden}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__content se-infinite-scrolling .se-infinite-scrolling__container,se-workflow-action-item .se-workflow-action-item__content se-infinite-scrolling .se-infinite-scrolling__container{max-height:none;overflow-y:auto;position:relative;margin-top:-20px;width:100%}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__content se-infinite-scrolling .se-infinite-scrolling__container::before,se-workflow-action-item .se-workflow-action-item__content se-infinite-scrolling .se-infinite-scrolling__container::before{content:"";height:100%;border-left:1px solid var(--sapNeutralColor);position:absolute;left:20px;top:40px;height:calc(100% - 120px)}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__comment-list,se-workflow-action-item .se-workflow-action-item__comment-list{margin-left:5%;margin-top:5%;margin-bottom:5%}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-list,se-workflow-action-item .se-workflow-action-item__decision-list{right:-38px;background:var(--sapBaseColor)}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision-list .fd-menu__list,se-workflow-action-item .se-workflow-action-item__decision-list .fd-menu__list{text-align:left}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision,se-workflow-action-item .se-workflow-action-item__decision{padding:10px 24px}.cdk-overlay-connected-position-bounding-box .se-workflow-action-item__decision:hover,se-workflow-action-item .se-workflow-action-item__decision:hover{text-decoration:none}.cdk-overlay-connected-position-bounding-box se-collapsible-container-header .fd-panel__body,.cdk-overlay-connected-position-bounding-box se-collapsible-container-header .fd-panel__header,se-workflow-action-item se-collapsible-container-header .fd-panel__body,se-workflow-action-item se-collapsible-container-header .fd-panel__header{border-bottom:none;padding:10px 16px;display:flex;flex-direction:column;align-items:flex-start;white-space:pre-wrap}.cdk-overlay-connected-position-bounding-box se-collapsible-container-header .fd-panel_body,se-workflow-action-item se-collapsible-container-header .fd-panel_body{color:var(--sapTextColor);padding-top:0}.cdk-overlay-connected-position-bounding-box se-collapsible-container-header .fd-panel__title,se-workflow-action-item se-collapsible-container-header .fd-panel__title{margin-top:0;font-size:13px;font-weight:700}.cdk-overlay-connected-position-bounding-box .se-workflow-approval-info,se-workflow-action-item .se-workflow-approval-info{width:320px;white-space:normal;padding:16px}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[Oi,r.CMSTimeService,l.SystemEventService,l.SmarteditRoutingService,n.ChangeDetectorRef,l.WorkflowService])],ji);let Gi=class WorkflowModule{};Gi=__decorate([n.NgModule({imports:[l.TranslationModule.forChild(),g.CommonModule,u.PopoverModule,S.ListModule,l.InfiniteScrollingModule,l.MoreTextModule,l.CollapsibleContainerModule,l.PopupOverlayModule,l.TooltipModule,l.DropdownMenuModule,l.HasOperationPermissionDirectiveModule,l.SpinnerModule,l.TabsModule,l.L10nPipeModule,l.FundamentalsModule,u.ButtonModule],declarations:[Mi,Ri,Li,zi,Ni,Ui,ji,wi,Ti,fi,vi,Vi,Di,xi,Ai,Fi,Pi],entryComponents:[Mi,Ri,Li,zi,Ni,Ui,ji,wi,Ti,fi,vi,Vi,Di,xi,Ai,Fi,Pi],exports:[wi],providers:[ki,Oi,l.moduleUtils.bootstrap(((e,t,i,o,n,s)=>{const a="PAGE_IN_WORKFLOW_NOTIFICATION_ID";e.subscribe(l.EVENTS.PAGE_CHANGE,(()=>{t.getPageUUID().then((e=>{i.getActiveWorkflowForPageUuid(e).then((e=>{if(e!==null&&!e.isAvailableForCurrentPrincipal){o.pushNotification({id:a,componentName:Pi.name})}else{o.removeNotification(a)}}))}))}));n.routeChangeSuccess().subscribe((e=>{const t=n.getCurrentUrlFromEvent(e);if(t!==l.STORE_FRONT_CONTEXT){o.removeNotification(a)}}))}),[l.CrossFrameEventService,l.IPageInfoService,l.WorkflowService,l.INotificationService,l.SmarteditRoutingService,ki])]})],Gi);var Hi;(function(e){e["PENDING"]="PENDING";e["NO_HOMEPAGE"]="NO_HOMEPAGE";e["LOCAL"]="LOCAL";e["OLD"]="OLD";e["PARENT"]="PARENT"})(Hi||(Hi={}));window.__smartedit__.addDecoratorPayload("Component","NewPageDisplayConditionComponent",{selector:"se-new-page-display-condition",template:`<div *ngIf="isReady"><div class="form-group"><label for="page-condition-selector-id" class="se-control-label" translate="se.cms.page.condition.selection.label"></label><se-select id="page-condition-selector-id" [model]="conditionSelected.label" (modelChange)="onConditionChange($event)" [fetchStrategy]="conditionSelectorFetchStrategy" [onChange]="onDataChange" [searchEnabled]="false"></se-select><span class="se-form-help-message"><span [translate]="conditionSelected.description"></span></span></div><div *ngIf="showPrimarySelector()" class="form-group"><label for="page-condition-primary-selector-id" class="se-control-label" translate="se.cms.page.condition.primary.association.label"></label><se-select id="page-condition-primary-selector-id" [model]="primarySelectedModel" (modelChange)="primarySelectedModelOnChange($event)" [fetchStrategy]="primaryPageChoicesFetchStrategy" [onChange]="onDataChange"></se-select><span *ngIf="primarySelected?.label" class="se-form-help-message"><span>{{ 'se.cms.page.label.label' | translate }}: {{ primarySelected.label }}</span></span></div><div *ngIf="showHomePageWidget()"><div class="fd-form__item"><input type="checkbox" id="set-homepage-checkbox" class="se-component-item--details se-component-homepage__checkbox-input fd-form__control" name="clone-on-drop" (ngModelChange)="onHomePageChange($event)" [ngModel]="homepage"/> <label class="se-control-label se-component-homepage--label fd-form__label" for="set-homepage-checkbox" translate="se.cms.display.conditions.homepage.set"></label></div><label class="se-control-label se-component-homepage--label" for="set-homepage-checkbox" *ngIf="showReplaceLabel">{{ "se.cms.display.conditions.homepage.replace" | translate: { currentHomepage: currentHomePageName } }}</label></div></div>`,styles:[`.se-component-homepage__checkbox-input{margin:0 4px 0 0;outline:0;box-shadow:none;width:1rem;height:1rem;vertical-align:text-bottom}`],changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[l.L10nPipe]});let Wi=class NewPageDisplayConditionComponent{constructor(e,t,i,o,n,s,a,r,l){this.urlService=e;this.homepageService=t;this.displayConditionsFacade=i;this.translateService=o;this.pageService=n;this.logService=s;this.pageDisplayConditions=a;this.l10n=r;this.cdr=l;this.conditions=null;this.homepage=false;this.homepageDetails={status:Hi.PENDING};this.isReady=false;this.primarySelected=null;this.primarySelectedModel=null;this.showReplaceLabel=false}ngOnInit(){this.onDataChange=()=>this.dataChanged();this.conditionSelected={};this.conditionSelectorFetchStrategy={fetchAll:()=>Promise.resolve((this.conditions||[]).map((e=>({id:e.label,label:e.label}))))};this.initialConditionSelectedKey=this.initialConditionSelectedKey||"page.displaycondition.primary";this.primaryPageChoicesFetchStrategy={fetchEntity:()=>Promise.resolve({id:this.primarySelected.uid,label:this.primarySelected.name||this.primarySelected.label}),fetchPage:(e,t,i)=>this.displayConditionsFacade.getPrimaryPagesForPageType(this.pageTypeCode,this.uriContext,{search:e,pageSize:t,currentPage:i})}}ngOnChanges(e){return __awaiter(this,void 0,void 0,(function*(){const t=!!e.pageTypeCode&&e.pageTypeCode.currentValue!=e.pageTypeCode.previousValue;const i=!!e.targetCatalogVersion&&!p.isEqual(e.targetCatalogVersion.currentValue,e.targetCatalogVersion.previousValue);if(t||i){if(!this.targetCatalogVersion||this.isUriContextEqualToCatalogVersion(this.uriContext,this.targetCatalogVersion)){yield this.getSelectedPrimaryPageAndDisplayCondition()}else{this.getOnlyPrimaryDisplayCondition()}const e=this.targetCatalogVersion===undefined?this.uriContext:this.urlService.buildUriContext(this.targetCatalogVersion.siteId,this.targetCatalogVersion.catalogId,this.targetCatalogVersion.version);const t=yield this.homepageService.getHomepageDetailsForContext(e);this.homepageDetails=t;yield this.updateHomepageUiProperties()}else{yield this.updateHomepageUiProperties()}if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}showPrimarySelector(){return!(this.conditionSelected&&this.conditionSelected.isPrimary)}onConditionChange(e){this.conditionSelected=this.conditions.find((t=>t.label===e))}onHomePageChange(e){this.homepage=e;this.dataChanged()}showHomePageWidget(){return this.isPrimaryContentPage()}primarySelectedModelOnChange(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageService.getPageById(e);this.setPrimarySelected(t);this.dataChanged()}))}dataChanged(){if(!this.isPrimaryContentPage()){this.homepage=undefined}this.updateHomepageUiProperties();if(this.resultFn){this.resultFn(this.getResults())}}isPrimaryContentPage(){var e;return((e=this.conditionSelected)===null||e===void 0?void 0:e.isPrimary)&&this.pageTypeCode==="ContentPage"}updateHomepageUiProperties(){return __awaiter(this,void 0,void 0,(function*(){if(this.homepage){switch(this.homepageDetails.status){case Hi.NO_HOMEPAGE:this.homepageService.sendEventHideReplaceParentHomePageInfo();this.showReplaceLabel=false;break;case Hi.PARENT:const[e,t]=yield this.getTranslatedNames(this.homepageDetails.parentCatalogName,this.homepageDetails.targetCatalogName);this.homepageService.sendEventShowReplaceParentHomePageInfo({description:this.translateService.instant("se.cms.display.conditions.homepage.replace.parent.info.header",{parentCatalogName:e,parentCatalogVersion:this.homepageDetails.parentCatalogVersion,targetCatalogName:t,targetCatalogVersion:this.homepageDetails.targetCatalogVersion})});this.showReplaceLabel=false;break;case Hi.LOCAL:this.homepageService.sendEventHideReplaceParentHomePageInfo();this.currentHomePageName=this.homepageDetails.currentHomepageName;this.showReplaceLabel=true;break}}else{this.homepageService.sendEventHideReplaceParentHomePageInfo();this.showReplaceLabel=false}}))}getTranslatedNames(e,t){return Promise.all([this.l10n.transform(e).pipe(d.take(1)).toPromise(),this.l10n.transform(t).pipe(d.take(1)).toPromise()])}getResults(){const e={homepage:this.homepage,isPrimary:this.conditionSelected&&this.conditionSelected.isPrimary,primaryPage:null};if(this.conditionSelected&&!this.conditionSelected.isPrimary){e.primaryPage=this.primarySelected}return e}getSelectedPrimaryPageAndDisplayCondition(){return __awaiter(this,void 0,void 0,(function*(){if(this.pageTypeCode){try{if(this.pageUuid){const e=yield this.pageService.getPageByUuid(this.pageUuid);const t=yield!e.defaultPage?this.pageService.getPrimaryPage(e.uid):e;this.setPrimarySelected(t)}}catch(e){this.logService.error(e)}finally{this.getAllPrimaryDisplayCondition()}}else{this.getAllPrimaryDisplayCondition()}}))}getAllPrimaryDisplayCondition(){return __awaiter(this,void 0,void 0,(function*(){try{const e=yield this.pageDisplayConditions.getNewPageConditions(this.pageTypeCode,this.uriContext);if(!e.length){return}this.conditions=e;this.conditionSelected=this.conditions[0];if(this.conditions.length>1){this.conditionSelected=this.conditions.find((e=>e.label===this.initialConditionSelectedKey))}this.isReady=true}catch(e){this.logService.error(e)}finally{if(this.targetCatalogVersion&&!this.isUriContextEqualToCatalogVersion(this.uriContext,this.targetCatalogVersion)){this.getOnlyPrimaryDisplayCondition()}else{this.dataChanged()}}}))}getOnlyPrimaryDisplayCondition(){this.conditions=[{description:"page.displaycondition.primary.description",isPrimary:true,label:"page.displaycondition.primary"}];this.conditionSelected=this.conditions[0];this.isReady=true;this.dataChanged()}isUriContextEqualToCatalogVersion(e,t){return e&&t&&t.siteId===e.CURRENT_CONTEXT_SITE_ID&&t.catalogId===e.CURRENT_CONTEXT_CATALOG&&t.version===e.CURRENT_CONTEXT_CATALOG_VERSION}setPrimarySelected(e){this.primarySelected=e;this.primarySelectedModel=e.uid}};__decorate([n.Input(),__metadata("design:type",String)],Wi.prototype,"pageTypeCode",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Wi.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Wi.prototype,"resultFn",void 0);__decorate([n.Input(),__metadata("design:type",String)],Wi.prototype,"pageUuid",void 0);__decorate([n.Input(),__metadata("design:type",String)],Wi.prototype,"initialConditionSelectedKey",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Wi.prototype,"targetCatalogVersion",void 0);Wi=__decorate([n.Component({selector:"se-new-page-display-condition",template:`<div *ngIf="isReady"><div class="form-group"><label for="page-condition-selector-id" class="se-control-label" translate="se.cms.page.condition.selection.label"></label><se-select id="page-condition-selector-id" [model]="conditionSelected.label" (modelChange)="onConditionChange($event)" [fetchStrategy]="conditionSelectorFetchStrategy" [onChange]="onDataChange" [searchEnabled]="false"></se-select><span class="se-form-help-message"><span [translate]="conditionSelected.description"></span></span></div><div *ngIf="showPrimarySelector()" class="form-group"><label for="page-condition-primary-selector-id" class="se-control-label" translate="se.cms.page.condition.primary.association.label"></label><se-select id="page-condition-primary-selector-id" [model]="primarySelectedModel" (modelChange)="primarySelectedModelOnChange($event)" [fetchStrategy]="primaryPageChoicesFetchStrategy" [onChange]="onDataChange"></se-select><span *ngIf="primarySelected?.label" class="se-form-help-message"><span>{{ 'se.cms.page.label.label' | translate }}: {{ primarySelected.label }}</span></span></div><div *ngIf="showHomePageWidget()"><div class="fd-form__item"><input type="checkbox" id="set-homepage-checkbox" class="se-component-item--details se-component-homepage__checkbox-input fd-form__control" name="clone-on-drop" (ngModelChange)="onHomePageChange($event)" [ngModel]="homepage"/> <label class="se-control-label se-component-homepage--label fd-form__label" for="set-homepage-checkbox" translate="se.cms.display.conditions.homepage.set"></label></div><label class="se-control-label se-component-homepage--label" for="set-homepage-checkbox" *ngIf="showReplaceLabel">{{ "se.cms.display.conditions.homepage.replace" | translate: { currentHomepage: currentHomePageName } }}</label></div></div>`,styles:[`.se-component-homepage__checkbox-input{margin:0 4px 0 0;outline:0;box-shadow:none;width:1rem;height:1rem;vertical-align:text-bottom}`],changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[l.L10nPipe]}),__metadata("design:paramtypes",[l.IUrlService,t.HomepageService,Ve,m.TranslateService,l.IPageService,l.LogService,t.PageDisplayConditionsService,l.L10nPipe,n.ChangeDetectorRef])],Wi);window.__smartedit__.addDecoratorPayload("Component","SelectPageTemplateComponent",{selector:"se-select-page-template",template:`<div class="se-page-type-step-template"><div class="se-add-page__sub-header"><div class="se-add-page__sub-header-title">{{ 'se.cms.addpagewizard.pagetemplate.description' | translate }}</div><div class="se-input-group se-page-type-step-template-list-search"><input type="text" class="se-input-group__input-area ySEPage-list-search-input fd-input" placeholder="{{ 'se.cms.pagewizard.templatestep.searchplaceholder' | translate }}" [ngModel]="searchString" (ngModelChange)="onSearchChange($event)" name="query"/> <span class="sap-icon--search se-input-group__addon"></span><div *ngIf="searchString" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="clearSearch()"></div></div></div><div class="se-add-page__list" *ngIf="pageTemplates.length > 0"><div *ngFor="let template of filteredPageTemplates" [ngClass]="{ 'is-selected': isSelected(template)}" (click)="templateSelected(template)" class="se-add-page__item se-add-page__item--page-template fd-menu__item"><div class="se-add-page__item-title">{{ template.name }}</div></div></div></div>`,styles:[`.se-add-page__sub-header{padding-bottom:16px;color:var(--sapNeutralColor)}.se-add-page__sub-header-title{margin-bottom:8px}.se-add-page__list.fd-menu{border-top:1px solid var(--sapGroup_ContentBorderColor);padding:0}.se-add-page__list .fd-menu__item{padding:10px 24px;font-weight:400}.se-add-page__list .is-selected{background-color:rgba(10,110,209,.1)}.se-add-page__item{cursor:pointer}.se-add-page__item:hover{background-color:rgba(10,110,209,.1)}.se-add-page__item--page-template{height:48px;display:flex;flex-direction:row;align-items:center}.se-add-page__item-title{font-weight:700}.se-add-page__item-description{white-space:normal}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let $i=class SelectPageTemplateComponent{constructor(e,t){this.pageTemplateService=e;this.cdr=t;this.searchString="";this.onTemplateSelected=new n.EventEmitter;this.cache={};this.pageTemplates=[]}ngOnChanges(e){var t;return __awaiter(this,void 0,void 0,(function*(){if((t=e.pageTypeCode)===null||t===void 0?void 0:t.currentValue){yield this.onInputUpdated();this.setDefaultFilteredPageTemplates();if(!this.cdr.destroyed){this.cdr.detectChanges()}}}))}templateSelected(e){this.selectedTemplate=e;this.onTemplateSelected.emit(e)}isSelected(e){var t;return e.uid===((t=this.selectedTemplate)===null||t===void 0?void 0:t.uid)}clearSearch(){this.searchString="";this.setDefaultFilteredPageTemplates()}onSearchChange(e){this.searchString=e;this.filterByQuery(this.searchString)}onInputUpdated(){return __awaiter(this,void 0,void 0,(function*(){this.clearSearch();this.selectedTemplate=null;return this.setPageTemplates()}))}setPageTemplates(){return __awaiter(this,void 0,void 0,(function*(){if(this.cache[this.pageTypeCode]){this.pageTemplates=this.cache[this.pageTypeCode];return}this.pageTemplates=[];const e=yield this.pageTemplateService.getPageTemplatesForType(this.uriContext,this.pageTypeCode);this.cache[this.pageTypeCode]=e.templates;this.pageTemplates=this.cache[this.pageTypeCode]}))}filterByQuery(e){if(!e){this.setDefaultFilteredPageTemplates();return}this.filteredPageTemplates=this.pageTemplates.filter((t=>{const i=e.split(" ");return i.every((e=>t.name.toLowerCase().includes(e.toLowerCase())))}))}setDefaultFilteredPageTemplates(){this.filteredPageTemplates=[...this.pageTemplates]}};__decorate([n.Input(),__metadata("design:type",Object)],$i.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",String)],$i.prototype,"pageTypeCode",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],$i.prototype,"onTemplateSelected",void 0);$i=__decorate([n.Component({selector:"se-select-page-template",template:`<div class="se-page-type-step-template"><div class="se-add-page__sub-header"><div class="se-add-page__sub-header-title">{{ 'se.cms.addpagewizard.pagetemplate.description' | translate }}</div><div class="se-input-group se-page-type-step-template-list-search"><input type="text" class="se-input-group__input-area ySEPage-list-search-input fd-input" placeholder="{{ 'se.cms.pagewizard.templatestep.searchplaceholder' | translate }}" [ngModel]="searchString" (ngModelChange)="onSearchChange($event)" name="query"/> <span class="sap-icon--search se-input-group__addon"></span><div *ngIf="searchString" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="clearSearch()"></div></div></div><div class="se-add-page__list" *ngIf="pageTemplates.length > 0"><div *ngFor="let template of filteredPageTemplates" [ngClass]="{ 'is-selected': isSelected(template)}" (click)="templateSelected(template)" class="se-add-page__item se-add-page__item--page-template fd-menu__item"><div class="se-add-page__item-title">{{ template.name }}</div></div></div></div>`,styles:[`.se-add-page__sub-header{padding-bottom:16px;color:var(--sapNeutralColor)}.se-add-page__sub-header-title{margin-bottom:8px}.se-add-page__list.fd-menu{border-top:1px solid var(--sapGroup_ContentBorderColor);padding:0}.se-add-page__list .fd-menu__item{padding:10px 24px;font-weight:400}.se-add-page__list .is-selected{background-color:rgba(10,110,209,.1)}.se-add-page__item{cursor:pointer}.se-add-page__item:hover{background-color:rgba(10,110,209,.1)}.se-add-page__item--page-template{height:48px;display:flex;flex-direction:row;align-items:center}.se-add-page__item-title{font-weight:700}.se-add-page__item-description{white-space:normal}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[t.PageTemplateService,n.ChangeDetectorRef])],$i);window.__smartedit__.addDecoratorPayload("Component","SelectPageTypeComponent",{selector:"se-select-page-type",template:`<div><div class="se-add-page__sub-header">{{ 'se.cms.addpagewizard.pagetype.description' | translate }}</div><div class="se-add-page__list" *ngIf="pageTypes.length > 0"><div class="se-add-page__item fd-menu__item" *ngFor="let pageType of pageTypes" [ngClass]="{ 'is-selected': isSelected(pageType)}" (click)="selectType(pageType)"><div class="se-add-page__item-title">{{ pageType.name | seL10n | async }}</div><div class="se-add-page__item-description">{{ pageType.description | seL10n | async }}</div></div></div></div>`,styles:[`.se-add-page__sub-header{padding-bottom:16px;color:var(--sapNeutralColor)}.se-add-page__sub-header-title{margin-bottom:8px}.se-add-page__list.fd-menu{border-top:1px solid var(--sapGroup_ContentBorderColor);padding:0}.se-add-page__list .fd-menu__item{padding:10px 24px;font-weight:400}.se-add-page__list .is-selected{background-color:rgba(10,110,209,.1)}.se-add-page__item{cursor:pointer}.se-add-page__item:hover{background-color:rgba(10,110,209,.1)}.se-add-page__item--page-template{height:48px;display:flex;flex-direction:row;align-items:center}.se-add-page__item-title{font-weight:700}.se-add-page__item-description{white-space:normal}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Ki=class SelectPageTypeComponent{constructor(e,t,i){this.pageTypeService=e;this.typePermissionsRestService=t;this.cdr=i;this.onTypeSelected=new n.EventEmitter;this.pageTypes=[]}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){yield this.loadPageTypes();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}selectType(e){this.onTypeSelected.emit(e)}isSelected(e){return e.code===this.pageTypeCode}loadPageTypes(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageTypeService.getPageTypes();const t=e.map((e=>e.code));const i=yield this.typePermissionsRestService.hasCreatePermissionForTypes(t);this.pageTypes=e.filter((e=>i[e.code]))}))}};__decorate([n.Input(),__metadata("design:type",String)],Ki.prototype,"pageTypeCode",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Ki.prototype,"onTypeSelected",void 0);Ki=__decorate([n.Component({selector:"se-select-page-type",template:`<div><div class="se-add-page__sub-header">{{ 'se.cms.addpagewizard.pagetype.description' | translate }}</div><div class="se-add-page__list" *ngIf="pageTypes.length > 0"><div class="se-add-page__item fd-menu__item" *ngFor="let pageType of pageTypes" [ngClass]="{ 'is-selected': isSelected(pageType)}" (click)="selectType(pageType)"><div class="se-add-page__item-title">{{ pageType.name | seL10n | async }}</div><div class="se-add-page__item-description">{{ pageType.description | seL10n | async }}</div></div></div></div>`,styles:[`.se-add-page__sub-header{padding-bottom:16px;color:var(--sapNeutralColor)}.se-add-page__sub-header-title{margin-bottom:8px}.se-add-page__list.fd-menu{border-top:1px solid var(--sapGroup_ContentBorderColor);padding:0}.se-add-page__list .fd-menu__item{padding:10px 24px;font-weight:400}.se-add-page__list .is-selected{background-color:rgba(10,110,209,.1)}.se-add-page__item{cursor:pointer}.se-add-page__item:hover{background-color:rgba(10,110,209,.1)}.se-add-page__item--page-template{height:48px;display:flex;flex-direction:row;align-items:center}.se-add-page__item-title{font-weight:700}.se-add-page__item-description{white-space:normal}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[ke,r.TypePermissionsRestService,n.ChangeDetectorRef])],Ki);window.__smartedit__.addDecoratorPayload("Component","SelectTargetCatalogVersionComponent",{selector:"se-select-target-catalog-version",template:`<div class="target-catalog-version-selector-wrapper form-group"><label for="se-catalog-version-selector-dropdown" class="se-control-label" translate="se.cms.clonepagewizard.options.targetcatalogversion.label"></label><se-select *ngIf="!!catalogVersions.length" id="se-catalog-version-selector-dropdown" [(model)]="selectedCatalogVersion" [fetchStrategy]="catalogVersionSelectorFetchStrategy" [onChange]="onSelectionChange" [searchEnabled]="false" (getApi)="setSelectApi($event)"></se-select><div *ngIf="catalogVersionContainsPageWithSameLabel"><span class="se-exists-label-warning" translate="se.cms.clonepagewizard.options.targetcatalogversion.label.exists.message"></span></div></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let qi=class SelectTargetCatalogVersionComponent{constructor(e,t,i,o,s){this.pageFacade=e;this.catalogVersionRestService=t;this.catalogService=i;this.pageService=o;this.cdr=s;this.catalogVersions=[];this.selectedCatalogVersion=null;this.catalogVersionContainsPageWithSameLabel=false;this.onTargetCatalogVersionSelected=new n.EventEmitter}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.catalogVersionSelectorFetchStrategy={fetchAll:()=>Promise.resolve((this.catalogVersions||[]).map((e=>({id:e.uuid,label:e.name}))))};this.onSelectionChange=()=>this.selectionChangeHandler();yield this.setupCatalogVersions();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}setSelectApi(e){this.selectApi=e}setupCatalogVersions(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogVersionRestService.getCloneableTargets(this.uriContext);const t=e.versions;if(!p.isEmpty(t)){const e=yield this.catalogService.getCatalogVersionUUid(this.uriContext);const i=t.find((t=>t.uuid===e));if(i){this.selectedCatalogVersion=i.uuid}else{this.selectedCatalogVersion=t[0].uuid}this.catalogVersions=t}}))}selectionChangeHandler(){return __awaiter(this,void 0,void 0,(function*(){if(!this.selectedCatalogVersion){return}const e=yield this.catalogService.getCatalogVersionByUuid(this.selectedCatalogVersion);this.onTargetCatalogVersionSelected.emit(e);if(this.pageTypeCode==="ContentPage"){this.catalogVersionContainsPageWithSameLabel=yield this.determineContentPageWithLabelExists(e)}if(!this.cdr.destroyed){this.cdr.detectChanges()}this.updateSelectValidationState()}))}determineContentPageWithLabelExists(e){return this.pageFacade.contentPageWithLabelExists(this.pageLabel,e.catalogId,e.version)}updateSelectValidationState(){if(!this.selectApi){return}if(this.catalogVersionContainsPageWithSameLabel){this.selectApi.setValidationState(l.VALIDATION_MESSAGE_TYPES.WARNING)}else{this.selectApi.resetValidationState()}}};__decorate([n.Input(),__metadata("design:type",Object)],qi.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",String)],qi.prototype,"pageTypeCode",void 0);__decorate([n.Input(),__metadata("design:type",String)],qi.prototype,"pageLabel",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],qi.prototype,"onTargetCatalogVersionSelected",void 0);qi=__decorate([n.Component({selector:"se-select-target-catalog-version",template:`<div class="target-catalog-version-selector-wrapper form-group"><label for="se-catalog-version-selector-dropdown" class="se-control-label" translate="se.cms.clonepagewizard.options.targetcatalogversion.label"></label><se-select *ngIf="!!catalogVersions.length" id="se-catalog-version-selector-dropdown" [(model)]="selectedCatalogVersion" [fetchStrategy]="catalogVersionSelectorFetchStrategy" [onChange]="onSelectionChange" [searchEnabled]="false" (getApi)="setSelectApi($event)"></se-select><div *ngIf="catalogVersionContainsPageWithSameLabel"><span class="se-exists-label-warning" translate="se.cms.clonepagewizard.options.targetcatalogversion.label.exists.message"></span></div></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[Xe,Pe,l.ICatalogService,l.IPageService,n.ChangeDetectorRef])],qi);class ClonePageBuilder{constructor(e,t,i,o,n,s,a,r){this.restrictionsStepHandler=e;this.basePageUUID=t;this.uriContext=i;this.contextAwarePageStructureService=o;this.typeStructureRestService=n;this.cmsitemsRestService=s;this.catalogService=a;this.pageInfoService=r;this.basePage={};this.pageData={};this.pageInfoStructure={};this.basePageInfoAvailable=false;this.componentCloneOption=""}getPageTypeCode(){return this.pageData.typeCode}getPageTemplate(){return this.pageData.template}getPageLabel(){return this.pageData.label}getBasePageUuid(){return this.basePage.uuid}getPageInfo(){return this.pageData}getBasePageInfo(){return this.basePage}getPageProperties(){return{type:this.pageData.type,typeCode:this.pageData.typeCode,template:this.pageData.template,onlyOneRestrictionMustApply:this.pageData.onlyOneRestrictionMustApply,catalogVersion:this.pageData.catalogVersion}}getPageInfoStructure(){return this.pageInfoStructure}getPageRestrictions(){return this.pageData.restrictions||[]}getComponentCloneOption(){return this.componentCloneOption}displayConditionSelected(e){return __awaiter(this,void 0,void 0,(function*(){const t=e.isPrimary;this.pageData.defaultPage=t;this.pageData.homepage=e.homepage;if(t){this.pageData.label=this.basePage.label;if(this.pageData.restrictions){delete this.pageData.restrictions}this.restrictionsStepHandler.hideStep()}else{this.pageData.label=e.primaryPage?e.primaryPage.label:"";this.restrictionsStepHandler.showStep()}this.pageData.uid="";yield this.updatePageInfoFields()}))}onTargetCatalogVersionSelected(e){this.targetCatalogVersion=e;this.pageData.catalogVersion=e.uuid}componentCloneOptionSelected(e){this.componentCloneOption=e}restrictionsSelected(e,t){this.pageData.onlyOneRestrictionMustApply=e;this.pageData.restrictions=t}getTargetCatalogVersion(){return this.targetCatalogVersion}isBasePageInfoAvailable(){return this.basePageInfoAvailable}init(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getPageUUID(this.basePageUUID);const t=yield this.catalogService.getCatalogVersionUUid(this.uriContext);const i=yield this.cmsitemsRestService.getById(e);this.basePage=p.cloneDeep(i);this.pageData=p.cloneDeep(this.basePage);this.pageData.catalogVersion=t;this.pageData.pageUuid=this.basePage.uuid;delete this.pageData.uuid;this.basePageInfoAvailable=true;this.pageData.template=this.basePage.masterTemplateId;const o=yield this.typeStructureRestService.getStructureByTypeAndMode(this.pageData.typeCode,"DEFAULT",true);this.pageData.type=o.type}))}getPageUUID(e){return __awaiter(this,void 0,void 0,(function*(){return!l.stringUtils.isBlank(e)?e:this.pageInfoService.getPageUUID()}))}updatePageInfoFields(){return __awaiter(this,void 0,void 0,(function*(){if(typeof this.pageData.defaultPage==="undefined"){return}if(this.pageData.typeCode){const e=yield this.contextAwarePageStructureService.getPageStructureForNewPage(this.pageData.typeCode,this.pageData.defaultPage);this.pageInfoStructure=e}else{this.pageInfoStructure={}}}))}}let Yi=class ClonePageBuilderFactory{constructor(e,t,i,o,n,s){this.contextAwarePageStructureService=e;this.typeStructureRestService=t;this.cmsitemsRestService=i;this.catalogService=o;this.pageInfoService=n;this.pageService=s}createClonePageBuilder(e,t,i){return new ClonePageBuilder(e,t,i,this.contextAwarePageStructureService,this.typeStructureRestService,this.cmsitemsRestService,this.catalogService,this.pageInfoService)}};Yi=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.ContextAwarePageStructureService,Le,l.CmsitemsRestService,l.ICatalogService,l.IPageInfoService,l.IPageService])],Yi);window.__smartedit__.addDecoratorPayload("Component","ClonePageOptionsStepComponent",{selector:"se-clone-page-options-step",template:`\n        <se-event-message\n            class="existing-homepage__ymessage"\n            [showEvent]="'CMS_EVENT_SHOW_REPLACE_PARENT_HOMEPAGE_INFO'"\n            [hideEvent]="'CMS_EVENT_HIDE_REPLACE_PARENT_HOMEPAGE_INFO'">\n        </se-event-message>\n\n        <se-select-target-catalog-version\n            *ngIf="wizardApi.isBasePageInfoAvailable()"\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            [pageLabel]="wizardApi.getPageLabel()"\n            [uriContext]="wizardApi.uriContext"\n            (onTargetCatalogVersionSelected)="wizardApi.onTargetCatalogVersionSelected($event)">\n        </se-select-target-catalog-version>\n        <se-new-page-display-condition\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            [uriContext]="wizardApi.uriContext"\n            [resultFn]="wizardApi.variationResult"\n            [initialConditionSelectedKey]="'page.displaycondition.variation'"\n            [pageUuid]="wizardApi.getBasePageUuid()"\n            [targetCatalogVersion]="wizardApi.getTargetCatalogVersion()">\n        </se-new-page-display-condition>\n\n        <se-component-clone-option-form\n            (onSelectionChange)="\n                wizardApi.triggerUpdateCloneOptionResult($event)\n            "></se-component-clone-option-form>\n    `});let Zi=class ClonePageOptionsStepComponent{constructor(e){this.wizardApi=e}};Zi=__decorate([n.Component({selector:"se-clone-page-options-step",template:`\n        <se-event-message\n            class="existing-homepage__ymessage"\n            [showEvent]="'CMS_EVENT_SHOW_REPLACE_PARENT_HOMEPAGE_INFO'"\n            [hideEvent]="'CMS_EVENT_HIDE_REPLACE_PARENT_HOMEPAGE_INFO'">\n        </se-event-message>\n\n        <se-select-target-catalog-version\n            *ngIf="wizardApi.isBasePageInfoAvailable()"\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            [pageLabel]="wizardApi.getPageLabel()"\n            [uriContext]="wizardApi.uriContext"\n            (onTargetCatalogVersionSelected)="wizardApi.onTargetCatalogVersionSelected($event)">\n        </se-select-target-catalog-version>\n        <se-new-page-display-condition\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            [uriContext]="wizardApi.uriContext"\n            [resultFn]="wizardApi.variationResult"\n            [initialConditionSelectedKey]="'page.displaycondition.variation'"\n            [pageUuid]="wizardApi.getBasePageUuid()"\n            [targetCatalogVersion]="wizardApi.getTargetCatalogVersion()">\n        </se-new-page-display-condition>\n\n        <se-component-clone-option-form\n            (onSelectionChange)="\n                wizardApi.triggerUpdateCloneOptionResult($event)\n            "></se-component-clone-option-form>\n    `}),__param(0,n.Inject(l.WIZARD_API)),__metadata("design:paramtypes",[Object])],Zi);window.__smartedit__.addDecoratorPayload("Component","ClonePageRestrictionsStepComponent",{selector:"se-clone-page-options-step",template:`\n        <span *ngIf="wizardApi.isRestrictionsActive()" class="se-clone-page-restriction-step">\n            <div *ngIf="wizardApi.getPageRestrictions().length > 1">\n                <se-page-restrictions-info-message></se-page-restrictions-info-message>\n            </div>\n\n            <se-restrictions-editor\n                [editable]="true"\n                [(resetFn)]="wizardApi.restrictionsEditorFunctionBindings.reset"\n                [(cancelFn)]="wizardApi.restrictionsEditorFunctionBindings.cancel"\n                [(isDirtyFn)]="wizardApi.restrictionsEditorFunctionBindings.isDirty"\n                (onRestrictionsChange)="wizardApi.restrictionsResult($event)"\n                [getRestrictionTypes]="wizardApi.getRestrictionTypes"\n                [getSupportedRestrictionTypes]="wizardApi.getSupportedRestrictionTypes"\n                [item]="wizardApi.getBasePageInfo()"\n                [restrictionUuids]="wizardApi.getPageRestrictions()">\n            </se-restrictions-editor>\n        </span>\n    `});let Xi=class ClonePageRestrictionsStepComponent{constructor(e){this.wizardApi=e}};Xi=__decorate([n.Component({selector:"se-clone-page-options-step",template:`\n        <span *ngIf="wizardApi.isRestrictionsActive()" class="se-clone-page-restriction-step">\n            <div *ngIf="wizardApi.getPageRestrictions().length > 1">\n                <se-page-restrictions-info-message></se-page-restrictions-info-message>\n            </div>\n\n            <se-restrictions-editor\n                [editable]="true"\n                [(resetFn)]="wizardApi.restrictionsEditorFunctionBindings.reset"\n                [(cancelFn)]="wizardApi.restrictionsEditorFunctionBindings.cancel"\n                [(isDirtyFn)]="wizardApi.restrictionsEditorFunctionBindings.isDirty"\n                (onRestrictionsChange)="wizardApi.restrictionsResult($event)"\n                [getRestrictionTypes]="wizardApi.getRestrictionTypes"\n                [getSupportedRestrictionTypes]="wizardApi.getSupportedRestrictionTypes"\n                [item]="wizardApi.getBasePageInfo()"\n                [restrictionUuids]="wizardApi.getPageRestrictions()">\n            </se-restrictions-editor>\n        </span>\n    `}),__param(0,n.Inject(l.WIZARD_API)),__metadata("design:paramtypes",[Object])],Xi);window.__smartedit__.addDecoratorPayload("Component","ClonePageInfoStepComponent",{selector:"se-clone-page-info-step",template:`\n        <se-component-clone-info-form\n            *ngIf="wizardApi.isPageInfoActive()"\n            [structure]="wizardApi.getPageInfoStructure()"\n            [content]="wizardApi.getPageInfo()"\n            [(submit)]="wizardApi.callbacks.savePageInfo"\n            [(reset)]="wizardApi.callbacks.resetPageInfo"\n            [(isDirty)]="wizardApi.callbacks.isDirtyPageInfo"\n            [(isValid)]="wizardApi.callbacks.isValidPageInfo"\n            [pageTemplate]="wizardApi.getPageTemplate()"\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            [uriContext]="wizardApi.uriContext"\n            [targetCatalogVersion]="wizardApi.getTargetCatalogVersion()">\n        </se-component-clone-info-form>\n    `});let Qi=class ClonePageInfoStepComponent{constructor(e){this.wizardApi=e}};Qi=__decorate([n.Component({selector:"se-clone-page-info-step",template:`\n        <se-component-clone-info-form\n            *ngIf="wizardApi.isPageInfoActive()"\n            [structure]="wizardApi.getPageInfoStructure()"\n            [content]="wizardApi.getPageInfo()"\n            [(submit)]="wizardApi.callbacks.savePageInfo"\n            [(reset)]="wizardApi.callbacks.resetPageInfo"\n            [(isDirty)]="wizardApi.callbacks.isDirtyPageInfo"\n            [(isValid)]="wizardApi.callbacks.isValidPageInfo"\n            [pageTemplate]="wizardApi.getPageTemplate()"\n            [pageTypeCode]="wizardApi.getPageTypeCode()"\n            [uriContext]="wizardApi.uriContext"\n            [targetCatalogVersion]="wizardApi.getTargetCatalogVersion()">\n        </se-component-clone-info-form>\n    `}),__param(0,n.Inject(l.WIZARD_API)),__metadata("design:paramtypes",[Object])],Qi);const Ji="se.cms.clonepagewizard.pageclone.title";window.__smartedit__.addDecoratorPayload("Component","ClonePageWizardComponent",{selector:"se-clone-page-wizard",template:""});let eo=class ClonePageWizardComponent{constructor(e,t,i,o,n,s,a,r,l,d,p,m,g){this.wizardManager=e;this.clonePageBuilderFactory=t;this.restrictionsStepHandlerFactory=i;this.experienceService=o;this.confirmationModalService=n;this.systemEventService=s;this.restrictionTypesService=a;this.restrictionsService=r;this.sharedDataService=l;this.clonePageAlertService=d;this.alertService=p;this.pageFacade=m;this.syncPollingService=g;this.getWizardConfig=()=>({isFormValid:e=>this.isFormValid(e),onNext:()=>this.onNext(),onDone:()=>this.onDone(),onCancel:()=>this.onCancel(),steps:[{id:this.CLONE_PAGE_WIZARD_STEPS.PAGE_CLONE_OPTIONS,name:"se.cms.clonepagewizard.pagecloneoptions.tabname",title:Ji,component:Zi},{id:this.CLONE_PAGE_WIZARD_STEPS.PAGE_INFO,name:"se.cms.clonepagewizard.pageinfo.tabname",title:Ji,component:Qi}]});this.getRestrictionTypes=()=>this.restrictionTypesService.getRestrictionTypesByPageType(this.getPageTypeCode());this.getSupportedRestrictionTypes=()=>this.restrictionsService.getSupportedRestrictionTypeCodes();this.variationResult=e=>{this.infoChanged=true;this.pageBuilder.displayConditionSelected(e)};this.basePageUUID=this.wizardManager.properties.basePageUUID;this.callbacks={};this.uriContext=this.wizardManager.properties.uriContext;this.restrictionStepProperties={id:"restrictionsStepId",name:"se.cms.restrictions.editor.tab",title:Ji,component:Xi};const u={};this.restrictionsEditorFunctionBindings=u;this.cloneInProgress=false;this.infoChanged=true;this.typeChanged=true;this.restrictionsStepHandler=this.restrictionsStepHandlerFactory.createRestrictionsStepHandler(this.wizardManager,this.restrictionsEditorFunctionBindings,this.restrictionStepProperties);this.pageBuilder=this.clonePageBuilderFactory.createClonePageBuilder(this.restrictionsStepHandler,this.basePageUUID,this.uriContext);this.pageBuilder.init();this.CLONE_PAGE_WIZARD_STEPS={PAGE_CLONE_OPTIONS:"cloneOptions",PAGE_INFO:"pageInfo",PAGE_RESTRICTIONS:this.restrictionStepProperties.id}}getPageTypeCode(){return this.pageBuilder.getPageTypeCode()}getPageLabel(){return this.pageBuilder.getPageLabel()}getBasePageUuid(){return this.pageBuilder.getBasePageUuid()}getPageTemplate(){return this.pageBuilder.getPageTemplate()}getPageInfo(){const e=this.pageBuilder.getPageInfo();e.uriContext=this.uriContext;return e}getBasePageInfo(){const e=this.pageBuilder.getBasePageInfo();e.uriContext=this.uriContext;return e}getPageRestrictions(){return this.pageBuilder.getPageRestrictions()}onTargetCatalogVersionSelected(e){this.pageBuilder.onTargetCatalogVersionSelected(e)}triggerUpdateCloneOptionResult(e){this.pageBuilder.componentCloneOptionSelected(e)}getPageInfoStructure(){return this.pageBuilder.getPageInfoStructure()}restrictionsResult(e){this.pageBuilder.restrictionsSelected(e.onlyOneRestrictionMustApply,e.restrictionUuids)}isRestrictionsActive(){if(!this.typeChanged||this.wizardManager.getCurrentStepId()===this.CLONE_PAGE_WIZARD_STEPS.PAGE_RESTRICTIONS){this.typeChanged=false;return true}return false}isPageInfoActive(){if(!this.infoChanged||this.wizardManager.getCurrentStepId()===this.CLONE_PAGE_WIZARD_STEPS.PAGE_INFO){this.infoChanged=false;return true}return false}getTargetCatalogVersion(){return this.pageBuilder.getTargetCatalogVersion()}isBasePageInfoAvailable(){return this.pageBuilder.isBasePageInfoAvailable()}onCancel(){return this.confirmationModalService.confirm({description:"se.editor.cancel.confirm"})}isFormValid(e){switch(e){case this.CLONE_PAGE_WIZARD_STEPS.PAGE_CLONE_OPTIONS:return this.isBasePageInfoAvailable();case this.CLONE_PAGE_WIZARD_STEPS.PAGE_INFO:return!this.cloneInProgress&&!!this.callbacks.isValidPageInfo&&this.callbacks.isValidPageInfo();case this.CLONE_PAGE_WIZARD_STEPS.PAGE_RESTRICTIONS:return!this.cloneInProgress&&this.pageBuilder.getPageRestrictions().length>0}return false}onNext(){return true}onDone(){return __awaiter(this,void 0,void 0,(function*(){this.cloneInProgress=true;try{const e=yield this.callbacks.savePageInfo();const t=this.preparePagePayload(e);if(this.pageBuilder.getTargetCatalogVersion()){t.siteId=this.pageBuilder.getTargetCatalogVersion().siteId;t.catalogId=this.pageBuilder.getTargetCatalogVersion().catalogId;t.version=this.pageBuilder.getTargetCatalogVersion().version}const i=yield this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY);yield this.createPage(t,i)}catch(e){this.cloneInProgress=false;return Promise.reject()}return Promise.resolve()}))}createPage(e,t){return __awaiter(this,void 0,void 0,(function*(){try{const i=yield this.pageFacade.createPageForSite(e,e.siteId);this.syncPollingService.getSyncStatus(e.pageUuid,this.uriContext,true);if(t.catalogDescriptor.catalogVersionUuid===i.catalogVersion){this.experienceService.loadExperience({siteId:e.siteId,catalogId:e.catalogId,catalogVersion:e.version,pageId:i.uid})}else{this.clonePageAlertService.displayClonePageAlert(i)}return this.alertService.showSuccess({message:"se.cms.clonepage.alert.success",minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"})}catch(e){this.cloneInProgress=false;this.systemEventService.publishAsync(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,{messages:e.error.errors});const t=e.error.errors;if(!t.find((e=>e.subject.indexOf("restrictions")===0))){this.wizardManager.goToStepWithId(this.CLONE_PAGE_WIZARD_STEPS.PAGE_INFO)}return Promise.reject()}}))}preparePagePayload(e){const t=p.cloneDeep(e);p.merge(t,this.pageBuilder.getPageProperties());t.cloneComponents=this.pageBuilder.getComponentCloneOption()==="clone";t.itemtype=e.typeCode;if(t.linkComponents&&t.linkComponents.length>0){t.linkComponents=[]}if(this.isRestrictionsActive()){t.restrictions=this.pageBuilder.getPageRestrictions()}return t}};eo=__decorate([n.Component({selector:"se-clone-page-wizard",template:""}),__param(0,n.Inject(l.WIZARD_MANAGER)),__metadata("design:paramtypes",[l.WizardService,Yi,t.RestrictionsStepHandlerFactory,l.IExperienceService,l.IConfirmationModalService,l.SystemEventService,t.RestrictionTypesService,t.RestrictionsService,l.ISharedDataService,t.ClonePageAlertService,l.IAlertService,Xe,l.ISyncPollingService])],eo);let to=class ClonePageWizardService{constructor(e,t,i){this.modalWizard=e;this.catalogService=t;this.pageFacade=i}openClonePageWizard(e){return __awaiter(this,void 0,void 0,(function*(){const t=e?yield this.catalogService.retrieveUriContext():yield this.pageFacade.retrievePageUriContext();return this.modalWizard.open({component:eo,properties:{uriContext:t,basePageUUID:e?e.uuid:undefined}})}))}};to=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ModalWizard,l.ICatalogService,Xe])],to);window.__smartedit__.addDecoratorPayload("Component","ComponentCloneInfoFormComponent",{selector:"se-component-clone-info-form",template:`<se-message *ngIf="catalogVersionContainsPageWithSameTypeCode" type="warning"><span se-message-description translate="se.cms.clonepagewizard.pageinfo.targetcatalogversion.pagetype.exists.message" [translateParams]="{ typeCode: pageTypeCode }"></span></se-message><se-generic-editor [id]="genericEditorId" [structure]="structure" [content]="content" [(submit)]="submitInternal" [(reset)]="resetInternal" [(isDirty)]="isDirtyInternal" [(isValid)]="isValidInternal" (getApi)="setGenericEditorApi($event)"></se-generic-editor>`});let io=class ComponentCloneInfoFormComponent{constructor(e,t,i,o,s){this.translateService=e;this.languageService=t;this.pageFacade=i;this.pageService=o;this.systemEventService=s;this.genericEditorId="COMPONENT_CLONE_INFO_FORM_GENERIC_ID";this.isDirtyChange=new n.EventEmitter;this.isValidChange=new n.EventEmitter;this.submitChange=new n.EventEmitter;this.resetChange=new n.EventEmitter}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.pageLabel=null;this.catalogVersionContainsPageWithSameTypeCode=false;if(this.pageTypeCode!=="ContentPage"&&this.targetCatalogVersion&&!this.isUriContextEqualToCatalogVersion(this.uriContext,this.targetCatalogVersion)){const e={[l.PAGE_CONTEXT_SITE_ID]:this.targetCatalogVersion.siteId,[r.PAGE_CONTEXT_CATALOG]:this.targetCatalogVersion.catalogId,[r.PAGE_CONTEXT_CATALOG_VERSION]:this.targetCatalogVersion.version};const t=yield this.pageService.primaryPageForPageTypeExists(this.pageTypeCode,e);this.catalogVersionContainsPageWithSameTypeCode=t}setTimeout((()=>{this.isDirtyChange.emit((()=>this.isDirtyInternal&&this.isDirtyInternal()));this.isValidChange.emit((()=>this.isValidInternal&&this.isValidInternal()));this.submitChange.emit((()=>this.submitInternal&&this.submitInternal()));this.resetChange.emit((()=>this.resetInternal&&this.resetInternal()))}));this.genericEditorLoadEventUnsubscribe=this.systemEventService.subscribe(l.GENERIC_EDITOR_LOADED_EVENT,((e,t)=>this.handleWarningMessage(t)))}))}ngOnDestroy(){if(this.genericEditorLoadEventUnsubscribe){this.genericEditorLoadEventUnsubscribe()}}setGenericEditorApi(e){this.pageInfoEditorApi=e;if(this.targetCatalogVersion&&!this.isUriContextEqualToCatalogVersion(this.uriContext,this.targetCatalogVersion)){this.pageInfoEditorApi.getLanguages=()=>this.languageService.getLanguagesForSite(this.targetCatalogVersion.siteId)}}isUriContextEqualToCatalogVersion(e,t){return e&&t&&t.siteId===e.CURRENT_CONTEXT_SITE_ID&&t.catalogId===e.CURRENT_CONTEXT_CATALOG&&t.version===e.CURRENT_CONTEXT_CATALOG_VERSION}handleWarningMessage(e){return __awaiter(this,void 0,void 0,(function*(){if(e!==this.genericEditorId){return}if(this.pageTypeCode==="ContentPage"&&this.targetCatalogVersion&&this.pageInfoEditorApi&&!this.isUriContextEqualToCatalogVersion(this.uriContext,this.targetCatalogVersion)){const e=this.pageInfoEditorApi.getContent();if(e&&e.label!==this.pageLabel){this.pageLabel=e.label;yield this.toggleWarningMessage()}}}))}toggleWarningMessage(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageFacade.contentPageWithLabelExists(this.pageLabel,this.targetCatalogVersion.catalogId,this.targetCatalogVersion.version);if(e){this.systemEventService.publishAsync(l.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT,{messages:[{subject:"label",message:this.translateService.instant("se.cms.clonepagewizard.pageinfo.targetcatalogversion.label.exists.message"),type:"Warning"}]})}else{this.pageInfoEditorApi.clearMessages()}}))}};__decorate([n.Input(),__metadata("design:type",Object)],io.prototype,"content",void 0);__decorate([n.Input(),__metadata("design:type",String)],io.prototype,"pageTemplate",void 0);__decorate([n.Input(),__metadata("design:type",String)],io.prototype,"pageTypeCode",void 0);__decorate([n.Input(),__metadata("design:type",Object)],io.prototype,"structure",void 0);__decorate([n.Input(),__metadata("design:type",Object)],io.prototype,"targetCatalogVersion",void 0);__decorate([n.Input(),__metadata("design:type",Object)],io.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Function)],io.prototype,"submit",void 0);__decorate([n.Input(),__metadata("design:type",Function)],io.prototype,"reset",void 0);__decorate([n.Input(),__metadata("design:type",Function)],io.prototype,"isDirty",void 0);__decorate([n.Input(),__metadata("design:type",Function)],io.prototype,"isValid",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],io.prototype,"isDirtyChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],io.prototype,"isValidChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],io.prototype,"submitChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],io.prototype,"resetChange",void 0);io=__decorate([n.Component({selector:"se-component-clone-info-form",template:`<se-message *ngIf="catalogVersionContainsPageWithSameTypeCode" type="warning"><span se-message-description translate="se.cms.clonepagewizard.pageinfo.targetcatalogversion.pagetype.exists.message" [translateParams]="{ typeCode: pageTypeCode }"></span></se-message><se-generic-editor [id]="genericEditorId" [structure]="structure" [content]="content" [(submit)]="submitInternal" [(reset)]="resetInternal" [(isDirty)]="isDirtyInternal" [(isValid)]="isValidInternal" (getApi)="setGenericEditorApi($event)"></se-generic-editor>`}),__metadata("design:paramtypes",[m.TranslateService,l.LanguageService,Xe,l.IPageService,l.SystemEventService])],io);window.__smartedit__.addDecoratorPayload("Component","ComponentCloneOptionFormComponent",{selector:"se-component-clone-option-form",template:`<label for="components-cloned-selector-id" class="se-control-label"><span translate="se.cms.clonepagewizard.options.title"></span><se-help><span translate="se.cms.clonepagewizard.options.tooltip"></span></se-help></label><div id="components-cloned-selector-id"><div class="se-form-control-row"><input class="components-cloned-option-id fd-form__control" type="radio" name="componentsclone" id="reference-cloning" [(ngModel)]="componentInSlotOption" (click)="updateComponentInSlotOption(CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.REFERENCE_EXISTING)" [value]="CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.REFERENCE_EXISTING"/> <label for="reference-cloning" translate="se.cms.clonepagewizard.options.existing"></label></div><div class="se-form-control-row"><input class="components-cloned-option-id fd-form__control" type="radio" id="deep-cloning" name="componentsclone" [(ngModel)]="componentInSlotOption" (click)="updateComponentInSlotOption(CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.CLONE)" [value]="CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.CLONE"/> <label for="deep-cloning" translate="se.cms.clonepagewizard.options.copies"></label></div></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let oo=class ComponentCloneOptionFormComponent{constructor(){this.CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION={REFERENCE_EXISTING:"reference",CLONE:"clone"};this.onSelectionChange=new n.EventEmitter}ngOnInit(){this.componentInSlotOption=this.CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.REFERENCE_EXISTING;this.onSelectionChange.emit(this.componentInSlotOption)}updateComponentInSlotOption(e){this.onSelectionChange.emit(e)}};__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],oo.prototype,"onSelectionChange",void 0);oo=__decorate([n.Component({selector:"se-component-clone-option-form",template:`<label for="components-cloned-selector-id" class="se-control-label"><span translate="se.cms.clonepagewizard.options.title"></span><se-help><span translate="se.cms.clonepagewizard.options.tooltip"></span></se-help></label><div id="components-cloned-selector-id"><div class="se-form-control-row"><input class="components-cloned-option-id fd-form__control" type="radio" name="componentsclone" id="reference-cloning" [(ngModel)]="componentInSlotOption" (click)="updateComponentInSlotOption(CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.REFERENCE_EXISTING)" [value]="CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.REFERENCE_EXISTING"/> <label for="reference-cloning" translate="se.cms.clonepagewizard.options.existing"></label></div><div class="se-form-control-row"><input class="components-cloned-option-id fd-form__control" type="radio" id="deep-cloning" name="componentsclone" [(ngModel)]="componentInSlotOption" (click)="updateComponentInSlotOption(CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.CLONE)" [value]="CLONE_COMPONENTS_IN_CONTENT_SLOTS_OPTION.CLONE"/> <label for="deep-cloning" translate="se.cms.clonepagewizard.options.copies"></label></div></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[])],oo);window.__smartedit__.addDecoratorPayload("Component","DeletePageToolbarItemComponent",{selector:"se-delete-page-toolbar-item",template:`<div class="toolbar-action" *ngIf="isReady" [attr.data-item-key]="toolbarItem.key"><button *ngIf="!isDeletePageDisabled" type="button" se-tooltip-trigger class="btn fd-button toolbar-action--button" title="{{ 'se.cms.actionitem.page.trash' | translate }}" [ngClass]="{ 'toolbar-action__disabled' : isDeletePageDisabled }" (click)="deletePage()"><span class="sap-icon--delete se-toolbar-menu-ddlb--button__icon"></span><div class="toolbar-action-button__txt" translate="se.cms.actionitem.page.trash"></div></button><se-tooltip *ngIf="isDeletePageDisabled" [isChevronVisible]="true" [placement]="'bottom'" [triggers]="['mouseenter', 'mouseleave']"><button fd-button type="button" se-tooltip-trigger class="btn toolbar-action--button" [disabled]="isDeletePageDisabled" [ngClass]="{ 'toolbar-action__disabled' : isDeletePageDisabled }" (click)="deletePage()"><span class="sap-icon--delete se-toolbar-menu-ddlb--button__icon"></span><div class="toolbar-action-button__txt" translate="se.cms.actionitem.page.trash"></div></button><div se-tooltip-body><span [translate]="tooltipMessage"></span></div></se-tooltip></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let no=class DeletePageToolbarItemComponent{constructor(e,t,i,o,n,s,a,r){this.pageService=e;this.pageFacade=t;this.managePageService=i;this.systemEventService=o;this.crossFrameEventService=n;this.cdr=s;this.userTrackingService=a;this.toolbarItem=r}ngOnInit(){this.unRegPageChange=this.crossFrameEventService.subscribe(l.EVENTS.PAGE_CHANGE,(()=>this.updateToolbar()));return this.updateToolbar()}ngOnDestroy(){this.unRegPageChange()}get isDeletePageDisabled(){return!this.isDeletePageEnabled}deletePage(){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.TOOL_BAR,"Delete Page");const e=yield this.pageService.getCurrentPageInfo();yield this.managePageService.softDeletePage(e,this.uriContext);this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE)}))}updateToolbar(){return __awaiter(this,void 0,void 0,(function*(){this.markAsNotReady();if(!this.cdr.destroyed){this.cdr.detectChanges()}const e=yield this.pageFacade.retrievePageUriContext();if(!e){return}this.uriContext=e;this.pageInfo=yield this.pageService.getCurrentPageInfo();this.isDeletePageEnabled=yield this.managePageService.isPageTrashable(this.pageInfo,this.uriContext);this.tooltipMessage=yield this.resolveTooltipMessage(this.isDeletePageEnabled,this.pageInfo,this.uriContext);this.markAsReady();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}markAsNotReady(){this.isReady=false;this.isDeletePageEnabled=false;this.tooltipMessage=null}markAsReady(){this.isReady=true}resolveTooltipMessage(e,t,i){return __awaiter(this,void 0,void 0,(function*(){return yield e?null:this.managePageService.getDisabledTrashTooltipMessage(t,i)}))}};no=__decorate([n.Component({selector:"se-delete-page-toolbar-item",template:`<div class="toolbar-action" *ngIf="isReady" [attr.data-item-key]="toolbarItem.key"><button *ngIf="!isDeletePageDisabled" type="button" se-tooltip-trigger class="btn fd-button toolbar-action--button" title="{{ 'se.cms.actionitem.page.trash' | translate }}" [ngClass]="{ 'toolbar-action__disabled' : isDeletePageDisabled }" (click)="deletePage()"><span class="sap-icon--delete se-toolbar-menu-ddlb--button__icon"></span><div class="toolbar-action-button__txt" translate="se.cms.actionitem.page.trash"></div></button><se-tooltip *ngIf="isDeletePageDisabled" [isChevronVisible]="true" [placement]="'bottom'" [triggers]="['mouseenter', 'mouseleave']"><button fd-button type="button" se-tooltip-trigger class="btn toolbar-action--button" [disabled]="isDeletePageDisabled" [ngClass]="{ 'toolbar-action__disabled' : isDeletePageDisabled }" (click)="deletePage()"><span class="sap-icon--delete se-toolbar-menu-ddlb--button__icon"></span><div class="toolbar-action-button__txt" translate="se.cms.actionitem.page.trash"></div></button><div se-tooltip-body><span [translate]="tooltipMessage"></span></div></se-tooltip></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(7,n.Inject(l.TOOLBAR_ITEM)),__metadata("design:paramtypes",[l.IPageService,Xe,t.ManagePageService,l.SystemEventService,l.CrossFrameEventService,n.ChangeDetectorRef,l.IUserTrackingService,Object])],no);var so;(function(e){e["PENDING"]="PENDING";e["NO_HOMEPAGE"]="NO_HOMEPAGE";e["LOCAL"]="LOCAL";e["OLD"]="OLD";e["PARENT"]="PARENT"})(so||(so={}));window.__smartedit__.addDecoratorPayload("Component","DisplayConditionsEditorComponent",{selector:"se-display-conditions-editor",template:`<div><se-event-message class="existing-homepage__ymessage" [showEvent]="'CMS_EVENT_SHOW_REPLACE_PARENT_HOMEPAGE_INFO'" [hideEvent]="'CMS_EVENT_HIDE_REPLACE_PARENT_HOMEPAGE_INFO'"></se-event-message><se-display-conditions-page-info [pageName]="getPageName()" [pageType]="getPageType()" [isPrimary]="isPagePrimary()"></se-display-conditions-page-info><se-display-conditions-page-variations *ngIf="isPagePrimary()" [variations]="getVariations()"></se-display-conditions-page-variations><se-display-conditions-primary-page *ngIf="!isPagePrimary()" [readOnly]="getIsAssociatedPrimaryReadOnly()" [associatedPrimaryPage]="getAssociatedPrimaryPage()" [pageType]="getPageType()" (onPrimaryPageSelect)="onPrimaryPageSelect($event)"></se-display-conditions-primary-page><div *ngIf="showHomePageWidget()"><div class="se-component-homepage"><label class="se-control-label"><input type="checkbox" id="set-homepage-checkbox" class="fd-form__control se-display-conditions__homepage-input" name="clone-on-drop" [disabled]="disableHomepageCheckbox()" (ngModelChange)="homePageChanged($event)" [ngModel]="page.homepage"/> <span translate="se.cms.display.conditions.homepage.set"></span><se-help *ngIf="disableHomepageCheckbox()"><span translate="se.cms.display.conditions.homepage.disabled"></span></se-help></label></div><div class="se-display-conditions__replace-home-message" *ngIf="showReplaceLabel" translate="se.cms.display.conditions.homepage.replace" [translateParams]="{ currentHomepage: currentHomePageName }"></div></div></div>`,styles:[`.se-display-conditions__homepage-input{margin:0 4px 0 0}.se-display-conditions__replace-home-message{padding-top:8px}`],changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[l.L10nPipe]});let ao=class DisplayConditionsEditorComponent{constructor(e,t,i,o,n,s,a,r,l){this.data=e;this.route=t;this.displayConditionsEditorModel=i;this.homepageService=o;this.pageService=n;this.logService=s;this.l10n=a;this.translateService=r;this.cdr=l;({model:this.page}=this.data);this.hasFallback=false;this.isPrimaryPage=false;this.showReplaceLabel=false;this.homepageDetails={status:so.PENDING}}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){yield this.displayConditionsEditorModel.initModel(this.page.uid);const e=this.getRouteParams();try{const t=yield this.pageService.buildUriContextForCurrentPage(e.siteId,e.catalogId,e.catalogVersion);const[i,o,n]=yield Promise.all([this.pageService.isPagePrimaryWithContext(this.page.uid,t),this.homepageService.hasFallbackHomePage(t),this.homepageService.getHomepageDetailsForContext(t)]);this.isPrimaryPage=i;this.hasFallback=o;this.homepageDetails=n;if(!this.cdr.destroyed){this.cdr.detectChanges()}}catch(e){this.logService.error("DisplayConditionsEditorComponent::ngOnInit - unable to retrieve uriContext")}}))}disableHomepageCheckbox(){if(this.hasFallback){return false}if(this.homepageDetails.status===so.LOCAL){if(this.homepageDetails.currentHomepageUid===this.page.uid){return true}if(this.homepageDetails.oldHomepageUid===this.page.uid){return false}return false}return true}homePageChanged(e){return __awaiter(this,void 0,void 0,(function*(){this.page.homepage=e;if(this.page.homepage){switch(this.homepageDetails.status){case so.NO_HOMEPAGE:this.homepageService.sendEventHideReplaceParentHomePageInfo();this.showReplaceLabel=false;break;case so.PARENT:const[e,t]=yield this.getTranslatedNames(this.homepageDetails.parentCatalogName,this.homepageDetails.targetCatalogName);this.homepageService.sendEventShowReplaceParentHomePageInfo({description:this.translateService.instant("se.cms.display.conditions.homepage.replace.parent.info.header",{parentCatalogName:e,parentCatalogVersion:this.homepageDetails.parentCatalogVersion,targetCatalogName:t,targetCatalogVersion:this.homepageDetails.targetCatalogVersion})});this.showReplaceLabel=false;break;case so.LOCAL:this.homepageService.sendEventHideReplaceParentHomePageInfo();this.currentHomePageName=this.homepageDetails.currentHomepageName;this.showReplaceLabel=this.page.uid!==this.homepageDetails.currentHomepageUid;break}}else{this.homepageService.sendEventHideReplaceParentHomePageInfo();this.showReplaceLabel=false}}))}showHomePageWidget(){return this.homepageDetails.status!==so.PENDING&&this.page.typeCode==="ContentPage"&&this.isPrimaryPage}getPageName(){return this.displayConditionsEditorModel.pageName}getPageType(){return this.displayConditionsEditorModel.pageType}isPagePrimary(){return this.displayConditionsEditorModel.isPrimary}getVariations(){return this.displayConditionsEditorModel.variations}getAssociatedPrimaryPage(){return this.displayConditionsEditorModel.associatedPrimaryPage}getIsAssociatedPrimaryReadOnly(){return this.displayConditionsEditorModel.isAssociatedPrimaryReadOnly}onPrimaryPageSelect(e){this.page.label=e.label}getRouteParams(){let e=this.route.firstChild?this.route.firstChild:this.route;while(!!e.firstChild){e=e.firstChild}return e.snapshot.params}getTranslatedNames(e,t){return Promise.all([this.l10n.transform(e).pipe(d.take(1)).toPromise(),this.l10n.transform(t).pipe(d.take(1)).toPromise()])}};ao=__decorate([n.Component({selector:"se-display-conditions-editor",template:`<div><se-event-message class="existing-homepage__ymessage" [showEvent]="'CMS_EVENT_SHOW_REPLACE_PARENT_HOMEPAGE_INFO'" [hideEvent]="'CMS_EVENT_HIDE_REPLACE_PARENT_HOMEPAGE_INFO'"></se-event-message><se-display-conditions-page-info [pageName]="getPageName()" [pageType]="getPageType()" [isPrimary]="isPagePrimary()"></se-display-conditions-page-info><se-display-conditions-page-variations *ngIf="isPagePrimary()" [variations]="getVariations()"></se-display-conditions-page-variations><se-display-conditions-primary-page *ngIf="!isPagePrimary()" [readOnly]="getIsAssociatedPrimaryReadOnly()" [associatedPrimaryPage]="getAssociatedPrimaryPage()" [pageType]="getPageType()" (onPrimaryPageSelect)="onPrimaryPageSelect($event)"></se-display-conditions-primary-page><div *ngIf="showHomePageWidget()"><div class="se-component-homepage"><label class="se-control-label"><input type="checkbox" id="set-homepage-checkbox" class="fd-form__control se-display-conditions__homepage-input" name="clone-on-drop" [disabled]="disableHomepageCheckbox()" (ngModelChange)="homePageChanged($event)" [ngModel]="page.homepage"/> <span translate="se.cms.display.conditions.homepage.set"></span><se-help *ngIf="disableHomepageCheckbox()"><span translate="se.cms.display.conditions.homepage.disabled"></span></se-help></label></div><div class="se-display-conditions__replace-home-message" *ngIf="showReplaceLabel" translate="se.cms.display.conditions.homepage.replace" [translateParams]="{ currentHomepage: currentHomePageName }"></div></div></div>`,styles:[`.se-display-conditions__homepage-input{margin:0 4px 0 0}.se-display-conditions__replace-home-message{padding-top:8px}`],changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[l.L10nPipe]}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,b.ActivatedRoute,t.DisplayConditionsEditorModel,t.HomepageService,l.IPageService,l.LogService,l.L10nPipe,m.TranslateService,n.ChangeDetectorRef])],ao);window.__smartedit__.addDecoratorPayload("Component","DisplayConditionsPageInfoComponent",{selector:"se-display-conditions-page-info",template:`<div class="se-edit-page-info__display-conditions"><div class="se-edit-page-info-display-conditions__basic-info"><div><label class="se-control-label" translate="se.cms.pagelist.headerpagename"></label><div class="form-readonly-text form-readonly-text__tight dc-page-name">{{ pageName }}</div></div><div><label class="se-control-label" translate="se.cms.pagelist.headerpagetype"></label><div class="form-readonly-text form-readonly-text__tight dc-page-type">{{ pageType }}</div></div></div><label class="se-control-label"><span translate="se.cms.display.conditions.label"></span><se-help><span [translate]="getPageDisplayConditionDescriptionI18nKey()"></span></se-help></label><p class="form-readonly-text form-readonly-text__tight dc-page-display-condition" [translate]="getPageDisplayConditionI18nKey()"></p></div>`,styles:[`.se-edit-page-info__display-conditions{margin-bottom:16px}.se-edit-page-info-display-conditions__basic-info{display:grid;grid-template-columns:repeat(2,1fr);margin-bottom:16px}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let ro=class DisplayConditionsPageInfoComponent{getPageDisplayConditionI18nKey(){return this.isPrimary?"se.cms.display.conditions.primary.id":"se.cms.display.conditions.variation.id"}getPageDisplayConditionDescriptionI18nKey(){return this.isPrimary?"se.cms.display.conditions.primary.description":"se.cms.display.conditions.variation.description"}};__decorate([n.Input(),__metadata("design:type",Boolean)],ro.prototype,"isPrimary",void 0);__decorate([n.Input(),__metadata("design:type",String)],ro.prototype,"pageName",void 0);__decorate([n.Input(),__metadata("design:type",String)],ro.prototype,"pageType",void 0);ro=__decorate([n.Component({selector:"se-display-conditions-page-info",template:`<div class="se-edit-page-info__display-conditions"><div class="se-edit-page-info-display-conditions__basic-info"><div><label class="se-control-label" translate="se.cms.pagelist.headerpagename"></label><div class="form-readonly-text form-readonly-text__tight dc-page-name">{{ pageName }}</div></div><div><label class="se-control-label" translate="se.cms.pagelist.headerpagetype"></label><div class="form-readonly-text form-readonly-text__tight dc-page-type">{{ pageType }}</div></div></div><label class="se-control-label"><span translate="se.cms.display.conditions.label"></span><se-help><span [translate]="getPageDisplayConditionDescriptionI18nKey()"></span></se-help></label><p class="form-readonly-text form-readonly-text__tight dc-page-display-condition" [translate]="getPageDisplayConditionI18nKey()"></p></div>`,styles:[`.se-edit-page-info__display-conditions{margin-bottom:16px}.se-edit-page-info-display-conditions__basic-info{display:grid;grid-template-columns:repeat(2,1fr);margin-bottom:16px}`],changeDetection:n.ChangeDetectionStrategy.OnPush})],ro);window.__smartedit__.addDecoratorPayload("Component","CreationDateRendererComponent",{selector:"se-creation-date-renderer",template:`<span>{{ item.creationDate | date : 'short' }}</span>`});let lo=class CreationDateRendererComponent{constructor(e){this.cellData=e;this.item=this.cellData.item}};lo=__decorate([n.Component({selector:"se-creation-date-renderer",template:`<span>{{ item.creationDate | date : 'short' }}</span>`}),__param(0,n.Inject(l.CLIENT_PAGED_LIST_CELL_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],lo);window.__smartedit__.addDecoratorPayload("Component","DisplayConditionsPageVariationsComponent",{selector:"se-display-conditions-page-variations",template:`<div class="form-group dc-page-variations"><label class="se-control-label control-label__margin"><span translate="se.cms.display.conditions.variation.pages.title"></span><se-help *ngIf="variations.length > 0"><span translate="se.cms.display.conditions.variations.description"></span></se-help></label><div *ngIf="variations.length === 0" class="dc-no-variations form-readonly-text form-readonly-text__tight form-readonly-text__inline" translate="se.cms.display.conditions.no.variations"></div><div *ngIf="variations.length > 0"><se-client-paged-list [items]="variations" [keys]="keys" [itemsPerPage]="itemsPerPage" class="dc-page-variations-list"></se-client-paged-list></div></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let co=class DisplayConditionsPageVariationsComponent{constructor(){this.itemsPerPage=3;this.keys=[{property:"pageName",i18n:"se.cms.display.conditions.header.page.name"},{property:"creationDate",i18n:"se.cms.display.conditions.header.creation.date",component:lo},{property:"restrictions",i18n:"se.cms.display.conditions.header.restrictions"}]}};__decorate([n.Input(),__metadata("design:type",Array)],co.prototype,"variations",void 0);co=__decorate([n.Component({selector:"se-display-conditions-page-variations",template:`<div class="form-group dc-page-variations"><label class="se-control-label control-label__margin"><span translate="se.cms.display.conditions.variation.pages.title"></span><se-help *ngIf="variations.length > 0"><span translate="se.cms.display.conditions.variations.description"></span></se-help></label><div *ngIf="variations.length === 0" class="dc-no-variations form-readonly-text form-readonly-text__tight form-readonly-text__inline" translate="se.cms.display.conditions.no.variations"></div><div *ngIf="variations.length > 0"><se-client-paged-list [items]="variations" [keys]="keys" [itemsPerPage]="itemsPerPage" class="dc-page-variations-list"></se-client-paged-list></div></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[])],co);window.__smartedit__.addDecoratorPayload("Component","DisplayConditionsPrimaryPageComponent",{selector:"se-display-conditions-primary-page",template:`<div class="form-group form-group__inline"><label class="se-control-label control-label__margin" translate="se.cms.display.conditions.primary.page.label"></label><div *ngIf="readOnly" class="dc-associated-primary-page form-readonly-text form-readonly-text__tight">{{ associatedPrimaryPage?.name }}</div><div *ngIf="!readOnly"><se-select id="display-conditions-primary-association-selector" [model]="associatedPrimaryPageUid" (modelChange)="associatedPrimaryPageUidOnChange($event)" [fetchStrategy]="fetchStrategy"></se-select><span *ngIf="associatedPrimaryPage?.name" class="se-form-help-message"><span>{{ 'se.cms.page.label.label' | translate }}: {{ associatedPrimaryPage.label }}</span></span></div></div>`});let po=class DisplayConditionsPrimaryPageComponent{constructor(e,t){this.pageService=e;this.displayConditionsFacade=t;this.associatedPrimaryPageUid=null;this.onPrimaryPageSelect=new n.EventEmitter;this.fetchStrategy={fetchEntity:()=>Promise.resolve({id:this.associatedPrimaryPage.uid,label:this.associatedPrimaryPage.name}),fetchPage:(e,t,i)=>this.displayConditionsFacade.getPrimaryPagesForPageType(this.pageType,null,{search:e,pageSize:t,currentPage:i})}}ngOnChanges(e){const t=e.associatedPrimaryPage;if(t&&!!t.currentValue){this.setAssociatedPrimaryPageSelected(t.currentValue)}}associatedPrimaryPageUidOnChange(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageService.getPageById(e);this.setAssociatedPrimaryPageSelected(t);this.onPrimaryPageSelect.emit(this.associatedPrimaryPage)}))}setAssociatedPrimaryPageSelected(e){this.associatedPrimaryPage=e;this.associatedPrimaryPageUid=e.uid}};__decorate([n.Input(),__metadata("design:type",Boolean)],po.prototype,"readOnly",void 0);__decorate([n.Input(),__metadata("design:type",Object)],po.prototype,"associatedPrimaryPage",void 0);__decorate([n.Input(),__metadata("design:type",String)],po.prototype,"pageType",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],po.prototype,"onPrimaryPageSelect",void 0);po=__decorate([n.Component({selector:"se-display-conditions-primary-page",template:`<div class="form-group form-group__inline"><label class="se-control-label control-label__margin" translate="se.cms.display.conditions.primary.page.label"></label><div *ngIf="readOnly" class="dc-associated-primary-page form-readonly-text form-readonly-text__tight">{{ associatedPrimaryPage?.name }}</div><div *ngIf="!readOnly"><se-select id="display-conditions-primary-association-selector" [model]="associatedPrimaryPageUid" (modelChange)="associatedPrimaryPageUidOnChange($event)" [fetchStrategy]="fetchStrategy"></se-select><span *ngIf="associatedPrimaryPage?.name" class="se-form-help-message"><span>{{ 'se.cms.page.label.label' | translate }}: {{ associatedPrimaryPage.label }}</span></span></div></div>`}),__metadata("design:paramtypes",[l.IPageService,Ve])],po);window.__smartedit__.addDecoratorPayload("Component","HomepageIconComponent",{selector:"se-homepage-icon",template:`<se-tooltip *ngIf="isVisible()" [isChevronVisible]="true" [triggers]="['mouseenter', 'mouseleave']"><span se-tooltip-trigger class="sap-icon--home se-homepage-icon" [ngClass]="getIconClass()"></span> <span se-tooltip-body [translate]="getTooltipMessage()"></span></se-tooltip>`,styles:[`.se-homepage-icon{margin-right:4px}.se-homepage-icon--current{color:var(--sapInformativeColor)}.se-homepage-icon--old{color:var(--sapTextColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let mo=class HomepageIconComponent{constructor(e,t){this.homepageService=e;this.cdr=t}ngOnChanges(){return __awaiter(this,void 0,void 0,(function*(){if(!this.cmsPage&&!this.uriContext){return}this.type=yield this.homepageService.getHomepageType(this.cmsPage,this.uriContext);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}isVisible(){return!!this.type}getIconClass(){return{"se-homepage-icon--current":this.type===t.HomepageType.CURRENT,"se-homepage-icon--old":this.type===t.HomepageType.OLD}}getTooltipMessage(){const e=this.getHomepageState(this.type);return`se.cms.homepage.tooltip.message.${e}`}getHomepageState(e){return t.HomepageType.CURRENT===e?"current":"previous"}};__decorate([n.Input(),__metadata("design:type",Object)],mo.prototype,"cmsPage",void 0);__decorate([n.Input(),__metadata("design:type",Object)],mo.prototype,"uriContext",void 0);mo=__decorate([n.Component({selector:"se-homepage-icon",template:`<se-tooltip *ngIf="isVisible()" [isChevronVisible]="true" [triggers]="['mouseenter', 'mouseleave']"><span se-tooltip-trigger class="sap-icon--home se-homepage-icon" [ngClass]="getIconClass()"></span> <span se-tooltip-body [translate]="getTooltipMessage()"></span></se-tooltip>`,styles:[`.se-homepage-icon{margin-right:4px}.se-homepage-icon--current{color:var(--sapInformativeColor)}.se-homepage-icon--old{color:var(--sapTextColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[t.HomepageService,n.ChangeDetectorRef])],mo);let go=class PageEditorModalConfigService{constructor(e,t,i,o,n){this.cmsitemsRestService=e;this.pageService=t;this.contextAwarePageStructureService=i;this.contextAwareEditableItemService=o;this.translateService=n}create(e){return __awaiter(this,void 0,void 0,(function*(){const t={title:"se.cms.pageeditormodal.editpagetab.title",componentUuid:e.uuid,componentType:e.typeCode};const[i,o]=yield Promise.all([this.cmsitemsRestService.getById(e.uuid),this.pageService.isPagePrimary(e.uid)]);t.content=i;t.content.template=i.masterTemplateId;const n=yield this.contextAwarePageStructureService.getPageStructureForPageEditing(t.content.typeCode,t.content.uid);t.structure=n;if(o){t.structure.attributes=this.filterPrimaryPageAttributes(t.structure.attributes)}if(!!e.uid){yield this.ensureReadOnlyMode(e,t)}return t}))}filterPrimaryPageAttributes(e){return e.filter((e=>this.isPrimaryPageAttribute(e)))}isPrimaryPageAttribute(e){return e.qualifier!=="restrictions"&&e.qualifier!=="onlyOneRestrictionMustApply"}ensureReadOnlyMode(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.contextAwareEditableItemService.isItemEditable(e.uid);t.readOnlyMode=!i;if(t.readOnlyMode){t.messages=[{type:"info",message:this.translateService.instant("se.cms.pageeditormodal.page.readonly.message")}]}return t}))}};go=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.CmsitemsRestService,l.IPageService,t.ContextAwarePageStructureService,r.IContextAwareEditableItemService,m.TranslateService])],go);let uo=class PageEditorModalService{constructor(e,t,i,o,n){this.genericEditorModalService=e;this.crossFrameEventService=t;this.systemEventService=i;this.pageEditorModalConfigService=o;this.logService=n}open(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageEditorModalConfigService.create(e);try{const i=yield this.genericEditorModalService.open(t,(()=>{this.crossFrameEventService.publish(r.DEFAULT_SYNCHRONIZATION_POLLING.FETCH_SYNC_STATUS_ONCE,e.uuid)}));this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE,i)}catch(e){this.logService.debug("Page Editor Modal dismissed",e)}}))}};uo=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.GenericEditorModalService,l.CrossFrameEventService,l.SystemEventService,go,l.LogService])],uo);let ho=class PageInfoMenuService{constructor(e,t,i,o,n,s,a){this.displayConditionsFacade=e;this.logService=t;this.pageEditorModalService=i;this.pageService=o;this.pageVersionSelectionService=n;this.translateService=s;this.typeStructureRestService=a;this.ALL_RESTRICTIONS_CRITERIA_LABEL="se.cms.restrictions.criteria.all";this.ANY_RESTRICTIONS_CRITERIA_LABEL="se.cms.restrictions.criteria.any";this.isPageEditorOpened=false}openPageEditor(e){if(p.isNil(e)){this.logService.warn(`[${this.constructor.name}] - Cannot open page editor. Provided page is empty.`);return}if(!this.isPageEditorOpened){this.isPageEditorOpened=true;this.pageEditorModalService.open(e).finally((()=>{this.isPageEditorOpened=false}))}}getCurrentPageInfo(){return __awaiter(this,void 0,void 0,(function*(){try{const e=yield this.pageService.getCurrentPageInfoByVersion(this.getCurrentPageVersionId());const t=yield this.getPrimaryPageName(e);e.template=e.masterTemplateId;const i=p.cloneDeep(e);i.content=e;i.primaryPage=t;i.localizedType=e.typeCode;i.displayCondition=this.getPageDisplayCondition(e);i.restrictionsCriteria=this.getPageRestrictionsCriteria(e);return i}catch(e){this.logService.warn(`[${this.constructor.name}] - Cannot retrieve page info. Please try again later.`);return null}}))}getPageStructureForViewing(e,t){return __awaiter(this,void 0,void 0,(function*(){try{const i=yield this.typeStructureRestService.getStructureByType(e);const o=i.map((e=>Object.assign(Object.assign({},e),{editable:false})));this.removeFieldFromStructure(o,"uid");this.removeFieldFromStructure(o,"restrictions");const n=[];const s=this.removeFieldFromStructure(o,"name");s.cmsStructureType="InfoPageName";this.addFieldToStructure(n,s);this.addFieldToStructure(n,this.buildField("displayCondition"));const a=this.structureContainsItemByFieldQualifier(o,"description");if(a){const e=this.removeFieldFromStructure(o,"description");e.cmsStructureType="InfoPageName";this.addFieldToStructure(n,e)}const r=this.structureContainsItemByFieldQualifier(o,"title");if(r){const e=this.removeFieldFromStructure(o,"title");e.cmsStructureType="InfoPageName";this.addFieldToStructure(n,e)}const l=this.structureContainsItemByFieldQualifier(o,"label");if(l){const e=this.removeFieldFromStructure(o,"label");e.cmsStructureType="InfoPageName";this.addFieldToStructure(n,e)}this.addFieldToStructure(n,this.buildField("localizedType"));this.addFieldToStructure(n,this.buildField("template"));if(!t){this.addFieldToStructure(n,this.buildField("primaryPage"));this.addFieldToStructure(n,this.buildField("restrictions","RestrictionsList"))}this.addFieldToStructure(n,this.removeFieldFromStructure(o,"creationtime"));this.addFieldToStructure(n,this.removeFieldFromStructure(o,"modifiedtime"));return{attributes:p.concat(n,o),category:"PAGE"}}catch(e){this.logService.warn(`[${this.constructor.name}] - Cannot retrieve page info structure. Please try again later.`);return null}}))}addFieldToStructure(e,t){if(t){e.push(t)}}buildField(e,t="ShortString"){return{cmsStructureType:t,qualifier:e,i18nKey:"se.cms.pageinfo.page."+e.toLocaleLowerCase(),editable:false}}structureContainsItemByFieldQualifier(e,t){return!!e.find((e=>e.qualifier===t))}removeFieldFromStructure(e,t){const i=p.remove(e,(e=>e.qualifier===t));return i[0]}getPrimaryPageName(e){return __awaiter(this,void 0,void 0,(function*(){if(this.isVariationPage(e)){const{name:t}=yield this.displayConditionsFacade.getPrimaryPageForVariationPage(e.uid);return t||null}return null}))}isVariationPage(e){return!e.defaultPage}getPageDisplayCondition(e){const t=this.isVariationPage(e)?"page.displaycondition.variation":"page.displaycondition.primary";return this.translateService.instant(t)}getPageRestrictionsCriteria(e){if(this.isVariationPage(e)&&e.onlyOneRestrictionMustApply!==undefined){const t=e.onlyOneRestrictionMustApply?this.ANY_RESTRICTIONS_CRITERIA_LABEL:this.ALL_RESTRICTIONS_CRITERIA_LABEL;return this.translateService.instant(t)}return null}getCurrentPageVersionId(){const e=this.pageVersionSelectionService.getSelectedPageVersion();return e?e.uid:null}};ho=__decorate([n.Injectable(),__metadata("design:paramtypes",[Ve,l.LogService,uo,l.IPageService,l.PageVersionSelectionService,m.TranslateService,Le])],ho);window.__smartedit__.addDecoratorPayload("Component","PageInfoMenuComponent",{selector:"se-page-info-menu",template:`<div class="toolbar-action" data-item-key="se.cms.pageInfoMenu"><fd-popover [(isOpen)]="toolbarItem.isOpen" (isOpenChange)="onDropdownToggle($event)" [closeOnOutsideClick]="true"><fd-popover-control><button fd-button type="button" class="btn toolbar-action--button" title="{{ 'se.cms.pageinfo.menu.btn.tooltip' | translate }}" [attr.aria-pressed]="toolbarItem.isOpen"><span class="sap-icon--hint se-toolbar-menu-ddlb--button__icon"></span><div class="se-toolbar-page-info-wrapper"><span class="toolbar-action-button__txt" [translate]="toolbarItem.name"></span></div></button></fd-popover-control><fd-popover-body><div class="se-page-info__dropdown-menu toolbar-action--include"><div class="se-page-info-menu" *ngIf="toolbarItem.isOpen"><se-prevent-vertical-overflow><div class="se-page-info-menu__header"><span class="se-page-info-menu__header-title" translate="se.cms.pageinfo.information.title"></span><div *seHasOperationPermission="editPagePermission"><button fd-button class="se-page-info__edit-btn fd-button--compact" *ngIf="isReady" label="{{ 'se.cms.contextmenu.title.edit' | translate }}" (click)="onEditPageClick()"></button></div></div><div *ngIf="isReady" class="se-page-info-menu__body"><se-generic-editor [smarteditComponentId]="pageInfo.uid" [smarteditComponentType]="pageInfo.typeCode" [structure]="pageStructure" [content]="pageInfo"></se-generic-editor></div></se-prevent-vertical-overflow></div></div></fd-popover-body></fd-popover></div>`,styles:[`.se-page-info-menu__header{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);height:53px;padding-top:15px;height:48px}.se-page-info-menu__header:first-child{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-page-info-menu__body{width:100%;height:400px;overflow-y:auto}.se-page-info-menu__body--title{text-transform:capitalize}.se-page-info__dropdown-menu{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%}.se-page-info__dropdown-menu::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.se-page-info__dropdown-menu::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.se-page-info__dropdown-menu::after,.se-page-info__dropdown-menu::before{left:14px}.se-page-info__dropdown-menu input{color:var(--sapTextColor)!important}.se-page-info-menu se-ge-tab{display:grid;grid-template-columns:repeat(1,1fr);grid-gap:0 16px;width:368px}.se-page-info-menu__body .fd-form-control[type=email]:disabled .fd-popover-custom,.se-page-info-menu__body .fd-form-control[type=text]:disabled .fd-popover-custom,.se-page-info-menu__body .se-select.is-disabled .fd-popover-custom,.se-tabset-wrapper .fd-form-control[type=email]:disabled .fd-popover-custom,.se-tabset-wrapper .fd-form-control[type=text]:disabled .fd-popover-custom,.se-tabset-wrapper .se-select.is-disabled .fd-popover-custom{opacity:1}.se-page-info-menu__body .fd-form-control[type=email]:disabled .fd-popover-custom .toggle-button,.se-page-info-menu__body .fd-form-control[type=text]:disabled .fd-popover-custom .toggle-button,.se-page-info-menu__body .se-select.is-disabled .fd-popover-custom .toggle-button,.se-tabset-wrapper .fd-form-control[type=email]:disabled .fd-popover-custom .toggle-button,.se-tabset-wrapper .fd-form-control[type=text]:disabled .fd-popover-custom .toggle-button,.se-tabset-wrapper .se-select.is-disabled .fd-popover-custom .toggle-button{border:none;opacity:1;color:var(--sapTextColor);padding:0;line-height:1rem}.se-page-info-menu__body .fd-form-control[type=email]:disabled .fd-popover-custom .toggle-button::after,.se-page-info-menu__body .fd-form-control[type=text]:disabled .fd-popover-custom .toggle-button::after,.se-page-info-menu__body .se-select.is-disabled .fd-popover-custom .toggle-button::after,.se-tabset-wrapper .fd-form-control[type=email]:disabled .fd-popover-custom .toggle-button::after,.se-tabset-wrapper .fd-form-control[type=text]:disabled .fd-popover-custom .toggle-button::after,.se-tabset-wrapper .se-select.is-disabled .fd-popover-custom .toggle-button::after{display:none}`],encapsulation:n.ViewEncapsulation.None});let _o=class PageInfoMenuComponent{constructor(e,t,i,o,n,s){this.toolbarItem=e;this.pageInfoMenuService=t;this.pageService=i;this.catalogService=o;this.systemEventService=n;this.userTrackingService=s;this.cmsPage=null;this.uriContext=null;this.isReady=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.unRegContentCatalogUpdate=this.systemEventService.subscribe(l.EVENT_CONTENT_CATALOG_UPDATE,(()=>this.setPageData()));yield this.setPageData()}))}ngOnDestroy(){this.unRegContentCatalogUpdate()}onEditPageClick(){this.pageInfoMenuService.openPageEditor(this.pageInfo.content);this.closeMenu()}setPageData(){return __awaiter(this,void 0,void 0,(function*(){const[e,t]=yield Promise.all([this.pageService.getCurrentPageInfo(),this.catalogService.retrieveUriContext()]);this.cmsPage=e;this.uriContext=t;this.editPagePermission=[{names:["se.edit.page.type"],context:{typeCode:e.typeCode}},{names:["se.edit.page.link"]}]}))}onDropdownToggle(e){return __awaiter(this,void 0,void 0,(function*(){if(!e){return}this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.TOOL_BAR,"Info");const t=yield this.pageInfoMenuService.getCurrentPageInfo();this.pageInfo=t;const i=yield this.pageInfoMenuService.getPageStructureForViewing(t.typeCode,t.defaultPage);this.pageStructure=i;this.isReady=true}))}closeMenu(){this.toolbarItem.isOpen=false}};_o=__decorate([n.Component({selector:"se-page-info-menu",template:`<div class="toolbar-action" data-item-key="se.cms.pageInfoMenu"><fd-popover [(isOpen)]="toolbarItem.isOpen" (isOpenChange)="onDropdownToggle($event)" [closeOnOutsideClick]="true"><fd-popover-control><button fd-button type="button" class="btn toolbar-action--button" title="{{ 'se.cms.pageinfo.menu.btn.tooltip' | translate }}" [attr.aria-pressed]="toolbarItem.isOpen"><span class="sap-icon--hint se-toolbar-menu-ddlb--button__icon"></span><div class="se-toolbar-page-info-wrapper"><span class="toolbar-action-button__txt" [translate]="toolbarItem.name"></span></div></button></fd-popover-control><fd-popover-body><div class="se-page-info__dropdown-menu toolbar-action--include"><div class="se-page-info-menu" *ngIf="toolbarItem.isOpen"><se-prevent-vertical-overflow><div class="se-page-info-menu__header"><span class="se-page-info-menu__header-title" translate="se.cms.pageinfo.information.title"></span><div *seHasOperationPermission="editPagePermission"><button fd-button class="se-page-info__edit-btn fd-button--compact" *ngIf="isReady" label="{{ 'se.cms.contextmenu.title.edit' | translate }}" (click)="onEditPageClick()"></button></div></div><div *ngIf="isReady" class="se-page-info-menu__body"><se-generic-editor [smarteditComponentId]="pageInfo.uid" [smarteditComponentType]="pageInfo.typeCode" [structure]="pageStructure" [content]="pageInfo"></se-generic-editor></div></se-prevent-vertical-overflow></div></div></fd-popover-body></fd-popover></div>`,styles:[`.se-page-info-menu__header{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);height:53px;padding-top:15px;height:48px}.se-page-info-menu__header:first-child{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-page-info-menu__body{width:100%;height:400px;overflow-y:auto}.se-page-info-menu__body--title{text-transform:capitalize}.se-page-info__dropdown-menu{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%}.se-page-info__dropdown-menu::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.se-page-info__dropdown-menu::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.se-page-info__dropdown-menu::after,.se-page-info__dropdown-menu::before{left:14px}.se-page-info__dropdown-menu input{color:var(--sapTextColor)!important}.se-page-info-menu se-ge-tab{display:grid;grid-template-columns:repeat(1,1fr);grid-gap:0 16px;width:368px}.se-page-info-menu__body .fd-form-control[type=email]:disabled .fd-popover-custom,.se-page-info-menu__body .fd-form-control[type=text]:disabled .fd-popover-custom,.se-page-info-menu__body .se-select.is-disabled .fd-popover-custom,.se-tabset-wrapper .fd-form-control[type=email]:disabled .fd-popover-custom,.se-tabset-wrapper .fd-form-control[type=text]:disabled .fd-popover-custom,.se-tabset-wrapper .se-select.is-disabled .fd-popover-custom{opacity:1}.se-page-info-menu__body .fd-form-control[type=email]:disabled .fd-popover-custom .toggle-button,.se-page-info-menu__body .fd-form-control[type=text]:disabled .fd-popover-custom .toggle-button,.se-page-info-menu__body .se-select.is-disabled .fd-popover-custom .toggle-button,.se-tabset-wrapper .fd-form-control[type=email]:disabled .fd-popover-custom .toggle-button,.se-tabset-wrapper .fd-form-control[type=text]:disabled .fd-popover-custom .toggle-button,.se-tabset-wrapper .se-select.is-disabled .fd-popover-custom .toggle-button{border:none;opacity:1;color:var(--sapTextColor);padding:0;line-height:1rem}.se-page-info-menu__body .fd-form-control[type=email]:disabled .fd-popover-custom .toggle-button::after,.se-page-info-menu__body .fd-form-control[type=text]:disabled .fd-popover-custom .toggle-button::after,.se-page-info-menu__body .se-select.is-disabled .fd-popover-custom .toggle-button::after,.se-tabset-wrapper .fd-form-control[type=email]:disabled .fd-popover-custom .toggle-button::after,.se-tabset-wrapper .fd-form-control[type=text]:disabled .fd-popover-custom .toggle-button::after,.se-tabset-wrapper .se-select.is-disabled .fd-popover-custom .toggle-button::after{display:none}`],encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(l.TOOLBAR_ITEM)),__metadata("design:paramtypes",[Object,ho,l.IPageService,l.ICatalogService,l.SystemEventService,l.IUserTrackingService])],_o);window.__smartedit__.addDecoratorPayload("Component","RestorePageItemComponent",{selector:"se-restore-page-item",template:`<div *seHasOperationPermission="restorePagePermission"><a fd-list-link class="se-dropdown-item" (click)="restorePage()"><span [translate]="'se.cms.actionitem.page.restore'"></span></a></div>`});let vo=class RestorePageItemComponent{constructor(e,t,i){this.managePageService=e;this.userTrackingService=t;this.dropdownMenuData=i}ngOnInit(){this.pageInfo=this.dropdownMenuData.selectedItem;this.restorePagePermission=[{names:["se.restore.page.type"],context:{typeCode:this.pageInfo.typeCode}}]}restorePage(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_MANAGEMENT,"Restore");this.managePageService.restorePage(this.pageInfo)}};vo=__decorate([n.Component({selector:"se-restore-page-item",template:`<div *seHasOperationPermission="restorePagePermission"><a fd-list-link class="se-dropdown-item" (click)="restorePage()"><span [translate]="'se.cms.actionitem.page.restore'"></span></a></div>`}),__param(2,n.Inject(l.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[t.ManagePageService,l.IUserTrackingService,Object])],vo);window.__smartedit__.addDecoratorPayload("Component","UpdatePageStatusComponent",{selector:"se-update-page-status",template:`<div *ngIf="showButton"><a fd-list-link class="se-dropdown-item fd-list__link" (click)="onClickOnSync()"><span [translate]="'se.cms.actionitem.page.sync'"></span></a></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let fo=class UpdatePageStatusComponent{constructor(e,t,i,o,n,s,a){this.cdr=e;this.managePageService=t;this.cmsitemsRestService=i;this.catalogService=o;this.crossFrameEventService=n;this.userTrackingService=s;this.dropdownMenuData=a;this.showButton=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.pageInfo=this.dropdownMenuData.selectedItem;yield this.setButtonVisibility()}))}onClickOnSync(){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_MANAGEMENT,"Sync");yield this.managePageService.trashPageInActiveCatalogVersion(this.pageInfo.uid);this.crossFrameEventService.publish(l.CMSITEMS_UPDATE_EVENT);this.crossFrameEventService.publish(r.EVENT_PAGE_STATUS_UPDATED_IN_ACTIVE_CV)}))}setButtonVisibility(){return __awaiter(this,void 0,void 0,(function*(){this.showButton=yield this.doesPageExistInActiveCatalogVersion();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}doesPageExistInActiveCatalogVersion(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.retrieveUriContext();const t=yield this.catalogService.getContentCatalogActiveVersion(e);const i=yield this.cmsitemsRestService.get({pageSize:1,currentPage:0,typeCode:"AbstractPage",fields:"BASIC",itemSearchParams:`uid:${this.pageInfo.uid}`,catalogId:e.CONTEXT_CATALOG,catalogVersion:t});return i.pagination.totalCount===1}))}};fo=__decorate([n.Component({selector:"se-update-page-status",template:`<div *ngIf="showButton"><a fd-list-link class="se-dropdown-item fd-list__link" (click)="onClickOnSync()"><span [translate]="'se.cms.actionitem.page.sync'"></span></a></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(6,n.Inject(l.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[n.ChangeDetectorRef,t.ManagePageService,l.CmsitemsRestService,l.ICatalogService,l.CrossFrameEventService,l.IUserTrackingService,Object])],fo);window.__smartedit__.addDecoratorPayload("Component","PermanentlyDeletePageItemComponent",{selector:"se-permanently-delete-page-item",template:`<div *seHasOperationPermission="permanentlyDeletePagePermission"><div class="se-dropdown-item__delete-wrapper"><div class="se-dropdown-item__delete-link-wrapper" [ngClass]="{'se-dropdown-item__delete-link-wrapper--disabled': isDeleteButtonDisabled()}"><a fd-list-link class="se-dropdown-item se-dropdown-item__delete" [ngClass]="{'se-dropdown-item--disabled': isDeleteButtonDisabled()}" (click)="permanentlyDelete()"><span [translate]="'se.cms.actionitem.page.permanently.delete'"></span></a></div><se-tooltip class="se-dropdown-item__delete-page-popover" *ngIf="isDeleteButtonDisabled()" [placement]="'left'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true"><span se-tooltip-trigger class="sap-icon--message-error"></span> <span se-tooltip-body [translate]="'se.cms.actionitem.page.permanently.delete.blocked'"></span></se-tooltip></div></div>`,styles:[`.se-dropdown-item__delete-wrapper{display:flex;flex-direction:row;align-items:center;width:100%}.se-dropdown-item__delete-page-popover{margin-right:16px}.se-dropdown-item__delete-page-popover .sap-icon--message-error{color:var(--sapInformativeColor)}.se-dropdown-item__delete-link-wrapper{width:100%}.se-dropdown-item__delete-link-wrapper--disabled{cursor:not-allowed}`]});let yo=class PermanentlyDeletePageItemComponent{constructor(e,t,i,o,n,s){this.managePageService=e;this.cmsitemsRestService=t;this.catalogService=i;this.crossFrameEventService=o;this.userTrackingService=n;this.dropdownMenuData=s;this.isDeletable=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.pageInfo=this.dropdownMenuData.selectedItem;this.permanentlyDeletePagePermission=[{names:["se.permanently.delete.page.type"],context:{typeCode:this.pageInfo.typeCode}}];this.unregPageSyncStatusUpdate=this.crossFrameEventService.subscribe(r.EVENT_PAGE_STATUS_UPDATED_IN_ACTIVE_CV,this.fetchPageDeletableConditions.bind(this));yield this.fetchPageDeletableConditions()}))}ngOnDestroy(){this.unregPageSyncStatusUpdate()}permanentlyDelete(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_MANAGEMENT,"Permanently Delete");if(this.isDeletable){this.managePageService.hardDeletePage(this.pageInfo)}}isDeleteButtonDisabled(){return!this.isDeletable}fetchPageDeletableConditions(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.retrieveUriContext();const t=yield this.catalogService.getContentCatalogActiveVersion(e);const i=yield this.cmsitemsRestService.get({pageSize:1,currentPage:0,typeCode:"AbstractPage",fields:"BASIC",itemSearchParams:`uid:${this.pageInfo.uid}`,catalogId:e.CURRENT_CONTEXT_CATALOG,catalogVersion:t});this.isDeletable=i.pagination.totalCount===0||i.response[0].pageStatus===l.CMSPageStatus.DELETED}))}};yo=__decorate([n.Component({selector:"se-permanently-delete-page-item",template:`<div *seHasOperationPermission="permanentlyDeletePagePermission"><div class="se-dropdown-item__delete-wrapper"><div class="se-dropdown-item__delete-link-wrapper" [ngClass]="{'se-dropdown-item__delete-link-wrapper--disabled': isDeleteButtonDisabled()}"><a fd-list-link class="se-dropdown-item se-dropdown-item__delete" [ngClass]="{'se-dropdown-item--disabled': isDeleteButtonDisabled()}" (click)="permanentlyDelete()"><span [translate]="'se.cms.actionitem.page.permanently.delete'"></span></a></div><se-tooltip class="se-dropdown-item__delete-page-popover" *ngIf="isDeleteButtonDisabled()" [placement]="'left'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true"><span se-tooltip-trigger class="sap-icon--message-error"></span> <span se-tooltip-body [translate]="'se.cms.actionitem.page.permanently.delete.blocked'"></span></se-tooltip></div></div>`,styles:[`.se-dropdown-item__delete-wrapper{display:flex;flex-direction:row;align-items:center;width:100%}.se-dropdown-item__delete-page-popover{margin-right:16px}.se-dropdown-item__delete-page-popover .sap-icon--message-error{color:var(--sapInformativeColor)}.se-dropdown-item__delete-link-wrapper{width:100%}.se-dropdown-item__delete-link-wrapper--disabled{cursor:not-allowed}`]}),__param(5,n.Inject(l.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[t.ManagePageService,l.CmsitemsRestService,l.ICatalogService,l.CrossFrameEventService,l.IUserTrackingService,Object])],yo);window.__smartedit__.addDecoratorPayload("Component","EditPageItemComponent",{selector:"se-edit-page-item",template:`<div *seHasOperationPermission="editPagePermission"><a fd-list-link class="se-dropdown-item" (click)="onClickOnEdit()"><span class="se-dropdown-item--label" translate="se.cms.actionitem.page.edit"></span></a></div>`});let So=class EditPageItemComponent{constructor(e,t,i){this.dropdownMenuData=e;this.pageInfoMenuService=t;this.userTrackingService=i}ngOnInit(){this.pageInfo=this.dropdownMenuData.selectedItem;this.editPagePermission=[{names:["se.edit.page.type"],context:{typeCode:this.pageInfo.typeCode}},{names:["se.act.on.page.in.workflow"],context:{pageInfo:this.pageInfo}}]}onClickOnEdit(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_MANAGEMENT,"Edit");return this.pageInfoMenuService.openPageEditor(this.pageInfo)}};So=__decorate([n.Component({selector:"se-edit-page-item",template:`<div *seHasOperationPermission="editPagePermission"><a fd-list-link class="se-dropdown-item" (click)="onClickOnEdit()"><span class="se-dropdown-item--label" translate="se.cms.actionitem.page.edit"></span></a></div>`}),__param(0,n.Inject(l.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,ho,l.IUserTrackingService])],So);window.__smartedit__.addDecoratorPayload("Component","ClonePageItemComponent",{selector:"se-clone-page-item",template:`<div *seHasOperationPermission="clonePagePermission"><a fd-list-link class="se-dropdown-item" (click)="onClickOnClone()"><span class="se-dropdown-item--label" translate="se.cms.actionitem.page.clone"></span></a></div>`});let Co=class ClonePageItemComponent{constructor(e,t,i){this.dropdownMenuData=e;this.clonePageWizardService=t;this.userTrackingService=i}ngOnInit(){this.pageInfo=this.dropdownMenuData.selectedItem;this.clonePagePermission=[{names:["se.clone.page.type"],context:{typeCode:this.pageInfo.typeCode}}]}onClickOnClone(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_MANAGEMENT,"Clone");this.clonePageWizardService.openClonePageWizard(this.pageInfo)}};Co=__decorate([n.Component({selector:"se-clone-page-item",template:`<div *seHasOperationPermission="clonePagePermission"><a fd-list-link class="se-dropdown-item" (click)="onClickOnClone()"><span class="se-dropdown-item--label" translate="se.cms.actionitem.page.clone"></span></a></div>`}),__param(0,n.Inject(l.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,to,l.IUserTrackingService])],Co);window.__smartedit__.addDecoratorPayload("Component","DeletePageItemComponent",{selector:"se-delete-page-item",template:`<div *seHasOperationPermission="deletePagePermission"><div class="se-dropdown-item__delete-wrapper"><div class="se-dropdown-item__delete-link-wrapper" [ngClass]="{'se-dropdown-item__delete-link-wrapper--disabled': !isDeletePageEnabled}"><a fd-list-link class="se-dropdown-item se-dropdown-item__delete" [ngClass]="{'se-dropdown-item--disabled': !isDeletePageEnabled}" (click)="isDeletePageEnabled && onClickOnDeletePage()"><span class="se-dropdown-item--label" translate="se.cms.actionitem.page.trash"></span></a></div><se-tooltip *ngIf="!isDeletePageEnabled" class="se-dropdown-item__delete-page-popover" [placement]="'left'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true"><span se-tooltip-trigger class="sap-icon--message-error"></span><div se-tooltip-body class="popover-tooltip"><span [translate]="tooltipMessage"></span></div></se-tooltip></div></div>`,styles:[`.se-dropdown-item__delete-wrapper{display:flex;flex-direction:row;align-items:center;width:100%}.se-dropdown-item__delete-page-popover{margin-right:16px}.se-dropdown-item__delete-page-popover .sap-icon--message-error{color:var(--sapInformativeColor)}.se-dropdown-item__delete-link-wrapper{width:100%}.se-dropdown-item__delete-link-wrapper--disabled{cursor:not-allowed}`]});let bo=class DeletePageItemComponent{constructor(e,t,i,o,n,s){this.dropdownMenuData=e;this.managePageService=t;this.systemEventService=i;this.catalogService=o;this.ref=n;this.userTrackingService=s;this.isDeletePageEnabled=false;this.tooltipMessage="se.cms.tooltip.movetotrash"}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.pageInfo=this.dropdownMenuData.selectedItem;yield this.getDisableDeleteTooltipMessage();this.setDeletePermissions();this.ref.markForCheck()}))}onClickOnDeletePage(){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_MANAGEMENT,"Trash");const e=yield this.catalogService.retrieveUriContext();yield this.managePageService.softDeletePage(this.pageInfo,e);this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE)}))}setDeletePermissions(){this.deletePagePermission=[{names:["se.delete.page.type"],context:{typeCode:this.pageInfo.typeCode}},{names:["se.act.on.page.in.workflow"],context:{pageInfo:this.pageInfo}}]}getDisableDeleteTooltipMessage(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.retrieveUriContext();const t=yield this.managePageService.isPageTrashable(this.pageInfo,e);this.isDeletePageEnabled=t;if(this.isDeletePageEnabled){this.tooltipMessage=null;return}this.tooltipMessage=yield this.managePageService.getDisabledTrashTooltipMessage(this.pageInfo,e)}))}};bo=__decorate([n.Component({selector:"se-delete-page-item",template:`<div *seHasOperationPermission="deletePagePermission"><div class="se-dropdown-item__delete-wrapper"><div class="se-dropdown-item__delete-link-wrapper" [ngClass]="{'se-dropdown-item__delete-link-wrapper--disabled': !isDeletePageEnabled}"><a fd-list-link class="se-dropdown-item se-dropdown-item__delete" [ngClass]="{'se-dropdown-item--disabled': !isDeletePageEnabled}" (click)="isDeletePageEnabled && onClickOnDeletePage()"><span class="se-dropdown-item--label" translate="se.cms.actionitem.page.trash"></span></a></div><se-tooltip *ngIf="!isDeletePageEnabled" class="se-dropdown-item__delete-page-popover" [placement]="'left'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true"><span se-tooltip-trigger class="sap-icon--message-error"></span><div se-tooltip-body class="popover-tooltip"><span [translate]="tooltipMessage"></span></div></se-tooltip></div></div>`,styles:[`.se-dropdown-item__delete-wrapper{display:flex;flex-direction:row;align-items:center;width:100%}.se-dropdown-item__delete-page-popover{margin-right:16px}.se-dropdown-item__delete-page-popover .sap-icon--message-error{color:var(--sapInformativeColor)}.se-dropdown-item__delete-link-wrapper{width:100%}.se-dropdown-item__delete-link-wrapper--disabled{cursor:not-allowed}`]}),__param(0,n.Inject(l.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,t.ManagePageService,l.SystemEventService,l.ICatalogService,n.ChangeDetectorRef,l.IUserTrackingService])],bo);window.__smartedit__.addDecoratorPayload("Component","SynchronizeCatalogComponent",{selector:"se-synchronize-catalog",template:`<div class="se-synchronize-catalog"><div class="se-synchronize-catalog__sync-info"><div *ngIf="isSyncJobFinished()"><label class="se-synchronize-catalog__sync-info__sync-label" *ngIf="catalogVersion.active"><span translate="se.cms.cataloginfo.lastsyncedfrom"></span>&nbsp; <span>{{ syncJobStatus.source }}</span></label> <label class="se-synchronize-catalog__sync-info__sync-label" *ngIf="!catalogVersion.active" translate="se.cms.cataloginfo.lastsynced"></label> <span class="se-synchronize-catalog__sync-info__last-synched">{{ syncJobStatus.syncEndTime | date: 'M/d/yy h:mm a' }}</span></div><span class="se-synchronize-catalog__in-progress" *ngIf="isSyncJobInProgress()" translate="se.sync.status.synced.inprogress"></span> <span class="label-error se-synchronize-catalog__sync-failed" *ngIf="isSyncJobFailed()" translate="se.sync.status.synced.syncfailed"></span></div><ng-container *seHasOperationPermission="syncCatalogPermission"><ng-container *ngIf="!catalogVersion.active"><button fd-button class="se-synchronize-catalog__sync-btn fd-button--emphasized" [disabled]="!isSyncButtonEnabled()" (click)="syncCatalog()" label="{{ 'se.cms.cataloginfo.btn.sync' | translate }}"></button></ng-container></ng-container></div>`,styles:[`.se-synchronize-catalog{display:flex;flex-direction:row;align-items:center;justify-content:flex-end}.se-synchronize-catalog__sync-info{display:flex;flex-direction:row;align-items:center}.se-synchronize-catalog__sync-btn{margin-left:20px}.se-synchronize-catalog__sync-info__sync-label:first-child{font-weight:700}.se-synchronize-catalog__sync-info__last-synched,.se-synchronize-catalog__sync-info__sync-label{color:var(--sapTextColor);display:block;text-align:right;margin:0}.se-synchronize-catalog__in-progress{color:var(--sapIndicationColor_4)}.se-synchronize-catalog__sync-failed{color:var(--sapErrorColor)}`],providers:[l.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush});let Io=class SynchronizeCatalogComponent{constructor(e,t,i,o,n,s){this.synchronizationService=e;this.confirmationModalService=t;this.systemEventService=i;this.l10nPipe=o;this.cdr=n;this.userTrackingService=s}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.syncJobStatus={syncStartTime:"",syncEndTime:"",status:null,source:"",target:""};this.targetCatalogVersion=this.activeCatalogVersion.version;this.sourceCatalogVersion=!this.catalogVersion.active?this.catalogVersion.version:null;this.syncCatalogPermission=[{names:["se.sync.catalog"],context:{catalogId:this.catalog.catalogId,catalogVersion:this.sourceCatalogVersion,targetCatalogVersion:this.targetCatalogVersion}}];this.catalogDto={catalogId:this.catalog.catalogId,targetCatalogVersion:this.targetCatalogVersion,sourceCatalogVersion:this.sourceCatalogVersion};this.synchronizationService.startAutoGetSyncData(this.catalogDto,(e=>this.updateSyncStatusData(e)));yield this.callGetSyncData()}))}ngOnDestroy(){this.synchronizationService.stopAutoGetSyncData(this.catalogDto)}isSyncJobFinished(){return this.syncJobStatus.status===r.JOB_STATUS.FINISHED}isSyncJobInProgress(){return this.syncJobStatus.status===r.JOB_STATUS.RUNNING||this.syncJobStatus.status===r.JOB_STATUS.UNKNOWN}isSyncJobFailed(){return this.syncJobStatus.status===r.JOB_STATUS.ERROR||this.syncJobStatus.status===r.JOB_STATUS.FAILURE}isSyncButtonEnabled(){return!this.isSyncJobInProgress()}syncCatalog(){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION,"Sync");const e=yield this.translateCatalogName(this.catalog.name);yield this.confirmationModalService.confirm({title:"se.sync.confirmation.title",description:"se.sync.confirm.msg",descriptionPlaceholders:{catalogName:e}}).catch((()=>Promise.reject()));const t=yield this.synchronizationService.updateCatalogSync(this.catalogDto);this.updateSyncStatusData(t);this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE,t)}))}translateCatalogName(e){return __awaiter(this,void 0,void 0,(function*(){return this.l10nPipe.transform(e).pipe(d.take(1)).toPromise()}))}callGetSyncData(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.synchronizationService.getCatalogSyncStatus(this.catalogDto);this.updateSyncStatusData(e)}))}updateSyncStatusData(e){this.syncJobStatus={syncStartTime:e.creationDate,syncEndTime:e.endDate,status:e.syncStatus,source:e.sourceCatalogVersion?e.sourceCatalogVersion:"",target:e.targetCatalogVersion?e.targetCatalogVersion:""};if(!this.cdr.destroyed){this.cdr.detectChanges()}}};__decorate([n.Input(),__metadata("design:type",Object)],Io.prototype,"catalog",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Io.prototype,"catalogVersion",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Io.prototype,"activeCatalogVersion",void 0);Io=__decorate([n.Component({selector:"se-synchronize-catalog",template:`<div class="se-synchronize-catalog"><div class="se-synchronize-catalog__sync-info"><div *ngIf="isSyncJobFinished()"><label class="se-synchronize-catalog__sync-info__sync-label" *ngIf="catalogVersion.active"><span translate="se.cms.cataloginfo.lastsyncedfrom"></span>&nbsp; <span>{{ syncJobStatus.source }}</span></label> <label class="se-synchronize-catalog__sync-info__sync-label" *ngIf="!catalogVersion.active" translate="se.cms.cataloginfo.lastsynced"></label> <span class="se-synchronize-catalog__sync-info__last-synched">{{ syncJobStatus.syncEndTime | date: 'M/d/yy h:mm a' }}</span></div><span class="se-synchronize-catalog__in-progress" *ngIf="isSyncJobInProgress()" translate="se.sync.status.synced.inprogress"></span> <span class="label-error se-synchronize-catalog__sync-failed" *ngIf="isSyncJobFailed()" translate="se.sync.status.synced.syncfailed"></span></div><ng-container *seHasOperationPermission="syncCatalogPermission"><ng-container *ngIf="!catalogVersion.active"><button fd-button class="se-synchronize-catalog__sync-btn fd-button--emphasized" [disabled]="!isSyncButtonEnabled()" (click)="syncCatalog()" label="{{ 'se.cms.cataloginfo.btn.sync' | translate }}"></button></ng-container></ng-container></div>`,styles:[`.se-synchronize-catalog{display:flex;flex-direction:row;align-items:center;justify-content:flex-end}.se-synchronize-catalog__sync-info{display:flex;flex-direction:row;align-items:center}.se-synchronize-catalog__sync-btn{margin-left:20px}.se-synchronize-catalog__sync-info__sync-label:first-child{font-weight:700}.se-synchronize-catalog__sync-info__last-synched,.se-synchronize-catalog__sync-info__sync-label{color:var(--sapTextColor);display:block;text-align:right;margin:0}.se-synchronize-catalog__in-progress{color:var(--sapIndicationColor_4)}.se-synchronize-catalog__sync-failed{color:var(--sapErrorColor)}`],providers:[l.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[r.SynchronizationService,l.IConfirmationModalService,l.SystemEventService,l.L10nPipe,n.ChangeDetectorRef,l.IUserTrackingService])],Io);window.__smartedit__.addDecoratorPayload("Component","PageSynchronizationHeaderComponent",{selector:"se-page-synchronization-header",template:`<ng-container *ngIf="ready"><div class="se-sync-panel-header"><span class="se-sync-panel-header__sub-header" [translate]="getSubHeaderText()"></span></div><div *ngIf="isNewPage()" class="se-sync-panel-new-page"><div class="se-sync-panel-new-page__header" translate="se.cms.synchronization.page.new.header"></div><div class="se-sync-panel-new-page__message">{{ headerText }}</div></div><div class="se-sync-panel-header__timestamp" *ngIf="!isNewPage()"><div translate="se.cms.synchronization.panel.lastsync.text"></div><span class="se-sync-panel-header__timestamp-text">{{ syncStatus.lastSyncStatus | date: 'M/d/yy h:mm a' }}</span></div></ng-container>`,styles:[`.se-sync-panel-header{padding:0 20px 20px;border-bottom:1px solid var(--sapGroup_ContentBorderColor);min-width:400px}.se-sync-panel-header__sub-header{padding-top:4px;color:var(--sapNeutralColor);white-space:break-spaces}.se-sync-panel-header__timestamp{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralColor);position:absolute;left:20px;bottom:0;width:150px}.se-sync-panel-new-page{padding:20px}.se-sync-panel-new-page__header{font-weight:700;padding-bottom:4px}.se-sync-panel-new-page__message{white-space:normal}`],providers:[l.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush});let Eo=class PageSynchronizationHeaderComponent{constructor(e,t,i,o,n,s){this.sharedDataService=e;this.catalogService=t;this.cmsitemsRestService=i;this.translateService=o;this.l10nPipe=n;this.cdr=s;this.ready=false}ngOnChanges(){return __awaiter(this,void 0,void 0,(function*(){if(!this.syncStatus){return}this.ready=false;yield this.updateHeaderText();this.ready=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}getSubHeaderText(){if(this.isDefaultSubHeader()){return"se.cms.synchronization.page.header"}else if(this.isSyncOldHomeHeader()){return"se.cms.synchronization.page.header.old.homepage"}return""}isNewPage(){return this.pageSyncConditions.pageHasNoDepOrNoSyncStatus}isSyncOldHomeHeader(){return this.pageSyncConditions.pageHasSyncStatus&&!this.pageSyncConditions.canSyncHomepage}isDefaultSubHeader(){return!this.isSyncOldHomeHeader()&&!this.isNewPage()}updateHeaderText(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.sharedDataService.get(l.EXPERIENCE_STORAGE_KEY);const{catalogId:t,catalogName:i}=yield this.getCurrentCatalogIdFromExperience(e);const o=yield this.catalogService.getActiveContentCatalogVersionByCatalogId(t);const n=yield this.pageSyncConditions.pageHasUnavailableDependencies?this.fetchUnavailableDependencies():null;this.headerText=this.pageSyncConditions.pageHasUnavailableDependencies?this.translateService.instant("se.cms.synchronization.page.unavailable.items.description",{itemNames:n,catalogName:i,catalogVersion:o}):this.translateService.instant("se.cms.synchronization.page.new.description",{catalogName:i,catalogVersion:o})}))}userIsInsidePage(e){return!!e}getCurrentCatalogIdFromExperience({pageContext:e,catalogDescriptor:t}){return __awaiter(this,void 0,void 0,(function*(){const i=this.userIsInsidePage(e)?e.catalogId:t.catalogId;const o=this.userIsInsidePage(e)?e.catalogName:t.name;const n=yield this.l10nPipe.transform(o).pipe(d.take(1)).toPromise();return{catalogId:i,catalogName:n}}))}fetchUnavailableDependencies(){const e=this.syncStatus.unavailableDependencies.map((({itemId:e})=>e));return this.cmsitemsRestService.getByIds(e).then((({response:e})=>e.map((({name:e})=>e)).join(", ")))}};__decorate([n.Input(),__metadata("design:type",Object)],Eo.prototype,"syncStatus",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Eo.prototype,"pageSyncConditions",void 0);Eo=__decorate([n.Component({selector:"se-page-synchronization-header",template:`<ng-container *ngIf="ready"><div class="se-sync-panel-header"><span class="se-sync-panel-header__sub-header" [translate]="getSubHeaderText()"></span></div><div *ngIf="isNewPage()" class="se-sync-panel-new-page"><div class="se-sync-panel-new-page__header" translate="se.cms.synchronization.page.new.header"></div><div class="se-sync-panel-new-page__message">{{ headerText }}</div></div><div class="se-sync-panel-header__timestamp" *ngIf="!isNewPage()"><div translate="se.cms.synchronization.panel.lastsync.text"></div><span class="se-sync-panel-header__timestamp-text">{{ syncStatus.lastSyncStatus | date: 'M/d/yy h:mm a' }}</span></div></ng-container>`,styles:[`.se-sync-panel-header{padding:0 20px 20px;border-bottom:1px solid var(--sapGroup_ContentBorderColor);min-width:400px}.se-sync-panel-header__sub-header{padding-top:4px;color:var(--sapNeutralColor);white-space:break-spaces}.se-sync-panel-header__timestamp{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralColor);position:absolute;left:20px;bottom:0;width:150px}.se-sync-panel-new-page{padding:20px}.se-sync-panel-new-page__header{font-weight:700;padding-bottom:4px}.se-sync-panel-new-page__message{white-space:normal}`],providers:[l.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.ISharedDataService,l.ICatalogService,l.CmsitemsRestService,m.TranslateService,l.L10nPipe,n.ChangeDetectorRef])],Eo);const wo="PAGE_SYNC_STATUS_READY";window.__smartedit__.addDecoratorPayload("Component","PageSynchronizationPanelComponent",{selector:"se-page-synchronization-panel",template:`<se-page-synchronization-header class="se-sync-panel__sync-status" [syncStatus]="syncStatus" [pageSyncConditions]="pageSyncConditions"></se-page-synchronization-header><se-synchronization-panel *ngIf="!showFooter" [itemId]="cmsPage.uuid" [showFooter]="false" [getSyncStatus]="getSyncStatus" [performSync]="performSync" (selectedItemsUpdate)="onSelectedItemsUpdate($event)" (syncStatusReady)="onSyncStatusReady($event)" (getApi)="onGetApi($event)"></se-synchronization-panel><se-synchronization-panel *ngIf="showFooter" [itemId]="cmsPage.uuid" [getSyncStatus]="getSyncStatus" [performSync]="performSync" (syncStatusReady)="onSyncStatusReady($event)" (getApi)="onGetApi($event)"></se-synchronization-panel>`});let To=class PageSynchronizationPanelComponent{constructor(e,t,i,o,s){this.pageService=e;this.homepageService=t;this.crossFrameEventService=i;this.syncPollingService=o;this.translateService=s;this.getSyncStatus=()=>__awaiter(this,void 0,void 0,(function*(){const[e,t]=yield Promise.all([this.homepageService.canSyncHomepage(this.cmsPage,this.uriContext),this.syncPollingService.getSyncStatus(this.cmsPage.uuid,this.uriContext),this.evaluateIfSyncIsApproved()]);this.pageSyncConditions.canSyncHomepage=e;this.syncStatus=t;return this.syncStatus}));this.performSync=e=>this.syncPollingService.performSync(e,this.uriContext);this.syncStatusReady=e=>{this.pageSyncConditions.pageHasUnavailableDependencies=e.unavailableDependencies.length>0;this.pageSyncConditions.pageHasSyncStatus=!!e.lastSyncStatus;this.pageSyncConditions.pageHasNoDepOrNoSyncStatus=this.pageSyncConditions.pageHasUnavailableDependencies||!this.pageSyncConditions.pageHasSyncStatus;this.pageSyncConditions=p.cloneDeep(this.pageSyncConditions);if(this.pageSyncConditions.pageHasUnavailableDependencies){this.hidePageSync()}else if(!this.pageSyncConditions.pageHasSyncStatus){this.showPageSync()}else{this.enableSlotsSync()}this.crossFrameEventService.publish(wo,this.pageSyncConditions)};this.selectedItemsUpdate=new n.EventEmitter;this.showFooter=true;this.syncStatus=null;this.pageSyncConditions={canSyncHomepage:false,pageHasUnavailableDependencies:false,pageHasSyncStatus:false,pageHasNoDepOrNoSyncStatus:false}}ngOnInit(){this.unSubPageUpdatedEvent=this.crossFrameEventService.subscribe(l.EVENTS.PAGE_UPDATED,(()=>this.evaluateIfSyncIsApproved()))}ngOnDestroy(){this.unSubPageUpdatedEvent()}onGetApi(e){this.synchronizationPanelApi=e;this.synchronizationPanelApi.disableItem=e=>!this.pageSyncConditions.canSyncHomepage&&e===this.syncStatus}onSyncStatusReady(e){this.syncStatusReady(e)}onSelectedItemsUpdate(e){this.selectedItemsUpdate.emit(e)}syncItems(){return this.synchronizationPanel.syncItems()}evaluateIfSyncIsApproved(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageService.isPageApproved(this.cmsPage.uuid);if(!e){this.disablePageSync()}}))}disablePageSync(){this.synchronizationPanelApi.setMessage({type:l.IAlertServiceType.WARNING,description:this.translateService.instant("se.cms.synchronization.slot.disabled.msg")});this.synchronizationPanelApi.disableItemList(true)}hidePageSync(){this.synchronizationPanelApi.displayItemList(false)}showPageSync(){this.synchronizationPanelApi.selectAll();this.synchronizationPanelApi.displayItemList(false)}enableSlotsSync(){this.synchronizationPanelApi.displayItemList(true)}};__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],To.prototype,"selectedItemsUpdate",void 0);__decorate([n.Input(),__metadata("design:type",Object)],To.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Object)],To.prototype,"cmsPage",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],To.prototype,"showFooter",void 0);__decorate([n.ViewChild(r.SynchronizationPanelComponent,{static:false}),__metadata("design:type",r.SynchronizationPanelComponent)],To.prototype,"synchronizationPanel",void 0);To=__decorate([n.Component({selector:"se-page-synchronization-panel",template:`<se-page-synchronization-header class="se-sync-panel__sync-status" [syncStatus]="syncStatus" [pageSyncConditions]="pageSyncConditions"></se-page-synchronization-header><se-synchronization-panel *ngIf="!showFooter" [itemId]="cmsPage.uuid" [showFooter]="false" [getSyncStatus]="getSyncStatus" [performSync]="performSync" (selectedItemsUpdate)="onSelectedItemsUpdate($event)" (syncStatusReady)="onSyncStatusReady($event)" (getApi)="onGetApi($event)"></se-synchronization-panel><se-synchronization-panel *ngIf="showFooter" [itemId]="cmsPage.uuid" [getSyncStatus]="getSyncStatus" [performSync]="performSync" (syncStatusReady)="onSyncStatusReady($event)" (getApi)="onGetApi($event)"></se-synchronization-panel>`}),__metadata("design:paramtypes",[l.IPageService,t.HomepageService,l.CrossFrameEventService,l.ISyncPollingService,m.TranslateService])],To);window.__smartedit__.addDecoratorPayload("Component","PageSynchronizationPanelModalComponent",{selector:"se-page-synchronization-panel-modal",template:`\n        <se-page-synchronization-panel\n            *ngIf="isReady"\n            (selectedItemsUpdate)="onSelectedItemsUpdate($event)"\n            [uriContext]="data.uriContext"\n            [cmsPage]="data.cmsPage"\n            [showFooter]="false"></se-page-synchronization-panel>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush});let Po=class PageSynchronizationPanelModalComponent{constructor(e,t){this.modalManager=e;this.cdr=t;this.syncBtnId="sync"}ngOnInit(){this.modalManager.addButtons([{id:this.syncBtnId,label:"se.cms.actionitem.page.sync",style:l.ModalButtonStyle.Primary,action:l.ModalButtonAction.Close,disabled:true,callback:()=>h.from(this.pageSynchronizationPanelComponent.syncItems())},{id:"cancel",label:"se.cms.component.confirmation.modal.cancel",style:l.ModalButtonStyle.Default,action:l.ModalButtonAction.Dismiss}]);this.modalManager.getModalData().pipe(d.take(1)).subscribe((e=>{this.data=e;this.isReady=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}onSelectedItemsUpdate(e){if(e.length===0||this.data.cmsPage.displayStatus!=="READY_TO_SYNC"){this.modalManager.disableButton(this.syncBtnId);return}this.modalManager.enableButton(this.syncBtnId)}};__decorate([n.ViewChild(To,{static:false}),__metadata("design:type",To)],Po.prototype,"pageSynchronizationPanelComponent",void 0);Po=__decorate([n.Component({selector:"se-page-synchronization-panel-modal",template:`\n        <se-page-synchronization-panel\n            *ngIf="isReady"\n            (selectedItemsUpdate)="onSelectedItemsUpdate($event)"\n            [uriContext]="data.uriContext"\n            [cmsPage]="data.cmsPage"\n            [showFooter]="false"></se-page-synchronization-panel>\n    `,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.ModalManagerService,n.ChangeDetectorRef])],Po);window.__smartedit__.addDecoratorPayload("Component","PageSyncMenuToolbarItemComponent",{selector:"se-page-sync-menu-toolbar-item",template:`<ng-container *seHasOperationPermission="'se.sync.catalog'"><fd-popover [(isOpen)]="toolbarItem.isOpen" [closeOnOutsideClick]="true"><fd-popover-control><button fd-button type="button" class="btn toolbar-action--button" title="{{ 'se.cms.toolbaritem.pagesyncmenu.tooltip' | translate }}" [attr.aria-expanded]="toolbarItem.isOpen"><span class="sap-icon--synchronize se-toolbar-menu-ddlb--button__icon"><span *ngIf="isNotInSync" class="sap-icon--message-warning se-toolbar-menu-ddlb--button__caution"></span> </span><span class="toolbar-action-button__txt" [ngClass]="{'se-toolbar-menu-ddlb--button__txt': isNotInSync }" [translate]="toolbarItem.name"></span></button></fd-popover-control><fd-popover-body><div *ngIf="toolbarItem.isOpen && isReady" class="toolbar-action--include se-sync-menu-content__dropdown"><se-prevent-vertical-overflow><div class="se-sync-menu-content__header"><span class="se-sync-menu-content__header-title" translate="se.cms.synchronization.page.title"></span><se-help *ngIf="!syncPageConditions?.canSyncHomepage && !syncPageConditions?.pageHasNoDepOrNoSyncStatus" class="se-page-sync__y-help"><span>{{ helpText }}</span></se-help></div><se-page-synchronization-panel [cmsPage]="cmsPage" [uriContext]="uriContext"></se-page-synchronization-panel></se-prevent-vertical-overflow></div></fd-popover-body></fd-popover></ng-container>`,styles:[`.se-toolbar-menu-ddlb--button__icon{position:relative}.se-toolbar-menu-ddlb--button__caution{position:absolute;color:var(--sapWarningColor);right:-9px;bottom:-4px}.se-sync-menu-content__header{padding:15px 20px 0}.se-sync-menu-content__header-title{text-transform:capitalize;font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-sync-menu-content__dropdown{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;max-width:400px}.se-sync-menu-content__dropdown::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.se-sync-menu-content__dropdown::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.se-sync-menu-content__dropdown::after,.se-sync-menu-content__dropdown::before{left:14px}.se-sync-menu-content__dropdown.toolbar-action--include .se-sync-panel-header__timestamp{bottom:20px}`]});let Oo=class PageSyncMenuToolbarItemComponent{constructor(e,t,i,o,n,s,a,r,l){this.crossFrameEventService=e;this.systemEventService=t;this.catalogService=i;this.pageService=o;this.pageInfoService=n;this.syncPollingService=s;this.translateService=a;this.logService=r;this.toolbarItem=l;this.isReady=false}ngOnInit(){this.unRegisterPageChange=this.crossFrameEventService.subscribe(l.EVENTS.PAGE_CHANGE,(()=>this.setup()));this.unRegisterSyncPageConditions=this.systemEventService.subscribe(wo,((e,t)=>{this.syncPageConditions=t;this.setHelpText()}));return this.setup()}ngOnDestroy(){this.unRegisterSyncPageConditions();this.unRegisterPageChange();if(this.unRegisterSyncPolling){this.unRegisterSyncPolling()}}setup(){return __awaiter(this,void 0,void 0,(function*(){this.isReady=false;this.isNotInSync=false;try{[this.cmsPage,this.uriContext]=yield this.fetchSynchronizationPanelInfo();const e=yield this.catalogService.isContentCatalogVersionNonActive();if(!e){return}}catch(e){this.logService.error("Failed to setup PageSyncMenuToolbarItemComponent",e);return}this.subscribeSyncPolling();this.fetchSyncStatusAndSetIsNotInSync();this.isReady=true}))}fetchSynchronizationPanelInfo(){return __awaiter(this,void 0,void 0,(function*(){return Promise.all([this.pageService.getCurrentPageInfo(),this.catalogService.retrieveUriContext()]).catch((e=>{this.logService.error("Failed to fetch Synchronization Panel Info",e);throw new Error(e)}))}))}subscribeSyncPolling(){if(this.unRegisterSyncPolling){this.unRegisterSyncPolling()}this.unRegisterSyncPolling=this.crossFrameEventService.subscribe(r.DEFAULT_SYNCHRONIZATION_POLLING.FAST_FETCH,(()=>this.fetchSyncStatusAndSetIsNotInSync()))}fetchSyncStatusAndSetIsNotInSync(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.fetchSyncStatus();this.isNotInSync=!r.synchronizationUtils.isInSync(e)}))}fetchSyncStatus(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageInfoService.getPageUUID();return this.syncPollingService.getSyncStatus(e)}))}setHelpText(){let e=this.translateService.instant("se.cms.synchronization.page.header");if(!this.syncPageConditions.pageHasNoDepOrNoSyncStatus){e+=` ${this.translateService.instant("se.cms.synchronization.page.header.help")}`}this.helpText=e}};Oo=__decorate([n.Component({selector:"se-page-sync-menu-toolbar-item",template:`<ng-container *seHasOperationPermission="'se.sync.catalog'"><fd-popover [(isOpen)]="toolbarItem.isOpen" [closeOnOutsideClick]="true"><fd-popover-control><button fd-button type="button" class="btn toolbar-action--button" title="{{ 'se.cms.toolbaritem.pagesyncmenu.tooltip' | translate }}" [attr.aria-expanded]="toolbarItem.isOpen"><span class="sap-icon--synchronize se-toolbar-menu-ddlb--button__icon"><span *ngIf="isNotInSync" class="sap-icon--message-warning se-toolbar-menu-ddlb--button__caution"></span> </span><span class="toolbar-action-button__txt" [ngClass]="{'se-toolbar-menu-ddlb--button__txt': isNotInSync }" [translate]="toolbarItem.name"></span></button></fd-popover-control><fd-popover-body><div *ngIf="toolbarItem.isOpen && isReady" class="toolbar-action--include se-sync-menu-content__dropdown"><se-prevent-vertical-overflow><div class="se-sync-menu-content__header"><span class="se-sync-menu-content__header-title" translate="se.cms.synchronization.page.title"></span><se-help *ngIf="!syncPageConditions?.canSyncHomepage && !syncPageConditions?.pageHasNoDepOrNoSyncStatus" class="se-page-sync__y-help"><span>{{ helpText }}</span></se-help></div><se-page-synchronization-panel [cmsPage]="cmsPage" [uriContext]="uriContext"></se-page-synchronization-panel></se-prevent-vertical-overflow></div></fd-popover-body></fd-popover></ng-container>`,styles:[`.se-toolbar-menu-ddlb--button__icon{position:relative}.se-toolbar-menu-ddlb--button__caution{position:absolute;color:var(--sapWarningColor);right:-9px;bottom:-4px}.se-sync-menu-content__header{padding:15px 20px 0}.se-sync-menu-content__header-title{text-transform:capitalize;font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-sync-menu-content__dropdown{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;max-width:400px}.se-sync-menu-content__dropdown::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.se-sync-menu-content__dropdown::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.se-sync-menu-content__dropdown::after,.se-sync-menu-content__dropdown::before{left:14px}.se-sync-menu-content__dropdown.toolbar-action--include .se-sync-panel-header__timestamp{bottom:20px}`]}),__param(8,n.Inject(l.TOOLBAR_ITEM)),__metadata("design:paramtypes",[l.CrossFrameEventService,l.SystemEventService,l.ICatalogService,l.IPageService,l.IPageInfoService,l.ISyncPollingService,m.TranslateService,l.LogService,Object])],Oo);window.__smartedit__.addDecoratorPayload("Component","CatalogDetailsSyncComponent",{selector:"se-catalog-details-sync",template:`\n        <se-synchronize-catalog\n            [catalog]="catalogDetails.catalog"\n            [catalogVersion]="catalogDetails.catalogVersion"\n            [activeCatalogVersion]="catalogDetails.activeCatalogVersion">\n        </se-synchronize-catalog>\n    `});let Ao=class CatalogDetailsSyncComponent{constructor(e){this.catalogDetails=e}};Ao=__decorate([n.Component({selector:"se-catalog-details-sync",template:`\n        <se-synchronize-catalog\n            [catalog]="catalogDetails.catalog"\n            [catalogVersion]="catalogDetails.catalogVersion"\n            [activeCatalogVersion]="catalogDetails.activeCatalogVersion">\n        </se-synchronize-catalog>\n    `}),__param(0,n.Inject(l.CATALOG_DETAILS_ITEM_DATA)),__metadata("design:paramtypes",[Object])],Ao);let xo=class SynchronizationModule{};xo=__decorate([n.NgModule({imports:[g.CommonModule,l.TranslationModule.forChild(),u.PopoverModule,l.L10nPipeModule,l.HasOperationPermissionDirectiveModule,r.SynchronizationPanelModule,l.PreventVerticalOverflowModule,l.HelpModule,u.ButtonModule],declarations:[Io,Eo,To,Po,Oo,Ao],entryComponents:[Io,Eo,To,Po,Oo,Ao]})],xo);window.__smartedit__.addDecoratorPayload("Component","SyncPageItemComponent",{selector:"se-sync-page-item",template:`<div *seHasOperationPermission="syncPagePermission"><a class="se-dropdown-item fd-list__link" (click)="sync()" translate="se.cms.actionitem.page.sync"></a></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let Do=class SyncPageItemComponent{constructor(e,t,i,o,n,s){this.dropdownMenuData=e;this.catalogService=t;this.systemEventService=i;this.modalService=o;this.logService=n;this.userTrackingService=s}ngOnInit(){this.pageInfo=this.dropdownMenuData.selectedItem;this.syncPagePermission=[{names:["se.act.on.page.in.workflow"],context:{pageInfo:this.pageInfo}}]}sync(){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_MANAGEMENT,"Sync");const e=yield this.catalogService.retrieveUriContext();try{yield this.modalService.open({component:Po,templateConfig:{title:"se.cms.synchronization.pagelist.modal.title.prefix",titleSuffix:"se.cms.pageeditormodal.editpagetab.title"},config:{dialogPanelClass:"modal-md"},data:{cmsPage:this.pageInfo,uriContext:e}}).afterClosed.toPromise();this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE)}catch(e){this.logService.debug("Page Synchronization Panel Modal dismissed",e)}}))}};Do=__decorate([n.Component({selector:"se-sync-page-item",template:`<div *seHasOperationPermission="syncPagePermission"><a class="se-dropdown-item fd-list__link" (click)="sync()" translate="se.cms.actionitem.page.sync"></a></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[Object,l.ICatalogService,l.SystemEventService,l.IModalService,l.LogService,l.IUserTrackingService])],Do);window.__smartedit__.addDecoratorPayload("Component","TrashListDropdownItemsWrapperComponent",{selector:"se-trash-list-dropdown-items-wrapper",template:`<div\n        *seHasOperationPermission="'se.edit.page'"\n        class="paged-list-table__body__td paged-list-table__body__td-menu">\n        <se-dropdown-menu\n            [dropdownItems]="dropdownItems"\n            [selectedItem]="item"\n            class="pull-right"></se-dropdown-menu>\n    </div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let Ro=class TrashListDropdownItemsWrapperComponent{constructor(e,t,i,o){this.route=e;this.data=t;this.catalogVersionPermissionService=i;this.cdr=o;this.dropdownItems=[];this.loaded=false}ngOnInit(){return this.setDropdownItems()}setDropdownItems(){return __awaiter(this,void 0,void 0,(function*(){this.item=this.data.item;const e=yield this.catalogVersionPermissionService.hasSyncPermissionToActiveCatalogVersion(this.route.snapshot.params.catalogId,this.route.snapshot.params.catalogVersion);this.addDropdownItem(vo);if(e){this.addDropdownItem(fo)}this.addDropdownItem(yo);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}addDropdownItem(e){this.dropdownItems=this.dropdownItems.concat({component:e})}};Ro=__decorate([n.Component({selector:"se-trash-list-dropdown-items-wrapper",template:`<div\n        *seHasOperationPermission="'se.edit.page'"\n        class="paged-list-table__body__td paged-list-table__body__td-menu">\n        <se-dropdown-menu\n            [dropdownItems]="dropdownItems"\n            [selectedItem]="item"\n            class="pull-right"></se-dropdown-menu>\n    </div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(1,n.Inject(l.DATA_TABLE_COMPONENT_DATA)),__metadata("design:paramtypes",[b.ActivatedRoute,Object,l.ICatalogVersionPermissionService,n.ChangeDetectorRef])],Ro);window.__smartedit__.addDecoratorPayload("Component","BaseWrapperComponent",{template:""});let Mo=class BaseWrapperComponent{constructor(e){this.data=e}ngOnInit(){this.item=this.data.item}};Mo=__decorate([n.Component({template:""}),__param(0,n.Inject(l.DATA_TABLE_COMPONENT_DATA)),__metadata("design:paramtypes",[Object])],Mo);window.__smartedit__.addDecoratorPayload("Component","ModifiedTimeWrapperComponent",{selector:"se-modified-time-wrapper",template:`<div>{{ item.modifiedtime | date : 'short' }}</div>`});let ko=class ModifiedTimeWrapperComponent extends Mo{};ko=__decorate([n.Component({selector:"se-modified-time-wrapper",template:`<div>{{ item.modifiedtime | date : 'short' }}</div>`})],ko);window.__smartedit__.addDecoratorPayload("Component","NumberOfRestrictionsWrapperComponent",{selector:"se-number-of-restrictions-wrapper",template:`<se-restrictions-viewer [restrictions]="item.restrictions"></se-restrictions-viewer>`});let No=class NumberOfRestrictionsWrapperComponent extends Mo{};No=__decorate([n.Component({selector:"se-number-of-restrictions-wrapper",template:`<se-restrictions-viewer [restrictions]="item.restrictions"></se-restrictions-viewer>`})],No);window.__smartedit__.addDecoratorPayload("Component","PageStatusWrapperComponent",{selector:"se-page-status-wrapper",template:`<div>\n        <se-page-display-status\n            [cmsPage]="item"\n            [showLastSyncTime]="false"></se-page-display-status>\n    </div>`});let Fo=class PageStatusWrapperComponent extends Mo{};Fo=__decorate([n.Component({selector:"se-page-status-wrapper",template:`<div>\n        <se-page-display-status\n            [cmsPage]="item"\n            [showLastSyncTime]="false"></se-page-display-status>\n    </div>`})],Fo);window.__smartedit__.addDecoratorPayload("Component","PageNameWrapperComponent",{selector:"se-page-name-wrapper",template:`\n        <a fd-link href="" (click)="goToPage($event)">\n            <se-homepage-icon\n                class="homepage-icon__page-list"\n                [cmsPage]="item"\n                [uriContext]="uriContext"></se-homepage-icon>\n            {{ item.name }}\n        </a>\n    `});let zo=class PageNameWrapperComponent{constructor(e,t,i,o){this.data=e;this.route=t;this.experienceService=i;this.urlService=o}ngOnInit(){this.item=this.data.item;({siteId:this.siteUid,catalogId:this.catalogId,catalogVersion:this.catalogVersion}=this.route.snapshot.params);this.uriContext=p.merge(this.urlService.buildUriContext(this.siteUid,this.catalogId,this.catalogVersion),this.urlService.buildPageUriContext(this.siteUid,this.catalogId,this.catalogVersion))}goToPage(e){e.preventDefault();if(this.item.uid){this.experienceService.loadExperience({siteId:this.siteUid,catalogId:this.catalogId,catalogVersion:this.catalogVersion,pageId:this.item.uid})}}};zo=__decorate([n.Component({selector:"se-page-name-wrapper",template:`\n        <a fd-link href="" (click)="goToPage($event)">\n            <se-homepage-icon\n                class="homepage-icon__page-list"\n                [cmsPage]="item"\n                [uriContext]="uriContext"></se-homepage-icon>\n            {{ item.name }}\n        </a>\n    `}),__param(0,n.Inject(l.DATA_TABLE_COMPONENT_DATA)),__metadata("design:paramtypes",[Object,b.ActivatedRoute,l.IExperienceService,l.IUrlService])],zo);window.__smartedit__.addDecoratorPayload("Component","PageListDropdownItemsWrapperComponent",{selector:"se-page-list-dropdown-items-wrapper",template:`<div\n        *seHasOperationPermission="'se.edit.page'"\n        class="paged-list-table__body__td paged-list-table__body__td-menu">\n        <se-dropdown-menu\n            [dropdownItems]="dropdownItems"\n            [selectedItem]="item"\n            class="pull-right"></se-dropdown-menu>\n    </div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let Lo=class PageListDropdownItemsWrapperComponent{constructor(e,t,i,o,n){this.route=e;this.data=t;this.catalogVersionPermissionService=i;this.managePageService=o;this.cdr=n;this.dropdownItems=[]}ngOnInit(){return this.setDropdownItems()}setDropdownItems(){return __awaiter(this,void 0,void 0,(function*(){this.item=this.data.item;const{catalogId:e,catalogVersion:t}=this.route.snapshot.params;const[i,o]=yield Promise.all([this.catalogVersionPermissionService.hasSyncPermissionToActiveCatalogVersion(e,t),this.managePageService.isPageCloneable(this.data.item.uuid,this.data.item.catalogVersion)]);this.addDropdownItem(So);if(i){this.addDropdownItem(Do)}if(o){this.addDropdownItem(Co)}this.addDropdownItem(bo);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}addDropdownItem(e){this.dropdownItems=this.dropdownItems.concat({component:e})}};Lo=__decorate([n.Component({selector:"se-page-list-dropdown-items-wrapper",template:`<div\n        *seHasOperationPermission="'se.edit.page'"\n        class="paged-list-table__body__td paged-list-table__body__td-menu">\n        <se-dropdown-menu\n            [dropdownItems]="dropdownItems"\n            [selectedItem]="item"\n            class="pull-right"></se-dropdown-menu>\n    </div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(1,n.Inject(l.DATA_TABLE_COMPONENT_DATA)),__metadata("design:paramtypes",[b.ActivatedRoute,Object,l.ICatalogVersionPermissionService,t.ManagePageService,n.ChangeDetectorRef])],Lo);window.__smartedit__.addDecoratorPayload("Component","PageListComponent",{selector:"se-page-list",template:`<div class="se-page-list"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar><se-toolbar cssClass="se-toolbar--shell se-toolbar--shortcut" imageRoot="imageRoot" toolbarName="smartEditPagesToolbar"></se-toolbar><div *ngIf="isReady"><div class="se-page-list__header"><h2 class="se-page-list__catalog-name" translate="se.cms.pagelist.title"></h2><p class="se-page-list__sub-title">{{ catalogName | seL10n | async }} - {{ catalogVersion }}</p></div><div class="se-page-list__body"><div class="se-page-list__table-header"><span class="se-paged-list__page-count-wrapper"><span class="span-page-list__page-count-text" translate="se.pagelist.countsearchresult"></span> <span>&nbsp;</span> <span class="se-page-list__page-count">({{ count }})</span></span><div class="se-page-list__table-header--right"><div class="fd-form__group se-page-list__search"><div class="se-input-group"><input type="search" class="fd-input se-input-group__input-area ySEPage-list-search-input" maxlength="255" name="query" [ngModel]="query" (ngModelChange)="onQueryChange($event)" [placeholder]="'se.cms.pagelist.searchplaceholder' | translate" title="{{ 'se.cms.pagelist.searchplaceholder' | translate }}"/> <span class="sap-icon--search se-input-group__addon"></span><div *ngIf="query" aria-label="clear" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="reset()"></div></div></div><button class="se-page-list__add" (click)="openAddPageWizard()" fd-button [label]="'se.cms.addpagewizard.addpage' | translate"></button></div></div><div class="se-page-list__table-body"><se-dynamic-paged-list [config]="pageListConfig" [mask]="query" (getApi)="getApi($event);" (onItemsUpdate)="onPageItemsUpdate($event.pagination)"></se-dynamic-paged-list></div></div></div></div>`,styles:[`.se-page-list{background-color:var(--sapShell_Background);min-height:100vh;height:100%}.se-page-list__page-link-anchor{text-decoration:none!important;color:var(--sapNeutralTextColor)}.se-page-list__page-link-anchor:hover{color:var(--sapLinkColor)}.se-page-list__header{padding:16px 30px;background-color:var(--sapBaseColor);-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-page-list__page-link-icon{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralTextColor)}.se-page-list__catalog-name{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;display:block;margin-bottom:4px;font-weight:800;font-size:2rem!important;color:var(--sapTitleColor)}.se-page-list__sub-title{font-size:.875rem;color:var(--sapField_PlaceholderTextColor)}.se-page-list__body{padding:20px 20px 70px}.se-page-list__page-link--left{cursor:pointer}.se-page-list__page-link--left .se-page-list__page-link-anchor{margin-left:3px}.se-page-list__page-link--right{cursor:pointer}.se-page-list__page-link--right .se-page-list__page-link-anchor{margin-right:3px}.se-page-list__table-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:var(--sapBaseColor);height:56px;padding:20px;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0}.se-page-list__table-header--right{display:flex;flex-direction:row;align-items:center}.se-page-list__table-header .se-paged-list__page-count-wrapper{font-size:1rem!important;line-height:1.25;font-weight:400;margin-right:auto}.se-page-list__table-body{padding-bottom:16px}.se-page-list__table-body .se-data-table__arrow{margin-left:2px}.se-page-list__table-body .se-paged-list-item{cursor:default}.se-page-list__search{margin-right:16px;width:380px}.se-page-list__add{text-transform:capitalize}.se-paged-list__header{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-paged-list__header-dropdownitems,.se-paged-list__header-syncStatus{text-align:right}.se-paged-list__header-pageStatus{cursor:default}.se-paged-list-item-name a{text-decoration:none!important}.se-sync-btn__status--done{color:var(--sapIndicationColor_4)}.se-sync-btn__status--not{color:var(--sapIndicationColor_3)}.ySmartEditTrashPageToolbar{background-color:var(--sapBaseColor)}.fd-table td.se-paged-list-item-numberOfRestrictions,.fd-table td.se-paged-list-item-syncStatus,.fd-table th.se-paged-list__header-numberOfRestrictions,.fd-table th.se-paged-list__header-syncStatus{text-align:center}.fd-table td.se-paged-list-item-syncStatus{font-size:1rem!important;line-height:1.25;font-weight:400}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None});let Vo=class PageListComponent{constructor(e,t,i,o,n,s,a){this.activatedRoute=e;this.urlService=t;this.catalogService=i;this.addPageWizardService=o;this.systemEventService=n;this.cdr=s;this.userTrackingService=a;const{snapshot:{params:r}}=this.activatedRoute;this.isReady=false;this.count=0;this.catalogId=r.catalogId;this.catalogVersion=r.catalogVersion;this.siteUid=r.siteId;this.catalogName={};this.pageUriContext=this.urlService.buildPageUriContext(this.siteUid,this.catalogId,this.catalogVersion);this.uriContext=this.urlService.buildUriContext(this.siteUid,this.catalogId,this.catalogVersion);this.pageListConfig={sortBy:"name",reversed:false,itemsPerPage:10,displayCount:true,keys:[],queryParams:{catalogId:this.catalogId,catalogVersion:this.catalogVersion,typeCode:"AbstractPage",itemSearchParams:"pageStatus:active",fields:"PAGE_LIST"},uri:l.cmsitemsUri};this.query="";this.querySubject$=new h.Subject;this.querySubscription=this.querySubject$.pipe(d.debounceTime(500),d.distinctUntilChanged()).subscribe((e=>{this.query=e;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnInit(){return this.initialize()}ngOnDestroy(){this.eventUnsubscribe();this.querySubscription.unsubscribe()}onPageItemsUpdate(e){this.count=e.totalCount}onContentCatalogUpdate(){if(this.dynamicPagedListApi){this.dynamicPagedListApi.reloadItems()}}onQueryChange(e){this.querySubject$.next(e)}getApi(e){this.dynamicPagedListApi=e}openAddPageWizard(){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_MANAGEMENT,"Create Page");yield this.addPageWizardService.openAddPageWizard();this.dynamicPagedListApi.reloadItems()}))}reset(){this.querySubject$.next("")}retrieveCatalogName(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.getContentCatalogsForSite(this.siteUid);this.catalogName=e.find((e=>e.catalogId===this.catalogId)).name}))}initialize(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.isContentCatalogVersionNonActive();this.pageListConfig.keys=[{property:"name",i18n:"se.cms.pagelist.headerpagename",sortable:true,component:zo},{property:"uid",i18n:"se.cms.pagelist.headerpageid",sortable:true},{property:"itemtype",i18n:"se.cms.pagelist.headerpagetype",sortable:true},{property:"label",i18n:"se.cms.pagelist.headerpagelable",sortable:false},{property:"masterTemplateId",i18n:"se.cms.pagelist.headerpagetemplate",sortable:false},{property:"numberOfRestrictions",i18n:"se.cms.pagelist.headerrestrictions",sortable:false,component:No}];if(e){this.pageListConfig.keys.push({property:"pageStatus",i18n:"se.cms.pagelist.headerpagestatus",sortable:false,component:Fo})}this.pageListConfig.keys.push({property:"dropdownitems",i18n:"se.cms.pagelist.headerpageaction",sortable:false,component:Lo});yield this.retrieveCatalogName();this.eventUnsubscribe=this.systemEventService.subscribe(l.EVENT_CONTENT_CATALOG_UPDATE,(()=>this.onContentCatalogUpdate()));this.isReady=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}};Vo=__decorate([n.Component({selector:"se-page-list",template:`<div class="se-page-list"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar><se-toolbar cssClass="se-toolbar--shell se-toolbar--shortcut" imageRoot="imageRoot" toolbarName="smartEditPagesToolbar"></se-toolbar><div *ngIf="isReady"><div class="se-page-list__header"><h2 class="se-page-list__catalog-name" translate="se.cms.pagelist.title"></h2><p class="se-page-list__sub-title">{{ catalogName | seL10n | async }} - {{ catalogVersion }}</p></div><div class="se-page-list__body"><div class="se-page-list__table-header"><span class="se-paged-list__page-count-wrapper"><span class="span-page-list__page-count-text" translate="se.pagelist.countsearchresult"></span> <span>&nbsp;</span> <span class="se-page-list__page-count">({{ count }})</span></span><div class="se-page-list__table-header--right"><div class="fd-form__group se-page-list__search"><div class="se-input-group"><input type="search" class="fd-input se-input-group__input-area ySEPage-list-search-input" maxlength="255" name="query" [ngModel]="query" (ngModelChange)="onQueryChange($event)" [placeholder]="'se.cms.pagelist.searchplaceholder' | translate" title="{{ 'se.cms.pagelist.searchplaceholder' | translate }}"/> <span class="sap-icon--search se-input-group__addon"></span><div *ngIf="query" aria-label="clear" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="reset()"></div></div></div><button class="se-page-list__add" (click)="openAddPageWizard()" fd-button [label]="'se.cms.addpagewizard.addpage' | translate"></button></div></div><div class="se-page-list__table-body"><se-dynamic-paged-list [config]="pageListConfig" [mask]="query" (getApi)="getApi($event);" (onItemsUpdate)="onPageItemsUpdate($event.pagination)"></se-dynamic-paged-list></div></div></div></div>`,styles:[`.se-page-list{background-color:var(--sapShell_Background);min-height:100vh;height:100%}.se-page-list__page-link-anchor{text-decoration:none!important;color:var(--sapNeutralTextColor)}.se-page-list__page-link-anchor:hover{color:var(--sapLinkColor)}.se-page-list__header{padding:16px 30px;background-color:var(--sapBaseColor);-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-page-list__page-link-icon{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralTextColor)}.se-page-list__catalog-name{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;display:block;margin-bottom:4px;font-weight:800;font-size:2rem!important;color:var(--sapTitleColor)}.se-page-list__sub-title{font-size:.875rem;color:var(--sapField_PlaceholderTextColor)}.se-page-list__body{padding:20px 20px 70px}.se-page-list__page-link--left{cursor:pointer}.se-page-list__page-link--left .se-page-list__page-link-anchor{margin-left:3px}.se-page-list__page-link--right{cursor:pointer}.se-page-list__page-link--right .se-page-list__page-link-anchor{margin-right:3px}.se-page-list__table-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:var(--sapBaseColor);height:56px;padding:20px;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0}.se-page-list__table-header--right{display:flex;flex-direction:row;align-items:center}.se-page-list__table-header .se-paged-list__page-count-wrapper{font-size:1rem!important;line-height:1.25;font-weight:400;margin-right:auto}.se-page-list__table-body{padding-bottom:16px}.se-page-list__table-body .se-data-table__arrow{margin-left:2px}.se-page-list__table-body .se-paged-list-item{cursor:default}.se-page-list__search{margin-right:16px;width:380px}.se-page-list__add{text-transform:capitalize}.se-paged-list__header{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-paged-list__header-dropdownitems,.se-paged-list__header-syncStatus{text-align:right}.se-paged-list__header-pageStatus{cursor:default}.se-paged-list-item-name a{text-decoration:none!important}.se-sync-btn__status--done{color:var(--sapIndicationColor_4)}.se-sync-btn__status--not{color:var(--sapIndicationColor_3)}.ySmartEditTrashPageToolbar{background-color:var(--sapBaseColor)}.fd-table td.se-paged-list-item-numberOfRestrictions,.fd-table td.se-paged-list-item-syncStatus,.fd-table th.se-paged-list__header-numberOfRestrictions,.fd-table th.se-paged-list__header-syncStatus{text-align:center}.fd-table td.se-paged-list-item-syncStatus{font-size:1rem!important;line-height:1.25;font-weight:400}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),__metadata("design:paramtypes",[b.ActivatedRoute,l.IUrlService,l.ICatalogService,t.AddPageWizardService,l.SystemEventService,n.ChangeDetectorRef,l.IUserTrackingService])],Vo);window.__smartedit__.addDecoratorPayload("Component","PageListLinkComponent",{selector:"se-page-list-link",template:`<div><a class="fd-link page-list-link-item__link" [href]="getLink()" translate="se.cms.cataloginfo.pagelist" (click)="onClick()"></a></div>`});let Uo=class PageListLinkComponent{constructor(e,t){this.catalogDetails=e;this.userTrackingService=t}getLink(){const{siteId:e,catalog:{catalogId:t},catalogVersion:{version:i}}=this.catalogDetails;return`#/pages/${e}/${t}/${i}`}onClick(){const{catalogVersion:{version:e}}=this.catalogDetails;this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION,e+"- Pages")}};Uo=__decorate([n.Component({selector:"se-page-list-link",template:`<div><a class="fd-link page-list-link-item__link" [href]="getLink()" translate="se.cms.cataloginfo.pagelist" (click)="onClick()"></a></div>`}),__param(0,n.Inject(l.CATALOG_DETAILS_ITEM_DATA)),__metadata("design:paramtypes",[Object,l.IUserTrackingService])],Uo);window.__smartedit__.addDecoratorPayload("Component","PagesLinkComponent",{selector:"se-pages-link",template:`<div class="se-page-list__page-link--left" (click)="backToPagelist()"><span class="se-page-list__page-link-icon sap-icon--navigation-left-arrow"></span> <a class="se-page-list__page-link-anchor">{{ 'se.cms.back.to.pagelist' | translate }}</a></div>`,styles:[`.se-page-list{background-color:var(--sapShell_Background);min-height:100vh;height:100%}.se-page-list__page-link-anchor{text-decoration:none!important;color:var(--sapNeutralTextColor)}.se-page-list__page-link-anchor:hover{color:var(--sapLinkColor)}.se-page-list__header{padding:16px 30px;background-color:var(--sapBaseColor);-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-page-list__page-link-icon{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralTextColor)}.se-page-list__catalog-name{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;display:block;margin-bottom:4px;font-weight:800;font-size:2rem!important;color:var(--sapTitleColor)}.se-page-list__sub-title{font-size:.875rem;color:var(--sapField_PlaceholderTextColor)}.se-page-list__body{padding:20px 20px 70px}.se-page-list__page-link--left{cursor:pointer}.se-page-list__page-link--left .se-page-list__page-link-anchor{margin-left:3px}.se-page-list__page-link--right{cursor:pointer}.se-page-list__page-link--right .se-page-list__page-link-anchor{margin-right:3px}.se-page-list__table-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:var(--sapBaseColor);height:56px;padding:20px;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0}.se-page-list__table-header--right{display:flex;flex-direction:row;align-items:center}.se-page-list__table-header .se-paged-list__page-count-wrapper{font-size:1rem!important;line-height:1.25;font-weight:400;margin-right:auto}.se-page-list__table-body{padding-bottom:16px}.se-page-list__table-body .se-data-table__arrow{margin-left:2px}.se-page-list__table-body .se-paged-list-item{cursor:default}.se-page-list__search{margin-right:16px;width:380px}.se-page-list__add{text-transform:capitalize}.se-paged-list__header{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-paged-list__header-dropdownitems,.se-paged-list__header-syncStatus{text-align:right}.se-paged-list__header-pageStatus{cursor:default}.se-paged-list-item-name a{text-decoration:none!important}.se-sync-btn__status--done{color:var(--sapIndicationColor_4)}.se-sync-btn__status--not{color:var(--sapIndicationColor_3)}.ySmartEditTrashPageToolbar{background-color:var(--sapBaseColor)}.fd-table td.se-paged-list-item-numberOfRestrictions,.fd-table td.se-paged-list-item-syncStatus,.fd-table th.se-paged-list__header-numberOfRestrictions,.fd-table th.se-paged-list__header-syncStatus{text-align:center}.fd-table td.se-paged-list-item-syncStatus{font-size:1rem!important;line-height:1.25;font-weight:400}`]});let Bo=class PagesLinkComponent{constructor(e,t){this.route=e;this.seRouting=t}ngOnInit(){this.siteId=this.route.snapshot.params.siteId;this.catalogId=this.route.snapshot.params.catalogId;this.catalogVersion=this.route.snapshot.params.catalogVersion}backToPagelist(){this.seRouting.go(r.PAGE_LIST_PATH.replace(":siteId",this.siteId).replace(":catalogId",this.catalogId).replace(":catalogVersion",this.catalogVersion))}};Bo=__decorate([n.Component({selector:"se-pages-link",template:`<div class="se-page-list__page-link--left" (click)="backToPagelist()"><span class="se-page-list__page-link-icon sap-icon--navigation-left-arrow"></span> <a class="se-page-list__page-link-anchor">{{ 'se.cms.back.to.pagelist' | translate }}</a></div>`,styles:[`.se-page-list{background-color:var(--sapShell_Background);min-height:100vh;height:100%}.se-page-list__page-link-anchor{text-decoration:none!important;color:var(--sapNeutralTextColor)}.se-page-list__page-link-anchor:hover{color:var(--sapLinkColor)}.se-page-list__header{padding:16px 30px;background-color:var(--sapBaseColor);-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-page-list__page-link-icon{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralTextColor)}.se-page-list__catalog-name{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;display:block;margin-bottom:4px;font-weight:800;font-size:2rem!important;color:var(--sapTitleColor)}.se-page-list__sub-title{font-size:.875rem;color:var(--sapField_PlaceholderTextColor)}.se-page-list__body{padding:20px 20px 70px}.se-page-list__page-link--left{cursor:pointer}.se-page-list__page-link--left .se-page-list__page-link-anchor{margin-left:3px}.se-page-list__page-link--right{cursor:pointer}.se-page-list__page-link--right .se-page-list__page-link-anchor{margin-right:3px}.se-page-list__table-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:var(--sapBaseColor);height:56px;padding:20px;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0}.se-page-list__table-header--right{display:flex;flex-direction:row;align-items:center}.se-page-list__table-header .se-paged-list__page-count-wrapper{font-size:1rem!important;line-height:1.25;font-weight:400;margin-right:auto}.se-page-list__table-body{padding-bottom:16px}.se-page-list__table-body .se-data-table__arrow{margin-left:2px}.se-page-list__table-body .se-paged-list-item{cursor:default}.se-page-list__search{margin-right:16px;width:380px}.se-page-list__add{text-transform:capitalize}.se-paged-list__header{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-paged-list__header-dropdownitems,.se-paged-list__header-syncStatus{text-align:right}.se-paged-list__header-pageStatus{cursor:default}.se-paged-list-item-name a{text-decoration:none!important}.se-sync-btn__status--done{color:var(--sapIndicationColor_4)}.se-sync-btn__status--not{color:var(--sapIndicationColor_3)}.ySmartEditTrashPageToolbar{background-color:var(--sapBaseColor)}.fd-table td.se-paged-list-item-numberOfRestrictions,.fd-table td.se-paged-list-item-syncStatus,.fd-table th.se-paged-list__header-numberOfRestrictions,.fd-table th.se-paged-list__header-syncStatus{text-align:center}.fd-table td.se-paged-list-item-syncStatus{font-size:1rem!important;line-height:1.25;font-weight:400}`]}),__metadata("design:paramtypes",[b.ActivatedRoute,l.SmarteditRoutingService])],Bo);window.__smartedit__.addDecoratorPayload("Component","RestrictionsModalComponent",{selector:"se-restrictions-modal",template:`<div class="se-restrictions-list fd-menu__list fd-menu__list--separated"><div class="se-restriction__item fd-menu__item" *ngFor="let restriction of restrictions"><div class="se-restrictions-list__item-content"><div class="se-restriction__item-name">{{ restriction.name }}</div><div class="se-restriction__item-type-and-id">{{ restriction.type | seL10n | async }}</div><div class="se-restriction__item-description">{{ restriction.description }}</div></div></div></div>`,styles:[`#restrictions-label{display:none}.se-restriction__select{text-transform:capitalize;width:100%}.se-restrictions-list__item-content{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;cursor:default;flex-grow:1}#userGroups-selector .se-generic-editor-multiple-dropdown__match li[draggable=true]{display:flex;flex-direction:row;align-items:center;justify-content:center;display:inline-flex!important;border:1px solid var(--sapGroup_ContentBorderColor);margin:4px 0 4px 8px;padding:4px 8px;border-radius:4px;background-color:var(--fd-token-background-color);color:var(--sapNeutralColor);min-height:28px}.se-restrictions-list .se-restriction__item{position:static;display:flex;flex-direction:row;align-items:center;justify-content:space-between;cursor:default;border-top-color:var(--sapList_GroupHeaderBorderColor)!important;border-top:solid;border-radius:unset;padding:20px}.se-restrictions-list .se-restriction__item:last-child{margin-bottom:42px}.se-restrictions-list .se-restriction__item:first-child{border-top-width:0}.se-restriction__item-name{font-weight:700;color:var(--sapTextColor);margin:0}.se-restriction__item-type-and-id{color:var(--sapNeutralColor);margin-top:0}.se-restriction__item-description{text-overflow:ellipsis;white-space:initial;overflow:hidden;word-break:break-all;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapNeutralColor);width:90%}.se-restrictions-list--empty__message{color:var(--sapNeutralColor)}.se-restrictions-list__item-content{width:95%}.error-input.se-restriction__item-description,.error-input.se-restriction__item-name,.error-input.se-restriction__item-type-and-id{color:var(--sapErrorColor)}.se-restrictions-list{box-shadow:none}`]});let jo=class RestrictionsModalComponent{constructor(e,t,i){this.modalRef=e;this.cmsitemsRestService=t;this.cdr=i}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.cmsitemsRestService.getByIdsNoCache(this.modalRef.data.modalData,"FULL");this.restrictions=e.response?e.response:[e];if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}};jo=__decorate([n.Component({selector:"se-restrictions-modal",template:`<div class="se-restrictions-list fd-menu__list fd-menu__list--separated"><div class="se-restriction__item fd-menu__item" *ngFor="let restriction of restrictions"><div class="se-restrictions-list__item-content"><div class="se-restriction__item-name">{{ restriction.name }}</div><div class="se-restriction__item-type-and-id">{{ restriction.type | seL10n | async }}</div><div class="se-restriction__item-description">{{ restriction.description }}</div></div></div></div>`,styles:[`#restrictions-label{display:none}.se-restriction__select{text-transform:capitalize;width:100%}.se-restrictions-list__item-content{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;cursor:default;flex-grow:1}#userGroups-selector .se-generic-editor-multiple-dropdown__match li[draggable=true]{display:flex;flex-direction:row;align-items:center;justify-content:center;display:inline-flex!important;border:1px solid var(--sapGroup_ContentBorderColor);margin:4px 0 4px 8px;padding:4px 8px;border-radius:4px;background-color:var(--fd-token-background-color);color:var(--sapNeutralColor);min-height:28px}.se-restrictions-list .se-restriction__item{position:static;display:flex;flex-direction:row;align-items:center;justify-content:space-between;cursor:default;border-top-color:var(--sapList_GroupHeaderBorderColor)!important;border-top:solid;border-radius:unset;padding:20px}.se-restrictions-list .se-restriction__item:last-child{margin-bottom:42px}.se-restrictions-list .se-restriction__item:first-child{border-top-width:0}.se-restriction__item-name{font-weight:700;color:var(--sapTextColor);margin:0}.se-restriction__item-type-and-id{color:var(--sapNeutralColor);margin-top:0}.se-restriction__item-description{text-overflow:ellipsis;white-space:initial;overflow:hidden;word-break:break-all;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapNeutralColor);width:90%}.se-restrictions-list--empty__message{color:var(--sapNeutralColor)}.se-restrictions-list__item-content{width:95%}.error-input.se-restriction__item-description,.error-input.se-restriction__item-name,.error-input.se-restriction__item-type-and-id{color:var(--sapErrorColor)}.se-restrictions-list{box-shadow:none}`]}),__metadata("design:paramtypes",[u.DialogRef,l.CmsitemsRestService,n.ChangeDetectorRef])],jo);window.__smartedit__.addDecoratorPayload("Component","RestrictionsViewerComponent",{selector:"se-restrictions-viewer",template:`<div *ngIf="restrictions?.length > 0; else noRestrictions"><a href="" class="fd-link show-restrictions-btn" (click)="showRestrictions($event)">{{restrictions.length}}</a></div><ng-template #noRestrictions><div>-</div></ng-template>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let Go=class RestrictionsViewerComponent{constructor(e,t){this.modalService=e;this.logService=t}showRestrictions(e){e.preventDefault();return this.modalService.open({component:jo,data:this.restrictions,templateConfig:{title:"se.cms.restrictionsviewer.title",isDismissButtonVisible:true},config:{dialogPanelClass:"modal-dialog"}}).afterClosed.toPromise().catch((()=>{this.logService.warn("RestrictionsViewer - modal closed without any action")}))}};__decorate([n.Input(),__metadata("design:type",Array)],Go.prototype,"restrictions",void 0);Go=__decorate([n.Component({selector:"se-restrictions-viewer",template:`<div *ngIf="restrictions?.length > 0; else noRestrictions"><a href="" class="fd-link show-restrictions-btn" (click)="showRestrictions($event)">{{restrictions.length}}</a></div><ng-template #noRestrictions><div>-</div></ng-template>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.ModalService,l.LogService])],Go);window.__smartedit__.addDecoratorPayload("Component","TrashLinkComponent",{selector:"se-trash-link",template:`<div *ngIf="isNonActiveCatalog" (click)="goToTrash()" class="se-page-list__page-link--right"><a translate="se.cms.pagelist.trashcan.link.text" [translateParams]="trashedPagesTranslationData" class="se-page-list__page-link-anchor"></a> <span class="se-page-list__page-link-icon sap-icon--navigation-right-arrow"></span></div>`,styles:[`.se-page-list{background-color:var(--sapShell_Background);min-height:100vh;height:100%}.se-page-list__page-link-anchor{text-decoration:none!important;color:var(--sapNeutralTextColor)}.se-page-list__page-link-anchor:hover{color:var(--sapLinkColor)}.se-page-list__header{padding:16px 30px;background-color:var(--sapBaseColor);-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-page-list__page-link-icon{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralTextColor)}.se-page-list__catalog-name{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;display:block;margin-bottom:4px;font-weight:800;font-size:2rem!important;color:var(--sapTitleColor)}.se-page-list__sub-title{font-size:.875rem;color:var(--sapField_PlaceholderTextColor)}.se-page-list__body{padding:20px 20px 70px}.se-page-list__page-link--left{cursor:pointer}.se-page-list__page-link--left .se-page-list__page-link-anchor{margin-left:3px}.se-page-list__page-link--right{cursor:pointer}.se-page-list__page-link--right .se-page-list__page-link-anchor{margin-right:3px}.se-page-list__table-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:var(--sapBaseColor);height:56px;padding:20px;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0}.se-page-list__table-header--right{display:flex;flex-direction:row;align-items:center}.se-page-list__table-header .se-paged-list__page-count-wrapper{font-size:1rem!important;line-height:1.25;font-weight:400;margin-right:auto}.se-page-list__table-body{padding-bottom:16px}.se-page-list__table-body .se-data-table__arrow{margin-left:2px}.se-page-list__table-body .se-paged-list-item{cursor:default}.se-page-list__search{margin-right:16px;width:380px}.se-page-list__add{text-transform:capitalize}.se-paged-list__header{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-paged-list__header-dropdownitems,.se-paged-list__header-syncStatus{text-align:right}.se-paged-list__header-pageStatus{cursor:default}.se-paged-list-item-name a{text-decoration:none!important}.se-sync-btn__status--done{color:var(--sapIndicationColor_4)}.se-sync-btn__status--not{color:var(--sapIndicationColor_3)}.ySmartEditTrashPageToolbar{background-color:var(--sapBaseColor)}.fd-table td.se-paged-list-item-numberOfRestrictions,.fd-table td.se-paged-list-item-syncStatus,.fd-table th.se-paged-list__header-numberOfRestrictions,.fd-table th.se-paged-list__header-syncStatus{text-align:center}.fd-table td.se-paged-list-item-syncStatus{font-size:1rem!important;line-height:1.25;font-weight:400}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Ho=class TrashLinkComponent{constructor(e,t,i,o,n,s,a){this.route=e;this.routingsService=t;this.managePageService=i;this.urlService=o;this.catalogService=n;this.systemEventService=s;this.cdr=a;this.isNonActiveCatalog=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){({siteId:this.siteId,catalogId:this.catalogId,catalogVersion:this.catalogVersion}=this.route.snapshot.params);this.uriContext=this.urlService.buildUriContext(this.siteId,this.catalogId,this.catalogVersion);const e=yield this.catalogService.isContentCatalogVersionNonActive();this.isNonActiveCatalog=e;if(e){this.updateTrashedPagesCount()}this.unsubscribeContentCatalogUpdateEvent=this.systemEventService.subscribe(l.EVENT_CONTENT_CATALOG_UPDATE,(()=>this.updateTrashedPagesCount()))}))}ngOnDestroy(){this.unsubscribeContentCatalogUpdateEvent()}updateTrashedPagesCount(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.managePageService.getSoftDeletedPagesCount(this.uriContext);this.trashedPagesTranslationData={totalCount:e};this.cdr.detectChanges()}))}goToTrash(){this.routingsService.go(r.TRASHED_PAGE_LIST_PATH.replace(":siteId",this.siteId).replace(":catalogId",this.catalogId).replace(":catalogVersion",this.catalogVersion))}};Ho=__decorate([n.Component({selector:"se-trash-link",template:`<div *ngIf="isNonActiveCatalog" (click)="goToTrash()" class="se-page-list__page-link--right"><a translate="se.cms.pagelist.trashcan.link.text" [translateParams]="trashedPagesTranslationData" class="se-page-list__page-link-anchor"></a> <span class="se-page-list__page-link-icon sap-icon--navigation-right-arrow"></span></div>`,styles:[`.se-page-list{background-color:var(--sapShell_Background);min-height:100vh;height:100%}.se-page-list__page-link-anchor{text-decoration:none!important;color:var(--sapNeutralTextColor)}.se-page-list__page-link-anchor:hover{color:var(--sapLinkColor)}.se-page-list__header{padding:16px 30px;background-color:var(--sapBaseColor);-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-page-list__page-link-icon{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralTextColor)}.se-page-list__catalog-name{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;display:block;margin-bottom:4px;font-weight:800;font-size:2rem!important;color:var(--sapTitleColor)}.se-page-list__sub-title{font-size:.875rem;color:var(--sapField_PlaceholderTextColor)}.se-page-list__body{padding:20px 20px 70px}.se-page-list__page-link--left{cursor:pointer}.se-page-list__page-link--left .se-page-list__page-link-anchor{margin-left:3px}.se-page-list__page-link--right{cursor:pointer}.se-page-list__page-link--right .se-page-list__page-link-anchor{margin-right:3px}.se-page-list__table-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:var(--sapBaseColor);height:56px;padding:20px;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0}.se-page-list__table-header--right{display:flex;flex-direction:row;align-items:center}.se-page-list__table-header .se-paged-list__page-count-wrapper{font-size:1rem!important;line-height:1.25;font-weight:400;margin-right:auto}.se-page-list__table-body{padding-bottom:16px}.se-page-list__table-body .se-data-table__arrow{margin-left:2px}.se-page-list__table-body .se-paged-list-item{cursor:default}.se-page-list__search{margin-right:16px;width:380px}.se-page-list__add{text-transform:capitalize}.se-paged-list__header{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-paged-list__header-dropdownitems,.se-paged-list__header-syncStatus{text-align:right}.se-paged-list__header-pageStatus{cursor:default}.se-paged-list-item-name a{text-decoration:none!important}.se-sync-btn__status--done{color:var(--sapIndicationColor_4)}.se-sync-btn__status--not{color:var(--sapIndicationColor_3)}.ySmartEditTrashPageToolbar{background-color:var(--sapBaseColor)}.fd-table td.se-paged-list-item-numberOfRestrictions,.fd-table td.se-paged-list-item-syncStatus,.fd-table th.se-paged-list__header-numberOfRestrictions,.fd-table th.se-paged-list__header-syncStatus{text-align:center}.fd-table td.se-paged-list-item-syncStatus{font-size:1rem!important;line-height:1.25;font-weight:400}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[b.ActivatedRoute,l.SmarteditRoutingService,t.ManagePageService,l.IUrlService,l.ICatalogService,l.SystemEventService,n.ChangeDetectorRef])],Ho);let Wo=class PageComponentsModule{};Wo=__decorate([n.NgModule({imports:[g.CommonModule,l.L10nPipeModule,s.FormsModule,y.LinkModule,l.TranslationModule.forChild(),l.HasOperationPermissionDirectiveModule,l.TooltipModule,Gi,l.SharedComponentsModule,l.SelectModule,l.SeGenericEditorModule,t.PageRestrictionsModule,_.ToolbarModule,l.ClientPagedListModule,u.PopoverModule,u.ButtonModule,S.ListModule],providers:[t.ContextAwarePageStructureService,Qe,uo,go,ho,Yi,to],declarations:[fo,vo,yo,Bo,Go,jo,No,Fo,ko,Ro,$i,Ki,Do,no,mo,at,Je,et,it,tt,ot,eo,Zi,Xi,qi,Wi,oo,io,Qi,So,Co,bo,Uo,Vo,zo,Lo,Ho,po,ro,co,lo,ao,_o],entryComponents:[fo,vo,yo,Bo,Go,jo,No,Fo,ko,Ro,$i,Ki,Do,no,mo,at,Je,et,it,tt,ot,eo,Zi,Xi,qi,Wi,oo,io,Qi,So,Co,bo,Uo,zo,Lo,Ho,po,ro,co,lo,ao,_o],exports:[mo]})],Wo);let $o=class NodeAncestryService{buildOrderedListOfAncestors(e,t){const i=p.reverse(this.fetchAncestors(e,t));let o=-1;return i.map((e=>{const t=++o;return Object.assign(Object.assign({},p.cloneDeep(e)),{level:t,formattedLevel:t===0?"se.cms.navigationcomponent.management.node.level.root":"se.cms.navigationcomponent.management.node.level.non.root"})}))}fetchAncestors(e,t){const i=e.find((e=>e.uid===t));if(!i){return[]}return[i].concat(this.fetchAncestors(e,i.parentUid))}};$o=__decorate([n.Injectable()],$o);let Ko=class NavigationEditorNodeService{constructor(e,t,i){this.cmsitemsRestService=e;this.nodeAncestryService=t;this.navigationNodeRestService=i.get(r.NAVIGATION_MANAGEMENT_RESOURCE_URI)}getNavigationNode(e,t){const i=Object.assign({identifier:e},t);return this.navigationNodeRestService.get(i)}updateNavigationNodePosition(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.cmsitemsRestService.getById(e.parent.uuid);t.children=t.children||[];const i=t.children.findIndex((t=>t===e.uuid));const o=e.position;if(i<0||e.position===undefined){throw new Error(`navigationEditorNodeService.updateNavigationNodePosition() - invalid index: move FROM [${i}] TO [${o}]`)}t.children.splice(o,0,t.children.splice(i,1)[0]);t.identifier=t.uuid;return this.cmsitemsRestService.update(t)}))}getNavigationNodeAncestry(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=Object.assign({ancestorTrailFrom:e},t);const o=yield this.navigationNodeRestService.get(i);return this.nodeAncestryService.buildOrderedListOfAncestors(l.apiUtils.getDataFromResponse(o),e)}))}};Ko=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.CmsitemsRestService,$o,l.IRestServiceFactory])],Ko);window.__smartedit__.addDecoratorPayload("Component","BreadcrumbComponent",{selector:"se-breadcrumb",template:`<div class="se-breadcrumb"><div *ngFor="let node of breadcrumb; index as idx; last as isLast" class="se-breadcrumb__node"><div class="se-breadcrumb__info" [ngClass]="{'se-breadcrumb__info--last': isLast}"><span class="se-breadcrumb__info--level">{{ node.formattedLevel | translate: node }}</span> <span class="se-breadcrumb__info--name">{{ node.name }}</span></div><div class="se-breadcrumb__divider" *ngIf="idx < breadcrumb.length - 1"><span class="sap-icon--navigation-right-arrow"></span></div></div></div>`,styles:[`.se-breadcrumb{border-bottom:1px solid var(--sapBaseColor);margin-bottom:35px}.se-breadcrumb__divider,.se-breadcrumb__info,.se-breadcrumb__node{display:inline-block}.se-breadcrumb__info--last{border-bottom:3px solid var(--sapInformationBorderColor);padding-top:10px;padding-bottom:10px}.se-breadcrumb__info--level{display:block;text-transform:uppercase;color:var(--sapNeutralTextColor);font-family:"72","72full",Arial,Helvetica,sans-serif;font-size:.75rem!important;line-height:1.3333333333;font-weight:400;font-weight:700}.se-breadcrumb__info--name{display:block;color:var(--sapNeutralTextColor);font-family:"72","72full",Arial,Helvetica,sans-serif;font-size:.875rem!important;line-height:1.4285714286;font-weight:400;font-weight:400}.se-breadcrumb__divider{margin-left:15px;margin-right:15px;margin-top:5px;vertical-align:top}.se-breadcrumb__node:last-child .se-breadcrumb__info--level,.se-breadcrumb__node:last-child .se-breadcrumb__info--name{color:var(--sapInformativeColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None});let qo=class BreadcrumbComponent{constructor(e,t,i){this.navigationEditorNodeService=e;this.cmsitemsRestService=t;this.cdr=i}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){if(!this.nodeUid&&!this.nodeUuid){throw new Error("BreadcrumbComponent requires either nodeUid or nodeUuid")}const e=yield this.getUid();const t=yield this.navigationEditorNodeService.getNavigationNodeAncestry(e,this.uriContext);this.breadcrumb=t;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}getUid(){return __awaiter(this,void 0,void 0,(function*(){if(!this.nodeUid){const e=yield this.cmsitemsRestService.getById(this.nodeUuid);return e.uid}return this.nodeUid}))}};__decorate([n.Input(),__metadata("design:type",String)],qo.prototype,"nodeUid",void 0);__decorate([n.Input(),__metadata("design:type",String)],qo.prototype,"nodeUuid",void 0);__decorate([n.Input(),__metadata("design:type",Object)],qo.prototype,"uriContext",void 0);qo=__decorate([n.Component({selector:"se-breadcrumb",template:`<div class="se-breadcrumb"><div *ngFor="let node of breadcrumb; index as idx; last as isLast" class="se-breadcrumb__node"><div class="se-breadcrumb__info" [ngClass]="{'se-breadcrumb__info--last': isLast}"><span class="se-breadcrumb__info--level">{{ node.formattedLevel | translate: node }}</span> <span class="se-breadcrumb__info--name">{{ node.name }}</span></div><div class="se-breadcrumb__divider" *ngIf="idx < breadcrumb.length - 1"><span class="sap-icon--navigation-right-arrow"></span></div></div></div>`,styles:[`.se-breadcrumb{border-bottom:1px solid var(--sapBaseColor);margin-bottom:35px}.se-breadcrumb__divider,.se-breadcrumb__info,.se-breadcrumb__node{display:inline-block}.se-breadcrumb__info--last{border-bottom:3px solid var(--sapInformationBorderColor);padding-top:10px;padding-bottom:10px}.se-breadcrumb__info--level{display:block;text-transform:uppercase;color:var(--sapNeutralTextColor);font-family:"72","72full",Arial,Helvetica,sans-serif;font-size:.75rem!important;line-height:1.3333333333;font-weight:400;font-weight:700}.se-breadcrumb__info--name{display:block;color:var(--sapNeutralTextColor);font-family:"72","72full",Arial,Helvetica,sans-serif;font-size:.875rem!important;line-height:1.4285714286;font-weight:400;font-weight:400}.se-breadcrumb__divider{margin-left:15px;margin-right:15px;margin-top:5px;vertical-align:top}.se-breadcrumb__node:last-child .se-breadcrumb__info--level,.se-breadcrumb__node:last-child .se-breadcrumb__info--name{color:var(--sapInformativeColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),__metadata("design:paramtypes",[Ko,l.CmsitemsRestService,n.ChangeDetectorRef])],qo);const Yo="selected_node";window.__smartedit__.addDecoratorPayload("Component","NavigationNodePickerRenderComponent",{selector:"se-navigation-node-picker-render",template:`<div class="se-tree-node__name col-xs-6" [title]="node.name | seL10n | async"><span>{{ node.name | seL10n | async }}</span></div><div class="col-sm-4 pull-right tree-node se-navigation-picker-renderer" (click)="pick(node)" *ngIf="isEditable()"><a translate="se.cms.navigationcomponent.management.node.selection.select.action" class="btn btn-link se-navigation-picker-renderer__btn"></a></div>`});let Zo=class NavigationNodePickerRenderComponent{constructor(e,t){this.parent=e;this.node=t}ngOnInit(){({pick:this.pick,isEditable:this.isEditable}=this.parent.nodeActions)}};Zo=__decorate([n.Component({selector:"se-navigation-node-picker-render",template:`<div class="se-tree-node__name col-xs-6" [title]="node.name | seL10n | async"><span>{{ node.name | seL10n | async }}</span></div><div class="col-sm-4 pull-right tree-node se-navigation-picker-renderer" (click)="pick(node)" *ngIf="isEditable()"><a translate="se.cms.navigationcomponent.management.node.selection.select.action" class="btn btn-link se-navigation-picker-renderer__btn"></a></div>`}),__param(0,n.Inject(n.forwardRef((()=>l.TreeComponent)))),__param(1,n.Inject(l.TREE_NODE)),__metadata("design:paramtypes",[l.TreeComponent,Object])],Zo);window.__smartedit__.addDecoratorPayload("Component","NavigationNodePickerComponent",{selector:"se-navigation-node-picker",template:`<div class="categoryTable"><div class="tablehead clearfix hidden-xs se-navigation-editor-tree__head"><div translate="se.ytree.template.header.name" class="se-navigation-editor-tree__name col-md-offset-1 col-sm-5"></div></div><se-tree [nodeUri]="nodeURI" [rootNodeUid]="rootNodeUid" [nodeComponent]="nodePickerRenderComponent" [removeDefaultTemplate]="removeDefaultTemplate" [nodeActions]="actions"></se-tree></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let Xo=class NavigationNodePickerComponent{constructor(e,t){this.cmsitemsRestService=e;this.systemEventService=t;this.nodePickerRenderComponent=Zo;this.removeDefaultTemplate=true;this.rootNodeUid=r.NAVIGATION_NODE_ROOT_NODE_UID;this.editable=true}ngOnInit(){this.nodeURI=new l.URIBuilder(r.NAVIGATION_MANAGEMENT_RESOURCE_URI).replaceParams(this.uriContext).build();this.actions={pick:(e,t)=>__awaiter(this,void 0,void 0,(function*(){const e={pageSize:10,currentPage:0,mask:t.uid,typeCode:"CMSNavigationNode",itemSearchParams:""};const i=yield this.cmsitemsRestService.get(e);const o=i.response.find((e=>e.uid===t.uid));const n={nodeUuid:o===null||o===void 0?void 0:o.uuid,nodeUid:t.uid};this.systemEventService.publishAsync(Yo,n)})),isEditable:()=>this.editable}}};__decorate([n.Input(),__metadata("design:type",Object)],Xo.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],Xo.prototype,"editable",void 0);Xo=__decorate([n.Component({selector:"se-navigation-node-picker",template:`<div class="categoryTable"><div class="tablehead clearfix hidden-xs se-navigation-editor-tree__head"><div translate="se.ytree.template.header.name" class="se-navigation-editor-tree__name col-md-offset-1 col-sm-5"></div></div><se-tree [nodeUri]="nodeURI" [rootNodeUid]="rootNodeUid" [nodeComponent]="nodePickerRenderComponent" [removeDefaultTemplate]="removeDefaultTemplate" [nodeActions]="actions"></se-tree></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.CmsitemsRestService,l.SystemEventService])],Xo);window.__smartedit__.addDecoratorPayload("Component","NavigationNodeSelectorComponent",{selector:"se-navigation-node-selector",template:`<div *ngIf="isReady"><div *ngIf="cmsItem[qualifier]" class="se-navigation-mode"><div class="se-navigation__node"><se-breadcrumb class="se-navigation__node-breadcrumb" [nodeUuid]="cmsItem[qualifier]" [uriContext]="uriContext"></se-breadcrumb><div class="se-navigation__node-button"><button class="btn btn-link btn-block se-navigation__button" (click)="remove($event)" [disabled]="!field.editable" translate="se.cms.navigationcomponent.management.node.selection.remove.action"></button></div></div><se-navigation-editor-tree [uriContext]="uriContext" [readOnly]="true" [rootNodeUid]="nodeUid"></se-navigation-editor-tree></div><div *ngIf="!cmsItem[qualifier]"><label translate="se.cms.navigationcomponent.management.node.selection.invite.action"></label><se-navigation-node-picker [uriContext]="uriContext" [editable]="field.editable"></se-navigation-node-picker></div></div>`,styles:[`.se-navigation__node{display:flex;background-color:var(--sapLegend_WorkingBackground);padding:0 20px;margin:0 -20px 20px -20px;border-top:1px solid var(--sapBaseColor);border-bottom:1px solid var(--sapBaseColor)}.se-navigation__node-breadcrumb{flex:10}.se-navigation__node-breadcrumb .se-breadcrumb{margin-bottom:0;border:none}.se-navigation__node-button{flex:2;display:flex}.se-navigation__button{font-size:15px;font-family:"72","72full",Arial,Helvetica,sans-serif;font-weight:700;align-self:flex-end;text-transform:capitalize}se-navigation-node-selector .se-navigation-editor-tree{margin:0}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None});let Qo=class NavigationNodeSelectorComponent{constructor(e,t,i,o,n){this.data=e;this.catalogService=t;this.cmsitemsRestService=i;this.systemEventService=o;this.cdr=n;this.isReady=false;this.nodeUid=null;this.uriContext=null;({field:this.field,model:this.cmsItem,qualifier:this.qualifier}=this.data)}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.retrieveUriContext();this.uriContext=e;if(this.cmsItem[this.qualifier]){const e=yield this.cmsitemsRestService.getById(this.cmsItem[this.qualifier]);this.nodeUid=e.uid;this.isReady=true}else{this.isReady=true}this.unregisterSubscription=this.systemEventService.subscribe(Yo,((e,{nodeUid:t,nodeUuid:i})=>{this.nodeUid=t;this.cmsItem[this.qualifier]=i;if(!this.cdr.destroyed){this.cdr.detectChanges()}}));if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnDestroy(){this.unregisterSubscription()}remove(){delete this.cmsItem[this.qualifier];if(!this.cdr.destroyed){this.cdr.detectChanges()}}};Qo=__decorate([n.Component({selector:"se-navigation-node-selector",template:`<div *ngIf="isReady"><div *ngIf="cmsItem[qualifier]" class="se-navigation-mode"><div class="se-navigation__node"><se-breadcrumb class="se-navigation__node-breadcrumb" [nodeUuid]="cmsItem[qualifier]" [uriContext]="uriContext"></se-breadcrumb><div class="se-navigation__node-button"><button class="btn btn-link btn-block se-navigation__button" (click)="remove($event)" [disabled]="!field.editable" translate="se.cms.navigationcomponent.management.node.selection.remove.action"></button></div></div><se-navigation-editor-tree [uriContext]="uriContext" [readOnly]="true" [rootNodeUid]="nodeUid"></se-navigation-editor-tree></div><div *ngIf="!cmsItem[qualifier]"><label translate="se.cms.navigationcomponent.management.node.selection.invite.action"></label><se-navigation-node-picker [uriContext]="uriContext" [editable]="field.editable"></se-navigation-node-picker></div></div>`,styles:[`.se-navigation__node{display:flex;background-color:var(--sapLegend_WorkingBackground);padding:0 20px;margin:0 -20px 20px -20px;border-top:1px solid var(--sapBaseColor);border-bottom:1px solid var(--sapBaseColor)}.se-navigation__node-breadcrumb{flex:10}.se-navigation__node-breadcrumb .se-breadcrumb{margin-bottom:0;border:none}.se-navigation__node-button{flex:2;display:flex}.se-navigation__button{font-size:15px;font-family:"72","72full",Arial,Helvetica,sans-serif;font-weight:700;align-self:flex-end;text-transform:capitalize}se-navigation-node-selector .se-navigation-editor-tree{margin:0}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,l.ICatalogService,l.CmsitemsRestService,l.SystemEventService,n.ChangeDetectorRef])],Qo);window.__smartedit__.addDecoratorPayload("Component","NavigationEditorLinkComponent",{selector:"se-navigation-editor-link",template:`\n        <div class="nav-management-link-container">\n            <a\n                class="fd-link nav-management-link-item__link se-catalog-version__link"\n                [href]="getLink()"\n                translate="se.cms.cataloginfo.navigationmanagement"\n                (click)="onClick()"></a>\n        </div>\n    `});let Jo=class NavigationEditorLinkComponent{constructor(e,t){this.catalogDetails=e;this.userTrackingService=t}getLink(){const{siteId:e,catalog:{catalogId:t},catalogVersion:{version:i}}=this.catalogDetails;return`#/navigations/${e}/${t}/${i}`}onClick(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION,this.catalogDetails.catalogVersion+" - Navigation")}};Jo=__decorate([n.Component({selector:"se-navigation-editor-link",template:`\n        <div class="nav-management-link-container">\n            <a\n                class="fd-link nav-management-link-item__link se-catalog-version__link"\n                [href]="getLink()"\n                translate="se.cms.cataloginfo.navigationmanagement"\n                (click)="onClick()"></a>\n        </div>\n    `}),__param(0,n.Inject(l.CATALOG_DETAILS_ITEM_DATA)),__metadata("design:paramtypes",[Object,l.IUserTrackingService])],Jo);window.__smartedit__.addDecoratorPayload("Component","NavigationManagementPageComponent",{selector:"se-navigation-management-page",template:`<div class="se-navigation-management-page-list-template"><div class="se-toolbar-group"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar><se-toolbar cssClass="se-toolbar--shell se-toolbar--shortcut" imageRoot="imageRoot" toolbarName="smartEditNavigationToolbar"></se-toolbar></div><div class="se-navigation-editor-wrapper" *ngIf="readOnly !== undefined"><div class="se-navigation-editor-header"><h2 class="se-navigation-editor-header__title" translate="se.cms.navigationmanagement.title"></h2><h4 class="se-navigation-editor-header__sub-title">{{ catalogName | seL10n | async }} - {{ catalogVersion }}</h4></div><se-navigation-editor-tree [uriContext]="uriContext" [readOnly]="readOnly"></se-navigation-editor-tree></div></div>`,styles:[`.se-navigation-editor-wrapper{min-height:100vh;padding:90px 30px 30px 30px;background-color:var(--sapShell_Background)}.se-navigation-editor-header{position:relative;min-height:100%;background-color:var(--sapBaseColor);font-family:"72","72full",Arial,Helvetica,sans-serif;margin:0 -30px 20px -30px;padding:16px 30px;-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-navigation-editor-header__title{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapTitleColor);margin:0;padding:0;font-weight:800;font-size:2rem!important}.se-navigation-editor-header__sub-title{font-size:.875rem!important;line-height:1.4285714286;font-weight:400;font-size:.875rem;color:var(--sapField_PlaceholderTextColor);margin:0;padding:5px 0 0 0}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let en=class NavigationManagementPageComponent{constructor(e,t,i,o,n){this.activatedRoute=e;this.urlService=t;this.permissionService=i;this.catalogService=o;this.cdr=n}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const{siteId:e,catalogId:t,catalogVersion:i}=this.activatedRoute.snapshot.params;this.catalogVersion=i;this.uriContext=this.urlService.buildUriContext(e,t,i);yield Promise.all([this.setCatalogName(e,t),this.setReadOnly()]);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}setCatalogName(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.catalogService.getContentCatalogsForSite(e);const o=i.find((e=>e.catalogId===t));this.catalogName=(o===null||o===void 0?void 0:o.name)||{}}))}setReadOnly(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.permissionService.isPermitted([{names:["se.edit.navigation"]}]);this.readOnly=!e}))}};en=__decorate([n.Component({selector:"se-navigation-management-page",template:`<div class="se-navigation-management-page-list-template"><div class="se-toolbar-group"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar><se-toolbar cssClass="se-toolbar--shell se-toolbar--shortcut" imageRoot="imageRoot" toolbarName="smartEditNavigationToolbar"></se-toolbar></div><div class="se-navigation-editor-wrapper" *ngIf="readOnly !== undefined"><div class="se-navigation-editor-header"><h2 class="se-navigation-editor-header__title" translate="se.cms.navigationmanagement.title"></h2><h4 class="se-navigation-editor-header__sub-title">{{ catalogName | seL10n | async }} - {{ catalogVersion }}</h4></div><se-navigation-editor-tree [uriContext]="uriContext" [readOnly]="readOnly"></se-navigation-editor-tree></div></div>`,styles:[`.se-navigation-editor-wrapper{min-height:100vh;padding:90px 30px 30px 30px;background-color:var(--sapShell_Background)}.se-navigation-editor-header{position:relative;min-height:100%;background-color:var(--sapBaseColor);font-family:"72","72full",Arial,Helvetica,sans-serif;margin:0 -30px 20px -30px;padding:16px 30px;-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-navigation-editor-header__title{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapTitleColor);margin:0;padding:0;font-weight:800;font-size:2rem!important}.se-navigation-editor-header__sub-title{font-size:.875rem!important;line-height:1.4285714286;font-weight:400;font-size:.875rem;color:var(--sapField_PlaceholderTextColor);margin:0;padding:5px 0 0 0}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[b.ActivatedRoute,l.IUrlService,l.IPermissionService,l.ICatalogService,n.ChangeDetectorRef])],en);let tn=class NavigationNodeEditorModalService{constructor(e,t){this.genericEditorModalService=e;this.catalogService=t}open(e,t,i){return __awaiter(this,void 0,void 0,(function*(){let o=null;if(!i){const i=yield this.catalogService.getCatalogVersionUUid(e);o={catalogVersion:i,parent:t.uuid,itemtype:r.NAVIGATION_NODE_TYPECODE,visible:true}}return this.genericEditorModalService.open({componentUuid:i?i.uuid:null,componentType:r.NAVIGATION_NODE_TYPECODE,content:o,title:"se.cms.navigationmanagement.node.edit.title"},(e=>e),null,{dialogPanelClass:"modal-stretched"})}))}};tn=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.GenericEditorModalService,l.ICatalogService])],tn);var on;let nn=on=class NavigationEditorTreeActions{constructor(e,t,i,o,n,s){this.logService=e;this.cmsitemsRestService=t;this.confirmationModalService=i;this.navigationEditorNodeService=o;this.navigationNodeEditorModalService=n;this.userTrackingService=s}setup(e,t,i){this.readOnly=e;this.rootNodeUid=t;this.uriContext=i}getActions(){return{isReadOnly:()=>this.isReadOnly(),hasChildren:(e,t)=>this.hasChildren(e,t),fetchData:(e,t)=>this.fetchData(e,t),removeItem:(e,t)=>this.removeItem(e,t),performMove:(e,t,i)=>this.performMove(e,t,i),dragAndDrop:(e,t)=>this.dragAndDrop(e,t),moveUp:(e,t)=>this.moveUp(e,t),moveDown:(e,t)=>this.moveDown(e,t),isMoveUpAllowed:(e,t)=>this.isMoveUpAllowed(e,t),isMoveDownAllowed:(e,t)=>this.isMoveDownAllowed(e,t),refreshNode:(e,t)=>this.refreshNode(e,t),refreshParentNode:(e,t)=>this.refreshParentNode(e,t),editNavigationNode:(e,t)=>this.editNavigationNode(e,t),addTopLevelNode:(e,t)=>this.addTopLevelNode(e,t),getEntryString:(e,t)=>this.getEntryString(e,t),getEntryTooltipString:(e,t)=>this.getEntryTooltipString(e,t),addNewChild:(e,t)=>this.addNewChild(e,t),addNewSibling:(e,t)=>this.addNewSibling(e,t),getDropdownItems:e=>this.getDropdownItems(e),_findNodeById:(e,t)=>this._findNodeById(e,t),_expandIfNeeded:(e,t)=>this._expandIfNeeded(e,t)}}getNavigationNodeCMSItemByUid(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.cmsitemsRestService.get({typeCode:r.NAVIGATION_NODE_TYPECODE,pageSize:1,currentPage:0,itemSearchParams:"uid:"+e});return t.response[0]}))}hasNotMoved(e,t,i){return e.position===t&&e.parentUid===i.uid}getEntriesCommaSeparated(e){return e.map((e=>`${e.name} (${e.itemType})`)).join(", ")}isReadOnly(){return this.readOnly}hasChildren(e,t){return t.hasChildren}fetchData(e,t){return __awaiter(this,void 0,void 0,(function*(){if(t.initiated){return t.nodes}if(t.uid===r.NAVIGATION_NODE_ROOT_NODE_UID){t.initiated=false;const e=yield this.getNavigationNodeCMSItemByUid(this.rootNodeUid);p.assign(t,e)}t.removeAllNodes();return e.fetchChildren(t)}))}removeItem(e,t){return __awaiter(this,void 0,void 0,(function*(){if(this.readOnly){throw on.READY_ONLY_ERROR_I18N}this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION_MANAGEMENT,"Delete");let i=true;try{yield this.confirmationModalService.confirm({description:"se.cms.navigationmanagement.navnode.removenode.confirmation.message",title:"se.cms.navigationmanagement.navnode.removenode.confirmation.title"})}catch(e){i=false}if(i){yield this.cmsitemsRestService.delete(t.uuid);this.refreshParentNode(e,t)}}))}performMove(e,t,i){return __awaiter(this,void 0,void 0,(function*(){if(this.readOnly){throw on.READY_ONLY_ERROR_I18N}try{yield this.navigationEditorNodeService.updateNavigationNodePosition(t);if(!t){yield this.fetchData(e,e.root)}else if(i){yield this.refreshNode(e,t)}else{yield this.refreshParentNode(e,t)}}catch(e){this.logService.error(`Error updating node position:\n${e}`)}}))}dragAndDrop(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=t.sourceNode;const o=t.destinationNodes;const n=o.find((e=>e.uid!==i.uid));if(!n){return}const s=n.parent;if(this.hasNotMoved(i,t.position,s)){return}i.position=t.position;i.setParent(s);yield this.performMove(e,i,true);if(t.sourceParentNode.uid!==t.destinationParentNode.uid){this.refreshNode(e,t.sourceParentNode)}}))}moveUp(e,t){if(this.readOnly){throw on.READY_ONLY_ERROR_I18N}this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION_MANAGEMENT,"Move Up");t.position=t.position-1;return this.performMove(e,t)}moveDown(e,t){if(this.readOnly){throw on.READY_ONLY_ERROR_I18N}this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION_MANAGEMENT,"Move Down");t.position=t.position+1;return this.performMove(e,t)}isMoveUpAllowed(e,t){return t.position!==0}isMoveDownAllowed(e,t){t.parent.nodes=t.parent.nodes||[];return t.position<t.parent.nodes.length-1}refreshNode(e,t){t.setInitiated(false);return e.fetchChildren(t)}refreshParentNode(e,t){return this.refreshNode(e,t.parent)}editNavigationNode(e,t){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION_MANAGEMENT,"Edit");try{yield this.navigationNodeEditorModalService.open(this.uriContext,t.parent,t);yield this.refreshNode(e,t.parent);let i;if(t.parent.uid===r.NAVIGATION_NODE_ROOT_NODE_UID){i=t}else{i=t.parent}const o=yield this.navigationEditorNodeService.getNavigationNode(i.uid,this.uriContext);p.assign(i,o);if(t.parent.uid===r.NAVIGATION_NODE_ROOT_NODE_UID){return this.refreshNode(e,t)}return this.refreshParentNode(e,t)}catch(e){this.logService.warn("navigationNodeEditorModalService closed when editing navigation node");return null}}))}addTopLevelNode(e,t){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION_MANAGEMENT,"Create Top Level");const i=!!(yield this.addNewChild(e,t));if(i){const t=yield this.getNavigationNodeCMSItemByUid(this.rootNodeUid);yield this.fetchData(e,t)}}))}getEntryString(e,t){return this.getEntriesCommaSeparated(t.entries||[])}getEntryTooltipString(e,t){return["<div>",...(t.entries||[]).map((e=>`<div>${e.name} (${e.itemType})</div>`)),"</div>"].join("")}addNewChild(e,t){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION_MANAGEMENT,"Add a Child");const i=t?t:this._findNodeById(e,this.rootNodeUid);yield this._expandIfNeeded(e,t);try{yield this.navigationNodeEditorModalService.open(this.uriContext,i);return this.refreshNode(e,i)}catch(e){this.logService.warn("navigationNodeEditorModalService closed when adding new child");return null}}))}addNewSibling(e,t){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.NAVIGATION_MANAGEMENT,"Add a Sibling");const i=t.parent;try{yield this.navigationNodeEditorModalService.open(this.uriContext,i);return this.refreshNode(e,i)}catch(e){this.logService.warn("navigationNodeEditorModalService closed when adding new sibling");return null}}))}getDropdownItems(e){return[{key:"se.cms.navigationmanagement.navnode.edit",callback:t=>{this.editNavigationNode(e,t)}},{key:"se.cms.navigationmanagement.navnode.removenode",customCss:"se-dropdown-item__delete",callback:t=>{this.removeItem(e,t)}},{key:"se.cms.navigationmanagement.navnode.move.up",condition:t=>this.isMoveUpAllowed(e,t),callback:t=>{this.moveUp(e,t)}},{key:"se.cms.navigationmanagement.navnode.move.down",condition:t=>this.isMoveDownAllowed(e,t),callback:t=>{this.moveDown(e,t)}},{key:"se.cms.navigationmanagement.navnode.addchild",callback:t=>{this.addNewChild(e,t)}},{key:"se.cms.navigationmanagement.navnode.addsibling",callback:t=>{this.addNewSibling(e,t)}}]}_findNodeById(e,t){return e.getNodeById(t)}_expandIfNeeded(e,t){return t&&!t.isExpanded?e.toggle(t):Promise.resolve()}};nn.READY_ONLY_ERROR_I18N="navigation.in.readonly.mode";__decorate([l.InvalidateCache(l.cmsitemsEvictionTag),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],nn.prototype,"getNavigationNodeCMSItemByUid",null);nn=on=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.LogService,l.CmsitemsRestService,l.IConfirmationModalService,Ko,tn,l.IUserTrackingService])],nn);let sn=class NavigationEditorTreeDragOptions{setup(e){this.dragAndDropHandler=e}getDragOptions(){return{onDropCallback:e=>this.onDropCallback(e),allowDropCallback:this.allowDropCallback,beforeDropCallback:this.beforeDropCallback}}onDropCallback(e){this.dragAndDropHandler(e)}allowDropCallback(e){return e.sourceNode.parent.uid===e.destinationNodes[0].parent.uid}beforeDropCallback(e){if(e.sourceNode.parent.uid!==e.destinationNodes[0].parent.uid){return Promise.resolve({confirmDropI18nKey:"se.cms.navigationmanagement.navnode.confirmation"})}return Promise.resolve(true)}};sn=__decorate([n.Injectable()],sn);window.__smartedit__.addDecoratorPayload("Component","NavigationNodeComponent",{selector:"se-navigation-node",template:`<div class="se-tree-node__name col-xs-left col-xs-4" [title]="node.name | seL10n | async"><span>{{ node.name | seL10n | async }}</span></div><div class="se-tree-node__title col-xs-left col-xs-3"><span class="se-tree-node__span" [hidden]="!node.title">{{ node.title | seL10n | async }}</span></div><div class="se-tree-node__entry col-xs-left col-xs-3"><se-tooltip class="se-dropdown-item__delete-page-popover" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true"><span se-tooltip-trigger class="se-tree-node__popover"><span>{{ entryString }} </span></span><span se-tooltip-body>{{ entryString }}</span></se-tooltip></div><div class="pull-right dropdown se-tree-node__actions col-xs-right col-sm-1 col-xs-1" [hidden]="isReadOnly"><se-dropdown-menu [dropdownItems]="dropdownItems" [selectedItem]="node" class="pull-right se-tree-node__actions"></se-dropdown-menu></div>`,styles:[`se-navigation-node .se-dropdown-item__delete-page-popover,se-navigation-node .se-dropdown-item__delete-page-popover .se-tooltip{max-width:100%}.col-xs-left{padding-left:0}.col-xs-right{padding-right:30px!important}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let an=class NavigationNodeComponent{constructor(e,t){this.parent=e;this.node=t;this.dropdownItems=[]}ngOnInit(){const{getDropdownItems:e,isReadOnly:t,getEntryString:i}=this.parent.nodeActions;this.dropdownItems=e();this.isReadOnly=t();this.entryString=i(this.node)}};an=__decorate([n.Component({selector:"se-navigation-node",template:`<div class="se-tree-node__name col-xs-left col-xs-4" [title]="node.name | seL10n | async"><span>{{ node.name | seL10n | async }}</span></div><div class="se-tree-node__title col-xs-left col-xs-3"><span class="se-tree-node__span" [hidden]="!node.title">{{ node.title | seL10n | async }}</span></div><div class="se-tree-node__entry col-xs-left col-xs-3"><se-tooltip class="se-dropdown-item__delete-page-popover" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true"><span se-tooltip-trigger class="se-tree-node__popover"><span>{{ entryString }} </span></span><span se-tooltip-body>{{ entryString }}</span></se-tooltip></div><div class="pull-right dropdown se-tree-node__actions col-xs-right col-sm-1 col-xs-1" [hidden]="isReadOnly"><se-dropdown-menu [dropdownItems]="dropdownItems" [selectedItem]="node" class="pull-right se-tree-node__actions"></se-dropdown-menu></div>`,styles:[`se-navigation-node .se-dropdown-item__delete-page-popover,se-navigation-node .se-dropdown-item__delete-page-popover .se-tooltip{max-width:100%}.col-xs-left{padding-left:0}.col-xs-right{padding-right:30px!important}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(n.forwardRef((()=>l.TreeComponent)))),__param(1,n.Inject(l.TREE_NODE)),__metadata("design:paramtypes",[l.TreeComponent,Object])],an);window.__smartedit__.addDecoratorPayload("Component","NavigationEditorTreeComponent",{selector:"se-navigation-editor-tree",template:`<div class="se-navigation-editor-tree__header" *ngIf="!readOnly"><div class="se-navigation-editor-tree-header"><h1 class="se-navigation-editor-tree-header__title" translate="se.cms.navigationmanagement.tree.title"></h1></div><button fd-button class="se-navigation-editor-tree__btn" (click)="actions.addTopLevelNode()"><span [translate]="'se.cms.navigationmanagement.add.top.level.node'" class="se-navigation-editor-tree__btn--text"></span></button></div><div class="se-navigation-editor-tree categoryTable"><div class="tablehead clearfix hidden-xs se-navigation-editor-tree__head"><div [translate]="'se.ytree.template.header.name'" class="se-navigation-editor-tree__name col-xs-4"></div><div [translate]="'se.ytree.template.header.title'" class="se-navigation-editor-tree__title col-xs-right col-xs-4"></div><div [translate]="'se.ytree.template.header.entry'" class="se-navigation-editor-tree__entry col-xs-2"></div><div *ngIf="!readOnly" [translate]="'se.ytree.template.header.action'" class="se-navigation-editor-tree__action col-xs-right"></div></div><se-tree [nodeUri]="nodeURI" [rootNodeUid]="rootNodeUid" [nodeComponent]="nodeComponent" [removeDefaultTemplate]="true" [nodeActions]="actions" [dragOptions]="dragOptions"></se-tree></div>`,styles:[`.se-navigation-editor-tree__header{height:55px;width:100%;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0;background-color:var(--sapBaseColor);display:flex;align-items:center;justify-content:flex-end;padding-right:1rem}.se-navigation-editor-tree__name{padding-left:45px}.se-navigation-editor-tree__name.col-md-offset-1{margin-left:0}.se-navigation-editor-tree__title{padding-left:60px}.se-navigation-editor-tree__action{max-width:20%;float:right;padding-right:15px}.tablehead.se-navigation-editor-tree__head{border-top:1px solid var(--sapNeutralBackground);background-color:var(--sapList_FooterBackground);font-size:.875rem!important;line-height:1.4285714286;font-weight:400;font-family:"72","72full",Arial,Helvetica,sans-serif;color:var(--sapNeutralColor);height:40px;padding:10px 0}.fd-dialog__body .se-navigation-editor-tree__title{width:17%;padding-left:4px}.fd-dialog__body .se-navigation-editor-tree__entry{width:155px;padding-left:20px}.fd-dialog__body .se-navigation-editor-tree__name{width:50%;padding-left:55px}.fd-dialog__body .se-navigation-editor-tree__head{margin:0 -20px 0 -20px;padding-left:20px;padding-right:20px}.se-navigation-editor-tree__btn{margin-right:1rem}.se-navigation-editor-tree-header{flex:auto;padding:20px 45px;font-family:"72","72full",Arial,Helvetica,sans-serif}.se-navigation-editor-tree-header__title{font-size:1.125rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapTextColor);margin:0;padding:0}`],providers:[sn,nn],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None});let rn=class NavigationEditorTreeComponent{constructor(e,t){this.dragOptionsService=e;this.actionsService=t;this.nodeComponent=an}ngOnInit(){this.nodeURI=new l.URIBuilder(r.NAVIGATION_MANAGEMENT_RESOURCE_URI).replaceParams(this.uriContext).build();this.rootNodeUid=this.rootNodeUid||r.NAVIGATION_NODE_ROOT_NODE_UID;this.actionsService.setup(this.readOnly,this.rootNodeUid,this.uriContext);this.actions=this.actionsService.getActions();if(!this.readOnly){this.dragOptionsService.setup((e=>{this.actions.dragAndDrop(e)}));this.dragOptions=this.dragOptionsService.getDragOptions()}}};__decorate([n.Input(),__metadata("design:type",Object)],rn.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],rn.prototype,"readOnly",void 0);__decorate([n.Input(),__metadata("design:type",String)],rn.prototype,"rootNodeUid",void 0);rn=__decorate([n.Component({selector:"se-navigation-editor-tree",template:`<div class="se-navigation-editor-tree__header" *ngIf="!readOnly"><div class="se-navigation-editor-tree-header"><h1 class="se-navigation-editor-tree-header__title" translate="se.cms.navigationmanagement.tree.title"></h1></div><button fd-button class="se-navigation-editor-tree__btn" (click)="actions.addTopLevelNode()"><span [translate]="'se.cms.navigationmanagement.add.top.level.node'" class="se-navigation-editor-tree__btn--text"></span></button></div><div class="se-navigation-editor-tree categoryTable"><div class="tablehead clearfix hidden-xs se-navigation-editor-tree__head"><div [translate]="'se.ytree.template.header.name'" class="se-navigation-editor-tree__name col-xs-4"></div><div [translate]="'se.ytree.template.header.title'" class="se-navigation-editor-tree__title col-xs-right col-xs-4"></div><div [translate]="'se.ytree.template.header.entry'" class="se-navigation-editor-tree__entry col-xs-2"></div><div *ngIf="!readOnly" [translate]="'se.ytree.template.header.action'" class="se-navigation-editor-tree__action col-xs-right"></div></div><se-tree [nodeUri]="nodeURI" [rootNodeUid]="rootNodeUid" [nodeComponent]="nodeComponent" [removeDefaultTemplate]="true" [nodeActions]="actions" [dragOptions]="dragOptions"></se-tree></div>`,styles:[`.se-navigation-editor-tree__header{height:55px;width:100%;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0;background-color:var(--sapBaseColor);display:flex;align-items:center;justify-content:flex-end;padding-right:1rem}.se-navigation-editor-tree__name{padding-left:45px}.se-navigation-editor-tree__name.col-md-offset-1{margin-left:0}.se-navigation-editor-tree__title{padding-left:60px}.se-navigation-editor-tree__action{max-width:20%;float:right;padding-right:15px}.tablehead.se-navigation-editor-tree__head{border-top:1px solid var(--sapNeutralBackground);background-color:var(--sapList_FooterBackground);font-size:.875rem!important;line-height:1.4285714286;font-weight:400;font-family:"72","72full",Arial,Helvetica,sans-serif;color:var(--sapNeutralColor);height:40px;padding:10px 0}.fd-dialog__body .se-navigation-editor-tree__title{width:17%;padding-left:4px}.fd-dialog__body .se-navigation-editor-tree__entry{width:155px;padding-left:20px}.fd-dialog__body .se-navigation-editor-tree__name{width:50%;padding-left:55px}.fd-dialog__body .se-navigation-editor-tree__head{margin:0 -20px 0 -20px;padding-left:20px;padding-right:20px}.se-navigation-editor-tree__btn{margin-right:1rem}.se-navigation-editor-tree-header{flex:auto;padding:20px 45px;font-family:"72","72full",Arial,Helvetica,sans-serif}.se-navigation-editor-tree-header__title{font-size:1.125rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapTextColor);margin:0;padding:0}`],providers:[sn,nn],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),__metadata("design:paramtypes",[sn,nn])],rn);let ln=class NavigationModule{};ln=__decorate([n.NgModule({imports:[g.CommonModule,l.DropdownMenuModule,l.L10nPipeModule,l.TranslationModule.forChild(),l.NgTreeModule,l.TooltipModule,_.ToolbarModule,u.ButtonModule],declarations:[rn,an,Jo,qo,Xo,Zo,Qo,en],entryComponents:[rn,an,Jo,qo,Xo,Zo,Qo],exports:[rn],providers:[$o,Ko,tn]})],ln);var cn;(function(e){e["content"]="content";e["product"]="product";e["category"]="category";e["external"]="external"})(cn||(cn={}));const dn=[{id:cn.content,structureApiMode:"CONTENT"},{id:cn.product,structureApiMode:"PRODUCT",hasCatalog:true},{id:cn.category,structureApiMode:"CATEGORY",hasCatalog:true},{id:cn.external,structureApiMode:"EXTERNAL"}];window.__smartedit__.addDecoratorPayload("Component","CmsLinkToSelectComponent",{selector:"se-cms-link-to-select",template:`<se-generic-editor-dropdown [id]="id" [field]="field" [qualifier]="qualifier" [model]="optionModel"></se-generic-editor-dropdown>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let pn=class CmsLinkToSelectComponent{constructor(e,t,i){this.cdr=e;this.systemEventService=t;({id:this.id,field:this.field,model:this.optionModel,qualifier:this.qualifier}=i)}ngOnInit(){const e=this.getLinkToValue(this.optionModel);if(e!==null){this.optionModel.linkTo=e}const t=`${this.id}${l.LINKED_DROPDOWN}`;this.unRegSelectValueChanged=this.systemEventService.subscribe(t,((e,t)=>this.onLinkToSelectValueChanged(t)))}ngOnDestroy(){this.unRegSelectValueChanged()}onLinkToSelectValueChanged({optionObject:e,qualifier:t}){if(this.qualifier!==t){return}if(!e){return}const i=e.id;const o=dn.find((({id:e})=>e===i));if(!o){throw new Error("Selected option is not supported")}if(i===this.optionModel.currentSelectedOptionValue){return}this.optionModel.currentSelectedOptionValue=i;this.optionModel.external=i!==cn.external;this.clearModel(o);this.systemEventService.publishAsync($,{content:this.optionModel,structureApiMode:o.structureApiMode,editorId:this.id});if(!this.cdr.destroyed){this.cdr.detectChanges()}}getLinkToValue(e){if(e.product){return cn.product}else if(e.contentPage){return cn.content}else if(e.category){return cn.category}else if(e.url||e.linkToggle&&e.linkToggle.urlLink||e.urlLink){return cn.external}return null}clearModel({id:e,hasCatalog:t}){if(e!==cn.category){delete this.optionModel.category}if(e!==cn.product){delete this.optionModel.product}if(!t){delete this.optionModel.productCatalog}if(e!==cn.content){delete this.optionModel.contentPage}if(e!==cn.external){delete this.optionModel.url;delete this.optionModel.urlLink;if(this.optionModel.linkToggle&&this.optionModel.linkToggle.urlLink){delete this.optionModel.linkToggle.urlLink}}}};pn=__decorate([n.Component({selector:"se-cms-link-to-select",template:`<se-generic-editor-dropdown [id]="id" [field]="field" [qualifier]="qualifier" [model]="optionModel"></se-generic-editor-dropdown>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(2,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[n.ChangeDetectorRef,l.SystemEventService,Object])],pn);window.__smartedit__.addDecoratorPayload("Component","InfoPageNameComponent",{selector:"se-info-page-name",template:`<div class="se-page-info__name"><se-homepage-icon *ngIf="field.qualifier === 'name'" [cmsPage]="cmsPage" [uriContext]="uriContext"></se-homepage-icon><div id="{{ field.qualifier }}-homepage" class="se-page-info__name-value fd-form-control" [title]="field.qualifier">{{ model[qualifier] }}</div></div>`,styles:[`.se-page-info__name{display:flex;flex-direction:row;align-items:center}.se-page-info__name-value{word-break:break-all;white-space:normal}`]});let mn=class InfoPageNameComponent{constructor(e,t,i){this.catalogService=e;this.pageService=t;({model:this.model,field:this.field,qualifier:this.qualifier}=i)}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const[e,t]=yield Promise.all([this.catalogService.retrieveUriContext(),this.pageService.getCurrentPageInfo()]);this.uriContext=e;this.cmsPage=t}))}};mn=__decorate([n.Component({selector:"se-info-page-name",template:`<div class="se-page-info__name"><se-homepage-icon *ngIf="field.qualifier === 'name'" [cmsPage]="cmsPage" [uriContext]="uriContext"></se-homepage-icon><div id="{{ field.qualifier }}-homepage" class="se-page-info__name-value fd-form-control" [title]="field.qualifier">{{ model[qualifier] }}</div></div>`,styles:[`.se-page-info__name{display:flex;flex-direction:row;align-items:center}.se-page-info__name-value{word-break:break-all;white-space:normal}`]}),__param(2,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[l.ICatalogService,l.IPageService,Object])],mn);window.__smartedit__.addDecoratorPayload("Component","LinkToggleComponent",{selector:"se-link-toggle",template:`<div class="se-link-toggle"><div class="se-link-toggle__row"><div class="se-form-control-row se-form-control-row--action"><label class="se-control-label se-link-toggle__label" for="external-link"><input class="fd-form__control se-link-toggle__input" id="external-link" name="linktoggle" type="radio" [(ngModel)]="model.linkToggle.external" (ngModelChange)="clearUrlLink()" [value]="true"/> {{ 'se.editor.linkto.external.label' | translate}}</label></div><div class="se-form-control-row se-form-control-row--action"><label class="se-control-label se-link-toggle__label" for="internal-link"><input class="fd-form__control se-link-toggle__input" id="internal-link" name="linktoggle" type="radio" [(ngModel)]="model.linkToggle.external" (ngModelChange)="clearUrlLink()" [value]="false"/> {{ 'se.editor.linkto.internal.label' | translate}}</label></div></div><input class="fd-form-control fd-input" id="urlLink" name="urlLink" type="text" [(ngModel)]="model.linkToggle.urlLink" (ngModelChange)="checkUrlLink()" [ngClass]="{ 'has-error': field.hasErrors }"/></div>`,styles:[`.se-link-toggle__row{display:flex;flex-direction:row;align-items:center}.se-form-control-row{margin-right:16px}.se-control-label.se-link-toggle__label{display:flex;flex-direction:row;align-items:center;margin:0}.fd-form__control.se-link-toggle__input{margin:0 4px 0 0}`]});let gn=class LinkToggleComponent{constructor(e){({field:this.field,model:this.model}=e);if(!this.model.linkToggle){this.model.linkToggle={}}if(this.model.linkToggle.external===undefined){this.model.linkToggle.external=true}}clearUrlLink(){this.model.linkToggle.urlLink=null}checkUrlLink(){if(this.model.linkToggle.urlLink===""){this.model.linkToggle.urlLink=null}}};gn=__decorate([n.Component({selector:"se-link-toggle",template:`<div class="se-link-toggle"><div class="se-link-toggle__row"><div class="se-form-control-row se-form-control-row--action"><label class="se-control-label se-link-toggle__label" for="external-link"><input class="fd-form__control se-link-toggle__input" id="external-link" name="linktoggle" type="radio" [(ngModel)]="model.linkToggle.external" (ngModelChange)="clearUrlLink()" [value]="true"/> {{ 'se.editor.linkto.external.label' | translate}}</label></div><div class="se-form-control-row se-form-control-row--action"><label class="se-control-label se-link-toggle__label" for="internal-link"><input class="fd-form__control se-link-toggle__input" id="internal-link" name="linktoggle" type="radio" [(ngModel)]="model.linkToggle.external" (ngModelChange)="clearUrlLink()" [value]="false"/> {{ 'se.editor.linkto.internal.label' | translate}}</label></div></div><input class="fd-form-control fd-input" id="urlLink" name="urlLink" type="text" [(ngModel)]="model.linkToggle.urlLink" (ngModelChange)="checkUrlLink()" [ngClass]="{ 'has-error': field.hasErrors }"/></div>`,styles:[`.se-link-toggle__row{display:flex;flex-direction:row;align-items:center}.se-form-control-row{margin-right:16px}.se-control-label.se-link-toggle__label{display:flex;flex-direction:row;align-items:center;margin:0}.fd-form__control.se-link-toggle__input{margin:0 4px 0 0}`]}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object])],gn);var un;(function(e){e["disabled"]="disabled"})(un||(un={}));window.__smartedit__.addDecoratorPayload("Component","MediaActionLabelComponent",{selector:"se-media-action-label",template:`<span class="se-media-action-label" [ngClass]="{ 'se-media-action-label--disabled': state === 'disabled' }" [translate]="i18nKey"></span>`,styles:[`.se-media-action-label{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapInformativeColor)}.se-media-action-label--disabled{color:var(--sapContent_LabelColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let hn=class MediaActionLabelComponent{};__decorate([n.Input(),__metadata("design:type",String)],hn.prototype,"i18nKey",void 0);__decorate([n.Input(),__metadata("design:type",String)],hn.prototype,"state",void 0);hn=__decorate([n.Component({selector:"se-media-action-label",template:`<span class="se-media-action-label" [ngClass]="{ 'se-media-action-label--disabled': state === 'disabled' }" [translate]="i18nKey"></span>`,styles:[`.se-media-action-label{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapInformativeColor)}.se-media-action-label--disabled{color:var(--sapContent_LabelColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush})],hn);let _n=class MediaBackendValidationHandler{handleResponse(e,t){var i;t=t||[];if((i=e===null||e===void 0?void 0:e.error)===null||i===void 0?void 0:i.errors){e.error.errors.filter((e=>this.isValidationError(e))).forEach((({subject:e,message:i})=>{if(e){t.push({subject:e,message:i})}}));e.error.errors.filter((e=>this.isMediaFolderError(e))).forEach((({type:e,message:i})=>{t.push({subject:"folder",message:i})}));e.error.errors.filter((e=>this.isUploadSizeError(e))).forEach((()=>{t.push({subject:"code",message:"se.max.upload.size.exceeded.error"})}))}return t}isValidationError(e){return e.type==="ValidationError"}isUploadSizeError(e){return e.type==="MaxUploadSizeExceededError"}isMediaFolderError(e){return e.type==="UnknownIdentifierError"||e.type==="AmbiguousIdentifierException"}};_n=__decorate([n.Injectable()],_n);let vn=class MediaFolderService{constructor(e,t){this.restServiceFactory=e;this.settingsService=t;this.mediaFolderListService=this.restServiceFactory.get(l.MEDIA_FOLDER_PATH);this._mediaFolderFetchStrategy={fetchPage:(e,t,i)=>__awaiter(this,void 0,void 0,(function*(){return this.mediaFoldersFetchPage(e,t,i)})),fetchEntity:e=>__awaiter(this,void 0,void 0,(function*(){return Promise.resolve({id:e,name:e,qualifier:e})}))}}get mediaFoldersFetchStrategy(){return this._mediaFolderFetchStrategy}getDefaultFolder(){return __awaiter(this,void 0,void 0,(function*(){const{error:e,data:t}=yield l.promiseUtils.attempt(this.settingsService.get("smartedit.mediaUploadDefaultFolder"));if(e){return Promise.resolve("")}return t}))}getMediaFolders(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.mediaFolderListService.get({mask:e.mask,pageSize:e.pageSize,currentPage:e.currentPage});return t}))}mediaFoldersFetchPage(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const{mediaFolders:o,pagination:n}=yield this.getMediaFolders({mask:e,pageSize:t,currentPage:i});const s=o.map((e=>Object.assign(Object.assign({},e),{id:e.qualifier,name:e.qualifier})));return{pagination:n,results:s}}))}};__decorate([l.Cached({actions:[l.frequentlyChangingContent],tags:[l.userEvictionTag,l.perspectiveChangedEvictionTag,l.pageChangeEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],vn.prototype,"getMediaFolders",null);vn=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.RestServiceFactory,l.ISettingsService])],vn);let fn=class MediaUtilService{getAcceptedFileTypes(e){const t=e||l.GenericEditorMediaType.DEFAULT;switch(t){case l.GenericEditorMediaType.IMAGE:return l.FILE_VALIDATION_CONFIG.ACCEPTED_FILE_TYPES.IMAGE;case l.GenericEditorMediaType.VIDEO:return l.FILE_VALIDATION_CONFIG.ACCEPTED_FILE_TYPES.VIDEO;case l.GenericEditorMediaType.PDF_DOCUMENT:return l.FILE_VALIDATION_CONFIG.ACCEPTED_FILE_TYPES.PDF_DOCUMENT;default:return l.FILE_VALIDATION_CONFIG.ACCEPTED_FILE_TYPES.DEFAULT}}};fn=__decorate([n.Injectable()],fn);const yn="video";const Sn="mp4";window.__smartedit__.addDecoratorPayload("Component","MediaComponent",{selector:"se-media",template:`<div class="se-media"><se-media-selector *ngIf="!image" [id]="mediaSelectorId" [isDisabled]="isFieldDisabled" [mediaId]="mediaIdByLang[lang]" [mimeType]="field.allowMediaType" (mediaIdChange)="onMediaIdChange($event)"></se-media-selector><se-media-file-selector *ngIf="canShowFileSelector()" [labelI18nKey]="'se.upload.image.to.library'" [acceptedFileTypes]="acceptedFileTypes" [selectionMode]="'upload'" [disabled]="isFieldDisabled" (onFileSelect)="onFileSelect($event)"></se-media-file-selector><se-media-upload-form *ngIf="image" class="se-media-upload-form-wrapper" [image]="image" [allowMediaType]="field.allowMediaType" [maxUploadFileSize]="maxUploadFileSize" (onCancel)="resetImage()" (onSelect)="onFileSelect($event)" (onUploadSuccess)="onMediaUploaded($event)"></se-media-upload-form><se-message *ngIf="previewMessage" [type]="'warning'"><ng-container se-message-description>{{ 'se.upload.video.cant.preview' | translate }}</ng-container></se-message><se-media-errors *ngIf="fileErrors.length > 0" [errors]="fileErrors" [maxUploadFileSize]="maxUploadFileSize"></se-media-errors></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let Cn=class MediaComponent{constructor(e,t,i,o,n,s,a){this.cdr=e;this.fileValidationService=t;this.logService=i;this.mediaUtilService=o;this.mediaService=n;this.sharedDataService=s;this.previewMessage=false;({field:this.field,model:this.mediaIdByLang,qualifier:this.lang}=a);this.acceptedFileTypes=this.mediaUtilService.getAcceptedFileTypes(this.field.allowMediaType);this.fileErrors=[];this.image=null;this.isFieldDisabled=a.isFieldDisabled();this.mediaSelectorId=this.field.qualifier;this.field.allowMediaType=this.field.allowMediaType||l.GenericEditorMediaType.DEFAULT}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){if(this.mediaIdByLang[this.lang]){yield this.checkMediaPreview(this.mediaIdByLang[this.lang])}const e=yield this.sharedDataService.get(Y);this.maxUploadFileSize=e&&typeof e==="number"?e:l.FILE_VALIDATION_CONFIG.DEFAULT_MAX_UPLOAD_FILE_SIZE}))}onMediaIdChange(e){return __awaiter(this,void 0,void 0,(function*(){this.fileErrors=[];this.previewMessage=false;this.mediaIdByLang[this.lang]=e;if(e){yield this.checkMediaPreview(e)}}))}onFileSelect(e){return __awaiter(this,void 0,void 0,(function*(){this.mediaIdByLang[this.lang]=undefined;this.resetImage();try{if(typeof e==="string"){this.image=e}else{const t=e[0];yield this.fileValidationService.validate(t,this.maxUploadFileSize,this.fileErrors);this.image=t}}catch(e){this.logService.warn("Invalid file")}if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}onMediaUploaded(e){return __awaiter(this,void 0,void 0,(function*(){this.resetImage();yield this.onMediaIdChange(e);if(this.field.initiated){this.field.initiated.length=0}}))}resetImage(){this.fileErrors=[];this.image=null}canShowFileSelector(){return this.mediaIdByLang&&!this.mediaIdByLang[this.lang]&&!this.image}canVideoPreview(e){if(e&&e.includes(yn)&&e.indexOf(Sn)===-1){this.previewMessage=true}}checkMediaPreview(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.mediaService.getMedia(e);this.canVideoPreview(t===null||t===void 0?void 0:t.mime);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}};Cn=__decorate([n.Component({selector:"se-media",template:`<div class="se-media"><se-media-selector *ngIf="!image" [id]="mediaSelectorId" [isDisabled]="isFieldDisabled" [mediaId]="mediaIdByLang[lang]" [mimeType]="field.allowMediaType" (mediaIdChange)="onMediaIdChange($event)"></se-media-selector><se-media-file-selector *ngIf="canShowFileSelector()" [labelI18nKey]="'se.upload.image.to.library'" [acceptedFileTypes]="acceptedFileTypes" [selectionMode]="'upload'" [disabled]="isFieldDisabled" (onFileSelect)="onFileSelect($event)"></se-media-file-selector><se-media-upload-form *ngIf="image" class="se-media-upload-form-wrapper" [image]="image" [allowMediaType]="field.allowMediaType" [maxUploadFileSize]="maxUploadFileSize" (onCancel)="resetImage()" (onSelect)="onFileSelect($event)" (onUploadSuccess)="onMediaUploaded($event)"></se-media-upload-form><se-message *ngIf="previewMessage" [type]="'warning'"><ng-container se-message-description>{{ 'se.upload.video.cant.preview' | translate }}</ng-container></se-message><se-media-errors *ngIf="fileErrors.length > 0" [errors]="fileErrors" [maxUploadFileSize]="maxUploadFileSize"></se-media-errors></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(6,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[n.ChangeDetectorRef,l.IFileValidation,l.LogService,fn,l.IMediaService,l.ISharedDataService,Object])],Cn);const bn="clone_";var In;(function(e){e["widescreen"]="widescreen";e["desktop"]="desktop";e["tablet"]="tablet";e["mobile"]="mobile"})(In||(In={}));window.__smartedit__.addDecoratorPayload("Component","MediaContainerComponent",{selector:"se-media-container",template:`<div *ngIf="hasReadPermissionOnMediaRelatedTypes && advancedMediaContainerManagementEnabled"><se-media-container-selector [eventNameAffix]="selectorEventNameAffix" [isAdvancedCloning]="isAdvancedCloning()" [initialName]="initialMediaContainerName" [name]="getMediaContainerName()" [isEditable]="field.editable" (nameChange)="onMediaContainerNameChange($event)" (onCreate)="onMediaContainerCreate($event)" (onRemove)="onMediaContainerRemove()" (onSelect)="setMediaContainer($event)" (onCreationInProgressChange)="onMediaContainerCreationInProgressChange($event)"></se-media-container-selector></div><div class="se-media-container-field" *ngIf="canShowMediaFormatWithUploadForm()"><div class="se-media-container-field__media-list"><se-media-format class="se-media-container-cell" *ngFor="let format of field.options" [ngClass]="getMediaContainerCellClassName(format.id)" [errorMessages]="field.messages" [lang]="lang" [isEditable]="field.editable" [isUnderEdit]="isMediaFormatUnderEdit(format.id)" [isFieldDisabled]="isFieldDisabled()" [mediaUuid]="model[lang]?.medias[format.id]" [mediaFormat]="format.id" [mediaLabel]="format.label" [allowMediaType]="field.allowMediaType" (onFileSelect)="onFileSelect($event, format.id)" (onDelete)="removeMediaByFormat(format.id)"></se-media-format></div><se-media-upload-form *ngIf="image" class="se-media-upload-form-wrapper se-media-upload-form-wrapper--spaced" [image]="image.file" [allowMediaType]="field.allowMediaType" [maxUploadFileSize]="maxUploadFileSize" (onCancel)="resetImage()" (onSelect)="onFileSelect($event)" (onUploadSuccess)="onFileUploadSuccess($event, image.format)"></se-media-upload-form><se-media-errors [errors]="fileValidationErrors" [maxUploadFileSize]="maxUploadFileSize"></se-media-errors></div><div *ngIf="!hasReadPermissionOnMediaRelatedTypes"><span translate="se.cms.media.typepermissions.error" [translateParams]="{ containedTypes: field.containedTypes }"></span></div>`});let En=class MediaContainerComponent{constructor(e,t,i,o,n,s,a){this.systemEventService=e;this.logService=t;this.typePermissionsRestService=i;this.loadConfigManagerService=o;this.fileValidationService=n;this.sharedDataService=s;this.sessionStorage=window.sessionStorage;({field:this.field,model:this.model,editor:this.editor,qualifier:this.lang,isFieldDisabled:this.isFieldDisabled}=a);this.selectorEventNameAffix=`${this.field.qualifier}_${this.lang}`;if(this.field.dependsOnField){this.field.hideFieldWidget=true;const e=`${this.editor.id}${this.field.dependsOnField}${l.CLICK_DROPDOWN}`;this.unRegDependsOnValueChanged=this.systemEventService.subscribe(e,((e,t)=>this.onDependsOnValueChanged(t)))}}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){if(!this.model[this.lang]){this.setMediaContainer(this.constructEmptyMediaContainer());this.resetPristineMediaContainer()}const e=yield this.sharedDataService.get(Y);this.maxUploadFileSize=e&&typeof e==="number"?e:l.FILE_VALIDATION_CONFIG.DEFAULT_MAX_UPLOAD_FILE_SIZE;yield this.initHasReadPermissionOnMediaRelatedTypes();yield this.initAdvancedMediaContainerManagementEnabled();this.initialMediaContainerNameKey=`${this.editor.id}_InitialMediaContainerName_${this.lang}`;this.resetModelForClone();this.getInitialMediaContainerName()}))}getMediaContainerName(){var e;return((e=this.model[this.lang])===null||e===void 0?void 0:e.qualifier)||""}getInitialMediaContainerName(){var e,t;if(!!this.editor.initialContent.cloneComponent){const t=this.sessionStorage.getItem(this.initialMediaContainerNameKey);this.initialMediaContainerName=t||((e=this.model[this.lang])===null||e===void 0?void 0:e.qualifier)||""}else{this.initialMediaContainerName=((t=this.model[this.lang])===null||t===void 0?void 0:t.qualifier)||""}}getMediaContainerCellClassName(e){return`se-media-container-cell--${e}`}setMediaContainer(e){this.model[this.lang]=e;this.resetErrors()}canShowMediaFormatWithUploadForm(){return this.hasReadPermissionOnMediaRelatedTypes&&(this.isMediaContainerSelected()||this.mediaContainerCreationInProgress||!this.advancedMediaContainerManagementEnabled)}isMediaFormatUnderEdit(e){var t;return e===((t=this.image)===null||t===void 0?void 0:t.format)}onFileSelect(e,t){var i;return __awaiter(this,void 0,void 0,(function*(){const o=t||((i=this.image)===null||i===void 0?void 0:i.format);this.resetImage();try{if(typeof e==="string"){this.image={file:e,format:o}}else{const t=e[0];yield this.fileValidationService.validate(t,this.maxUploadFileSize,this.fileValidationErrors);this.image={file:t,format:o}}}catch(e){this.logService.warn("Invalid file")}}))}onFileUploadSuccess(e,t){this.setMediaUuidForFormat(e,t);this.resetErrors();this.resetImage()}resetErrors(){if(this.field.hasErrors){this.field.hasErrors=false;this.field.messages=[];const e=this.editor.form.group.controls;for(const t of Object.keys(e)){e[t].updateValueAndValidity()}}}onMediaContainerCreate(e){this.clearModel();this.onMediaContainerNameChange(e);this.model[this.lang].medias={}}onMediaContainerRemove(){this.clearModel();this.model[this.lang].medias={}}onMediaContainerNameChange(e){this.model[this.lang].qualifier=e}onMediaContainerCreationInProgressChange(e){this.mediaContainerCreationInProgress=e}removeMediaByFormat(e){delete this.model[this.lang].medias[e]}isAdvancedCloning(){return!!this.editor.initialContent.cloneComponent}constructEmptyMediaContainer(){return{catalogVersion:undefined,medias:{},qualifier:undefined,mediaContainerUuid:undefined}}resetPristineMediaContainer(){const e=this.editor.form.fields.find((e=>{let t=false;if(Array.isArray(e.containedTypes)){t=e.containedTypes.some((e=>e==="MediaContainer"))}return t}));if(!!this.editor.form.pristine[e.qualifier]){this.editor.form.pristine[e.qualifier][this.lang]=this.constructEmptyMediaContainer()}}onDependsOnValueChanged(e){this.field.hideFieldWidget=e!==this.field.dependsOnValue;if(this.field.hideFieldWidget){if(this.model[this.lang]){this.setMediaContainer(this.constructEmptyMediaContainer())}const e=`mediaContainer_${this.selectorEventNameAffix}_${K}`;this.systemEventService.publishAsync(e)}}initAdvancedMediaContainerManagementEnabled(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.loadConfigManagerService.loadAsObject();this.advancedMediaContainerManagementEnabled=e.advancedMediaContainerManagement||false}))}initHasReadPermissionOnMediaRelatedTypes(){return __awaiter(this,void 0,void 0,(function*(){try{const e=yield this.typePermissionsRestService.hasAllPermissionsForTypes(this.field.containedTypes);this.hasReadPermissionOnMediaRelatedTypes=this.field.containedTypes.every((t=>e[t].read))}catch(e){this.hasReadPermissionOnMediaRelatedTypes=false;this.logService.warn("Failed to retrieve type permissions",e)}}))}setMediaUuidForFormat(e,t){this.model[this.lang].medias[t]=e}isMediaContainerSelected(){return!p.isEmpty(this.model[this.lang])}resetImage(){this.fileValidationErrors=[];this.image=null}clearModel(){Object.keys(this.model[this.lang]).forEach((e=>delete this.model[this.lang][e]))}resetModelForClone(){const e=this.model[this.lang];if(!!this.editor.initialContent.cloneComponent&&e&&e.mediaContainerUuid&&e.qualifier){this.sessionStorage.setItem(this.initialMediaContainerNameKey,e.qualifier);const t=7;const i=`${bn}${this.model[this.lang].qualifier.trim()}_${Date.now().toString().substring(t)}`;this.onMediaContainerNameChange(i);delete e.mediaContainerUuid;delete e.catalogVersion}}};En=__decorate([n.Component({selector:"se-media-container",template:`<div *ngIf="hasReadPermissionOnMediaRelatedTypes && advancedMediaContainerManagementEnabled"><se-media-container-selector [eventNameAffix]="selectorEventNameAffix" [isAdvancedCloning]="isAdvancedCloning()" [initialName]="initialMediaContainerName" [name]="getMediaContainerName()" [isEditable]="field.editable" (nameChange)="onMediaContainerNameChange($event)" (onCreate)="onMediaContainerCreate($event)" (onRemove)="onMediaContainerRemove()" (onSelect)="setMediaContainer($event)" (onCreationInProgressChange)="onMediaContainerCreationInProgressChange($event)"></se-media-container-selector></div><div class="se-media-container-field" *ngIf="canShowMediaFormatWithUploadForm()"><div class="se-media-container-field__media-list"><se-media-format class="se-media-container-cell" *ngFor="let format of field.options" [ngClass]="getMediaContainerCellClassName(format.id)" [errorMessages]="field.messages" [lang]="lang" [isEditable]="field.editable" [isUnderEdit]="isMediaFormatUnderEdit(format.id)" [isFieldDisabled]="isFieldDisabled()" [mediaUuid]="model[lang]?.medias[format.id]" [mediaFormat]="format.id" [mediaLabel]="format.label" [allowMediaType]="field.allowMediaType" (onFileSelect)="onFileSelect($event, format.id)" (onDelete)="removeMediaByFormat(format.id)"></se-media-format></div><se-media-upload-form *ngIf="image" class="se-media-upload-form-wrapper se-media-upload-form-wrapper--spaced" [image]="image.file" [allowMediaType]="field.allowMediaType" [maxUploadFileSize]="maxUploadFileSize" (onCancel)="resetImage()" (onSelect)="onFileSelect($event)" (onUploadSuccess)="onFileUploadSuccess($event, image.format)"></se-media-upload-form><se-media-errors [errors]="fileValidationErrors" [maxUploadFileSize]="maxUploadFileSize"></se-media-errors></div><div *ngIf="!hasReadPermissionOnMediaRelatedTypes"><span translate="se.cms.media.typepermissions.error" [translateParams]="{ containedTypes: field.containedTypes }"></span></div>`}),__param(6,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[l.SystemEventService,l.LogService,r.TypePermissionsRestService,_.LoadConfigManagerService,l.IFileValidation,l.ISharedDataService,Object])],En);const wn=`${r.IMAGES_URL}/image_placeholder.png`;window.__smartedit__.addDecoratorPayload("Component","MediaContainerSelectorItemComponent",{selector:"se-media-container-selector-item",template:`<div class="media-container-selector-item__row"><img class="media-container-selector-item__img" [ngClass]="{ 'media-container-selector-item__img--selected': isSelected }" [src]="getThumbnailUrl(item.thumbnailUrl)"/><div class="media-container-selector-item__label">{{ item.qualifier }}</div></div>`,styles:[`.media-container-selector-item__row{display:grid;grid-template-columns:2fr 4fr;grid-column-gap:12px;width:100%;align-items:center;padding:0 8px}.media-container-selector-item__img{max-width:90%;max-height:100%;margin:12px}.media-container-selector-item__img--selected{max-width:35%;height:30px;margin:0}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Tn=class MediaContainerSelectorItemComponent{constructor(e){({item:this.item,selected:this.isSelected}=e)}getThumbnailUrl(e){return e||wn}};Tn=__decorate([n.Component({selector:"se-media-container-selector-item",template:`<div class="media-container-selector-item__row"><img class="media-container-selector-item__img" [ngClass]="{ 'media-container-selector-item__img--selected': isSelected }" [src]="getThumbnailUrl(item.thumbnailUrl)"/><div class="media-container-selector-item__label">{{ item.qualifier }}</div></div>`,styles:[`.media-container-selector-item__row{display:grid;grid-template-columns:2fr 4fr;grid-column-gap:12px;width:100%;align-items:center;padding:0 8px}.media-container-selector-item__img{max-width:90%;max-height:100%;margin:12px}.media-container-selector-item__img--selected{max-width:35%;height:30px;margin:0}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],Tn);const Pn="/cmswebservices/v1/catalogs/CURRENT_CONTEXT_CATALOG/versions/CURRENT_CONTEXT_CATALOG_VERSION/mediacontainers";const On="mediaContainer";window.__smartedit__.addDecoratorPayload("Component","MediaContainerSelectorComponent",{selector:"se-media-container-selector",template:`<se-generic-editor-dropdown [id]="id" [field]="field" [qualifier]="field.qualifier" [model]="mediaContainerNameModel" [showRemoveButton]="true" [itemComponent]="itemComponent" [actionableSearchItem]="actionableSearchItem" [(reset)]="reset"></se-generic-editor-dropdown><div *ngIf="isSelected() || creationInProgress"><label [for]="'media-container-qualifier-' + id" class="se-control-label required se-media-container-name-label">{{ 'se.cms.media.responsive.name' | lowercase | translate }}</label> <input fd-form-control type="text" name="media-container-qualifier" [id]="'media-container-qualifier-' + id" [ngModel]="name" (ngModelChange)="onNameChange($event)" [readOnly]="isNameReadOnly()" [disabled]="!field.editable"/></div>`,styles:[`se-media-container-selector .se-media-container-name-label{margin-top:9px}se-media-container-selector .se-generic-editor-dropdown .se-item-printer{width:100%}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None});let An=class MediaContainerSelectorComponent{constructor(e,t){this.cdr=e;this.systemEventService=t;this.nameChange=new n.EventEmitter;this.onCreate=new n.EventEmitter;this.onRemove=new n.EventEmitter;this.onSelect=new n.EventEmitter;this.onCreationInProgressChange=new n.EventEmitter;this.field={cmsStructureType:"EditableDropdown",qualifier:On,required:true,uri:Pn,idAttribute:"qualifier",editable:true,paged:true};this.creationInProgress=false;this.itemComponent=Tn}ngOnInit(){this.id=`${On}_${this.eventNameAffix}`;this.field.editable=this.isEditable;this.mediaContainerNameModel={[On]:this.initialName};const e=`${this.id}${l.LINKED_DROPDOWN}`;this.unRegSelectMediaContainer=this.systemEventService.subscribe(e,((e,t)=>this.onSelectItem(t)));const t=`${this.id}_${K}`;this.unRegClearSelectMediaContainer=this.systemEventService.subscribe(t,((e,t)=>this.clearSelectOption()));const i=`CREATE_MEDIA_CONTAINER_BUTTON_PRESSED_EVENT_${this.eventNameAffix}`;this.actionableSearchItem={eventId:i};this.unRegCreateMediaContainer=this.systemEventService.subscribe(i,((e,t)=>this.onCreateMediaContainer(t)))}ngOnDestroy(){this.unRegSelectMediaContainer();this.unRegCreateMediaContainer();this.unRegClearSelectMediaContainer()}onNameChange(e){this.nameChange.emit(e)}isNameReadOnly(){return!this.isAdvancedCloning&&!this.creationInProgress&&this.isSelected()}isSelected(){return!!this.mediaContainerNameModel[On]}onSelectItem({optionObject:e}){this.setCreationInProgressAndEmit(false);if(!this.mediaContainerNameModel.mediaContainer){this.onSelect.emit({catalogVersion:undefined,medias:{},qualifier:undefined,mediaContainerUuid:undefined});this.onRemove.emit()}else if(!!e){this.onSelect.emit(e)}if(!this.cdr.destroyed){this.cdr.detectChanges()}}onCreateMediaContainer(e){this.clearSelectOption();this.setCreationInProgressAndEmit(true);this.onCreate.emit(e);if(!this.cdr.destroyed){this.cdr.detectChanges()}}setCreationInProgressAndEmit(e){this.creationInProgress=e;this.onCreationInProgressChange.emit(e)}clearSelectOption(){this.initialName=undefined;this.resetSelector()}resetSelector(){if(typeof this.reset==="function"){this.reset(true)}}};__decorate([n.Input(),__metadata("design:type",String)],An.prototype,"eventNameAffix",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],An.prototype,"isAdvancedCloning",void 0);__decorate([n.Input(),__metadata("design:type",String)],An.prototype,"name",void 0);__decorate([n.Input(),__metadata("design:type",String)],An.prototype,"initialName",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],An.prototype,"isEditable",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],An.prototype,"nameChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],An.prototype,"onCreate",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],An.prototype,"onRemove",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],An.prototype,"onSelect",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],An.prototype,"onCreationInProgressChange",void 0);An=__decorate([n.Component({selector:"se-media-container-selector",template:`<se-generic-editor-dropdown [id]="id" [field]="field" [qualifier]="field.qualifier" [model]="mediaContainerNameModel" [showRemoveButton]="true" [itemComponent]="itemComponent" [actionableSearchItem]="actionableSearchItem" [(reset)]="reset"></se-generic-editor-dropdown><div *ngIf="isSelected() || creationInProgress"><label [for]="'media-container-qualifier-' + id" class="se-control-label required se-media-container-name-label">{{ 'se.cms.media.responsive.name' | lowercase | translate }}</label> <input fd-form-control type="text" name="media-container-qualifier" [id]="'media-container-qualifier-' + id" [ngModel]="name" (ngModelChange)="onNameChange($event)" [readOnly]="isNameReadOnly()" [disabled]="!field.editable"/></div>`,styles:[`se-media-container-selector .se-media-container-name-label{margin-top:9px}se-media-container-selector .se-generic-editor-dropdown .se-item-printer{width:100%}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),__metadata("design:paramtypes",[n.ChangeDetectorRef,l.SystemEventService])],An);window.__smartedit__.addDecoratorPayload("Component","MediaErrorsComponent",{selector:"se-media-errors",template:`<div class="se-media-error field-errors"><div *ngFor="let error of errors">{{ error.message | translate: { sizeLimitationOfFile: maxUploadFileSize } }}</div></div>`,styles:[`.se-media-error{color:var(--sapErrorColor)!important}`]});let xn=class MediaErrorsComponent{};__decorate([n.Input(),__metadata("design:type",Array)],xn.prototype,"errors",void 0);__decorate([n.Input(),__metadata("design:type",Number)],xn.prototype,"maxUploadFileSize",void 0);xn=__decorate([n.Component({selector:"se-media-errors",template:`<div class="se-media-error field-errors"><div *ngFor="let error of errors">{{ error.message | translate: { sizeLimitationOfFile: maxUploadFileSize } }}</div></div>`,styles:[`.se-media-error{color:var(--sapErrorColor)!important}`]})],xn);window.__smartedit__.addDecoratorPayload("Component","MediaFormatComponent",{selector:"se-media-format",template:`<div class="se-media-format" [ngClass]="mediaFormat"><div *ngIf="mediaLabel" class="se-media-format__screen-type" [translate]="mediaFormatI18nKey"></div><se-media-format-uploaded *ngIf="isMediaPreviewEnabled()" [media]="media" [replaceLabelI18nKey]="mediaSelectorI18nKeys.REPLACE" [acceptedFileTypes]="acceptedFileTypes" [isFieldDisabled]="isFieldDisabled" (onFileSelect)="onFileSelectorFileSelect($event)" (onDelete)="onRemoveButtonClick()"></se-media-format-uploaded><div class="se-media--absent" *ngIf="isMediaAbsent()"><se-media-file-selector *ngIf="isEditable" [selectionMode]="'upload'" [labelI18nKey]="mediaSelectorI18nKeys.UPLOAD" [acceptedFileTypes]="acceptedFileTypes" [customClass]="isFieldDisabled ? 'file-selector-disabled' : ''" [disabled]="isFieldDisabled" (onFileSelect)="onFileSelectorFileSelect($event)"></se-media-file-selector><se-media-file-selector *ngIf="!isEditable" [selectionMode]="'upload'" [labelI18nKey]="mediaSelectorI18nKeys.UPLOAD" [acceptedFileTypes]="acceptedFileTypes" [customClass]="!isEditable ? 'file-selector-disabled' : ''" [disabled]="!isEditable" (onFileSelect)="onFileSelectorFileSelect($event)"></se-media-file-selector></div><div *ngIf="isUnderEdit" class="se-media--edit-wrapper"><se-media-file-selector class="se-media--edit" [labelI18nKey]="mediaSelectorI18nKeys.UPLOAD" [acceptedFileTypes]="acceptedFileTypes" [customClass]="'file-selector-disabled'" [disabled]="true" (onFileSelect)="onFileSelectorFileSelect($event)"></se-media-file-selector><span class="se-media-preview--edit" [translate]="mediaSelectorI18nKeys.UNDER_EDIT"></span></div><ng-container *ngIf="!isUnderEdit && hasCurrentLangError()"><div class="error-input se-media-format__error" *ngFor="let error of getErrors()"><span>{{ error }}</span></div></ng-container></div>`,styles:[`.se-media-format{height:100%}.se-media-format__screen-type{font-weight:700;padding-top:4px;padding-bottom:10px;color:var(--sapTextColor)}.se-media-format__error{color:var(--sapErrorColor)}.se-media--absent{display:flex;flex-direction:row;align-items:center;justify-content:center;height:75px;border:1px dashed var(--sapGroup_ContentBorderColor)}.se-media--edit-wrapper{height:100%}.se-media--edit{display:flex;flex-direction:row;align-items:center;justify-content:center}.se-media-preview--edit{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;display:block;font-style:italic}`,`.se-media-preview-container{position:relative}.se-media-preview-container .se-media-preview__image-wrapper{display:flex;flex-direction:row;align-items:center;justify-content:center;height:75px;background-color:var(--sapShell_Background)}.se-media-preview-container .se-media-preview__image-thumbnail{max-width:100%;max-height:100%}`],encapsulation:n.ViewEncapsulation.None});let Dn=class MediaFormatComponent{constructor(e,t,i){this.mediaService=e;this.mediaUtilService=t;this.onFileSelect=new n.EventEmitter;this.onDelete=new n.EventEmitter;this.media=null;this.mediaSelectorI18nKeys=i}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.acceptedFileTypes=this.mediaUtilService.getAcceptedFileTypes(this.allowMediaType);this.mediaFormatI18nKey=`se.media.format.${this.mediaFormat}`;if(this.mediaUuid){return this.fetchAndSetMedia()}else{return Promise.reject()}}))}ngOnChanges(e){return __awaiter(this,void 0,void 0,(function*(){const t=e.mediaUuid;if(t&&!t.firstChange){if(this.mediaUuid){return this.fetchAndSetMedia()}else{this.media=null}}return Promise.resolve()}))}onFileSelectorFileSelect(e){this.onFileSelect.emit(e)}onRemoveButtonClick(){this.onDelete.emit()}isMediaPreviewEnabled(){var e;return this.mediaUuid&&!this.isUnderEdit&&!!((e=this.media)===null||e===void 0?void 0:e.code)}isMediaAbsent(){return!this.mediaUuid&&!this.isUnderEdit}hasCurrentLangError(){return(this.errorMessages||[]).filter((e=>e.language===this.lang)).map((e=>e.message)).length>0}getErrors(){return(this.errorMessages||[]).filter((e=>e.format===this.mediaFormat&&e.language===this.lang)).map((e=>e.message))}fetchAndSetMedia(){return __awaiter(this,void 0,void 0,(function*(){this.media=yield this.mediaService.getMedia(this.mediaUuid)}))}};__decorate([n.Input(),__metadata("design:type",Array)],Dn.prototype,"errorMessages",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],Dn.prototype,"isEditable",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],Dn.prototype,"isUnderEdit",void 0);__decorate([n.Input(),__metadata("design:type",String)],Dn.prototype,"lang",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],Dn.prototype,"isFieldDisabled",void 0);__decorate([n.Input(),__metadata("design:type",String)],Dn.prototype,"mediaUuid",void 0);__decorate([n.Input(),__metadata("design:type",String)],Dn.prototype,"mediaFormat",void 0);__decorate([n.Input(),__metadata("design:type",String)],Dn.prototype,"mediaLabel",void 0);__decorate([n.Input(),__metadata("design:type",String)],Dn.prototype,"allowMediaType",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Dn.prototype,"onFileSelect",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Dn.prototype,"onDelete",void 0);Dn=__decorate([n.Component({selector:"se-media-format",template:`<div class="se-media-format" [ngClass]="mediaFormat"><div *ngIf="mediaLabel" class="se-media-format__screen-type" [translate]="mediaFormatI18nKey"></div><se-media-format-uploaded *ngIf="isMediaPreviewEnabled()" [media]="media" [replaceLabelI18nKey]="mediaSelectorI18nKeys.REPLACE" [acceptedFileTypes]="acceptedFileTypes" [isFieldDisabled]="isFieldDisabled" (onFileSelect)="onFileSelectorFileSelect($event)" (onDelete)="onRemoveButtonClick()"></se-media-format-uploaded><div class="se-media--absent" *ngIf="isMediaAbsent()"><se-media-file-selector *ngIf="isEditable" [selectionMode]="'upload'" [labelI18nKey]="mediaSelectorI18nKeys.UPLOAD" [acceptedFileTypes]="acceptedFileTypes" [customClass]="isFieldDisabled ? 'file-selector-disabled' : ''" [disabled]="isFieldDisabled" (onFileSelect)="onFileSelectorFileSelect($event)"></se-media-file-selector><se-media-file-selector *ngIf="!isEditable" [selectionMode]="'upload'" [labelI18nKey]="mediaSelectorI18nKeys.UPLOAD" [acceptedFileTypes]="acceptedFileTypes" [customClass]="!isEditable ? 'file-selector-disabled' : ''" [disabled]="!isEditable" (onFileSelect)="onFileSelectorFileSelect($event)"></se-media-file-selector></div><div *ngIf="isUnderEdit" class="se-media--edit-wrapper"><se-media-file-selector class="se-media--edit" [labelI18nKey]="mediaSelectorI18nKeys.UPLOAD" [acceptedFileTypes]="acceptedFileTypes" [customClass]="'file-selector-disabled'" [disabled]="true" (onFileSelect)="onFileSelectorFileSelect($event)"></se-media-file-selector><span class="se-media-preview--edit" [translate]="mediaSelectorI18nKeys.UNDER_EDIT"></span></div><ng-container *ngIf="!isUnderEdit && hasCurrentLangError()"><div class="error-input se-media-format__error" *ngFor="let error of getErrors()"><span>{{ error }}</span></div></ng-container></div>`,styles:[`.se-media-format{height:100%}.se-media-format__screen-type{font-weight:700;padding-top:4px;padding-bottom:10px;color:var(--sapTextColor)}.se-media-format__error{color:var(--sapErrorColor)}.se-media--absent{display:flex;flex-direction:row;align-items:center;justify-content:center;height:75px;border:1px dashed var(--sapGroup_ContentBorderColor)}.se-media--edit-wrapper{height:100%}.se-media--edit{display:flex;flex-direction:row;align-items:center;justify-content:center}.se-media-preview--edit{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;display:block;font-style:italic}`,`.se-media-preview-container{position:relative}.se-media-preview-container .se-media-preview__image-wrapper{display:flex;flex-direction:row;align-items:center;justify-content:center;height:75px;background-color:var(--sapShell_Background)}.se-media-preview-container .se-media-preview__image-thumbnail{max-width:100%;max-height:100%}`],encapsulation:n.ViewEncapsulation.None}),__param(2,n.Inject(l.MEDIA_SELECTOR_I18N_KEY_TOKEN)),__metadata("design:paramtypes",[l.IMediaService,fn,Object])],Dn);window.__smartedit__.addDecoratorPayload("Component","MediaFormatUploadedComponent",{selector:"se-media-format-uploaded",template:`<div class="se-media--present"><div class="se-media--present-img-container se-media-preview-container"><div *ngIf="isImage()" class="se-media-preview__image-wrapper"><se-media-preview [imageUrl]="getSafeUrl()"></se-media-preview><img class="se-media-preview__image-thumbnail" [src]="getSafeUrl()"/></div><div *ngIf="isVideo()" class="se-media-preview__image-wrapper"><video class="se-media-preview__image-thumbnail" controls><source [src]="getSafeUrl()" type="video/mp4"/></video></div><div *ngIf="isPdf()" class="se-media-preview__image-wrapper"><iframe class="se-media-preview__image-thumbnail" [src]="getSafeUrl()" style="width: 100%; height: 100%; border: none"></iframe></div></div><se-media-advanced-properties [media]="media"></se-media-advanced-properties><se-media-file-selector [labelI18nKey]="replaceLabelI18nKey" [acceptedFileTypes]="acceptedFileTypes" [customClass]="'media-format-present-replace' + (isFieldDisabled ? ' file-selector-disabled' : '')" [disabled]="isFieldDisabled" (onFileSelect)="onFileSelectorFileSelect($event)"></se-media-file-selector><se-media-remove-button [isDisabled]="isFieldDisabled" (clickHandler)="onRemoveButtonClick()"></se-media-remove-button></div>`,styles:[`.se-media-preview-container{position:relative}.se-media-preview-container .se-media-preview__image-wrapper{display:flex;flex-direction:row;align-items:center;justify-content:center;height:75px;background-color:var(--sapShell_Background)}.se-media-preview-container .se-media-preview__image-thumbnail{max-width:100%;max-height:100%}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Rn=class MediaFormatUploadedComponent{constructor(e){this.sanitizer=e;this.onFileSelect=new n.EventEmitter;this.onDelete=new n.EventEmitter}onFileSelectorFileSelect(e){this.onFileSelect.emit(e)}onRemoveButtonClick(){this.onDelete.emit()}isImage(){return!this.isVideo()&&!this.isPdf()}isVideo(){return this.media.mime&&this.media.mime.includes(l.GenericEditorMediaType.VIDEO)}isPdf(){return this.media.mime&&this.media.mime.includes(l.GenericEditorMediaType.PDF_DOCUMENT)}getSafeUrl(){return this.sanitizer.bypassSecurityTrustResourceUrl(this.media.url)}};__decorate([n.Input(),__metadata("design:type",Object)],Rn.prototype,"media",void 0);__decorate([n.Input(),__metadata("design:type",String)],Rn.prototype,"replaceLabelI18nKey",void 0);__decorate([n.Input(),__metadata("design:type",Array)],Rn.prototype,"acceptedFileTypes",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],Rn.prototype,"isFieldDisabled",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Rn.prototype,"onFileSelect",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Rn.prototype,"onDelete",void 0);Rn=__decorate([n.Component({selector:"se-media-format-uploaded",template:`<div class="se-media--present"><div class="se-media--present-img-container se-media-preview-container"><div *ngIf="isImage()" class="se-media-preview__image-wrapper"><se-media-preview [imageUrl]="getSafeUrl()"></se-media-preview><img class="se-media-preview__image-thumbnail" [src]="getSafeUrl()"/></div><div *ngIf="isVideo()" class="se-media-preview__image-wrapper"><video class="se-media-preview__image-thumbnail" controls><source [src]="getSafeUrl()" type="video/mp4"/></video></div><div *ngIf="isPdf()" class="se-media-preview__image-wrapper"><iframe class="se-media-preview__image-thumbnail" [src]="getSafeUrl()" style="width: 100%; height: 100%; border: none"></iframe></div></div><se-media-advanced-properties [media]="media"></se-media-advanced-properties><se-media-file-selector [labelI18nKey]="replaceLabelI18nKey" [acceptedFileTypes]="acceptedFileTypes" [customClass]="'media-format-present-replace' + (isFieldDisabled ? ' file-selector-disabled' : '')" [disabled]="isFieldDisabled" (onFileSelect)="onFileSelectorFileSelect($event)"></se-media-file-selector><se-media-remove-button [isDisabled]="isFieldDisabled" (clickHandler)="onRemoveButtonClick()"></se-media-remove-button></div>`,styles:[`.se-media-preview-container{position:relative}.se-media-preview-container .se-media-preview__image-wrapper{display:flex;flex-direction:row;align-items:center;justify-content:center;height:75px;background-color:var(--sapShell_Background)}.se-media-preview-container .se-media-preview__image-thumbnail{max-width:100%;max-height:100%}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[a.DomSanitizer])],Rn);var Mn;(function(e){e["replace"]="replace";e["upload"]="upload"})(Mn||(Mn={}));window.__smartedit__.addDecoratorPayload("Component","MediaFileSelectorComponent",{selector:"se-media-file-selector",template:`<div class="se-file-selector" [ngClass]="customClass"><label *ngIf="!disabled" class="se-button se-button--text" [ngClass]="{ 'se-button--disabled': disabled, \n                     'se-file-selector__custombtn': customComponent, \n                     'se-file-selector__btn': !customComponent }"><ng-container *ngIf="customComponent"><ng-container *ngComponentOutlet="customComponent.component; injector: customComponent.injector"></ng-container></ng-container><span class="sap-icon--share se-media__action-icon" [ngClass]="{\n        'sap-icon--share': isReplaceMode(),\n        'sap-icon--upload': !isReplaceMode()\n    }"></span> <span class="se-file-selector__label">{{ labelI18nKey | translate }}</span><ng-container *ngIf="!customComponent"><input type="file" class="hide se-file-selector__input" [accept]="buildAcceptedFileTypesList()" (change)="onSelect($event.target.files)"/></ng-container></label></div>`,styles:[`.se-media-container-field__media-list{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:0 16px}.se-media-container-cell--mobile{order:4}.se-media-container-cell--desktop{order:2}.se-media-container-cell--tablet{order:3}.se-media-container-cell--widescreen{order:1}.se-media__action-icon{color:var(--sapIndicationColor_5);margin-right:8px;width:12px}.se-media__action-icon--basic{font-size:1rem!important;line-height:1.25;font-weight:400}.se-media__action-icon--basic::before{vertical-align:middle}.se-media__action-icon--delete{color:var(--sapIndicationColor_2)}.se-media-action-btn{display:flex;flex-direction:row;align-items:center;padding:0;margin:0;border:none;box-shadow:none;outline:0;background-color:transparent;text-decoration:none;height:32px}.se-media-action-btn[disabled]{cursor:not-allowed;opacity:.4}.se-media-upload-form-wrapper{display:block}.se-media-upload-form-wrapper--spaced{margin-top:16px}.se-media-upload-form__header-folder fd-popover-control .selected-container .se-item-printer{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:156px}.se-media-upload-form__header-folder.is-invalid fd-popover-control .selected-container .fd-button{border-color:#b00}.se-file-selector{display:flex;flex-direction:row;align-items:center}.se-file-selector--disabled .se-file-selector__btn:focus,.se-file-selector--disabled .se-file-selector__btn:hover{cursor:not-allowed}.se-file-selector__btn{display:flex;flex-direction:row;align-items:center;padding:0;margin:0;border:none;box-shadow:none;outline:0;background-color:transparent;text-decoration:none;height:32px;position:relative}.se-file-selector__btn[disabled]{cursor:not-allowed;opacity:.4}.se-file-selector--disabled .se-file-selector__btn:focus,.se-file-selector--disabled .se-file-selector__btn:hover{cursor:not-allowed}.se-file-selector__btn>:first-child{display:block;top:0}.se-file-selector__custombtn{display:flex;flex-direction:row;align-items:center;padding:0;margin:0;border:none;box-shadow:none;outline:0;background-color:transparent;text-decoration:none;height:32px;position:relative}.se-file-selector__custombtn[disabled]{cursor:not-allowed;opacity:.4}.se-file-selector--disabled .se-file-selector__custombtn:focus,.se-file-selector--disabled .se-file-selector__custombtn:hover{cursor:not-allowed}.se-file-selector__custombtn>:first-child{position:absolute;width:100%;height:100%}.se-file-selector__label{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapInformativeColor)}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let kn=class MediaFileSelectorComponent{constructor(e,t){this.injector=e;this.onFileSelect=new n.EventEmitter;if(t){this.initCustomComponent(t)}}ngOnInit(){this.disabled=this.disabled||false;this.customClass=this.customClass||"";this.selectionMode=this.selectionMode||Mn.replace}buildAcceptedFileTypesList(){return this.acceptedFileTypes.map((e=>`.${e}`)).join(",")}isReplaceMode(){return this.selectionMode===Mn.replace}onSelect(e){this.onFileSelect.emit(e)}initCustomComponent({component:e}){this.customComponent={component:e,injector:n.Injector.create({parent:this.injector,providers:[{provide:l.MEDIA_FILE_SELECTOR_CUSTOM_INJECTOR_TOKEN,useValue:{onSelect:e=>this.onSelect(e)}}]})}}};__decorate([n.Input(),__metadata("design:type",String)],kn.prototype,"selectionMode",void 0);__decorate([n.Input(),__metadata("design:type",String)],kn.prototype,"labelI18nKey",void 0);__decorate([n.Input(),__metadata("design:type",Array)],kn.prototype,"acceptedFileTypes",void 0);__decorate([n.Input(),__metadata("design:type",String)],kn.prototype,"customClass",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],kn.prototype,"disabled",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],kn.prototype,"onFileSelect",void 0);kn=__decorate([n.Component({selector:"se-media-file-selector",template:`<div class="se-file-selector" [ngClass]="customClass"><label *ngIf="!disabled" class="se-button se-button--text" [ngClass]="{ 'se-button--disabled': disabled, \n                     'se-file-selector__custombtn': customComponent, \n                     'se-file-selector__btn': !customComponent }"><ng-container *ngIf="customComponent"><ng-container *ngComponentOutlet="customComponent.component; injector: customComponent.injector"></ng-container></ng-container><span class="sap-icon--share se-media__action-icon" [ngClass]="{\n        'sap-icon--share': isReplaceMode(),\n        'sap-icon--upload': !isReplaceMode()\n    }"></span> <span class="se-file-selector__label">{{ labelI18nKey | translate }}</span><ng-container *ngIf="!customComponent"><input type="file" class="hide se-file-selector__input" [accept]="buildAcceptedFileTypesList()" (change)="onSelect($event.target.files)"/></ng-container></label></div>`,styles:[`.se-media-container-field__media-list{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:0 16px}.se-media-container-cell--mobile{order:4}.se-media-container-cell--desktop{order:2}.se-media-container-cell--tablet{order:3}.se-media-container-cell--widescreen{order:1}.se-media__action-icon{color:var(--sapIndicationColor_5);margin-right:8px;width:12px}.se-media__action-icon--basic{font-size:1rem!important;line-height:1.25;font-weight:400}.se-media__action-icon--basic::before{vertical-align:middle}.se-media__action-icon--delete{color:var(--sapIndicationColor_2)}.se-media-action-btn{display:flex;flex-direction:row;align-items:center;padding:0;margin:0;border:none;box-shadow:none;outline:0;background-color:transparent;text-decoration:none;height:32px}.se-media-action-btn[disabled]{cursor:not-allowed;opacity:.4}.se-media-upload-form-wrapper{display:block}.se-media-upload-form-wrapper--spaced{margin-top:16px}.se-media-upload-form__header-folder fd-popover-control .selected-container .se-item-printer{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:156px}.se-media-upload-form__header-folder.is-invalid fd-popover-control .selected-container .fd-button{border-color:#b00}.se-file-selector{display:flex;flex-direction:row;align-items:center}.se-file-selector--disabled .se-file-selector__btn:focus,.se-file-selector--disabled .se-file-selector__btn:hover{cursor:not-allowed}.se-file-selector__btn{display:flex;flex-direction:row;align-items:center;padding:0;margin:0;border:none;box-shadow:none;outline:0;background-color:transparent;text-decoration:none;height:32px;position:relative}.se-file-selector__btn[disabled]{cursor:not-allowed;opacity:.4}.se-file-selector--disabled .se-file-selector__btn:focus,.se-file-selector--disabled .se-file-selector__btn:hover{cursor:not-allowed}.se-file-selector__btn>:first-child{display:block;top:0}.se-file-selector__custombtn{display:flex;flex-direction:row;align-items:center;padding:0;margin:0;border:none;box-shadow:none;outline:0;background-color:transparent;text-decoration:none;height:32px;position:relative}.se-file-selector__custombtn[disabled]{cursor:not-allowed;opacity:.4}.se-file-selector--disabled .se-file-selector__custombtn:focus,.se-file-selector--disabled .se-file-selector__custombtn:hover{cursor:not-allowed}.se-file-selector__custombtn>:first-child{position:absolute;width:100%;height:100%}.se-file-selector__label{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;color:var(--sapInformativeColor)}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(1,n.Optional()),__param(1,n.Inject(l.MEDIA_FILE_SELECTOR_CUSTOM_TOKEN)),__metadata("design:paramtypes",[n.Injector,Object])],kn);window.__smartedit__.addDecoratorPayload("Component","MediaPreviewComponent",{selector:"se-media-preview",template:`<se-tooltip [placement]="'bottom'" [isChevronVisible]="true" [triggers]="['click']"><span se-tooltip-trigger><div class="sap-icon--search se-media-preview__icon"></div></span><div se-tooltip-body><img class="se-media-preview__image" [src]="imageUrl"/></div></se-tooltip>`,styles:[`.se-media-preview{display:block;cursor:pointer;position:absolute;height:24px;width:24px;top:0;right:0}.se-media-preview__icon{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:1rem!important;line-height:1.25;font-weight:400;outline:0;background-color:var(--sapInformativeColor);color:var(--sapBaseColor);height:24px;width:24px}.se-media-preview__image{width:160px;height:auto}`],encapsulation:n.ViewEncapsulation.None,host:{"[class.se-media-preview]":"true"},changeDetection:n.ChangeDetectionStrategy.OnPush});let Nn=class MediaPreviewComponent{};__decorate([n.Input(),__metadata("design:type",String)],Nn.prototype,"imageUrl",void 0);Nn=__decorate([n.Component({selector:"se-media-preview",template:`<se-tooltip [placement]="'bottom'" [isChevronVisible]="true" [triggers]="['click']"><span se-tooltip-trigger><div class="sap-icon--search se-media-preview__icon"></div></span><div se-tooltip-body><img class="se-media-preview__image" [src]="imageUrl"/></div></se-tooltip>`,styles:[`.se-media-preview{display:block;cursor:pointer;position:absolute;height:24px;width:24px;top:0;right:0}.se-media-preview__icon{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:1rem!important;line-height:1.25;font-weight:400;outline:0;background-color:var(--sapInformativeColor);color:var(--sapBaseColor);height:24px;width:24px}.se-media-preview__image{width:160px;height:auto}`],encapsulation:n.ViewEncapsulation.None,host:{"[class.se-media-preview]":"true"},changeDetection:n.ChangeDetectionStrategy.OnPush})],Nn);window.__smartedit__.addDecoratorPayload("Component","MediaRemoveButtonComponent",{selector:"se-media-remove-button",template:`<button type="button" class="se-media-action-btn se-media-remove-btn" [disabled]="isDisabled" (click)="onClick($event)"><span class="se-media__action-icon se-media__action-icon--delete sap-icon--delete"></span> <span class="se-media-remove-btn-txt" [ngClass]="{ 'se-media-remove-btn-txt--disabled': isDisabled }" translate="se.media.format.remove"></span></button>`,styles:[`.se-media-remove-btn-txt{color:var(--sapIndicationColor_2)}.se-media-remove-btn-txt--disabled{color:var(--sapNeutralTextColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Fn=class MediaRemoveButtonComponent{constructor(){this.clickHandler=new n.EventEmitter}onClick(e){e.stopPropagation();this.clickHandler.emit(e)}};__decorate([n.Input(),__metadata("design:type",Boolean)],Fn.prototype,"isDisabled",void 0);__decorate([n.Output(),__metadata("design:type",Object)],Fn.prototype,"clickHandler",void 0);Fn=__decorate([n.Component({selector:"se-media-remove-button",template:`<button type="button" class="se-media-action-btn se-media-remove-btn" [disabled]="isDisabled" (click)="onClick($event)"><span class="se-media__action-icon se-media__action-icon--delete sap-icon--delete"></span> <span class="se-media-remove-btn-txt" [ngClass]="{ 'se-media-remove-btn-txt--disabled': isDisabled }" translate="se.media.format.remove"></span></button>`,styles:[`.se-media-remove-btn-txt{color:var(--sapIndicationColor_2)}.se-media-remove-btn-txt--disabled{color:var(--sapNeutralTextColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush})],Fn);let zn=class MediaAdvancedPropertiesCustomDirective{constructor(e){this.viewContainerRef=e}};zn=__decorate([n.Directive({selector:"[seMediaAdvancedPropertiesCustom]"}),__metadata("design:paramtypes",[n.ViewContainerRef])],zn);window.__smartedit__.addDecoratorPayload("Component","MediaAdvancedPropertiesComponent",{selector:"se-media-advanced-properties",template:`<se-tooltip [placement]="'bottom'" [isChevronVisible]="true" [triggers]="['click']" class="se-media-advanced-info" (click)="onClick($event)"><span se-tooltip-trigger class="se-media-advanced-info__trigger"><span class="sap-icon--message-information se-media__action-icon se-media__action-icon--basic" [title]="i18nKeys.INFORMATION | translate"></span><se-media-action-label [i18nKey]="i18nKeys.INFORMATION"></se-media-action-label></span><div se-tooltip-body><div class="se-media-advanced-info-body"><div class="se-media-advanced-info-row advanced-information-description" *ngIf="media.description"><div class="se-media-advanced-info-row__label se-control-label" [translate]="i18nKeys.DESCRIPTION"></div><div id="se-media-advanced-info-description-id" class="se-media-advanced-info-row__description">{{ media.description }}</div></div><div class="se-media-advanced-info-row advanced-information-code"><div class="se-media-advanced-info-row__label se-control-label" [translate]="i18nKeys.CODE"></div><div id="se-media-advanced-info-code-id" class="se-media-advanced-info-row__description">{{ media.code }}</div></div><div class="se-media-advanced-info-row advanced-information-alt-text" *ngIf="media.altText"><div class="se-media-advanced-info-row__label se-control-label" [translate]="i18nKeys.ALT_TEXT"></div><div id="se-media-advanced-info-altText-id" class="se-media-advanced-info-row__description">{{ media.altText }}</div></div><ng-template seMediaAdvancedPropertiesCustom></ng-template></div></div></se-tooltip>`,styles:[`.se-media-container-field__media-list{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:0 16px}.se-media-container-cell--mobile{order:4}.se-media-container-cell--desktop{order:2}.se-media-container-cell--tablet{order:3}.se-media-container-cell--widescreen{order:1}.se-media__action-icon{color:var(--sapIndicationColor_5);margin-right:8px;width:12px}.se-media__action-icon--basic{font-size:1rem!important;line-height:1.25;font-weight:400}.se-media__action-icon--basic::before{vertical-align:middle}.se-media__action-icon--delete{color:var(--sapIndicationColor_2)}.se-media-action-btn{display:flex;flex-direction:row;align-items:center;padding:0;margin:0;border:none;box-shadow:none;outline:0;background-color:transparent;text-decoration:none;height:32px}.se-media-action-btn[disabled]{cursor:not-allowed;opacity:.4}.se-media-upload-form-wrapper{display:block}.se-media-upload-form-wrapper--spaced{margin-top:16px}.se-media-upload-form__header-folder fd-popover-control .selected-container .se-item-printer{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:156px}.se-media-upload-form__header-folder.is-invalid fd-popover-control .selected-container .fd-button{border-color:#b00}.se-media-advanced-info{display:flex;flex-direction:row;align-items:center;display:inline-flex;height:32px;outline:0}.se-media-advanced-info__trigger{display:flex;align-items:center}.se-media-advanced-info-body{padding:11px}.se-media-advanced-info-row:not(:last-child){margin-bottom:16px}.se-media-advanced-info-row__description{color:var(--sapTextColor);word-break:break-all;max-width:95%}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Ln=class MediaAdvancedPropertiesComponent{constructor(e,t){this.resolver=e;this.mediaAdvancedPropertiesCustom=t;this.i18nKeys={DESCRIPTION:"se.media.advanced.information.description",CODE:"se.media.advanced.information.code",ALT_TEXT:"se.media.advanced.information.alt.text",ADVANCED_INFORMATION:"se.media.advanced.information",INFORMATION:"se.media.information"}}ngOnChanges(e){const t=e.media;if(t&&this.customComponentRef){this.customComponentRef.instance.media=t.currentValue}}ngOnInit(){this.loadMediaAdvancedPropertiesCustomComponent()}onClick(e){e.stopPropagation()}loadMediaAdvancedPropertiesCustomComponent(){if(!this.mediaAdvancedPropertiesCustom){return}const e=this.resolver.resolveComponentFactory(this.mediaAdvancedPropertiesCustom.component);const t=this.mediaAdvancedPropertiesCustomDirective.viewContainerRef;t.clear();this.customComponentRef=t.createComponent(e);this.customComponentRef.instance.media=this.media}};__decorate([n.Input(),__metadata("design:type",Object)],Ln.prototype,"media",void 0);__decorate([n.ViewChild(zn,{static:true}),__metadata("design:type",zn)],Ln.prototype,"mediaAdvancedPropertiesCustomDirective",void 0);Ln=__decorate([n.Component({selector:"se-media-advanced-properties",template:`<se-tooltip [placement]="'bottom'" [isChevronVisible]="true" [triggers]="['click']" class="se-media-advanced-info" (click)="onClick($event)"><span se-tooltip-trigger class="se-media-advanced-info__trigger"><span class="sap-icon--message-information se-media__action-icon se-media__action-icon--basic" [title]="i18nKeys.INFORMATION | translate"></span><se-media-action-label [i18nKey]="i18nKeys.INFORMATION"></se-media-action-label></span><div se-tooltip-body><div class="se-media-advanced-info-body"><div class="se-media-advanced-info-row advanced-information-description" *ngIf="media.description"><div class="se-media-advanced-info-row__label se-control-label" [translate]="i18nKeys.DESCRIPTION"></div><div id="se-media-advanced-info-description-id" class="se-media-advanced-info-row__description">{{ media.description }}</div></div><div class="se-media-advanced-info-row advanced-information-code"><div class="se-media-advanced-info-row__label se-control-label" [translate]="i18nKeys.CODE"></div><div id="se-media-advanced-info-code-id" class="se-media-advanced-info-row__description">{{ media.code }}</div></div><div class="se-media-advanced-info-row advanced-information-alt-text" *ngIf="media.altText"><div class="se-media-advanced-info-row__label se-control-label" [translate]="i18nKeys.ALT_TEXT"></div><div id="se-media-advanced-info-altText-id" class="se-media-advanced-info-row__description">{{ media.altText }}</div></div><ng-template seMediaAdvancedPropertiesCustom></ng-template></div></div></se-tooltip>`,styles:[`.se-media-container-field__media-list{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:0 16px}.se-media-container-cell--mobile{order:4}.se-media-container-cell--desktop{order:2}.se-media-container-cell--tablet{order:3}.se-media-container-cell--widescreen{order:1}.se-media__action-icon{color:var(--sapIndicationColor_5);margin-right:8px;width:12px}.se-media__action-icon--basic{font-size:1rem!important;line-height:1.25;font-weight:400}.se-media__action-icon--basic::before{vertical-align:middle}.se-media__action-icon--delete{color:var(--sapIndicationColor_2)}.se-media-action-btn{display:flex;flex-direction:row;align-items:center;padding:0;margin:0;border:none;box-shadow:none;outline:0;background-color:transparent;text-decoration:none;height:32px}.se-media-action-btn[disabled]{cursor:not-allowed;opacity:.4}.se-media-upload-form-wrapper{display:block}.se-media-upload-form-wrapper--spaced{margin-top:16px}.se-media-upload-form__header-folder fd-popover-control .selected-container .se-item-printer{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:156px}.se-media-upload-form__header-folder.is-invalid fd-popover-control .selected-container .fd-button{border-color:#b00}.se-media-advanced-info{display:flex;flex-direction:row;align-items:center;display:inline-flex;height:32px;outline:0}.se-media-advanced-info__trigger{display:flex;align-items:center}.se-media-advanced-info-body{padding:11px}.se-media-advanced-info-row:not(:last-child){margin-bottom:16px}.se-media-advanced-info-row__description{color:var(--sapTextColor);word-break:break-all;max-width:95%}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(1,n.Optional()),__param(1,n.Inject(l.MEDIA_ADVANCED_PROPERTIES_CUSTOM_TOKEN)),__metadata("design:paramtypes",[n.ComponentFactoryResolver,Object])],Ln);window.__smartedit__.addDecoratorPayload("Component","MediaPrinterComponent",{selector:"se-media-printer",template:`<div class="se-media-selector" *ngIf="isSelected"><span class="se-media-selector__left-section se-media-preview-container"><div *ngIf="isImage()" class="se-media-selector__left-section se-media-preview-container"><se-media-preview [imageUrl]="getSafeUrl()"></se-media-preview><img class="se-media-preview__image-thumbnail" [alt]="media.code" [src]="getSafeUrl()"/></div><div *ngIf="isVideo()" class="se-media-selector__left-section se-media-preview-container"><video class="se-media-preview__image-thumbnail" controls><source [src]="getSafeUrl()" type="video/mp4"/></video></div><div *ngIf="isPdf()" class="se-media-selector__left-section se-media-preview-container"><iframe class="se-media-preview__image-thumbnail" [src]="getSafeUrl()" style="width: 100%; height: 100%; border: none"></iframe></div></span><span class="se-media-selector__right-section"><se-media-advanced-properties [media]="media"></se-media-advanced-properties><button class="se-media-action-btn replace-image" [disabled]="isDisabled()"><span class="sap-icon--share se-media__action-icon"></span><se-media-action-label [state]="isDisabled() ? 'disabled' : null" [i18nKey]="'se.upload.image.replace'"></se-media-action-label></button><se-media-remove-button [isDisabled]="isDisabled()" (clickHandler)="select.removeSelectedOption($event, media)"></se-media-remove-button></span></div><div class="se-media-selector__search" *ngIf="!isSelected"><div *ngIf="isImage()" class="se-media-selector__search-img-wrapper"><img [src]="getSafeUrl()" class="se-media-selector__search-img" [alt]="media.code"/></div><div *ngIf="isVideo()" class="se-media-selector__search-img-wrapper"><video class="se-media-selector__search-img" controls><source [src]="getSafeUrl()" type="video/mp4"/></video></div><div *ngIf="isPdf()" class="se-media-selector__search-img-wrapper"><iframe class="se-media-selector__search-img" [src]="getSafeUrl()" style="width: 100%; height: 100%; border: none"></iframe></div><div class="se-media-selector__search-name">{{ media.code }}</div></div>`,styles:[`se-media-printer .se-media-selector{display:flex;flex-direction:row;align-items:center;position:relative}se-media-printer .se-media-selector__left-section{display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:var(--sapNeutralBackground);position:relative;width:135px;height:80px}se-media-printer .se-media-selector__right-section{display:flex;flex-direction:column;margin-left:20px!important}se-media-printer .se-media-selector__right-section>*{margin-left:0!important}se-media-printer .se-media-selector__search{display:flex;flex-direction:row;align-items:center}se-media-printer .se-media-selector__search-img-wrapper{display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:var(--sapNeutralBackground);width:135px;height:80px;margin-right:16px}se-media-printer .se-media-selector__search-img{max-width:100%;max-height:100%;margin:5px}se-media-printer .se-media-selector__search-name{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:70%}`,`.se-media-preview-container{position:relative}.se-media-preview-container .se-media-preview__image-wrapper{display:flex;flex-direction:row;align-items:center;justify-content:center;height:75px;background-color:var(--sapShell_Background)}.se-media-preview-container .se-media-preview__image-thumbnail{max-width:100%;max-height:100%}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let Vn=class MediaPrinterComponent{constructor(e,t){this.data=e;this.sanitizer=t;({item:this.media,selected:this.isSelected,select:this.select}=e)}isDisabled(){return this.select.isReadOnly}isImage(){return!this.isVideo()&&!this.isPdf()}isVideo(){return this.media.mime&&this.media.mime.includes(l.GenericEditorMediaType.VIDEO)}isPdf(){return this.media.mime&&this.media.mime.includes(l.GenericEditorMediaType.PDF_DOCUMENT)}getSafeUrl(){return this.sanitizer.bypassSecurityTrustResourceUrl(this.media.url)}};Vn=__decorate([n.Component({selector:"se-media-printer",template:`<div class="se-media-selector" *ngIf="isSelected"><span class="se-media-selector__left-section se-media-preview-container"><div *ngIf="isImage()" class="se-media-selector__left-section se-media-preview-container"><se-media-preview [imageUrl]="getSafeUrl()"></se-media-preview><img class="se-media-preview__image-thumbnail" [alt]="media.code" [src]="getSafeUrl()"/></div><div *ngIf="isVideo()" class="se-media-selector__left-section se-media-preview-container"><video class="se-media-preview__image-thumbnail" controls><source [src]="getSafeUrl()" type="video/mp4"/></video></div><div *ngIf="isPdf()" class="se-media-selector__left-section se-media-preview-container"><iframe class="se-media-preview__image-thumbnail" [src]="getSafeUrl()" style="width: 100%; height: 100%; border: none"></iframe></div></span><span class="se-media-selector__right-section"><se-media-advanced-properties [media]="media"></se-media-advanced-properties><button class="se-media-action-btn replace-image" [disabled]="isDisabled()"><span class="sap-icon--share se-media__action-icon"></span><se-media-action-label [state]="isDisabled() ? 'disabled' : null" [i18nKey]="'se.upload.image.replace'"></se-media-action-label></button><se-media-remove-button [isDisabled]="isDisabled()" (clickHandler)="select.removeSelectedOption($event, media)"></se-media-remove-button></span></div><div class="se-media-selector__search" *ngIf="!isSelected"><div *ngIf="isImage()" class="se-media-selector__search-img-wrapper"><img [src]="getSafeUrl()" class="se-media-selector__search-img" [alt]="media.code"/></div><div *ngIf="isVideo()" class="se-media-selector__search-img-wrapper"><video class="se-media-selector__search-img" controls><source [src]="getSafeUrl()" type="video/mp4"/></video></div><div *ngIf="isPdf()" class="se-media-selector__search-img-wrapper"><iframe class="se-media-selector__search-img" [src]="getSafeUrl()" style="width: 100%; height: 100%; border: none"></iframe></div><div class="se-media-selector__search-name">{{ media.code }}</div></div>`,styles:[`se-media-printer .se-media-selector{display:flex;flex-direction:row;align-items:center;position:relative}se-media-printer .se-media-selector__left-section{display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:var(--sapNeutralBackground);position:relative;width:135px;height:80px}se-media-printer .se-media-selector__right-section{display:flex;flex-direction:column;margin-left:20px!important}se-media-printer .se-media-selector__right-section>*{margin-left:0!important}se-media-printer .se-media-selector__search{display:flex;flex-direction:row;align-items:center}se-media-printer .se-media-selector__search-img-wrapper{display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:var(--sapNeutralBackground);width:135px;height:80px;margin-right:16px}se-media-printer .se-media-selector__search-img{max-width:100%;max-height:100%;margin:5px}se-media-printer .se-media-selector__search-name{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:70%}`,`.se-media-preview-container{position:relative}.se-media-preview-container .se-media-preview__image-wrapper{display:flex;flex-direction:row;align-items:center;justify-content:center;height:75px;background-color:var(--sapShell_Background)}.se-media-preview-container .se-media-preview__image-thumbnail{max-width:100%;max-height:100%}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object,a.DomSanitizer])],Vn);window.__smartedit__.addDecoratorPayload("Component","MediaSelectorComponent",{selector:"se-media-selector",template:`<div class="media-selector"><se-select [id]="id" [(model)]="mediaId" (modelChange)="onMediaIdChange($event)" [fetchStrategy]="fetchStrategy" [isReadOnly]="isDisabled" [itemComponent]="mediaPrinterComponent"></se-select></div>`,styles:[`se-media-selector .se-select [has-selected-option] .toggle-button{min-height:100px}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush});let Un=class MediaSelectorComponent{constructor(e){this.mediaService=e;this.mediaPrinterComponent=Vn;this.mediaIdChange=new n.EventEmitter}ngOnInit(){this.fetchStrategy={fetchEntity:e=>this.mediaService.getMedia(e),fetchPage:(e,t,i)=>this.mediaService.getPage(e,t,i,this.mimeType)}}onMediaIdChange(e){this.mediaId=e;this.mediaIdChange.emit(e)}};__decorate([n.Input(),__metadata("design:type",String)],Un.prototype,"id",void 0);__decorate([n.Input(),__metadata("design:type",String)],Un.prototype,"mediaId",void 0);__decorate([n.Input(),__metadata("design:type",String)],Un.prototype,"mimeType",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Un.prototype,"mediaIdChange",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],Un.prototype,"isDisabled",void 0);Un=__decorate([n.Component({selector:"se-media-selector",template:`<div class="media-selector"><se-select [id]="id" [(model)]="mediaId" (modelChange)="onMediaIdChange($event)" [fetchStrategy]="fetchStrategy" [isReadOnly]="isDisabled" [itemComponent]="mediaPrinterComponent"></se-select></div>`,styles:[`se-media-selector .se-select [has-selected-option] .toggle-button{min-height:100px}`],encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.IMediaService])],Un);let Bn=class MediaUploadFieldsCustomDirective{constructor(e){this.viewContainerRef=e}};Bn=__decorate([n.Directive({selector:"[seMediaUploadFieldsCustom]"}),__metadata("design:paramtypes",[n.ViewContainerRef])],Bn);window.__smartedit__.addDecoratorPayload("Component","MediaUploadFormComponent",{selector:"se-media-upload-form",template:`<div class="se-media-upload-form"><div class="se-media-upload-form__header"><div class="se-media-upload-form__header-content"><div class="se-media-upload-form__header-title" translate="se.upload.image.to.folder"></div><se-select id="se-media-upload-form__header-folder" class="se-media-upload-form__header-folder" [ngClass]="{ 'is-invalid': hasError() }" [multiSelect]="false" [controls]="false" [(model)]="folderSelected" (modelChange)="folderSelectedChanged($event)" [fetchStrategy]="folderFetchStrategy" [placeholder]="folderSelected"></se-select><div class="se-media-upload-form__header-actions"><button id="se-media-upload-btn-id__cancel" type="button" class="fd-button--transparent se-media-upload-btn__cancel fd-button--compact" fd-button [label]="'se.upload.image.cancel' | translate" (click)="cancel()"></button> <button id="se-media-upload-btn-id__submit" type="button" class="se-media-upload-btn__submit fd-button--compact" fd-button [label]="'se.upload.image.submit' | translate" (click)="uploadMedia()"></button></div></div><div class="se-media-upload-form__header-error"><span class="upload-field-error fd-form__message fd-form__message--error" *ngFor="let error of folderErrors">{{ error | translate }}</span></div></div><div class="se-media-upload-form__replace-file"><div class="se-media-upload-form__file-name">{{ image.name }}</div><se-media-file-selector [labelI18nKey]="'se.upload.image.replace'" [acceptedFileTypes]="acceptedFileTypes" (onFileSelect)="onFileSelect($event)"></se-media-file-selector></div><form class="se-media-upload-form__file-info"><se-media-upload-field [fieldName]="'code'" [fieldValue]="imageParams?.code" [fieldErrors]="getErrorsForFieldByCode('code')" [isRequired]="true" [labelI18nKey]="'se.uploaded.image.code'" (fieldValueChange)="onChangeFieldValue($event, 'code')"></se-media-upload-field><se-media-upload-field [fieldName]="'description'" [fieldValue]="imageParams?.description" [fieldErrors]="getErrorsForFieldByCode('description')" [isRequired]="true" [labelI18nKey]="'se.uploaded.image.description'" (fieldValueChange)="onChangeFieldValue($event, 'description')"></se-media-upload-field><se-media-upload-field [fieldName]="'alt-text'" [fieldValue]="imageParams?.altText" [fieldErrors]="getErrorsForFieldByCode('altText')" [isRequired]="true" [labelI18nKey]="'se.uploaded.image.alt.text'" (fieldValueChange)="onChangeFieldValue($event, 'altText')"></se-media-upload-field><ng-template seMediaUploadFieldsCustom></ng-template></form><se-spinner [isSpinning]="isUploading"></se-spinner></div>`,styles:[`.se-media-upload-form{box-shadow:0 6px 12px rgba(0,0,0,.175);border-radius:4px}.se-media-upload-form__header{border-bottom:1px solid var(--sapGroup_ContentBorderColor);display:flex;flex-direction:column}.se-media-upload-form__header-content{display:flex;flex-direction:row;align-items:center;justify-content:space-between;height:53px;padding:20px}.se-media-upload-form__header-title{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-media-upload-form__header-folder{width:200px;margin-left:8px;margin-right:auto}.se-media-upload-form__header-error{padding-left:20px}.se-media-upload-form__replace-file{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:16px 20px 0}.se-media-upload-form__file-name{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:80%}.se-media-upload-form__file-info{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:16px;padding:20px}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let jn=class MediaUploadFormComponent{constructor(e,t,i,o,s,a,r,l){this.cdr=e;this.fileValidatorFactory=t;this.mediaBackendValidationHandler=i;this.mediaUploaderService=o;this.mediaFolderService=s;this.mediaUtilService=a;this.resolver=r;this.mediaUploadFieldsCustom=l;this.subscriptions=[];this.customFields=null;this.onCancel=new n.EventEmitter;this.onSelect=new n.EventEmitter;this.onUploadSuccess=new n.EventEmitter;this.fieldErrors=[];this.imageParams=null;this.fileValidator=this.fileValidatorFactory.build([{subject:"code",message:"se.uploaded.image.code.is.required",validate:e=>!!e}])}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.acceptedFileTypes=this.mediaUtilService.getAcceptedFileTypes(this.allowMediaType);this.folderFetchStrategy=this.mediaFolderService.mediaFoldersFetchStrategy;this.folderSelected=yield this.mediaFolderService.getDefaultFolder();this.loadMediaUploadFieldsCustom();this.cdr.markForCheck()}))}ngOnDestroy(){this.subscriptions.forEach((e=>e.unsubscribe()))}ngOnChanges(e){const t=e.image;if(t){let e;if(typeof this.image==="string"){e=this.image}else{e=this.image.name}this.imageParams={code:e,description:e,altText:e}}}getErrorsForFieldByCode(e){return this.fieldErrors.filter((t=>t.subject===e)).map((e=>e.message))}uploadMedia(){return __awaiter(this,void 0,void 0,(function*(){this.fieldErrors=[];if(!this.fileValidator.validate(this.imageParams,this.maxUploadFileSize,this.fieldErrors)){return}if(typeof this.image==="object"){const e=this.acceptedFileTypes.filter((e=>this.image&&this.image.type&&this.image.type.includes(e)));if(!e||e&&e.length<1){this.fieldErrors.push({subject:"code",message:l.FILE_VALIDATION_CONFIG.I18N_KEYS.FILE_TYPE_INVALID});return}}this.isUploading=true;try{const e={code:l.stringUtils.escapeHtml(this.imageParams.code),description:l.stringUtils.escapeHtml(this.imageParams.description),altText:l.stringUtils.escapeHtml(this.imageParams.altText),folder:this.folderSelected?this.folderSelected:""};if(this.customFields){Object.getOwnPropertyNames(this.customFields).forEach((t=>{e[t]=l.stringUtils.escapeHtml(this.customFields[t])}))}if(typeof this.image==="string"){e.url=this.image}else{e.file=this.image}this.onMediaUploadSuccess(yield this.mediaUploaderService.uploadMedia(e))}catch(e){this.onMediaUploadFail(e)}finally{this.isUploading=false}if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}cancel(){this.reset();this.onCancel.emit()}onChangeFieldValue(e,t){this.imageParams[t]=e}onFileSelect(e){this.onSelect.emit(e)}hasError(){var e;return((e=this.folderErrors)===null||e===void 0?void 0:e.length)>0}folderSelectedChanged(e){this.folderErrors=[]}onMediaUploadSuccess({uuid:e}){this.reset();this.onUploadSuccess.emit(e)}onMediaUploadFail(e){this.mediaBackendValidationHandler.handleResponse(e,this.fieldErrors);this.folderErrors=this.fieldErrors.filter((e=>e.subject==="folder")).map((e=>e.message))}reset(){this.imageParams=null;this.fieldErrors=[];this.isUploading=false}loadMediaUploadFieldsCustom(){if(!this.mediaUploadFieldsCustom){return}const e=this.resolver.resolveComponentFactory(this.mediaUploadFieldsCustom.component);const t=this.mediaUploadFieldsCustomDirective.viewContainerRef;t.clear();const i=t.createComponent(e);i.instance.image=this.image;this.subscriptions.push(i.instance.customFieldsChange.subscribe((e=>{this.customFields=e})))}};__decorate([n.Input(),__metadata("design:type",Object)],jn.prototype,"image",void 0);__decorate([n.Input(),__metadata("design:type",String)],jn.prototype,"allowMediaType",void 0);__decorate([n.Input(),__metadata("design:type",Number)],jn.prototype,"maxUploadFileSize",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],jn.prototype,"onCancel",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],jn.prototype,"onSelect",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],jn.prototype,"onUploadSuccess",void 0);__decorate([n.ViewChild(Bn,{static:true}),__metadata("design:type",Bn)],jn.prototype,"mediaUploadFieldsCustomDirective",void 0);jn=__decorate([n.Component({selector:"se-media-upload-form",template:`<div class="se-media-upload-form"><div class="se-media-upload-form__header"><div class="se-media-upload-form__header-content"><div class="se-media-upload-form__header-title" translate="se.upload.image.to.folder"></div><se-select id="se-media-upload-form__header-folder" class="se-media-upload-form__header-folder" [ngClass]="{ 'is-invalid': hasError() }" [multiSelect]="false" [controls]="false" [(model)]="folderSelected" (modelChange)="folderSelectedChanged($event)" [fetchStrategy]="folderFetchStrategy" [placeholder]="folderSelected"></se-select><div class="se-media-upload-form__header-actions"><button id="se-media-upload-btn-id__cancel" type="button" class="fd-button--transparent se-media-upload-btn__cancel fd-button--compact" fd-button [label]="'se.upload.image.cancel' | translate" (click)="cancel()"></button> <button id="se-media-upload-btn-id__submit" type="button" class="se-media-upload-btn__submit fd-button--compact" fd-button [label]="'se.upload.image.submit' | translate" (click)="uploadMedia()"></button></div></div><div class="se-media-upload-form__header-error"><span class="upload-field-error fd-form__message fd-form__message--error" *ngFor="let error of folderErrors">{{ error | translate }}</span></div></div><div class="se-media-upload-form__replace-file"><div class="se-media-upload-form__file-name">{{ image.name }}</div><se-media-file-selector [labelI18nKey]="'se.upload.image.replace'" [acceptedFileTypes]="acceptedFileTypes" (onFileSelect)="onFileSelect($event)"></se-media-file-selector></div><form class="se-media-upload-form__file-info"><se-media-upload-field [fieldName]="'code'" [fieldValue]="imageParams?.code" [fieldErrors]="getErrorsForFieldByCode('code')" [isRequired]="true" [labelI18nKey]="'se.uploaded.image.code'" (fieldValueChange)="onChangeFieldValue($event, 'code')"></se-media-upload-field><se-media-upload-field [fieldName]="'description'" [fieldValue]="imageParams?.description" [fieldErrors]="getErrorsForFieldByCode('description')" [isRequired]="true" [labelI18nKey]="'se.uploaded.image.description'" (fieldValueChange)="onChangeFieldValue($event, 'description')"></se-media-upload-field><se-media-upload-field [fieldName]="'alt-text'" [fieldValue]="imageParams?.altText" [fieldErrors]="getErrorsForFieldByCode('altText')" [isRequired]="true" [labelI18nKey]="'se.uploaded.image.alt.text'" (fieldValueChange)="onChangeFieldValue($event, 'altText')"></se-media-upload-field><ng-template seMediaUploadFieldsCustom></ng-template></form><se-spinner [isSpinning]="isUploading"></se-spinner></div>`,styles:[`.se-media-upload-form{box-shadow:0 6px 12px rgba(0,0,0,.175);border-radius:4px}.se-media-upload-form__header{border-bottom:1px solid var(--sapGroup_ContentBorderColor);display:flex;flex-direction:column}.se-media-upload-form__header-content{display:flex;flex-direction:row;align-items:center;justify-content:space-between;height:53px;padding:20px}.se-media-upload-form__header-title{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-media-upload-form__header-folder{width:200px;margin-left:8px;margin-right:auto}.se-media-upload-form__header-error{padding-left:20px}.se-media-upload-form__replace-file{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:16px 20px 0}.se-media-upload-form__file-name{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:80%}.se-media-upload-form__file-info{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:16px;padding:20px}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(7,n.Optional()),__param(7,n.Inject(l.MEDIA_UPLOAD_FIELDS_CUSTOM_TOKEN)),__metadata("design:paramtypes",[n.ChangeDetectorRef,l.FileValidatorFactory,_n,l.IMediaToUpload,vn,fn,n.ComponentFactoryResolver,Object])],jn);window.__smartedit__.addDecoratorPayload("Component","MediaUploadFieldComponent",{selector:"se-media-upload-field",template:`<div class="se-media-upload__file-info-field" [ngClass]="getContainerClassName()"><label class="se-control-label" [ngClass]="{ 'se-media-upload-has-error': hasError(), required: isRequired }" [translate]="labelI18nKey"></label> <input fd-form-control type="text" [state]="hasError()? 'error': ''" [attr.name]="fieldName" [ngModel]="fieldValue" (ngModelChange)="onChangeValue($event)"/> <span class="upload-field-error fd-form__message se-generic-editor__error" [ngClass]="getErrorClassName()" *ngFor="let error of fieldErrors">{{ error | translate }}</span></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush});let Gn=class MediaUploadFieldComponent{constructor(){this.isRequired=false;this.fieldValueChange=new n.EventEmitter}onChangeValue(e){this.fieldValueChange.emit(e)}hasError(){var e;return((e=this.fieldErrors)===null||e===void 0?void 0:e.length)>0}getContainerClassName(){return`se-media-upload__file-info-field--${this.fieldName}`}getErrorClassName(){return`upload-field-error--${this.fieldName}`}};__decorate([n.Input(),__metadata("design:type",String)],Gn.prototype,"fieldValue",void 0);__decorate([n.Input(),__metadata("design:type",String)],Gn.prototype,"fieldName",void 0);__decorate([n.Input(),__metadata("design:type",Array)],Gn.prototype,"fieldErrors",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Gn.prototype,"isRequired",void 0);__decorate([n.Input(),__metadata("design:type",String)],Gn.prototype,"labelI18nKey",void 0);__decorate([n.Output(),__metadata("design:type",Object)],Gn.prototype,"fieldValueChange",void 0);Gn=__decorate([n.Component({selector:"se-media-upload-field",template:`<div class="se-media-upload__file-info-field" [ngClass]="getContainerClassName()"><label class="se-control-label" [ngClass]="{ 'se-media-upload-has-error': hasError(), required: isRequired }" [translate]="labelI18nKey"></label> <input fd-form-control type="text" [state]="hasError()? 'error': ''" [attr.name]="fieldName" [ngModel]="fieldValue" (ngModelChange)="onChangeValue($event)"/> <span class="upload-field-error fd-form__message se-generic-editor__error" [ngClass]="getErrorClassName()" *ngFor="let error of fieldErrors">{{ error | translate }}</span></div>`,changeDetection:n.ChangeDetectionStrategy.OnPush})],Gn);let Hn=class MediaModule{};Hn=__decorate([n.NgModule({imports:[l.TranslationModule.forChild(),g.CommonModule,s.FormsModule,l.TooltipModule,l.SelectModule,l.SpinnerModule,l.GenericEditorDropdownModule,l.MessageModule,u.ButtonModule,f.FormModule],providers:[_n,vn,fn,{provide:l.MEDIA_SELECTOR_I18N_KEY_TOKEN,useValue:l.MEDIA_SELECTOR_I18N_KEY},l.moduleUtils.bootstrap((e=>void 0),[l.IFileValidation])],declarations:[xn,kn,Nn,Ln,Un,Vn,hn,Fn,Dn,Rn,jn,Gn,Cn,En,An,Tn,Bn,zn],entryComponents:[xn,kn,Nn,Ln,Un,Vn,hn,Fn,Dn,Rn,jn,Gn,Cn,En,Tn]})],Hn);window.__smartedit__.addDecoratorPayload("Component","MissingPrimaryContentPageComponent",{selector:"se-component-missing-primary-content-page",template:`<div><div><label class="missing-primary-content-page-message__label" [translate]="'se.cms.page.restore.content.page.noprimaryforvariation.msg'"></label></div><se-select id="se-page-restore-change-primary-selector-dropdown" [(model)]="cmsPage.label" [fetchStrategy]="fetchStrategy"></se-select></div>`,styles:[`.missing-primary-content-page-message__label{font-style:italic;padding-bottom:10px;display:block}`]});let Wn=class MissingPrimaryContentPageComponent{constructor(e,t,i){this.data=e;this.pageService=t;this.logService=i;this.CONTENT_PAGE_TYPE_CODE="ContentPage";this.ERROR_MSG="[MissingPrimaryContentPageComponent] - Cannot retrieve list of alternative content primary pages.";({model:this.cmsPage}=e)}ngOnInit(){this.fetchStrategy={fetchEntity:()=>this.fetchEntity(),fetchPage:(e,t,i)=>this.fetchPage(e,t,i)}}fetchEntity(){return Promise.resolve(this.getSelectItemFromPrimaryPage(this.cmsPage))}fetchPage(e,t,i){return __awaiter(this,void 0,void 0,(function*(){try{const o=yield this.pageService.getPaginatedPrimaryPagesForPageType(this.CONTENT_PAGE_TYPE_CODE,null,{search:e,pageSize:t,currentPage:i});const n={pagination:o.pagination,results:null};n.results=o.response.map((e=>this.getSelectItemFromPrimaryPage(e)));return n}catch(e){this.logService.warn(this.ERROR_MSG,e);return Promise.reject()}}))}getSelectItemFromPrimaryPage(e){return{id:e.label,label:e.name}}};Wn=__decorate([n.Component({selector:"se-component-missing-primary-content-page",template:`<div><div><label class="missing-primary-content-page-message__label" [translate]="'se.cms.page.restore.content.page.noprimaryforvariation.msg'"></label></div><se-select id="se-page-restore-change-primary-selector-dropdown" [(model)]="cmsPage.label" [fetchStrategy]="fetchStrategy"></se-select></div>`,styles:[`.missing-primary-content-page-message__label{font-style:italic;padding-bottom:10px;display:block}`]}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,l.IPageService,l.LogService])],Wn);window.__smartedit__.addDecoratorPayload("Component","DuplicatePrimaryNonContentPageComponent",{selector:"se-component-duplicate-primary-non-content-page",template:`<div><label [translate]="label"></label></div>`});let $n=class DuplicatePrimaryNonContentPageComponent{constructor(e){this.data=e;this.PRODUCT_PAGE="ProductPage";this.labelI18nKeys={restoreCategory:"se.cms.page.restore.category.duplicate.primaryforvariation.error",restoreProduct:"se.cms.page.restore.product.duplicate.primaryforvariation.error"};({model:this.page}=e)}ngOnInit(){this.page.replace=true;this.label=this.page.typeCode===this.PRODUCT_PAGE?this.labelI18nKeys.restoreProduct:this.labelI18nKeys.restoreCategory}};$n=__decorate([n.Component({selector:"se-component-duplicate-primary-non-content-page",template:`<div><label [translate]="label"></label></div>`}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object])],$n);window.__smartedit__.addDecoratorPayload("Component","DuplicatePrimaryContentPageLabelComponent",{selector:"se-component-duplicate-primary-content-page-label",template:`<div><div class="fd-form__item fd-form__item--check"><input class="fd-form__control" type="radio" name="duplicateResolution" id="overwritePrimaryPageOption" [(ngModel)]="conflictResolution" (click)="selectResolution(RESOLUTION_OPTIONS.overwritePage)" [value]="RESOLUTION_OPTIONS.overwritePage"/> <label for="overwritePrimaryPageOption" class="fd-form__label" [translate]="'se.cms.page.restore.content.duplicate.primaryforvariation.option.overwrite'"></label></div><div class="fd-form__item fd-form__item--check"><input class="fd-form__control" type="radio" name="duplicateResolution" id="renamePrimaryPageOption" [(ngModel)]="conflictResolution" (click)="selectResolution(RESOLUTION_OPTIONS.renamePageLabel)" [value]="RESOLUTION_OPTIONS.renamePageLabel"/> <label for="renamePrimaryPageOption" class="fd-form__label" [translate]="'se.cms.page.restore.content.duplicate.primaryforvariation.option.rename'"></label></div><div class="rename-label-section" *ngIf="conflictResolution === RESOLUTION_OPTIONS.renamePageLabel"><label fd-form-label [translate]="'se.cms.page.restore.page.label'"></label> <input type="text" fd-form-control [(ngModel)]="page['label']"/></div></div>`,styles:[`.rename-label-section{display:block}`]});let Kn=class DuplicatePrimaryContentPageLabelComponent{constructor(e){this.data=e;this.conflictResolution=null;this.RESOLUTION_OPTIONS={overwritePage:1,renamePageLabel:2};({model:this.page}=e);this.conflictResolution=this.RESOLUTION_OPTIONS.overwritePage;this.page.replace=true}selectResolution(e){this.page.replace=e===this.RESOLUTION_OPTIONS.overwritePage}};Kn=__decorate([n.Component({selector:"se-component-duplicate-primary-content-page-label",template:`<div><div class="fd-form__item fd-form__item--check"><input class="fd-form__control" type="radio" name="duplicateResolution" id="overwritePrimaryPageOption" [(ngModel)]="conflictResolution" (click)="selectResolution(RESOLUTION_OPTIONS.overwritePage)" [value]="RESOLUTION_OPTIONS.overwritePage"/> <label for="overwritePrimaryPageOption" class="fd-form__label" [translate]="'se.cms.page.restore.content.duplicate.primaryforvariation.option.overwrite'"></label></div><div class="fd-form__item fd-form__item--check"><input class="fd-form__control" type="radio" name="duplicateResolution" id="renamePrimaryPageOption" [(ngModel)]="conflictResolution" (click)="selectResolution(RESOLUTION_OPTIONS.renamePageLabel)" [value]="RESOLUTION_OPTIONS.renamePageLabel"/> <label for="renamePrimaryPageOption" class="fd-form__label" [translate]="'se.cms.page.restore.content.duplicate.primaryforvariation.option.rename'"></label></div><div class="rename-label-section" *ngIf="conflictResolution === RESOLUTION_OPTIONS.renamePageLabel"><label fd-form-label [translate]="'se.cms.page.restore.page.label'"></label> <input type="text" fd-form-control [(ngModel)]="page['label']"/></div></div>`,styles:[`.rename-label-section{display:block}`]}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object])],Kn);window.__smartedit__.addDecoratorPayload("Component","PageTypeEditorComponent",{selector:"se-page-type-editor",template:`<div class="se-edit-page-info__basic-tab"><div class="se-edit-page-info__page-type"><label class="se-control-label" translate="se.cms.pageinfo.page.type"></label><div class="form-readonly-text form-readonly-text__tight">{{ model.typeCode }}</div></div><div class="se-edit-page-info__page-template"><label class="se-control-label" translate="se.cms.pageinfo.page.template"></label><div class="form-readonly-text form-readonly-text__tight">{{ model.template }}</div></div></div>`,styles:[`.se-edit-page-info__basic-tab{display:grid;grid-template-columns:repeat(1,1fr)}`]});let qn=class PageTypeEditorComponent{constructor(e){({model:this.model}=e)}};qn=__decorate([n.Component({selector:"se-page-type-editor",template:`<div class="se-edit-page-info__basic-tab"><div class="se-edit-page-info__page-type"><label class="se-control-label" translate="se.cms.pageinfo.page.type"></label><div class="form-readonly-text form-readonly-text__tight">{{ model.typeCode }}</div></div><div class="se-edit-page-info__page-template"><label class="se-control-label" translate="se.cms.pageinfo.page.template"></label><div class="form-readonly-text form-readonly-text__tight">{{ model.template }}</div></div></div>`,styles:[`.se-edit-page-info__basic-tab{display:grid;grid-template-columns:repeat(1,1fr)}`]}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object])],qn);window.__smartedit__.addDecoratorPayload("Component","RestrictionsListComponent",{selector:"se-restrictions-list",template:`<div class="restrictions-list"><div class="restrictions-list__info"><label translate="se.cms.restrictions.criteria"></label> <span>&nbsp;{{ pageInfo.restrictionsCriteria }}</span></div><div class="restrictions-lists"><div class="restrictions-list__items" *ngFor="let restriction of restrictions"><div class="restrictions-list__item"><div class="restrictions-list__item-name">{{ restriction.name }}</div><div class="restrictions-list__item-type">{{ restriction.type | seL10n | async }}</div><div class="restrictions-list__item-description">{{ restriction.description }}</div></div></div></div></div>`,styles:[`.restrictions-list .restrictions-lists .restrictions-list__items{position:static;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-top-color:var(--sapList_GroupHeaderBorderColor)!important;border-top:solid;border-radius:unset;padding:20px}.restrictions-list .restrictions-lists .restrictions-list__items:first-child{border-top-width:0}.restrictions-list .restrictions-lists .restrictions-list__items .restrictions-list__item-name{font-weight:700;color:var(--sapTextColor);margin:0}.restrictions-list .restrictions-list__info label{font-weight:700}`]});let Yn=class RestrictionsListComponent{constructor(e,t,i){this.data=e;this.cmsitemsRestService=t;this.cdr=i;({model:this.pageInfo}=e);this.restrictions=[]}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.cmsitemsRestService.getByIdsNoCache(this.pageInfo.restrictions,"FULL");this.restrictions=e.response?e.response:[e];if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}};Yn=__decorate([n.Component({selector:"se-restrictions-list",template:`<div class="restrictions-list"><div class="restrictions-list__info"><label translate="se.cms.restrictions.criteria"></label> <span>&nbsp;{{ pageInfo.restrictionsCriteria }}</span></div><div class="restrictions-lists"><div class="restrictions-list__items" *ngFor="let restriction of restrictions"><div class="restrictions-list__item"><div class="restrictions-list__item-name">{{ restriction.name }}</div><div class="restrictions-list__item-type">{{ restriction.type | seL10n | async }}</div><div class="restrictions-list__item-description">{{ restriction.description }}</div></div></div></div></div>`,styles:[`.restrictions-list .restrictions-lists .restrictions-list__items{position:static;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-top-color:var(--sapList_GroupHeaderBorderColor)!important;border-top:solid;border-radius:unset;padding:20px}.restrictions-list .restrictions-lists .restrictions-list__items:first-child{border-top-width:0}.restrictions-list .restrictions-lists .restrictions-list__items .restrictions-list__item-name{font-weight:700;color:var(--sapTextColor);margin:0}.restrictions-list .restrictions-list__info label{font-weight:700}`]}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,l.CmsitemsRestService,n.ChangeDetectorRef])],Yn);window.__smartedit__.addDecoratorPayload("Component","SingeActiveCatalogAwareItemSelectorItemRendererComponent",{selector:"se-single-active-catalog-aware-item-selector-item-renderer",template:`\n        <span class="se-single-catalog-item">\n            <span\n                class="se-single-catalog-item__label"\n                title="{{ data.item.label | seL10n | async }}"\n                >{{ data.item.label | seL10n | async }}</span\n            >\n            <span\n                class="se-single-catalog-item__code"\n                title="{{ data.item.code | seL10n | async }}">\n                {{ data.item.code }}</span\n            >\n            <span\n                class="se-single-catalog-item__version"\n                title="{{ data.item.catalogId | seL10n | async }}"\n                >{{ data.item.catalogId }}</span\n            >\n        </span>\n    `});let Zn=class SingeActiveCatalogAwareItemSelectorItemRendererComponent{constructor(e){this.data=e}};Zn=__decorate([n.Component({selector:"se-single-active-catalog-aware-item-selector-item-renderer",template:`\n        <span class="se-single-catalog-item">\n            <span\n                class="se-single-catalog-item__label"\n                title="{{ data.item.label | seL10n | async }}"\n                >{{ data.item.label | seL10n | async }}</span\n            >\n            <span\n                class="se-single-catalog-item__code"\n                title="{{ data.item.code | seL10n | async }}">\n                {{ data.item.code }}</span\n            >\n            <span\n                class="se-single-catalog-item__version"\n                title="{{ data.item.catalogId | seL10n | async }}"\n                >{{ data.item.catalogId }}</span\n            >\n        </span>\n    `}),__param(0,n.Inject(l.ITEM_COMPONENT_DATA_TOKEN)),__metadata("design:paramtypes",[Object])],Zn);var Xn;(function(e){e["SingleOnlineProductSelector"]="product";e["SingleOnlineCategorySelector"]="category"})(Xn||(Xn={}));window.__smartedit__.addDecoratorPayload("Component","SingleActiveCatalogAwareItemSelectorComponent",{selector:"se-single-active-catalog-aware-item-selector",template:`<div *ngIf="propertyType"><div id="product-catalog"><label id="labelForProductCatalog" class="se-control-label" [ngClass]="{ 'required': field.required }" *ngIf="catalogs.length === 1">{{ catalogName | seL10n | async }}</label><se-generic-editor-dropdown id="se-catalog-selector-dropdown" *ngIf="catalogs.length > 1" [field]="productCatalogField" [qualifier]="'productCatalog'" [model]="model"></se-generic-editor-dropdown></div><div><label id="labelForItem" class="se-control-label" [translate]="mainDropDownI18nKey"></label><se-generic-editor-dropdown id="se-items-selector-dropdown" [field]="field" [qualifier]="qualifier" [model]="model" [itemComponent]="itemComponent" [(reset)]="reset"></se-generic-editor-dropdown></div></div><div class="product-catalog-item-type-missing" *ngIf="!propertyType" translate="se.cms.catalogawareitem.itemtype.notsupported"></div>`,styles:[`se-item-printer .se-single-catalog-item{display:grid;grid-template-columns:2fr 1fr 2fr;grid-column-gap:1rem}se-item-printer .se-single-catalog-item__code,se-item-printer .se-single-catalog-item__label,se-item-printer .se-single-catalog-item__version{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}se-item-printer .selected-item>.se-item-printer{width:100%;padding-right:12px}`],encapsulation:n.ViewEncapsulation.None});let Qn=class SingleActiveCatalogAwareItemSelectorComponent{constructor(e,t){this.data=e;this.catalogService=t;({editor:this.editor,field:this.field,model:this.model,qualifier:this.qualifier}=this.data);this.catalogName={};this.catalogs=[];this.itemComponent=Zn;this.initProductCatalog=this.model.productCatalog}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.augmentDropdownAttributes();return this.initProductCatalogs()}))}ngDoCheck(){if(this.catalogs.length>1&&this.initProductCatalog!==this.model.productCatalog){this.initProductCatalog=this.model.productCatalog;this.resetSelector()}}augmentDropdownAttributes(){this.propertyType=this.getFieldPropertyType(this.field);if(this.propertyType){this.productCatalogField={idAttribute:"catalogId",labelAttributes:["name"],editable:this.field.editable,propertyType:"productCatalog"};this.mainDropDownI18nKey=this.field.i18nKey;delete this.field.i18nKey;this.field.paged=true;this.field.idAttribute="uid";this.field.labelAttributes=["name"];this.field.dependsOn="productCatalog";this.field.propertyType=this.propertyType}}initProductCatalogs(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.getProductCatalogsBySiteKey(r.CONTEXT_SITE_ID);this.catalogs=e;if(this.catalogs.length===1){this.model.productCatalog=this.catalogs[0].catalogId;this.editor.form.pristine.productCatalog=this.catalogs[0].catalogId;this.catalogName=this.catalogs[0].name}}))}getFieldPropertyType(e){const t=e.cmsStructureType;return Xn[t]}resetSelector(){if(typeof this.reset==="function"){this.reset(true)}}};Qn=__decorate([n.Component({selector:"se-single-active-catalog-aware-item-selector",template:`<div *ngIf="propertyType"><div id="product-catalog"><label id="labelForProductCatalog" class="se-control-label" [ngClass]="{ 'required': field.required }" *ngIf="catalogs.length === 1">{{ catalogName | seL10n | async }}</label><se-generic-editor-dropdown id="se-catalog-selector-dropdown" *ngIf="catalogs.length > 1" [field]="productCatalogField" [qualifier]="'productCatalog'" [model]="model"></se-generic-editor-dropdown></div><div><label id="labelForItem" class="se-control-label" [translate]="mainDropDownI18nKey"></label><se-generic-editor-dropdown id="se-items-selector-dropdown" [field]="field" [qualifier]="qualifier" [model]="model" [itemComponent]="itemComponent" [(reset)]="reset"></se-generic-editor-dropdown></div></div><div class="product-catalog-item-type-missing" *ngIf="!propertyType" translate="se.cms.catalogawareitem.itemtype.notsupported"></div>`,styles:[`se-item-printer .se-single-catalog-item{display:grid;grid-template-columns:2fr 1fr 2fr;grid-column-gap:1rem}se-item-printer .se-single-catalog-item__code,se-item-printer .se-single-catalog-item__label,se-item-printer .se-single-catalog-item__version{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}se-item-printer .selected-item>.se-item-printer{width:100%;padding-right:12px}`],encapsulation:n.ViewEncapsulation.None}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,l.ICatalogService])],Qn);var Jn;(function(e){e["clone"]="clone";e["useExisting"]="reference";e["remove"]="remove"})(Jn||(Jn={}));window.__smartedit__.addDecoratorPayload("Component","SlotSharedCloneActionFieldComponent",{selector:"se-component-slot-shared-clone-action-field",template:`<div class="fd-form__set"><div class="fd-form__item fd-form__item--check"><label for="components-in-slot-options" class="se-control-label" [translate]="'se.cms.slot.shared.replace.editor.componentsinslot'"></label><div id="components-in-slot-options"><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="componentsInSlot" id="clone-all" [(ngModel)]="page.cloneAction" [value]="cloneAction.clone"/> <label for="clone-all" [translate]="'se.cms.slot.shared.replace.editor.componentsinslot.cloneall'"></label></div><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="componentsInSlot" id="use-existing" [(ngModel)]="page.cloneAction" [value]="cloneAction.useExisting"/> <label for="use-existing" [translate]="'se.cms.slot.shared.replace.editor.componentsinslot.useexisting'"></label></div><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="componentsInSlot" id="remove-all" [(ngModel)]="page.cloneAction" [value]="cloneAction.remove"/> <label for="remove-all" [translate]="'se.cms.slot.shared.replace.editor.componentsinslot.removeall'"></label></div></div></div></div>`,styles:[`slot-shared-clone-action-field .fd-form__item--check{display:flex;align-items:baseline;flex-direction:column}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let es=class SlotSharedCloneActionFieldComponent{constructor(e){this.data=e;this.cloneAction=Jn;({model:this.page}=e)}};es=__decorate([n.Component({selector:"se-component-slot-shared-clone-action-field",template:`<div class="fd-form__set"><div class="fd-form__item fd-form__item--check"><label for="components-in-slot-options" class="se-control-label" [translate]="'se.cms.slot.shared.replace.editor.componentsinslot'"></label><div id="components-in-slot-options"><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="componentsInSlot" id="clone-all" [(ngModel)]="page.cloneAction" [value]="cloneAction.clone"/> <label for="clone-all" [translate]="'se.cms.slot.shared.replace.editor.componentsinslot.cloneall'"></label></div><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="componentsInSlot" id="use-existing" [(ngModel)]="page.cloneAction" [value]="cloneAction.useExisting"/> <label for="use-existing" [translate]="'se.cms.slot.shared.replace.editor.componentsinslot.useexisting'"></label></div><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="componentsInSlot" id="remove-all" [(ngModel)]="page.cloneAction" [value]="cloneAction.remove"/> <label for="remove-all" [translate]="'se.cms.slot.shared.replace.editor.componentsinslot.removeall'"></label></div></div></div></div>`,styles:[`slot-shared-clone-action-field .fd-form__item--check{display:flex;align-items:baseline;flex-direction:column}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object])],es);window.__smartedit__.addDecoratorPayload("Component","SlotSharedSlotTypeFieldComponent",{selector:"se-component-slot-shared-slot-type-field",template:`<div class="fd-form__set"><div class="fd-form__item fd-form__item--check"><label for="slot-replacement-type-options" class="se-control-label" [translate]="'se.cms.slot.shared.replace.editor.slotreplacementtype'"></label><div id="slot-replacement-type-options"><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="slotReplacementType" id="slot-type-custom" [(ngModel)]="page.isSlotCustom" [value]="true"/> <label for="slot-type-custom" [translate]="'se.cms.slot.shared.replace.editor.slotreplacementtype.nonshared'"></label></div><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="slotReplacementType" id="slot-type-local" [(ngModel)]="page.isSlotCustom" [value]="false"/> <label for="slot-type-local" [translate]="'se.cms.slot.shared.replace.editor.slotreplacementtype.local'"></label></div></div></div></div>`,styles:[`slot-shared-slot-type-field .fd-form__item--check{display:flex;align-items:baseline;flex-direction:column}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let ts=class SlotSharedSlotTypeFieldComponent{constructor(e){this.data=e;({model:this.page}=e)}};ts=__decorate([n.Component({selector:"se-component-slot-shared-slot-type-field",template:`<div class="fd-form__set"><div class="fd-form__item fd-form__item--check"><label for="slot-replacement-type-options" class="se-control-label" [translate]="'se.cms.slot.shared.replace.editor.slotreplacementtype'"></label><div id="slot-replacement-type-options"><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="slotReplacementType" id="slot-type-custom" [(ngModel)]="page.isSlotCustom" [value]="true"/> <label for="slot-type-custom" [translate]="'se.cms.slot.shared.replace.editor.slotreplacementtype.nonshared'"></label></div><div class="se-form-control-row"><input class="fd-form__control" type="radio" name="slotReplacementType" id="slot-type-local" [(ngModel)]="page.isSlotCustom" [value]="false"/> <label for="slot-type-local" [translate]="'se.cms.slot.shared.replace.editor.slotreplacementtype.local'"></label></div></div></div></div>`,styles:[`slot-shared-slot-type-field .fd-form__item--check{display:flex;align-items:baseline;flex-direction:column}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(0,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object])],ts);var is;(function(e){e["uploadThumbnail"]="UPLOAD_THUMBNAIL";e["noThumbnail"]="NO_THUMBNAIL"})(is||(is={}));window.__smartedit__.addDecoratorPayload("Component","ThumbnailSelectComponent",{selector:"se-thumbnail-select",template:`<se-generic-editor-dropdown [id]="id" [field]="field" [qualifier]="qualifier" [model]="model"></se-generic-editor-dropdown>`});let os=class ThumbnailSelectComponent{constructor(e,t){this.systemEventService=e;this.widget=t;({id:this.id,field:this.field,model:this.model,qualifier:this.qualifier}=t);if(this.field.dependsOnField){const e=`${this.id}${this.field.dependsOnField}${l.CLICK_DROPDOWN}`;this.unRegDependsOnValueChanged=this.systemEventService.subscribe(e,((e,t)=>this.onDependsOnValueChanged(t)))}this.optionEventId=`${this.id}${this.qualifier}${l.CLICK_DROPDOWN}`;const i=`${this.id}${l.LINKED_DROPDOWN}`;this.unRegSelectValueChanged=this.systemEventService.subscribe(i,((e,t)=>this.onThumbnailSelectValueChanged(t)))}ngOnDestroy(){this.unRegSelectValueChanged();this.unRegDependsOnValueChanged()}onThumbnailSelectValueChanged({optionObject:e,qualifier:t}){if(this.qualifier!==t){return}if(!e){return}const i=e.id;const o=Object.values(is).includes(i);if(!o){throw new Error("Selected option is not supported")}if(!this.field.hideFieldWidget){this.systemEventService.publishAsync(this.optionEventId,i)}}onDependsOnValueChanged(e){this.field.hideFieldWidget=e!==this.field.dependsOnValue;if(this.field.hideFieldWidget){this.systemEventService.publishAsync(this.optionEventId,null)}else{this.systemEventService.publishAsync(this.optionEventId,this.model[this.qualifier])}}};os=__decorate([n.Component({selector:"se-thumbnail-select",template:`<se-generic-editor-dropdown [id]="id" [field]="field" [qualifier]="qualifier" [model]="model"></se-generic-editor-dropdown>`}),__param(1,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[l.SystemEventService,Object])],os);window.__smartedit__.addDecoratorPayload("Component","MuteBooleanComponent",{selector:"se-mute-boolean",template:`<div class="se-boolean fd-form__item fd-form__item--check"><span class="fd-toggle fd-toggle--xs fd-form__control"><label class="fd-form__label fd-switch fd-switch--compact" for="{{widget.qualifier}}-checkbox"><input type="checkbox" id="{{widget.qualifier}}-checkbox" class="se-boolean__input fd-switch__input" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.qualifier" [disabled]="!widget.field.editable" [(ngModel)]="widget.model[widget.qualifier]"/><div class="fd-switch__slider"><div class="fd-switch__track"><span class="fd-switch__handle" role="presentation" style="border-style: solid; border-width: 1px"></span></div></div></label></span><p *ngIf="widget.field.labelText && !widget.model[widget.qualifier]" class="se-boolean__text">{{widget.field.labelText| translate}}</p></div>`});let ns=class MuteBooleanComponent{constructor(e,t){this.systemEventService=e;this.widget=t;if(this.widget.field.dependsOnField){this.widget.field.hideFieldWidget=true;const e=`${this.widget.id}${this.widget.field.dependsOnField}${l.CLICK_DROPDOWN}`;this.unRegClickValueChanged=this.systemEventService.subscribe(e,((e,t)=>this.onDependencyValueChangedEvent(t)))}}onDependencyValueChangedEvent(e){this.widget.field.hideFieldWidget=e!==this.widget.field.dependsOnValue;if(this.widget.field.hideFieldWidget){this.widget.model[this.widget.qualifier]=false}}};ns=__decorate([n.Component({selector:"se-mute-boolean",template:`<div class="se-boolean fd-form__item fd-form__item--check"><span class="fd-toggle fd-toggle--xs fd-form__control"><label class="fd-form__label fd-switch fd-switch--compact" for="{{widget.qualifier}}-checkbox"><input type="checkbox" id="{{widget.qualifier}}-checkbox" class="se-boolean__input fd-switch__input" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.qualifier" [disabled]="!widget.field.editable" [(ngModel)]="widget.model[widget.qualifier]"/><div class="fd-switch__slider"><div class="fd-switch__track"><span class="fd-switch__handle" role="presentation" style="border-style: solid; border-width: 1px"></span></div></div></label></span><p *ngIf="widget.field.labelText && !widget.model[widget.qualifier]" class="se-boolean__text">{{widget.field.labelText| translate}}</p></div>`}),__param(1,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[l.SystemEventService,Object])],ns);window.__smartedit__.addDecoratorPayload("Component","WorkflowCreateVersionFieldComponent",{selector:"se-workflow-create-version-field",template:`<div class="fd-form__set"><div class="fd-form-item fd-form__item--check"><label class="fd-form__label"><input type="checkbox" class="fd-form__control" name="createVersion" [(ngModel)]="model.createVersion"/> {{ 'se.cms.workflow.editor.create.version' | translate }}</label></div><div class="fd-form-item" *ngIf="model.createVersion"><label class="fd-form__label version-label__title" for="versionLabel" translate="se.cms.workflow.editor.create.version.label"></label> <input type="text" name="versionLabel" class="fd-form__control" [class.has-error]="field.hasErrors" [(ngModel)]="model.versionLabel"/></div></div>`,providers:[l.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush});let ss=class WorkflowCreateVersionFieldComponent{constructor(e,t,i,o){this.workflowService=e;this.data=t;this.cdr=i;this.l10nPipe=o;({field:this.field,model:this.model,editor:this.editor}=t)}ngOnInit(){this.unregisterOnChangeEvent=this.editor.api.addContentChangeEvent((()=>this.onCreateVersionChange()))}ngOnDestroy(){this.unregisterOnChangeEvent()}onCreateVersionChange(){return __awaiter(this,void 0,void 0,(function*(){if(this.model.createVersion===false){this.model.versionLabel=null;if(!this.cdr.destroyed){this.cdr.detectChanges()}return}if(!p.isEmpty(this.model.versionLabel)){return}if(this.model.decisionCode){const e=yield this.workflowService.getAllActionsForWorkflowCode(this.model.workflowCode);const t=e.find((e=>e.code===this.model.actionCode));const i=t.decisions.find((e=>e.code===this.model.decisionCode));const[o,n]=yield Promise.all([this.l10nPipe.transform(i.name).pipe(d.take(1)).toPromise(),this.l10nPipe.transform(t.name).pipe(d.take(1)).toPromise()]);this.model.versionLabel=`${o} for ${n}`;if(!this.cdr.destroyed){this.cdr.detectChanges()}return}const e=yield this.workflowService.getWorkflowTemplateByCode(this.model.templateCode);if(e){const t=yield this.l10nPipe.transform(e.name).pipe(d.take(1)).toPromise();this.model.versionLabel=`${t} workflow started`;if(!this.cdr.destroyed){this.cdr.detectChanges()}}}))}};ss=__decorate([n.Component({selector:"se-workflow-create-version-field",template:`<div class="fd-form__set"><div class="fd-form-item fd-form__item--check"><label class="fd-form__label"><input type="checkbox" class="fd-form__control" name="createVersion" [(ngModel)]="model.createVersion"/> {{ 'se.cms.workflow.editor.create.version' | translate }}</label></div><div class="fd-form-item" *ngIf="model.createVersion"><label class="fd-form__label version-label__title" for="versionLabel" translate="se.cms.workflow.editor.create.version.label"></label> <input type="text" name="versionLabel" class="fd-form__control" [class.has-error]="field.hasErrors" [(ngModel)]="model.versionLabel"/></div></div>`,providers:[l.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(1,n.Inject(l.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[l.WorkflowService,Object,n.ChangeDetectorRef,l.L10nPipe])],ss);let as=class CmsGenericEditorConfigurationService{constructor(e,t){this.editorFieldMappingService=e;this.genericEditorTabService=t;this.DEFAULT_PAGE_TAB_ID="information";this.CATEGORIES={PAGE:"PAGE",COMPONENT:"COMPONENT"};this.defaultTabPredicate=e=>e.category===this.CATEGORIES.PAGE?this.DEFAULT_PAGE_TAB_ID:null;this.isPagePredicate=(e,t,i)=>i.category===this.CATEGORIES.PAGE;this.isComponentPredicate=(e,t,i)=>i.category===this.CATEGORIES.COMPONENT}setDefaultEditorFieldMappings(){this.editorFieldMappingService.addFieldMapping("Media",null,null,{component:Cn});this.editorFieldMappingService.addFieldMapping("MediaContainer",null,null,{component:En});this.editorFieldMappingService.addFieldMapping("NavigationNodeSelector",null,null,{component:Qo});this.editorFieldMappingService.addFieldMapping("MultiProductSelector",null,null,{component:pi});this.editorFieldMappingService.addFieldMapping("MultiCategorySelector",null,null,{component:ui});this.editorFieldMappingService.addFieldMapping("CMSLinkToSelect",null,null,{component:pn});this.editorFieldMappingService.addFieldMapping("OptionalCMSLinkToSelect",null,null,{component:pn,tooltip:"se.cms.linkto.tooltip"});this.editorFieldMappingService.addFieldMapping("SingleOnlineProductSelector",null,null,{component:Qn});this.editorFieldMappingService.addFieldMapping("SingleOnlineCategorySelector",null,null,{component:Qn});this.editorFieldMappingService.addFieldMapping("CMSItemDropdown",null,null,{component:t.CmsComponentDropdownComponent});this.editorFieldMappingService.addFieldMapping("CMSComponentRestrictionsEditor",null,null,{component:t.ComponentRestrictionsEditorComponent});this.editorFieldMappingService.addFieldMapping("PageRestrictionsEditor",null,"restrictions",{component:t.PageRestrictionsEditorComponent});this.editorFieldMappingService.addFieldMapping("DisplayConditionEditor",null,"displayCondition",{component:ao,hidePrefixLabel:true});this.editorFieldMappingService.addFieldMapping("ShortString",this.isPagePredicate,"typeCode",{component:qn,hidePrefixLabel:true});this.editorFieldMappingService.addFieldMapping("InfoPageName",this.isPagePredicate,null,{component:mn});this.editorFieldMappingService.addFieldMapping("Boolean",null,"visible",{component:l.BooleanComponent,i18nKey:"type.component.abstractcmscomponent.visible.name"});this.editorFieldMappingService.addFieldMapping("LinkToggle",null,null,{component:gn});this.editorFieldMappingService.addFieldMapping("RestrictionsList",null,null,{component:Yn,hidePrefixLabel:true});this.editorFieldMappingService.addFieldMapping("Video",null,null,{component:Cn,allowMediaType:l.GenericEditorMediaType.VIDEO,tooltip:"se.cms.video.tooltip"});this.editorFieldMappingService.addFieldMapping("VideoMute",null,null,{component:ns,hideFieldWidget:true,dependsOnField:"autoPlay",dependsOnValue:"true"});this.editorFieldMappingService.addFieldMapping("VideoThumbnailSelector",null,null,{component:os,hideFieldWidget:false,dependsOnField:"autoPlay",dependsOnValue:"false"});this.editorFieldMappingService.addFieldMapping("Thumbnail",null,null,{component:En,hideFieldWidget:true,hidePrefixLabel:true,dependsOnField:"thumbnailSelector",dependsOnValue:is.uploadThumbnail,allowMediaType:l.GenericEditorMediaType.IMAGE});this.editorFieldMappingService.addFieldMapping("PDFFile",null,null,{component:Cn,allowMediaType:l.GenericEditorMediaType.PDF_DOCUMENT});this.editorFieldMappingService.addFieldMapping("DuplicatePrimaryNonContentPageMessage",null,null,{component:$n,hidePrefixLabel:true});this.editorFieldMappingService.addFieldMapping("DuplicatePrimaryContentPage",null,null,{component:Kn,hidePrefixLabel:false});this.editorFieldMappingService.addFieldMapping("MissingPrimaryContentPage",null,null,{component:Wn,hidePrefixLabel:false});this.editorFieldMappingService.addFieldMapping("WorkflowCreateVersionField",null,null,{component:ss,hidePrefixLabel:false});this.editorFieldMappingService.addFieldMapping("SlotSharedCloneActionField",null,null,{component:es,hidePrefixLabel:false});this.editorFieldMappingService.addFieldMapping("SlotSharedSlotTypeField",null,null,{component:ts,hidePrefixLabel:false})}setDefaultTabsConfiguration(){this.genericEditorTabService.configureTab("default",{priority:5});this.genericEditorTabService.configureTab("information",{priority:5});this.genericEditorTabService.configureTab("administration",{priority:4})}setDefaultTabFieldMappings(){this.genericEditorTabService.addComponentTypeDefaultTabPredicate(this.defaultTabPredicate);this.editorFieldMappingService.addFieldTabMapping(null,this.isComponentPredicate,"visible","visibility");this.editorFieldMappingService.addFieldTabMapping(null,this.isComponentPredicate,"restrictions","visibility");this.editorFieldMappingService.addFieldTabMapping(null,this.isComponentPredicate,"onlyOneRestrictionMustApply","visibility");this.editorFieldMappingService.addFieldTabMapping(null,this.isComponentPredicate,"uid","basicinfo");this.editorFieldMappingService.addFieldTabMapping(null,this.isComponentPredicate,"id","basicinfo");this.editorFieldMappingService.addFieldTabMapping(null,this.isComponentPredicate,"modifiedtime","basicinfo");this.editorFieldMappingService.addFieldTabMapping("DateTime",this.isComponentPredicate,"creationtime","basicinfo");this.editorFieldMappingService.addFieldTabMapping("DisplayConditionEditor",this.isPagePredicate,"displayCondition","displaycondition");this.editorFieldMappingService.addFieldTabMapping(null,this.isPagePredicate,"restrictions","restrictions")}};as=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.EditorFieldMappingService,l.GenericEditorTabService])],as);let rs=class ProductDropdownPopulator extends l.DropdownPopulatorInterface{constructor(e,t,i,o){super(w,t,i);this.contextAwareCatalogService=e;this.uriDropdownPopulator=o}fetchPage(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.contextAwareCatalogService.getProductSearchUri(e.model.productCatalog);e.field.uri=t;return this.uriDropdownPopulator.fetchPage(e)}))}isPaged(){return true}getItem(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.contextAwareCatalogService.getProductItemUri();e.field.uri=t;return this.uriDropdownPopulator.getItem(e)}))}};rs=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.ContextAwareCatalogService,l.LanguageService,m.TranslateService,l.UriDropdownPopulator])],rs);let ls=class ProductCatalogDropdownPopulator extends l.DropdownPopulatorInterface{constructor(e,t,i,o){super(w,t,o);this.catalogService=e;this.optionsDropdownPopulator=i}fetchAll(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.catalogService.getProductCatalogsBySiteKey(l.CONTEXT_SITE_ID);e.field.options=t.filter((e=>this.hasCatalogOneActiveVersion(e)));return this.optionsDropdownPopulator.fetchAll(e)}))}isPaged(){return false}hasCatalogOneActiveVersion(e){const t=e.versions.filter((e=>e.active===true));return t.length===1}};ls=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.ICatalogService,l.LanguageService,l.OptionsDropdownPopulator,m.TranslateService])],ls);let cs=class CategoryDropdownPopulator extends l.DropdownPopulatorInterface{constructor(e,t,i,o){super(w,t,i);this.contextAwareCatalogService=e;this.uriDropdownPopulator=o}fetchPage(e){return __awaiter(this,void 0,void 0,(function*(){if(e.model.productCatalog===undefined){throw new Error('"productCatalog" is required but it was not provided.')}const t=yield this.contextAwareCatalogService.getProductCategorySearchUri(e.model.productCatalog);e.field.uri=t;const i=yield this.languageService.getResolveLocale();e.field.params.langIsoCode=i;return this.uriDropdownPopulator.fetchPage(e)}))}getItem(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.contextAwareCatalogService.getProductCategoryItemUri();e.field.uri=t;return this.uriDropdownPopulator.getItem(e)}))}isPaged(){return true}};cs=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.ContextAwareCatalogService,l.LanguageService,m.TranslateService,l.UriDropdownPopulator])],cs);let ds=class CmsLinkComponentContentPageDropdownPopulator extends l.DropdownPopulatorInterface{constructor(e,t,i,o){super(w,t,i);this.contextAwareCatalogService=e;this.uriDropdownPopulator=o}fetchPage(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.contextAwareCatalogService.getContentPageSearchUri();e.field.uri=t;return this.uriDropdownPopulator.fetchPage(e)}))}getItem(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.contextAwareCatalogService.getContentPageItemUri();e.field.uri=t;return this.uriDropdownPopulator.getItem(e)}))}isPaged(){return true}};ds=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.ContextAwareCatalogService,l.LanguageService,m.TranslateService,l.UriDropdownPopulator])],ds);let ps=class GenericEditorWidgetsModule{};ps=__decorate([n.NgModule({imports:[l.TranslationModule.forChild(),s.FormsModule,f.FormModule,g.CommonModule,l.L10nPipeModule,l.SelectModule,l.GenericEditorDropdownModule,hi,Wo],providers:[as,{provide:l.CustomDropdownPopulatorsToken,useClass:rs,multi:true},{provide:l.CustomDropdownPopulatorsToken,useClass:ls,multi:true},{provide:l.CustomDropdownPopulatorsToken,useClass:cs,multi:true},{provide:l.CustomDropdownPopulatorsToken,useClass:ds,multi:true}],declarations:[ss,Wn,$n,Kn,Yn,es,ts,pn,qn,Qn,Zn,gn,mn,os,ns],entryComponents:[ss,Wn,$n,Kn,Yn,es,ts,pn,qn,Qn,Zn,gn,mn,os,ns],exports:[ss,hi]})],ps);window.__smartedit__.addDecoratorPayload("Component","TrashedPageListComponent",{selector:"se-trashed-page-list",template:`<div class="se-page-list"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar><se-toolbar cssClass="se-toolbar--shell ySmartEditTrashPageToolbar" imageRoot="imageRoot" toolbarName="smartEditTrashPageToolbar"></se-toolbar><div class="se-page-list__header"><h2 class="se-page-list__catalog-name" translate="se.cms.trashedpagelist.title"></h2><p class="se-page-list__sub-title">{{ catalogName | seL10n | async }} - {{ catalogVersion }}</p></div><div class="se-page-list__body"><div class="se-page-list__table-header"><span class="se-paged-list__page-count-wrapper"><span class="span-page-list__page-count-text" translate="se.pagelist.countsearchresult"></span> <span>&nbsp;</span> <span class="se-page-list__page-count">({{ count }})</span></span><div class="fd-form__group se-page-list__search"><div class="se-input-group"><input type="search" class="fd-input se-input-group__input-area ySEPage-list-search-input" placeholder="{{ 'se.cms.pagelist.searchplaceholder' | translate }}" [ngModel]="mask" (ngModelChange)="onMaskChange($event)" name="mask" title="{{ 'se.cms.pagelist.searchplaceholder' | translate }}"/> <span class="sap-icon--search se-input-group__addon"></span><div *ngIf="mask" aria-label="clear" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="reset()"></div></div></div></div><div class="se-page-list__table-body"><se-dynamic-paged-list class="se-trashed-pages" [config]="trashedPageListConfig" [mask]="mask" (getApi)="getApi($event);" (onItemsUpdate)="onPageItemsUpdate($event.pagination)"></se-dynamic-paged-list></div></div></div>`,styles:[`.se-page-list{background-color:var(--sapShell_Background);min-height:100vh;height:100%}.se-page-list__page-link-anchor{text-decoration:none!important;color:var(--sapNeutralTextColor)}.se-page-list__page-link-anchor:hover{color:var(--sapLinkColor)}.se-page-list__header{padding:16px 30px;background-color:var(--sapBaseColor);-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-page-list__page-link-icon{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralTextColor)}.se-page-list__catalog-name{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;display:block;margin-bottom:4px;font-weight:800;font-size:2rem!important;color:var(--sapTitleColor)}.se-page-list__sub-title{font-size:.875rem;color:var(--sapField_PlaceholderTextColor)}.se-page-list__body{padding:20px 20px 70px}.se-page-list__page-link--left{cursor:pointer}.se-page-list__page-link--left .se-page-list__page-link-anchor{margin-left:3px}.se-page-list__page-link--right{cursor:pointer}.se-page-list__page-link--right .se-page-list__page-link-anchor{margin-right:3px}.se-page-list__table-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:var(--sapBaseColor);height:56px;padding:20px;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0}.se-page-list__table-header--right{display:flex;flex-direction:row;align-items:center}.se-page-list__table-header .se-paged-list__page-count-wrapper{font-size:1rem!important;line-height:1.25;font-weight:400;margin-right:auto}.se-page-list__table-body{padding-bottom:16px}.se-page-list__table-body .se-data-table__arrow{margin-left:2px}.se-page-list__table-body .se-paged-list-item{cursor:default}.se-page-list__search{margin-right:16px;width:380px}.se-page-list__add{text-transform:capitalize}.se-paged-list__header{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-paged-list__header-dropdownitems,.se-paged-list__header-syncStatus{text-align:right}.se-paged-list__header-pageStatus{cursor:default}.se-paged-list-item-name a{text-decoration:none!important}.se-sync-btn__status--done{color:var(--sapIndicationColor_4)}.se-sync-btn__status--not{color:var(--sapIndicationColor_3)}.ySmartEditTrashPageToolbar{background-color:var(--sapBaseColor)}.fd-table td.se-paged-list-item-numberOfRestrictions,.fd-table td.se-paged-list-item-syncStatus,.fd-table th.se-paged-list__header-numberOfRestrictions,.fd-table th.se-paged-list__header-syncStatus{text-align:center}.fd-table td.se-paged-list-item-syncStatus{font-size:1rem!important;line-height:1.25;font-weight:400}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None});let ms=class TrashedPageListComponent{constructor(e,t,i,o,n){this.catalogService=e;this.route=t;this.urlService=i;this.systemEventService=o;this.cdr=n;this.mask="";this.dropdownItems=[];this.count=0;this.maskSubject$=new E.Subject}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){yield this.initialize();this.unsubscribeEventListener=this.systemEventService.subscribe(l.EVENT_CONTENT_CATALOG_UPDATE,this.onContentCatalogUpdate.bind(this));this.maskSubscription=this.maskSubject$.pipe(v.debounceTime(500),v.distinctUntilChanged()).subscribe((e=>{this.mask=e;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}))}ngOnDestroy(){this.unsubscribeEventListener();this.maskSubscription.unsubscribe()}onMaskChange(e){this.maskSubject$.next(e)}onPageItemsUpdate(e){this.count=e.totalCount}reset(){this.mask=""}getApi(e){this.dynamicPagedListApi=e}initialize(){return __awaiter(this,void 0,void 0,(function*(){this.setSiteParams();this.setUriContext();this.setTrashedListConfigBasis();this.setTrashedListColumns();return this.setCatalogName()}))}onContentCatalogUpdate(){if(this.dynamicPagedListApi){this.dynamicPagedListApi.reloadItems()}}setSiteParams(){this.siteUID=this.route.snapshot.params.siteId;this.catalogId=this.route.snapshot.params.catalogId;this.catalogVersion=this.route.snapshot.params.catalogVersion}setUriContext(){this.uriContext=this.urlService.buildUriContext(this.siteUID,this.catalogId,this.catalogVersion)}setTrashedListConfigBasis(){this.trashedPageListConfig={sortBy:"name",reversed:false,itemsPerPage:10,displayCount:true,uri:l.cmsitemsUri,queryParams:{catalogId:this.catalogId,catalogVersion:this.catalogVersion,typeCode:"AbstractPage",itemSearchParams:"pageStatus:deleted"},keys:[]}}setCatalogName(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.getContentCatalogsForSite(this.siteUID);this.catalogName=e.find((e=>e.catalogId===this.catalogId)).name}))}setTrashedListColumns(){this.trashedPageListConfig.keys=[{property:"name",i18n:"se.cms.pagelist.headerpagename",sortable:true},{property:"uid",i18n:"se.cms.pagelist.headerpageid",sortable:true},{property:"itemtype",i18n:"se.cms.pagelist.headerpagetype",sortable:true},{property:"label",i18n:"se.cms.pagelist.headerpagelable",sortable:false},{property:"numberOfRestrictions",i18n:"se.cms.pagelist.headerrestrictions",sortable:false,component:No},{property:"modifiedtime",i18n:"se.cms.trashedpagelist.trashed.date",sortable:true,component:ko},{property:"pageStatus",i18n:"se.cms.pagelist.headerpagestatus",sortable:false,component:Fo},{property:"dropdownitems",i18n:"se.cms.pagelist.headerpageaction",sortable:false,component:Ro}]}};ms=__decorate([n.Component({selector:"se-trashed-page-list",template:`<div class="se-page-list"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar><se-toolbar cssClass="se-toolbar--shell ySmartEditTrashPageToolbar" imageRoot="imageRoot" toolbarName="smartEditTrashPageToolbar"></se-toolbar><div class="se-page-list__header"><h2 class="se-page-list__catalog-name" translate="se.cms.trashedpagelist.title"></h2><p class="se-page-list__sub-title">{{ catalogName | seL10n | async }} - {{ catalogVersion }}</p></div><div class="se-page-list__body"><div class="se-page-list__table-header"><span class="se-paged-list__page-count-wrapper"><span class="span-page-list__page-count-text" translate="se.pagelist.countsearchresult"></span> <span>&nbsp;</span> <span class="se-page-list__page-count">({{ count }})</span></span><div class="fd-form__group se-page-list__search"><div class="se-input-group"><input type="search" class="fd-input se-input-group__input-area ySEPage-list-search-input" placeholder="{{ 'se.cms.pagelist.searchplaceholder' | translate }}" [ngModel]="mask" (ngModelChange)="onMaskChange($event)" name="mask" title="{{ 'se.cms.pagelist.searchplaceholder' | translate }}"/> <span class="sap-icon--search se-input-group__addon"></span><div *ngIf="mask" aria-label="clear" class="se-input-group__addon se-input-group__clear-btn sap-icon--decline" (click)="reset()"></div></div></div></div><div class="se-page-list__table-body"><se-dynamic-paged-list class="se-trashed-pages" [config]="trashedPageListConfig" [mask]="mask" (getApi)="getApi($event);" (onItemsUpdate)="onPageItemsUpdate($event.pagination)"></se-dynamic-paged-list></div></div></div>`,styles:[`.se-page-list{background-color:var(--sapShell_Background);min-height:100vh;height:100%}.se-page-list__page-link-anchor{text-decoration:none!important;color:var(--sapNeutralTextColor)}.se-page-list__page-link-anchor:hover{color:var(--sapLinkColor)}.se-page-list__header{padding:16px 30px;background-color:var(--sapBaseColor);-webkit-box-shadow:var(--sapContent_HeaderShadow);box-shadow:var(--sapContent_HeaderShadow)}.se-page-list__page-link-icon{font-size:.75rem!important;line-height:1.3333333333;font-weight:400;color:var(--sapNeutralTextColor)}.se-page-list__catalog-name{font-size:1.5rem!important;line-height:1.3333333333;font-weight:400;display:block;margin-bottom:4px;font-weight:800;font-size:2rem!important;color:var(--sapTitleColor)}.se-page-list__sub-title{font-size:.875rem;color:var(--sapField_PlaceholderTextColor)}.se-page-list__body{padding:20px 20px 70px}.se-page-list__page-link--left{cursor:pointer}.se-page-list__page-link--left .se-page-list__page-link-anchor{margin-left:3px}.se-page-list__page-link--right{cursor:pointer}.se-page-list__page-link--right .se-page-list__page-link-anchor{margin-right:3px}.se-page-list__table-header{display:flex;flex-direction:row;align-items:center;justify-content:space-between;background-color:var(--sapBaseColor);height:56px;padding:20px;border-radius:var(--sapElement_BorderCornerRadius) var(--sapElement_BorderCornerRadius) 0 0}.se-page-list__table-header--right{display:flex;flex-direction:row;align-items:center}.se-page-list__table-header .se-paged-list__page-count-wrapper{font-size:1rem!important;line-height:1.25;font-weight:400;margin-right:auto}.se-page-list__table-body{padding-bottom:16px}.se-page-list__table-body .se-data-table__arrow{margin-left:2px}.se-page-list__table-body .se-paged-list-item{cursor:default}.se-page-list__search{margin-right:16px;width:380px}.se-page-list__add{text-transform:capitalize}.se-paged-list__header{font-size:.875rem!important;line-height:1.4285714286;font-weight:400}.se-paged-list__header-dropdownitems,.se-paged-list__header-syncStatus{text-align:right}.se-paged-list__header-pageStatus{cursor:default}.se-paged-list-item-name a{text-decoration:none!important}.se-sync-btn__status--done{color:var(--sapIndicationColor_4)}.se-sync-btn__status--not{color:var(--sapIndicationColor_3)}.ySmartEditTrashPageToolbar{background-color:var(--sapBaseColor)}.fd-table td.se-paged-list-item-numberOfRestrictions,.fd-table td.se-paged-list-item-syncStatus,.fd-table th.se-paged-list__header-numberOfRestrictions,.fd-table th.se-paged-list__header-syncStatus{text-align:center}.fd-table td.se-paged-list-item-syncStatus{font-size:1rem!important;line-height:1.25;font-weight:400}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),__metadata("design:paramtypes",[l.ICatalogService,b.ActivatedRoute,l.IUrlService,l.SystemEventService,n.ChangeDetectorRef])],ms);let gs=class TrashedPageListModule{};gs=__decorate([n.NgModule({imports:[g.CommonModule,l.SeTranslationModule.forChild(),s.FormsModule,_.ToolbarModule,l.L10nPipeModule,l.DynamicPagedListModule],declarations:[ms]})],gs);window.__smartedit__.addDecoratorPayload("Component","VersionItemContextComponent",{selector:"se-version-item-context",template:`<div class="se-version-item-context"><span class="sap-icon--navigation-right-arrow"></span><se-tooltip *ngIf="(pageVersion$ | async) as pageVersion" [triggers]="['mouseenter', 'mouseleave']" [placement]="'bottom'" [isChevronVisible]="true"><div se-tooltip-trigger class="se-version-item-context__info"><div class="se-version-item-context__info-label" [title]="pageVersion.label">{{ pageVersion.label }}</div><div class="se-version-item-context__info-date">{{ pageVersion.creationtime | date: 'M/d/yy h:mm a' }}</div></div><div se-tooltip-body class="se-version-item-context__description-wrapper"><span class="se-version-item-context__description">{{ pageVersion.description || (EMPTY_DESCRIPTION_MSG_KEY | translate) }}</span></div></se-tooltip><button fd-button type="button" (click)="deselectPageVersion()" title="{{ 'se.cms.actionitem.page.versions.deselect' | translate }}" class="se-version-item-context__remove-btn fd-button fd-button--transparent"><span class="sap-icon--decline"></span></button></div>`,styles:[`.se-version-item-context{display:flex;flex-direction:row;align-items:center;height:40px;border-right:1px solid var(--sapGroup_ContentBorderColor)}.se-version-item-context .sap-icon--navigation-right-arrow{padding-right:12px;color:var(--sapNeutralColor)}.se-version-item-context__info{display:flex;flex-direction:column}.se-version-item-context__info-label{font-weight:700;font-size:.75rem!important;line-height:1.3333333333;font-weight:400;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:90px}.se-version-item-context__info-date{color:var(--sapNeutralColor);font-size:.75rem!important;line-height:1.3333333333;font-weight:400}.se-version-item-context__remove-btn{padding:0;margin:8px;min-width:20px;height:20px;color:var(--sapTextColor);background:0 0;border:transparent;line-height:1}.se-version-item-context__remove-btn::before{margin:0!important}.se-version-item-context__description-wrapper{word-wrap:break-word}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let us=class VersionItemContextComponent{constructor(e){this.pageVersionSelectionService=e;this.EMPTY_DESCRIPTION_MSG_KEY="se.cms.versions.no.description"}ngOnInit(){this.pageVersion$=this.pageVersionSelectionService.getSelectedPageVersion$();this.pageVersionSelectionService.hideToolbarContextIfNotNeeded()}deselectPageVersion(){this.pageVersionSelectionService.deselectPageVersion()}};us=__decorate([n.Component({selector:"se-version-item-context",template:`<div class="se-version-item-context"><span class="sap-icon--navigation-right-arrow"></span><se-tooltip *ngIf="(pageVersion$ | async) as pageVersion" [triggers]="['mouseenter', 'mouseleave']" [placement]="'bottom'" [isChevronVisible]="true"><div se-tooltip-trigger class="se-version-item-context__info"><div class="se-version-item-context__info-label" [title]="pageVersion.label">{{ pageVersion.label }}</div><div class="se-version-item-context__info-date">{{ pageVersion.creationtime | date: 'M/d/yy h:mm a' }}</div></div><div se-tooltip-body class="se-version-item-context__description-wrapper"><span class="se-version-item-context__description">{{ pageVersion.description || (EMPTY_DESCRIPTION_MSG_KEY | translate) }}</span></div></se-tooltip><button fd-button type="button" (click)="deselectPageVersion()" title="{{ 'se.cms.actionitem.page.versions.deselect' | translate }}" class="se-version-item-context__remove-btn fd-button fd-button--transparent"><span class="sap-icon--decline"></span></button></div>`,styles:[`.se-version-item-context{display:flex;flex-direction:row;align-items:center;height:40px;border-right:1px solid var(--sapGroup_ContentBorderColor)}.se-version-item-context .sap-icon--navigation-right-arrow{padding-right:12px;color:var(--sapNeutralColor)}.se-version-item-context__info{display:flex;flex-direction:column}.se-version-item-context__info-label{font-weight:700;font-size:.75rem!important;line-height:1.3333333333;font-weight:400;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:90px}.se-version-item-context__info-date{color:var(--sapNeutralColor);font-size:.75rem!important;line-height:1.3333333333;font-weight:400}.se-version-item-context__remove-btn{padding:0;margin:8px;min-width:20px;height:20px;color:var(--sapTextColor);background:0 0;border:transparent;line-height:1}.se-version-item-context__remove-btn::before{margin:0!important}.se-version-item-context__description-wrapper{word-wrap:break-word}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.PageVersionSelectionService])],us);window.__smartedit__.addDecoratorPayload("Component","VersionItemComponent",{selector:"se-version-item",template:`<div class="se-version-item" [ngClass]="{ 'se-version-item--selected': isSelectedVersion() }"><div class="se-version-item__header" [title]="pageVersion.label"><button class="se-version-item__label se-button--text" (click)="selectVersion()">{{ pageVersion.label }}</button><se-version-item-menu *ngIf="isVersionMenuEnabled()" [item]="pageVersion"></se-version-item-menu></div><div class="se-version-item__date">{{ pageVersion.creationtime | date: 'M/d/yy h:mm a' }}</div><div class="se-version-item__description" *ngIf="pageVersion.description"><se-more-text class="se-version-item__description-text" [text]="pageVersion.description" [limit]="32" [ellipsis]="'...'" [capitalizeLabel]="true"></se-more-text></div></div>`,styles:[`:host(.se-version-item--last) .se-version-item{border-bottom:none}.se-version-item{padding:10px 20px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}.se-version-item:hover{background-color:var(--sapLegend_WorkingBackground)}.se-version-item--selected{background-color:var(--sapList_SelectionBackgroundColor)}.se-version-item--selected:hover{background-color:var(--sapList_SelectionBackgroundColor)}.se-version-item__header{display:flex;flex-direction:row;align-items:center;justify-content:space-between}.se-version-item__label{font-weight:700;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:225px;color:var(--sapInformativeColor)}.se-version-item__date{color:var(--sapNeutralColor)}.se-version-item__description{display:flex;flex-direction:row;align-items:center;max-width:260px}.se-version-item__description-text{padding-right:2px;width:230px;word-break:break-all;white-space:normal}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let hs=class VersionItemComponent{constructor(e,t,i){this.pageVersionSelectionService=e;this.perspectiveService=t;this.cMSModesService=i;this.VERSIONING_MODE_KEY=l.CMSModesService.VERSIONING_PERSPECTIVE_KEY}selectVersion(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.cMSModesService.isVersioningPerspectiveActive();if(!e){this.perspectiveService.switchTo(this.VERSIONING_MODE_KEY)}this.pageVersionSelectionService.selectPageVersion(this.pageVersion)}))}isSelectedVersion(){const e=this.pageVersionSelectionService.getSelectedPageVersion();return e&&e.uid===this.pageVersion.uid}isVersionMenuEnabled(){const e=this.perspectiveService.getActivePerspective();return e&&e.key===this.VERSIONING_MODE_KEY}};__decorate([n.Input(),__metadata("design:type",Object)],hs.prototype,"pageVersion",void 0);hs=__decorate([n.Component({selector:"se-version-item",template:`<div class="se-version-item" [ngClass]="{ 'se-version-item--selected': isSelectedVersion() }"><div class="se-version-item__header" [title]="pageVersion.label"><button class="se-version-item__label se-button--text" (click)="selectVersion()">{{ pageVersion.label }}</button><se-version-item-menu *ngIf="isVersionMenuEnabled()" [item]="pageVersion"></se-version-item-menu></div><div class="se-version-item__date">{{ pageVersion.creationtime | date: 'M/d/yy h:mm a' }}</div><div class="se-version-item__description" *ngIf="pageVersion.description"><se-more-text class="se-version-item__description-text" [text]="pageVersion.description" [limit]="32" [ellipsis]="'...'" [capitalizeLabel]="true"></se-more-text></div></div>`,styles:[`:host(.se-version-item--last) .se-version-item{border-bottom:none}.se-version-item{padding:10px 20px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}.se-version-item:hover{background-color:var(--sapLegend_WorkingBackground)}.se-version-item--selected{background-color:var(--sapList_SelectionBackgroundColor)}.se-version-item--selected:hover{background-color:var(--sapList_SelectionBackgroundColor)}.se-version-item__header{display:flex;flex-direction:row;align-items:center;justify-content:space-between}.se-version-item__label{font-weight:700;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;word-break:break-all;max-width:225px;color:var(--sapInformativeColor)}.se-version-item__date{color:var(--sapNeutralColor)}.se-version-item__description{display:flex;flex-direction:row;align-items:center;max-width:260px}.se-version-item__description-text{padding-right:2px;width:230px;word-break:break-all;white-space:normal}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.PageVersionSelectionService,l.IPerspectiveService,l.CMSModesService])],hs);let _s=class ManagePageVersionService{constructor(e,t,i,o,n,s,a){this.alertService=e;this.experienceService=t;this.confirmationModalService=i;this.genericEditorModalService=o;this.pageInfoService=n;this.pageVersioningService=s;this.pageVersionSelectionService=a}createPageVersion(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageInfoService.getPageUUID();const t=this.getComponentDataForEditor(e,null);return this.genericEditorModalService.open(t,(e=>__awaiter(this,void 0,void 0,(function*(){const t={versionId:e.uid};yield this.experienceService.updateExperience(t);this.alertService.showSuccess("se.cms.versions.create.alert.success");this.pageVersionSelectionService.selectPageVersion(e)}))))}))}editPageVersion(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageInfoService.getPageUUID();const i=this.getComponentDataForEditor(t,e);return this.genericEditorModalService.open(i,(e=>{const t=this.pageVersionSelectionService.getSelectedPageVersion();if(t&&t.uid===e.uid){this.pageVersionSelectionService.updatePageVersionDetails(e)}}))}))}deletePageVersion(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.pageInfoService.getPageUUID();yield this.confirmationModalService.confirm({title:"se.cms.actionitem.page.version.delete.confirmation.title",description:"se.cms.actionitem.page.version.delete.confirmation.description"});yield this.pageVersioningService.deletePageVersion(t,e);this.alertService.showSuccess("se.cms.versions.delete.alert.success");const i=this.pageVersionSelectionService.getSelectedPageVersion();if(i&&i.uid===e){yield this.experienceService.updateExperience();this.pageVersionSelectionService.deselectPageVersion()}}))}getComponentDataForEditor(e,t){const i={title:t?"se.cms.versions.edit":"se.cms.versions.create",structure:{attributes:[{cmsStructureType:"ShortString",qualifier:"label",i18nKey:"se.cms.versions.editor.label.name",required:true},{cmsStructureType:"ShortString",qualifier:"description",i18nKey:"se.cms.versions.editor.description.name"}]},contentApi:this.pageVersioningService.getResourceURI().replace(":pageUuid",e)};if(t){i.content=t;i.componentUuid=t.uid;i.componentType="versioning"}return i}};_s=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.IAlertService,l.IExperienceService,l.IConfirmationModalService,t.GenericEditorModalService,l.IPageInfoService,l.PageVersioningService,l.PageVersionSelectionService])],_s);let vs=class RollbackPageVersionService{constructor(e,t,i,o,n,s,a,r){this.logService=e;this.alertService=t;this.confirmationModalService=i;this.experienceService=o;this.pageInfoService=n;this.pageVersioningService=s;this.pageVersionSelectionService=a;this.systemEventService=r}rollbackPageVersion(e){return __awaiter(this,void 0,void 0,(function*(){const t=e||this.pageVersionSelectionService.getSelectedPageVersion();if(!!t){const e="se.cms.actionitem.page.version.rollback.confirmation";const i=yield this.pageInfoService.getPageUUID();yield this.showConfirmationModal(t.label,e);yield this.performRollback(i,t)}}))}showConfirmationModal(e,t){return this.confirmationModalService.confirm({title:`${t}.title`,description:`${t}.description`,descriptionPlaceholders:{versionLabel:e}})}performRollback(e,t){return __awaiter(this,void 0,void 0,(function*(){try{yield this.pageVersioningService.rollbackPageVersion(e,t.uid);this.systemEventService.publishAsync(l.EVENT_CONTENT_CATALOG_UPDATE);this.alertService.showSuccess("se.cms.versions.rollback.alert.success");yield this.experienceService.updateExperience({});this.pageVersionSelectionService.deselectPageVersion(false)}catch(e){this.logService.error("RollbackPageVersionService::performRollback - unable to perform page rollback")}}))}};vs=__decorate([n.Injectable(),__metadata("design:paramtypes",[l.LogService,l.IAlertService,l.IConfirmationModalService,l.IExperienceService,l.IPageInfoService,l.PageVersioningService,l.PageVersionSelectionService,l.SystemEventService])],vs);window.__smartedit__.addDecoratorPayload("Component","VersionItemMenuComponent",{selector:"se-version-item-menu",template:`<se-popup-overlay class="se-version-item-menu__popup-anchor" [ngClass]="{ 'se-version-item-menu__popup-anchor--open': isMenuOpen }" [popupOverlay]="popupConfig" [popupOverlayTrigger]="isMenuOpen" (popupOverlayOnHide)="hideMenu()"><div *ngIf="menuItems.length > 0" (click)="onButtonClick($event)" class="sap-icon--overflow se-version-item-menu__toggle"></div><div se-popup-overlay-body class="se-version-item-menu"><div class="se-version-item-menu__item fd-menu__item" *ngFor="let item of menuItems" (click)="executeItemCallback(item)"><span class="se-version-item-menu__item-link fd-menu__link">{{ item.i18nKey | translate }}</span></div></div></se-popup-overlay>`,styles:[`.se-version-item-menu{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;left:initial!important;right:0;transform:translate(5px,8px);right:-11px;top:-8px}.se-version-item-menu::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.se-version-item-menu::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.se-version-item-menu::after,.se-version-item-menu::before{right:10px}.se-version-item-menu::after,.se-version-item-menu::before{display:none}.se-version-item-menu__item:last-child .se-version-item-menu__item-link{color:var(--sapIndicationColor_2)}.se-version-item-menu__popup-anchor{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:1rem!important;line-height:1.25;font-weight:400}.se-version-item-menu__toggle{height:20px;width:20px;cursor:pointer}.sap-icon--overflow{color:var(--sapLinkColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let fs=class VersionItemMenuComponent{constructor(e,t,i,o,n,s,a){this.managePageVersionService=e;this.pageVersionSelectionService=t;this.rollbackPageVersionService=i;this.permissionService=o;this.cdr=n;this.yjQuery=s;this.userTrackingService=a;this.menuItems=[];this.popupConfig={halign:"left",valign:"bottom"};this.isMenuOpen=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.menuItems=yield this.getPermittedButtons(this.getButtonsConfiguration());if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}onButtonClick(e){e.stopPropagation();this.isMenuOpen=!this.isMenuOpen}hideMenu(){this.isMenuOpen=false}executeItemCallback(e){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.VERSION_MANAGEMENT,e.i18nKey);e.callback(this.item);this.hideMenu();this.yjQuery('[data-item-key="se.cms.pageVersionsMenu"]').trigger("click")}getPermittedButtons(e){return __awaiter(this,void 0,void 0,(function*(){const t=e.map((e=>this.permissionService.isPermitted([{names:e.permissions}])));const i=yield Promise.all(t);return e.filter(((e,t)=>i[t]))}))}getButtonsConfiguration(){return[{i18nKey:"se.cms.version.item.menu.view.label",callback:e=>this.viewItemCallback(e),permissions:["se.version.page"]},{i18nKey:"se.cms.version.item.menu.edit.label",callback:e=>this.editItemCallback(e),permissions:["se.edit.version.page"]},{i18nKey:"se.cms.version.item.menu.rollback.label",callback:e=>this.rollbackItemCallback(e),permissions:["se.rollback.version.page.versions.menu"]},{i18nKey:"se.cms.version.item.menu.delete.label",callback:e=>this.deleteItemCallback(e),permissions:["se.delete.version.page"]}]}deleteItemCallback(e){this.managePageVersionService.deletePageVersion(e.uid)}editItemCallback(e){this.managePageVersionService.editPageVersion(e)}viewItemCallback(e){this.pageVersionSelectionService.selectPageVersion(e)}rollbackItemCallback(e){this.rollbackPageVersionService.rollbackPageVersion(e)}};__decorate([n.Input(),__metadata("design:type",Object)],fs.prototype,"item",void 0);fs=__decorate([n.Component({selector:"se-version-item-menu",template:`<se-popup-overlay class="se-version-item-menu__popup-anchor" [ngClass]="{ 'se-version-item-menu__popup-anchor--open': isMenuOpen }" [popupOverlay]="popupConfig" [popupOverlayTrigger]="isMenuOpen" (popupOverlayOnHide)="hideMenu()"><div *ngIf="menuItems.length > 0" (click)="onButtonClick($event)" class="sap-icon--overflow se-version-item-menu__toggle"></div><div se-popup-overlay-body class="se-version-item-menu"><div class="se-version-item-menu__item fd-menu__item" *ngFor="let item of menuItems" (click)="executeItemCallback(item)"><span class="se-version-item-menu__item-link fd-menu__link">{{ item.i18nKey | translate }}</span></div></div></se-popup-overlay>`,styles:[`.se-version-item-menu{box-shadow:0 6px 12px rgba(0,0,0,.175);background-color:var(--sapBaseColor);border-radius:var(--sapElement_BorderCornerRadius);min-width:100px;width:fit-content;position:absolute;border:1px solid var(--sapGroup_ContentBorderColor);z-index:2000;top:96%;left:initial!important;right:0;transform:translate(5px,8px);right:-11px;top:-8px}.se-version-item-menu::before{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapGroup_ContentBorderColor);border-bottom-color:var(var(--sapField_BorderColor));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-8px}.se-version-item-menu::after{height:0;width:0;border-style:solid;border-width:0 8px 8px 8px;border-bottom-color:var(--sapBaseColor);border-bottom-color:var(var(--sapButton_Attention_Hover_Background));border-left-color:transparent;border-right-color:transparent;content:"";position:absolute;top:-7px}.se-version-item-menu::after,.se-version-item-menu::before{right:10px}.se-version-item-menu::after,.se-version-item-menu::before{display:none}.se-version-item-menu__item:last-child .se-version-item-menu__item-link{color:var(--sapIndicationColor_2)}.se-version-item-menu__popup-anchor{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:1rem!important;line-height:1.25;font-weight:400}.se-version-item-menu__toggle{height:20px;width:20px;cursor:pointer}.sap-icon--overflow{color:var(--sapLinkColor)}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__param(5,n.Inject(l.YJQUERY_TOKEN)),__metadata("design:paramtypes",[_s,l.PageVersionSelectionService,vs,l.IPermissionService,n.ChangeDetectorRef,Function,l.IUserTrackingService])],fs);window.__smartedit__.addDecoratorPayload("Component","VersionsSearchComponent",{selector:"se-versions-search",template:`<div class="se-versions-panel__search" *ngIf="showSearchControls"><div class="se-input-group"><input type="text" class="fd-input se-input-group__input-area" name="search-term" [ngModel]="searchTerm" (ngModelChange)="onChange($event)" [placeholder]="'se.cms.versions.search.placeholder' | translate"/> <span class="sap-icon--search se-input-group__addon"></span> <button class="se-input-group__addon se-input-group__clear-btn se-button--text sap-icon--decline" [style.visibility]="showResetButton ? 'visible' : 'hidden'" (click)="resetSearchBox()"></button></div><span class="se-versions-panel__count" [translate]="'se.cms.versions.search.versions.found'" [translateParams]="{ versionsFound: versionsFoundCount }"></span></div>`,styles:[`.se-versions-panel__search{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:8px 20px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}.se-versions-panel__count{display:flex;flex-direction:row;align-items:center;font-size:.75rem!important;line-height:1.3333333333;font-weight:400;white-space:nowrap}.se-input-group{flex-grow:1;margin-right:16px}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let ys=class VersionsSearchComponent{constructor(){this.searchTermChange=new n.EventEmitter;this.showResetButton=false}ngOnInit(){this.initSearchInputFilter()}ngOnDestroy(){this.searchTermSubscription.unsubscribe()}onChange(e){this.searchTermSubject.next(e)}resetSearchBox(){this.setSearchTermAndEmit("")}initSearchInputFilter(){this.searchTermSubject=new h.Subject;this.searchTerm$=this.searchTermSubject.asObservable().pipe(d.debounceTime(500),d.distinctUntilChanged());this.searchTermSubscription=this.searchTerm$.subscribe((e=>this.setSearchTermAndEmit(e)))}setSearchTermAndEmit(e){this.searchTerm=e;this.showResetButton=this.searchTerm!=="";this.searchTermChange.emit(this.searchTerm)}};__decorate([n.Input(),__metadata("design:type",Number)],ys.prototype,"versionsFoundCount",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],ys.prototype,"showSearchControls",void 0);__decorate([n.Output(),__metadata("design:type",Object)],ys.prototype,"searchTermChange",void 0);ys=__decorate([n.Component({selector:"se-versions-search",template:`<div class="se-versions-panel__search" *ngIf="showSearchControls"><div class="se-input-group"><input type="text" class="fd-input se-input-group__input-area" name="search-term" [ngModel]="searchTerm" (ngModelChange)="onChange($event)" [placeholder]="'se.cms.versions.search.placeholder' | translate"/> <span class="sap-icon--search se-input-group__addon"></span> <button class="se-input-group__addon se-input-group__clear-btn se-button--text sap-icon--decline" [style.visibility]="showResetButton ? 'visible' : 'hidden'" (click)="resetSearchBox()"></button></div><span class="se-versions-panel__count" [translate]="'se.cms.versions.search.versions.found'" [translateParams]="{ versionsFound: versionsFoundCount }"></span></div>`,styles:[`.se-versions-panel__search{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:8px 20px;border-bottom:1px solid var(--sapGroup_ContentBorderColor)}.se-versions-panel__count{display:flex;flex-direction:row;align-items:center;font-size:.75rem!important;line-height:1.3333333333;font-weight:400;white-space:nowrap}.se-input-group{flex-grow:1;margin-right:16px}`],changeDetection:n.ChangeDetectionStrategy.OnPush})],ys);window.__smartedit__.addDecoratorPayload("Component","VersionsPanelComponent",{selector:"se-versions-panel",template:`<div class="se-toolbar-menu-content--wrapper"><div class="se-toolbar-menu-content__header"><div class="se-toolbar-menu-content__header-title" translate="se.cms.actionitem.page.versions"></div><button class="se-versions-panel__manage-btn fd-button--compact" *ngIf="showManageButton" (click)="switchToVersioningMode()" fd-button [label]="'se.cms.toolbaritem.versioning.manageversions.name' | translate"></button></div><div class="se-versions-toolbar-menu-content__body" [ngClass]="{ 'se-versions-toolbar-menu-content__body--narrow': showManageButton }"><se-versions-search [versionsFoundCount]="versionsFound" [showSearchControls]="pageHasVersions()" (searchTermChange)="onSearchTermChanged($event)"></se-versions-search><div><se-infinite-scrolling class="se-versions-panel__infinite-scroll" *ngIf="pageHasVersionsOrIsLoading()" [pageSize]="10" [mask]="searchTerm" [fetchPage]="fetchPageOfVersions" (itemsChange)="onVersionItemsLoaded($event)"><div *ngFor="let item of versionItems; let isLast = last"><se-version-item [ngClass]="{ 'se-version-item--last': isLast }" [pageVersion]="item"></se-version-item></div></se-infinite-scrolling><div class="se-versions-panel__empty-list" *ngIf="!pageHasVersionsOrIsLoading()"><img src="static-resources/images/emptyVersions.svg" alt="no versions"/> <span class="se-versions-panel__no-versions-message" translate="se.cms.toolbaritem.versioning.noversionsfound"></span> <a fd-link class="se-versions-panel__manage-link fd-link" *ngIf="showManageLink" (click)="switchToVersioningMode()" translate="se.cms.toolbaritem.versioning.manageversionslink.name"></a></div></div></div></div>`,styles:[`.se-versions-panel .se-toolbar-menu-content__header{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);height:53px;padding-top:15px;height:48px}.se-versions-panel .se-toolbar-menu-content__header:first-child{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-versions-panel .se-versions-toolbar-menu-content__body .se-infinite-scrolling__container{width:340px;max-height:350px;overflow-y:auto;margin-bottom:8px;border-bottom-right-radius:var(--sapElement_BorderCornerRadius);border-bottom-left-radius:var(--sapElement_BorderCornerRadius)}.se-versions-panel .se-versions-toolbar-menu-content__body--narrow .se-infinite-scrolling__container{width:300px}.se-versions-panel__empty-list{display:flex;flex-direction:column;align-items:center;color:var(--sapNeutralColor);width:280px;padding:20px}.se-versions-panel__no-versions-message{padding:8px 0 4px}.se-versions-panel__manage-link{margin-bottom:20px;cursor:pointer}.se-versions-panel__manage-link:hover{text-decoration:none}`],encapsulation:n.ViewEncapsulation.None,host:{"[class.se-versions-panel]":"true"},changeDetection:n.ChangeDetectionStrategy.OnPush});let Ss=class VersionsPanelComponent{constructor(e,t,i,o){this.pageVersioningService=e;this.perspectiveService=t;this.logService=i;this.cdr=o;this.switchMode=new n.EventEmitter;this.searchTerm="";this.totalPageVersions=0;this.isLoading=true;this.VERSIONING_MODE_KEY=l.CMSModesService.VERSIONING_PERSPECTIVE_KEY;this.fetchPageOfVersions=(e,t,i)=>this.loadVersions(e,t,i)}ngOnInit(){this.showManageLink=this.canShowManageLink()}onVersionItemsLoaded(e){this.versionItems=e}onSearchTermChanged(e){this.searchTerm=e}switchToVersioningMode(){this.perspectiveService.switchTo(this.VERSIONING_MODE_KEY);this.switchMode.emit()}pageHasVersions(){return this.totalPageVersions>0}pageHasVersionsOrIsLoading(){return this.pageHasVersions()||this.isLoading}canShowManageButton(){return this.showManageLink&&this.pageHasVersions()}canShowManageLink(){const e=this.perspectiveService.getActivePerspective();return e&&e.key!==this.VERSIONING_MODE_KEY}loadVersions(e,t,i){return __awaiter(this,void 0,void 0,(function*(){try{const o=yield this.pageVersioningService.findPageVersions({pageUuid:this.pageUuid,currentPage:i,mask:e,pageSize:t});this.versionsFound=o.pagination.totalCount;if(this.isLoading){this.isLoading=false;this.totalPageVersions=this.versionsFound;this.showManageButton=this.canShowManageButton()}if(!this.cdr.destroyed){this.cdr.detectChanges()}return o}catch(e){this.logService.error(`Cannot find page versions for page ${this.pageUuid}.`);return null}}))}};__decorate([n.Input(),__metadata("design:type",String)],Ss.prototype,"pageUuid",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Ss.prototype,"switchMode",void 0);Ss=__decorate([n.Component({selector:"se-versions-panel",template:`<div class="se-toolbar-menu-content--wrapper"><div class="se-toolbar-menu-content__header"><div class="se-toolbar-menu-content__header-title" translate="se.cms.actionitem.page.versions"></div><button class="se-versions-panel__manage-btn fd-button--compact" *ngIf="showManageButton" (click)="switchToVersioningMode()" fd-button [label]="'se.cms.toolbaritem.versioning.manageversions.name' | translate"></button></div><div class="se-versions-toolbar-menu-content__body" [ngClass]="{ 'se-versions-toolbar-menu-content__body--narrow': showManageButton }"><se-versions-search [versionsFoundCount]="versionsFound" [showSearchControls]="pageHasVersions()" (searchTermChange)="onSearchTermChanged($event)"></se-versions-search><div><se-infinite-scrolling class="se-versions-panel__infinite-scroll" *ngIf="pageHasVersionsOrIsLoading()" [pageSize]="10" [mask]="searchTerm" [fetchPage]="fetchPageOfVersions" (itemsChange)="onVersionItemsLoaded($event)"><div *ngFor="let item of versionItems; let isLast = last"><se-version-item [ngClass]="{ 'se-version-item--last': isLast }" [pageVersion]="item"></se-version-item></div></se-infinite-scrolling><div class="se-versions-panel__empty-list" *ngIf="!pageHasVersionsOrIsLoading()"><img src="static-resources/images/emptyVersions.svg" alt="no versions"/> <span class="se-versions-panel__no-versions-message" translate="se.cms.toolbaritem.versioning.noversionsfound"></span> <a fd-link class="se-versions-panel__manage-link fd-link" *ngIf="showManageLink" (click)="switchToVersioningMode()" translate="se.cms.toolbaritem.versioning.manageversionslink.name"></a></div></div></div></div>`,styles:[`.se-versions-panel .se-toolbar-menu-content__header{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);height:53px;padding-top:15px;height:48px}.se-versions-panel .se-toolbar-menu-content__header:first-child{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-versions-panel .se-versions-toolbar-menu-content__body .se-infinite-scrolling__container{width:340px;max-height:350px;overflow-y:auto;margin-bottom:8px;border-bottom-right-radius:var(--sapElement_BorderCornerRadius);border-bottom-left-radius:var(--sapElement_BorderCornerRadius)}.se-versions-panel .se-versions-toolbar-menu-content__body--narrow .se-infinite-scrolling__container{width:300px}.se-versions-panel__empty-list{display:flex;flex-direction:column;align-items:center;color:var(--sapNeutralColor);width:280px;padding:20px}.se-versions-panel__no-versions-message{padding:8px 0 4px}.se-versions-panel__manage-link{margin-bottom:20px;cursor:pointer}.se-versions-panel__manage-link:hover{text-decoration:none}`],encapsulation:n.ViewEncapsulation.None,host:{"[class.se-versions-panel]":"true"},changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[l.PageVersioningService,l.IPerspectiveService,l.LogService,n.ChangeDetectorRef])],Ss);window.__smartedit__.addDecoratorPayload("Component","PageVersionMenuComponent",{selector:"se-page-version-menu",template:`\n        <div\n            class="se-toolbar-menu-content se-toolbar-menu-content--versions"\n            *ngIf="actionItem.isOpen">\n            <se-versions-panel\n                *ngIf="pageUuid"\n                [pageUuid]="pageUuid"\n                (switchMode)="onSwitchMode()"></se-versions-panel>\n        </div>\n    `});let Cs=class PageVersionMenuComponent{constructor(e,t,i){this.pageInfoService=e;this.pageVersionSelectionService=t;this.actionItem=i}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.pageVersionSelectionService.showToolbarContextIfNeeded();this.pageUuid=yield this.pageInfoService.getPageUUID()}))}onSwitchMode(){this.actionItem.isOpen=false}};Cs=__decorate([n.Component({selector:"se-page-version-menu",template:`\n        <div\n            class="se-toolbar-menu-content se-toolbar-menu-content--versions"\n            *ngIf="actionItem.isOpen">\n            <se-versions-panel\n                *ngIf="pageUuid"\n                [pageUuid]="pageUuid"\n                (switchMode)="onSwitchMode()"></se-versions-panel>\n        </div>\n    `}),__param(2,n.Inject(l.TOOLBAR_ITEM)),__metadata("design:paramtypes",[l.IPageInfoService,l.PageVersionSelectionService,Object])],Cs);let bs=class VersioningModule{};bs=__decorate([n.NgModule({imports:[l.TranslationModule.forChild(),g.CommonModule,s.FormsModule,l.TooltipModule,l.PopupOverlayModule,l.MoreTextModule,l.InfiniteScrollingModule,u.ButtonModule],declarations:[us,fs,hs,ys,Ss,Cs],entryComponents:[Cs,us],providers:[_s,vs]})],bs);window.__smartedit__.addDecoratorPayload("Component","PageTreeComponent",{selector:"se-page-tree-component",template:`<div [ngClass]="!component.isHidden && 'se-page-tree-drop-area'"><div class="se-page-tree-node" [ngClass]="{\n        'se-page-tree-node-expand': component.isExpanded,\n        'se-page-tree-component-node': draggable\n        }" [attr.node-smartedit-element-uuid]="!component.isHidden ?\n                     component.elementUuid :\n                     'hidden-component-has-no-uuid'" [attr.smartedit-slot-id]="slotId" [attr.smartedit-slot-uuid]="slotUuid" [attr.smartedit-slot-catalog-version-uuid]="slotCatalogVersionUuid" [attr.smartedit-component-id]="component.uid" [attr.smartedit-component-uuid]="component.uuid" [attr.smartedit-component-type]="component.componentTypeFromPage" [attr.smartedit-container-id]="component.containerId" [attr.smartedit-container-type]="component.containerType"><div [ngStyle]="draggable && {'cursor': 'grab'}" class="se-page-tree-component-node--content" (click)="onClickComponentNode($event)"><span *ngIf="component.children && component.children.length > 0" [ngClass]="component.isExpanded ?\n                                'sap-icon--navigation-down-arrow' :\n                                'sap-icon--navigation-right-arrow'" class="se-page-tree-node--icon" title="{{ getComponentNavigationIconTitle() | translate }}"></span> <span *ngIf="!component.children || component.children.length === 0" class="se-page-tree-node--icon"></span> <span class="se-page-tree-node--icon sap-icon--background"></span><div class="se-page-tree-component-node--name"><span class="se-page-tree-component-node--name--up" title="{{component.name}}">{{component.name}}</span> <span class="se-page-tree-component-node--name--down" title="{{component.typeCode}}">{{component.typeCode}}</span></div></div><se-page-tree-component-menu [component]="component" [slotId]="slotId" [slotUuid]="slotUuid" class="se-page-tree-menu"></se-page-tree-component-menu><div class="se-page-tree-component-drop-area"><div class="se-page-tree-component-drop-area-circle"></div><div class="se-page-tree-component-drop-area-line"></div></div></div></div><div *ngIf="component.isExpanded && component.componentNodes"><div *ngFor="let child of component.componentNodes"><se-page-tree-child-component [component]="child" [parentMenuConfiguration]="menuConfiguration" [slotId]="slotId" [slotUuid]="slotUuid"></se-page-tree-child-component></div></div>`,styles:[`.se-page-tree-component-node{position:relative}.se-page-tree-component-node--content{display:flex;padding-left:8px;cursor:pointer;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-node--name{display:flex;flex-direction:column;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor);overflow:hidden}.se-page-tree-component-node--name--up{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-node--name--down{font-style:oblique;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-drop-area{position:absolute;left:0;width:100%;display:none}.se-page-tree-component-drop-area-circle{width:10px;height:10px;border:2px solid var(--sapContent_DragAndDropActiveColor);border-radius:50%;background-color:var(--sapShell_Background)}.se-page-tree-component-drop-area-line{width:100%;height:2px;background:var(--sapContent_DragAndDropActiveColor);margin-top:4px}.se-page-tree-component-dragged{opacity:.4}`,`.se-page-tree-node{height:48px;display:flex;align-items:center;padding:0 12px;border-bottom:1px solid #f1f1f1;width:100%}.se-page-tree-node:hover{background:var(--sapList_Hover_Background)}.se-page-tree-node-expand{background:var(--sapList_SelectionBackgroundColor)}.se-page-tree-node-expand:hover{background:var(--sapList_Hover_SelectionBackground)}.se-page-tree-node--icon{color:var(--sapLinkColor);margin-right:8px;min-width:12.25px}.se-page-tree-slot-node--name{color:var(--sapContent_LabelColor)}.se-page-tree-slot-node--content{font-size:14px;line-height:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;width:100%}.se-page-tree-slot-allowed-drop{border:2px solid var(--sapContent_DragAndDropActiveColor)}.se-page-tree-menu{margin-left:auto}`]});let Is=class PageTreeComponent{constructor(e,t,i,o,s){this.pageTreeNodeService=e;this.nodeInfoService=t;this.logService=i;this.componentMenuConditionAndCallbackService=o;this.permissionService=s;this.onComponentExpanded=new n.EventEmitter;this.publishComponentInterval=null}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=this.nodeInfoService.getComponentAttributes(this.component);this.menuConfiguration=this.nodeInfoService.getContextualMenuConfiguration(this.component,e,this.slotId,this.slotUuid);if(this.component.isHidden){this.draggable=false}else{const e=yield this.permissionService.isPermitted([{names:["se.context.menu.drag.and.drop.component"]}]);this.draggable=e&&(yield this.componentMenuConditionAndCallbackService.dragCondition(this.menuConfiguration))}}))}onClickComponentNode(e){return __awaiter(this,void 0,void 0,(function*(){clearInterval(this.publishComponentInterval);this.component.isExpanded=!this.component.isExpanded;if(this.component.isExpanded){this.component.componentNodes=yield this.nodeInfoService.getChildComponents(this.component);this.onComponentExpanded.emit(this.component);yield this.pageTreeNodeService.scrollToElement(this.component.elementUuid);if(!(yield this.checkComponentAndPublishSelected())){let e=0;this.publishComponentInterval=setInterval((()=>__awaiter(this,void 0,void 0,(function*(){if(yield this.checkComponentAndPublishSelected()){clearInterval(this.publishComponentInterval)}if(e>rt){this.logService.info(`PageTreeComponent:: onClickComponentNode error: smartedit-element ${this.component.elementUuid} is not existed`);clearInterval(this.publishComponentInterval)}e++}))),lt)}}else{this.nodeInfoService.publishComponentSelected(this.component,false,this.slotElementUuid)}}))}getComponentNavigationIconTitle(){return this.component.isExpanded?"se.cms.pagetree.slot.node.navigation.icon.collapse.title":"se.cms.pagetree.slot.node.navigation.icon.expand.title"}checkComponentAndPublishSelected(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageTreeNodeService.existedSmartEditElement(this.component.elementUuid);if(e){this.nodeInfoService.publishComponentSelected(this.component,true,this.slotElementUuid);return true}return false}))}};__decorate([n.Input(),__metadata("design:type",Object)],Is.prototype,"component",void 0);__decorate([n.Input(),__metadata("design:type",String)],Is.prototype,"slotId",void 0);__decorate([n.Input(),__metadata("design:type",String)],Is.prototype,"slotUuid",void 0);__decorate([n.Input(),__metadata("design:type",String)],Is.prototype,"slotElementUuid",void 0);__decorate([n.Input(),__metadata("design:type",String)],Is.prototype,"slotCatalogVersionUuid",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Is.prototype,"onComponentExpanded",void 0);Is=__decorate([n.Component({selector:"se-page-tree-component",template:`<div [ngClass]="!component.isHidden && 'se-page-tree-drop-area'"><div class="se-page-tree-node" [ngClass]="{\n        'se-page-tree-node-expand': component.isExpanded,\n        'se-page-tree-component-node': draggable\n        }" [attr.node-smartedit-element-uuid]="!component.isHidden ?\n                     component.elementUuid :\n                     'hidden-component-has-no-uuid'" [attr.smartedit-slot-id]="slotId" [attr.smartedit-slot-uuid]="slotUuid" [attr.smartedit-slot-catalog-version-uuid]="slotCatalogVersionUuid" [attr.smartedit-component-id]="component.uid" [attr.smartedit-component-uuid]="component.uuid" [attr.smartedit-component-type]="component.componentTypeFromPage" [attr.smartedit-container-id]="component.containerId" [attr.smartedit-container-type]="component.containerType"><div [ngStyle]="draggable && {'cursor': 'grab'}" class="se-page-tree-component-node--content" (click)="onClickComponentNode($event)"><span *ngIf="component.children && component.children.length > 0" [ngClass]="component.isExpanded ?\n                                'sap-icon--navigation-down-arrow' :\n                                'sap-icon--navigation-right-arrow'" class="se-page-tree-node--icon" title="{{ getComponentNavigationIconTitle() | translate }}"></span> <span *ngIf="!component.children || component.children.length === 0" class="se-page-tree-node--icon"></span> <span class="se-page-tree-node--icon sap-icon--background"></span><div class="se-page-tree-component-node--name"><span class="se-page-tree-component-node--name--up" title="{{component.name}}">{{component.name}}</span> <span class="se-page-tree-component-node--name--down" title="{{component.typeCode}}">{{component.typeCode}}</span></div></div><se-page-tree-component-menu [component]="component" [slotId]="slotId" [slotUuid]="slotUuid" class="se-page-tree-menu"></se-page-tree-component-menu><div class="se-page-tree-component-drop-area"><div class="se-page-tree-component-drop-area-circle"></div><div class="se-page-tree-component-drop-area-line"></div></div></div></div><div *ngIf="component.isExpanded && component.componentNodes"><div *ngFor="let child of component.componentNodes"><se-page-tree-child-component [component]="child" [parentMenuConfiguration]="menuConfiguration" [slotId]="slotId" [slotUuid]="slotUuid"></se-page-tree-child-component></div></div>`,styles:[`.se-page-tree-component-node{position:relative}.se-page-tree-component-node--content{display:flex;padding-left:8px;cursor:pointer;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-node--name{display:flex;flex-direction:column;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor);overflow:hidden}.se-page-tree-component-node--name--up{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-node--name--down{font-style:oblique;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-drop-area{position:absolute;left:0;width:100%;display:none}.se-page-tree-component-drop-area-circle{width:10px;height:10px;border:2px solid var(--sapContent_DragAndDropActiveColor);border-radius:50%;background-color:var(--sapShell_Background)}.se-page-tree-component-drop-area-line{width:100%;height:2px;background:var(--sapContent_DragAndDropActiveColor);margin-top:4px}.se-page-tree-component-dragged{opacity:.4}`,`.se-page-tree-node{height:48px;display:flex;align-items:center;padding:0 12px;border-bottom:1px solid #f1f1f1;width:100%}.se-page-tree-node:hover{background:var(--sapList_Hover_Background)}.se-page-tree-node-expand{background:var(--sapList_SelectionBackgroundColor)}.se-page-tree-node-expand:hover{background:var(--sapList_Hover_SelectionBackground)}.se-page-tree-node--icon{color:var(--sapLinkColor);margin-right:8px;min-width:12.25px}.se-page-tree-slot-node--name{color:var(--sapContent_LabelColor)}.se-page-tree-slot-node--content{font-size:14px;line-height:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;width:100%}.se-page-tree-slot-allowed-drop{border:2px solid var(--sapContent_DragAndDropActiveColor)}.se-page-tree-menu{margin-left:auto}`]}),__metadata("design:paramtypes",[l.IPageTreeNodeService,t.NodeInfoService,l.LogService,r.IComponentMenuConditionAndCallbackService,l.IPermissionService])],Is);window.__smartedit__.addDecoratorPayload("Component","PageTreeChildComponent",{selector:"se-page-tree-child-component",template:`<ng-template #templateTreeNode let-component="component" let-subIndex="subIndex"><div class="se-page-tree-node" [ngClass]="component.isExpanded && 'se-page-tree-node-expand'" [attr.node-smartedit-element-uuid]="!component.isHidden ?\n                     component.elementUuid :\n                     'hidden-component-has-no-uuid'"><div (click)="onClickComponentNode($event, component)" class="se-page-tree-component-node--content" [ngStyle]="{ 'padding-left.px': subIndex*8 }"><span *ngIf="component.children && component.children.length > 0" [ngClass]="component.isExpanded ?\n                                'sap-icon--navigation-down-arrow' :\n                                'sap-icon--navigation-right-arrow'" class="se-page-tree-node--icon" title="{{ component.isExpanded ?\n                                'se.cms.pagetree.slot.node.navigation.icon.collapse.title' :\n                                'se.cms.pagetree.slot.node.navigation.icon.expand.title'\n                          | translate }}"></span> <span *ngIf="!component.children || component.children.length === 0" class="se-page-tree-node--icon"></span> <span class="se-page-tree-node--icon sap-icon--background"></span><div class="se-page-tree-component-node--name"><span class="se-page-tree-component-node--name--up" title="{{component.name}}">{{component.name}}</span> <span class="se-page-tree-component-node--name--down" title="{{component.typeCode}}">{{component.typeCode}}</span></div></div><se-pagetree-child-component-menu [component]="component" [slotId]="slotId" [slotUuid]="slotUuid" [parentMenuConfiguration]="parentMenuConfiguration" class="se-page-tree-menu"></se-pagetree-child-component-menu></div><div *ngIf="component.isExpanded && component.componentNodes" class="se-page-tree-component-node-children"><div *ngFor="let child of component.componentNodes"><ng-container *ngTemplateOutlet="templateTreeNode,context:{component:child, subIndex: subIndex+1 }"></ng-container></div></div></ng-template><ng-container *ngTemplateOutlet="templateTreeNode,context:{component:component, subIndex:2}"></ng-container>`,styles:[`.se-page-tree-component-node{position:relative}.se-page-tree-component-node--content{display:flex;padding-left:8px;cursor:pointer;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-node--name{display:flex;flex-direction:column;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor);overflow:hidden}.se-page-tree-component-node--name--up{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-node--name--down{font-style:oblique;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-drop-area{position:absolute;left:0;width:100%;display:none}.se-page-tree-component-drop-area-circle{width:10px;height:10px;border:2px solid var(--sapContent_DragAndDropActiveColor);border-radius:50%;background-color:var(--sapShell_Background)}.se-page-tree-component-drop-area-line{width:100%;height:2px;background:var(--sapContent_DragAndDropActiveColor);margin-top:4px}.se-page-tree-component-dragged{opacity:.4}`,`.se-page-tree-node{height:48px;display:flex;align-items:center;padding:0 12px;border-bottom:1px solid #f1f1f1;width:100%}.se-page-tree-node:hover{background:var(--sapList_Hover_Background)}.se-page-tree-node-expand{background:var(--sapList_SelectionBackgroundColor)}.se-page-tree-node-expand:hover{background:var(--sapList_Hover_SelectionBackground)}.se-page-tree-node--icon{color:var(--sapLinkColor);margin-right:8px;min-width:12.25px}.se-page-tree-slot-node--name{color:var(--sapContent_LabelColor)}.se-page-tree-slot-node--content{font-size:14px;line-height:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;width:100%}.se-page-tree-slot-allowed-drop{border:2px solid var(--sapContent_DragAndDropActiveColor)}.se-page-tree-menu{margin-left:auto}`]});let Es=class PageTreeChildComponent{constructor(e){this.nodeInfoService=e}onClickComponentNode(e,t){return __awaiter(this,void 0,void 0,(function*(){t.isExpanded=!t.isExpanded;if(t.isExpanded){t.componentNodes=yield this.nodeInfoService.getChildComponents(t)}}))}};__decorate([n.Input(),__metadata("design:type",Object)],Es.prototype,"component",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Es.prototype,"parentMenuConfiguration",void 0);__decorate([n.Input(),__metadata("design:type",String)],Es.prototype,"slotId",void 0);__decorate([n.Input(),__metadata("design:type",String)],Es.prototype,"slotUuid",void 0);Es=__decorate([n.Component({selector:"se-page-tree-child-component",template:`<ng-template #templateTreeNode let-component="component" let-subIndex="subIndex"><div class="se-page-tree-node" [ngClass]="component.isExpanded && 'se-page-tree-node-expand'" [attr.node-smartedit-element-uuid]="!component.isHidden ?\n                     component.elementUuid :\n                     'hidden-component-has-no-uuid'"><div (click)="onClickComponentNode($event, component)" class="se-page-tree-component-node--content" [ngStyle]="{ 'padding-left.px': subIndex*8 }"><span *ngIf="component.children && component.children.length > 0" [ngClass]="component.isExpanded ?\n                                'sap-icon--navigation-down-arrow' :\n                                'sap-icon--navigation-right-arrow'" class="se-page-tree-node--icon" title="{{ component.isExpanded ?\n                                'se.cms.pagetree.slot.node.navigation.icon.collapse.title' :\n                                'se.cms.pagetree.slot.node.navigation.icon.expand.title'\n                          | translate }}"></span> <span *ngIf="!component.children || component.children.length === 0" class="se-page-tree-node--icon"></span> <span class="se-page-tree-node--icon sap-icon--background"></span><div class="se-page-tree-component-node--name"><span class="se-page-tree-component-node--name--up" title="{{component.name}}">{{component.name}}</span> <span class="se-page-tree-component-node--name--down" title="{{component.typeCode}}">{{component.typeCode}}</span></div></div><se-pagetree-child-component-menu [component]="component" [slotId]="slotId" [slotUuid]="slotUuid" [parentMenuConfiguration]="parentMenuConfiguration" class="se-page-tree-menu"></se-pagetree-child-component-menu></div><div *ngIf="component.isExpanded && component.componentNodes" class="se-page-tree-component-node-children"><div *ngFor="let child of component.componentNodes"><ng-container *ngTemplateOutlet="templateTreeNode,context:{component:child, subIndex: subIndex+1 }"></ng-container></div></div></ng-template><ng-container *ngTemplateOutlet="templateTreeNode,context:{component:component, subIndex:2}"></ng-container>`,styles:[`.se-page-tree-component-node{position:relative}.se-page-tree-component-node--content{display:flex;padding-left:8px;cursor:pointer;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-node--name{display:flex;flex-direction:column;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor);overflow:hidden}.se-page-tree-component-node--name--up{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-node--name--down{font-style:oblique;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.se-page-tree-component-drop-area{position:absolute;left:0;width:100%;display:none}.se-page-tree-component-drop-area-circle{width:10px;height:10px;border:2px solid var(--sapContent_DragAndDropActiveColor);border-radius:50%;background-color:var(--sapShell_Background)}.se-page-tree-component-drop-area-line{width:100%;height:2px;background:var(--sapContent_DragAndDropActiveColor);margin-top:4px}.se-page-tree-component-dragged{opacity:.4}`,`.se-page-tree-node{height:48px;display:flex;align-items:center;padding:0 12px;border-bottom:1px solid #f1f1f1;width:100%}.se-page-tree-node:hover{background:var(--sapList_Hover_Background)}.se-page-tree-node-expand{background:var(--sapList_SelectionBackgroundColor)}.se-page-tree-node-expand:hover{background:var(--sapList_Hover_SelectionBackground)}.se-page-tree-node--icon{color:var(--sapLinkColor);margin-right:8px;min-width:12.25px}.se-page-tree-slot-node--name{color:var(--sapContent_LabelColor)}.se-page-tree-slot-node--content{font-size:14px;line-height:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;width:100%}.se-page-tree-slot-allowed-drop{border:2px solid var(--sapContent_DragAndDropActiveColor)}.se-page-tree-menu{margin-left:auto}`]}),__metadata("design:paramtypes",[t.NodeInfoService])],Es);window.__smartedit__.addDecoratorPayload("Component","PageTreeSlot",{selector:"se-page-tree-slot",template:`<div class="se-page-tree-node se-page-tree-drop-area" [ngClass]="node.isExpanded && 'se-page-tree-node-expand'" [attr.node-smartedit-element-uuid]="node.elementUuid" [attr.expanded]="node.isExpanded" [attr.smartedit-slot-id]="node.componentId" [attr.smartedit-slot-uuid]="node.componentUuid" [attr.smartedit-slot-catalog-version-uuid]="node.catalogVersionUuid"><div (click)="onClickSlotNode($event)" class="se-page-tree-slot-node--content"><span *ngIf="node.componentNodes.length > 0" [ngClass]="node.isExpanded ?\n                    'sap-icon--navigation-down-arrow' :\n                    'sap-icon--navigation-right-arrow'" class="se-page-tree-node--icon" title="{{ getNodeNavigationIconTitle() | translate }}"></span> <span class="se-page-tree-slot-node--name" [ngStyle]="{ 'margin-left.px': node.componentNodes.length > 0 ? 0 : 20}">{{node.componentId}}</span></div><se-page-tree-slot-menu [node]="node" class="se-page-tree-menu"></se-page-tree-slot-menu></div><div *ngIf="node.isExpanded && node.componentNodes"><se-page-tree-component *ngFor="let child of node.componentNodes" [component]="child" [slotId]="node.componentId" [slotUuid]="node.componentUuid" [slotElementUuid]="node.elementUuid" [slotCatalogVersionUuid]="node.catalogVersionUuid" (onComponentExpanded)="onComponentExpanded($event)"></se-page-tree-component></div>`,styles:[`.se-page-tree-node{height:48px;display:flex;align-items:center;padding:0 12px;border-bottom:1px solid #f1f1f1;width:100%}.se-page-tree-node:hover{background:var(--sapList_Hover_Background)}.se-page-tree-node-expand{background:var(--sapList_SelectionBackgroundColor)}.se-page-tree-node-expand:hover{background:var(--sapList_Hover_SelectionBackground)}.se-page-tree-node--icon{color:var(--sapLinkColor);margin-right:8px;min-width:12.25px}.se-page-tree-slot-node--name{color:var(--sapContent_LabelColor)}.se-page-tree-slot-node--content{font-size:14px;line-height:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;width:100%}.se-page-tree-slot-allowed-drop{border:2px solid var(--sapContent_DragAndDropActiveColor)}.se-page-tree-menu{margin-left:auto}`]});let ws=class PageTreeSlot{constructor(e,t,i,o,s){this.pageTreeNodeService=e;this.nodeInfoService=t;this.systemEventService=i;this.logService=o;this.userTrackingService=s;this.onSlotExpanded=new n.EventEmitter;this.publishSlotInterval=null;this.unregisterPageTreeSlotExpanded=this.systemEventService.subscribe(l.PAGE_TREE_SLOT_EXPANDED_EVENT,((e,t)=>{if(t===this.node.elementUuid){this.node.isExpanded=true}}))}ngOnDestroy(){if(this.unregisterPageTreeSlotExpanded){this.unregisterPageTreeSlotExpanded()}}onClickSlotNode(e){return __awaiter(this,void 0,void 0,(function*(){this.userTrackingService.trackingUserAction(l.USER_TRACKING_FUNCTIONALITY.PAGE_STRUCTURE,"Slot");clearInterval(this.publishSlotInterval);this.node.isExpanded=!this.node.isExpanded;if(!this.node.isExpanded){this.node.componentNodes.forEach((e=>e.isExpanded=false));this.nodeInfoService.publishSlotSelected(this.node)}else{this.onSlotExpanded.emit(this.node);yield this.pageTreeNodeService.scrollToElement(this.node.elementUuid);if(!(yield this.checkSlotAndPublishSelected())){let e=0;this.publishSlotInterval=setInterval((()=>__awaiter(this,void 0,void 0,(function*(){if(yield this.checkSlotAndPublishSelected()){clearInterval(this.publishSlotInterval)}if(e>rt){this.logService.info(`PageTreeSlot:: onClickSlotNode error: smartedit-element ${this.node.elementUuid} is not existed`);clearInterval(this.publishSlotInterval)}e++}))),lt)}}}))}onComponentExpanded(e){this.node.componentNodes.filter((t=>t.elementUuid!==e.elementUuid)).forEach((e=>{if(e.isExpanded){e.isExpanded=false;this.nodeInfoService.publishComponentSelected(e,false,this.node.elementUuid)}}))}getNodeNavigationIconTitle(){return this.node.isExpanded?"se.cms.pagetree.slot.node.navigation.icon.collapse.title":"se.cms.pagetree.slot.node.navigation.icon.expand.title"}checkSlotAndPublishSelected(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageTreeNodeService.existedSmartEditElement(this.node.elementUuid);if(e){this.nodeInfoService.publishSlotSelected(this.node);return true}return false}))}};__decorate([n.Input(),__metadata("design:type",Object)],ws.prototype,"node",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],ws.prototype,"onSlotExpanded",void 0);ws=__decorate([n.Component({selector:"se-page-tree-slot",template:`<div class="se-page-tree-node se-page-tree-drop-area" [ngClass]="node.isExpanded && 'se-page-tree-node-expand'" [attr.node-smartedit-element-uuid]="node.elementUuid" [attr.expanded]="node.isExpanded" [attr.smartedit-slot-id]="node.componentId" [attr.smartedit-slot-uuid]="node.componentUuid" [attr.smartedit-slot-catalog-version-uuid]="node.catalogVersionUuid"><div (click)="onClickSlotNode($event)" class="se-page-tree-slot-node--content"><span *ngIf="node.componentNodes.length > 0" [ngClass]="node.isExpanded ?\n                    'sap-icon--navigation-down-arrow' :\n                    'sap-icon--navigation-right-arrow'" class="se-page-tree-node--icon" title="{{ getNodeNavigationIconTitle() | translate }}"></span> <span class="se-page-tree-slot-node--name" [ngStyle]="{ 'margin-left.px': node.componentNodes.length > 0 ? 0 : 20}">{{node.componentId}}</span></div><se-page-tree-slot-menu [node]="node" class="se-page-tree-menu"></se-page-tree-slot-menu></div><div *ngIf="node.isExpanded && node.componentNodes"><se-page-tree-component *ngFor="let child of node.componentNodes" [component]="child" [slotId]="node.componentId" [slotUuid]="node.componentUuid" [slotElementUuid]="node.elementUuid" [slotCatalogVersionUuid]="node.catalogVersionUuid" (onComponentExpanded)="onComponentExpanded($event)"></se-page-tree-component></div>`,styles:[`.se-page-tree-node{height:48px;display:flex;align-items:center;padding:0 12px;border-bottom:1px solid #f1f1f1;width:100%}.se-page-tree-node:hover{background:var(--sapList_Hover_Background)}.se-page-tree-node-expand{background:var(--sapList_SelectionBackgroundColor)}.se-page-tree-node-expand:hover{background:var(--sapList_Hover_SelectionBackground)}.se-page-tree-node--icon{color:var(--sapLinkColor);margin-right:8px;min-width:12.25px}.se-page-tree-slot-node--name{color:var(--sapContent_LabelColor)}.se-page-tree-slot-node--content{font-size:14px;line-height:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;width:100%}.se-page-tree-slot-allowed-drop{border:2px solid var(--sapContent_DragAndDropActiveColor)}.se-page-tree-menu{margin-left:auto}`]}),__metadata("design:paramtypes",[l.IPageTreeNodeService,t.NodeInfoService,l.SystemEventService,l.LogService,l.IUserTrackingService])],ws);window.__smartedit__.addDecoratorPayload("Component","PageTreePanel",{selector:"se-page-tree",template:`<div class="se-page-tree"><div class="se-page-tree--header"><span class="se-page-tree--header--icon sap-icon--Chart-Tree-Map"></span> <span class="se-page-tree--header--title">{{ 'se.page.tree.title' | translate }}</span></div><div id="se-page-tree-scroll-area" class="se-page-tree-scroll-area"><se-page-tree-slot *ngFor="let node of slotNodes" [node]="node" (onSlotExpanded)="onSlotExpanded($event)"></se-page-tree-slot></div></div>`,styles:[`.se-page-tree{background:var(--sapBaseColor);width:100%;height:100%;filter:drop-shadow(0px 4px 4px rgba(0, 0, 0, .25));border-radius:4px;font-family:var(--sapFontFamily)}.se-page-tree--header{height:48px;padding:0 12px;display:flex;align-items:center;box-shadow:0 1px 0 var(--sapLegend_NonWorkingBackground)}.se-page-tree--header--icon{width:16px;height:18px;line-height:19px;font-size:16px;color:var(--sapContent_IconColor);text-align:center}.se-page-tree--header--title{font-size:18px;line-height:21px;margin:0 10px;color:var(--sapTextColor)}.se-page-tree-scroll-area{height:calc(100% - 48px);overflow-y:scroll}.se-page-tree-scroll-area::-webkit-scrollbar{display:none}`]});let Ts=class PageTreePanel{constructor(e,t,i,o,n){this.crossFrameEventService=e;this.nodeInfoService=t;this.yjQuery=i;this.cdr=o;this.logService=n;this.slotNodes=null;this.scrollToNodeInterval=null;this.expandComponentNodeInterval=null;this.unregisterOpenInPageTree=this.crossFrameEventService.subscribe(l.EVENT_OPEN_IN_PAGE_TREE,this.handleEventOpenInPageTree.bind(this));this.unregisterPartRefreshTreeNode=this.crossFrameEventService.subscribe(l.EVENT_PART_REFRESH_TREE_NODE,((e,t)=>__awaiter(this,void 0,void 0,(function*(){this.slotNodes=yield this.nodeInfoService.updatePartTreeNodesInfo(t);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))));this.unregisterOverallRefreshTree=this.crossFrameEventService.subscribe(l.EVENT_OVERALL_REFRESH_TREE_NODE,this.updateSlotNode.bind(this));this.unregisterPageTreeSlotUpdate=this.crossFrameEventService.subscribe(l.EVENT_PAGE_TREE_SLOT_NEED_UPDATE,((e,t)=>__awaiter(this,void 0,void 0,(function*(){this.slotNodes=yield this.nodeInfoService.updatePartTreeNodesInfoBySlotUuid(t);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))));this.unregisterScrollToModifiedSlot=this.crossFrameEventService.subscribe(r.DRAG_AND_DROP_EVENTS.SCROLL_TO_MODIFIED_SLOT,((e,t)=>{this.slotNodes&&this.slotNodes.forEach((e=>{if(e.componentId===t){e.isExpanded=true;this.scrollToNode(e.elementUuid)}else{e.isExpanded=false;e.componentNodes.forEach((e=>e.isExpanded=false))}}))}))}ngOnDestroy(){if(this.unregisterOpenInPageTree){this.unregisterOpenInPageTree()}if(this.unregisterPartRefreshTreeNode){this.unregisterPartRefreshTreeNode()}if(this.unregisterOverallRefreshTree){this.unregisterOverallRefreshTree()}if(this.unregisterPageTreeSlotUpdate){this.unregisterPageTreeSlotUpdate()}if(this.unregisterScrollToModifiedSlot){this.unregisterScrollToModifiedSlot()}}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){yield this.updateSlotNode()}))}onSlotExpanded(e){this.slotNodes.filter((t=>e.elementUuid!==t.elementUuid)).forEach((e=>{e.isExpanded=false;e.componentNodes.forEach((e=>e.isExpanded=false))}))}handleEventOpenInPageTree(e,t){clearInterval(this.expandComponentNodeInterval);if(!this.expandComponentNode(t)){let e=0;this.expandComponentNodeInterval=setInterval((()=>{if(this.expandComponentNode(t)){clearInterval(this.expandComponentNodeInterval)}if(e>rt){this.logService.error(`PageTreeComponent:: handleEventOpenInPageTree error: expand component node ${t} failed`);clearInterval(this.expandComponentNodeInterval)}e++}),lt)}}updateSlotNode(){return __awaiter(this,void 0,void 0,(function*(){this.slotNodes=yield this.nodeInfoService.buildNodesInfo();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}expandComponentNode(e){if(this.slotNodes){this.slotNodes.forEach((t=>{let i=null;t.componentNodes.forEach((t=>{if(t.elementUuid===e){t.isExpanded=true;i=t}else{t.isExpanded=false}}));if(i){t.isExpanded=true;this.scrollToNodeByInterval(i.elementUuid)}else{t.isExpanded=false}}));return true}return false}scrollToNode(e){const t=this.yjQuery(`div[node-smartedit-element-uuid="${e}"]`).get().shift();if(t){t.scrollIntoView({behavior:"smooth",block:"center"});return true}return false}scrollToNodeByInterval(e){clearInterval(this.scrollToNodeInterval);if(!this.scrollToNode(e)){let t=0;this.scrollToNodeInterval=setInterval((()=>{if(this.scrollToNode(e)){clearInterval(this.scrollToNodeInterval)}if(t>rt){this.logService.error(`PageTreeComponent:: scrollToNodeByInterval error: scroll to tree node ${e} failed!`);clearInterval(this.scrollToNodeInterval)}t++}),lt)}}};Ts=__decorate([n.Component({selector:"se-page-tree",template:`<div class="se-page-tree"><div class="se-page-tree--header"><span class="se-page-tree--header--icon sap-icon--Chart-Tree-Map"></span> <span class="se-page-tree--header--title">{{ 'se.page.tree.title' | translate }}</span></div><div id="se-page-tree-scroll-area" class="se-page-tree-scroll-area"><se-page-tree-slot *ngFor="let node of slotNodes" [node]="node" (onSlotExpanded)="onSlotExpanded($event)"></se-page-tree-slot></div></div>`,styles:[`.se-page-tree{background:var(--sapBaseColor);width:100%;height:100%;filter:drop-shadow(0px 4px 4px rgba(0, 0, 0, .25));border-radius:4px;font-family:var(--sapFontFamily)}.se-page-tree--header{height:48px;padding:0 12px;display:flex;align-items:center;box-shadow:0 1px 0 var(--sapLegend_NonWorkingBackground)}.se-page-tree--header--icon{width:16px;height:18px;line-height:19px;font-size:16px;color:var(--sapContent_IconColor);text-align:center}.se-page-tree--header--title{font-size:18px;line-height:21px;margin:0 10px;color:var(--sapTextColor)}.se-page-tree-scroll-area{height:calc(100% - 48px);overflow-y:scroll}.se-page-tree-scroll-area::-webkit-scrollbar{display:none}`]}),__param(2,n.Inject(l.YJQUERY_TOKEN)),__metadata("design:paramtypes",[l.CrossFrameEventService,t.NodeInfoService,Function,n.ChangeDetectorRef,l.LogService])],Ts);class ParentMenu{}window.__smartedit__.addDecoratorPayload("Component","PageTreeMenuItemOverlayComponent",{template:`\n        <div *ngIf="item.action.component">\n            <ng-container\n                *ngComponentOutlet="\n                    item.action.component;\n                    injector: componentInjector\n                "></ng-container>\n        </div>\n    `,selector:"se-contextual-menu-item-overlay"});let Ps=class PageTreeMenuItemOverlayComponent{constructor(e,t,i){this.data=e;this.parent=t;this.injector=i}ngOnInit(){this.createComponentInjector()}get item(){return this.data.item}createComponentInjector(){this.componentInjector=n.Injector.create({parent:this.injector,providers:[{provide:l.CONTEXTUAL_MENU_ITEM_DATA,useValue:{componentAttributes:this.parent.componentAttributes,setRemainOpen:(e,t)=>this.parent.setRemainOpen(e,t)}}]})}};Ps=__decorate([n.Component({template:`\n        <div *ngIf="item.action.component">\n            <ng-container\n                *ngComponentOutlet="\n                    item.action.component;\n                    injector: componentInjector\n                "></ng-container>\n        </div>\n    `,selector:"se-contextual-menu-item-overlay"}),__param(0,n.Inject(l.POPUP_OVERLAY_DATA)),__metadata("design:paramtypes",[Object,ParentMenu,n.Injector])],Ps);window.__smartedit__.addDecoratorPayload("Component","PageTreeMoreItemsComponent",{selector:"se-page-tree-more-items",styles:[`.se-page-tree-component-menu{margin:0 0 0 auto;display:flex;flex-direction:row}.se-page-tree-component-menu--hide{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor)}.se-page-tree-component-menu--icon{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapLinkColor)}.se-page-tree-component-more{min-width:118px}.se-page-tree-component-more-list{display:flex;flex-direction:column;padding:0}.se-page-tree-component-more-menu--span{font-family:var(--sapFontFamily);font-size:14px;color:var(--sapLinkColor);display:block;min-width:104px;padding:12px 16px}.is-storefront .fd-popover__popper{border-radius:0}`],template:`\n        <div class="se-page-tree-component-more">\n            <ul\n                id="{{ parent.component.uid }}-{{ parent.component.typeCode }}-more-menu"\n                class="fd-menu__list se-page-tree-component-more-list">\n                <li\n                    *ngFor="let item of parent.getItems()"\n                    [attr.data-smartedit-id]="parent.component.uid"\n                    [attr.data-smartedit-type]="parent.component.typeCode"\n                    class="se-page-tree-component-more-menu fd-menu__item">\n                    <se-popup-overlay\n                        [popupOverlay]="itemTemplateOverlayWrapper"\n                        [popupOverlayTrigger]="parent.canShowTemplate(item)"\n                        [popupOverlayData]="{ item: item }"\n                        (popupOverlayOnHide)="parent.onHideItemPopup(true)">\n                        <span\n                            class="se-page-tree-component-more-menu--span"\n                            (click)="parent.triggerMenuItemAction(item, $event)">\n                            {{ item.i18nKey | translate }}\n                        </span>\n                    </se-popup-overlay>\n                </li>\n            </ul>\n        </div>\n    `});let Os=class PageTreeMoreItemsComponent{constructor(e){this.parent=e;this.itemTemplateOverlayWrapper={component:Ps}}};Os=__decorate([n.Component({selector:"se-page-tree-more-items",styles:[`.se-page-tree-component-menu{margin:0 0 0 auto;display:flex;flex-direction:row}.se-page-tree-component-menu--hide{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor)}.se-page-tree-component-menu--icon{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapLinkColor)}.se-page-tree-component-more{min-width:118px}.se-page-tree-component-more-list{display:flex;flex-direction:column;padding:0}.se-page-tree-component-more-menu--span{font-family:var(--sapFontFamily);font-size:14px;color:var(--sapLinkColor);display:block;min-width:104px;padding:12px 16px}.is-storefront .fd-popover__popper{border-radius:0}`],template:`\n        <div class="se-page-tree-component-more">\n            <ul\n                id="{{ parent.component.uid }}-{{ parent.component.typeCode }}-more-menu"\n                class="fd-menu__list se-page-tree-component-more-list">\n                <li\n                    *ngFor="let item of parent.getItems()"\n                    [attr.data-smartedit-id]="parent.component.uid"\n                    [attr.data-smartedit-type]="parent.component.typeCode"\n                    class="se-page-tree-component-more-menu fd-menu__item">\n                    <se-popup-overlay\n                        [popupOverlay]="itemTemplateOverlayWrapper"\n                        [popupOverlayTrigger]="parent.canShowTemplate(item)"\n                        [popupOverlayData]="{ item: item }"\n                        (popupOverlayOnHide)="parent.onHideItemPopup(true)">\n                        <span\n                            class="se-page-tree-component-more-menu--span"\n                            (click)="parent.triggerMenuItemAction(item, $event)">\n                            {{ item.i18nKey | translate }}\n                        </span>\n                    </se-popup-overlay>\n                </li>\n            </ul>\n        </div>\n    `}),__metadata("design:paramtypes",[ParentMenu])],Os);var As;window.__smartedit__.addDecoratorPayload("Component","PageTreeComponentMenuComponent",{selector:"se-page-tree-component-menu",template:`<div class="se-page-tree-component-menu"><span *ngIf="component.isHidden" class="sap-icon--hide se-page-tree-component-menu--hide" title="{{ 'se.cms.pagetree.component.menu.icon.hide.title' | translate }}"></span><se-popup-overlay *ngIf="!!leftButton" [popupOverlay]="itemTemplateOverlayWrapper" [popupOverlayTrigger]="canShowTemplate(leftButton) && templateOverlayIsOpen" [popupOverlayData]="{ item: leftButton }" (popupOverlayOnHide)="onHideItemPopup(false)"><span class="se-page-tree-component-menu--icon" [ngClass]="leftButton.displayIconClass" (click)="triggerMenuItemAction(leftButton, $event)" title="{{ leftButton.i18nKey | translate }}"></span></se-popup-overlay><se-popup-overlay [popupOverlay]="moreMenuPopupConfig" [popupOverlayTrigger]="moreMenuIsOpen"><span *ngIf="items && items.length > 0" (click)="toggleMoreMenu()" class="se-page-tree-component-menu--icon sap-icon--overflow" title="{{ 'se.cms.contextmenu.title.more' | translate }}"></span></se-popup-overlay></div>`,styles:[`.se-page-tree-component-menu{margin:0 0 0 auto;display:flex;flex-direction:row}.se-page-tree-component-menu--hide{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor)}.se-page-tree-component-menu--icon{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapLinkColor)}.se-page-tree-component-more{min-width:118px}.se-page-tree-component-more-list{display:flex;flex-direction:column;padding:0}.se-page-tree-component-more-menu--span{font-family:var(--sapFontFamily);font-size:14px;color:var(--sapLinkColor);display:block;min-width:104px;padding:12px 16px}.is-storefront .fd-popover__popper{border-radius:0}`],providers:[{provide:ParentMenu,useExisting:n.forwardRef((()=>As))}],changeDetection:n.ChangeDetectionStrategy.OnPush});let xs=As=class PageTreeComponentMenuComponent{constructor(e,t,i,o){this.pageTreeComponentMenuService=e;this.nodeInfoService=t;this.cdr=i;this.crossFrameEventService=o;this.remainOpenMap={};this.moreMenuIsOpen=false;this.templateOverlayIsOpen=false;this.moreMenuPopupConfig={component:Os,halign:"left"};this.itemTemplateOverlayWrapper={component:Ps}}getItems(){return this.items}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.componentAttributes=this.nodeInfoService.getComponentAttributes(this.component);this.menuConfiguration=this.nodeInfoService.getContextualMenuConfiguration(this.component,this.componentAttributes,this.slotId,this.slotUuid);const e=yield this.pageTreeComponentMenuService.getPageTreeComponentMenus(this.menuConfiguration);if(e&&e.length>0){this.items=e.filter((e=>!!e));this.leftButton=this.items.shift()}this.unregisterInnerFrameClicked=this.crossFrameEventService.subscribe(l.EVENT_INNER_FRAME_CLICKED,(()=>{if(!this.crossFrameEventService.isIframe()){this.moreMenuIsOpen=false;this.templateOverlayIsOpen=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}}));if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnDestroy(){if(this.unregisterInnerFrameClicked){this.unregisterInnerFrameClicked()}}setRemainOpen(e,t){this.remainOpenMap[e]=t}showOverlay(e){if(e){return true}return Object.keys(this.remainOpenMap).reduce(((e,t)=>e||this.remainOpenMap[t]),false)}canShowTemplate(e){return this.displayedItem===e}onHideItemPopup(e=false){this.displayedItem=null;if(e){this.moreMenuIsOpen=false}}triggerMenuItemAction(e,t){this.moreMenuIsOpen=false;this.templateOverlayIsOpen=!this.templateOverlayIsOpen;if(e.action.component){if(this.displayedItem===e){this.displayedItem=null}else{this.displayedItem=e}}else if(e.action.callback){e.action.callback(this.menuConfiguration,t)}}toggleMoreMenu(){this.moreMenuIsOpen=!this.moreMenuIsOpen}};__decorate([n.Input(),__metadata("design:type",Object)],xs.prototype,"component",void 0);__decorate([n.Input(),__metadata("design:type",String)],xs.prototype,"slotId",void 0);__decorate([n.Input(),__metadata("design:type",String)],xs.prototype,"slotUuid",void 0);xs=As=__decorate([n.Component({selector:"se-page-tree-component-menu",template:`<div class="se-page-tree-component-menu"><span *ngIf="component.isHidden" class="sap-icon--hide se-page-tree-component-menu--hide" title="{{ 'se.cms.pagetree.component.menu.icon.hide.title' | translate }}"></span><se-popup-overlay *ngIf="!!leftButton" [popupOverlay]="itemTemplateOverlayWrapper" [popupOverlayTrigger]="canShowTemplate(leftButton) && templateOverlayIsOpen" [popupOverlayData]="{ item: leftButton }" (popupOverlayOnHide)="onHideItemPopup(false)"><span class="se-page-tree-component-menu--icon" [ngClass]="leftButton.displayIconClass" (click)="triggerMenuItemAction(leftButton, $event)" title="{{ leftButton.i18nKey | translate }}"></span></se-popup-overlay><se-popup-overlay [popupOverlay]="moreMenuPopupConfig" [popupOverlayTrigger]="moreMenuIsOpen"><span *ngIf="items && items.length > 0" (click)="toggleMoreMenu()" class="se-page-tree-component-menu--icon sap-icon--overflow" title="{{ 'se.cms.contextmenu.title.more' | translate }}"></span></se-popup-overlay></div>`,styles:[`.se-page-tree-component-menu{margin:0 0 0 auto;display:flex;flex-direction:row}.se-page-tree-component-menu--hide{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor)}.se-page-tree-component-menu--icon{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapLinkColor)}.se-page-tree-component-more{min-width:118px}.se-page-tree-component-more-list{display:flex;flex-direction:column;padding:0}.se-page-tree-component-more-menu--span{font-family:var(--sapFontFamily);font-size:14px;color:var(--sapLinkColor);display:block;min-width:104px;padding:12px 16px}.is-storefront .fd-popover__popper{border-radius:0}`],providers:[{provide:ParentMenu,useExisting:n.forwardRef((()=>As))}],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[t.PageTreeComponentMenuService,t.NodeInfoService,n.ChangeDetectorRef,l.CrossFrameEventService])],xs);var Ds;window.__smartedit__.addDecoratorPayload("Component","PageTreeChildComponentMenu",{template:`\n        <div class="se-page-tree-component-menu">\n            <span\n                *ngIf="component.isHidden"\n                class="sap-icon--hide se-page-tree-component-menu--hide"\n                title="{{ 'se.cms.pagetree.component.menu.icon.hide.title' | translate }}"></span>\n            <se-popup-overlay\n                *ngFor="let item of menuItems"\n                [popupOverlay]="itemTemplateOverlayWrapper"\n                [popupOverlayTrigger]="canShowTemplate(item) && templateOverlayIsOpen"\n                [popupOverlayData]="{ item: item }"\n                (popupOverlayOnHide)="onHideItemPopup()">\n                <span\n                    class="se-page-tree-component-menu--icon"\n                    [ngClass]="item.displayIconClass"\n                    (click)="triggerMenuItemAction(item, $event)"\n                    title="{{ item.i18nKey | translate }}"></span>\n            </se-popup-overlay>\n        </div>\n    `,styles:[`.se-page-tree-component-menu{margin:0 0 0 auto;display:flex;flex-direction:row}.se-page-tree-component-menu--hide{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor)}.se-page-tree-component-menu--icon{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapLinkColor)}.se-page-tree-component-more{min-width:118px}.se-page-tree-component-more-list{display:flex;flex-direction:column;padding:0}.se-page-tree-component-more-menu--span{font-family:var(--sapFontFamily);font-size:14px;color:var(--sapLinkColor);display:block;min-width:104px;padding:12px 16px}.is-storefront .fd-popover__popper{border-radius:0}`],selector:"se-pagetree-child-component-menu",providers:[{provide:ParentMenu,useExisting:n.forwardRef((()=>Ds))}]});let Rs=Ds=class PageTreeChildComponentMenu{constructor(e,t,i,o){this.pageTreeChildComponentMenuService=e;this.nodeInfoService=t;this.cdr=i;this.crossFrameEventService=o;this.remainOpenMap={};this.itemTemplateOverlayWrapper={component:Ps};this.templateOverlayIsOpen=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.componentAttributes=this.nodeInfoService.getComponentAttributes(this.component);this.menuConfiguration=this.nodeInfoService.getContextualMenuConfiguration(this.component,this.componentAttributes,this.slotId,this.slotUuid);const e=yield this.pageTreeChildComponentMenuService.getPageTreeChildComponentMenus(this.parentMenuConfiguration,this.menuConfiguration);this.menuItems=e.filter((e=>!!e));this.unregisterInnerFrameClicked=this.crossFrameEventService.subscribe(l.EVENT_INNER_FRAME_CLICKED,(()=>{if(!this.crossFrameEventService.isIframe()){this.templateOverlayIsOpen=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}}));if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnDestroy(){if(this.unregisterInnerFrameClicked){this.unregisterInnerFrameClicked()}}canShowTemplate(e){return this.displayedItem===e}onHideItemPopup(){this.displayedItem=null}triggerMenuItemAction(e,t){if(e.action.component){if(this.displayedItem===e){this.displayedItem=null}else{this.displayedItem=e}}else if(e.action.callback){e.action.callback(this.menuConfiguration,t)}this.templateOverlayIsOpen=!this.templateOverlayIsOpen}setRemainOpen(e,t){this.remainOpenMap[e]=t}getItems(){return this.menuItems}};__decorate([n.Input(),__metadata("design:type",Object)],Rs.prototype,"component",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Rs.prototype,"parentMenuConfiguration",void 0);__decorate([n.Input(),__metadata("design:type",String)],Rs.prototype,"slotId",void 0);__decorate([n.Input(),__metadata("design:type",String)],Rs.prototype,"slotUuid",void 0);Rs=Ds=__decorate([n.Component({template:`\n        <div class="se-page-tree-component-menu">\n            <span\n                *ngIf="component.isHidden"\n                class="sap-icon--hide se-page-tree-component-menu--hide"\n                title="{{ 'se.cms.pagetree.component.menu.icon.hide.title' | translate }}"></span>\n            <se-popup-overlay\n                *ngFor="let item of menuItems"\n                [popupOverlay]="itemTemplateOverlayWrapper"\n                [popupOverlayTrigger]="canShowTemplate(item) && templateOverlayIsOpen"\n                [popupOverlayData]="{ item: item }"\n                (popupOverlayOnHide)="onHideItemPopup()">\n                <span\n                    class="se-page-tree-component-menu--icon"\n                    [ngClass]="item.displayIconClass"\n                    (click)="triggerMenuItemAction(item, $event)"\n                    title="{{ item.i18nKey | translate }}"></span>\n            </se-popup-overlay>\n        </div>\n    `,styles:[`.se-page-tree-component-menu{margin:0 0 0 auto;display:flex;flex-direction:row}.se-page-tree-component-menu--hide{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor)}.se-page-tree-component-menu--icon{margin:0 0 0 16px;font-size:14px;line-height:16px;color:var(--sapLinkColor)}.se-page-tree-component-more{min-width:118px}.se-page-tree-component-more-list{display:flex;flex-direction:column;padding:0}.se-page-tree-component-more-menu--span{font-family:var(--sapFontFamily);font-size:14px;color:var(--sapLinkColor);display:block;min-width:104px;padding:12px 16px}.is-storefront .fd-popover__popper{border-radius:0}`],selector:"se-pagetree-child-component-menu",providers:[{provide:ParentMenu,useExisting:n.forwardRef((()=>Ds))}]}),__metadata("design:paramtypes",[t.PageTreeChildComponentMenuService,t.NodeInfoService,n.ChangeDetectorRef,l.CrossFrameEventService])],Rs);window.__smartedit__.addDecoratorPayload("Component","PageTreeSlotMenuComponent",{selector:"se-page-tree-slot-menu",template:`<div class="se-page-tree-slot-node-menu"><div *ngIf="node.hiddenComponentCount > 0" style="min-width: 24px"><span class="se-page-tree-slot-node-menu--hide sap-icon--hide" title="{{ 'se.cms.pagetree.component.menu.icon.hide.title'  | translate}}"></span> <span class="se-page-tree-slot-node-menu--hideCount">{{ node.hiddenComponentCount }}</span></div><se-pagetree-slot-menu-item [item]="item" *ngFor="let item of items"></se-pagetree-slot-menu-item></div>`,styles:[`.se-page-tree-slot-node-menu{display:flex}.se-page-tree-slot-node-menu--hide{color:var(--sapContent_LabelColor);font-size:14px;line-height:16px}.se-page-tree-slot-node-menu--hideCount{font-family:"72";font-style:normal;font-weight:400;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor);margin-left:2px}`],changeDetection:n.ChangeDetectionStrategy.OnPush});let Ms=class PageTreeSlotMenuComponent{constructor(e,t){this.pageTreeSlotMenuService=e;this.cdr=t}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.componentAttributes={smarteditCatalogVersionUuid:this.node.catalogVersionUuid,smarteditComponentId:this.node.componentId,smarteditComponentType:this.node.componentTypeFromPage,smarteditComponentUuid:this.node.componentUuid,smarteditElementUuid:this.node.elementUuid};const e={componentType:this.node.componentTypeFromPage,componentId:this.node.componentId,componentUuid:this.node.componentUuid,containerType:this.node.containerType,containerId:this.node.containerId,componentAttributes:this.componentAttributes,slotId:this.node.containerId,slotUuid:this.node.componentUuid};const t=yield this.pageTreeSlotMenuService.getPageTreeComponentMenus(e);this.items=t.filter((e=>!!e));if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}};__decorate([n.Input(),__metadata("design:type",Object)],Ms.prototype,"node",void 0);Ms=__decorate([n.Component({selector:"se-page-tree-slot-menu",template:`<div class="se-page-tree-slot-node-menu"><div *ngIf="node.hiddenComponentCount > 0" style="min-width: 24px"><span class="se-page-tree-slot-node-menu--hide sap-icon--hide" title="{{ 'se.cms.pagetree.component.menu.icon.hide.title'  | translate}}"></span> <span class="se-page-tree-slot-node-menu--hideCount">{{ node.hiddenComponentCount }}</span></div><se-pagetree-slot-menu-item [item]="item" *ngFor="let item of items"></se-pagetree-slot-menu-item></div>`,styles:[`.se-page-tree-slot-node-menu{display:flex}.se-page-tree-slot-node-menu--hide{color:var(--sapContent_LabelColor);font-size:14px;line-height:16px}.se-page-tree-slot-node-menu--hideCount{font-family:"72";font-style:normal;font-weight:400;font-size:14px;line-height:16px;color:var(--sapContent_LabelColor);margin-left:2px}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[t.PageTreeSlotMenuService,n.ChangeDetectorRef])],Ms);window.__smartedit__.addDecoratorPayload("Component","PageTreeSlotMenuItem",{template:`\n        <div *ngIf="item.action.component">\n            <ng-container\n                *ngComponentOutlet="\n                    item.action.component;\n                    injector: componentInjector\n                "></ng-container>\n        </div>\n    `,selector:"se-pagetree-slot-menu-item"});let ks=class PageTreeSlotMenuItem{constructor(e,t){this.parent=e;this.injector=t}ngOnInit(){this.createComponentInjector()}createComponentInjector(){this.componentInjector=n.Injector.create({parent:this.injector,providers:[{provide:l.CONTEXTUAL_MENU_ITEM_DATA,useValue:{componentAttributes:this.parent.componentAttributes,setRemainOpen:()=>void 0}}]})}};__decorate([n.Input(),__metadata("design:type",Object)],ks.prototype,"item",void 0);ks=__decorate([n.Component({template:`\n        <div *ngIf="item.action.component">\n            <ng-container\n                *ngComponentOutlet="\n                    item.action.component;\n                    injector: componentInjector\n                "></ng-container>\n        </div>\n    `,selector:"se-pagetree-slot-menu-item"}),__param(0,n.Inject(n.forwardRef((()=>Ms)))),__metadata("design:paramtypes",[Ms,n.Injector])],ks);let Ns=class PageTreeModule{};Ns=__decorate([n.NgModule({imports:[g.CommonModule,l.PopupOverlayModule,l.TranslationModule.forChild()],declarations:[Ts,ws,Is,Os,Ps,xs,Ms,ks,Rs,Es],entryComponents:[Ts,ws,Is,Os,Ps,xs,Ms,ks,Rs,Es]})],Ns);t.CmssmarteditContainerModule=class CmssmarteditContainerModule{};t.CmssmarteditContainerModule=__decorate([l.SeEntryModule("cmssmarteditContainer"),n.NgModule({imports:[r.CmsCommonsModule,a.BrowserModule,l.SharedComponentsModule,l.SeGenericEditorModule,l.MessageModule,l.TooltipModule,Gi,bs,xo,l.SeTranslationModule.forChild(),l.L10nPipeModule,ln,ps,Hn,Wo,gs,ni,t.CmsComponentsModule,Ns,s.FormsModule,l.SeRouteService.provideNgRoute([{path:r.TRASHED_PAGE_LIST_PATH,component:ms,canActivate:[t.ExperienceGuard]},{path:r.PAGE_LIST_PATH,component:Vo,canActivate:[t.ExperienceGuard],titleI18nKey:"se.cms.pagelist.title",priority:20},{path:r.NAVIGATION_MANAGEMENT_PAGE_PATH,component:en,titleI18nKey:"se.cms.toolbaritem.navigationmenu.name",canActivate:[t.ExperienceGuard],priority:10}],{useHash:true,initialNavigation:"enabledNonBlocking",onSameUrlNavigation:"reload"})],providers:[Oe,t.PageRestrictionsCriteriaService,t.ExperienceGuard,t.ActionableAlertService,t.PageRestrictionsCriteriaService,t.PageRestoredAlertService,t.PageRestoreModalService,t.HomepageService,t.ManagePageService,Ae,t.PageTypesRestrictionTypesService,Ne,t.RestrictionTypesService,t.ProductCategoryService,Pe,Re,Me,De,ke,ze,Fe,Le,t.RestrictionsService,t.PageRestrictionsService,t.GenericEditorModalService,t.RestrictionsStepHandlerFactory,Xe,t.PageDisplayConditionsService,t.PageTemplateService,Ve,t.CmsDragAndDropService,t.DisplayConditionsEditorModel,t.ContextAwareCatalogService,t.RulesAndPermissionsRegistrationService,t.AddPageWizardService,t.ClonePageAlertService,t.NodeInfoService,t.PageTreeComponentMenuService,t.PageTreeSlotMenuService,t.PageTreeChildComponentMenuService,r.SlotUnsharedService,r.SlotSynchronizationService,{provide:o.HTTP_INTERCEPTORS,useClass:r.VersionExperienceInterceptor,multi:true},{provide:o.HTTP_INTERCEPTORS,useClass:l.ResponseAdapterInterceptor,multi:true},{provide:r.IPageContentSlotsComponentsRestService,useClass:xe},{provide:l.ISyncPollingService,useClass:t.SyncPollingService},{provide:r.IRemoveComponentService,useClass:t.RemoveComponentService},{provide:l.IPageService,useClass:t.PageService},{provide:r.IContextAwareEditableItemService,useClass:t.ContextAwareEditableItemService},{provide:l.IEditorModalService,useClass:t.EditorModalService},{provide:r.IComponentVisibilityAlertService,useClass:t.ComponentVisibilityAlertService},{provide:r.IComponentSharedService,useClass:t.ComponentSharedService},{provide:l.ISlotRestrictionsService,useClass:t.SlotRestrictionsService},{provide:r.ISlotVisibilityService,useClass:t.SlotVisibilityService},{provide:r.IEditorEnablerService,useClass:t.EditorEnablerService},{provide:r.IComponentMenuConditionAndCallbackService,useClass:t.ComponentMenuConditionAndCallbackService},{provide:r.IComponentEditingFacade,useClass:t.ComponentEditingFacade},l.moduleUtils.bootstrap(((e,t,i,o,n,s,a,r,l,d,p,m,g,u,h,_,v)=>{t.register();setForCmsGenericEditorConfiguration(i);v.registerTreeComponent({component:Ts});addToolbarItemForFeatureService(o,{crossFrameEventService:_,systemEventService:n,clonePageWizardService:s,managePageVersionService:a,rollbackPageVersionService:r,cmsDragAndDropService:d});addItemsForToolbar(e);addItemsForCatalogDetails(l);registerForPerspective(p);addSelectorForInViewElementObserver(m,d)}),[l.IToolbarServiceFactory,t.RulesAndPermissionsRegistrationService,as,l.IFeatureService,l.SystemEventService,to,_s,vs,l.ICatalogDetailsService,t.CmsDragAndDropService,l.IPerspectiveService,l.InViewElementObserver,l.IEditorModalService,r.IComponentVisibilityAlertService,t.NodeInfoService,l.CrossFrameEventService,l.IPageTreeService])],declarations:[t.GenericEditorModalComponent,t.PageRestoredAlertComponent,t.ClonePageAlertComponent],entryComponents:[t.GenericEditorModalComponent,t.PageRestoredAlertComponent,t.ClonePageAlertComponent]})],t.CmssmarteditContainerModule);function addSelectorForInViewElementObserver(e,t){e.addSelector(`.${l.COMPONENT_CLASS}`,(()=>{t.update()}));e.addSelector(`.${l.PAGE_TREE_NODE_CLASS}`,(()=>{t.updateInPageTree()}))}function addItemsForCatalogDetails(e){e.addItems([{component:Uo},{component:Jo}]);e.addItems([{component:Ao}],l.CATALOG_DETAILS_COLUMNS.RIGHT)}function setForCmsGenericEditorConfiguration(e){e.setDefaultEditorFieldMappings();e.setDefaultTabFieldMappings();e.setDefaultTabsConfiguration()}function registerForPerspective(e){e.register({key:l.CMSModesService.BASIC_PERSPECTIVE_KEY,nameI18nKey:"se.cms.perspective.basic.name",descriptionI18nKey:"se.hotkey.tooltip",features:["se.contextualMenu","se.cms.dragandropbutton","se.cms.remove","se.cms.edit",fe,Se,ye,"se.emptySlotFix","se.cms.html5DragAndDrop","disableSharedSlotEditing","sharedSlotDisabledDecorator",Te,"externalComponentDecorator","externalcomponentbutton","externalSlotDisabledDecorator","clonecomponentbutton","deletePageMenu",Ie,Ee,we,"se.cms.sharedcomponentbutton"],perspectives:[]});e.register({key:l.CMSModesService.ADVANCED_PERSPECTIVE_KEY,nameI18nKey:"se.cms.perspective.advanced.name",descriptionI18nKey:"se.hotkey.tooltip",features:["se.slotContextualMenu","se.slotSyncButton","se.slotSharedButton","se.slotContextualMenuVisibility","se.contextualMenu","se.cms.dragandropbutton","se.cms.remove","se.cms.edit",fe,Se,ye,"se.cms.pageSyncMenu","se.emptySlotFix","se.cms.html5DragAndDrop",Te,"syncIndicator","externalComponentDecorator","externalcomponentbutton","clonecomponentbutton","slotUnsharedButton","deletePageMenu",Ce,Ie,Ee,we,"se.cms.sharedcomponentbutton","se.cms.pageTreeMenu","se.cms.openInPageTreeButton"],perspectives:[]});e.register({key:l.CMSModesService.VERSIONING_PERSPECTIVE_KEY,nameI18nKey:"se.cms.perspective.versioning.name",descriptionI18nKey:"se.cms.perspective.versioning.description",features:[Ce,"se.cms.createVersionMenu","se.cms.rollbackVersionMenu",ye,"disableSharedSlotEditing","sharedSlotDisabledDecorator","externalSlotDisabledDecorator","externalComponentDecorator"],perspectives:[],permissions:[be],isHotkeyDisabled:true})}function addItemsForToolbar(e){const t=e.getToolbarService("smartEditTrashPageToolbar");t.addItems([{key:"se.cms.pages.list.link",type:l.ToolbarItemType.TEMPLATE,component:Bo,priority:1,section:l.ToolbarSection.left}]);const i=e.getToolbarService("smartEditHeaderToolbar");i.addItems([{key:"se.cms.workflowInbox",type:l.ToolbarItemType.TEMPLATE,component:Ni,priority:5,section:l.ToolbarSection.right,dropdownPosition:l.ToolbarDropDownPosition.right}]);const o=e.getToolbarService("smartEditNavigationToolbar");o.addItems([{key:"se.cms.shortcut",type:l.ToolbarItemType.TEMPLATE,component:l.ShortcutLinkComponent,priority:1,section:l.ToolbarSection.left}]);const n=e.getToolbarService("smartEditPagesToolbar");n.addItems([{key:"se.cms.shortcut",type:l.ToolbarItemType.TEMPLATE,component:l.ShortcutLinkComponent,priority:1,section:l.ToolbarSection.left},{key:"se.cms.trash.page.link",type:l.ToolbarItemType.TEMPLATE,component:Ho,priority:1,section:l.ToolbarSection.right}])}function addToolbarItemForFeatureService(e,i){const{crossFrameEventService:o,systemEventService:n,clonePageWizardService:s,managePageVersionService:a,rollbackPageVersionService:r,cmsDragAndDropService:d}=i;e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:"se.cms.pageTreeMenu",nameI18nKey:"se.cms.toolbaritem.pagetreemenu.name",type:"ACTION",iconClassName:"sap-icon--tree se-toolbar-menu-ddlb--button__icon",priority:100,section:"left",callback:()=>{o.publish(l.EVENT_PAGE_TREE_PANEL_SWITCH)},permissions:["se.read.page"]});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:fe,type:"HYBRID_ACTION",nameI18nKey:"se.cms.componentmenu.btn.label.addcomponent",descriptionI18nKey:"cms.toolbaritem.componentmenutemplate.description",priority:101,section:"left",dropdownPosition:"left",iconClassName:"sap-icon--add se-toolbar-menu-ddlb--button__icon",callback:()=>{n.publish(j,{})},component:t.ComponentMenuComponent,permissions:["se.add.component"],keepAliveOnClose:true});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:ye,type:"TEMPLATE",nameI18nKey:"se.cms.pageinfo.menu.btn.label",priority:140,section:"left",component:_o,permissions:["se.read.page"]});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:Se,type:"ACTION",nameI18nKey:"se.cms.clonepage.menu.btn.label",iconClassName:"sap-icon--duplicate se-toolbar-menu-ddlb--button__icon",callback:()=>{s.openClonePageWizard()},priority:130,section:"left",permissions:["se.clone.page"]});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:"se.cms.pageSyncMenu",nameI18nKey:"se.cms.toolbaritem.pagesyncmenu.name",type:"TEMPLATE",component:Oo,priority:102,section:"left",permissions:["se.sync.page"]});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:"deletePageMenu",nameI18nKey:"se.cms.actionitem.page.trash",type:"TEMPLATE",component:no,priority:150,section:"left",permissions:["se.delete.page.menu"]});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:Ce,type:"HYBRID_ACTION",nameI18nKey:"se.cms.actionitem.page.versions",priority:104,section:"left",iconClassName:"sap-icon--timesheet se-toolbar-menu-ddlb--button__icon",component:Cs,contextComponent:us,permissions:[be],keepAliveOnClose:true});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:"se.cms.createVersionMenu",type:"ACTION",nameI18nKey:"se.cms.actionitem.page.versions.create",iconClassName:"sap-icon--add se-toolbar-menu-ddlb--button__icon",callback:()=>{a.createPageVersion()},priority:120,section:"left",permissions:[be,"se.create.version.page"]});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:"se.cms.rollbackVersionMenu",type:"ACTION",nameI18nKey:"se.cms.actionitem.page.versions.rollback",iconClassName:"sap-icon--undo se-toolbar-menu-ddlb--button__icon",callback:()=>{r.rollbackPageVersion()},priority:120,section:"left",permissions:[be,"se.rollback.version.page"]});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:Ie,type:"TEMPLATE",nameI18nKey:"se.cms.workflow.toolbar.view.workflow.menu",component:Di,priority:110,section:"right"});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:Ee,type:"TEMPLATE",nameI18nKey:"se.cms.page.display.status",component:Ti,priority:120,section:"right",permissions:["se.show.page.status"]});e.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:we,type:"TEMPLATE",nameI18nKey:"se.cms.page.approval.selector",component:vi,priority:165,section:"right",permissions:["se.force.page.approval"]});e.register({key:Te,nameI18nKey:"se.cms.dragAndDrop.name",descriptionI18nKey:"se.cms.dragAndDrop.description",enablingCallback:()=>{d.register();d.apply()},disablingCallback:()=>{d.unregister()}})}t.CMS_EVENT_HIDE_REPLACE_PARENT_HOMEPAGE_INFO=Be;t.CMS_EVENT_SHOW_REPLACE_PARENT_HOMEPAGE_INFO=Ue;t.ENABLE_CLONE_ON_DROP=We;t.INTERVAL_MILLISEC=lt;t.INTERVAL_RETRIES=rt;t.OPEN_COMPONENT_EVENT=j;t.PRODUCT_CATEGORY_RESOURCE_BASE_URI=$e;t.PRODUCT_CATEGORY_RESOURCE_URI=Ke;t.PRODUCT_CATEGORY_SEARCH_RESOURCE_URI=qe;t.RESET_COMPONENT_MENU_EVENT=G;t.RestrictionsStepHandler=RestrictionsStepHandler},20410:(e,t,i)=>{"use strict";var o=i(43412)["lW"];Object.defineProperty(t,"__esModule",{value:true});var n=i(22630);var s=i(50185);var a=i(32709);var r=i(54526);var l=i(67564);var d=i(66791);var p=i(38102);var m=i(19662);var g=i(72093);var u=i(30178);var h=i(37100);var _=i(84359);function _interopNamespace(e){if(e&&e.__esModule)return e;var t=Object.create(null);if(e){Object.keys(e).forEach((function(i){if(i!=="default"){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,o.get?o:{enumerable:true,get:function(){return e[i]}})}}))}t["default"]=e;return Object.freeze(t)}var v=_interopNamespace(n);var f=_interopNamespace(s);class CloneableUtils{makeCloneable(e){const t=v.cloneDeepWith(e,(t=>{if(this._isValueCloneable(t,e)){return this._getCloneableValue(t)}return t}));if(t===undefined||t===null||this.isPrimitive(t)){return t}if(t.hasOwnProperty("length")||t.forEach){return t.map((e=>this.makeCloneable(e)))}return Object.keys(t).reduce(((e,i)=>{if(i.indexOf("$")!==0){e[i]=this.makeCloneable(t[i])}return e}),{})}_isValueCloneable(e,t){return e!==undefined&&e!==null&&!this.isPrimitive(t)}_getCloneableValue(e){if(typeof e==="function"){return null}if(e.then){return null}if(v.isElement(e)){return null}if(typeof e!=="string"&&e.hasOwnProperty("length")&&!e.forEach){return null}return e}isPrimitive(e){return typeof e==="number"||typeof e==="string"||typeof e==="boolean"}}const y=new CloneableUtils;class StringUtils{constructor(){this.sanitize=e=>!this.isBlank(e)?e.split("").reverse().join("").replace(/(?:(([()])(?!\\)))/g,"$1\\").split("").reverse().join(""):e;this.encode=e=>o.from(encodeURIComponent(JSON.stringify(e)).replace(/%([0-9A-F]{2})/g,(function toSolidBytes(e,t){return String.fromCharCode(parseInt(t,16))}))).toString("base64");this.replaceAll=(e,t)=>{const i=new RegExp(Object.keys(t).join("|"),"g");return e.replace(i,(function(e){return t[e]}))}}isBlank(e){return typeof e==="undefined"||e===null||e==="null"||e.toString().trim().length===0}regExpFactory(e){const t=new RegExp(/^[a-zA-Z\d]+$/i);const i=new RegExp(/^[a-zA-Z\d\*]+$/i);let o;if(t.test(e)){o=["^","$"].join(e)}else if(i.test(e)){o=["^","$"].join(e.replace(/\*/g,".*"))}else{o=e}return new RegExp(o,"g")}formatHTML(e){return e.replace(/^\s*\n/gm,"").replace(/\>[\t\s]+\</g,"><").replace(/[\r\n\t\s]+/g," ")}}const S=new StringUtils;class URIBuilder{constructor(e){this.uri=e;this.wholeWordMatch="[\\w]+"}build(){return this.uri}replaceParams(e){const t=v.cloneDeep(this);if(e){t.uri=Object.keys(e).sort((function(e,t){return t.length-e.length})).reduce(((t,i)=>this.substituteKeyForValue(t,i,e[i])),t.uri)}return t}sanitize(){const e=v.cloneDeep(this);const t=/(https?:\/\/[^\/]*)(\/.*)/.exec(e.uri);e.uri=t==null?e.uri:t[2];e.uri=this.substituteKeyForValue(e.uri,this.wholeWordMatch,"").replace(/\/\//,"/").replace(/\/\?/,"?").replace(/\/$/,"");e.uri=t==null?e.uri:t[1]+e.uri;return e}substituteKeyForValue(e,t,i){e=e.replace(new RegExp(":"+t+"/"),`${i||""}/`).replace(new RegExp(":"+t+"$"),`${i||""}`).replace(new RegExp(":"+t+"\\?"),`${i||""}?`).replace(new RegExp(":"+t+"&"),`${i||""}&`);if(t!==this.wholeWordMatch&&t.includes("_")){const o=e.includes("?")?e.substr(0,e.indexOf("?")):e;const n=o.replace(new RegExp("\\b"+t+"\\b"),`${i||""}`);e=e.includes("?")?n+e.substr(e.indexOf("?")):n}return e}}class UrlUtils{getOrigin(e){if(!!e){let t=document.createElement("a");t.setAttribute("href",e);const i=t.protocol+"//"+t.hostname+(t.port?":"+t.port:"");t=null;return i}return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}getURI(e){return e&&e.indexOf("?")>-1?e.split("?")[0]:e}updateUrlParameter(e,t,i){const o=e.indexOf("#");const n=o===-1?"":e.substr(o);e=o===-1?e:e.substr(0,o);const s=new RegExp("([?&])"+t+"=.*?(&|$)","i");const a=e.indexOf("?")!==-1?"&":"?";if(e.match(s)){e=e.replace(s,"$1"+t+"="+i+"$2")}else{e=e+a+t+"="+i}return e+n}getQueryString(e){let t="";if(e){for(const i in e){if(e.hasOwnProperty(i)){(v.isArray(e[i])?e[i]:[e[i]]).forEach((e=>{t+="&"+encodeURIComponent(i)+"="+encodeURIComponent(e)}))}}}return"?"+(!S.isBlank(t)?t.substring(1):t)}parseQuery(e){const t={};e.replace(/([^?=&]+)(=([^&]*))?/g,(function(e,i,o,n){t[i]=n}));return t}getAbsoluteURL(e,t){const i=new RegExp("([a-zA-Z0-9]+://)"+"([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?"+"([a-zA-Z0-9.-]+)"+"|([0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+)"+"(:[0-9]+)?"+"(/.*)?");return i.exec(t)?t:e+t}}const b=new UrlUtils;class CryptographicUtils{sha1Hash(e){return f.SHA1(e).toString()}aesBase64Encrypt(e,t){return f.AES.encrypt(f.enc.Base64.parse(e),t).toString()}aesDecrypt(e,t){return f.AES.decrypt(e,t).toString(f.enc.Utf8)}}class FunctionsUtils{constructor(){this.signatureArgsRegexp=/function[\s\w]*\(([\w\s\$,]*)\)[\s]*{/}isEmpty(e){const t=e.toString().match(/\{([\s\S]*)\}/m);return!t||t[1].trim()===""||/(proxyFunction)/g.test(e.toString().replace(/\s/g,""))}getArguments(e){const t=this.signatureArgsRegexp.exec(e.toString());if(t){return t[1].replace(/\s/g,"").split(",")}else{throw new Error(`failed to retrieve arguments list of ${e}`)}}hasArguments(e){const t=this.signatureArgsRegexp.exec(e.toString());if(t){return!v.isEmpty(t[1])}else{throw new Error(`failed to retrieve arguments list of ${e}`)}}getConstructorName(e){let t=e.name;if(!t){const i=/function (\$?\w+)\s*\(/.exec(e.toString());if(i){t=i[1]}else{throw new Error("[FunctionsUtils] - Cannot get name from invalid constructor.")}}return t}getInstanceConstructorName(e){return this.getConstructorName(Object.getPrototypeOf(e).constructor)}extendsConstructor(e,t){const newConstructor=function(...e){return new t(...e)};newConstructor.prototype=e.prototype;Object.entries(Object.getOwnPropertyDescriptors(e)).filter((([,e])=>e.writable)).forEach((([t])=>{newConstructor[t]=e[t]}));return newConstructor}getInstanceMethods(e){const isGetter=(e,t)=>!!e.__lookupGetter__(t);let t=[];const i=e;const onlyOriginalMethods=(e,o,n)=>!isGetter(i,e)&&typeof i[e]==="function"&&e!=="constructor"&&(o===0||e!==n[o-1])&&t.indexOf(e)===-1;do{const i=Object.getOwnPropertyNames(e).sort().filter(onlyOriginalMethods);t=t.concat(i);e=Object.getPrototypeOf(e)}while(e&&Object.getPrototypeOf(e));return t}isUnitTestMode(){return typeof window.__karma__!=="undefined"}assertFail(){const e=jasmine.createSpy("TestShouldNotReachThatPart-CheckYourTryCatchBlock");expect(e).toHaveBeenCalled()}convertToArray(e){return Object.keys(e).reduce(((t,i)=>[...t||[],{key:i,value:e[i]}]),[])}}const E=new FunctionsUtils;const w=new a.NgZone({enableLongStackTrace:false});class WindowUtils{constructor(e){this.ngZone=e;this.isIframe=()=>this.getWindow().top!==this.getWindow();this.ngZone=this.ngZone||w}getWindow(){return window}runTimeoutOutsideAngular(e,t){const i=this.ngZone;if(i!==undefined){return i.runOutsideAngular((()=>setTimeout((()=>i.run(e)),t)))}else{throw new Error("this instance of WindowUtils has not been instantiated through Angular 7 DI")}}runIntervalOutsideAngular(e,t){const i=this.ngZone;if(i===undefined){throw new Error("this instance of WindowUtils has not been instantiated through Angular 7 DI")}return i.runOutsideAngular((()=>setInterval((()=>i.run(e)),t)))}}WindowUtils.SMARTEDIT_IFRAME_ID="ySmartEditFrame";const A=new WindowUtils;function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}t.ModuleUtils=class ModuleUtils{initialize(e,t=[]){return{provide:a.APP_INITIALIZER,useFactory(...t){e.apply(undefined,t);return e=>{}},deps:t,multi:true}}bootstrap(e,t=[]){return{provide:a.APP_BOOTSTRAP_LISTENER,useFactory(...t){e.apply(undefined,t);return e=>{}},deps:t,multi:true}}provideValues(e){const t=e||{};return Object.keys(t).map((e=>({provide:e,useValue:t[e]})))}};t.ModuleUtils=__decorate([a.Injectable()],t.ModuleUtils);const R=new t.ModuleUtils;t.LogLevel=void 0;(function(e){e[e["log"]=0]="log";e[e["debug"]=1]="debug";e[e["info"]=2]="info";e[e["warn"]=3]="warn";e[e["error"]=4]="error"})(t.LogLevel||(t.LogLevel={}));class LogService{constructor(){this.logLevel=t.LogLevel.info}log(...e){this._log(t.LogLevel.log,e)}debug(...e){this._log(t.LogLevel.debug,e)}info(...e){this._log(t.LogLevel.info,e)}warn(...e){this._log(t.LogLevel.warn,e)}error(...e){this._log(t.LogLevel.error,e)}setLogLevel(e){this.logLevel=e}_log(e,i){if(e>=this.logLevel){const o=t.LogLevel[e];if(this._console()&&this._console()[o]){this._console()[o](...i)}}}_console(){return console}}var N;t.PromiseUtils=N=class PromiseUtils{constructor(){this.WAIT_TIMEOUT=4;this.FAILURE_TIMEOUT=2e3;this.handlePromiseRejections=e=>{const t=e.then;const i=this.defaultFailureCallback;e.then=function(e,o){const n=o?o:i;return t.call(this,e,n)};return e};this.defaultFailureCallback=e=>{if(undefined!==e&&null!==e&&"canceled"!==e){if(v.isPlainObject(e)){if(!this.isAjaxError(e)){N.logService.error(`exception caught in promise: ${JSON.stringify(e)}`)}}else if(!v.isBoolean(e)){N.logService.error(e)}}N.logService.error(`defaultFailureCallback:`,e);return Promise.reject(e)}}toPromise(e,t){return function(...i){try{return Promise.resolve(e.apply(t,i))}catch(e){N.logService.error("execution of a method that was turned into a promise failed");N.logService.error(e);return Promise.reject(e)}}}promise(e){return this.handlePromiseRejections(new Promise(e))}defer(){let e;let t;const i={promise:this.promise(((i,o)=>{e=i;t=o})),resolve(t){e(t)},reject(e,i){if(i===undefined){t(e)}else{t("")}}};return i}sleep(e){return __awaiter(this,void 0,void 0,(function*(){return new Promise((t=>setTimeout(t,e)))}))}isAjaxError(e){return e.hasOwnProperty("headers")}waitOnCondition(e,t,i,o=0){setTimeout((()=>{if(e()){t()}else if(o<this.FAILURE_TIMEOUT){this.waitOnCondition(e,t,i,o+this.WAIT_TIMEOUT)}else{throw new Error(`PromiseUtils: ${i}`)}}),this.WAIT_TIMEOUT)}resolveToCallbackWhenCondition(e,t,i){return __awaiter(this,void 0,void 0,(function*(){return new Promise((o=>{this.waitOnCondition(e,(()=>o(t())),i?i:"condition for promise resolution was never met")}))}))}attempt(e){return e.then((e=>({error:null,data:e}))).catch((e=>({error:e,data:null})))}};t.PromiseUtils.logService=new LogService;t.PromiseUtils=N=__decorate([a.Injectable()],t.PromiseUtils);const L=new t.PromiseUtils;class BooleanUtils{areAllTruthy(...e){return function(...t){return e.every((e=>e&&e.apply(e,t)))}}isAnyTruthy(...e){return function(...t){return e.some((e=>e&&e.apply(e,t)))}}}const B=new BooleanUtils;class HttpUtils{isGET(e){return e.method==="GET"}isRequestOfAccept(e,t){return!!e.headers&&!!e.headers.get("Accept")&&(e.headers.get("Accept")||"").includes(t)}isResponseOfContentType(e,t){return!!e.headers&&!!e.headers.get("Content-type")&&(e.headers.get("Content-type")||"").indexOf(t)===0}isHTMLRequest(e,t){return this.isGET(e)&&(this.isRequestOfAccept(e,"text/html")||/.+\.html$/.test(e.url)||/.+\.html\?/.test(e.url))}isJSONRequest(e,t){return this.isGET(e)&&(t&&this.isResponseOfContentType(t,"json")||/.+\.json$/.test(e.url))}isJSRequest(e){return this.isGET(e)&&/.+\.js$/.test(e.url)}isCRUDRequest(e,t){return!this.isHTMLRequest(e,t)&&!this.isJSONRequest(e,t)&&!this.isJSRequest(e)}transformHttpParams(e,t){return new r.HttpParams({fromObject:JSON.parse(S.replaceAll(JSON.stringify(this.copyHttpParamsOrHeaders(e)),t))})}copyHttpParamsOrHeaders(e){const t={};e.keys().forEach((i=>{const o=e.getAll(i);if(o!==null){t[i]=o.length>1?o:o[0]}}));return t}buildHttpResponse(e,t){const i=Promise.resolve(t);return l.from(i).pipe(d.switchMap((t=>{const i=t[0];const o=t[1];const n=e.clone({body:o});v.merge(n,{status:i});if(200<=i&&i<300){return new l.Observable((e=>{e.next(new r.HttpResponse(n))}))}else{return l.throwError(new r.HttpErrorResponse(v.merge(n,{error:o})))}})))}}const j=new HttpUtils;class BaseValueAccessor{constructor(){this.disabled=false;this.value=null}onChange(e){}onTouched(){}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}writeValue(e){this.value=e}}var G;(function(e){e["ClassAnnotation"]="ClassAnnotation";e["MethodAnnotation"]="MethodAnnotation"})(G||(G={}));class AnnotationService{constructor(){this.INJECTABLE_NAME_KEY="getInjectableName";this.ORIGINAL_CONSTRUCTOR_KEY="originalConstructor";this.getClassAnnotations=v.memoize(this.getClassAnnotationsLogic);this.getMethodAnnotations=v.memoize(this.getMethodAnnotationsLogic,(function(e,t){return JSON.stringify(e.prototype)+t}));this.functionsUtils=new FunctionsUtils;this.annotationFactoryMap={}}getClassAnnotation(e,t){const i=this.getClassAnnotations(e);const o=t.annotationName;if(i&&o in i){return i[o]}else{return null}}getMethodAnnotation(e,t,i){const o=this.getMethodAnnotations(e,t);const n=i.annotationName;if(o&&n in o){return o[n]}else{return null}}hasClassAnnotation(e,t){const i=this.getClassAnnotations(e);return t.annotationName in i?true:false}hasMethodAnnotation(e,t,i){const o=this.getMethodAnnotations(e,t);return i.annotationName in o?true:false}setClassAnnotationFactory(e,t){this.annotationFactoryMap[e]=t;return t}getClassAnnotationFactory(e){const t=this;const classAnnotationFactory=function(...i){return function(o){const n=t.functionsUtils.extendsConstructor(o,(function(...n){const s=t.annotationFactoryMap[e];if(s){const e=s(i)(this,o,n);if(e){return e}else{return null}}else{throw new Error(`annotation '${e}' is used on '${o.name}' but its ClassAnnotationFactory may not have been added to the dependency injection`)}}));v.merge(n,o);n.__annotations__=o.__annotations__;n.__parameters__=o.__parameters__;n.__prop__metadata__=o.__prop__metadata__;Reflect.getMetadataKeys(o).forEach((e=>{Reflect.defineMetadata(e,Reflect.getMetadata(e,o),n)}));const s=t.getOriginalConstructor(o);Reflect.defineMetadata(t.ORIGINAL_CONSTRUCTOR_KEY,s,n);Reflect.defineMetadata(`${G.ClassAnnotation}:${e}`,i,s);return n}};classAnnotationFactory.annotationName=e;return classAnnotationFactory}setMethodAnnotationFactory(e,t){this.annotationFactoryMap[e]=t;return t}getMethodAnnotationFactory(e){const t=this;const methodAnnotationFactory=function(...i){return(o,n,s)=>{const a=s.value;s.value=function(...o){const s=t.annotationFactoryMap[e];if(s){return a?s(i)(this,n,a.bind(this),o):undefined}else{throw new Error(`annotation '${e}' is used but its MethodAnnotationFactory may not have been added to the dependency injection`)}};Reflect.defineMetadata(`${G.MethodAnnotation}:${e}`,i,o,n)}};methodAnnotationFactory.annotationName=e;return methodAnnotationFactory}getOriginalConstructor(e){return Reflect.getMetadata(this.ORIGINAL_CONSTRUCTOR_KEY,e)||e}getClassAnnotationsLogic(e){const t=this.getOriginalConstructor(e);const i={};Reflect.getMetadataKeys(t).filter((e=>e.toString().startsWith(G.ClassAnnotation))).forEach((e=>{i[e.split(":")[1]]=Reflect.getMetadata(e,t)}));return i}getMethodAnnotationsLogic(e,t){const i={};Reflect.getMetadataKeys(e.prototype,t).filter((e=>e.toString().startsWith(G.MethodAnnotation))).forEach((o=>{i[o.split(":")[1]]=Reflect.getMetadata(o,e.prototype,t)}));return i}}const H=new AnnotationService;const W="CacheConfig";const $=H.getClassAnnotationFactory(W);function CacheConfigAnnotationFactory(e){"ngInject";return H.setClassAnnotationFactory(W,(t=>function(i,o,n){i=new(o.bind(i))(...n);i.cacheConfig=t[0];e.debug(`adding cache config ${JSON.stringify(i.cacheConfig)} to class ${E.getInstanceConstructorName(i)}`,i);return i}))}const K="Cached";const Y=H.getMethodAnnotationFactory(K);function CachedAnnotationFactory(e){"ngInject";const t=H.setMethodAnnotationFactory(K,(t=>function(i,o,n,s){let a=[];let r=[];if(t[0]){a=t[0].actions;r=t[0].tags}if(i.cacheConfig){if(i.cacheConfig.actions){a=v.uniq(a.concat(i.cacheConfig.actions))}if(i.cacheConfig.tags){r=v.uniq(r.concat(i.cacheConfig.tags))}}if(!a.length){const e=E.getInstanceConstructorName(i);throw new Error(`method ${o} of ${e} is @Cached annotated but no CacheAction is specified either through @Cached or through class level @CacheConfig annotation`)}return e.handle(i,o,n,Array.prototype.slice.apply(s),a,r)}));return t}const Z="InvalidateCache";const InvalidateCache=function(e){return H.getMethodAnnotationFactory(Z)(e)};function InvalidateCacheAnnotationFactory(e){"ngInject";return H.setMethodAnnotationFactory(Z,(t=>function(i,o,n,s){let a=[];const r=t[0];if(!r){if(i.cacheConfig&&i.cacheConfig.tags){a=i.cacheConfig.tags}}else{a=[r]}if(!a.length){throw new Error(`method ${o} of ${i.constructor.name} is @InvalidateCache annotated but no EvictionTag is specified either through @InvalidateCache or through class level @CacheConfig annotation`)}const l=n.apply(undefined,Array.prototype.slice.call(s));if(l&&l.then){return l.then((t=>{e.evict(...a);return t}))}else{e.evict(...a);return l}}))}class CacheAction{constructor(e){this.name=e}}const Q="@smart/utils";const J=`${Q}_WHO_AM_I_RESOURCE_URI`;const ee=`${Q}_I18N_RESOURCE_URI`;const te=`${Q}_EVENTSERVICE`;const ie="REAUTH_STARTED";const oe="/authorizationserver/oauth/token";const ne="/smarteditwebservices/v1/i18n";const se="smartedit";const ae={["^(?!"+ne+"/.*$).*$"]:oe};const re={[oe]:{client_id:se}};const le="/";const ce="SWITCH_LANGUAGE_EVENT";const de="SELECTED_LANGUAGE";const pe={TOKEN_STORED:"TOKEN_STORED",AUTHORIZATION_SUCCESS:"AUTHORIZATION_SUCCESS",USER_HAS_CHANGED:"USER_HAS_CHANGED",LOGOUT:"SE_LOGOUT_EVENT",CLEAR_PERSPECTIVE_FEATURES:"CLEAR_PERSPECTIVE_FEATURES",EXPERIENCE_UPDATE:"experienceUpdate",PERMISSION_CACHE_CLEANED:"PERMISSION_CACHE_CLEANED",PAGE_CHANGE:"PAGE_CHANGE",PAGE_CREATED:"PAGE_CREATED_EVENT",PAGE_UPDATED:"PAGE_UPDATED_EVENT",PAGE_DELETED:"PAGE_DELETED_EVENT",PAGE_SELECTED:"PAGE_SELECTED_EVENT",PAGE_RESTORED:"PAGE_RESTORED_EVENT",REAUTH_STARTED:"REAUTH_STARTED"};const me="en";const ge=new a.InjectionToken("LANGUAGE_SERVICE_CONSTANTS");const ue=new a.InjectionToken("LANGUAGE_SERVICE");const he="yjQuery";var _e;t.CacheEngine=_e=class CacheEngine{constructor(e,t,i){this.windowUtils=e;this.promiseUtils=t;this.logService=i;this.cachedItemsRegistry=[];this.startBackgroundMonitoringJob()}addItem(e,t,i){if(this.getItemIndex(e)===-1){this.cachedItemsRegistry.push({item:e,cacheTiming:t,refresh:i,completed:false,processing:false,defer:this.promiseUtils.defer()})}else{this.logService.warn(`CacheEngine - item already exist for id: ${e.id}`)}}getItemById(e){const t=this.cachedItemsRegistry.find((t=>t.item.id===e));return t?t.item:null}handle(e){const t=this.cachedItemsRegistry[this.getItemIndex(e)];if(t.completed&&!this.hasExpired(e)){t.defer.resolve(e.cache)}else if(!t.processing){t.processing=true;this.refreshCache(t)}return t.defer.promise}evict(...e){e.forEach((e=>{this.cachedItemsRegistry.filter((t=>t.item.evictionTags.indexOf(e)>-1)).forEach((e=>this.cachedItemsRegistry.splice(this.getItemIndex(e.item),1)))}))}startBackgroundMonitoringJob(){this.windowUtils.runIntervalOutsideAngular((()=>Promise.all(this.cachedItemsRegistry.filter((e=>this.needRefresh(e.item))).map((e=>this.refreshCache(e))))),_e.BACKGROUND_REFRESH_INTERVAL)}refreshCache(e){return e.refresh().then((t=>{e.cacheTiming.setAge(e.item);e.item.cache=t;e.item.timestamp=(new Date).getTime();e.completed=true;e.processing=false;e.defer.resolve(t)}),(t=>{this.logService.debug(`CacheEngine - unable to refresh cache for id: ${e.item.id}`,t);delete e.item.cache;e.defer.reject(t)}))}hasExpired(e){return e.timestamp+e.expirationAge<=(new Date).getTime()}needRefresh(e){return e.timestamp+e.refreshAge<=(new Date).getTime()}getItemIndex(e){return this.cachedItemsRegistry.findIndex((t=>t.item.id===e.id))}};t.CacheEngine.BACKGROUND_REFRESH_INTERVAL=1e4;t.CacheEngine=_e=__decorate([a.Injectable(),__metadata("design:paramtypes",[WindowUtils,t.PromiseUtils,LogService])],t.CacheEngine);class DefaultCacheTiming{constructor(e,t){this.expirationAge=e;this.refreshAge=t}setAge(e){const t=Object.assign(Object.assign({},e),{expirationAge:this.expirationAge,refreshAge:this.refreshAge});return t}}t.CacheService=class CacheService{constructor(e,t,i,o,n){this.logService=e;this.stringUtils=t;this.functionsUtils=i;this.eventService=o;this.cacheEngine=n;this.predicatesRegistry=[];this.eventListeners=[];this.defaultCacheTiming=new DefaultCacheTiming(24*60*60*1e3,12*60*60*1e3)}register(e,t){this.predicatesRegistry.unshift({test:e,cacheTiming:t});return this}handle(e,t,i,o,n,s){const a=this.functionsUtils.getInstanceConstructorName(e);const r=window.btoa(a+t)+this.stringUtils.encode(o);const l=this.cacheEngine.getItemById(r);let d;if(!l){const e=l||{id:r,timestamp:(new Date).getTime(),evictionTags:this.collectEventNamesFromTags(s),cache:null};const t=this.findCacheTimingByCacheActions(n);if(!t){throw new Error("CacheService::handle - No predicate match.")}d=t.setAge(e);this.cacheEngine.addItem(d,t,i.bind(undefined,...Array.prototype.slice.call(o)));this.listenForEvictionByTags(s)}else{d=l}return this.cacheEngine.handle(d)}evict(...e){const t=this.collectEventNamesFromTags(e);this.cacheEngine.evict(...t);t.forEach((e=>this.eventService.publish(e)))}listenForEvictionByTags(e){this.collectEventNamesFromTags(e).filter((e=>this.eventListeners.indexOf(e)===-1)).forEach((e=>{this.logService.debug(`registering event listener ${e}`);this.eventListeners.push(e);this.eventService.subscribe(e,((t,i)=>{this.logService.debug(`cleaning cache on event ${e}`);this.cacheEngine.evict(e);return Promise.resolve({})}))}))}collectEventNamesFromTags(e){if(e&&e.length){return v.union(...e.map((e=>this.collectEventNamesFromTag(e))))}else{return[]}}collectEventNamesFromTag(e){return v.union([e.event],...e.relatedTags?e.relatedTags.map((e=>this.collectEventNamesFromTag(e))):[])}findCacheTimingByCacheActions(e){const t=this.predicatesRegistry.find((t=>t.test(e)));return t?t.cacheTiming:this.defaultCacheTiming}};t.CacheService=__decorate([a.Injectable(),__param(3,a.Inject(te)),__metadata("design:paramtypes",[LogService,StringUtils,FunctionsUtils,Object,t.CacheEngine])],t.CacheService);class EvictionTag{constructor(e){this.event=e.event;this.relatedTags=e.relatedTags}}const ve="RarelyChangingContent";const fe=new CacheAction(ve);class BackendEntry{constructor(e,t){this.pattern=e;this.matchingPayload=t}respond(e){this.mock=e;return this}passThrough(){}}t.HttpBackendService=class HttpBackendService{constructor(){this.matchLatestDefinition=false;this.backends={GET:[],POST:[],PUT:[],PATCH:[],DELETE:[]}}whenGET(e){return this._whenMethod("GET",e)}whenPOST(e,t){return this._whenMethod("POST",e,t)}whenPUT(e,t){return this._whenMethod("PUT",e,t)}whenPATCH(e,t){return this._whenMethod("PATCH",e,t)}whenDELETE(e){return this._whenMethod("DELETE",e)}when(e,t,i){return this._whenMethod(e,t,i)}whenAsync(e,t,i){return this._whenMethod(e,t,i)}matchLatestDefinitionEnabled(e){this.matchLatestDefinition=e}findMatchingMock(e){const t=(this.matchLatestDefinition?this.backends[e.method].slice().reverse():this.backends[e.method]).find((t=>{if(typeof t.pattern==="string"){return e.urlWithParams.endsWith(t.pattern)&&this.matchingPayloadRestriction(t,e)}else{const i=t.pattern.test(e.urlWithParams)&&this.matchingPayloadRestriction(t,e);t.pattern.lastIndex=0;return i}}));return t?t.mock:undefined}_whenMethod(e,t,i){const o=new BackendEntry(t,i);this.backends[e].push(o);return o}matchingPayloadRestriction(e,t){return e.matchingPayload?v.isEqual(e.matchingPayload,t.body):true}};t.HttpBackendService=__decorate([a.Injectable()],t.HttpBackendService);t.BackendInterceptor=class BackendInterceptor{constructor(e,t,i,o){this.httpBackendService=e;this.httpUtils=t;this.urlUtils=i;this.logService=o}intercept(e,t){const i=this.httpBackendService.findMatchingMock(e);if(!i){return t.handle(e)}let o;if(typeof i==="object"){o=[200,v.cloneDeep(i)]}else{let t=null;if(e.method==="GET"){t=decodeURIComponent(this.urlUtils.getQueryString(this.httpUtils.copyHttpParamsOrHeaders(e.params)))}else if(e.headers.get("Content-Type")==="application/x-www-form-urlencoded"){t=e.body}else if(e.method==="POST"||e.method==="PUT"){t=JSON.stringify(e.body)}const n=this.httpUtils.copyHttpParamsOrHeaders(e.headers);o=i(e.method,decodeURIComponent(e.urlWithParams),t,n)}this.logService.debug(`backend ${status} response for ${e.url}: `);return this.httpUtils.buildHttpResponse(e,o).pipe(d.take(1))}};t.BackendInterceptor=__decorate([a.Injectable(),__metadata("design:paramtypes",[t.HttpBackendService,HttpUtils,UrlUtils,LogService])],t.BackendInterceptor);var ye;let Se=ye=class FlawInjectionInterceptor{constructor(e,t){this.httpUtils=e;this.logService=t;this.flawWindow=window;this.flawWindow.allRequests=0;this.flawWindow.flawedRequests=0;this.flawWindow.allResponses=0;this.flawWindow.flawedResponses=0}static registerRequestFlaw(e){this.requestMutations.push(e)}static registerResponseFlaw(e){this.responseMutations.push(e)}intercept(e,t){if(ye.PROBABILITY!==0&&this.httpUtils.isCRUDRequest(e)&&!this._isGET(e)){return this._handleFlawWindow(e,t)}return t.handle(e)}_isGET(e){return e.method==="GET"}_activateWithProbability(e){return Math.random()>=1-e}_generateResultResponse(e,t){return t.pipe(d.map((t=>{if(t instanceof r.HttpResponse&&this._activateWithProbability(ye.PROBABILITY)){this.flawWindow.flawedResponses++;const i=ye.responseMutations.find((t=>t.test(e)));if(i&&t instanceof r.HttpResponse){this.logService.error(`FLAWED RESPONSE-"${e.url}`);return i.mutate(t)}}return t})))}_handleFlawWindow(e,t){let i;this.flawWindow.allRequests++;if(this._activateWithProbability(ye.PROBABILITY)){this.flawWindow.flawedRequests++;const o=ye.requestMutations.find((t=>t.test(e)));if(o){this.logService.error(`FLAWED REQUEST-"${e.url}`);i=t.handle(o.mutate(e))}}i=t.handle(e);return this._generateResultResponse(e,i)}};Se.requestMutations=[];Se.responseMutations=[];Se.PROBABILITY=0;Se=ye=__decorate([a.Injectable(),__metadata("design:paramtypes",[HttpUtils,LogService])],Se);t.FlawInjectionInterceptorModule=class FlawInjectionInterceptorModule{};t.FlawInjectionInterceptorModule=__decorate([a.NgModule({imports:[],providers:[{provide:r.HTTP_INTERCEPTORS,useClass:Se,multi:true},{provide:a.APP_INITIALIZER,useFactory(){Se.registerRequestFlaw({test:e=>/sites\/[\w-]+\//.test(e.url),mutate:e=>e.clone({url:e.url.replace(/sites\/([\w-]+)\//,"sites/"+Math.random()+"/")})});return e=>{}},multi:true}]})],t.FlawInjectionInterceptorModule);t.IAlertServiceType=void 0;(function(e){e["INFO"]="information";e["SUCCESS"]="success";e["WARNING"]="warning";e["DANGER"]="error"})(t.IAlertServiceType||(t.IAlertServiceType={}));class IAlertService{showAlert(e){"proxyFunction";return}showInfo(e){"proxyFunction";return}showDanger(e){"proxyFunction";return}showWarning(e){"proxyFunction";return}showSuccess(e){"proxyFunction";return}}class IAuthenticationService{constructor(){this.reauthInProgress={};this.initialized=false}authenticate(e){"proxyFunction";return Promise.resolve()}logout(){"proxyFunction";return Promise.resolve()}isReAuthInProgress(e){"proxyFunction";return Promise.resolve(false)}setReAuthInProgress(e){"proxyFunction";return Promise.resolve()}filterEntryPoints(e){"proxyFunction";return Promise.resolve([])}isAuthEntryPoint(e){"proxyFunction";return Promise.resolve(false)}isAuthenticated(e){"proxyFunction";return Promise.resolve(false)}}class IStorageService{isInitialized(){"proxyFunction";return Promise.resolve(false)}storeAuthToken(e,t){"proxyFunction";return Promise.resolve()}getAuthToken(e){"proxyFunction";return Promise.resolve(undefined)}removeAuthToken(e){"proxyFunction";return Promise.resolve()}removeAllAuthTokens(){"proxyFunction";return Promise.resolve()}getValueFromLocalStorage(e,t){"proxyFunction";return Promise.resolve()}setValueInLocalStorage(e,t,i){"proxyFunction";return Promise.resolve()}setItem(e,t){"proxyFunction";return Promise.resolve()}getItem(e){"proxyFunction";return Promise.resolve()}}t.ModalButtonStyle=void 0;(function(e){e["Default"]="transparent";e["Primary"]="emphasized"})(t.ModalButtonStyle||(t.ModalButtonStyle={}));t.ModalButtonAction=void 0;(function(e){e["Close"]="close";e["Dismiss"]="dismiss";e["None"]="none"})(t.ModalButtonAction||(t.ModalButtonAction={}));class ISharedDataService{get(e){"proxyFunction";return Promise.resolve({})}set(e,t){"proxyFunction";return Promise.resolve()}update(e,t){"proxyFunction";return Promise.resolve()}remove(e){"proxyFunction";return Promise.resolve({})}containsKey(e){"proxyFunction";return Promise.resolve(true)}}class ISettingsService{load(){"proxyFunction";return Promise.resolve({key:""})}get(e){"proxyFunction";return Promise.resolve("")}getBoolean(e){"proxyFunction";return Promise.resolve(true)}getStringList(e){"proxyFunction";return Promise.resolve([])}}class IModalService{dismissAll(){"proxyFunction"}open(e){"proxyFunction";return{}}hasOpenModals(){"proxyFunction";return null}}class ISessionService{getCurrentUsername(){"proxyFunction";return Promise.resolve("")}getCurrentUserDisplayName(){"proxyFunction";return Promise.resolve("")}getCurrentUser(){"proxyFunction";return Promise.resolve({})}hasUserChanged(){"proxyFunction";return Promise.resolve(true)}resetCurrentUserData(){"proxyFunction";return Promise.resolve()}setCurrentUsername(){"proxyFunction";return Promise.resolve()}}class IAuthenticationManagerService{}const Ce=[500,502,503,504];const be=[429];const Ie=[408];function serverErrorPredicate(e,t){return t&&v.includes(Ce,t.status)}function clientErrorPredicate(e,t){return t&&v.includes(be,t.status)}function timeoutErrorPredicate(e,t){return t&&v.includes(Ie,t.status)}function retriableErrorPredicate(e,t){return t&&B.isAnyTruthy(serverErrorPredicate,clientErrorPredicate,timeoutErrorPredicate)(e,t)}function noInternetConnectionErrorPredicate(e,t){return t&&t.status===0}const Ee=["PUT","POST","DELETE","PATCH"];const we=["GET","OPTIONS","HEAD"];function updatePredicate(e,t){return v.includes(Ee,e.method)}function readPredicate(e,t){return v.includes(we,e.method)}const Te={MAX_BACKOFF:64e3,MAX_ATTEMPT:5,MIN_BACKOFF:0};class ExponentialRetry{calculateNextDelay(e,t,i){t=t||Te.MAX_BACKOFF;i=i||Te.MIN_BACKOFF;const o=i+Math.random();return Math.min(Math.pow(2,e)*1e3+o,t)}canRetry(e,t){t=t||Te.MAX_ATTEMPT;return e<=t}}const Pe={MAX_ATTEMPT:5,MAX_BACKOFF:32e3,MIN_BACKOFF:0,RETRY_INTERVAL:500};class LinearRetry{calculateNextDelay(e,t,i,o){i=i||Pe.MAX_BACKOFF;o=o||Pe.MIN_BACKOFF;t=t||Pe.RETRY_INTERVAL;const n=o+Math.random();return Math.min(e*t+n,i)}canRetry(e,t){t=t||Pe.MAX_ATTEMPT;return e<=t}}const Oe={MAX_ATTEMPT:5,MIN_BACKOFF:0,RETRY_INTERVAL:500};class SimpleRetry{calculateNextDelay(e,t){t=t||Oe.MIN_BACKOFF;e=e||Oe.RETRY_INTERVAL;const i=t+Math.random();return e+i}canRetry(e,t){const i=t||Oe.MAX_ATTEMPT;return e<=i}}const Ae=new a.InjectionToken("DefaultRetryStrategy");function defaultRetryStrategyFactory(e){return class{constructor(){this.firstFastRetry=true;this.attemptCount=0}canRetry(){return e.canRetry(this.attemptCount)}calculateNextDelay(){return e.calculateNextDelay()}}}const xe=new a.InjectionToken("ExponentialRetryStrategy");function exponentialRetryStrategyFactory(e){return class{constructor(){this.firstFastRetry=true;this.attemptCount=0}canRetry(){return e.canRetry(this.attemptCount)}calculateNextDelay(){return e.calculateNextDelay(this.attemptCount)}}}const De=new a.InjectionToken("LinearRetryStrategy");function linearRetryStrategyFactory(e){return class{constructor(){this.firstFastRetry=true;this.attemptCount=0}canRetry(){return e.canRetry(this.attemptCount)}calculateNextDelay(){return e.calculateNextDelay(this.attemptCount)}}}t.OperationContextService=class OperationContextService{constructor(){this.store=[]}register(e,t){if(typeof e!=="string"||v.isEmpty(e)){throw new Error("operationContextService.register error: url is invalid")}if(typeof t!=="string"||v.isEmpty(t)){throw new Error("operationContextService.register error: operationContext is invalid")}const i=this.store.findIndex((i=>i.urlRegex.test(e)===true&&i.operationContext===t));if(i!==-1){return this}const o=new RegExp(e.replace(/\/:[^\/]*/g,"/.*"));this.store.push({urlRegex:o,operationContext:t});return this}findOperationContext(e){const t=this.store.findIndex((t=>t.urlRegex.test(e)===true));return~t?this.store[t].operationContext:null}};t.OperationContextService=__decorate([a.Injectable(),__metadata("design:paramtypes",[])],t.OperationContextService);const Re="OperationContextRegistered";const Me=H.getClassAnnotationFactory(Re);function OperationContextAnnotationFactory(e,t,i){"ngInject";return H.setClassAnnotationFactory(Re,(function(o){return function(n,s,a){n=new(s.bind(n))(...a);const r=e.get(o[0],o[0]);if(typeof o[1]==="string"){const e=i[o[1]];t.register(r,e)}else if(Array.isArray(o[1])&&o[1].length>0){o[1].forEach((e=>{t.register(r,i[e])}))}return n}}))}const ke=`${Q}_OPERATION_CONTEXT`;t.RetryInterceptor=class RetryInterceptor{constructor(e,t,i,o,n,s,a,r,l){this.httpClient=e;this.translate=t;this.operationContextService=i;this.alertService=o;this.OPERATION_CONTEXT=l;this.TRANSLATE_NAMESPACE="se.gracefuldegradation.";this.predicatesRegistry=[];this.requestToRetryTegistry={};this.register(noInternetConnectionErrorPredicate,a).register(n.isAnyTruthy(clientErrorPredicate,timeoutErrorPredicate),s).register(n.areAllTruthy(readPredicate,retriableErrorPredicate),s).register(serverErrorPredicate,a)}predicate(e,t){return this.findMatchingStrategy(e,t)!==null}responseError(e,t){let i=this.retrieveRetryStrategy(e);if(!i){const o=this.findMatchingStrategy(e,t);if(o){this.alertService.showWarning({message:this.translate.instant(this.TRANSLATE_NAMESPACE+"stillworking"),minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"});i=new o;i.attemptCount=0;this.storeRetryStrategy(e,i)}else{return Promise.reject(t)}}return this.handleRetry(i,e,t)}register(e,t){if(typeof e!=="function"){throw new Error("retryInterceptor.register error: predicate must be a function")}if(typeof t!=="function"){throw new Error("retryInterceptor.register error: retryStrategy must be a function")}this.predicatesRegistry.unshift({predicate:e,retryStrategy:t});return this}findMatchingStrategy(e,t){const i=this.operationContextService.findOperationContext(e.url)||this.OPERATION_CONTEXT.INTERACTIVE;const o=this.predicatesRegistry.find((o=>o.predicate(e,t,i)));return o?o.retryStrategy:null}handleRetry(e,t,i){e.attemptCount++;if(e.canRetry()){const i=e.firstFastRetry?0:e.calculateNextDelay();e.firstFastRetry=false;return new Promise(((e,o)=>{setTimeout((()=>{this.httpClient.request(t).toPromise().then((i=>{this.removeRetryStrategy(t);return e(i)}),(e=>o(e)))}),i)}))}else{this.alertService.showDanger({message:this.translate.instant(this.TRANSLATE_NAMESPACE+"somethingwrong"),minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"});return Promise.reject(i)}}storeRetryStrategy(e,t){this.requestToRetryTegistry[this.getRequestUUID(e)]=t}removeRetryStrategy(e){delete this.requestToRetryTegistry[this.getRequestUUID(e)]}retrieveRetryStrategy(e){return this.requestToRetryTegistry[this.getRequestUUID(e)]}getRequestUUID(e){return e.clone().toString()}};t.RetryInterceptor=__decorate([a.Injectable(),__param(5,a.Inject(Ae)),__param(6,a.Inject(xe)),__param(7,a.Inject(De)),__param(8,a.Inject(ke)),__metadata("design:paramtypes",[r.HttpClient,p.TranslateService,t.OperationContextService,IAlertService,BooleanUtils,Object,Object,Object,Object])],t.RetryInterceptor);t.PermissionErrorInterceptor=class PermissionErrorInterceptor{constructor(e){this.alertService=e}predicate(e,t){return t.status===403}responseError(e,t){if(t.error&&t.error.errors){t.error.errors.filter((e=>e.type==="TypePermissionError")).forEach((e=>{this.alertService.showDanger({message:e.message,duration:1e4,minWidth:"",mousePersist:true,dismissible:true,width:"300px"})}))}return Promise.reject(t)}};t.PermissionErrorInterceptor=__decorate([a.Injectable(),__metadata("design:paramtypes",[IAlertService])],t.PermissionErrorInterceptor);const Ne={};t.UnauthorizedErrorInterceptor=class UnauthorizedErrorInterceptor{constructor(e,t,i,o,n,s,a){this.httpClient=e;this.authenticationService=t;this.promiseUtils=i;this.httpUtils=o;this.eventService=s;this.logService=a;this.promisesToResolve={};this.rejectedUrls=[/authenticate/];this.rejectedUrls.push(n)}predicate(e,t){return t.status===401&&(e.url?this.httpUtils.isCRUDRequest(e,t)&&this.isUrlNotRejected(e.url):true)}responseError(e,t){const i=this.promiseUtils.defer();const o=i.promise.then((()=>this.httpClient.request(e).toPromise()));this.authenticationService.isAuthEntryPoint(e.url).then((n=>{if(!n){this.authenticationService.filterEntryPoints(e.url).then((t=>{const n=t[0];this.promisesToResolve[n]=this.promisesToResolve[n]||[];this.promisesToResolve[n].push({requestIdentifier:e.url,deferred:i});if(this.httpUtils.isGET(e)){Ne[e.url]=o}this.authenticationService.isReAuthInProgress(n).then((t=>{if(!t){this.authenticationService.setReAuthInProgress(n).then((()=>{const t=this.promisesToResolve;this.eventService.publish(ie).catch((e=>{this.logService.debug(`UnauthorizedErrorInterceptor - responseError: ${e}`)}));this.authenticationService.authenticate(e.url).then(function(){t[this].forEach((e=>{delete Ne[e.requestIdentifier];e.deferred.resolve()}));t[this]=[]}.bind(n),function(){t[this].forEach((e=>{delete Ne[e.requestIdentifier];e.deferred.reject()}));t[this]=[]}.bind(n))}))}}))}))}else{i.reject(t)}}));return o}isUrlNotRejected(e){return!this.rejectedUrls.some((t=>typeof t==="string"?e.indexOf(t)===0:t.test(e)))}};t.UnauthorizedErrorInterceptor=__decorate([a.Injectable(),__param(4,a.Inject(J)),__param(5,a.Inject(te)),__metadata("design:paramtypes",[r.HttpClient,IAuthenticationService,t.PromiseUtils,HttpUtils,String,Object,LogService])],t.UnauthorizedErrorInterceptor);let Fe=class HttpAuthInterceptor{constructor(e,t,i,o){this.authenticationService=e;this.injector=t;this.httpUtils=i;this.I18N_RESOURCE_URI=o}intercept(e,t){if(!this._isCRUDRequest(e)){return t.handle(e)}if(this._isGetRequest(e)){return this._handleGetRequest(e)}return this._handleCUDRequest(e,t)}_isCRUDRequest(e){return!e.url.includes(this.I18N_RESOURCE_URI)&&this.httpUtils.isCRUDRequest(e)}_isGetRequest(e){return this.httpUtils.isGET(e)&&!!Ne[e.url]}_handleGetRequest(e){return new l.Observable((t=>{Ne[e.url].then((e=>{t.next(new r.HttpResponse({status:200,body:e}))}))}))}_addAuthToResponse(e,t,i){return l.from(this.injector.get(IStorageService).getAuthToken(i[0])).pipe(d.switchMap((i=>{if(!i){return t.handle(e)}const o=e.clone({headers:e.headers.set("Authorization",i.token_type+" "+i.access_token)});return t.handle(o)})))}_handleCUDRequest(e,t){return l.from(this.authenticationService.filterEntryPoints(e.url)).pipe(d.switchMap((i=>{if(!(i&&i.length)){return t.handle(e)}return this._addAuthToResponse(e,t,i)})))}};Fe=__decorate([a.Injectable(),__param(3,a.Inject(ee)),__metadata("design:paramtypes",[IAuthenticationService,a.Injector,HttpUtils,String])],Fe);t.HttpErrorInterceptorService=class HttpErrorInterceptorService{constructor(e,t){this.injector=e;this.promiseUtils=t;this._errorInterceptors=[]}addInterceptors(e){e.forEach((e=>{this.addInterceptor(e)}))}addInterceptor(e){let t;if(e.predicate||e.responseError){t=e}else{t=this.injector.get(e)}this._validateInterceptor(t);this._errorInterceptors.unshift(t);return()=>{this._errorInterceptors.splice(this._errorInterceptors.indexOf(t),1)}}responseError(e,t){const i=this._errorInterceptors.filter((i=>i.predicate(e,t)===true));const o=this.promiseUtils.defer();if(i.length){this._iterateErrorInterceptors(e.clone(),v.cloneDeep(t),i,o)}else{o.reject(t)}return l.from(o.promise)}_iterateErrorInterceptors(e,t,i,o,n=0){if(n===i.length){o.reject(t)}else{const s=this._iterateErrorInterceptors.bind(this);Promise.resolve(i[n].responseError(e,t)).then((e=>{o.resolve(e)}),(t=>{s(e,t,i,o,++n)}))}}_validateInterceptor(e){if(!e.predicate||typeof e.predicate!=="function"){throw new Error("httpErrorInterceptorService.addInterceptor.error.interceptor.has.no.predicate")}if(!e.responseError||typeof e.responseError!=="function"){throw new Error("httpErrorInterceptorService.addInterceptor.error.interceptor.has.no.responseError")}}};t.HttpErrorInterceptorService=__decorate([a.Injectable(),__metadata("design:paramtypes",[a.Injector,t.PromiseUtils])],t.HttpErrorInterceptorService);let ze=class HttpErrorInterceptor{constructor(e,t){this.httpErrorInterceptorService=e;this.httpUtils=t}intercept(e,t){return t.handle(e).pipe(d.catchError(((t,i)=>{if(!this.httpUtils.isHTMLRequest(e,t)){return this.httpErrorInterceptorService.responseError(e,t)}else{return l.throwError(t)}})))}};ze=__decorate([a.Injectable(),__metadata("design:paramtypes",[t.HttpErrorInterceptorService,HttpUtils])],ze);var Le;t.HttpInterceptorModule=Le=class HttpInterceptorModule{static forRoot(...e){return{ngModule:Le,providers:[...e,{provide:r.HTTP_INTERCEPTORS,useClass:Fe,multi:true},{provide:r.HTTP_INTERCEPTORS,useClass:ze,multi:true},{provide:r.HTTP_INTERCEPTORS,useClass:t.BackendInterceptor,multi:true},{provide:a.APP_BOOTSTRAP_LISTENER,useFactory(t){t.addInterceptors(e);return e=>{}},deps:[t.HttpErrorInterceptorService],multi:true}]}}};t.HttpInterceptorModule=Le=__decorate([a.NgModule({imports:[t.FlawInjectionInterceptorModule],providers:[SimpleRetry,LinearRetry,ExponentialRetry,{provide:Ae,useFactory:defaultRetryStrategyFactory,deps:[SimpleRetry]},{provide:xe,useFactory:exponentialRetryStrategyFactory,deps:[ExponentialRetry]},{provide:De,useFactory:linearRetryStrategyFactory,deps:[SimpleRetry]},t.HttpErrorInterceptorService,t.HttpBackendService]})],t.HttpInterceptorModule);t.StatusText=void 0;(function(e){e["UNKNOW_ERROR"]="Unknown Error"})(t.StatusText||(t.StatusText={}));class HttpPaginationResponseAdapter{static transform(e){const t=e;const i=t&&t.body&&t.body.pagination;if(!i){return t}const o=Object.keys(t.body).find((e=>e!=="pagination"&&Array.isArray(t.body[e])));return o?t.clone({body:Object.assign(Object.assign({},t.body),{results:t.body[o]})}):t}}t.ResponseAdapterInterceptor=class ResponseAdapterInterceptor{intercept(e,t){return t.handle(e).pipe(d.map(HttpPaginationResponseAdapter.transform))}};t.ResponseAdapterInterceptor=__decorate([a.Injectable()],t.ResponseAdapterInterceptor);class RestClient{constructor(e,t,i){this.httpClient=e;this.url=t;this.identifierName=i;this.DEFAULT_HEADERS={"x-requested-with":"Angular"};this.DEFAULT_OPTIONS={headers:{}};this.metadataActivated=false;this.getMethodForSingleInstance=e=>{switch(e){case"getById":return(e,t=this.DEFAULT_OPTIONS)=>this.getById(e,t);case"get":return(e,t=this.DEFAULT_OPTIONS)=>this.get(e,t);case"update":return(e,t=this.DEFAULT_OPTIONS)=>this.update(e,t);case"save":return(e,t=this.DEFAULT_OPTIONS)=>this.save(e,t);case"patch":return(e,t=this.DEFAULT_OPTIONS)=>this.patch(e,t);case"remove":return(e,t=this.DEFAULT_OPTIONS)=>this.remove(e,t);default:return()=>Promise.reject()}};this.getMethodForArray=e=>{switch(e){case"query":return(e,t=this.DEFAULT_OPTIONS)=>this.query(e,t);default:return()=>Promise.reject()}}}getById(e,t=this.DEFAULT_OPTIONS){return this.addHeadersToBody(this.httpClient.get(`${this.url}/${e}`,{headers:this.buildRequestHeaders(t.headers||{}),observe:"response"})).toPromise()}get(e,t=this.DEFAULT_OPTIONS){const i=this.convertToTypeMapOfString(e);return this.addHeadersToBody(this.httpClient.get(this.interpolateParamsInURL(this.url,i),{params:this.formatQueryString(this.determineTrueQueryStringParams(this.url,e)),headers:this.buildRequestHeaders(t.headers||{}),observe:"response"})).toPromise()}query(e,t=this.DEFAULT_OPTIONS){const i=e?this.convertToTypeMapOfString(e):e;return this.addHeadersToBody(this.httpClient.get(this.interpolateParamsInURL(this.url,i),{params:this.formatQueryString(this.determineTrueQueryStringParams(this.url,e)),headers:this.buildRequestHeaders(t.headers||{}),observe:"response"})).pipe(d.map((e=>e||[]))).toPromise()}page(e,t=this.DEFAULT_OPTIONS){return this.addHeadersToBody(this.httpClient.get(this.interpolateParamsInURL(this.url,e),{params:this.formatQueryString(this.determineTrueQueryStringParams(this.url,e)),headers:this.buildRequestHeaders(t.headers||{}),observe:"response"})).pipe(d.map((e=>e))).toPromise()}update(e,t=this.DEFAULT_OPTIONS){return this.performIdentifierCheck(e).then((()=>this.buildUrlWithIdentifier(e))).then((i=>this.httpClient.put(i,e,{headers:this.buildRequestHeaders(t.headers||{})}).toPromise()))}save(e,t=this.DEFAULT_OPTIONS){return this.httpClient.post(this.interpolateParamsInURL(this.url,e),e,{headers:this.buildRequestHeaders(t.headers||{})}).toPromise()}patch(e,t=this.DEFAULT_OPTIONS){return this.performIdentifierCheck(e).then((()=>this.buildUrlWithIdentifier(e))).then((i=>this.httpClient.patch(i,e,{headers:this.buildRequestHeaders(t.headers||{})}).toPromise()))}remove(e,t=this.DEFAULT_OPTIONS){return this.performIdentifierCheck(e).then((()=>this.buildUrlWithIdentifier(e))).then((e=>this.httpClient.delete(e,{headers:this.buildRequestHeaders(t.headers||{})}).toPromise()))}queryByPost(e,t,i=this.DEFAULT_OPTIONS){const o=this.convertToTypeMapOfString(t);return this.httpClient.post(this.interpolateParamsInURL(this.url,o),e,{params:this.formatQueryString(this.determineTrueQueryStringParams(this.url,t)),headers:this.buildRequestHeaders(i.headers||{})}).toPromise()}activateMetadata(){this.metadataActivated=true}convertToTypeMapOfString(e){return v.mapValues(e,(e=>String(e)))}formatQueryString(e){return this.sortByKeys(e)}addHeadersToBody(e){return e.pipe(d.map((e=>{const t=e.body;if(this.metadataActivated&&t){t.headers=e.headers}return t})))}interpolateParamsInURL(e,t){if(t&&typeof t!=="string"){return new URIBuilder(e).replaceParams(t).sanitize().build()}else{return e}}determineTrueQueryStringParams(e,t){return typeof t==="object"?Object.keys(t).reduce(((i,o)=>{if(!new RegExp(":"+o+"/").test(e)&&!new RegExp(":"+o+"$").test(e)&&!new RegExp(":"+o+"&").test(e)&&!v.isNil(t[o])){i[o]=t[o]}return i}),{}):{}}sortByKeys(e){const t=v.sortBy(v.keys(e),(e=>e));return v.zipObject(t,v.map(t,(t=>e[t])))}performIdentifierCheck(e){const t=typeof e==="string"?e:e[this.identifierName];if(!t){return Promise.reject("no data was found under the "+t+" field of object "+JSON.stringify(e)+", it is necessary for update and remove operations")}return Promise.resolve()}buildUrlWithIdentifier(e){const t=typeof e==="string"?e:e[this.identifierName];let i=this.interpolateParamsInURL(`${this.url}`,e);i=i.includes("?")||this.url.includes(":"+this.identifierName)?i:`${i}/${t}`;return Promise.resolve(i)}buildRequestHeaders(e){return new r.HttpHeaders(Object.assign(Object.assign({},this.DEFAULT_HEADERS),e))}}var Ve;t.RestServiceFactory=Ve=class RestServiceFactory{constructor(e){this.httpClient=e;this.map=new Map;this.basePath=null;this.DOMAIN=null;this.IDENTIFIER="identifier"}static setGlobalBasePath(e){if(!Ve.globalBasePath){Ve.globalBasePath=e}else{Ve.logService.warn("The value of a global base path was already set. "+"Update is not possible, the value remained unchanged!")}}static getGlobalBasePath(){return Ve.globalBasePath?Ve.globalBasePath:""}setDomain(e){this.DOMAIN=e}setBasePath(e){this.basePath=e}get(e,t=this.IDENTIFIER){if(this.map.has(e+t)){return this.map.get(e+t)}if(!/^https?\:\/\//.test(e)){const t=this.getNewBasePath();const i=v.isEmpty(t)?e:t+(/^\//.test(e)?e:`/${e}`);e=this.shouldAppendDomain(e)?`${this.DOMAIN}/${e}`:i}const i=new RestClient(this.httpClient,e,t);this.map.set(e+t,i);return i}shouldAppendDomain(e){return!!this.DOMAIN&&!/^\//.test(e)}getNewBasePath(){return this.basePath?this.basePath:Ve.globalBasePath}};t.RestServiceFactory.globalBasePath=null;t.RestServiceFactory.logService=new LogService;t.RestServiceFactory=Ve=__decorate([a.Injectable(),__metadata("design:paramtypes",[r.HttpClient])],t.RestServiceFactory);class AbstractCachedRestService{constructor(e,t,i){this.innerRestService=e.get(t,i);this.innerRestService.activateMetadata&&this.innerRestService.activateMetadata()}getById(e,t){return this.innerRestService.getById(e,t)}get(e,t){return this.innerRestService.get(e,t)}query(e,t){return this.innerRestService.query(e,t)}page(e,t){return this.innerRestService.page(e,t)}update(e,t){return this.innerRestService.update(e,t)}patch(e,t){return this.innerRestService.patch(e,t)}remove(e,t){return this.innerRestService.remove(e,t)}save(e,t){return this.innerRestService.save(e,t)}queryByPost(e,t,i){return this.innerRestService.queryByPost(e,t,i)}}__decorate([StripResponseHeaders,Y(),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"getById",null);__decorate([StripResponseHeaders,Y(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"get",null);__decorate([StripResponseHeaders,Y(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"query",null);__decorate([StripResponseHeaders,Y(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"page",null);__decorate([StripResponseHeaders,InvalidateCache(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"update",null);__decorate([StripResponseHeaders,InvalidateCache(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"patch",null);__decorate([InvalidateCache(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"remove",null);__decorate([StripResponseHeaders,__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"save",null);__decorate([StripResponseHeaders,Y(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object,Object]),__metadata("design:returntype",Promise)],AbstractCachedRestService.prototype,"queryByPost",null);function StripResponseHeaders(e,t,i){const o=i.value;if(o){i.value=function(...e){return o.apply(this,e).then((e=>{delete e.headers;return e}))}}}var Ue;const Be="sso";var je;(function(e){e["SSO_CLIENT_ID"]="SSO_CLIENT_ID";e["SSO_AUTHENTICATION_ENTRY_POINT"]="SSO_AUTHENTICATION_ENTRY_POINT";e["SSO_LOGOUT_ENTRY_POINT"]="SSO_LOGOUT_ENTRY_POINT";e["SSO_OAUTH2_AUTHENTICATION_ENTRY_POINT"]="SSO_OAUTH2_AUTHENTICATION_ENTRY_POINT"})(je||(je={}));const Ge="ssoAuthenticate";const He="ssoAuthenticateError";const We="SSODIALOG_WINDOW";t.SSOAuthenticationHelper=Ue=class SSOAuthenticationHelper{constructor(e,t,i,o){this.windowUtils=e;this.promiseUtils=t;this.httpClient=i;this.injector=o;this.logoutIframeId="logoutIframe";this.deferred=null;this.listenForAuthTokenBeingSentBack()}launchSSODialog(){this.deferred=this.promiseUtils.defer();const e=this.injector.get(je.SSO_AUTHENTICATION_ENTRY_POINT)+this.getSSOContextPath();this.window.open(e,We,"toolbar=no,scrollbars=no,resizable=no,top=200,left=200,width=1000,height=800");return this.deferred.promise}completeDialog(){return new Promise(((e,t)=>{this.httpClient.post(this.injector.get(je.SSO_OAUTH2_AUTHENTICATION_ENTRY_POINT),{client_id:this.injector.get(je.SSO_CLIENT_ID)}).subscribe((t=>{this.window.opener.postMessage({eventId:Ge,authToken:t},this.document.location.origin);this.window.close();e()}),(e=>{const i={error:e.error,status:e.status};this.window.opener.postMessage({eventId:He,error:i},this.document.location.origin);this.window.close();t()}))}))}isSSODialog(){return this.window.name===We&&new RegExp(`[?&]${Be}`).test(location.search)}isAutoSSOMain(){return Ue.lastAuthenticatedWithSSO||this.window.name!==We&&new RegExp(`[?&]${Be}`).test(location.search)}logout(){let e=this.logoutIframe;if(!e){e=this.document.createElement("iframe");e.id=this.logoutIframeId;e.style.display="none";this.document.body.appendChild(e)}e.src=this.injector.get(je.SSO_LOGOUT_ENTRY_POINT);Ue.lastAuthenticatedWithSSO=false;this.document.location.href=this.document.location.href.replace(this.getSSOContextPath(),this.document.location.pathname)}getSSOContextPath(){return`${this.document.location.pathname}?${Be}`}listenForAuthTokenBeingSentBack(){this.window.addEventListener("message",(e=>{if(e.origin!==document.location.origin){return}this.logoutIframe&&this.logoutIframe.remove();if(e.data.eventId===Ge){Ue.lastAuthenticatedWithSSO=true;this.deferred&&this.deferred.resolve(e.data.authToken)}else if(e.data.eventId===He){this.deferred&&this.deferred.reject(e.data.error)}}),false)}get window(){return this.windowUtils.getWindow()}get document(){return this.window.document}get logoutIframe(){return this.document.querySelector(`iframe#${this.logoutIframeId}`)}};t.SSOAuthenticationHelper.lastAuthenticatedWithSSO=false;t.SSOAuthenticationHelper=Ue=__decorate([a.Injectable(),__metadata("design:paramtypes",[WindowUtils,t.PromiseUtils,r.HttpClient,a.Injector])],t.SSOAuthenticationHelper);const $e=new a.InjectionToken("LoginDialogResourceProvider");t.LoginDialogComponent=class LoginDialogComponent{constructor(e,t,i,o,n,s,a,l,d){this.modalRef=e;this.logService=t;this.httpClient=i;this.sessionService=o;this.storageService=n;this.urlUtils=s;this.ssoAuthenticationHelper=a;this.resource=l;this.eventService=d;this.hostClass=true;this.data=null;this.authURIKey="";this.authURI="";this.isFullScreen=false;this.ssoEnabled=false;this.form=new m.FormGroup({username:new m.FormControl("",m.Validators.required),password:new m.FormControl("",m.Validators.required)});this.signinWithSSO=()=>{this.form.setErrors(null);return this.ssoAuthenticationHelper.launchSSODialog().then((e=>this.storeAccessToken(e)),(e=>this.apiAuthenticationFailureReportFactory(e))).then((e=>this.acceptUser(e))).catch((e=>{this.logService.debug(`LoginDialogComponent - signinWithSSO: ${JSON.stringify(e)}`)}))};this.sendCredentials=e=>this.httpClient.request("POST",this.authURI,{headers:(new r.HttpHeaders).set("Content-Type","application/x-www-form-urlencoded"),body:this.urlUtils.getQueryString(e).replace("?",""),observe:"response"}).toPromise()}ngOnInit(){this.data=this.modalRef.data||{};this.authURI=this.data.authURI;this.isFullScreen=this.data.isFullScreen;this.ssoEnabled=this.data.ssoEnabled&&this.isMainEndPoint();this.storageService.removeAuthToken(this.authURI);this.authURIKey=o.from(this.authURI).toString("base64").replace(/=/g,"");if(this.ssoAuthenticationHelper.isAutoSSOMain()){this.signinWithSSO()}}signinWithCredentials(){this.form.setErrors(null);if(this.hasRequiredCredentialsError()){this.form.setErrors({credentialsRequiredError:"se.logindialogform.username.and.password.required"});this.logService.debug(`LoginDialogComponent - signinWithCredentials: hasRequiredCredentialsError`);return Promise.resolve()}const e=Object.assign(Object.assign({},this.data.clientCredentials||{}),{username:this.form.get("username").value,password:this.form.get("password").value,grant_type:"password"});return this.sendCredentials(e).then((e=>this.storeAccessToken(e)),(e=>this.apiAuthenticationFailureReportFactory(e))).then((e=>this.acceptUser(e))).catch((e=>{this.logService.debug(`LoginDialogComponent - signinWithCredentials: ${JSON.stringify(e)}`)}))}isMainEndPoint(){return oe===this.authURI}storeAccessToken(e){const t=e instanceof r.HttpResponse?e.body:e;this.storageService.storeAuthToken(this.authURI,t);this.eventService.publish(pe.TOKEN_STORED);this.logService.debug(`API Authentication Success: ${this.authURI}`);return this.isMainEndPoint()?this.sessionService.hasUserChanged():Promise.resolve(false)}apiAuthenticationFailureReportFactory(e){this.logService.debug(`API Authentication Failure: ${this.authURI} status: ${e.status}`);this.form.setErrors({asyncValidationError:e.error&&e.error.error_description||"se.logindialogform.oauth.error.default"});return Promise.reject(e)}acceptUser(e){this.modalRef.close({userHasChanged:e});if(this.isMainEndPoint()){this.sessionService.setCurrentUsername()}return Promise.resolve({userHasChanged:e})}hasRequiredCredentialsError(){const e=this.form.get("username");const t=this.form.get("password");return e.errors&&e.errors.required||t.errors&&t.errors.required}};__decorate([a.HostBinding("class.su-login-dialog"),__metadata("design:type",Object)],t.LoginDialogComponent.prototype,"hostClass",void 0);t.LoginDialogComponent=__decorate([a.Component({selector:"su-login-dialog",styles:[`.su-login{width:500px;min-height:440px;box-shadow:0 1px 4px 0 rgba(var(--sapBlockLayer_Background) .1);background-color:var(--sapBaseColor);border-radius:4px;border:1px solid rgba(var(--sapContent_ShadowColor),.2);padding:20px;margin:120px auto 0 auto}.su-login--wrapper{padding:40px 100px;width:100%}.su-login--form-group{margin-bottom:20px}.su-login--form-sso{margin-top:20px}.su-login--logo-wrapper{display:flex;justify-content:flex-start;align-items:center}.su-login--logo-wrapper.su-login--logo-wrapper_full{padding-bottom:45px}.su-login--logo{height:44px}.su-login--logo-text{font-family:"72","72full",Arial,Helvetica,sans-serif;font-size:1.5rem;line-height:1.3333333333;font-weight:400;padding-left:16px;color:var(--sapTextColor);font-weight:700}.su-login--logo__best-run{position:absolute;bottom:30px;left:30px}.su-login--btn{font-size:.875rem;line-height:1.4285714286;font-weight:400;width:100%}.su-login--auth-message{padding-top:20px;padding-bottom:20px;font-size:.875rem;line-height:1.4285714286;font-weight:400}.su-login--alert-error{margin-bottom:0;box-shadow:none}`],template:`<div class="su-login-dialog-container"><div class="fd-dialog__content fd-dialog__content--overrides" role="document"><div class="su-login"><div class="su-login--wrapper"><div class="su-login--logo-wrapper" [ngClass]="{ 'su-login--logo-wrapper_full': !isFullScreen }"><img *ngIf="resource?.topLogoURL" [src]="resource?.topLogoURL" class="su-login--logo" title="{{ 'se.logo.title' | translate }}"/> <span class="su-login--logo-text" translate="se.application.name"></span></div><form autocomplete="off" novalidate [formGroup]="form" (submit)="signinWithCredentials()" class="su-login--form"><div class="su-login--auth-message" *ngIf="isFullScreen"><div translate="se.logindialogform.reauth.message1"></div><div translate="se.logindialogform.reauth.message2"></div></div><div *ngIf="form.errors" class="su-login--form-group"><fd-message-strip type="error" class="su-login--alert-error" id="invalidError" [dismissible]="false"><ng-container *ngIf="form.errors?.credentialsRequiredError">{{ form.errors.credentialsRequiredError | translate }}</ng-container><ng-container *ngIf="form.errors?.asyncValidationError">{{ form.errors.asyncValidationError | translate }}</ng-container></fd-message-strip></div><div class="su-login--form-group"><input fd-form-control type="text" id="username_{{ authURIKey }}" name="username" formControlName="username" placeholder="{{ 'se.authentication.form.input.username' | translate }}" autofocus autocomplete="off" class="fd-input"/></div><div class="su-login--form-group"><input fd-form-control type="password" id="password_{{ authURIKey }}" name="password" placeholder="{{ 'se.authentication.form.input.password' | translate }}" formControlName="password" autocomplete="off" required class="fd-input"/></div><div class="su-login--form-group"><su-language-dropdown class="su-login-language"></su-language-dropdown></div><button fd-button options="emphasized" class="fd-button--emphasized su-login--btn" id="submit_{{ authURIKey }}" name="submit" type="submit" label="{{ 'se.authentication.form.button.submit' | translate }}"></button></form><form *ngIf="ssoEnabled" class="su-login--form-sso" name="loginDialogFormSSO" novalidate (submit)="signinWithSSO()"><button fd-button options="emphasized" class="fd-button--emphasized su-login--btn" id="submitSSO_{{ authURIKey }}" name="submitSSO" type="submit" label="{{ 'se.authentication.form.button.submit.sso' | translate }}"></button></form></div></div><img *ngIf="resource?.bottomLogoURL" [src]="resource?.bottomLogoURL" class="su-login--logo__best-run" title="{{ 'se.logo.title' | translate }}"/></div></div>`}),__param(7,a.Optional()),__param(7,a.Inject($e)),__param(8,a.Inject(te)),__metadata("design:paramtypes",[g.DialogRef,LogService,r.HttpClient,ISessionService,IStorageService,UrlUtils,t.SSOAuthenticationHelper,Object,Object])],t.LoginDialogComponent);class ITranslationsFetchService{}t.SUPPORTED_BROWSERS=void 0;(function(e){e[e["IE"]=0]="IE";e[e["CHROME"]=1]="CHROME";e[e["FIREFOX"]=2]="FIREFOX";e[e["EDGE"]=3]="EDGE";e[e["SAFARI"]=4]="SAFARI";e[e["UNKNOWN"]=5]="UNKNOWN"})(t.SUPPORTED_BROWSERS||(t.SUPPORTED_BROWSERS={}));class BrowserService{constructor(){this._isSafari=()=>{const{userAgent:e}=window.navigator;const t=window.navigator.vendor;return t&&t.indexOf("Apple")>-1&&e&&e.indexOf("Safari")>-1};this.isIE=()=>this.getCurrentBrowser()===t.SUPPORTED_BROWSERS.IE;this.isFF=()=>this.getCurrentBrowser()===t.SUPPORTED_BROWSERS.FIREFOX;this.isSafari=()=>this.getCurrentBrowser()===t.SUPPORTED_BROWSERS.SAFARI}getCurrentBrowser(){const e=window;let i=t.SUPPORTED_BROWSERS.UNKNOWN;if(typeof e.InstallTrigger!=="undefined"){i=t.SUPPORTED_BROWSERS.FIREFOX}else if(!!document.documentMode){i=t.SUPPORTED_BROWSERS.IE}else if(!!e.StyleMedia){i=t.SUPPORTED_BROWSERS.EDGE}else if(!!e.chrome&&!!e.chrome.webstore){i=t.SUPPORTED_BROWSERS.CHROME}else if(this._isSafari()){i=t.SUPPORTED_BROWSERS.SAFARI}return i}getBrowserLocale(){const e=window.navigator.language.split("-");return e.length===1?e[0]:`${e[0]}_${e[1].toUpperCase()}`}}class FingerPrintingService{constructor(){this._fingerprint=S.encode(this.getUserAgent()+this.getPlugins()+this.hasJava()+this.hasFlash()+this.hasLocalStorage()+this.hasSessionStorage()+this.hasCookie()+this.getTimeZone()+this.getLanguage()+this.getSystemLanguage()+this.hasCanvas())}getFingerprint(){return this._fingerprint}getUserAgent(){return navigator.userAgent}getPlugins(){const e=[];for(let t=0,i=navigator.plugins.length;t<i;t++){if(navigator.plugins[t]){e.push(navigator.plugins[t].name)}}return e.join(",")}hasJava(){return navigator.javaEnabled()}hasFlash(){return!!navigator.plugins.namedItem("Shockwave Flash")}hasLocalStorage(){try{const e="test-has-ls";localStorage.setItem(e,e);localStorage.removeItem(e);return true}catch(e){return false}}hasSessionStorage(){try{const e="test-has-ss";sessionStorage.setItem(e,e);sessionStorage.removeItem(e);return true}catch(e){return false}}hasCookie(){return navigator.cookieEnabled}getTimeZone(){return String(String(new Date).split("(")[1]).split(")")[0]}getLanguage(){return navigator.language}getSystemLanguage(){return window.navigator.language}hasCanvas(){try{const e=document.createElement("canvas");return!!(e.getContext&&e.getContext("2d"))}catch(e){return false}}}let Ke=class TranslateHttpLoader{constructor(e){this.translationsFetchService=e}getTranslation(e){return l.from(this.translationsFetchService.get(e))}};Ke=__decorate([a.Injectable(),__metadata("design:paramtypes",[ITranslationsFetchService])],Ke);var qe;t.TranslationModule=qe=class TranslationModule{static forChild(){return p.TranslateModule.forChild({isolate:false,loader:{provide:p.TranslateLoader,useClass:Ke}})}static forRoot(e){return{ngModule:qe,providers:[{provide:ITranslationsFetchService,useClass:e},{provide:a.APP_INITIALIZER,useFactory(e,t,i){t.getValueFromLocalStorage("SELECTED_LANGUAGE",false).then((e=>e?e.isoCode:i.getBrowserLocale()),(()=>i.getBrowserLocale())).then((t=>{e.setDefaultLang(t);e.use(t)}));return e=>{}},deps:[p.TranslateService,IStorageService,BrowserService],multi:true}]}}};t.TranslationModule=qe=__decorate([a.NgModule({imports:[p.TranslateModule.forRoot({isolate:false,loader:{provide:p.TranslateLoader,useClass:Ke}})],exports:[p.TranslateModule]})],t.TranslationModule);class LanguageDropdownAdapter{static transform(e,t){return{id:t,label:e.name,value:e}}}t.LanguageService=class LanguageService{constructor(e,t,i,o,n,s,a,r){this.logService=e;this.translateService=t;this.promiseUtils=i;this.eventService=o;this.browserService=n;this.storageService=s;this.injector=a;this.languageServiceConstants=r}getToolingLanguages(){return this.i18nLanguageRestService.get({}).then((e=>e.languages)).catch((e=>{this.logService.error("LanguageService.getToolingLanguages() - Error loading tooling languages");return Promise.reject(e)}))}getBrowserLanguageIsoCode(){return window.navigator.language.split("-")[0]}getBrowserLocale(){return this.browserService.getBrowserLocale()}getResolveLocale(){return this._getDefaultLanguage()}getResolveLocaleIsoCode(){return this.getResolveLocale().then((e=>this.convertBCP47TagToJavaTag(e).split("_")[0]))}setSelectedToolingLanguage(e){this.storageService.setValueInLocalStorage(de,e,false);this.translateService.use(e.isoCode);this.setApplicationTitle();this.eventService.publish(ce,{isoCode:e.isoCode})}registerSwitchLanguage(){this.eventService.subscribe(ce,((e,t)=>{if(this.translateService.currentLang!==t.isoCode){this.translateService.use(t.isoCode)}}))}convertBCP47TagToJavaTag(e){return!!e?e.replace(/-/g,"_"):e}convertJavaTagToBCP47Tag(e){return!!e?e.replace(/_/g,"-"):e}_getDefaultLanguage(){return this.storageService.getValueFromLocalStorage(de,false).then((e=>e?e.isoCode:this.browserService.getBrowserLocale()),(()=>this.browserService.getBrowserLocale()))}setApplicationTitle(){this.translateService.get("se.application.name").subscribe((e=>{document.title=e}))}get i18nLanguageRestService(){return this.injector.get(t.RestServiceFactory).get(this.languageServiceConstants.I18N_LANGUAGES_RESOURCE_URI)}};__decorate([Y({actions:[fe]}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],t.LanguageService.prototype,"getToolingLanguages",null);t.LanguageService=__decorate([a.Injectable(),__param(3,a.Inject(te)),__param(7,a.Inject(ge)),__metadata("design:paramtypes",[LogService,p.TranslateService,t.PromiseUtils,Object,BrowserService,IStorageService,a.Injector,Object])],t.LanguageService);var Ye;(function(e){e["Default"]="default";e["None"]="none"})(Ye||(Ye={}));class LanguageDropdownHelper{static findSelectLanguageWithIsoCodePredicate(e){return t=>t.value.isoCode===e}static findLanguageWithIsoCode(e,t){return t.find((t=>t.isoCode===e))}static order(e,t,i={strategy:Ye.Default}){switch(i.strategy){case Ye.Default:const i=t.filter((t=>t.isoCode!==e.isoCode)).sort(((e,t)=>e.isoCode.localeCompare(t.isoCode)));return[e,...i];case Ye.None:default:return t}}}class LanguageDropdown{constructor(e,t,i){this.languageService=e;this.eventService=t;this.logService=i;this.languageSortStrategy=Ye.Default;this.selectedLanguage=null;this.items=[];this.initialLanguage=null;this.languages=[];this.unRegisterEventService=null}ngOnInit(){Promise.all([this.languageService.getResolveLocale(),this.languageService.getToolingLanguages()]).then((([e,t])=>{this.items=t.map(LanguageDropdownAdapter.transform);this.languages=t;this.setSelectedLanguage(e);this.setInitialLanguage(e)}));this.unRegisterEventService=this.eventService.subscribe(ce,(()=>this.handleLanguageChange()))}ngOnDestroy(){this.unRegisterEventService()}onSelectedLanguage(e){this.languageService.setSelectedToolingLanguage(e.value)}setInitialLanguage(e){this.initialLanguage=this.items.find(LanguageDropdownHelper.findSelectLanguageWithIsoCodePredicate(e))||this.items.find(LanguageDropdownHelper.findSelectLanguageWithIsoCodePredicate(me))}setSelectedLanguage(e){this.selectedLanguage=LanguageDropdownHelper.findLanguageWithIsoCode(e,this.languages);if(this.selectedLanguage){const e=LanguageDropdownHelper.order(this.selectedLanguage,this.languages,{strategy:this.languageSortStrategy});this.items=e.map(LanguageDropdownAdapter.transform);return}this.languageService.getResolveLocaleIsoCode().then((e=>{this.selectedLanguage=LanguageDropdownHelper.findLanguageWithIsoCode(e,this.languages);const t=LanguageDropdownHelper.order(this.selectedLanguage,this.languages,{strategy:this.languageSortStrategy});this.items=t.map(LanguageDropdownAdapter.transform)})).catch((e=>{this.logService.debug(`LanguageDropdown - can't set the language: ${e}`)}))}handleLanguageChange(){this.languageService.getResolveLocale().then((e=>{this.setSelectedLanguage(e)}))}}__decorate([a.Input(),__metadata("design:type",String)],LanguageDropdown.prototype,"languageSortStrategy",void 0);t.LanguageDropdownComponent=class LanguageDropdownComponent extends LanguageDropdown{constructor(e,t,i,o){super(e,t,o);this.eventService=t;this.yjQuery=i;this.logService=o;this.CDKOverlayContainer=".cdk-overlay-container"}ngOnInit(){super.ngOnInit();this.removeAllPopovers()}ngAfterViewChecked(){this.yjQuery(this.CDKOverlayContainer).addClass("cdk-overlay-container-language")}ngOnDestroy(){super.ngOnDestroy();this.yjQuery(this.CDKOverlayContainer).removeClass("cdk-overlay-container-language")}removeAllPopovers(){const e=this.yjQuery(this.CDKOverlayContainer).toArray();if(e.length===0){return}this.yjQuery(".cdk-overlay-connected-position-bounding-box").toArray().forEach((t=>{e[0].removeChild(t)}))}};t.LanguageDropdownComponent=__decorate([a.Component({selector:"su-language-dropdown",template:`\n        <su-select\n            class="su-language-selector"\n            [items]="items"\n            [initialValue]="initialLanguage"\n            (onItemSelected)="onSelectedLanguage($event)">\n        </su-select>\n    `}),__param(0,a.Inject(ue)),__param(1,a.Inject(te)),__param(2,a.Inject(he)),__metadata("design:paramtypes",[t.LanguageService,Object,Function,LogService])],t.LanguageDropdownComponent);class ISelectAdapter{static transform(e,t){return{}}}t.ListItemKeyboardControlDirective=class ListItemKeyboardControlDirective{constructor(e,t){this.hostElement=e;this.renderer=t;this.activeClassName="is-active"}ngOnInit(){this.setTabIndex()}getElement(){return this.hostElement.nativeElement}setActive(){const e=this.getElement();this.renderer.addClass(e,this.activeClassName);e.scrollIntoView({block:"nearest"})}setInactive(){this.renderer.removeClass(this.getElement(),this.activeClassName)}setTabIndex(){this.renderer.setAttribute(this.getElement(),"tabindex","-1")}};t.ListItemKeyboardControlDirective=__decorate([a.Directive({selector:"[suListItemKeyboardControl]"}),__metadata("design:paramtypes",[a.ElementRef,a.Renderer2])],t.ListItemKeyboardControlDirective);var Ze;(function(e){e["ArrowDown"]="ArrowDown";e["ArrowUp"]="ArrowUp";e["Enter"]="Enter";e["Esc"]="Escape"})(Ze||(Ze={}));t.ListKeyboardControlDirective=class ListKeyboardControlDirective{constructor(){this.suListKeyboardControlEnabled=true;this.suListKeyboardControlEnterKeydown=new a.EventEmitter;this.suListKeyboardControlEscKeydown=new a.EventEmitter;this.didNgAfterContentInit=false;this.activeItem=null;this.activeItemIndex=null}onKeyDown(e){if(!this.suListKeyboardControlEnabled||this.items.length===0){return}switch(e.key){case Ze.ArrowDown:e.preventDefault();this.handleArrowDown();return;case Ze.ArrowUp:e.preventDefault();this.handleArrowUp();return;case Ze.Enter:e.preventDefault();this.handleEnter();return;case Ze.Esc:this.handleEsc();return}}ngAfterContentInit(){this.items.changes.subscribe((()=>this.onItemsChange()));this.items.notifyOnChanges();this.didNgAfterContentInit=true}ngOnChanges(e){if(!this.didNgAfterContentInit){return}const t=e.suListKeyboardControlEnabled;const i=e.suListKeyboardControlDisabledPredicate;const o=t&&t.currentValue&&!t.previousValue;const n=t&&!t.currentValue&&t.previousValue;const s=i&&i.currentValue&&!!this.suListKeyboardControlEnabled;const a=i&&!i.currentValue&&i.previousValue&&!!this.suListKeyboardControlEnabled;if(this.items.length===0){return}if(o||s){this.setFirstItemActive()}if(n||a){this.unsetActiveItem()}}onItemsChange(){if(this.items.length===0){this.clearActiveItem();return}if(this.suListKeyboardControlEnabled){if(!this.isActiveItemSet()){this.setActiveItemByIndex(0,1)}else if(!this.itemExistsByIndex(this.activeItemIndex)){this.clearActiveItem()}}else{this.clearActiveItem()}}handleArrowUp(){this.setPreviousItemActive()}handleArrowDown(){this.setNextItemActive()}handleEnter(){this.suListKeyboardControlEnterKeydown.emit(this.activeItemIndex)}handleEsc(){this.suListKeyboardControlEscKeydown.emit()}getItemByIndex(e){const t=this.getItemsArray();return t[e]}getItemsArray(){return this.items.toArray()}setActiveItemByIndex(e,t){const i=this.getItemsArray();if(this.suListKeyboardControlDisabledPredicate){while(this.suListKeyboardControlDisabledPredicate(i[e],e)){e+=t;if(!i[e]){return}}}const o=this.getItemByIndex(e);this.setActiveItem(o)}setActiveItem(e){const t=this.getItemsArray();const i=t.indexOf(e);if(this.activeItem){this.activeItem.setInactive()}if(t.length>0){this.activeItem=t[i];this.activeItem.setActive();this.activeItemIndex=i}}unsetActiveItem(){if(!this.activeItem){return}this.activeItem.setInactive();this.activeItemIndex=null}setFirstItemActive(){this.setActiveItemByIndex(0,1)}setNextItemActive(){if(this.activeItemIndex===null){this.setFirstItemActive();return}if(this.activeItemIndex<this.items.length-1){this.setActiveItemByIndex(this.activeItemIndex+1,1)}}setPreviousItemActive(){if(this.activeItemIndex===null){this.setFirstItemActive();return}if(this.activeItemIndex>0){this.setActiveItemByIndex(this.activeItemIndex-1,-1)}}itemExistsByIndex(e){if(e===null){return false}return!!this.getItemByIndex(e)}clearActiveItem(){this.activeItem=null;this.activeItemIndex=null}isActiveItemSet(){return!!this.activeItem}};__decorate([a.Input(),__metadata("design:type",Object)],t.ListKeyboardControlDirective.prototype,"suListKeyboardControlEnabled",void 0);__decorate([a.Input(),__metadata("design:type",Function)],t.ListKeyboardControlDirective.prototype,"suListKeyboardControlDisabledPredicate",void 0);__decorate([a.Output(),__metadata("design:type",Object)],t.ListKeyboardControlDirective.prototype,"suListKeyboardControlEnterKeydown",void 0);__decorate([a.Output(),__metadata("design:type",Object)],t.ListKeyboardControlDirective.prototype,"suListKeyboardControlEscKeydown",void 0);__decorate([a.ContentChildren(t.ListItemKeyboardControlDirective),__metadata("design:type",a.QueryList)],t.ListKeyboardControlDirective.prototype,"items",void 0);__decorate([a.HostListener("document:keydown",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[KeyboardEvent]),__metadata("design:returntype",void 0)],t.ListKeyboardControlDirective.prototype,"onKeyDown",null);t.ListKeyboardControlDirective=__decorate([a.Directive({selector:"[suListKeyboardControl]"})],t.ListKeyboardControlDirective);t.ListKeyboardControlModule=class ListKeyboardControlModule{};t.ListKeyboardControlModule=__decorate([a.NgModule({declarations:[t.ListKeyboardControlDirective,t.ListItemKeyboardControlDirective],exports:[t.ListKeyboardControlDirective,t.ListItemKeyboardControlDirective]})],t.ListKeyboardControlModule);var Xe;t.SelectComponent=Xe=class SelectComponent extends BaseValueAccessor{constructor(){super(...arguments);this.items=[];this.initialValue=null;this.placeholder="";this.isKeyboardControlEnabled=true;this.hasCustomTrigger=false;this.onItemSelected=new a.EventEmitter;this.isOpen=false}selectItem(e){const t=this.items.find((t=>t.id===e));this.setValue(t);this.isOpen=false;this.onItemSelected.emit(t)}ngOnChanges(e){if(e.initialValue&&e.initialValue.currentValue&&!this.value){this.setInitialValue(e.initialValue.currentValue)}}setInitialValue(e){if(typeof e==="number"){this.setValueById(e)}else{this.setValue(e)}}setValue(e){this.writeValue(e);this.onChange(e)}setValueById(e){this.setValue(this.items.find((t=>t.id===e)))}};__decorate([a.Input(),__metadata("design:type",Array)],t.SelectComponent.prototype,"items",void 0);__decorate([a.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"initialValue",void 0);__decorate([a.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"placeholder",void 0);__decorate([a.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"isKeyboardControlEnabled",void 0);__decorate([a.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"hasCustomTrigger",void 0);__decorate([a.Output(),__metadata("design:type",a.EventEmitter)],t.SelectComponent.prototype,"onItemSelected",void 0);t.SelectComponent=Xe=__decorate([a.Component({selector:"su-select",encapsulation:a.ViewEncapsulation.None,providers:[{provide:m.NG_VALUE_ACCESSOR,useExisting:a.forwardRef((()=>Xe)),multi:true}],styles:[`.su-select,.su-select__popover-control,.su-select__popover-control .fd-dropdown{width:100%}.su-select__popover-control .fd-dropdown__control{overflow:hidden;color:var(--sapNeutralColor);text-align:left;padding:0 .625rem;justify-content:space-between}.su-select__popover-control .fd-dropdown__control:focus{outline:0!important}.su-select__popover-control .fd-dropdown__control:focus:after{border-style:none}.su-select__popover-control .fd-dropdown__control::after{position:absolute;top:0;right:0;display:flex;justify-content:center;align-items:center;padding:0;height:36px;width:36px;margin-top:0;font-size:14px}.su-select__menu .fd-list{max-height:200px;overflow:auto}.su-select__menu .fd-list .fd-list__title{padding:.5rem}.su-select__menu .fd-list__item[select-highlighted]{background:se-color-state("selected")}.su-select__menu .fd-list__item[select-highlighted]:focus{outline:0}.su-select__popover-control .se-select-arrow{position:absolute;right:0;border-left-color:inherit;border-left-style:solid;border-left-width:1px;border-top-left-radius:unset;border-bottom-left-radius:unset}`],template:`\n        <fd-popover [(isOpen)]="isOpen" fillControlMode="equal" class="su-select">\n            <fd-popover-control class="su-select__popover-control">\n                <button\n                    fd-button\n                    aria-expanded="true"\n                    class="fd-dropdown__control fd-button fd-select__control"\n                    type="button"\n                    *ngIf="!hasCustomTrigger; else customTrigger"\n                    label="{{ (value && value.label) || placeholder | translate }}">\n                    <span class="fd-button fd-button--transparent se-select-arrow">\n                        <i class="sap-icon--slim-arrow-down"></i>\n                    </span>\n                </button>\n                <ng-template #customTrigger>\n                    <ng-content select="[su-select-custom-trigger]"></ng-content>\n                </ng-template>\n            </fd-popover-control>\n            <fd-popover-body>\n                <div class="su-select__menu">\n                    <ul\n                        fd-list\n                        suListKeyboardControl\n                        [suListKeyboardControlEnabled]="isKeyboardControlEnabled && isOpen"\n                        (suListKeyboardControlEnterKeydown)="selectItem($event)"\n                        class="fd-list--dropdown">\n                        <li\n                            fd-list-item\n                            suListItemKeyboardControl\n                            [ngClass]="item.listItemClassName"\n                            *ngFor="let item of items"\n                            (click)="selectItem(item.id)"\n                            [attr.tabindex]="-1"\n                            [attr.data-select-id]="item.id"\n                            role="option">\n                            <a fd-list-link>\n                                <span fd-list-title> {{ item.label | translate }} </span>\n                            </a>\n                        </li>\n                    </ul>\n                </div>\n            </fd-popover-body>\n        </fd-popover>\n    `})],t.SelectComponent);t.SelectModule=class SelectModule{};t.SelectModule=__decorate([a.NgModule({imports:[g.FundamentalNgxCoreModule,u.CommonModule,t.ListKeyboardControlModule,t.TranslationModule.forChild(),h.ListModule],declarations:[t.SelectComponent],entryComponents:[t.SelectComponent],exports:[t.SelectComponent]})],t.SelectModule);t.LanguageDropdownModule=class LanguageDropdownModule{};t.LanguageDropdownModule=__decorate([a.NgModule({imports:[u.CommonModule,t.SelectModule],declarations:[t.LanguageDropdownComponent],entryComponents:[t.LanguageDropdownComponent],exports:[t.LanguageDropdownComponent]})],t.LanguageDropdownModule);t.LoginDialogModule=class LoginDialogModule{};t.LoginDialogModule=__decorate([a.NgModule({imports:[u.CommonModule,t.LanguageDropdownModule,m.FormsModule,m.ReactiveFormsModule,g.MessageStripModule,t.TranslationModule.forChild(),g.ButtonModule,g.FormModule],declarations:[t.LoginDialogComponent],entryComponents:[t.LoginDialogComponent],exports:[t.LanguageDropdownModule]})],t.LoginDialogModule);t.AuthenticationService=class AuthenticationService extends IAuthenticationService{constructor(e,t,i,o,n,s,a,r,l){super();this.translationsFetchService=e;this.modalService=t;this.sharedDataService=i;this.storageService=o;this.eventService=n;this.ssoAuthenticationHelper=s;this.settingsService=a;this.authenticationManager=r;this.logService=l}filterEntryPoints(e){return this.sharedDataService.get("authenticationMap").then((t=>E.convertToArray(Object.assign(Object.assign({},t||{}),ae)).filter((t=>new RegExp(t.key,"g").test(e))).map((e=>e.value))))}isAuthEntryPoint(e){return this.sharedDataService.get("authenticationMap").then((t=>{const i=E.convertToArray(t||{}).map((e=>e.value));return i.indexOf(e)>-1||e===oe}))}authenticate(e){return this._findLoginData(e).then((e=>this._launchAuth(e).then((t=>{Promise.resolve(this.eventService.publish(pe.AUTHORIZATION_SUCCESS,{userHasChanged:t.userHasChanged})).then((()=>{if(t.userHasChanged){this.eventService.publish(pe.USER_HAS_CHANGED)}const e=v.values(this.reauthInProgress).some((e=>e));if(t.userHasChanged&&!e&&this.authenticationManager&&this.authenticationManager.onUserHasChanged){this.authenticationManager.onUserHasChanged()}})).catch((e=>{this.logService.debug(`AuthenticationService - authenticate: ${JSON.stringify(e)}`)}));this.reauthInProgress[e.authURI]=false}))))}logout(){return this.eventService.publish(pe.LOGOUT).then((()=>{this.storageService.removeAllAuthTokens();if(this.ssoAuthenticationHelper.isAutoSSOMain()){this.ssoAuthenticationHelper.logout()}else if(this.authenticationManager&&this.authenticationManager.onLogout){this.authenticationManager.onLogout()}}))}isReAuthInProgress(e){return Promise.resolve(this.reauthInProgress[e]===true)}setReAuthInProgress(e){this.reauthInProgress[e]=true;return Promise.resolve()}isAuthenticated(e){return this.filterEntryPoints(e).then((e=>{const t=e&&e[0];return Promise.resolve(this.storageService.getAuthToken(t)).then((e=>!!e))}))}_findLoginData(e){return this.filterEntryPoints(e).then((e=>Promise.resolve(this.sharedDataService.get("credentialsMap").then((t=>{const i=Object.assign(Object.assign({},t||{}),re);const o=e[0];return{authURI:o,clientCredentials:i[o]}})))))}_launchAuth(e){return this.translationsFetchService.waitToBeReady().then((()=>Promise.all([this.storageService.isInitialized(),this.settingsService.getBoolean("smartedit.sso.enabled")]))).then((([i,o])=>{const n=this.modalService.open({component:t.LoginDialogComponent,data:Object.assign(Object.assign({},e),{isFullScreen:i,ssoEnabled:o}),config:{hasBackdrop:false}});return new Promise(((e,t)=>{n.afterClosed.subscribe(e,t)}))}))}};t.AuthenticationService=__decorate([__param(4,a.Inject(te)),__param(7,a.Optional()),__metadata("design:paramtypes",[ITranslationsFetchService,IModalService,ISharedDataService,IStorageService,Object,t.SSOAuthenticationHelper,ISettingsService,IAuthenticationManagerService,LogService])],t.AuthenticationService);t.ModalManagerService=class ModalManagerService{constructor(e){this.modalRef=e;this.title=new l.BehaviorSubject("");this.titleSuffix=new l.BehaviorSubject("");this.modalData=new l.BehaviorSubject({});this.component=new l.BehaviorSubject(undefined);this.isDismissButtonVisible=new l.BehaviorSubject(false);this.buttons=new l.BehaviorSubject([])}init(){this.modalData.next(this.modalRef.data.modalData);this.component.next(this.modalRef.data.component);this.buttons.next(this.modalRef.data.templateConfig.buttons||[]);this.title.next(this.modalRef.data.templateConfig.title||"");this.titleSuffix.next(this.modalRef.data.templateConfig.titleSuffix||"");this.isDismissButtonVisible.next(this.modalRef.data.templateConfig.isDismissButtonVisible)}getComponent(){return this.component.asObservable()}getTitle(){return this.title.asObservable()}getTitleSuffix(){return this.titleSuffix.asObservable()}getButtons(){return this.buttons.asObservable()}getModalData(){return this.modalData.asObservable()}getIsDismissButtonVisible(){return this.isDismissButtonVisible.asObservable()}setDismissButtonVisibility(e){this.isDismissButtonVisible.next(e)}setTitle(e){this.title.next(e)}addButton(e){this.getButtonsValue().subscribe((t=>{const i=[...t,e];this.buttons.next(i)}))}addButtons(e){this.getButtonsValue().subscribe((t=>{const i=[...t,...e];this.buttons.next(i)}))}removeButton(e){this.getButtonsValue().subscribe((t=>{const i=t.filter((t=>t.id!==e));this.buttons.next(i)}))}removeAllButtons(){this.buttons.next([])}disableButton(e){this.getButtonsValue().subscribe((t=>{const i=t.map((t=>t.id===e?Object.assign(Object.assign({},t),{disabled:true}):t));this.buttons.next(i)}))}setDismissCallback(e){this.dismissCallback=e}enableButton(e){this.getButtonsValue().subscribe((t=>{const i=t.map((t=>t.id===e?Object.assign(Object.assign({},t),{disabled:false}):t));this.buttons.next(i)}))}onButtonClicked(e){const i=e.callback?e.callback():l.of(null);if(e.action!==t.ModalButtonAction.None){i.subscribe((i=>e.action===t.ModalButtonAction.Close?this.close(i):this.dismiss(i)))}}close(e){this.modalRef.close(e)}dismiss(e){this.dismissCallback().then((()=>this.modalRef.dismiss(e))).catch(n.noop)}getButtonsValue(){return this.buttons.pipe(d.take(1))}dismissCallback(){return Promise.resolve()}};t.ModalManagerService=__decorate([a.Injectable(),__metadata("design:paramtypes",[g.DialogRef])],t.ModalManagerService);t.ModalTemplateComponent=class ModalTemplateComponent{constructor(e,t){this.modalManager=e;this.cdr=t;this.component$=this.modalManager.getComponent();this.title$=this.modalManager.getTitle();this.titleSuffix$=this.modalManager.getTitleSuffix();this.isDismissButtonVisible$=this.modalManager.getIsDismissButtonVisible();this.buttons$=this.modalManager.getButtons()}ngOnInit(){this.modalManager.init();this.buttonsSubscription=this.buttons$.subscribe((e=>{this.buttons=e;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}ngOnDestroy(){if(this.buttonsSubscription){this.buttonsSubscription.unsubscribe()}}onButtonClicked(e){this.modalManager.onButtonClicked(e)}dismiss(){this.modalManager.dismiss()}};t.ModalTemplateComponent=__decorate([a.Component({selector:"fundamental-modal-template",encapsulation:a.ViewEncapsulation.None,providers:[t.ModalManagerService],styles:[`\n            .fd-dialog__title {\n                min-height: 20px;\n            }\n        `],template:`\n        <fd-dialog>\n            <fd-dialog-header>\n                <h1 fd-title id="fd-title-{{ (title$ | async) || '' }}">\n                    {{ (title$ | async) || '' | translate }}\n                    {{ (titleSuffix$ | async) || '' | translate }}\n                </h1>\n                <button\n                    fd-dialog-close-button\n                    *ngIf="isDismissButtonVisible$ | async"\n                    (click)="dismiss()"\n                    class="fd-button fd-button--transparent fd-dialog__close"\n                    title="{{ 'se.btn.close.title' | translate }}"></button>\n            </fd-dialog-header>\n            <fd-dialog-body>\n                <ng-container *ngIf="component$ | async as component">\n                    <ng-container *ngComponentOutlet="component"></ng-container>\n                </ng-container>\n            </fd-dialog-body>\n            <fd-dialog-footer *ngIf="buttons && buttons.length > 0">\n                <button\n                    *ngFor="let button of buttons"\n                    [disabled]="button.disabledFn ? button.disabledFn!() : button.disabled"\n                    [fdType]="button.style"\n                    [attr.id]="button.id"\n                    [label]="button.label | translate"\n                    (click)="onButtonClicked(button)"\n                    fd-button></button>\n            </fd-dialog-footer>\n        </fd-dialog>\n    `}),__metadata("design:paramtypes",[t.ModalManagerService,a.ChangeDetectorRef])],t.ModalTemplateComponent);t.FundamentalModalTemplateModule=class FundamentalModalTemplateModule{};t.FundamentalModalTemplateModule=__decorate([a.NgModule({imports:[u.CommonModule,_.DialogModule,g.ButtonModule,t.TranslationModule.forChild()],declarations:[t.ModalTemplateComponent],entryComponents:[t.ModalTemplateComponent],exports:[t.ModalTemplateComponent]})],t.FundamentalModalTemplateModule);t.ModalService=class ModalService{constructor(e){this.fundamentalModalService=e}open(e){const{templateConfig:t}=e;return!!t?this.openWithTemplate(e):this.openStandalone(e)}hasOpenModals(){return this.fundamentalModalService.hasOpenDialogs()}dismissAll(){this.fundamentalModalService.dismissAll()}openStandalone(e){const{config:t={},component:i,data:o}=e;return this.fundamentalModalService.open(i,Object.assign(Object.assign({},t),{data:o}))}openWithTemplate(e){const{config:i={},templateConfig:o={},component:n,data:s}=e;const a=Object.assign(Object.assign({},i),{data:{templateConfig:o,component:n,modalData:s}});return this.fundamentalModalService.open(t.ModalTemplateComponent,a)}};t.ModalService=__decorate([a.Injectable(),__metadata("design:paramtypes",[g.DialogService])],t.ModalService);class Alert{constructor(e,t,i,o){this._alertConf=e;this.fundamentalAlertService=i;this.translateService=o;this._displayed=false;v.defaultsDeep(this._alertConf,v.cloneDeep(t))}get alertConf(){return this._alertConf}get message(){return this._alertConf.message}get type(){return this._alertConf.type}show(){return __awaiter(this,void 0,void 0,(function*(){if(this.isDisplayed()){return}if(this._alertConf.message){this._alertConf.message=yield this.translateService.get(this._alertConf.message,this._alertConf.messagePlaceholders).toPromise()}const e=typeof this._alertConf.message!=="undefined"?this._alertConf.message:this._alertConf.component||"";this._alertRef=this.fundamentalAlertService.open(e,this._alertConf);this._alertRef.afterDismissed.subscribe((()=>this._displayed=false));this._displayed=true}))}hide(){if(!this.isDisplayed()){return}this._alertRef.dismiss()}isDisplayed(){return this._displayed}}const Qe=new a.InjectionToken("alertConfigToken");const Je={data:{},type:t.IAlertServiceType.INFO,dismissible:true,duration:1e3,width:"300px",minWidth:"",mousePersist:true};t.AlertFactory=class AlertFactory{constructor(e,t,i){this.fundamentalAlertService=e;this.translateService=t;this.ALERT_CONFIG_DEFAULTS=i}createAlert(e){const t=this.getAlertConfig(e);return this.createAlertObject(t)}createInfo(e){const i=this.getAlertConfig(e,t.IAlertServiceType.INFO);return this.createAlertObject(i)}createDanger(e){const i=this.getAlertConfig(e,t.IAlertServiceType.DANGER);return this.createAlertObject(i)}createWarning(e){const i=this.getAlertConfig(e,t.IAlertServiceType.WARNING);return this.createAlertObject(i)}createSuccess(e){const i=this.getAlertConfig(e,t.IAlertServiceType.SUCCESS);return this.createAlertObject(i)}getAlertConfig(e,i){if(typeof e==="string"){return{message:e,type:i||t.IAlertServiceType.INFO,minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"}}if(!e.type){e.type=i||t.IAlertServiceType.INFO}return e}createAlertObject(e){return new Alert(e,this.ALERT_CONFIG_DEFAULTS,this.fundamentalAlertService,this.translateService)}};t.AlertFactory=__decorate([a.Injectable(),__param(2,a.Inject(Qe)),__metadata("design:paramtypes",[g.AlertService,p.TranslateService,g.AlertConfig])],t.AlertFactory);t.AlertService=class AlertService{constructor(e){this.alertFactory=e}showAlert(e){const t=this.alertFactory.createAlert(e);t.show()}showInfo(e){const t=this.alertFactory.createInfo(e);t.show()}showDanger(e){const t=this.alertFactory.createDanger(e);t.show()}showWarning(e){const t=this.alertFactory.createWarning(e);t.show()}showSuccess(e){const t=this.alertFactory.createSuccess(e);t.show()}};t.AlertService=__decorate([a.Injectable(),__metadata("design:paramtypes",[t.AlertFactory])],t.AlertService);t.AlertModule=class AlertModule{};t.AlertModule=__decorate([a.NgModule({imports:[g.AlertModule,t.TranslationModule],providers:[{provide:Qe,useValue:Je},t.AlertService,t.AlertFactory]})],t.AlertModule);t.FileReaderService=class FileReaderService{read(e,t){const i=new FileReader;if(t===null||t===void 0?void 0:t.onError){i.onerror=t.onError}if(t===null||t===void 0?void 0:t.onLoadEnd){i.onloadend=t.onLoadEnd}i.readAsArrayBuffer(e);return i}};t.FileReaderService=__decorate([a.Injectable()],t.FileReaderService);t.FileMimeTypeService=class FileMimeTypeService{constructor(e,t){this.fileReaderService=e;this.settingsService=t}isFileMimeTypeValid(e){return new Promise(((t,i)=>__awaiter(this,void 0,void 0,(function*(){const{error:o,data:n}=yield L.attempt(this.settingsService.getStringList("smartedit.validFileMimeTypeCodes"));if(o){i(false);return}this.fileReaderService.read(e,{onLoadEnd:e=>{if(!this.validateMimeTypeFromFile(e.target.result,n)){i();return}t(true)},onError:()=>{i()}})}))))}validateMimeTypeFromFile(e,t){const i=new Uint8Array(e).subarray(0,32);const o=i.reduce(((e,t)=>{let i=t.toString(16);if(i.length===1){i="0"+i}e+=i;return e}),"");return t.some((e=>o.toLowerCase().includes(e.toLowerCase())))}};t.FileMimeTypeService=__decorate([a.Injectable(),__metadata("design:paramtypes",[t.FileReaderService,ISettingsService])],t.FileMimeTypeService);class FileValidatorFactory{build(e){return{validate:(t,i,o)=>this.validate(e,t,i,o)}}validate(e,t,i,o){o=o||[];e.forEach((e=>{const n=t[e.subject];if(!e.validate(n,i)){o.push({subject:e.subject,message:e.message})}}));return o.length===0}}class InputPropertyChange{constructor(e,t){this.key=e;this.value=t}}class InputProperties{constructor(e={}){this.changes=new l.Subject;this._map=new Map(n.toPairs(e))}get(e){return this._map.get(e)}set(e,t,i=true){this._map.set(e,t);if(i){this.changes.next(new InputPropertyChange(e,t))}}}class ValidatorParameters{constructor(e={},t={}){this.validators={};this.asyncValidators={};this.validators=this._omitUndefinedValues(e);this.asyncValidators=this._omitUndefinedValues(t)}has(e){return this.validators.hasOwnProperty(e)}get(e){if(!this.has(e)){return null}return this.validators[e]}hasAsync(e){return this.asyncValidators.hasOwnProperty(e)}getAsync(e){if(!this.hasAsync(e)){return null}return this.asyncValidators[e]}_omitUndefinedValues(e){return n.omitBy(e,n.isUndefined)}}class FormField extends m.FormControl{constructor(e={},t={},{component:i,inputs:o=new InputProperties,validatorParams:n=new ValidatorParameters,persist:s=true}){super(e,t);this.component=i;this.inputs=o;this.inputChanges=o.changes;this.validatorParams=n;this.persist=s}setInput(e,t){this.inputs.set(e,t)}getInput(e){return this.inputs.get(e)}getPersistedValue(){if(!this.persist){return undefined}return this.value===undefined?null:this.value}}class FormGrouping extends m.FormGroup{constructor(e,t={},{component:i,inputs:o=new InputProperties,validatorParams:n=new ValidatorParameters,persist:s=true}){super(e,t);this.component=i;this.inputs=o;this.inputChanges=o.changes;this.validatorParams=n;this.persist=s}setInput(e,t){this.inputs.set(e,t)}getInput(e){return this.inputs.get(e)}setNestedErrors(e=[]){e.forEach((([e,t])=>{const i=this.get(e);if(!i){throw new Error(`FormGrouping - Path not found when setting nested error: ${e}`)}i.setErrors(t)}))}getPersistedValue(){return Object.keys(this.controls).reduce(((e,t)=>{const i=this.controls[t];if(!i.persist){return Object.assign(Object.assign({},e),i.getPersistedValue())}e[t]=i.getPersistedValue();return e}),{})}}class FormList extends m.FormArray{constructor(e,t={},{component:i,inputs:o=new InputProperties,validatorParams:n=new ValidatorParameters,persist:s=true}){super(e,t);this.component=i;this.inputs=o;this.inputChanges=o.changes;this.validatorParams=n;this.persist=s}setInput(e,t){this.inputs.set(e,t)}getInput(e){return this.inputs.get(e)}getPersistedValue(){return this.controls.reduce(((e,t)=>{if(!t.persist){return e.concat(n.values(t.getPersistedValue()))}e.push(t.getPersistedValue());return e}),[])}size(){return this.controls.length}swapFormElements(e,t){if(!this._isInBounds(e)||!this._isInBounds(t)||e===t){return}const i=this.at(e);this.insert(e,this.at(t));this.insert(t,i)}moveFormElement(e,t){if(!this._isInBounds(e)||!this._isInBounds(t)||e===t){return}const i=t<e?-1:1;const o=this.at(e);for(let o=e;(o-t)*i<0;o+=i){const e=o+i;this.setControl(o,this.at(e))}this.setControl(t,o)}_isInBounds(e){return e<this.controls.length&&e>=0}}const et=Symbol("_form_prop_");class PropDecorator{constructor(e){this.property=e}}class InputPropDecorator extends PropDecorator{constructor(e,t){super(e);this.alias=t?t:this.property}}class FormPropDecorator extends PropDecorator{}function makePropertyDecorator(e){return(t,i)=>{const o=t.constructor;if(!o[et]){o[et]=[]}o[et].push(e(i))}}function DynamicForm(){return makePropertyDecorator((e=>new FormPropDecorator(e)))}const DynamicInput=(e=null)=>makePropertyDecorator((t=>new InputPropDecorator(t,e)));t.FormListerComponent=class FormListerComponent{get forms(){return n.values(this.form.controls)}};__decorate([DynamicForm(),__metadata("design:type",FormGrouping)],t.FormListerComponent.prototype,"form",void 0);t.FormListerComponent=__decorate([a.Component({selector:"form-lister",styles:[`\n            :host {\n                display: block;\n            }\n        `],template:`<ng-template [formRenderer]="form" *ngFor="let form of forms"></ng-template>`})],t.FormListerComponent);const onChange=({changeDetectorRef:e,instance:t})=>{t.onDynamicInputChange&&t.onDynamicInputChange();e.markForCheck()};const decorate=(e,t)=>{const i=e.instance;const o=i.constructor[et];if(!Array.isArray(o)){return new l.Subscription}const n=new Map;o.forEach((e=>{const o=e.property;if(e instanceof InputPropDecorator){const s=e.alias;if(t.getInput(s)===undefined&&i[o]!==undefined){t.setInput(s,i[o])}i[o]=t.getInput(s);n.set(s,e)}else if(e instanceof FormPropDecorator){i[o]=t}}));onChange(e);return t.inputChanges.subscribe((({key:t,value:o})=>{const s=n.get(t);if(!s){return}i[s.property]=o;onChange(e)}))};t.FormRendererDirective=class FormRendererDirective{constructor(e,t){this.componentFactoryResolver=e;this.viewContainerRef=t}set form(e){this._dispose();const t=this.componentFactoryResolver.resolveComponentFactory(e.component);const i=this.viewContainerRef.createComponent(t);this._subscription=decorate(i,e)}ngOnDestroy(){this._dispose()}_dispose(){this._subscription&&this._subscription.unsubscribe();this.viewContainerRef.clear()}};__decorate([a.Input("formRenderer"),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],t.FormRendererDirective.prototype,"form",null);t.FormRendererDirective=__decorate([a.Directive({selector:"[formRenderer]"}),__metadata("design:paramtypes",[a.ComponentFactoryResolver,a.ViewContainerRef])],t.FormRendererDirective);const tt=new a.InjectionToken("COMPONENT_MAP");const it=new a.InjectionToken("ASYNC_VALIDATOR_MAP");const ot=new a.InjectionToken("VALIDATOR_MAP");var nt;t.FormBuilderModule=nt=class FormBuilderModule{static forRoot(e){return{ngModule:nt,providers:[{provide:a.ANALYZE_FOR_ENTRY_COMPONENTS,useValue:[e.types],multi:true},{provide:tt,useValue:e.types},{provide:ot,useValue:e.validators},{provide:it,useValue:e.asyncValidators}]}}};t.FormBuilderModule=nt=__decorate([a.NgModule({imports:[u.CommonModule,m.ReactiveFormsModule],declarations:[t.FormRendererDirective,t.FormListerComponent],entryComponents:[t.FormListerComponent],exports:[t.FormRendererDirective]})],t.FormBuilderModule);class Registry{constructor(e={}){this._map=new Map(n.toPairs(e))}add(e,t){if(this._map.has(e)){throw new Error(`${this._service}: is overriding an element named '${e}' in its registry.`)}this._map.set(e,t)}get(e){if(!this._map.has(e)){throw new Error(`${this._service}: does not have '${e}' in its registry.`)}return this._map.get(e)}get _service(){return this.constructor.name}}t.ComponentRegistryService=class ComponentRegistryService extends Registry{constructor(e){super(e)}};t.ComponentRegistryService=__decorate([a.Injectable({providedIn:"root"}),__param(0,a.Optional()),__param(0,a.Inject(tt)),__metadata("design:paramtypes",[Object])],t.ComponentRegistryService);t.AsyncValidatorRegistryService=class AsyncValidatorRegistryService extends Registry{constructor(e){super(e)}};t.AsyncValidatorRegistryService=__decorate([a.Injectable({providedIn:"root"}),__param(0,a.Optional()),__param(0,a.Inject(it)),__metadata("design:paramtypes",[Object])],t.AsyncValidatorRegistryService);t.ValidatorRegistryService=class ValidatorRegistryService extends Registry{constructor(e){super(e)}};t.ValidatorRegistryService=__decorate([a.Injectable({providedIn:"root"}),__param(0,a.Optional()),__param(0,a.Inject(ot)),__metadata("design:paramtypes",[Object])],t.ValidatorRegistryService);t.SchemaCompilerService=class SchemaCompilerService{constructor(e,t,i){this.types=e;this.validators=t;this.asyncValidators=i}compileGroup(e,i,o={}){const n=Object.keys(i.schemas).reduce(((t,n)=>{t[n]=this._toAbstractForm(e?e[n]:null,i.schemas[n],o);return t}),{});return new FormGrouping(n,this._getValidators(i,o),{component:i.component?this._getComponent(i.component,o.components):t.FormListerComponent,inputs:new InputProperties(i.inputs),validatorParams:new ValidatorParameters(i.validators,i.asyncValidators),persist:this._toPersist(i.persist)})}compileList(e,t,i={}){const o=Array.isArray(t.schema)?t.schema:[t.schema];if(!o.length){throw Error("SchemaCompilerService - One or more schemas must be provided to compile a form list.")}const n=(Array.isArray(e)?e:[]).map(((e,t)=>{const n=o[t]?o[t]:o[o.length-1];return this._toAbstractForm(e,n,i)}));return new FormList(n,this._getValidators(t,i),{component:this._getComponent(t.component,i.components),inputs:new InputProperties(t.inputs),validatorParams:new ValidatorParameters(t.validators,t.asyncValidators),persist:this._toPersist(t.persist)})}compileField(e,t,i={}){return new FormField({value:e,disabled:t.disabled},this._getValidators(t,i),{component:this._getComponent(t.component,i.components),inputs:new InputProperties(t.inputs),validatorParams:new ValidatorParameters(t.validators,t.asyncValidators),persist:this._toPersist(t.persist)})}_getValidators(e,t={}){let i=[];let o=[];if(e.validators){i=this._mapValidator(e.validators,this.validators,t.validators)}if(e.asyncValidators){o=this._mapValidator(e.asyncValidators,this.asyncValidators,t.asyncValidators)}return{validators:i,asyncValidators:o}}_toAbstractForm(e,t,i){if(t.type==="field"){return this.compileField(e,t,i)}if(t.type==="group"){return this.compileGroup(e,t,i)}return this.compileList(e,t,i)}_mapValidator(e,t,i={}){return Object.keys(e).reduce(((o,n)=>{const s=e[n];if(s!==undefined){const e=i[n]?i[n]:t.get(n);if(!e){throw new Error(`SchemaCompilerService - Validator not found in ${this.validators.constructor.name} for: ${n}.`)}o.push(e(s))}return o}),[])}_toPersist(e=true){return e}_getComponent(e,t={}){const i=t[e]?t[e]:this.types.get(e);if(!i){throw new Error(`SchemaCompilerService - Did not find component for: ${e}.`)}return i}};t.SchemaCompilerService=__decorate([a.Injectable({providedIn:t.FormBuilderModule}),__metadata("design:paramtypes",[t.ComponentRegistryService,t.ValidatorRegistryService,t.AsyncValidatorRegistryService])],t.SchemaCompilerService);const getPersistenceMap=(e,t={},i=[],o=[])=>{if(e instanceof FormField){if(e.persist){t[i.join(".")]=o}return t}if(e instanceof FormList||e instanceof FormGrouping){if(e.persist&&i.length){t[i.join(".")]=o}Object.keys(e.controls).forEach((n=>{const s=e.controls[n];const a=[...o,n];if(s.persist){return getPersistenceMap(s,t,[...i,n],a)}return getPersistenceMap(s,t,i,a)}))}return t};const toFormValue=(e,t)=>{if(t.type==="field"){return e}if(t.type==="group"){return processGroupSchema(e,t)}return processListSchema(e,t)};const processGroupSchema=(e,t)=>{const i={};Object.keys(t.schemas).forEach((o=>{const n=getInnerData(e,o,t.schemas[o].type);i[o]=toFormValue(n,t.schemas[o])}));return i};const processListSchema=(e,t)=>{const i=t;const o=[];const n=Array.isArray(e)?e:[];const s=Array.isArray(i.schema)?i.schema:[i.schema];n.forEach(((e,t)=>{if(t>s.length-1){t=s.length-1}o.push(toFormValue(e,s[t]))}));return o};const getInnerData=(e,t,i)=>{if(e==null){return null}const o=e[t];if(o!==undefined){return o}else if(i==="field"){return null}return e};t.ALERT_CONFIG_DEFAULTS=Je;t.ALERT_CONFIG_DEFAULTS_TOKEN=Qe;t.AbstractCachedRestService=AbstractCachedRestService;t.Alert=Alert;t.AnnotationService=AnnotationService;t.BackendEntry=BackendEntry;t.BaseValueAccessor=BaseValueAccessor;t.BooleanUtils=BooleanUtils;t.BrowserService=BrowserService;t.CacheAction=CacheAction;t.CacheConfig=$;t.CacheConfigAnnotationFactory=CacheConfigAnnotationFactory;t.Cached=Y;t.CachedAnnotationFactory=CachedAnnotationFactory;t.CloneableUtils=CloneableUtils;t.CryptographicUtils=CryptographicUtils;t.DEFAULT_AUTHENTICATION_CLIENT_ID=se;t.DEFAULT_AUTHENTICATION_ENTRY_POINT=oe;t.DEFAULT_AUTH_MAP=ae;t.DEFAULT_CREDENTIALS_MAP=re;t.DEFAULT_LANGUAGE_ISO=me;t.DefaultCacheTiming=DefaultCacheTiming;t.DefaultRetryStrategy=Ae;t.DynamicForm=DynamicForm;t.DynamicInput=DynamicInput;t.EVENTS=pe;t.EVENT_SERVICE=te;t.EXPONENTIAL_RETRY_DEFAULT_SETTING=Te;t.EvictionTag=EvictionTag;t.ExponentialRetry=ExponentialRetry;t.ExponentialRetryStrategy=xe;t.FORM_PROP=et;t.FileValidatorFactory=FileValidatorFactory;t.FingerPrintingService=FingerPrintingService;t.FormField=FormField;t.FormGrouping=FormGrouping;t.FormList=FormList;t.FormPropDecorator=FormPropDecorator;t.FunctionsUtils=FunctionsUtils;t.GET_REQUESTS_ON_HOLD_MAP=Ne;t.HTTP_METHODS_READ=we;t.HTTP_METHODS_UPDATE=Ee;t.HttpUtils=HttpUtils;t.I18N_RESOURCE_URI_TOKEN=ee;t.I18N_ROOT_RESOURCE_URI=ne;t.IAlertService=IAlertService;t.IAuthenticationManagerService=IAuthenticationManagerService;t.IAuthenticationService=IAuthenticationService;t.IModalService=IModalService;t.ISelectAdapter=ISelectAdapter;t.ISessionService=ISessionService;t.ISettingsService=ISettingsService;t.ISharedDataService=ISharedDataService;t.IStorageService=IStorageService;t.ITranslationsFetchService=ITranslationsFetchService;t.InputPropDecorator=InputPropDecorator;t.InputProperties=InputProperties;t.InputPropertyChange=InputPropertyChange;t.InvalidateCache=InvalidateCache;t.InvalidateCacheAnnotationFactory=InvalidateCacheAnnotationFactory;t.LANDING_PAGE_PATH=le;t.LANGUAGE_SERVICE=ue;t.LANGUAGE_SERVICE_CONSTANTS=ge;t.LIBRARY_NAME=Q;t.LINEAR_RETRY_DEFAULT_SETTING=Pe;t.LanguageDropdown=LanguageDropdown;t.LanguageDropdownAdapter=LanguageDropdownAdapter;t.LanguageDropdownHelper=LanguageDropdownHelper;t.LinearRetry=LinearRetry;t.LinearRetryStrategy=De;t.LogService=LogService;t.LoginDialogResourceProvider=$e;t.OPERATION_CONTEXT_TOKEN=ke;t.OperationContextAnnotationFactory=OperationContextAnnotationFactory;t.OperationContextRegistered=Me;t.PropDecorator=PropDecorator;t.REAUTH_STARTED=ie;t.RarelyChangingContentName=ve;t.RestClient=RestClient;t.SELECTED_LANGUAGE=de;t.SIMPLE_RETRY_DEFAULT_SETTING=Oe;t.SWITCH_LANGUAGE_EVENT=ce;t.SimpleRetry=SimpleRetry;t.StringUtils=StringUtils;t.StripResponseHeaders=StripResponseHeaders;t.URIBuilder=URIBuilder;t.UrlUtils=UrlUtils;t.ValidatorParameters=ValidatorParameters;t.WHO_AM_I_RESOURCE_URI_TOKEN=J;t.WindowUtils=WindowUtils;t.YJQUERY_TOKEN=he;t.annotationService=H;t.booleanUtils=B;t.clientErrorPredicate=clientErrorPredicate;t.cloneableUtils=y;t.commonNgZone=w;t.defaultRetryStrategyFactory=defaultRetryStrategyFactory;t.exponentialRetryStrategyFactory=exponentialRetryStrategyFactory;t.functionsUtils=E;t.getPersistenceMap=getPersistenceMap;t.httpUtils=j;t.linearRetryStrategyFactory=linearRetryStrategyFactory;t.moduleUtils=R;t.noInternetConnectionErrorPredicate=noInternetConnectionErrorPredicate;t.promiseUtils=L;t.rarelyChangingContent=fe;t.readPredicate=readPredicate;t.retriableErrorPredicate=retriableErrorPredicate;t.serverErrorPredicate=serverErrorPredicate;t.stringUtils=S;t.timeoutErrorPredicate=timeoutErrorPredicate;t.toFormValue=toFormValue;t.updatePredicate=updatePredicate;t.urlUtils=b;t.windowUtils=A},12549:(e,t,i)=>{"use strict";var o=i(36092);Object.defineProperty(t,"__esModule",{value:true});var n=i(32709);var s=i(22630);var a=i(43874);var r=i(20410);var l=i(12133);var d=i(54526);var p=i(51132);var m=i(67564);var g=i(30178);var u=i(48896);var h=i(38102);var _=i(93620);var v=i(66791);var f=i(9501);var y=i(72093);var S=i(37100);var b=i(64097);var E=i(19662);var w=i(70658);var A=i(84359);var R=i(94312);var N=i(26404);var L=i(67827);var B=i(20290);var j=i(47692);var G=i(39837);var H=i(78471);var W=i(10349);var $=i(88936);function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}function _interopNamespace(e){if(e&&e.__esModule)return e;var t=Object.create(null);if(e){Object.keys(e).forEach((function(i){if(i!=="default"){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,o.get?o:{enumerable:true,get:function(){return e[i]}})}}))}t["default"]=e;return Object.freeze(t)}var K=_interopNamespace(s);var Y=_interopDefaultLegacy(a);var Z=_interopDefaultLegacy(p);const SeEntryModule=function(e){return function(t){window.__smartedit__.modules[e]=t;return t}};function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}class NodeUtils{collectSmarteditAttributesByElementUuid(e){const t=document.querySelector(`.smartEditComponent[data-smartedit-element-uuid='${e}']`);if(!t){throw new Error(`could not find element with uuid ${e}`)}return Array.from(t.attributes).reduce(((e,t)=>{let i=t.name;if(i.indexOf("smartedit-")>-1){i=s.camelCase(i.replace("data-",""));e[i]=t.value}return e}),{})}compareHTMLElementsPosition(e){return function(t,i){if(e){t=t[e];i=i[e]}if(t===i){return 0}if(!t.compareDocumentPosition){return t.sourceIndex-i.sourceIndex}if(t.compareDocumentPosition(i)&2){return 1}return-1}}isPointOverElement(e,t){const i=t.getBoundingClientRect();return e.x>=i.left&&e.x<=i.right&&e.y>=i.top&&e.y<=i.bottom}areIntersecting(e,t){return!(t.left>e.left+e.width||t.left+t.width<e.left||t.top>e.top+e.height||t.top+t.height<e.top)}injectJS(){function getInjector(){return Y["default"]}return{getInjector,execute(e){const t=e.srcs;let i=e.index;const o=e.callback;if(!t.length){o();return}if(i===undefined){i=0}if(t[i]!==undefined){this.getInjector()(t[i],(()=>{if(i+1<t.length){this.execute({srcs:t,index:i+1,callback:o})}else if(typeof o==="function"){o()}}))}}}}}const Q=new NodeUtils;const J=[];class AbstractDecorator{constructor(){J.push(this.smarteditElementuuid);const e=this.ngOnDestroy.bind(this);this.ngOnDestroy=()=>{e();J.splice(J.indexOf(this.smarteditElementuuid),1)}}set active(e){this._active=e==="true"}get active(){return this._active}static getScopes(){return J}get componentAttributes(){if(!this._cachedCcomponentAttributes){try{this._cachedCcomponentAttributes=Q.collectSmarteditAttributesByElementUuid(this.smarteditElementuuid)}catch(e){console.log(`AbstratcDecorator failed to find original element with uuid ${this.smarteditElementuuid}`)}}return this._cachedCcomponentAttributes}ngOnDestroy(){}}__decorate([n.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],AbstractDecorator.prototype,"active",null);__decorate([n.Input("data-smartedit-element-uuid"),__metadata("design:type",String)],AbstractDecorator.prototype,"smarteditElementuuid",void 0);__decorate([n.Input("data-smartedit-component-id"),__metadata("design:type",String)],AbstractDecorator.prototype,"smarteditComponentId",void 0);__decorate([n.Input("data-smartedit-component-uuid"),__metadata("design:type",String)],AbstractDecorator.prototype,"smarteditComponentUuid",void 0);__decorate([n.Input("data-smartedit-component-type"),__metadata("design:type",String)],AbstractDecorator.prototype,"smarteditComponentType",void 0);__decorate([n.Input("data-smartedit-catalog-version-uuid"),__metadata("design:type",String)],AbstractDecorator.prototype,"smarteditCatalogVersionUuid",void 0);__decorate([n.Input("data-smartedit-container-id"),__metadata("design:type",String)],AbstractDecorator.prototype,"smarteditContainerId",void 0);__decorate([n.Input("data-smartedit-container-uuid"),__metadata("design:type",String)],AbstractDecorator.prototype,"smarteditContainerUuid",void 0);__decorate([n.Input("data-smartedit-container-type"),__metadata("design:type",String)],AbstractDecorator.prototype,"smarteditContainerType",void 0);class DINameUtils{buildComponentName(e){return this.buildName(e).replace(/Component$/,"").replace(/Directive$/,"")}buildServiceName(e){return this.buildName(e)}buildModuleName(e){return this.buildName(e).replace(/Module$/,"")}buildName(e){const t=r.annotationService.getOriginalConstructor(e);const i=r.functionsUtils.getConstructorName(t);return this.convertNameCasing(i)}convertNameCasing(e){const t=e.substring(0,1).toLowerCase()+e.substring(1);return t}}const ee=new DINameUtils;const SeCustomComponent=function(){return function(e){const t=r.functionsUtils.getConstructorName(e);const i=window.__smartedit__.getDecoratorPayload("Component",e);if(!i){throw new Error(`@SeCustomComponent ${t} should only be used on a @Component decorated class`)}const o=parseComponentSelector(i.selector,e);e.selector=o;te.unshift(e);return e}};const parseComponentSelector=function(e,t){if(!e){return window.smarteditLodash.kebabCase(ee.buildComponentName(t))}else{return e}};const te=[];function registerCustomComponents(e){te.forEach((t=>{if(!customElements.get(t.selector)){const i=l.createCustomElement(t,{injector:e});customElements.define(t.selector,i)}}))}const ie=new n.InjectionToken("CONTEXTUAL_MENU_ITEM_DATA");class TruncatedText{constructor(e="",t="",i,o=""){this.text=e;this.truncatedText=t;this.truncated=i;this.ellipsis=o;this.text=this.text||"";this.truncatedText=this.truncatedText||""}getUntruncatedText(){return this.text}getTruncatedText(){return this.truncatedText+this.ellipsis}isTruncated(){return this.truncated}}var oe;window.__smartedit__=window.__smartedit__||{};function getDecoratorKey(e,t){return`${e}-${t}:definition`}K.merge(window.__smartedit__,{modules:{},pushedModules:[],smarteditDecoratorPayloads:{},addDecoratorPayload(e,t,i){const o=getDecoratorKey(e,t);if(window.__smartedit__.smarteditDecoratorPayloads[o]){throw new Error("Duplicate class/decorator pair")}window.__smartedit__.smarteditDecoratorPayloads[o]=i},getDecoratorPayload(e,t){const i=r.functionsUtils.getConstructorName(r.annotationService.getOriginalConstructor(t));return window.__smartedit__.smarteditDecoratorPayloads[getDecoratorKey(e,i)]},getComponentDecoratorPayload(e){return window.__smartedit__.smarteditDecoratorPayloads[getDecoratorKey("Component",e)]},downgradedService:{}});window.pushModules=(...e)=>{window.__smartedit__.pushedModules=window.__smartedit__.pushedModules.concat(e)};t.WindowUtils=oe=class WindowUtils extends r.WindowUtils{constructor(e){super(e);this.getGatewayTargetFrame=()=>{if(this._isInCypressIframe()){return this._getCypressFrame()}if(this.isIframe()){return this.getWindow().parent}if(this._isParentOfIframe()){return this._getSmarteditIframeFromWindow()}return null}}getSmarteditIframe(){return document.querySelector("iframe#"+oe.SMARTEDIT_IFRAME_ID)}setTrustedIframeDomain(e){this.trustedIframeDomain=r.urlUtils.getOrigin(e)}getTrustedIframeDomain(){return this.trustedIframeDomain}isCrossOrigin(e){return r.urlUtils.getOrigin()!==r.urlUtils.getOrigin(e)}customTimeout(e,t){setTimeout((function(){e()}),t)}_getCypressFrame(){if(this.getWindow().parent.document.querySelector("iframe#"+oe.SMARTEDIT_IFRAME_ID)){return this.getWindow().parent}return this._getSmarteditIframeFromWindow()}_getSmarteditIframeFromWindow(){const e=this.getWindow().document.getElementById(oe.SMARTEDIT_IFRAME_ID);if(!!e){return e.contentWindow}return null}_isInCypressIframe(){try{const e=this.getWindow().top.document.querySelector("iframe");return e&&(e.id.includes(oe.CYPRESS_IFRAME_ID_9)||e.id.includes(oe.CYPRESS_IFRAME_ID_10))}catch(e){return false}}_isParentOfIframe(){return!!this._getSmarteditIframeFromWindow()}};t.WindowUtils.SMARTEDIT_IFRAME_ID="ySmartEditFrame";t.WindowUtils.CYPRESS_IFRAME_ID_9="Your App";t.WindowUtils.CYPRESS_IFRAME_ID_10="Your project: 'Test Project'";t.WindowUtils=oe=__decorate([n.Injectable(),__metadata("design:paramtypes",[n.NgZone])],t.WindowUtils);const ne=new t.WindowUtils;window.__smartedit__.addDecoratorPayload("Injectable","ModuleUtils",{providedIn:"root"});t.ModuleUtils=class ModuleUtils extends r.ModuleUtils{constructor(){super()}getNgModule(e){if(window.__smartedit__.modules){const t=Object.keys(window.__smartedit__.modules).find((t=>t.toLowerCase().endsWith(e.toLowerCase())||t.toLowerCase().endsWith(e.toLowerCase()+"module")));if(!t){return null}return window.__smartedit__.modules[t]}return null}};t.ModuleUtils=__decorate([n.Injectable({providedIn:"root"}),__metadata("design:paramtypes",[])],t.ModuleUtils);const se=new t.ModuleUtils;class StringUtils extends r.StringUtils{sanitizeHTML(e){if(ae.isBlank(e)){return e}return e.replace(/(\r\n|\n|\r)/gm,"").replace(/>\s+</g,"><").replace(/<\/br\>/g,"")}generateIdentifier(){let e=(new Date).getTime();if(window.performance&&typeof window.performance.now==="function"){e+=window.performance.now()}const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const i=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(t==="x"?i:i&3|8).toString(16)}));return t}getEncodedString(e){return this.encode(e)}trim(e){return e.trim()}escapeHtml(e){if(typeof e==="string"){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}return e}resourceLocationToRegex(e){return new RegExp(e.replace(/\/:[^\/]*/g,"/.*"))}}const ae=new StringUtils;t.DiscardablePromiseUtils=class DiscardablePromiseUtils{constructor(e){this.logService=e;this._map={}}apply(e,t,i,o){if(!this._map[e]){this._map[e]={promise:t,successCallback:i,failureCallback:o}}else{this.logService.debug(`competing promise for key ${e}`);delete this._map[e].discardableHolder.successCallback;delete this._map[e].discardableHolder.failureCallback;this._map[e].promise=t}this._map[e].discardableHolder={successCallback:this._map[e].successCallback,failureCallback:this._map[e].failureCallback};const n=this;const s=this._map[e].promise;s.then(function(t){if(this.successCallback){delete n._map[e];this.successCallback.apply(undefined,[t])}else{n.logService.debug(`aborted successCallback for promise identified by ${e}`)}}.bind(this._map[e].discardableHolder),function(t){if(this.failureCallback){delete n._map[e];this.failureCallback.apply(undefined,[t])}else{n.logService.debug(`aborted failureCallback for promise identified by ${e}`)}}.bind(this._map[e].discardableHolder))}clear(e){if(this.exists(e)){delete this._map[e].discardableHolder.successCallback;delete this._map[e].discardableHolder.failureCallback}}exists(e){return this._map[e]?true:false}};t.DiscardablePromiseUtils=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.LogService])],t.DiscardablePromiseUtils);class SmarteditErrorHandler extends n.ErrorHandler{constructor(){super();this.ignorePatterns=[/Uncaught[\s]*\(in[\s]*promise\)/,/Unhandled[\s]*Promise[\s]*rejection/]}handleError(e){if(!e){return}if(false){}const t=e&&e.message?e.message:e;if(t&&this.ignorePatterns.some((e=>e.test(t.toString())))){return}if(e instanceof d.HttpErrorResponse&&e.status===401){return}super.handleError(e)}}const re="domain";const le="smarteditloader-component";const ce="smarteditcontainer-component";const de="smartedit-component";const pe="data-smartedit-element-uuid";const me="data-smartedit-component-id";const ge="data-smartedit-component-type";const ue="ng";const he="**";const _e="logout";const ve=1e3;const fe="CURRENT_CONTEXT_CATALOG";const ye="CURRENT_CONTEXT_CATALOG_VERSION";const Se="CURRENT_CONTEXT_SITE_ID";const Ce="CURRENT_PAGE_CONTEXT_CATALOG";const be="CURRENT_PAGE_CONTEXT_CATALOG_VERSION";const Ie="CURRENT_PAGE_CONTEXT_SITE_ID";const Ee="_SHOW_SLOT_MENU";const we="HIDE_SLOT_MENU";const Te="OVERLAY_DISABLED";const Pe="en_US";const Oe="CLOSE_CTX_MENU";const Ae="CTX_MENU_DROPDOWN_IS_OPEN";t.MUTATION_CHILD_TYPES=void 0;(function(e){e["ADD_OPERATION"]="addedNodes";e["REMOVE_OPERATION"]="removedNodes"})(t.MUTATION_CHILD_TYPES||(t.MUTATION_CHILD_TYPES={}));const xe={CHILD_LIST:{NAME:"childList",ADD_OPERATION:t.MUTATION_CHILD_TYPES.ADD_OPERATION,REMOVE_OPERATION:t.MUTATION_CHILD_TYPES.REMOVE_OPERATION},ATTRIBUTES:{NAME:"attributes"}};const De="/permissionswebservices/v1/permissions/catalogs/search";const Re={BACKGROUND_TASKS:"Background Tasks",INTERACTIVE:"Interactive",NON_INTERACTIVE:"Non-Interactive",BATCH_OPERATIONS:"Batch Operations",TOOLING:"Tooling",CMS:"CMS"};const Me="/smarteditwebservices/v1/i18n/translations";const ke="/authorizationserver/oauth/whoami";const Ne="smartedit";const Fe="/samlsinglesignon/saml";const ze="/smartedit/authenticate";const Le="/samlsinglesignon/saml/logout";const Ve="/previewwebservices/v1/preview";const Ue=/\/cmssmarteditwebservices|\/cmswebservices/;const Be=/^(.*)\/smartedit/;const je="smartedit";const Ge="/smartedit/configuration";const He="/smartedit/settings";const We="EVENT_NOTIFICATION_CHANGED";t.SortDirections=void 0;(function(e){e["Ascending"]="asc";e["Descending"]="desc"})(t.SortDirections||(t.SortDirections={}));const $e="REFRESH_CONTEXTUAL_MENU_ITEMS_EVENT";const Ke="previousUsername";const qe={topLogoURL:"static-resources/images/SAP_R_grad.svg",bottomLogoURL:"static-resources/images/best-run-sap-logo.svg"};const Ye="EVENT_PERSPECTIVE_CHANGED";const Ze="EVENT_PERSPECTIVE_UNLOADING";const Xe="EVENT_PERSPECTIVE_REFRESHED";const Qe="EVENT_PERSPECTIVE_ADDED";const Je="EVENT_PERSPECTIVE_UPDATED";const et="EVENT_THEME_SAVED";const tt="EVENT_THEME_CHANGED";const it="EVENT_STRICT_PREVIEW_MODE_REQUESTED";const ot="perspectiveToolbar.perspectiveSelectorTemplate";const nt="EVENT_SMARTEDIT_COMPONENT_UPDATED";const at="smarteditoverlay";const rt="EVENT_OUTER_FRAME_CLICKED";const lt="EVENT_INNER_FRAME_CLICKED";const ct="data-smartedit-catalog-version-uuid";const dt="smartEditComponent";const pt="data-smartedit-container-id";const gt={PROCESS:"processComponent",REMOVE:"removeComponent",KEEP_VISIBLE:"keepComponentVisible"};const ut={PROCESS_COMPONENTS:"contractChangeListenerProcessComponents",RESTART_PROCESS:"contractChangeListenerRestartProcess"};const ht="overlayRerendered";const _t="data-smartedit-";const yt="smartEditComponentProcessStatus";const bt="data-smartedit-component-uuid";const Et="smartEditComponentX";const wt="ContentSlot";const xt="data-smartedit-container-type";const Bt="/cmswebservices/v1/sites/:siteUID/languages";const Kt="/smarteditwebservices/v1/i18n/languages";const Xt="genericEditorLoadedEvent";const ei="UnrelatedValidationMessagesEvent";const ti={VALIDATION_ERROR:"ValidationError",WARNING:"Warning"};const ii="/cmswebservices/v1/enums";const oi="DROPDOWN_IMPLEMENTATION_SUFFIX";const ni="LinkedDropdown";const si="ClickDropdown";const ai="DropdownPopulator";const ri="/cmswebservices/v1/sites";const li={ANGULAR_FORMAT:"short",MOMENT_FORMAT:"M/D/YY h:mm A",MOMENT_ISO:"YYYY-MM-DDTHH:mm:00ZZ",ISO:"yyyy-MM-ddTHH:mm:00Z",ANGULAR_SHORT:"M/d/yy h:mm a"};const ci={LEFT:"left",RIGHT:"right"};const di="/cmswebservices/v1/types";const pi="/storefront";const mi="/cmssmarteditwebservices/v1/sites/:siteUID/products/:productUID";const gi="/cmssmarteditwebservices/v1/productcatalogs/:catalogId/versions/:catalogVersion/products";const ui="HIDE_TOOLBAR_ITEM_CONTEXT";const hi="SHOW_TOOLBAR_ITEM_CONTEXT";const _i={DRAG_DROP_CROSS_ORIGIN_START:"DRAG_DROP_CROSS_ORIGIN_START",DRAG_DROP_START:"EVENT_DRAG_DROP_START",DRAG_DROP_END:"EVENT_DRAG_DROP_END",TRACK_MOUSE_POSITION:"EVENT_TRACK_MOUSE_POSITION",DROP_ELEMENT:"EVENT_DROP_ELEMENT"};const vi="se.none";const fi="se.all";const yi=100;const Si=70;const Ci="smartedit-element-hovered";const bi="ySECmsScrollArea";const Ii="ySmartEditFrameDragArea";const Ei={START:"START",END:"END"};const wi="#js_iFrameWrapper";const Ti=1e4;const Pi="EVENT_CONTENT_CATALOG_UPDATE";const Oi=[];const Ai=[];const xi=`/cmswebservices/v1/catalogs/${fe}/versions/${ye}/media`;const Di=`/cmswebservices/v1/media`;const Ri=`/cmswebservices/v1/catalogs/${fe}/versions/${ye}/medias`;const Mi="experience";const ki=`/cmswebservices/v1/mediafolders`;const Ni="OPEN_PAGE_WORKFLOW_MENU";const Fi="CMS_EVENT_OPEN_PAGE_WORKFLOW_MENU";const zi="CMSITEMS_UPDATE";const Li=`/cmswebservices/v1/sites/${Ie}/catalogs/${Ce}/versions/${be}/pagescontentslots`;const Vi="EVENT_PAGE_TREE_PANEL_SWITCH";const Ui="EVENT_PAGE_TREE_SLOT_SELECTED";const Bi="EVENT_PAGE_TREE_COMPONENT_SELECTED";const ji="EVENT_OPEN_IN_PAGE_TREE";const Gi="EVENT_PART_REFRESH_TREE_NODE";const Hi="EVENT_OVERALL_REFRESH_TREE_NODE";const Wi="EVENT_PAGE_TREE_SLOT_NEED_UPDATE";const $i="PAGE_TREE_PANEL_WIDTH_COOKIE_NAME";const Ki="PAGE_TREE_SLOT_EXPANDED_EVENT";const qi="se-page-tree-component-node";const Yi="/smarteditwebservices/v1/themes/currentUser/theme";const Zi="/smarteditwebservices/v1/themes";const Xi={NAVIGATION:"Function Navigation",PAGE_MANAGEMENT:"Page Management",NAVIGATION_MANAGEMENT:"Navigation Management",HEADER_TOOL:"Header Tool Bar",SELECT_PERSPECTIVE:"Perspective Select",TOOL_BAR:"Tool Bar",VERSION_OPERATION:"Version Operation",INFLECTION:"Inflection Select",ADD_COMPONENT:"Add Component",VERSION_MANAGEMENT:"Version Management",CONTEXT_MENU:"Contextual Menu",PAGE_STRUCTURE:"Page Structure"};const Qi=new Map([["se.cms.toolbaritem.navigationmenu.name","Navigation"],["se.cms.pagelist.title","Pages"],["se.route.storefront.title","Storefront"],["headerToolbar.configurationTemplate","Configuration"],["headerToolbar.languageSelectorTemplate","Language Select"],["headerToolbar.userAccountTemplate","User Account"],["se.cms.perspective.basic","Basic Edit"],["se.cms.perspective.versioning","Versioning"],["personalizationsmartedit.perspective","Personalization"],["se.cms.perspective.advanced","Advanced Edit"],["se.none","Preview"],["se.cms.componentMenuTemplate","Component"],["se.cms.pageTreeMenu",Xi.PAGE_STRUCTURE],["personalizationsmartedit.container.pagecustomizations.toolbar","Personalize - Customization"],["personalizationsmartedit.container.combinedview.toolbar","Personlization - CombinedView"],["personalizationsmartedit.container.manager.toolbar","Personlization - Library"],["se.cms.createVersionMenu","Add Version"],["se.cms.clonePageMenu","Clone"],["se.cms.compomentmenu.tabs.componenttypes","Component Types"],["se.cms.compomentmenu.tabs.customizedcomp","Saved Components"],["se.cms.contextmenu.title.dragndrop","Drag and Drop"],["se.cms.contextmenu.title.edit","Edit"],["se.cms.contextmenu.title.remove","Remove"],["se.cms.contextmenu.title.clone.component","Clone"],["se.cms.pageVersionsMenu","Versions"],["se.cms.contextmenu.title.open.in.page.tree","Open In Page Tree"],["se.cms.version.item.menu.view.label","View"],["se.cms.version.item.menu.edit.label","Edit Details"],["se.cms.version.item.menu.rollback.label","Rollback To This Version"],["se.cms.version.item.menu.delete.label","Delete"],["se.cms.rollbackVersionMenu","Version Rollback"]]);function objectToArray(e){return Object.keys(e).reduce(((t,i)=>[...t||[],{key:i,value:e[i]}]),[])}class ObjectUtils{constructor(){this.isObjectEmptyDeep=e=>{if(K.isObject(e)){for(const t in e){if(e.hasOwnProperty(t)){if(!K.isEmpty(e[t])){return false}}}return true}return K.isString(e)?K.isEmpty(e):K.isNil(e)};this.resetObject=(e,t)=>{if(!e){e=this.copy(t)}else{for(const t in e){if(e.hasOwnProperty(t)){delete e[t]}}K.extend(e,this.copy(t))}return e};this.deepIterateOverObjectWith=(e,t)=>K.reduce(e,((e,i,o)=>{if(K.isPlainObject(i)){e[o]=this.deepIterateOverObjectWith(i,t)}else{e[o]=t(i)}return e}),{});this.deepObjectPropertyDiff=(e,t)=>{const i="CHANGED_PROPERTY";const o="NON_CHANGED_PROPERTY";const n=K.mergeWith(K.cloneDeep(e),t,(function(e,t){if(!K.isPlainObject(e)){return!K.isEqual(e,t)?i:o}return undefined}));const s=this.deepIterateOverObjectWith(n,(e=>{if(e!==i&&e!==o){return i}else{return e}}));return this.deepIterateOverObjectWith(s,(e=>e===i?true:false))};this.readObjectStructure=(e,t=0)=>{if(t>25){return this.getClassName(e)}if(e===undefined||e===null||e.then){return e}switch(typeof e){case"function":return"FUNCTION";case"string":return"STRING";case"number":return"NUMBER";case"boolean":return"BOOLEAN";default:return this._getOtherObjectType(e,t)}}}copy(e){return JSON.parse(JSON.stringify(e))}merge(e,t){return Object.assign(e,t)}convertToArray(e){const t=[];for(const i in e){if(!i.startsWith("$")&&!i.startsWith("toJSON")){t.push({key:i,value:e[i]})}}return t}uniqueArray(e,t){const i=new Set(e);t.forEach((t=>{if(!i.has(t)){e.push(t)}}));return e}isFunction(e){return typeof e==="function"}isObject(e){const t={boolean:false,function:true,object:true,number:false,string:false,undefined:false};return!!(e&&t[typeof e])}isTypedMap(e){return e&&this.isObject(e)&&e.constructor===Object}sortBy(e,t,i=false){const o=[...e];const n=i?-1:1;o.sort(((e,i)=>{const o=this.isTypedMap(e)?e[t]:e;const s=this.isTypedMap(i)?i[t]:i;const a=String(o).localeCompare(String(s),undefined,{numeric:true,sensitivity:"base"});return a*n}));return o}extend(e,t){if(!t){t=function(){return}}t.prototype=Object.create(e.prototype);return t}getClassName(e){return e&&e.constructor&&e.constructor.name&&e.constructor.name!=="Object"?e.constructor.name:null}_getOtherObjectType(e,t){if(K.isElement(e)){return"ELEMENT"}if(e.hasOwnProperty&&e.hasOwnProperty("length")){if(e.forEach){const i=[];e.forEach((e=>{t++;i.push(this.readObjectStructure(e,t))}));return i}else{return"JQUERY"}}if(e.constructor&&e.constructor.name&&e.constructor.name!=="Object"){return e.constructor.name}const i={};Object.keys(e).forEach((o=>{if(!o.startsWith("$")){t++;i[o]=this.readObjectStructure(e[o],t)}}));return i}}const Ji=new ObjectUtils;class ApiUtils{getDataFromResponse(e){const t=Object.keys(e).filter((function(t){return e[t]instanceof Array}))[0];return e[t]}getKeyHoldingDataFromResponse(e){const t=Object.keys(e).filter((function(t){return e[t]instanceof Array}))[0];return t}}const eo=new ApiUtils;class DateUtils{formatDateAsUtc(e){return Z["default"](e).utc().format(li.MOMENT_ISO)}}const to=new DateUtils;class ScriptUtils{injectJS(){function getInjector(){return Y["default"]}return{getInjector,execute(e){const t=e.srcs;let i=e.index;const o=e.callback;if(!t.length){o();return}if(i===undefined){i=0}if(t[i]!==undefined){this.getInjector()(t[i],(()=>{if(i+1<t.length){this.execute({srcs:t,index:i+1,callback:o})}else if(typeof o==="function"){o()}}))}}}}}const io=new ScriptUtils;t.Errors=void 0;(function(e){class ParseError{constructor(e){this.value=e}}e.ParseError=ParseError})(t.Errors||(t.Errors={}));const oo=new n.InjectionToken("EXTENDED_VIEW_PORT_MARGIN");const no=new n.InjectionToken("HEART_BEAT_TIMEOUT_THRESHOLD_MS");t.SystemEventService=class SystemEventService{constructor(e,t){this.logService=e;this.promiseUtils=t;this._eventHandlers={}}publish(e,t){if(!e){this.logService.error("Failed to send event. No event ID provided for data: "+t)}else{if(this._eventHandlers[e]&&this._eventHandlers[e].length>0){return this._invokeEventHandlers(e,t)}}return Promise.resolve()}publishAsync(e,t){return new Promise(((i,o)=>{setTimeout((()=>{this.publish(e,t).then((e=>i(e)),(e=>o(e)))}),0)}))}subscribe(e,t){let i;if(!e||!t){this.logService.error("Failed to subscribe event handler for event: "+e)}else{if(this._eventHandlers[e]===undefined){this._eventHandlers[e]=[]}this._eventHandlers[e].push(t);i=()=>{this._unsubscribe(e,t)}}return i}_unsubscribe(e,t){const i=this._eventHandlers[e];const o=i?this._eventHandlers[e].indexOf(t):-1;if(o>=0){this._eventHandlers[e].splice(o,1)}else{this.logService.warn(`Attempting to remove event handler for ${e} but handler not found.`)}}_invokeEventHandlers(e,t){return Promise.all(this._eventHandlers[e].map((i=>{const o=this.promiseUtils.toPromise(i);return o(e,t)}))).then((e=>Promise.resolve(e.pop())),(t=>Promise.reject(`eventId: ${e}, reason: ${t}`)))}};t.SystemEventService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.LogService,r.PromiseUtils])],t.SystemEventService);class MessageGateway{constructor(e,t,i,o,n,s,a){this.logService=e;this.systemEventService=t;this.cloneableUtils=i;this.windowUtils=o;this.promiseUtils=n;this.TIMEOUT_TO_RETRY_PUBLISHING=s;this.gatewayId=a;this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID="promiseAcknowledgement";this.PROMISE_RETURN_EVENT_ID="promiseReturn";this.SUCCESS="success";this.FAILURE="failure";this.MAX_RETRIES=5;this.promisesToResolve={}}publish(e,t,i=0,o){if(!e){return Promise.reject(`MessageGateway: Failed to send event. No event ID provided for _data: ${t}`)}const n=this.cloneableUtils.makeCloneable(t);if(!K.isEqual(n,t)){this.logService.debug(`MessageGateway.publish - Non cloneable payload has been sanitized for gateway ${this.gatewayId}, event ${e}:`,n)}const s=this.promisesToResolve[o]||this.promiseUtils.defer();const a=this.windowUtils.getGatewayTargetFrame();if(!a){s.reject("It is standalone. There is no iframe");return s.promise}o=o||this._generateIdentifier();try{a.postMessage({pk:o,eventId:e,data:n,gatewayId:this.gatewayId},"*")}catch(t){this.logService.error(t);this.logService.error(`MessageGateway.publish - postMessage has failed for gateway ${this.gatewayId} event ${e} and data `,n)}this.promisesToResolve[o]=s;this._setTimeout((()=>{if(!s.acknowledged&&e!==this.PROMISE_RETURN_EVENT_ID&&e!==this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID){if(i<this.MAX_RETRIES){this.logService.debug(`${document.location.href} is retrying to publish event ${e}`);++i;this.publish(e,n,i,o).catch((e=>{}))}else{const t=`MessageGateway.publish - Not able to publish event ${e} after max retries for gateway ${this.gatewayId} and data ${JSON.stringify(n)}`;s.reject(t)}}}),this.TIMEOUT_TO_RETRY_PUBLISHING);return s.promise}subscribe(e,t){let i;if(!e){this.logService.error("MessageGateway: Failed to subscribe event handler for event: "+e)}else{const o=this._getSystemEventId(e);i=this.systemEventService.subscribe(o,t)}return i}processEvent(e){if(e.eventId!==this.PROMISE_RETURN_EVENT_ID&&e.eventId!==this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID){return this._processEvent(e)}const t=e.data;if(e.eventId===this.PROMISE_RETURN_EVENT_ID){this._processPromiseReturnEvent(t)}else if(e.eventId===this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID&&this.promisesToResolve[t.pk]){this.logService.debug(document.location.href,"received acknowledgement",e);this.promisesToResolve[t.pk].acknowledged=true}return Promise.resolve()}_processEvent(e){this.logService.debug(document.location.href,"sending acknowledgement for",e);this.publish(this.PROMISE_ACKNOWLEDGEMENT_EVENT_ID,{pk:e.pk});const t=this._getSystemEventId(e.eventId);return this.systemEventService.publishAsync(t,e.data).then((t=>{this.logService.debug(document.location.href,"sending promise resolve",e);return this.publish(this.PROMISE_RETURN_EVENT_ID,{pk:e.pk,type:this.SUCCESS,resolvedDataOfLastSubscriber:t})}),(t=>{this.logService.debug(document.location.href,"sending promise reject",e);return this.publish(this.PROMISE_RETURN_EVENT_ID,{pk:e.pk,type:this.FAILURE,rejectedDataOfLastSubscriber:t})}))}_processPromiseReturnEvent(e){if(this.promisesToResolve[e.pk]){if(e.type===this.SUCCESS){this.logService.debug(document.location.href,"received promise resolve");this.promisesToResolve[e.pk].resolve(e.resolvedDataOfLastSubscriber)}else if(e.type===this.FAILURE){this.logService.debug(document.location.href,"received promise reject");this.promisesToResolve[e.pk].reject(e.rejectedDataOfLastSubscriber)}delete this.promisesToResolve[e.pk]}}_setTimeout(e,t){if(r.functionsUtils.isUnitTestMode()){setTimeout(e,t)}else{this.windowUtils.runTimeoutOutsideAngular(e,t)}}_generateIdentifier(){return(new Date).getTime().toString()+Math.random().toString()}_getSystemEventId(e){return`${this.gatewayId}:${e}`}}var so;t.GatewayFactory=so=class GatewayFactory{constructor(e,t,i,o,n,s){this.logService=e;this.systemEventService=t;this.cloneableUtils=i;this.windowUtils=o;this.promiseUtils=n;this.functionsUtils=s;this.messageGatewayMap={}}initListener(){const e=[];this.windowUtils.getWindow().addEventListener("message",(t=>{if(t.origin==="https://sapinsights.eu.qualtrics.com"){this.logService.debug("qualtrics url "+t.origin+" should be allowed");return}if(this._isAllowed(t.origin)){const i=t.data;if(e.indexOf(i.pk)>-1){return}e.push(i.pk);this.logService.debug("message event handler called",i.eventId);const o=i.gatewayId;const n=this.messageGatewayMap[o];if(!n){this.logService.debug("Incoming message on gateway "+o+", but no destination exists.");return}n.processEvent(i)}else{this.logService.error("disallowed storefront is trying to communicate with smarteditcontainer")}}),false)}createGateway(e){if(this.messageGatewayMap[e]&&!this.functionsUtils.isUnitTestMode()){this.logService.error("Message Gateway for "+e+" already reserved");return null}this.messageGatewayMap[e]=new MessageGateway(this.logService,this.systemEventService,this.cloneableUtils,this.windowUtils,this.promiseUtils,so.TIMEOUT_TO_RETRY_PUBLISHING,e);return this.messageGatewayMap[e]}_isAllowed(e){return this.windowUtils.isIframe()||this.windowUtils.getTrustedIframeDomain()===e}};t.GatewayFactory.TIMEOUT_TO_RETRY_PUBLISHING=500;t.GatewayFactory=so=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.LogService,t.SystemEventService,r.CloneableUtils,t.WindowUtils,r.PromiseUtils,r.FunctionsUtils])],t.GatewayFactory);t.GatewayProxy=class GatewayProxy{constructor(e,t,i,o,n){this.logService=e;this.promiseUtils=t;this.stringUtils=i;this.functionsUtils=o;this.gatewayFactory=n;this.nonProxiableMethods=["getMethodForVoid","getMethodForSingleInstance","getMethodForArray"]}initForService(e,t,i){const o=i||e.gatewayId;if(!o){this.logService.error(`initForService() - service expected to have an associated gatewayId - methodsSubset: ${t&&t.length?t.join(","):[]}`);return null}const n=this.gatewayFactory.createGateway(o);let s=t;if(!s){s=this.functionsUtils.getInstanceMethods(e).filter((e=>!this._isNonProxiableMethod(e)))}s.forEach((t=>{if(typeof e[t]==="function"){if(this.functionsUtils.isEmpty(e[t])){this._turnToProxy(t,e,n)}else{e[t]=this.promiseUtils.toPromise(e[t],e);n.subscribe(t,this._onGatewayEvent.bind(null,t,e))}}}))}_isNonProxiableMethod(e){return this.nonProxiableMethods.indexOf(e)>-1||e.startsWith("$")||e==="lodash"||e==="jQuery"}_onGatewayEvent(e,t,i,o){return t[e].apply(t,o.arguments)}_turnToProxy(e,t,i){delete t[e];t[e]=(...t)=>i.publish(e,{arguments:t}).then((e=>{if(!this.stringUtils.isBlank(e)){delete e.$resolved;delete e.$promise}return e}),(o=>{if(o){this.logService.debug(`gatewayProxy - publish failed for gateway ${i.gatewayId} method ${e} and arguments ${t}`)}return Promise.reject(o)}))}};t.GatewayProxy=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.LogService,r.PromiseUtils,r.StringUtils,r.FunctionsUtils,t.GatewayFactory])],t.GatewayProxy);const ao=new n.InjectionToken("ANNOUNCEMENT_DATA");class IAnnouncementService{showAnnouncement(e){"proxyFunction";return null}closeAnnouncement(e){"proxyFunction";return null}}class ICatalogService{retrieveUriContext(e){"proxyFunction";return null}getContentCatalogsForSite(e){"proxyFunction";return null}getAllContentCatalogsGroupedById(){"proxyFunction";return null}getCatalogByVersion(e,t){"proxyFunction";return null}isContentCatalogVersionNonActive(e){"proxyFunction";return null}getContentCatalogActiveVersion(e){"proxyFunction";return null}getActiveContentCatalogVersionByCatalogId(e){"proxyFunction";return null}getCurrentSiteID(){"proxyFunction";return null}getDefaultSiteForContentCatalog(e){"proxyFunction";return null}getContentCatalogVersion(e){"proxyFunction";return null}getCatalogVersionByUuid(e,t){"proxyFunction";return null}getCatalogVersionUUid(e){"proxyFunction";return null}getProductCatalogsBySiteKey(e){"proxyFunction";return null}getProductCatalogsForSite(e){"proxyFunction";return null}getActiveProductCatalogVersionByCatalogId(e){"proxyFunction";return null}returnActiveCatalogVersionUIDs(e){"proxyFunction";return null}isCurrentCatalogMultiCountry(){"proxyFunction";return null}}class IExperienceService{updateExperiencePageContext(e,t){"proxyFunction";return null}getCurrentExperience(){"proxyFunction";return null}setCurrentExperience(e){"proxyFunction";return null}hasCatalogVersionChanged(){"proxyFunction";return null}buildRefreshedPreviewUrl(){"proxyFunction";return null}updateExperience(e){"proxyFunction";return null}loadExperience(e){"proxyFunction";return null}compareWithCurrentExperience(e){"proxyFunction";return null}_convertExperienceToPreviewData(e,t){const i=K.cloneDeep(e);const o=[];delete i.catalogDescriptor;delete i.siteDescriptor;delete i.languageDescriptor;delete i.pageContext;delete i.productCatalogVersions;if(e.productCatalogVersions&&e.productCatalogVersions.length){e.productCatalogVersions.forEach((e=>{o.push({catalog:e.catalog,catalogVersion:e.catalogVersion})}))}o.push({catalog:e.catalogDescriptor.catalogId,catalogVersion:e.catalogDescriptor.catalogVersion});i.catalogVersions=o;i.language=e.languageDescriptor.isocode;i.resourcePath=t;i.siteId=e.siteDescriptor.uid;return i}initializeExperience(){"proxyFunction";return null}buildAndSetExperience(e){"proxyFunction";return null}}class IFeatureService{constructor(e,t){this.cloneableUtils=e;this.logService=t}register(e){this._validate(e);this._featuresToAlias=this._featuresToAlias||{};this._featuresToAlias[e.key]={enablingCallback:e.enablingCallback,disablingCallback:e.disablingCallback};delete e.enablingCallback;delete e.disablingCallback;return this._registerAliases(this.cloneableUtils.makeCloneable(e))}enable(e){if(this._featuresToAlias&&this._featuresToAlias[e]){this._featuresToAlias[e].enablingCallback()}else{this._remoteEnablingFromInner(e)}}disable(e){if(this._featuresToAlias&&this._featuresToAlias[e]){this._featuresToAlias[e].disablingCallback()}else{this._remoteDisablingFromInner(e).catch((e=>{this.logService.debug(`IFeatureService - disable: ${JSON.stringify(e)}`)}))}}getFeatureProperty(e,t){"proxyFunction";return null}addToolbarItem(e){"proxyFunction";return null}addDecorator(e){"proxyFunction";return null}addContextualMenuButton(e){"proxyFunction";return null}getFeatureKeys(){"proxyFunction";return null}_remoteEnablingFromInner(e){"proxyFunction";return null}_remoteDisablingFromInner(e){"proxyFunction";return null}_registerAliases(e){"proxyFunction";return null}_validate(e){if(K.isEmpty(e.key)){throw new Error("featureService.configuration.key.error.required")}if(K.isEmpty(e.nameI18nKey)){throw new Error("featureService.configuration.nameI18nKey.error.required")}if(!K.isFunction(e.enablingCallback)){throw new Error("featureService.configuration.enablingCallback.error.not.function")}if(!K.isFunction(e.disablingCallback)){throw new Error("featureService.configuration.disablingCallback.error.not.function")}}}class INotificationMouseLeaveDetectionService{startDetection(e,t,i){"proxyFunction";return null}stopDetection(){"proxyFunction";return null}_remoteStartDetection(e){"proxyFunction";return null}_remoteStopDetection(){"proxyFunction";return null}_callCallback(){"proxyFunction";return null}_onMouseMove(e){this._getBounds().then((t=>{const i=t&&e&&(e.clientX<t.x||e.clientX>t.x+t.width);const o=t&&e&&(e.clientY<t.y||e.clientY>t.y+t.height);if(i||o){this._onMouseLeave()}}))}_getBounds(){"proxyFunction";return null}_getCallback(){"proxyFunction";return null}_onMouseLeave(){this._getCallback().then((e=>{if(e){e();this.stopDetection()}else{this._callCallback().then((()=>{this.stopDetection()}))}}))}}class INotificationService{pushNotification(e){"proxyFunction";return null}removeNotification(e){"proxyFunction";return null}removeAllNotifications(){"proxyFunction";return null}}class IPageInfoService{getPageUID(){"proxyFunction";return null}getPageUUID(){"proxyFunction";return null}getCatalogVersionUUIDFromPage(){"proxyFunction";return null}isSameCatalogVersionOfPageAndPageTemplate(){"proxyFunction";return null}}class IPreviewService{constructor(e){this.urlUtils=e}createPreview(e){"proxyFunction";return null}updatePreview(e){"proxyFunction";return null}getResourcePathFromPreviewUrl(e){"proxyFunction";return null}updateUrlWithNewPreviewTicketId(e,t){return this.createPreview(t).then((t=>this.urlUtils.updateUrlParameter(e,"cmsTicketId",t.ticketId)))}}class IUrlService{openUrlInPopup(e){"proxyFunction";return null}path(e){"proxyFunction";return null}buildUriContext(e,t,i){const o={};o[Se]=e;o[fe]=t;o[ye]=i;return o}buildPageUriContext(e,t,i){const o={};o[Ie]=e;o[Ce]=t;o[be]=i;return o}}class IWaitDialogService{showWaitModal(e){"proxyFunction";return null}hideWaitModal(){"proxyFunction";return null}}class IIframeClickDetectionService{onIframeClick(){"proxyFunction";return null}registerCallback(e,t){"proxyFunction";return null}removeCallback(e){"proxyFunction"}}const prepareRuleConfiguration=function(e){this.ruleVerifyFunctions=this.ruleVerifyFunctions||{};this.ruleVerifyFunctions[e.names.join("-")]={verify:e.verify};delete e.verify;return e};const validateRule=function(e){if(!(e.names instanceof Array)){throw Error("Rule names must be array")}if(e.names.length<1){throw Error("Rule requires at least one name")}if(!e.verify){throw Error("Rule requires a verify function")}if(typeof e.verify!=="function"){throw Error("Rule verify must be a function")}};class IPermissionService{clearCache(){"proxyFunction";return}getPermission(e){"proxyFunction";return null}isPermitted(e){"proxyFunction";return null}registerPermission(e){"proxyFunction";return}registerRule(e){validateRule(e);e=prepareRuleConfiguration.bind(this)(e);this._registerRule(e)}registerDefaultRule(e){e=prepareRuleConfiguration.bind(this)(e);this._registerDefaultRule(e)}unregisterDefaultRule(){"proxyFunction";return}_registerRule(e){"proxyFunction";return}_registerDefaultRule(e){"proxyFunction";return}}class IResizeListener{unregister(e){"proxyFunction"}fix(e){"proxyFunction"}register(e,t){"proxyFunction"}init(){"proxyFunction"}dispose(){"proxyFunction"}}class IPositionRegistry{register(e){"proxyFunction"}unregister(e){"proxyFunction"}getRepositionedComponents(){"proxyFunction";return null}dispose(){"proxyFunction"}}class IRenderService{constructor(e,t,i,o,n,s,a,r,l){this.yjQuery=e;this.systemEventService=t;this.notificationService=i;this.pageInfoService=o;this.perspectiveService=n;this.crossFrameEventService=s;this.windowUtils=a;this.modalService=r;this.logService=l;this.KEY_CODES={ESC:27};this.HOTKEY_NOTIFICATION_CONFIGURATION={id:"HOTKEY_NOTIFICATION_ID",componentName:"PerspectiveSelectorHotkeyNotificationComponent"};this._bindEvents()}renderSlots(e){"proxyFunction";return null}renderComponent(e,t){"proxyFunction";return null}renderRemoval(e,t,i){"proxyFunction";return null}renderPage(e){"proxyFunction";return null}toggleOverlay(e){"proxyFunction";return null}refreshOverlayDimensions(){"proxyFunction";return null}blockRendering(e){"proxyFunction";return null}isRenderingBlocked(){"proxyFunction";return null}createComponent(e){"proxyFunction";return null}destroyComponent(e,t,i){"proxyFunction";return null}updateComponentSizeAndPosition(e,t){"proxyFunction";return null}_getDocument(){return document}_bindEvents(){this._getDocument().addEventListener("keyup",(e=>this._keyUpEventHandler(e)));this._getDocument().addEventListener("click",(()=>this._clickEvent()))}_keyUpEventHandler(e){if(!this._areAllModalWindowsClosed()){return Promise.resolve()}return this._shouldEnableKeyPressEvent(e).then((e=>{if(e){this._keyPressEvent()}}))}_shouldEnableKeyPressEvent(e){return new Promise((t=>this.pageInfoService.getPageUUID().then((i=>{if(i){return this.perspectiveService.isHotkeyEnabledForActivePerspective().then((i=>t(e.which===this.KEY_CODES.ESC&&i)))}return t(false)})).catch((()=>t(false)))))}_keyPressEvent(){this.isRenderingBlocked().then((e=>{if(!e){this.blockRendering(true);this.renderPage(false);this.notificationService.pushNotification(this.HOTKEY_NOTIFICATION_CONFIGURATION);this.systemEventService.publishAsync("OVERLAY_DISABLED")}else{this.blockRendering(false);this.renderPage(true);this.notificationService.removeNotification(this.HOTKEY_NOTIFICATION_CONFIGURATION.id)}}))}_clickEvent(){if(!this.windowUtils.isIframe()){this.crossFrameEventService.publish(rt).catch((e=>{this.logService.debug(`IRenderService - _clickEvent: ${e}`)}))}else if(this.windowUtils.isIframe()){this.crossFrameEventService.publish(lt).catch((e=>{this.logService.debug(`IRenderService - _clickEvent: ${e}`)}))}return this.isRenderingBlocked().then((e=>{if(e&&!this.windowUtils.isIframe()){this.blockRendering(false);this.renderPage(true);return this.notificationService.removeNotification(this.HOTKEY_NOTIFICATION_CONFIGURATION.id)}return null}))}_areAllModalWindowsClosed(){return!this.modalService.hasOpenModals()}}class IToolbarServiceFactory{getToolbarService(e){"proxyFunction";return null}}class IConfirmationModalService{confirm(e){"proxyFunction";return Promise.resolve(true)}}class ICatalogVersionPermissionService{hasWritePermission(e,t){"proxyFunction";return null}hasReadPermission(e,t){"proxyFunction";return null}hasWritePermissionOnCurrent(){"proxyFunction";return null}hasReadPermissionOnCurrent(){"proxyFunction";return null}hasSyncPermission(e,t,i){"proxyFunction";return null}hasSyncPermissionFromCurrentToActiveCatalogVersion(){"proxyFunction";return null}hasSyncPermissionToActiveCatalogVersion(e,t){"proxyFunction";return null}}class IDecoratorService{addMappings(e){"proxyFunction"}enable(e,t){"proxyFunction"}disable(e){"proxyFunction"}getDecoratorsForComponent(e,t){"proxyFunction";return null}}class IRestServiceFactory{get(e,t){"proxyFunction";return null}setDomain(e){"proxyFunction"}setBasePath(e){"proxyFunction"}setGlobalBasePath(e){"proxyFunction"}}class IDragAndDropCrossOrigin{initialize(){"proxyFunction"}}class IContextualMenuService{addItems(e){"proxyFunction"}removeItemByKey(e){"proxyFunction"}containsItem(e){"proxyFunction";return null}getContextualMenuByType(e){"proxyFunction";return null}refreshMenuItems(){"proxyFunction"}getContextualMenuItems(e){return null}}class ICatalogDetailsService{addItems(e,t){"proxyFunction"}getItems(){"proxyFunction";return null}}class ISmartEditContractChangeListener{_newMutationObserver(e){return null}_newIntersectionObserver(e){return null}_addToComponentQueue(e){return null}_componentsQueueLength(){return null}isExtendedViewEnabled(){return null}setEconomyMode(e){return null}initListener(){return null}_processQueue(){return null}isIntersecting(e){return null}_rawProcessQueue(){return null}_addComponents(e){return null}_removeComponents(e,t=false){return null}_registerSizeAndPositionListeners(e){return null}_unregisterSizeAndPositionListeners(e){return null}stopListener(){return null}_stopExpendableListeners(){return null}_startExpendableListeners(){return null}onComponentsAdded(e){return null}onComponentsRemoved(e){return null}onComponentChanged(e){return null}onComponentResized(e){return null}onComponentRepositioned(e){return null}onPageChanged(e){return null}}t.COMPONENT_IN_SLOT_STATUS=void 0;(function(e){e["ALLOWED"]="allowed";e["DISALLOWED"]="disallowed";e["MAYBEALLOWED"]="mayBeAllowed"})(t.COMPONENT_IN_SLOT_STATUS||(t.COMPONENT_IN_SLOT_STATUS={}));class ISlotRestrictionsService{getAllComponentTypesSupportedOnPage(){"proxyFunction";return null}getSlotRestrictions(e){"proxyFunction";return null}isSlotEditable(e){"proxyFunction";return null}isComponentAllowedInSlot(e,t){"proxyFunction";return null}determineComponentStatusInSlot(e,t){"proxyFunction";return null}}t.CMSPageTypes=void 0;(function(e){e["ContentPage"]="ContentPage";e["CategoryPage"]="CategoryPage";e["ProductPage"]="ProductPage";e["EmailPage"]="EmailPage"})(t.CMSPageTypes||(t.CMSPageTypes={}));t.CMSPageStatus=void 0;(function(e){e["ACTIVE"]="ACTIVE";e["DELETED"]="DELETED"})(t.CMSPageStatus||(t.CMSPageStatus={}));t.CmsApprovalStatus=void 0;(function(e){e["APPROVED"]="APPROVED";e["CHECK"]="CHECK";e["UNAPPROVED"]="UNAPPROVED"})(t.CmsApprovalStatus||(t.CmsApprovalStatus={}));class IPageService{getPageById(e){"proxyFunction";return null}getPageByUuid(e){"proxyFunction";return null}getCurrentPageInfo(){"proxyFunction";return null}getCurrentPageInfoByVersion(e){"proxyFunction";return null}isPagePrimary(e){"proxyFunction";return null}isPagePrimaryWithContext(e,t){"proxyFunction";return null}getPrimaryPage(e){"proxyFunction";return null}primaryPageForPageTypeExists(e,t){"proxyFunction";return null}getPaginatedPrimaryPagesForPageType(e,t,i){"proxyFunction";return null}getVariationPages(e){"proxyFunction";return null}updatePageById(e,t){"proxyFunction";return null}forcePageApprovalStatus(e){"proxyFunction";return null}isPageApproved(e){"proxyFunction";return null}buildUriContextForCurrentPage(e,t,i){"proxyFunction";return null}}t.JOB_STATUS=void 0;(function(e){e["RUNNING"]="RUNNING";e["ERROR"]="ERROR";e["FAILURE"]="FAILURE";e["FINISHED"]="FINISHED";e["UNKNOWN"]="UNKNOWN";e["ABORTED"]="ABORTED";e["PENDING"]="PENDING"})(t.JOB_STATUS||(t.JOB_STATUS={}));class ISyncPollingService{registerSyncPollingEvents(){"proxyFunction";return null}changePollingSpeed(e,t){"proxyFunction";return null}fetchSyncStatus(e,t){"proxyFunction";return null}performSync(e,t){"proxyFunction";return null}getSyncStatus(e,t,i){"proxyFunction";return null}}class IEditorModalService{open(e,t,i,o,n,s,a){"proxyFunction";return null}openAndRerenderSlot(e,t,i,o,n,s){"proxyFunction";return null}openGenericEditor(e,t,i,o){"proxyFunction";return null}}class IPageTreeNodeService{constructor(){this.slotNodes=[]}buildSlotNodes(){"proxyFunction"}updateSlotNodes(e){"proxyFunction"}getSlotNodes(){"proxyFunction";return null}scrollToElement(e){"proxyFunction";return null}existedSmartEditElement(e){"proxyFunction";return null}handleBodyWidthChange(){"proxyFunction";return null}_buildSlotNode(e){"proxyFunction";return null}_isValidElement(e){"proxyFunction";return true}}class IPageTreeService{registerTreeComponent(e){"proxyFunction";return null}getTreeComponent(){"proxyFunction";return null}}class IFileValidation{buildAcceptedFileTypesList(){"proxyFunction";return null}validate(e,t,i){"proxyFunction";return null}}class IUserTrackingService{initConfiguration(){"proxyFunction";return null}trackingUserAction(e,t){"proxyFunction"}}class IMediaToUpload{uploadMedia(e){return null}}class IMediaService{getPage(e,t,i,o){return null}getMedia(e){return null}}const ro=new n.InjectionToken("WIZARD_MANAGER");const lo=new n.InjectionToken("WIZARD_API");class WizardService{constructor(e,t){this.defaultWizardActionStrategy=e;this.stringUtils=t;this.onLoadStep=function(e,t){return};this.onClose=function(e){return};this.onCancel=function(){return};this.onStepsUpdated=function(e){return}}initialize(e){this.validateConfig(e);this._actionStrategy=e.actionStrategy||this.defaultWizardActionStrategy;this._actionStrategy.applyStrategy(this,e);this._currentIndex=0;this._conf=Object.assign({},e);this._steps=this._conf.steps;this._getResult=e.resultFn;this.validateStepUids(this._steps);this.goToStepWithIndex(0)}executeAction(e){if(e.executeIfCondition){const t=e.executeIfCondition();return(t instanceof Promise?t:Promise.resolve(t)).then((()=>e.execute(this)))}return Promise.resolve(e.execute(this))}goToStepWithIndex(e){const t=this.getStepWithIndex(e);if(t){this.onLoadStep(e,t);this._currentIndex=e}}goToStepWithId(e){this.goToStepWithIndex(this.getStepIndexFromId(e))}addStep(e,t){if(parseInt(e.id,10)!==0&&!e.id){e.id=this.stringUtils.generateIdentifier()}if(!t){t=0}if(this._currentIndex>=t){this._currentIndex++}this._steps.splice(t,0,e);this.validateStepUids(this._steps);this._actionStrategy.applyStrategy(this,this._conf);this.onStepsUpdated(this._steps)}removeStepById(e){this.removeStepByIndex(this.getStepIndexFromId(e))}removeStepByIndex(e){if(e>=0&&e<this.getStepsCount()){this._steps.splice(e,1);if(e===this._currentIndex){this.goToStepWithIndex(0)}this._actionStrategy.applyStrategy(this,this._conf);this.onStepsUpdated(this._steps)}}close(){let e;if(typeof this._getResult==="function"){e=this._getResult()}this.onClose(e)}cancel(){this.onCancel()}getSteps(){return this._steps}getStepIndexFromId(e){const t=this._steps.findIndex((t=>t.id===e));return t}containsStep(e){return this.getStepIndexFromId(e)>=0}getCurrentStepId(){return this.getCurrentStep().id}getCurrentStepIndex(){return this._currentIndex}getCurrentStep(){return this.getStepWithIndex(this._currentIndex)}getStepsCount(){return this._steps.length}getStepWithId(e){const t=this.getStepIndexFromId(e);if(t>=0){return this.getStepWithIndex(t)}return null}getStepWithIndex(e){if(e>=0&&e<this.getStepsCount()){return this._steps[e]}throw new Error("wizardService.getStepForIndex - Index out of bounds: "+e)}validateConfig(e){if(!e.steps||e.steps.length<=0){throw new Error("Invalid WizardService configuration - no steps provided")}}validateStepUids(e){const t={};e.forEach((e=>{if(!e.id){e.id=this.stringUtils.generateIdentifier()}else if(t[e.id]){throw new Error(`Invalid (Duplicate) step id: ${e.id}`)}else{t[e.id]=e.id}}))}}const co={id:"wizard_action_id",i18n:"wizard_action_label",isMainAction:true,enableIfCondition(){return true},executeIfCondition(){return true},execute(e){return}};class WizardActions{customAction(e){return this.createNewAction(e)}done(e){const t={id:"ACTION_SAVE",i18n:"se.action.save",execute:e=>{e.close()}};return this.createNewAction(e,t)}next(e){const t={id:"ACTION_NEXT",i18n:"se.action.next",execute(e){e.goToStepWithIndex(e.getCurrentStepIndex()+1)}};return this.createNewAction(e,t)}navBarAction(e){if(!e.wizardService||e.destinationIndex===null){throw new Error("Error initializating navBarAction, must provide the wizardService and destinationIndex fields")}const t={id:"ACTION_GOTO",i18n:"action.goto",enableIfCondition:()=>e.wizardService.getCurrentStepIndex()>=e.destinationIndex,execute:t=>{t.goToStepWithIndex(e.destinationIndex)}};return this.createNewAction(e,t)}back(e){const t={id:"ACTION_PREVIOUS",i18n:"se.action.previous",isMainAction:false,execute(e){const t=e.getCurrentStepIndex();if(t<=0){throw new Error("Failure to execute BACK action, no previous index exists!")}e.goToStepWithIndex(t-1)}};return this.createNewAction(e,t)}cancel(){return this.createNewAction({id:"ACTION_CANCEL",i18n:"se.action.cancel",isMainAction:false,execute(e){e.cancel()}})}createNewAction(e=null,t=null){return Object.assign(Object.assign(Object.assign({},co),t),e)}}let po=class DefaultWizardActionStrategy{constructor(e){this.wizardActions=e}applyStrategy(e,t){const i=this.applyOverrides(e,this.wizardActions.next(),t.nextLabel,t.onNext,t.isFormValid);const o=this.applyOverrides(e,this.wizardActions.done(),t.doneLabel,t.onDone,t.isFormValid);const n=t.backLabel?{i18n:t.backLabel}:null;const s=this.wizardActions.back(n);t.steps.forEach(((e,n)=>{e.actions=[];if(n>0){e.actions.push(s)}if(n===t.steps.length-1){e.actions.push(o)}else{e.actions.push(i)}}));t.cancelAction=this.applyOverrides(e,this.wizardActions.cancel(),t.cancelLabel,t.onCancel,null);t.templateOverride="modalWizardNavBarTemplate.html"}applyOverrides(e,t,i,o,n){if(i){t.i18n=i}if(o){t.executeIfCondition=function(){return o(e.getCurrentStepId())}}if(n){t.enableIfCondition=function(){return n(e.getCurrentStepId())}}return t}};po=__decorate([n.Injectable(),__metadata("design:paramtypes",[WizardActions])],po);window.__smartedit__.addDecoratorPayload("Component","ModalWizardTemplateComponent",{selector:"se-modal-wizard-template",template:`\n        <div id="yModalWizard">\n            <div class="se-modal-wizard-template">\n                <se-modal-wizard-nav-bar\n                    [navActions]="_wizardContext?.navActions"\n                    (executeAction)="executeAction($event)"></se-modal-wizard-nav-bar>\n                <se-modal-wizard-step-outlet\n                    [steps]="_wizardContext?._steps"\n                    [wizardService]="wizardService"\n                    [wizardApiInjector]="wizardInjector"></se-modal-wizard-step-outlet>\n            </div>\n        </div>\n    `});t.ModalWizardTemplateComponent=class ModalWizardTemplateComponent{constructor(e,t,i,o,n){this.modalManager=e;this.wizardActions=t;this.defaultWizardActionStrategy=i;this.componentFactoryResolver=o;this.injector=n}ngOnInit(){this.modalManager.getModalData().subscribe((e=>{this.wizardService=new WizardService(this.defaultWizardActionStrategy,ae);this.wizardService.properties=e.properties;if(e.component){this.createWizardApiInjector(e)}if(typeof this.getWizardConfig!=="function"){throw new Error("The provided controller must provide a getWizardConfig() function.")}const t=this.getWizardConfig();this._wizardContext={_steps:t.steps};this.executeAction=e=>{this.wizardService.executeAction(e)};this.wizardService.onLoadStep=(e,t)=>{this.modalManager.setTitle(t.title);if(t.component){this._wizardContext.component=t.component}this.modalManager.removeAllButtons();const i=(t.actions||[]).map((e=>this.convertActionToButtonConf(e)));this.modalManager.addButtons(i)};this.wizardService.onClose=e=>{this.modalManager.close(e)};this.wizardService.onCancel=()=>{this.modalManager.close()};this.wizardService.onStepsUpdated=e=>{this.setupNavBar(e);this._wizardContext._steps=e};this.wizardService.initialize(t);this.setupModal(t)}))}setupNavBar(e){this._wizardContext.navActions=e.map(((e,t)=>{const i=this.wizardActions.navBarAction({id:"NAV-"+e.id,stepIndex:t,wizardService:this.wizardService,destinationIndex:t,i18n:e.name,isCurrentStep:()=>i.stepIndex===this.wizardService.getCurrentStepIndex()});return i}))}setupModal(e){this._wizardContext.templateOverride=e.templateOverride;if(e.cancelAction){this.modalManager.setDismissCallback((()=>this.wizardService.executeAction(e.cancelAction)))}this.setupNavBar(e.steps)}convertActionToButtonConf(e){return{id:e.id,style:e.isMainAction?r.ModalButtonStyle.Primary:r.ModalButtonStyle.Default,label:e.i18n,action:r.ModalButtonAction.None,disabledFn:()=>!e.enableIfCondition(),callback:()=>{this.wizardService.executeAction(e);return m.of(null)}}}createWizardApiInjector(e){const t=n.Injector.create({providers:[{provide:ro,useValue:this.wizardService}],parent:this.injector});const i=this.componentFactoryResolver.resolveComponentFactory(e.component);const o=i.create(t).instance;K.assign(this,o);this.wizardInjector=n.Injector.create({providers:[{provide:lo,useValue:o}],parent:this.injector})}};t.ModalWizardTemplateComponent=__decorate([n.Component({selector:"se-modal-wizard-template",template:`\n        <div id="yModalWizard">\n            <div class="se-modal-wizard-template">\n                <se-modal-wizard-nav-bar\n                    [navActions]="_wizardContext?.navActions"\n                    (executeAction)="executeAction($event)"></se-modal-wizard-nav-bar>\n                <se-modal-wizard-step-outlet\n                    [steps]="_wizardContext?._steps"\n                    [wizardService]="wizardService"\n                    [wizardApiInjector]="wizardInjector"></se-modal-wizard-step-outlet>\n            </div>\n        </div>\n    `}),__metadata("design:paramtypes",[r.ModalManagerService,WizardActions,po,n.ComponentFactoryResolver,n.Injector])],t.ModalWizardTemplateComponent);t.ModalWizard=class ModalWizard{constructor(e){this.modalService=e}open(e){this.validateConfig(e);return new Promise(((i,o)=>{const n=this.modalService.open({component:t.ModalWizardTemplateComponent,templateConfig:{isDismissButtonVisible:true},data:e,config:{focusTrapped:false,backdropClickCloseable:false,dialogPanelClass:"se-wizard-dialog"}});n.afterClosed.subscribe(i,o)}))}validateConfig(e){if(!e.controller&&!e.component){throw new Error("WizardService - initialization exception. No controller nor component provided")}if(e.controller&&e.component){throw new Error("WizardService - initialization exception. Provide either controller or component")}}};t.ModalWizard=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.IModalService])],t.ModalWizard);window.__smartedit__.addDecoratorPayload("Component","ModalWizardNavBarComponent",{selector:"se-modal-wizard-nav-bar",template:`\n        <div class="se-modal-wizard__steps-container" *ngIf="navActions">\n            <fd-wizard [appendToWizard]="false" [displaySummaryStep]="true">\n                <fd-wizard-navigation>\n                    <ul fd-wizard-progress-bar size="md">\n                        <li\n                            [attr.id]="action.id"\n                            fd-wizard-step\n                            *ngFor="let action of navActions; let i = index"\n                            [status]="\n                                action.isCurrentStep()\n                                    ? 'current'\n                                    : action.enableIfCondition()\n                                    ? 'completed'\n                                    : 'upcoming'\n                            "\n                            [ngClass]="{ 'se-none-cursor': !action.enableIfCondition() }"\n                            [label]="action.i18n | translate"\n                            (click)="onClickAction(action)">\n                            <fd-wizard-step-indicator>{{ i + 1 }}</fd-wizard-step-indicator>\n                            <fd-wizard-content size="md"> </fd-wizard-content>\n                        </li>\n                    </ul>\n                </fd-wizard-navigation>\n            </fd-wizard>\n        </div>\n    `});t.ModalWizardNavBarComponent=class ModalWizardNavBarComponent{constructor(){this.executeAction=new n.EventEmitter}onClickAction(e){this.executeAction.emit(e)}};__decorate([n.Input(),__metadata("design:type",Array)],t.ModalWizardNavBarComponent.prototype,"navActions",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.ModalWizardNavBarComponent.prototype,"executeAction",void 0);t.ModalWizardNavBarComponent=__decorate([n.Component({selector:"se-modal-wizard-nav-bar",template:`\n        <div class="se-modal-wizard__steps-container" *ngIf="navActions">\n            <fd-wizard [appendToWizard]="false" [displaySummaryStep]="true">\n                <fd-wizard-navigation>\n                    <ul fd-wizard-progress-bar size="md">\n                        <li\n                            [attr.id]="action.id"\n                            fd-wizard-step\n                            *ngFor="let action of navActions; let i = index"\n                            [status]="\n                                action.isCurrentStep()\n                                    ? 'current'\n                                    : action.enableIfCondition()\n                                    ? 'completed'\n                                    : 'upcoming'\n                            "\n                            [ngClass]="{ 'se-none-cursor': !action.enableIfCondition() }"\n                            [label]="action.i18n | translate"\n                            (click)="onClickAction(action)">\n                            <fd-wizard-step-indicator>{{ i + 1 }}</fd-wizard-step-indicator>\n                            <fd-wizard-content size="md"> </fd-wizard-content>\n                        </li>\n                    </ul>\n                </fd-wizard-navigation>\n            </fd-wizard>\n        </div>\n    `})],t.ModalWizardNavBarComponent);window.__smartedit__.addDecoratorPayload("Component","ModalWizardStepOutletComponent",{selector:"se-modal-wizard-step-outlet",template:`\n        <ng-container *ngIf="steps && steps.length > 0">\n            <ng-container *ngFor="let step of steps">\n                <div\n                    [ngClass]="{\n                        'se-modal-wizard__content--visible': isActive(step)\n                    }"\n                    class="se-modal-wizard__content">\n                    <div *ngIf="step.component">\n                        <ng-container\n                            *ngComponentOutlet="\n                                step.component;\n                                injector: wizardApiInjector\n                            "></ng-container>\n                    </div>\n                </div>\n            </ng-container>\n        </ng-container>\n    `});t.ModalWizardStepOutletComponent=class ModalWizardStepOutletComponent{isActive(e){return this.wizardService.getCurrentStepId()===e.id}};__decorate([n.Input(),__metadata("design:type",Array)],t.ModalWizardStepOutletComponent.prototype,"steps",void 0);__decorate([n.Input(),__metadata("design:type",WizardService)],t.ModalWizardStepOutletComponent.prototype,"wizardService",void 0);__decorate([n.Input(),__metadata("design:type",n.Injector)],t.ModalWizardStepOutletComponent.prototype,"wizardApiInjector",void 0);t.ModalWizardStepOutletComponent=__decorate([n.Component({selector:"se-modal-wizard-step-outlet",template:`\n        <ng-container *ngIf="steps && steps.length > 0">\n            <ng-container *ngFor="let step of steps">\n                <div\n                    [ngClass]="{\n                        'se-modal-wizard__content--visible': isActive(step)\n                    }"\n                    class="se-modal-wizard__content">\n                    <div *ngIf="step.component">\n                        <ng-container\n                            *ngComponentOutlet="\n                                step.component;\n                                injector: wizardApiInjector\n                            "></ng-container>\n                    </div>\n                </div>\n            </ng-container>\n        </ng-container>\n    `})],t.ModalWizardStepOutletComponent);t.WizardModule=class WizardModule{};t.WizardModule=__decorate([n.NgModule({imports:[g.CommonModule,h.TranslateModule,u.WizardModule],providers:[t.ModalWizard,WizardActions,po],declarations:[t.ModalWizardTemplateComponent,t.ModalWizardNavBarComponent,t.ModalWizardStepOutletComponent],entryComponents:[t.ModalWizardTemplateComponent,t.ModalWizardNavBarComponent,t.ModalWizardStepOutletComponent]})],t.WizardModule);const mo=new n.InjectionToken("TOOLBAR_ITEM");t.ToolbarItemType=void 0;(function(e){e["TEMPLATE"]="TEMPLATE";e["ACTION"]="ACTION";e["HYBRID_ACTION"]="HYBRID_ACTION"})(t.ToolbarItemType||(t.ToolbarItemType={}));t.ToolbarSection=void 0;(function(e){e["left"]="left";e["middle"]="middle";e["right"]="right"})(t.ToolbarSection||(t.ToolbarSection={}));t.ToolbarDropDownPosition=void 0;(function(e){e["left"]="left";e["center"]="center";e["right"]="right"})(t.ToolbarDropDownPosition||(t.ToolbarDropDownPosition={}));class IToolbarService{constructor(e,t){this.logService=e;this.permissionService=t;this.aliases=[];this.actions={}}getActions(){return this.actions}getAliases(){return this.aliases}addItems(e){const t=e.filter((e=>{let t=true;if(!e.key){this.logService.error("addItems() - Cannot add item without key.");t=false}return t})).map((e=>{const t=e.key;this.actions[t]=e.callback;const i={key:t,name:e.nameI18nKey,iconClassName:e.iconClassName,description:e.descriptionI18nKey,icons:e.icons,type:e.type,priority:e.priority||500,section:e.section||"left",isOpen:false,component:e.component,actionButtonFormat:e.actionButtonFormat,keepAliveOnClose:e.keepAliveOnClose||false,contextComponent:e.contextComponent,dropdownPosition:e.dropdownPosition,permissions:e.permissions};return this._populateIsPermissionGranted(i)}));return Promise.all(t).then((e=>{if(e.length>0){this.addAliases(e)}}))}_populateIsPermissionGranted(e){if(e.permissions){return Promise.resolve(this.permissionService.isPermitted([{names:e.permissions}]).then((t=>{e.isPermissionGranted=t;return e})))}else{e.isPermissionGranted=true;return Promise.resolve(e)}}addAliases(e){"proxyFunction"}removeItemByKey(e){"proxyFunction"}_removeItemOnInner(e){"proxyFunction"}removeAliasByKey(e){"proxyFunction"}triggerActionOnInner(e){"proxyFunction"}}class TextTruncateService{truncateToNearestWord(e,t,i=""){if(K.isNil(t)||e>t.length){return new TruncatedText(t,t,false)}const o=/(\s)/g;const n=t.match(o);let s=0;if(!n){s=e}else{for(let i=0;i<n.length;i++){const o=this.getPositionOfCharacters(t,n[i],i+1);if(o>e){break}s=o}}const a=t.substr(0,s);return new TruncatedText(t,a,true,i)}getPositionOfCharacters(e,t,i){return e.split(t,i).join(t).length}}const go="FrequentlyChangingContent";const uo=new r.CacheAction(go);const ho="RarelyChangingContent";const _o=new r.CacheAction(ho);const vo=new r.EvictionTag({event:"AUTHORIZATION_SUCCESS"});const fo=new r.EvictionTag({event:"USER_HAS_CHANGED"});const yo=new r.EvictionTag({event:"CATALOG_SYNCHRONIZED_EVENT"});const So=new r.EvictionTag({event:"CATALOG_EVENT",relatedTags:[yo,fo]});const Co=new r.EvictionTag({event:"PAGE_CREATED_EVENT"});const bo=new r.EvictionTag({event:"PAGE_DELETED_EVENT"});const Io=new r.EvictionTag({event:"PAGE_UPDATED_EVENT"});const Eo=new r.EvictionTag({event:"PAGE_RESTORED_EVENT"});const wo=new r.EvictionTag({event:"PAGE_CHANGE"});const To=new r.EvictionTag({event:"pageEvictionTag",relatedTags:[Co,bo,Io]});const Po=new r.EvictionTag({event:"EVENT_CONTENT_CATALOG_UPDATE"});const Oo=new r.EvictionTag({event:"EVENT_PERSPECTIVE_CHANGED"});const Ao="/cmssmarteditwebservices/v1/sites/:siteUID/contentcatalogs";t.ContentCatalogRestService=class ContentCatalogRestService extends r.AbstractCachedRestService{constructor(e){super(e,Ao)}};t.ContentCatalogRestService=__decorate([r.CacheConfig({actions:[_o],tags:[fo,To,Po]}),r.OperationContextRegistered(Ao,["CMS","INTERACTIVE"]),n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory])],t.ContentCatalogRestService);t.ProductCatalogRestService=class ProductCatalogRestService extends r.AbstractCachedRestService{constructor(e){super(e,"/cmssmarteditwebservices/v1/sites/:siteUID/productcatalogs")}};t.ProductCatalogRestService=__decorate([r.CacheConfig({actions:[_o],tags:[fo]}),n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory])],t.ProductCatalogRestService);t.PermissionsRestService=class PermissionsRestService{constructor(e){this.URI="/permissionswebservices/v1/permissions/global/search";this.resource=e.get(this.URI)}get(e){return this.resource.queryByPost({principalUid:e.user},{permissionNames:e.permissionNames}).then((e=>({permissions:e.permissions})))}};t.PermissionsRestService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory])],t.PermissionsRestService);t.AuthorizationService=class AuthorizationService{constructor(e,t,i){this.logService=e;this.sessionService=t;this.permissionsRestService=i}hasGlobalPermissions(e){if(!e.length||e.length<1){throw new Error("permissionNames must be a non-empty array")}const onSuccess=t=>this.mergePermissionResults(t,e);const onError=()=>{this.logService.error("AuthorizationService - Failed to determine authorization for the following permissions: "+e.toString());return false};return this.getPermissions(e).then(onSuccess,onError)}getPermissionResult(e,t){const i=e.permissions.find((e=>e.key.toLowerCase()===t.toLowerCase()));return!!i&&i.value==="true"}mergePermissionResults(e,t){let i=!!t&&t.length>0;let o=0;while(i&&o<t.length){i=i&&this.getPermissionResult(e,t[o++])}return i}getPermissions(e){return this.sessionService.getCurrentUsername().then((t=>{if(!t){return{permissions:[]}}return this.permissionsRestService.get({user:t,permissionNames:e.join(",")})}))}};t.AuthorizationService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.LogService,r.ISessionService,t.PermissionsRestService])],t.AuthorizationService);t.CrossFrameEventServiceGateway=class CrossFrameEventServiceGateway{constructor(e){return e.createGateway("CROSS_FRAME_EVENT")}};t.CrossFrameEventServiceGateway.crossFrameEventServiceGatewayToken=new n.InjectionToken("crossFrameEventServiceGatewayToken");t.CrossFrameEventServiceGateway=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.GatewayFactory])],t.CrossFrameEventServiceGateway);window.__smartedit__.addDecoratorPayload("Injectable","CrossFrameEventService",{providedIn:"root"});t.CrossFrameEventService=class CrossFrameEventService{constructor(e,t,i){this.systemEventService=e;this.crossFrameEventServiceGateway=t;this.windowUtils=i}publish(e,t){const i=[this.systemEventService.publishAsync(e,t)];if(this.windowUtils.getGatewayTargetFrame()){i.push(this.crossFrameEventServiceGateway.publish(e,t))}return Promise.all(i)}subscribe(e,t){const i=this.systemEventService.subscribe(e,t);const o=this.crossFrameEventServiceGateway.subscribe(e,t);const unsubscribeFn=function(){i();o()};return unsubscribeFn}isIframe(){return this.windowUtils.isIframe()}};t.CrossFrameEventService=__decorate([n.Injectable({providedIn:"root"}),__param(1,n.Inject(t.CrossFrameEventServiceGateway.crossFrameEventServiceGatewayToken)),__metadata("design:paramtypes",[t.SystemEventService,MessageGateway,t.WindowUtils])],t.CrossFrameEventService);const xo="GatewayProxied";const Do=r.annotationService.getClassAnnotationFactory(xo);function GatewayProxiedAnnotationFactory(e){"ngInject";return r.annotationService.setClassAnnotationFactory(xo,(function(t){return function(i,o,n){i=new(o.bind(i))(...n);i.gatewayId=ee.buildServiceName(o);e.initForService(i,t.length>0?t:null);return i}}))}t.LanguageService=class LanguageService extends r.LanguageService{constructor(e,t,i,o,n,s,a,r){super(e,t,i,o,n,s,a,r);this.logService=e;this.translateService=t;this.promiseUtils=i;this.eventService=o;this.browserService=n;this.storageService=s;this.injector=a;this.languageServiceConstants=r}getLanguagesForSite(e){return this.languageRestService.get({siteUID:e}).then((e=>e.languages),(e=>{this.logService.error("LanguageService.getLanguagesForSite() - Error loading languages");return Promise.reject(e)}))}get languageRestService(){return this.injector.get(r.RestServiceFactory).get(this.languageServiceConstants.LANGUAGE_RESOURCE_URI)}};__decorate([r.Cached({actions:[r.rarelyChangingContent]}),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],t.LanguageService.prototype,"getLanguagesForSite",null);t.LanguageService=__decorate([n.Injectable(),__param(3,n.Inject(r.EVENT_SERVICE)),__param(7,n.Inject(r.LANGUAGE_SERVICE_CONSTANTS)),__metadata("design:paramtypes",[r.LogService,h.TranslateService,r.PromiseUtils,Object,r.BrowserService,r.IStorageService,n.Injector,Object])],t.LanguageService);var Ro;t.LanguageServiceGateway=Ro=class LanguageServiceGateway{constructor(e){Ro.instance=Ro.instance||e.createGateway("languageSwitch")}getInstance(){return Ro.instance}};t.LanguageServiceGateway=Ro=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.GatewayFactory])],t.LanguageServiceGateway);class IPerspectiveService{register(e){"proxyFunction";return null}switchTo(e){"proxyFunction";return null}hasActivePerspective(){"proxyFunction";return null}selectDefault(){"proxyFunction";return null}isEmptyPerspectiveActive(){"proxyFunction";return null}refreshPerspective(){"proxyFunction";return null}getActivePerspectiveKey(){"proxyFunction";return null}isHotkeyEnabledForActivePerspective(){"proxyFunction";return null}getActivePerspective(){"proxyFunction";return null}getPerspectives(){"proxyFunction";return null}}var Mo;t.GenericEditorStackService=Mo=class GenericEditorStackService{constructor(e,t){this.systemEventService=e;this.logService=t;this._editorsStacks={};this.systemEventService.subscribe(Mo.EDITOR_PUSH_TO_STACK_EVENT,this.pushEditorEventHandler.bind(this));this.systemEventService.subscribe(Mo.EDITOR_POP_FROM_STACK_EVENT,this.popEditorEventHandler.bind(this))}isAnyGenericEditorOpened(){return K.size(this._editorsStacks)>=1}areMultipleGenericEditorsOpened(){return K.size(this._editorsStacks)>1||K.some(this._editorsStacks,(e=>e.length>1))}getEditorsStack(e){return this._editorsStacks[e]||null}isTopEditorInStack(e,t){let i=false;const o=this._editorsStacks[e];if(o){const e=o[o.length-1];i=e&&e.editorId===t}return i}pushEditorEventHandler(e,t){this.validateId(t);const i=t.editorStackId;if(!this._editorsStacks[i]){this._editorsStacks[i]=[]}this._editorsStacks[i].push({component:t.component,componentType:t.componentType,editorId:t.editorId})}popEditorEventHandler(e,t){this.validateId(t);const i=t.editorStackId;const o=this._editorsStacks[i];if(!o){this.logService.warn("genericEditorStackService - Stack of editors not found. Cannot pop editor.");return}o.pop();if(o.length===0){delete this._editorsStacks[i]}}validateId(e){if(!e.editorStackId){throw new Error("genericEditorStackService - Must provide a stack id.")}}};t.GenericEditorStackService.EDITOR_PUSH_TO_STACK_EVENT="EDITOR_PUSH_TO_STACK_EVENT";t.GenericEditorStackService.EDITOR_POP_FROM_STACK_EVENT="EDITOR_POP_FROM_STACK_EVENT";t.GenericEditorStackService=Mo=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.SystemEventService,r.LogService])],t.GenericEditorStackService);t.NonValidationErrorInterceptor=class NonValidationErrorInterceptor{constructor(e,t){this.alertService=e;this.genericEditorStackService=t}predicate(e,t){return t.status===400}responseError(e,t){if(t.error&&t.error.errors){t.error.errors.filter((e=>{const t=e.type==="ValidationError";return!t||t&&!this.genericEditorStackService.isAnyGenericEditorOpened()})).forEach((e=>{this.alertService.showDanger({message:e.message||"se.unknown.request.error",duration:1e4,minWidth:"",mousePersist:true,dismissible:true,width:"300px"})}))}return Promise.reject(t)}};t.NonValidationErrorInterceptor=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.IAlertService,t.GenericEditorStackService])],t.NonValidationErrorInterceptor);t.PreviewErrorInterceptor=class PreviewErrorInterceptor{constructor(e,t,i){this.injector=e;this.logService=t;this.sharedDataService=i}predicate(e,t){return t.status===400&&e.url.indexOf(Ve)>-1&&!r.stringUtils.isBlank(e.body.pageId)&&this._hasUnknownIdentifierError(t.error.errors)}responseError(e,t){this.logService.info("The error 400 above on preview is expected in some scenarios, typically when switching catalogs from experience selector.");this.logService.info("Removing the pageId ["+e.body.pageId+"] and creating a preview for homepage");delete e.body.pageId;this.sharedDataService.update(Mi,(function(e){delete e.pageId;return e}));this.injector.get("iframeManagerService").setCurrentLocation(null);return this.injector.get(d.HttpClient).request(e).toPromise()}_hasUnknownIdentifierError(e){const t=e.filter((function(e){return e.type==="UnknownIdentifierError"}));return!!t.length}};t.PreviewErrorInterceptor=__decorate([n.Injectable(),__metadata("design:paramtypes",[n.Injector,r.LogService,r.ISharedDataService])],t.PreviewErrorInterceptor);t.ResourceNotFoundErrorInterceptor=class ResourceNotFoundErrorInterceptor{constructor(e,t){this.alertService=e;this.httpUtils=t}predicate(e,t){return t.status===404&&!this.httpUtils.isHTMLRequest(e,t)&&!this._isLanguageResourceRequest(e.url)}responseError(e,t){this.alertService.showDanger({message:t.statusText===r.StatusText.UNKNOW_ERROR?"se.unknown.request.error":t.message,duration:1e3,minWidth:"",mousePersist:true,dismissible:true,width:"300px"});return Promise.reject(t)}_isLanguageResourceRequest(e){const t=new RegExp(Bt.replace(/\:.*\//g,".*/"));return t.test(e)}};t.ResourceNotFoundErrorInterceptor=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.IAlertService,r.HttpUtils])],t.ResourceNotFoundErrorInterceptor);function operationContextInteractivePredicate(e,t){return t===Re.INTERACTIVE}function operationContextNonInteractivePredicate(e,t){return K.includes([Re.BACKGROUND_TASKS,Re.NON_INTERACTIVE,Re.BATCH_OPERATIONS],t)}function operationContextCMSPredicate(e,t){return t===Re.CMS}function operationContextToolingPredicate(e,t){return t===Re.TOOLING}t.InterceptorHelper=class InterceptorHelper{constructor(e){this.logService=e}handleRequest(e,t){return this._handle(e,e,t,false)}handleResponse(e,t){return this._handle(e,e.config,t,false)}handleResponseError(e,t){return this._handle(e,e.config,t,true)}_isEligibleForInterceptors(e){return e&&e.url&&!/.+\.html$/.test(e.url)}_handle(e,t,i,o){try{if(this._isEligibleForInterceptors(t)){return i()}else{if(o){return Promise.reject(e)}else{return e}}}catch(t){this.logService.error("caught error in one of the interceptors",t);if(o){return Promise.reject(e)}else{return e}}}};t.InterceptorHelper=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.LogService])],t.InterceptorHelper);t.PolyfillService=class PolyfillService{constructor(e){this.browserService=e}isEligibleForEconomyMode(){return this.browserService.isIE()}isEligibleForExtendedView(){return this.browserService.isIE()||this.browserService.isFF()}isEligibleForThrottledScrolling(){return this.browserService.isIE()}};t.PolyfillService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.BrowserService])],t.PolyfillService);t.PriorityService=class PriorityService{constructor(e){this.stringUtils=e}sort(e,t=true){return e.sort(((e,t)=>{let i=e.priority-t.priority;if(i===0){i=this.stringUtils.encode(e).localeCompare(this.stringUtils.encode(t))}return i}))}};t.PriorityService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.StringUtils])],t.PriorityService);t.SmarteditBootstrapGateway=class SmarteditBootstrapGateway{constructor(e){this.instance=this.instance||e.createGateway("smartEditBootstrap")}getInstance(){return this.instance}subscribe(e,t){return this.getInstance().subscribe(e,t)}publish(e,t,i=0,o){return this.getInstance().publish(e,t,i,o)}processEvent(e){return this.getInstance().processEvent(e)}};t.SmarteditBootstrapGateway=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.GatewayFactory])],t.SmarteditBootstrapGateway);t.NavigationEventSource=void 0;(function(e){e["SRC_URL"]="/"})(t.NavigationEventSource||(t.NavigationEventSource={}));t.SmarteditRoutingService=class SmarteditRoutingService{constructor(e,t,i){this.router=e;this.document=t;this.logService=i;this.listenersInitialized=false;this.routeChangeError$=new m.ReplaySubject;this.routeChangeStart$=new m.ReplaySubject;this.routeChangeSuccess$=new m.ReplaySubject;this.previousRouterUrl=""}init(){if(!this.listenersInitialized){this.notifyOnAngularRouteEvents();this.listenersInitialized=true}}go(e){return this.router.navigateByUrl(e)}path(){return this.router.url}absUrl(){return this.document.location.href}routeChangeStart(){this.warnAboutListenersNotInitialized();return this.routeChangeStart$.pipe(v.filter((e=>!!e.url&&e.url!==this.previousRouterUrl)),v.map((e=>e.routeData)))}routeChangeSuccess(){this.warnAboutListenersNotInitialized();return this.routeChangeSuccess$.pipe(v.filter((e=>!!e.url&&e.url!==this.previousRouterUrl)),v.map((e=>e.routeData)))}routeChangeError(){this.warnAboutListenersNotInitialized();return this.routeChangeError$.pipe(v.map((e=>e.routeData)))}reload(e=this.router.url){return this.router.navigateByUrl("/nulldummy",{skipLocationChange:true}).then((()=>this.router.navigateByUrl(e)))}getCurrentUrlFromEvent(e){if(e instanceof _.NavigationStart||e instanceof _.NavigationEnd||e instanceof _.NavigationError){return e.url}return null}warnAboutListenersNotInitialized(){if(!this.listenersInitialized){this.logService.warn("Listeners not initialized, run `init()` first.")}}notifyOnAngularRouteEvents(){this.router.events.subscribe((e=>{if(!e.url){return}switch(true){case e instanceof _.NavigationStart:{this.routeChangeStart$.next({from:t.NavigationEventSource.SRC_URL,url:e.url,routeData:e});break}case e instanceof _.NavigationError:{this.routeChangeError$.next({from:t.NavigationEventSource.SRC_URL,url:e.url,routeData:e});break}case e instanceof _.NavigationEnd:{this.routeChangeSuccess$.next({from:t.NavigationEventSource.SRC_URL,url:e.url,routeData:e});this.previousRouterUrl=e&&e.url;break}}}))}};t.SmarteditRoutingService=__decorate([__param(0,n.Optional()),__param(1,n.Inject(g.DOCUMENT)),__metadata("design:paramtypes",[_.Router,Document,r.LogService])],t.SmarteditRoutingService);t.AuthenticationManager=class AuthenticationManager extends r.IAuthenticationManagerService{constructor(e){super();this.routing=e}onLogout(){const e=this.routing.path();if(r.stringUtils.isBlank(e)||e==="/"){this.routing.reload()}else{this.routing.go("/")}}onUserHasChanged(){this.routing.reload()}};t.AuthenticationManager=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.SmarteditRoutingService])],t.AuthenticationManager);t.SettingsService=class SettingsService{constructor(e){this.restService=e.get(He)}load(){return this.restService.get()}get(e){return this.load().then((t=>t[e]))}getBoolean(e){return this.load().then((t=>t[e]===true||t[e]==="true"))}getStringList(e){return this.load().then((t=>t[e]))}};__decorate([r.Cached({actions:[_o]}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],t.SettingsService.prototype,"load",null);t.SettingsService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory])],t.SettingsService);class SeRouteService{static provideNgRoute(e,t){this.provideRouteShortcutConfigs(e);return _.RouterModule.forRoot(e,t)}static get routeShortcutConfigs(){return this.routeShortcuts}static provideRouteShortcutConfigs(e){const t=[];this.generateRouteShortcutConfig(t,e);t.filter((e=>this.canRegisterRouteShortcutConfig(e))).forEach((e=>{this.routeShortcuts.push(e)}))}static generateRouteShortcutConfig(e,t,i=""){t.forEach((t=>{if(t.path!==undefined){const o=this.getFullPath(i,t);e.push({fullPath:o,titleI18nKey:t.titleI18nKey,priority:t.priority,shortcutComponent:t.shortcutComponent})}if(t.children){const o=this.getFullPath(i,t);const n=t.path?o:i;this.generateRouteShortcutConfig(e,t.children,n)}}))}static getFullPath(e,t){return e?e+"/"+t.path:t.path}static canRegisterRouteShortcutConfig(e){if(e.fullPath===undefined){return false}let t=e.fullPath;this.CATALOG_AWARE_PATH_PLACEHOLDERS.forEach((e=>{t=t.replace(e,"")}));if(t.indexOf(":")>-1){return false}return true}}SeRouteService.CATALOG_AWARE_PATH_PLACEHOLDERS=[":siteId",":catalogId",":catalogVersion"];SeRouteService.routeShortcuts=[];const ko="yjQuery";function yjQueryServiceFactory(){const e="smarteditJQuery";if(!window[e]){if(o&&o.noConflict){window[e]=o.noConflict(true)}else{window[e]=o}}return window[e]}t.YjqueryModule=class YjqueryModule{};t.YjqueryModule=__decorate([n.NgModule({providers:[{provide:ko,useFactory:yjQueryServiceFactory},se.initialize((e=>{e.fn.extend({getCssPath(){let e;let t=this;while(t.length){const i=t[0];const o=i.className;if(i.tagName==="BODY"){break}t=t.parent();e=o+(e?">"+e:"")}return e}})}),[ko])]})],t.YjqueryModule);const No={root:null,threshold:0};const Fo={attributes:true,attributeOldValue:false,childList:true,characterData:false,subtree:true};t.InViewElementObserver=class InViewElementObserver{constructor(e,t,i){this.logService=e;this.document=t;this.yjQuery=i;this.componentsQueue=[];this.selectors=[];this.hasClassBasedSelectors=false}elementFromPoint(e){const t=this.document.elementFromPoint(e.x,e.y);return t||this.getInViewElements().find((t=>Q.isPointOverElement(e,t)))}addSelector(e,t){if(!ae.isBlank(e)&&this.selectors.map((e=>e.selector)).indexOf(e)===-1){if(/\.[\w]+/.test(e)){this.hasClassBasedSelectors=true}this.selectors.push({selector:e,callback:t});this.restart()}return()=>{const t=this.selectors.map((e=>e.selector)).indexOf(e);this.selectors.splice(t,1);this.restart()}}getAllElements(){return this.componentsQueue.map((e=>e.component))}getInViewElements(){return this.componentsQueue.filter((e=>e.isIntersecting)).map((e=>e.component))}restart(){this.stopListener();this.initListener()}stopListener(){if(this.mutationObserver){this.mutationObserver.disconnect();delete this.mutationObserver}if(this.intersectionObserver){this.intersectionObserver.disconnect();delete this.intersectionObserver}this.componentsQueue=[]}initListener(){if(!this.mutationObserver){this.mutationObserver=this._newMutationObserver(this._mutationObserverCallback.bind(this));if(!this.intersectionObserver){this.intersectionObserver=this._newIntersectionObserver((e=>{const t=e.filter((e=>this._isEligibleComponent(e.target)));t.forEach((e=>{this._updateQueue(e)}));this.selectors.filter((e=>!!e.callback)).forEach((e=>{if(t.find((t=>this.yjQuery(t.target).is(e.selector)))){e.callback()}}))}))}this._getEligibleElements().forEach((e=>{this.intersectionObserver.observe(e)}))}}_aggregateAddedOrRemovedNodes(e,t){const i=K.flatten(e.filter((e=>e.type===xe.CHILD_LIST.NAME&&(!!t&&e.addedNodes&&e.addedNodes.length||!t&&e.removedNodes&&e.removedNodes.length))).map((e=>{const i=K.flatten(Array.prototype.slice.call(t?e.addedNodes:e.removedNodes).filter((e=>e.nodeType===Node.ELEMENT_NODE)).map((e=>{const t=this._getAllEligibleChildren(e);return this._isEligibleComponent(e)?[e].concat(t):t}))).sort(Q.compareHTMLElementsPosition()).reverse();return i})));return K.uniqWith(i,((e,t)=>e.contains(t)||t.contains(e)))}_aggregateMutationsOnClass(e,t){return K.compact(e.filter((e=>e.target&&e.target.nodeType===Node.ELEMENT_NODE&&e.type===xe.ATTRIBUTES.NAME&&e.attributeName==="class")).map((e=>{if(t&&this._isEligibleComponent(e.target)){return e.target}else if(!t&&this._isEligibleComponent(e.target)){return e.target}return null})))}_mutationObserverCallback(e){this.logService.debug(e);this._aggregateAddedOrRemovedNodes(e,true).forEach((e=>{this.intersectionObserver.observe(e)}));if(this.hasClassBasedSelectors){this._aggregateMutationsOnClass(e,true).forEach((e=>{this.intersectionObserver.observe(e)}))}this._aggregateAddedOrRemovedNodes(e,false).forEach((e=>{const t=this._getComponentIndexInQueue(e);if(t!==-1){this.componentsQueue.splice(t,1)}}));if(this.hasClassBasedSelectors){this._aggregateMutationsOnClass(e,false).forEach((e=>{const t=this._getComponentIndexInQueue(e);if(t!==-1){this.componentsQueue.splice(t,1)}}))}}_updateQueue(e){const t=this._getComponentIndexInQueue(e.target);if(t!==-1){if(!e.intersectionRatio&&!this._isInDOM(e.target)){this.componentsQueue.splice(t,1)}else{this.componentsQueue[t].isIntersecting=!!e.intersectionRatio}}else if(this._isInDOM(e.target)){this.componentsQueue.push({component:e.target,isIntersecting:!!e.intersectionRatio})}}_newMutationObserver(e){const t=new MutationObserver(e);t.observe(this.document.body,K.merge(K.cloneDeep(Fo),{attributes:this.hasClassBasedSelectors}));return t}_newIntersectionObserver(e){return new IntersectionObserver(e,No)}_getJQuerySelector(){return this.selectors.map((e=>e.selector)).join(",")}_isEligibleComponent(e){return this.yjQuery(e).is(this._getJQuerySelector())}_getEligibleElements(){return Array.prototype.slice.call(this.yjQuery(this._getJQuerySelector()))}_getAllEligibleChildren(e){return Array.prototype.slice.call(e.querySelectorAll(this._getJQuerySelector()))}_getComponentIndexInQueue(e){return this.componentsQueue.findIndex((function(t){return e===t.component}))}_isInDOM(e){return this.yjQuery.contains(this.document.body,e)}};t.InViewElementObserver=__decorate([n.Injectable(),__param(1,n.Inject(g.DOCUMENT)),__param(2,n.Inject(ko)),__metadata("design:paramtypes",[r.LogService,Document,Function])],t.InViewElementObserver);var zo;t.DragAndDropScrollingService=zo=class DragAndDropScrollingService{constructor(e,t,i,o){this.windowUtils=e;this.translate=t;this.inViewElementObserver=i;this.yjQuery=o;this.SCROLLING_AREA_HEIGHT=50;this.FAST_SCROLLING_AREA_HEIGHT=25;this.SCROLLING_STEP=5;this.FAST_SCROLLING_STEP=15;this.topScrollArea=null;this.bottomScrollArea=null;this.throttleScrollingEnabled=false;this.inViewElementObserver.addSelector("#"+zo.TOP_SCROLL_AREA_ID);this.inViewElementObserver.addSelector("#"+zo.BOTTOM_SCROLL_AREA_ID);this.throttledScrollPage=K.throttle(this.scrollPage.bind(this),Si)}initialize(){this.scrollable=this.getFromElementSelector(this.windowUtils.getWindow().document.scrollingElement);this.addScrollAreas();this.addEventListeners();this.scrollDelta=0;this.initialized=true}deactivate(){this.removeEventListeners();this.scrollDelta=0;this.initialized=false}enable(){if(this.initialized){this.scrollLimitY=this.scrollable.get(0).scrollHeight-this.windowUtils.getWindow().innerHeight;this.showScrollAreas()}}disable(){if(this.initialized){const e=this.getScrollAreas();e.trigger("dragleave");e.hide()}}toggleThrottling(e){this.throttleScrollingEnabled=e}addScrollAreas(){this.topScrollArea=this.getFromSelector('<div id="'+zo.TOP_SCROLL_AREA_ID+'" class="'+bi+'"></div>').appendTo("body");this.bottomScrollArea=this.getFromSelector('<div id="'+zo.BOTTOM_SCROLL_AREA_ID+'" class="'+bi+'"></div>').appendTo("body");const e=this.getScrollAreas();e.height(this.SCROLLING_AREA_HEIGHT);this.topScrollArea.css({top:0});this.bottomScrollArea.css({bottom:0});e.hide();let t;let i;return this.translate.get("se.draganddrop.uihint.top").toPromise().then((e=>{t=e;return this.translate.get("se.draganddrop.uihint.bottom").toPromise()})).then((e=>{i=e;this.topScrollArea.text(t);this.bottomScrollArea.text(i)}))}addEventListeners(){const e=this.getScrollAreas();e.on("dragenter",this.onDragEnter.bind(this));e.on("dragover",this.onDragOver.bind(this));e.on("dragleave",this.onDragLeave.bind(this))}removeEventListeners(){const e=this.getScrollAreas();e.off("dragenter");e.off("dragover");e.off("dragleave");e.remove()}onDragEnter(e){let t=this.SCROLLING_STEP;const i=this.getFromSelector(e.target);const o=i.attr("id");if(o===zo.TOP_SCROLL_AREA_ID){t*=-1}this.scrollDelta=t;this.animationFrameId=this.windowUtils.getWindow().requestAnimationFrame(this.scrollPage.bind(this))}onDragOver(e){const t=e.originalEvent;const i=this.getFromSelector(t.target);const o=i.attr("id");if(o===zo.TOP_SCROLL_AREA_ID){if(t.clientY<=this.FAST_SCROLLING_AREA_HEIGHT){this.scrollDelta=-this.FAST_SCROLLING_STEP}else{this.scrollDelta=-this.SCROLLING_STEP}}else{const e=this.windowUtils.getWindow().innerHeight;if(t.clientY>=e-this.FAST_SCROLLING_AREA_HEIGHT){this.scrollDelta=this.FAST_SCROLLING_STEP}else{this.scrollDelta=this.SCROLLING_STEP}}}onDragLeave(){this.scrollDelta=0;this.windowUtils.getWindow().cancelAnimationFrame(this.animationFrameId)}scrollPage(){if(this.scrollDelta){const e=this.scrollable.scrollTop();let t=false;if(this.scrollDelta>0&&e<this.scrollLimitY){t=true}else if(this.scrollDelta<0&&e>0){t=true}if(t){const e=this.scrollable.scrollTop();const t=e+this.scrollDelta;this.scrollable.scrollTop(t);this.animationFrameId=this.windowUtils.getWindow().requestAnimationFrame(this.throttleScrollingEnabled?this.throttledScrollPage:this.scrollPage.bind(this))}this.showScrollAreas()}}getFromSelector(e){if(typeof e==="string"){return this.yjQuery(e)}else{return this.getFromHTMLSelector(e)}}getFromHTMLSelector(e){return this.yjQuery(e)}getFromElementSelector(e){return this.yjQuery(e)}getScrollAreas(){return this.yjQuery(["#"+zo.TOP_SCROLL_AREA_ID,"#"+zo.BOTTOM_SCROLL_AREA_ID].join(","))}showScrollAreas(){const e=this.scrollable.scrollTop();if(e===0){this.topScrollArea.hide()}else{this.topScrollArea.show()}if(e>=this.scrollLimitY){this.bottomScrollArea.hide()}else{this.bottomScrollArea.show()}}};t.DragAndDropScrollingService.TOP_SCROLL_AREA_ID="top_scroll_page";t.DragAndDropScrollingService.BOTTOM_SCROLL_AREA_ID="bottom_scroll_page";t.DragAndDropScrollingService=zo=__decorate([n.Injectable(),__param(3,n.Inject(ko)),__metadata("design:paramtypes",[r.WindowUtils,h.TranslateService,t.InViewElementObserver,Function])],t.DragAndDropScrollingService);var Lo;t.DragAndDropService=Lo=class DragAndDropService{constructor(e,t,i,o,n){this.yjQuery=e;this.dragAndDropScrollingService=t;this.inViewElementObserver=i;this.systemEventService=o;this.dragAndDropCrossOrigin=n;this.configurations={};this.isDragAndDropExecuting=false;this.dragAndDropCrossOrigin.initialize()}register(e){if(!e||!e.id){throw new Error("dragAndDropService - register(): Configuration needs an ID.")}this.configurations[e.id]=e;if(!r.stringUtils.isBlank(e.targetSelector)){this.inViewElementObserver.addSelector(e.targetSelector)}}unregister(e){e.forEach((e=>{const t=this.configurations[e];if(t){this.deactivateConfiguration(t);this.deactivateScrolling(t);delete this.configurations[e]}}))}applyAll(){K.forEach(this.configurations,(e=>{this.apply(e.id)}))}apply(e){const t=this.configurations[e];if(t){this.update(t.id);this.cacheDragImages(t);this.initializeScrolling(t)}}update(e){const t=this.configurations[e];if(t){this.deactivateConfiguration(t);this._update(t)}}markDragStarted(){this.setDragAndDropExecutionStatus(true);this.dragAndDropScrollingService.enable()}markDragStopped(){this.setDragAndDropExecutionStatus(false);this.dragAndDropScrollingService.disable()}_update(e){const t=K.isArray(e.sourceSelector)?e.sourceSelector:[e.sourceSelector];t.forEach((t=>{const i=this.getSelector(t+":not([draggable])");i.attr(Lo.DRAGGABLE_ATTR,"true");i.on("dragstart",this.onDragStart.bind(this,e));i.on("dragend",this.onDragEnd.bind(this,e))}));const i=this.getSelector(e.targetSelector+":not([draggable])");i.attr(Lo.DROPPABLE_ATTR,"true");i.on("dragenter",this.onDragEnter.bind(this,e));i.on("dragover",this.onDragOver.bind(this,e));i.on("drop",this.onDrop.bind(this,e));i.on("dragleave",this.onDragLeave.bind(this,e))}deactivateConfiguration(e){const t=Array.isArray(e.sourceSelector)?e.sourceSelector.join(","):e.sourceSelector;const i=this.getSelector(t);const o=this.getSelector(e.targetSelector);i.removeAttr(Lo.DRAGGABLE_ATTR);o.removeAttr(Lo.DROPPABLE_ATTR);i.off("dragstart");i.off("dragend");o.off("dragenter");o.off("dragover");o.off("dragleave");o.off("drop")}onDragStart(e,t){const i=t.originalEvent;this.setDragTransferData(e,i);setTimeout((()=>{const o=this.yjQuery(t.target).closest("."+Et);this.setDragAndDropExecutionStatus(true,o);this.dragAndDropScrollingService.enable();if(e.startCallback){e.startCallback(i)}}),0)}onDragEnd(e,t){const i=t.originalEvent;this.dragAndDropScrollingService.disable();if(this.isDragAndDropExecuting&&e.stopCallback){e.stopCallback(i)}this.setDragAndDropExecutionStatus(false)}onDragEnter(e,t){const i=t.originalEvent;i.preventDefault();if(this.isDragAndDropExecuting&&e.dragEnterCallback){e.dragEnterCallback(i)}}onDragOver(e,t){const i=t.originalEvent;i.preventDefault();if(this.isDragAndDropExecuting&&e.dragOverCallback){e.dragOverCallback(i)}}onDrop(e,t){const i=t.originalEvent;i.preventDefault();i.stopPropagation();if(i.relatedTarget&&i.relatedTarget.nodeType===3){return true}if(i.target===i.relatedTarget){return true}if(this.isDragAndDropExecuting&&e.dropCallback){e.dropCallback(i)}return false}onDragLeave(e,t){const i=t.originalEvent;i.preventDefault();if(this.isDragAndDropExecuting&&e.outCallback){e.outCallback(i)}}cacheDragImages(e){let t;if(e.helper){t=e.helper()}if(!t){return}if(typeof t==="string"){e._cachedDragImage=new Image;e._cachedDragImage.src=t}else{e._cachedDragImage=t}}setDragTransferData(e,t){t.dataTransfer.setData("Text",e.id);if(e._cachedDragImage&&t.dataTransfer.setDragImage){t.dataTransfer.setDragImage(e._cachedDragImage,0,0)}}getSelector(e){return this.yjQuery(e)}setDragAndDropExecutionStatus(e,t){this.isDragAndDropExecuting=e;this.systemEventService.publish(e?_i.DRAG_DROP_START:_i.DRAG_DROP_END,t)}initializeScrolling(e){if(e.enableScrolling&&this.browserRequiresCustomScrolling()){this.dragAndDropScrollingService.initialize()}}deactivateScrolling(e){if(e.enableScrolling&&this.browserRequiresCustomScrolling()){this.dragAndDropScrollingService.deactivate()}}browserRequiresCustomScrolling(){return true}};t.DragAndDropService.DRAGGABLE_ATTR="draggable";t.DragAndDropService.DROPPABLE_ATTR="data-droppable";t.DragAndDropService=Lo=__decorate([n.Injectable(),__param(0,n.Inject(ko)),__metadata("design:paramtypes",[Function,t.DragAndDropScrollingService,t.InViewElementObserver,t.SystemEventService,IDragAndDropCrossOrigin])],t.DragAndDropService);t.DragAndDropServiceModule=class DragAndDropServiceModule{};t.DragAndDropServiceModule=__decorate([n.NgModule({providers:[t.InViewElementObserver,t.DragAndDropScrollingService,t.DragAndDropService]})],t.DragAndDropServiceModule);const Vo={DROP:"drop",DRAG_ENTER:"dragenter",DRAG_OVER:"dragover",DRAG_LEAVE:"dragleave"};class StorageNamespaceConverter{static ERR_INVALID_NAMESPACED_ID(e){return new Error(`StorageNamespaceConverter - Invalid namespaced id [${e}]`)}static getNamespacedStorageId(e,t){return`${e}${this.separator}${t}`}static getStorageIdFromNamespacedId(e){const t=e.match(new RegExp(this.namespaceDecoderRegexStr));if(t&&t[2].length>0){return t[2]}throw StorageNamespaceConverter.ERR_INVALID_NAMESPACED_ID(e)}static getNamespaceFromNamespacedId(e){const t=e.match(new RegExp(this.namespaceDecoderRegexStr));if(t&&t[1].length>0){return t[1]}throw StorageNamespaceConverter.ERR_INVALID_NAMESPACED_ID(e)}}StorageNamespaceConverter.separator="<ns:id>";StorageNamespaceConverter.namespaceDecoderRegexStr="(.*)"+StorageNamespaceConverter.separator+"(.*)";class NamespacedStorageManager{constructor(e,t){this.storageManager=e;this.namespace=t}getStorage(e){e.storageId=this.getNamespaceStorageId(e.storageId);return this.storageManager.getStorage(e)}deleteStorage(e,t=false){return this.storageManager.deleteStorage(this.getNamespaceStorageId(e),t)}deleteExpiredStorages(e=false){return this.storageManager.deleteExpiredStorages(e)}hasStorage(e){return this.storageManager.hasStorage(this.getNamespaceStorageId(e))}registerStorageController(e){return this.storageManager.registerStorageController(e)}getNamespaceStorageId(e){return StorageNamespaceConverter.getNamespacedStorageId(this.namespace,e)}getStorageManager(){return this.storageManager}}class StorageManagerFactory{constructor(e){this.theOneAndOnlyStorageManager=e}static ERR_INVALID_NAMESPACE(e){return new Error(`StorageManagerFactory Error: invalid namespace [${e}]. Namespace must be a non-empty string`)}getStorageManager(e){this.validateNamespace(e);return new NamespacedStorageManager(this.theOneAndOnlyStorageManager,e)}validateNamespace(e){if(typeof e!=="string"||e.length<=0){throw StorageManagerFactory.ERR_INVALID_NAMESPACE(e)}}}class IStorageGateway{handleStorageRequest(e,t,i){"proxyFunction";return Promise.resolve()}}class IStorageManager{registerStorageController(e){"proxyFunction"}hasStorage(e){"proxyFunction";return null}getStorage(e){"proxyFunction";return null}deleteStorage(e,t){"proxyFunction";return Promise.resolve(true)}deleteExpiredStorages(e){"proxyFunction";return Promise.resolve(true)}}class IStorageManagerFactory{getStorageManager(e){"proxyFunction";return null}}class IStorageManagerGateway extends IStorageManager{getStorageSanitityCheck(e){"proxyFunction";return Promise.resolve(true)}}class IStoragePropertiesService{getProperty(e){"proxyFunction";return null}}const Uo=new n.InjectionToken("storageProperties");const Bo=new n.InjectionToken("doNotUseStorageManager");class Timer{constructor(e,t,i=1e3){this.zone=e;this._callback=t;this._duration=i;this._timer=null}isActive(){return!!this._timer}restart(e){this._duration=e||this._duration;this.stop();this.start()}start(e){this._duration=e||this._duration;this.zone.runOutsideAngular((()=>{this._timer=setInterval((()=>{try{if(this._callback){this._callback()}else{this.stop()}}catch(e){this.stop()}}),this._duration)}))}stop(){clearInterval(this._timer);this._timer=null}resetDuration(e){this._duration=e||this._duration}teardown(){this.stop();this._callback=null;this._duration=null;this._timer=null}}t.TimerService=class TimerService{constructor(e){this.ngZone=e}createTimer(e,t){return new Timer(this.ngZone,e,t)}};t.TimerService=__decorate([n.Injectable(),__metadata("design:paramtypes",[n.NgZone])],t.TimerService);t.JQueryUtilsService=class JQueryUtilsService{constructor(e,t,i,o){this.yjQuery=e;this.document=t;this.EXTENDED_VIEW_PORT_MARGIN=i;this.windowUtils=o}extractFromElement(e,t){const i=this.yjQuery(e);return i.filter(t).add(i.find(t))}unsafeParseHTML(e){return this.yjQuery.parseHTML(e,null,true)}isInDOM(e){return this.document.documentElement.contains(e)}isInExtendedViewPort(e){if(!this.document.documentElement.contains(e)){return false}const t=this.yjQuery(e);const i=Object.assign(Object.assign({},t.offset()),{width:t.outerWidth(),height:t.outerHeight()});const o=this.document.scrollingElement||this.document.documentElement;return Q.areIntersecting({left:-this.EXTENDED_VIEW_PORT_MARGIN+o.scrollLeft,width:this.windowUtils.getWindow().innerWidth+2*this.EXTENDED_VIEW_PORT_MARGIN,top:-this.EXTENDED_VIEW_PORT_MARGIN+o.scrollTop,height:this.windowUtils.getWindow().innerHeight+2*this.EXTENDED_VIEW_PORT_MARGIN},i)}};t.JQueryUtilsService=__decorate([n.Injectable(),__param(0,n.Inject(ko)),__param(1,n.Inject(g.DOCUMENT)),__param(2,n.Inject(oo)),__metadata("design:paramtypes",[Function,Document,Number,t.WindowUtils])],t.JQueryUtilsService);const jo=new n.InjectionToken("CATALOG_DETAILS_ITEM_DATA");window.__smartedit__.addDecoratorPayload("Injectable","L10nService",{providedIn:"root"});t.L10nService=class L10nService{constructor(e,t){this.languageService=e;this.languageSwitchSubject=new m.BehaviorSubject(null);this.languageSwitch$=this.languageSwitchSubject.asObservable();this.unRegSwitchLanguageEvent=t.subscribe(r.SWITCH_LANGUAGE_EVENT,(()=>this.resolveLanguage()))}ngOnDestroy(){this.unRegSwitchLanguageEvent();this.languageSwitchSubject.unsubscribe()}resolveLanguage(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.languageService.getResolveLocaleIsoCode();this.languageSwitchSubject.next(e)}))}};t.L10nService=__decorate([n.Injectable({providedIn:"root"}),__metadata("design:paramtypes",[t.LanguageService,t.CrossFrameEventService])],t.L10nService);class CustomHandlingStrategy{shouldProcessUrl(e){return true}extract(e){return e}merge(e,t){return e}}var Go;t.CMSModesService=Go=class CMSModesService{constructor(e){this.perspectiveService=e}isVersioningPerspectiveActive(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.perspectiveService.getActivePerspectiveKey();return e===Go.VERSIONING_PERSPECTIVE_KEY}))}};t.CMSModesService.BASIC_PERSPECTIVE_KEY="se.cms.perspective.basic";t.CMSModesService.ADVANCED_PERSPECTIVE_KEY="se.cms.perspective.advanced";t.CMSModesService.VERSIONING_PERSPECTIVE_KEY="se.cms.perspective.versioning";t.CMSModesService=Go=__decorate([n.Injectable(),__metadata("design:paramtypes",[IPerspectiveService])],t.CMSModesService);var Ho;const Wo=`/cmswebservices/v1/sites/${Se}/cmsitems`;const $o=new r.EvictionTag({event:zi});t.CmsitemsRestService=class CmsitemsRestService{constructor(e,t){this.restServiceFactory=e;this.catalogService=t;this.cmsitemsUuidsUri=`/cmswebservices/v1/sites/${Se}/cmsitems/uuids`;this.resource=e.get(Wo);this.versionedResource=e.get(Wo+"/:itemUuid");this.uuidsResource=e.get(this.cmsitemsUuidsUri)}getByIdAndVersion(e,t){return this.versionedResource.get({itemUuid:e,versionId:t})}get(e){return this.catalogService.retrieveUriContext().then((t=>{const i={catalogId:e.catalogId||t.CURRENT_CONTEXT_CATALOG,catalogVersion:e.catalogVersion||t.CURRENT_CONTEXT_CATALOG_VERSION};e=K.merge(i,e);return this.restServiceFactory.get(Wo).get(e)}))}getByIds(e,t){return this.getByIdsNoCache(e,t)}update(e,t){return this.resource.update(e,t)}delete(e){return this.resource.remove({identifier:e})}create(e){return this.catalogService.getCatalogVersionUUid().then((t=>{e.catalogVersion=e.catalogVersion||t;if(e.onlyOneRestrictionMustApply===undefined){e.onlyOneRestrictionMustApply=false}return this.resource.save(e)}))}getByIdsNoCache(e,t){e=Array.from(new Set(e));return this.catalogService.getCatalogVersionUUid().then((i=>{const o={catalogVersion:i,uuids:e,fields:t};return this.uuidsResource.save(o)}))}getById(e){return this.resource.getById(e)}};__decorate([r.Cached({actions:[_o],tags:[fo,$o]}),__metadata("design:type",Function),__metadata("design:paramtypes",[String,String]),__metadata("design:returntype",Promise)],t.CmsitemsRestService.prototype,"getByIdAndVersion",null);__decorate([r.Cached({actions:[_o],tags:[fo,$o]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],t.CmsitemsRestService.prototype,"get",null);__decorate([r.Cached({actions:[_o],tags:[fo,$o]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Array,String]),__metadata("design:returntype",Promise)],t.CmsitemsRestService.prototype,"getByIds",null);__decorate([r.InvalidateCache($o),__metadata("design:type",Function),__metadata("design:paramtypes",[typeof(Ho=typeof T!=="undefined"&&T)==="function"?Ho:Object,Object]),__metadata("design:returntype",Promise)],t.CmsitemsRestService.prototype,"update",null);__decorate([r.InvalidateCache($o),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],t.CmsitemsRestService.prototype,"delete",null);t.CmsitemsRestService=__decorate([r.OperationContextRegistered(Wo.replace(/CONTEXT_SITE_ID/,":CONTEXT_SITE_ID"),"CMS"),n.Injectable(),__metadata("design:paramtypes",[IRestServiceFactory,ICatalogService])],t.CmsitemsRestService);t.WorkflowActionStatus=void 0;(function(e){e["PENDING"]="pending";e["IN_PROGRESS"]="in_progress";e["PAUSED"]="paused";e["COMPLETED"]="completed";e["DISABLED"]="disabled";e["ENDED_THROUGH_END_OF_WORKFLOW"]="ended_through_end_of_workflow";e["TERMINATED"]="terminated"})(t.WorkflowActionStatus||(t.WorkflowActionStatus={}));t.WorkflowOperations=void 0;(function(e){e["CANCEL"]="CANCEL_WORKFLOW";e["MAKE_DECISION"]="MAKE_DECISION"})(t.WorkflowOperations||(t.WorkflowOperations={}));t.WorkflowStatus=void 0;(function(e){e["CONTINUED"]="continued";e["RUNNING"]="running";e["PAUSED"]="paused";e["FINISHED"]="finished";e["ABORTED"]="aborted";e["NEW"]="new"})(t.WorkflowStatus||(t.WorkflowStatus={}));const Ko="WORKFLOW_CREATED_EVENT";const qo="WORKFLOW_FINISHED_EVENT";const Yo=new r.EvictionTag({event:Ko});const Zo=new r.EvictionTag({event:qo});const Xo=new r.EvictionTag({event:"WORKFLOW_TASKS_MENU_OPENED_EVENT"});const Qo={INBOX_POLLING_TIMEOUT:2e4,INBOX_POLLING_PAGESIZE:10,INBOX_POLLING_CURRENTPAGE:0};t.WorkflowTasksPollingService=class WorkflowTasksPollingService{constructor(e,t,i){this.timerService=e;this.restServiceFactory=t;this.crossFrameEventService=i;this.resourceInboxURI="/cmssmarteditwebservices/v1/inbox/workflowtasks";this.subscribers=[];this.syncPollingTimer=null;this.savedHashedTasks=[];this.inboxRESTService=this.restServiceFactory.get(this.resourceInboxURI);this.crossFrameEventService.subscribe(r.EVENTS.AUTHORIZATION_SUCCESS,(()=>this.initPolling()));this.crossFrameEventService.subscribe(r.EVENTS.LOGOUT,(()=>this.stopPolling()));this.crossFrameEventService.subscribe(r.EVENTS.REAUTH_STARTED,(()=>this.stopPolling()));this.initPolling()}stopPolling(){if(this.syncPollingTimer.isActive()){this.syncPollingTimer.stop()}}startPolling(){if(!this.syncPollingTimer.isActive()){this.syncPollingTimer.restart(Qo.INBOX_POLLING_TIMEOUT)}}addSubscriber(e,t){this.subscribers.push({subscriber:e,callOnInit:t});return()=>this.unsubscribe(e)}initPolling(){this.syncPollingTimer=this.timerService.createTimer((()=>this.fetchInboxTasks(false)),Qo.INBOX_POLLING_TIMEOUT);this.fetchInboxTasks(true);this.startPolling()}unsubscribe(e){const t=this.subscribers.findIndex((t=>t.subscriber===e));if(t>-1){this.subscribers.splice(t,1)}}getNewTasks(e){return e.filter((e=>!this.savedHashedTasks.includes(this.encodeTask(e))))}saveNewHashedTasks(e){e.forEach((e=>this.savedHashedTasks.push(this.encodeTask(e))));const t=this.savedHashedTasks.length-Qo.INBOX_POLLING_PAGESIZE;if(t>0){for(let e=0;e<t;e++){this.savedHashedTasks.shift()}}}encodeTask(e){const t=s.cloneDeep(e);if(t.action){delete t.action.startedAgoInMillis}return ae.getEncodedString(t)}fetchInboxTasks(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.fetchTaskList();if(!t){this.stopPolling();return}const i=this.getNewTasks(t.tasks);this.saveNewHashedTasks(i);this.subscribers.forEach((o=>{if(!e||e&&!!o.callOnInit){o.subscriber(i,t.pagination)}}))}))}fetchTaskList(){return __awaiter(this,void 0,void 0,(function*(){try{return yield this.inboxRESTService.get({pageSize:Qo.INBOX_POLLING_PAGESIZE,currentPage:Qo.INBOX_POLLING_CURRENTPAGE})}catch(e){return Promise.reject()}}))}};t.WorkflowTasksPollingService=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.TimerService,IRestServiceFactory,t.CrossFrameEventService])],t.WorkflowTasksPollingService);t.OpenPageWorkflowMenu=void 0;(function(e){e["Default"]="Default";e["SwitchPerspective"]="SwitchPerspective"})(t.OpenPageWorkflowMenu||(t.OpenPageWorkflowMenu={}));t.WorkflowService=class WorkflowService{constructor(e,t,i,o,n,s,a,r,l,d,p,g,u){this.restServiceFactory=e;this.crossFrameEventService=t;this.systemEventService=i;this.sharedDataService=o;this.perspectiveService=n;this.catalogService=s;this.experienceService=a;this.workflowTasksPollingService=r;this.pageService=l;this.syncPollingService=d;this.cmsitemsRestService=p;this.translateService=g;this.storageService=u;this.workflowTasksCountSubject=new m.BehaviorSubject(0);this.resourceWorkflowURI=`/cmswebservices/v1/catalogs/${Ce}/versions/${be}/workflows`;this.resourceWorkflowActionsURI=`/cmswebservices/v1/catalogs/${Ce}/versions/${be}/workflows/:workflowCode/actions`;this.resourceWorkflowTemplateURI=`/cmswebservices/v1/catalogs/${Ce}/versions/${be}/workflowtemplates`;this.resourceWorkflowOperationsURI=`/cmswebservices/v1/catalogs/${Ce}/versions/${be}/workflows/:workflowCode/operations`;this.resourceWorkflowActionCommentsURI=`/cmswebservices/v1/catalogs/${Ce}/versions/${be}/workflows/:workflowCode/actions/:actionCode/comments`;this.resourceWorkflowEditableItemsURI=`/cmssmarteditwebservices/v1/catalogs/${Ce}/versions/${be}/workfloweditableitems`;this.resourceWorkflowInboxTasksURI=`/cmssmarteditwebservices/v1/inbox/workflowtasks`;this.workflowRESTService=this.restServiceFactory.get(this.resourceWorkflowURI);this.workflowTemplateRESTService=this.restServiceFactory.get(this.resourceWorkflowTemplateURI);this.workflowActionsRESTService=this.restServiceFactory.get(this.resourceWorkflowActionsURI);this.workflowInboxTasksRESTService=this.restServiceFactory.get(this.resourceWorkflowInboxTasksURI);this.workflowEditableItemsRESTService=this.restServiceFactory.get(this.resourceWorkflowEditableItemsURI);this.crossFrameEventService.subscribe(Xe,(()=>this.openPageWorkflowMenu()));this.crossFrameEventService.subscribe(Ye,(()=>this.openPageWorkflowMenu()));this.workflowTasksPollingService.addSubscriber(((e,t)=>{const i=t.totalCount||0;this.updateWorkflowTasksCount(i)}),true)}getWorkflows(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.workflowRESTService.get(e);return t.workflows}))}getWorkflowTemplates(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.workflowTemplateRESTService.get(e);return t.templates}))}getAllActionsForWorkflowCode(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.workflowActionsRESTService.get({workflowCode:e});return t.actions}))}cancelWorflow(e){this.workflowOperationsRESTService=this.restServiceFactory.get(this.resourceWorkflowOperationsURI.replace(":workflowCode",e.workflowCode));return this.workflowOperationsRESTService.save({operation:t.WorkflowOperations.CANCEL})}getWorkflowTemplateByCode(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getWorkflowTemplates({});const i=t.find((t=>t.code===e));return i}))}areWorkflowsEnabledOnCurrentCatalogVersion(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getWorkflowTemplates({});return e&&e.length>0}))}getActiveWorkflowForPageUuid(e){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getWorkflows({pageSize:1,currentPage:0,attachment:e,statuses:t.WorkflowStatus.RUNNING+","+t.WorkflowStatus.PAUSED});return i[0]===undefined?null:i[0]}))}isPageInWorkflow(e){return __awaiter(this,void 0,void 0,(function*(){return!!(yield this.getActiveWorkflowForPageUuid(e.uuid))}))}isUserParticipanInActiveAction(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.getActiveActionsForWorkflowCode(e);return t.length>0}))}getActiveActionsForWorkflowCode(e){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getAllActionsForWorkflowCode(e);return i.filter((e=>e.isCurrentUserParticipant&&(t.WorkflowActionStatus.IN_PROGRESS===e.status.toLowerCase()||t.WorkflowActionStatus.PAUSED===e.status.toLowerCase())))}))}getCommentsForWorkflowAction(e,t,i){this.workflowActionCommentsRESTService=this.restServiceFactory.get(this.resourceWorkflowActionCommentsURI.replace(":workflowCode",e).replace(":actionCode",t));return this.workflowActionCommentsRESTService.page(i)}getWorkflowInboxTasks(e){return this.workflowInboxTasksRESTService.page(e)}getTotalNumberOfActiveWorkflowTasks(){return this.workflowTasksCountSubject.asObservable()}updateWorkflowTasksCount(e){this.workflowTasksCountSubject.next(e)}getWorkflowEditableItems(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.workflowEditableItemsRESTService.get({itemUids:e});return t.editableItems}))}getResourceWorkflowURI(){return this.resourceWorkflowURI}getResourceWorkflowOperationsURI(){return this.resourceWorkflowOperationsURI}openPageWorkflowMenu(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.sharedDataService.get(Ni);if(e===t.OpenPageWorkflowMenu.Default){const e=yield this.perspectiveService.getActivePerspectiveKey();if(e===t.CMSModesService.BASIC_PERSPECTIVE_KEY||e===t.CMSModesService.ADVANCED_PERSPECTIVE_KEY){this.systemEventService.publish(Fi,true);this.sharedDataService.remove(Ni)}else{yield this.sharedDataService.set(Ni,t.OpenPageWorkflowMenu.SwitchPerspective);this.perspectiveService.switchTo(t.CMSModesService.ADVANCED_PERSPECTIVE_KEY)}}else if(e===t.OpenPageWorkflowMenu.SwitchPerspective){this.systemEventService.publish(Fi,true);this.sharedDataService.remove(Ni)}}))}loadExperienceAndOpenPageWorkflowMenu(e){return __awaiter(this,void 0,void 0,(function*(){if(e){const i=yield this.catalogService.getDefaultSiteForContentCatalog(e.attachments[0].catalogId);const o={siteId:i.uid,catalogId:e.attachments[0].catalogId,catalogVersion:e.attachments[0].catalogVersion,pageId:e.attachments[0].pageUid};if(!!ne.getGatewayTargetFrame()){const i=yield this.experienceService.compareWithCurrentExperience(o);const n=yield this.pageService.getCurrentPageInfo();if(i&&n&&n.displayStatus===e.action.status){yield this.sharedDataService.set(Ni,t.OpenPageWorkflowMenu.Default);this.openPageWorkflowMenu()}else{this._loadExperience(o)}}else{this._loadExperience(o)}}}))}pageHasUnavailableDependencies(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getPageSyncStatus();return!!e.unavailableDependencies&&e.unavailableDependencies.length>0}))}fetchPageTranslatedApprovalInfo(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getPageSyncStatus();const t=e.unavailableDependencies.map((({itemId:e})=>e));const i=yield this.cmsitemsRestService.getByIds(t).then((({response:e})=>e.map((({name:e})=>e)).join(", ")));return this.translateService.instant("se.cms.workflow.approval.info",{itemNames:i})}))}_loadExperience(e){this.storageService.setValueInLocalStorage("seselectedsite",e.siteId,false);this.experienceService.loadExperience(e).then((()=>{this.sharedDataService.set(Ni,t.OpenPageWorkflowMenu.Default)}))}getPageSyncStatus(){return __awaiter(this,void 0,void 0,(function*(){const{uuid:e}=yield this.pageService.getCurrentPageInfo();const t=yield this.catalogService.retrieveUriContext();return this.syncPollingService.getSyncStatus(e,t)}))}};__decorate([r.Cached({actions:[_o],tags:[wo,Oo,Xo,Zo,Yo]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],t.WorkflowService.prototype,"getWorkflows",null);__decorate([r.Cached({actions:[_o],tags:[wo]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],t.WorkflowService.prototype,"getWorkflowTemplates",null);__decorate([r.Cached({actions:[_o],tags:[wo,Xo,Zo,Yo]}),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],t.WorkflowService.prototype,"getAllActionsForWorkflowCode",null);t.WorkflowService=__decorate([n.Injectable(),__metadata("design:paramtypes",[IRestServiceFactory,t.CrossFrameEventService,t.SystemEventService,r.ISharedDataService,IPerspectiveService,ICatalogService,IExperienceService,t.WorkflowTasksPollingService,IPageService,ISyncPollingService,t.CmsitemsRestService,h.TranslateService,r.IStorageService])],t.WorkflowService);t.SyncPollingService=class SyncPollingService extends ISyncPollingService{constructor(){super()}};t.SyncPollingService=__decorate([Do("getSyncStatus","fetchSyncStatus","changePollingSpeed","registerSyncPollingEvents","performSync"),__metadata("design:paramtypes",[])],t.SyncPollingService);t.PageVersioningService=class PageVersioningService{constructor(e){this.restServiceFactory=e;this.pageVersionsServiceResourceURI=`/cmswebservices/v1/sites/${Ie}/cmsitems/:pageUuid/versions`;this.pageVersionsRollbackServiceResourceURI=`/cmswebservices/v1/sites/${Ie}/cmsitems/:pageUuid/versions/:versionId/rollbacks`;this.pageVersionRESTService=this.restServiceFactory.get(this.pageVersionsServiceResourceURI);this.pageVersionsRollbackRESTService=this.restServiceFactory.get(this.pageVersionsRollbackServiceResourceURI)}findPageVersions(e){return this.pageVersionRESTService.page(e)}getPageVersionForId(e,t){return this.pageVersionRESTService.get({pageUuid:e,identifier:t})}getResourceURI(){return this.pageVersionsServiceResourceURI}deletePageVersion(e,t){return this.pageVersionRESTService.remove({pageUuid:e,identifier:t})}rollbackPageVersion(e,t){return this.pageVersionsRollbackRESTService.save({pageUuid:e,versionId:t})}};t.PageVersioningService=__decorate([n.Injectable(),__metadata("design:paramtypes",[IRestServiceFactory])],t.PageVersioningService);t.PageVersionSelectionService=class PageVersionSelectionService{constructor(e,t,i,o,n,s,a){this.crossFrameEventService=e;this.alertService=t;this.experienceService=i;this.cMSModesService=o;this.pageInfoService=n;this.pageVersioningService=s;this.translateService=a;this.PAGE_VERSIONS_TOOLBAR_ITEM_KEY="se.cms.pageVersionsMenu";this.PAGE_VERSION_UNSELECTED_MSG_KEY="se.cms.versions.unselect.version";this.selectedPageVersionSubject=new m.BehaviorSubject(null);this.unSubEventPerspectiveChanged=this.crossFrameEventService.subscribe(Ye,(()=>this.removePageVersionOnPerspectiveChange()));this.unSubEventPerspectiveRefreshed=this.crossFrameEventService.subscribe(Xe,(()=>this.resetPageVersionContext()));this.unSubEventPageChange=this.crossFrameEventService.subscribe(r.EVENTS.PAGE_CHANGE,((e,t)=>this.initOnPageChange(t)));this.unSubSelectedPageVersion=this.selectedPageVersionSubject.subscribe((e=>this.selectedPageVersion=e))}ngOnDestroy(){this.unSubEventPerspectiveChanged();this.unSubEventPerspectiveRefreshed();this.unSubEventPageChange();this.unSubSelectedPageVersion.unsubscribe()}getSelectedPageVersion(){return this.selectedPageVersion}getSelectedPageVersion$(){return this.selectedPageVersionSubject.asObservable()}hideToolbarContextIfNotNeeded(){if(!this.selectedPageVersion){this.crossFrameEventService.publish(ui,this.PAGE_VERSIONS_TOOLBAR_ITEM_KEY)}}showToolbarContextIfNeeded(){if(this.selectedPageVersion){this.crossFrameEventService.publish(hi,this.PAGE_VERSIONS_TOOLBAR_ITEM_KEY)}}selectPageVersion(e){if(!this.isSameVersion(this.selectedPageVersion,e)){this.selectedPageVersionSubject.next(e);this.experienceService.updateExperience({versionId:e.uid});this.showToolbarContextIfNeeded();this.crossFrameEventService.publish(r.EVENTS.PAGE_SELECTED)}}deselectPageVersion(e=true){if(this.selectedPageVersion&&e){const e=this.translateService.instant(this.PAGE_VERSION_UNSELECTED_MSG_KEY);this.alertService.showInfo(e)}this.selectedPageVersionSubject.next(null);this.experienceService.updateExperience({versionId:null});this.crossFrameEventService.publish(ui,this.PAGE_VERSIONS_TOOLBAR_ITEM_KEY)}updatePageVersionDetails(e){this.selectedPageVersionSubject.next(e)}initOnPageChange(e){return __awaiter(this,void 0,void 0,(function*(){if(e.versionId&&!this.selectedPageVersion){const t=yield this.pageInfoService.getPageUUID();const i=yield this.pageVersioningService.getPageVersionForId(t,String(e.versionId));this.selectedPageVersionSubject.next(i);this.showToolbarContextIfNeeded();this.crossFrameEventService.publish(r.EVENTS.PAGE_SELECTED)}}))}isSameVersion(e,t){return e!==null&&t!==null?this.selectedPageVersion.uid===t.uid:false}removePageVersionOnPerspectiveChange(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.cMSModesService.isVersioningPerspectiveActive();if(this.selectedPageVersion){const t=yield this.pageInfoService.getPageUUID();if(!e||this.selectedPageVersion.itemUUID!==t){this.deselectPageVersion()}}}))}resetPageVersionContext(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.experienceService.getCurrentExperience();if(!e.versionId&&this.selectedPageVersion){this.selectedPageVersionSubject.next(null);this.hideToolbarContextIfNotNeeded()}else{this.showToolbarContextIfNeeded()}}))}};t.PageVersionSelectionService=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.CrossFrameEventService,r.IAlertService,IExperienceService,t.CMSModesService,IPageInfoService,t.PageVersioningService,h.TranslateService])],t.PageVersionSelectionService);const Jo=`You need to import RouterModule to enable theme settings via the url.`;t.ThemesService=class ThemesService{constructor(e,t,i,o){this._activatedRoute=e;this._sanitizer=t;this.restServiceFactory=i;this.languageService=o;this.onThemeQueryParamChange=new m.Subject;this._onDestroy$=new m.Subject;this.initThemes()}initThemes(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.languageService.getResolveLocale();this.themeRestService=this.restServiceFactory.get(`${Zi}?langIsoCode=${e}`);this.themes=yield this.themeRestService.get()}))}getThemes(){return this.themes}setThemeByRoute(e){const t=e||"theme";if(!this._activatedRoute){throw new Error(Jo)}this._activatedRoute.queryParams.pipe(v.takeUntil(this._onDestroy$),v.filter((e=>e&&e[t]))).subscribe((e=>this.propagateThemes(e[t])));const i=this.getNativeParameterByName(t);if(i){this.propagateThemes(i)}}getThemesFromURL(e){const t=e||"theme";const i=this.getNativeParameterByName(t);if(!i||n.isDevMode()){return}return{themeUrl:this.setTheme(i),customThemeUrl:this.setCustomTheme(i)}}setTheme(e){return this._sanitizer.bypassSecurityTrustResourceUrl(`static-resources/dist/smartedit-container-new/${e}/css_variables.css`)}setCustomTheme(e){return this._sanitizer.bypassSecurityTrustResourceUrl(`static-resources/dist/smartedit-container-new/${e}/${e}.css`)}getNativeParameterByName(e){e=e.replace(/[[\]]/g,"\\$&");const t=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`);const i=2;const o=t.exec(window.location.href);if(!o||!o[i]){return""}return decodeURIComponent(o[i].replace(/\+/g," "))}propagateThemes(e){this.onThemeQueryParamChange.next({themeUrl:this.setTheme(e),customThemeUrl:this.setCustomTheme(e)})}};t.ThemesService=__decorate([n.Injectable(),__param(0,n.Optional()),__metadata("design:paramtypes",[_.ActivatedRoute,f.DomSanitizer,IRestServiceFactory,t.LanguageService])],t.ThemesService);t.SlotRestrictionsService=class SlotRestrictionsService extends ISlotRestrictionsService{getAllComponentTypesSupportedOnPage(){return null}getSlotRestrictions(e){return null}isSlotEditable(e){return null}isComponentAllowedInSlot(e,t){return null}};t.SlotRestrictionsService=__decorate([Do("getAllComponentTypesSupportedOnPage","getSlotRestrictions","isSlotEditable","isComponentAllowedInSlot")],t.SlotRestrictionsService);t.EditorModalService=class EditorModalService extends IEditorModalService{};t.EditorModalService=__decorate([Do("open","openAndRerenderSlot","openGenericEditor")],t.EditorModalService);t.PageContentSlotsService=class PageContentSlotsService{constructor(e,t,i){this.crossFrameEventService=t;this.pageInfoService=i;this.resource=e.get(Li);this.crossFrameEventService.subscribe(r.EVENTS.PAGE_CHANGE,(()=>this.reloadPageContentSlots()))}getPageContentSlots(){return __awaiter(this,void 0,void 0,(function*(){if(!this.pageContentSlots){yield this.reloadPageContentSlots()}return this.pageContentSlots}))}getSlotStatus(e){return __awaiter(this,void 0,void 0,(function*(){yield this.getPageContentSlots();const t=s.first(this.pageContentSlots.filter((t=>t.slotId===e)));return t?t.slotStatus:null}))}isSlotShared(e){return __awaiter(this,void 0,void 0,(function*(){yield this.getPageContentSlots();const t=s.first(this.pageContentSlots.filter((t=>t.slotId===e)));return t&&t.slotShared}))}reloadPageContentSlots(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageInfoService.getPageUID();const t=yield this.resource.get({pageId:e});this.pageContentSlots=s.uniq(t.pageContentSlotList||[])}))}};t.PageContentSlotsService=__decorate([n.Injectable(),__metadata("design:paramtypes",[IRestServiceFactory,t.CrossFrameEventService,IPageInfoService])],t.PageContentSlotsService);class PageInfoService extends IPageInfoService{getPageUID(){return null}getPageUUID(){return null}getCatalogVersionUUIDFromPage(){return null}}PageInfoService.PATTERN_SMARTEDIT_CATALOG_VERSION_UUID=/smartedit-catalog-version-uuid\-(\S+)/;t.IComponentHandlerService=class IComponentHandlerService{constructor(e){this.yjQuery=e}reloadInner(){"proxyFunction";return}isExternalComponent(e,t){"proxyFunction";return Promise.resolve(true)}getOverlay(){return this.yjQuery("#"+at)}isOverlayOn(){return this.getOverlay().length&&this.getOverlay()[0].style.display!=="none"}getComponentUnderSlot(e,t,i,o){const n=this.buildComponentQuery(i,wt);const s=this.buildComponentQuery(e,t,o);const a=`${n} ${s}`;return this.yjQuery(a)}getComponent(e,t,i){return this.yjQuery(this.buildComponentQuery(e,t,i))}getOriginalComponentWithinSlot(e,t,i){return this.getComponentUnderSlot(e,t,i,dt)}getOriginalComponent(e,t){return this.getComponent(e,t,dt)}getOverlayComponentWithinSlot(e,t,i){return this.getComponentUnderSlot(e,t,i,Et)}getOverlayComponent(e){const t=this.getParentSlotForComponent(e.parent());if(t){return this.getComponentUnderSlot(e.attr(me),e.attr(ge),t,Et)}else{return this.getComponent(e.attr(me),e.attr(ge),Et)}}getComponentInOverlay(e,t){return this.getComponent(e,t,Et)}getParentSlotForComponent(e){const t=this.yjQuery(e).closest(`[${ge}=${wt}]`);return t.attr(me)}getComponentPositionInSlot(e,t){const i=this.getOriginalComponentsWithinSlot(e);return K.findIndex(i,(e=>this.getId(e)===t))}getOriginalComponentsWithinSlot(e){return this.yjQuery(this.buildComponentsInSlotQuery(e))}getSlotOperationRelatedId(e){e=this.yjQuery(e);const t=e.attr(pt);return t&&e.attr(xt)?t:e.attr(me)}getSlotOperationRelatedUuid(e){const t=this.yjQuery(e).attr(pt);return t&&this.yjQuery(e).attr(xt)?t:this.yjQuery(e).attr(bt)}getParent(e){e=this.yjQuery(e);let t=null;if(e.hasClass(dt)){t=dt}else if(e.hasClass(Et)){t=Et}if(r.stringUtils.isBlank(t)){throw new Error("componentHandlerService.getparent.error.component.from.unknown.layer")}return e.closest(`.${t}[${me}]`+`[${me}!='${e.attr(me)}']`)}getClosestSmartEditComponent(e){return this.yjQuery(e).closest("."+dt)}isSmartEditComponent(e){return this.yjQuery(e).hasClass(dt)}setId(e,t){return this.yjQuery(e).attr(me,t)}getId(e){return this.yjQuery(e).attr(me)}getUuid(e){return this.yjQuery(e).attr(bt)}getCatalogVersionUuid(e){return this.yjQuery(e).attr(ct)}setType(e,t){return this.yjQuery(e).attr(ge,t)}getType(e){return this.yjQuery(e).attr(ge)}getSlotOperationRelatedType(e){const t=this.yjQuery(e).attr(xt);return t&&this.yjQuery(e).attr(pt)?t:this.yjQuery(e).attr(ge)}getAllComponentsSelector(){return`.${dt}[${ge}!='ContentSlot']`}getAllSlotsSelector(){return`.${dt}[${ge}='ContentSlot']`}getParentSlotUuidForComponent(e){return this.yjQuery(e).closest(`[${ge}=${wt}]`).attr(bt)}getBodyClassAttributeByRegEx(e){try{const t=this.yjQuery("body").attr("class");return e.exec(t)[1]}catch(e){throw new Error(JSON.stringify({name:"InvalidStorefrontPageError",message:"Error: the page is not a valid storefront page."}))}}getFirstSmartEditComponentChildren(e){const t=this.yjQuery(e);const i=t[0];if(!i){return[]}const o=Array.from(i.getElementsByClassName(dt)).filter((e=>{let t=e.parentElement;while(t!==i){if(t.classList.contains(dt)){return false}t=t.parentElement}return true}));return this.yjQuery(o)}getComponentCloneInOverlay(e){const t=e.attr(pe);return this.yjQuery(`.${Et}[${pe}='${t}']`)}getAllSlotUids(){const e=this.yjQuery(this.getAllSlotsSelector());return Array.prototype.slice.call(e.map(((e,t)=>this.getId(t))))}buildComponentQuery(e,t,i){let o="";o+=i?"."+i:"";o+=`[${me}='${e}']`;o+=`[${ge}='${t}']`;return o}buildComponentsInSlotQuery(e){let t="";t+="."+dt;t+=`[${me}='${e}']`;t+=`[${ge}='${wt}']`;t+=" > ";t+=`[${me}]`;return t}};t.IComponentHandlerService=__decorate([__param(0,n.Inject(ko)),__metadata("design:paramtypes",[Function])],t.IComponentHandlerService);t.SlotSharedService=class SlotSharedService{constructor(e,t,i,o,n,s,a){this.pageContentSlotsService=e;this.pageInfoService=t;this.translateService=i;this.editorModalService=o;this.componentHandlerService=n;this.catalogService=s;this.sharedDataService=a}isSlotShared(e){return this.pageContentSlotsService.isSlotShared(e)}isGlobalSlot(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.componentHandlerService.isExternalComponent(e,t);const[o,n]=yield Promise.all([this.catalogService.isCurrentCatalogMultiCountry(),this.sharedDataService.get(Mi)]);const s=o||false;const a=this.isCurrentPageFromParentCatalog(n);return s&&(i||a&&!i)}))}setSharedSlotEnablementStatus(e){this.disableShareSlotStatus=e}areSharedSlotsDisabled(){return this.disableShareSlotStatus}replaceGlobalSlot(e){return __awaiter(this,void 0,void 0,(function*(){this.validateComponentAttributes(e);const t=yield this.constructCmsItemParameter(e);const i={title:"se.cms.slot.shared.replace.editor.title",structure:{attributes:[{cmsStructureType:"SlotSharedSlotTypeField",qualifier:"isSlotCustom",required:true},{cmsStructureType:"SlotSharedCloneActionField",qualifier:"cloneAction",required:true}]},contentApi:Wo,saveLabel:"se.cms.slot.shared.replace.editor.save",content:t,initialDirty:true};return this.editorModalService.openGenericEditor(i)}))}replaceSharedSlot(e){return __awaiter(this,void 0,void 0,(function*(){this.validateComponentAttributes(e);const t=yield this.constructCmsItemParameter(e);t.isSlotCustom=true;const i={title:"se.cms.slot.shared.replace.editor.title",structure:{attributes:[{cmsStructureType:"SlotSharedCloneActionField",qualifier:"cloneAction",required:true}]},contentApi:Wo,saveLabel:"se.cms.slot.shared.replace.editor.save",content:t,initialDirty:true};return this.editorModalService.openGenericEditor(i)}))}constructCmsItemParameter(e){return __awaiter(this,void 0,void 0,(function*(){const t=this.translateService.instant("se.cms.slot.shared.clone");const i=yield this.pageInfoService.getPageUID();const o=yield this.pageInfoService.getCatalogVersionUUIDFromPage();const n=`${i}-${e.smarteditComponentId}-${t}`;const s={name:n,smarteditComponentId:e.smarteditComponentId,contentSlotUuid:e.smarteditComponentUuid,itemtype:e.smarteditComponentType,catalogVersion:o,pageUuid:i,onlyOneRestrictionMustApply:false};return s}))}validateComponentAttributes(e){if(!e){throw new Error("Parameter: componentAttributes needs to be supplied!")}const t=["smarteditComponentId","smarteditComponentUuid","smarteditComponentType"];const i=t.find((t=>!e[t]));if(!!i){throw new Error(`Parameter: componentAttributes.${i} needs to be supplied!`)}}isCurrentPageFromParentCatalog(e){var t,i;const o=((t=e===null||e===void 0?void 0:e.pageContext)===null||t===void 0?void 0:t.catalogVersionUuid)||"";const n=((i=e===null||e===void 0?void 0:e.catalogDescriptor)===null||i===void 0?void 0:i.catalogVersionUuid)||"";const s=n!==o;return s}};t.SlotSharedService=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.PageContentSlotsService,IPageInfoService,h.TranslateService,IEditorModalService,t.IComponentHandlerService,ICatalogService,r.ISharedDataService])],t.SlotSharedService);t.ComponentMenuService=class ComponentMenuService{constructor(e,t,i){this.catalogService=e;this.experienceService=t;this.storageService=i;this.SELECTED_CATALOG_VERSION_COOKIE_NAME="se_catalogmenu_catalogversion_cookie"}hasMultipleContentCatalogs(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getPageContext();const t=yield this.getContentCatalogs();const i=t.find((t=>t.catalogId===e.catalogId));return!!i.parents&&i.parents.length>0}))}getContentCatalogs(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getPageContext();return e?this.catalogService.getContentCatalogsForSite(e.siteId):[]}))}getValidContentCatalogVersions(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getPageContext();const t=yield this.getContentCatalogs();let i=[];const o=t.find((t=>t.catalogId===e.catalogId));i.push(this.getActiveOrCurrentVersionForCatalog(e,o));const n=o.parents.map((t=>this.getActiveOrCurrentVersionForCatalog(e,t)));i=[...n,...i];return i}))}getInitialCatalogVersion(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.storageService.getValueFromLocalStorage(this.SELECTED_CATALOG_VERSION_COOKIE_NAME,false);const i=typeof t==="string"?t:null;const o=e.find((e=>e.id===i));return o?o:e[e.length-1]}))}persistCatalogVersion(e){return this.storageService.setValueInLocalStorage(this.SELECTED_CATALOG_VERSION_COOKIE_NAME,e,false)}getActiveOrCurrentVersionForCatalog(e,t){const i=t.versions.find((i=>{if(e.catalogId===t.catalogId){return e.catalogVersion===i.version}return i.active}));return{isCurrentCatalog:e.catalogVersion===i.version,catalogName:t.name?t.name:t.catalogName,catalogId:t.catalogId,catalogVersionId:i.version,id:i.uuid}}getPageContext(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.experienceService.getCurrentExperience();return e.pageContext}))}};t.ComponentMenuService=__decorate([n.Injectable(),__metadata("design:paramtypes",[ICatalogService,IExperienceService,r.IStorageService])],t.ComponentMenuService);const en=1024;const tn={ACCEPTED_FILE_TYPES:{VIDEO:["mp4","avi","x-msvideo","wmv","mpg","mpeg","flv"],IMAGE:["jpeg","jpg","gif","bmp","tiff","tif","png","svg"],PDF_DOCUMENT:["pdf"],DEFAULT:["jpeg","jpg","gif","bmp","tiff","tif","png","svg"]},DEFAULT_MAX_UPLOAD_FILE_SIZE:20,I18N_KEYS:{FILE_TYPE_INVALID:"se.upload.file.type.invalid",FILE_SIZE_INVALID:"se.upload.file.size.invalid"}};t.FileValidationService=class FileValidationService extends IFileValidation{constructor(e,t){super();this.fileMimeTypeService=e;this.fileValidatorFactory=t;this.validators=[{subject:"size",message:tn.I18N_KEYS.FILE_SIZE_INVALID,validate:(e,t)=>e<=t*en*en}]}validate(e,t,i){return __awaiter(this,void 0,void 0,(function*(){this.fileValidatorFactory.build(this.validators).validate(e,t,i);try{yield this.fileMimeTypeService.isFileMimeTypeValid(e);if(i.length>0){return Promise.reject(i)}return Promise.resolve()}catch(e){i.push({subject:"type",message:tn.I18N_KEYS.FILE_TYPE_INVALID});return Promise.reject(i)}}))}};t.FileValidationService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.FileMimeTypeService,r.FileValidatorFactory])],t.FileValidationService);t.MediaUploaderService=class MediaUploaderService extends IMediaToUpload{constructor(e){super();this.restServiceFactory=e;this.mediaRestService=this.restServiceFactory.get(xi)}uploadMedia(e){var t;const i=new FormData;K.forEach(e,((e,t)=>{i.append(t,e)}));return this.mediaRestService.save(i,{headers:{enctype:"multipart/form-data",fileSize:""+((t=e===null||e===void 0?void 0:e.file)===null||t===void 0?void 0:t.size)}})}};t.MediaUploaderService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory])],t.MediaUploaderService);t.MediaService=class MediaService extends IMediaService{constructor(e){super();this.restServiceFactory=e}getPage(e,t,i,o){return __awaiter(this,void 0,void 0,(function*(){const n={catalogId:fe,catalogVersion:ye};const s=this.contextParamsToCommaSeparated(n);const a={params:s,mask:e,pageSize:t,currentPage:i,mimeType:o};const r=yield this.restServiceFactory.get(Ri).get(a);const l={results:[],pagination:r.pagination};l.results=r.media.map((e=>this.mediaDTOtoMedia(e)));return l}))}getMedia(e){return __awaiter(this,void 0,void 0,(function*(){const t=`${Di}/${e}`;const i=yield this.restServiceFactory.get(t).get();return this.mediaDTOtoMedia(i)}))}contextParamsToCommaSeparated(e){return Object.keys(e).reduce(((t,i)=>{t+=`,${i}:${e[i]}`;return t}),"").substring(1)}mediaDTOtoMedia(e){const t=["catalogId","catalogVersion","uuid"];const i={};Object.getOwnPropertyNames(e).filter((e=>t.indexOf(e)===-1)).forEach((t=>i[t]=e[t]));i.id=e.uuid;return i}};t.MediaService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory])],t.MediaService);const on=new n.InjectionToken("DROPDOWN_MENU_ITEM_DATA");window.__smartedit__.addDecoratorPayload("Component","DropdownMenuItemDefaultComponent",{selector:"se-dropdown-menu-item-default",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<a fd-list-link class="se-dropdown-item" [ngClass]="data.dropdownItem.customCss" (click)="data.dropdownItem.callback(data.selectedItem, data.dropdownItem)"><span *ngIf="data.dropdownItem.icon" [ngClass]="data.dropdownItem.icon"></span> <span fd-list-title>{{ data.dropdownItem.key | translate }}</span></a>`});t.DropdownMenuItemDefaultComponent=class DropdownMenuItemDefaultComponent{constructor(e){this.data=e}};t.DropdownMenuItemDefaultComponent=__decorate([n.Component({selector:"se-dropdown-menu-item-default",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<a fd-list-link class="se-dropdown-item" [ngClass]="data.dropdownItem.customCss" (click)="data.dropdownItem.callback(data.selectedItem, data.dropdownItem)"><span *ngIf="data.dropdownItem.icon" [ngClass]="data.dropdownItem.icon"></span> <span fd-list-title>{{ data.dropdownItem.key | translate }}</span></a>`}),__param(0,n.Inject(on)),__metadata("design:paramtypes",[Object])],t.DropdownMenuItemDefaultComponent);const nn={expandedByDefault:false,iconAlignment:"right",iconVisible:true};window.__smartedit__.addDecoratorPayload("Component","CollapsibleContainerComponent",{selector:"se-collapsible-container",template:`<div role="tab" class="collapsible-container__header" [ngClass]="{\n        'collapsible-container__header--icon-right': isIconRight(),\n        'collapsible-container__header--icon-left': isIconLeft()\n    }" [attr.id]="headingId" [attr.aria-selected]="isOpen" (keypress)="handleKeypress($event)"><button type="button" tabindex="0" class="collapsible-container__header__title" (click)="toggle()" [attr.aria-expanded]="isOpen" [attr.aria-controls]="panelId"><ng-content select="se-collapsible-container-header"></ng-content></button> <a class="collapsible-container__header__button btn btn-link" *ngIf="configuration.iconVisible" [ngClass]="{\n            'collapsible-container__header__button--expanded': isOpen\n        }" [title]="isOpen\n            ? ('se.ycollapsible.action.collapse' | translate)\n            : ('se.ycollapsible.action.expand' | translate)\n        " [attr.aria-expanded]="isOpen" (click)="toggle()"><span class="sap-icon--navigation-down-arrow collapsible-container__header__icon"></span></a></div><div #container class="collapsible-container__content panel" [ngStyle]="{ 'max-height.px': isOpen ? containerHeight : 0 }" [attr.id]="panelId" [attr.aria-labelledby]="headingId" [attr.aria-hidden]="!isOpen" role="tabpanel"><ng-content select="se-collapsible-container-content"></ng-content></div>`,styles:[`.collapsible-container__content{overflow:hidden;display:block;transition:max-height .4s ease;width:100%;background-color:#fff}.collapsible-container__header{max-width:100%;background-color:#fff;display:flex;align-items:center;min-height:50px;box-shadow:0 1px 1px rgba(0,0,0,.05)}.collapsible-container__header__title{text-align:left;background:0 0;border:0;outline:0;flex:1;display:flex;align-items:center;min-height:50px;text-decoration:none;user-select:none}.collapsible-container__header__title:hover{text-decoration:none}.collapsible-container__header__button{flex:0;transition:all .4s ease;font-size:20px}.collapsible-container__header__button--expanded{transform:rotate(180deg)}.collapsible-container__header--icon-right .collapsible-container__header__title{order:1}.collapsible-container__header--icon-right .collapsible-container__header__button{order:2}.collapsible-container__header--icon-left .collapsible-container__header__title{order:2}.collapsible-container__header--icon-left .collapsible-container__header__button{order:1}:host(.se-collapsible-container--noshadow) .collapsible-container__content.panel{box-shadow:none}`],changeDetection:n.ChangeDetectionStrategy.OnPush});t.CollapsibleContainerComponent=class CollapsibleContainerComponent{constructor(e){this.cdr=e;this.getApi=new n.EventEmitter;this.containerHeight=0;this.headingId=ae.generateIdentifier();this.panelId=ae.generateIdentifier();this.api={isExpanded:()=>this.isOpen}}set _container(e){this.container=e;this.containerHeight=e.nativeElement.scrollHeight;if(!this.mutationObserver&&this.container&&this.container.nativeElement){this.mutationObserver=new MutationObserver((()=>{this.containerHeight=this.container.nativeElement.scrollHeight;if(!this.cdr.destroyed){this.cdr.detectChanges()}}));this.mutationObserver.observe(this.container.nativeElement,{childList:true,subtree:true,attributes:true})}}ngOnDestroy(){this.mutationObserver.disconnect()}ngOnChanges(e){if(e.configuration){this.configure()}}ngOnInit(){this.configure();this.isOpen=this.configuration.expandedByDefault;this.getApi.emit(this.api)}toggle(){this.isOpen=!this.isOpen}handleKeypress(e){if(e.code==="Enter"){this.toggle()}}isIconRight(){return this.configuration.iconAlignment==="right"}isIconLeft(){return this.configuration.iconAlignment==="left"}configure(){this.configuration=Object.assign(Object.assign({},nn),this.configuration||{})}};__decorate([n.Input(),__metadata("design:type",Object)],t.CollapsibleContainerComponent.prototype,"configuration",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.CollapsibleContainerComponent.prototype,"getApi",void 0);__decorate([n.ViewChild("container",{static:true}),__metadata("design:type",n.ElementRef),__metadata("design:paramtypes",[n.ElementRef])],t.CollapsibleContainerComponent.prototype,"_container",null);t.CollapsibleContainerComponent=__decorate([n.Component({selector:"se-collapsible-container",template:`<div role="tab" class="collapsible-container__header" [ngClass]="{\n        'collapsible-container__header--icon-right': isIconRight(),\n        'collapsible-container__header--icon-left': isIconLeft()\n    }" [attr.id]="headingId" [attr.aria-selected]="isOpen" (keypress)="handleKeypress($event)"><button type="button" tabindex="0" class="collapsible-container__header__title" (click)="toggle()" [attr.aria-expanded]="isOpen" [attr.aria-controls]="panelId"><ng-content select="se-collapsible-container-header"></ng-content></button> <a class="collapsible-container__header__button btn btn-link" *ngIf="configuration.iconVisible" [ngClass]="{\n            'collapsible-container__header__button--expanded': isOpen\n        }" [title]="isOpen\n            ? ('se.ycollapsible.action.collapse' | translate)\n            : ('se.ycollapsible.action.expand' | translate)\n        " [attr.aria-expanded]="isOpen" (click)="toggle()"><span class="sap-icon--navigation-down-arrow collapsible-container__header__icon"></span></a></div><div #container class="collapsible-container__content panel" [ngStyle]="{ 'max-height.px': isOpen ? containerHeight : 0 }" [attr.id]="panelId" [attr.aria-labelledby]="headingId" [attr.aria-hidden]="!isOpen" role="tabpanel"><ng-content select="se-collapsible-container-content"></ng-content></div>`,styles:[`.collapsible-container__content{overflow:hidden;display:block;transition:max-height .4s ease;width:100%;background-color:#fff}.collapsible-container__header{max-width:100%;background-color:#fff;display:flex;align-items:center;min-height:50px;box-shadow:0 1px 1px rgba(0,0,0,.05)}.collapsible-container__header__title{text-align:left;background:0 0;border:0;outline:0;flex:1;display:flex;align-items:center;min-height:50px;text-decoration:none;user-select:none}.collapsible-container__header__title:hover{text-decoration:none}.collapsible-container__header__button{flex:0;transition:all .4s ease;font-size:20px}.collapsible-container__header__button--expanded{transform:rotate(180deg)}.collapsible-container__header--icon-right .collapsible-container__header__title{order:1}.collapsible-container__header--icon-right .collapsible-container__header__button{order:2}.collapsible-container__header--icon-left .collapsible-container__header__title{order:2}.collapsible-container__header--icon-left .collapsible-container__header__button{order:1}:host(.se-collapsible-container--noshadow) .collapsible-container__content.panel{box-shadow:none}`],changeDetection:n.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[n.ChangeDetectorRef])],t.CollapsibleContainerComponent);window.__smartedit__.addDecoratorPayload("Component","CollapsibleContainerContentComponent",{selector:"se-collapsible-container-content",template:` <ng-content></ng-content> `});t.CollapsibleContainerContentComponent=class CollapsibleContainerContentComponent{};t.CollapsibleContainerContentComponent=__decorate([n.Component({selector:"se-collapsible-container-content",template:` <ng-content></ng-content> `})],t.CollapsibleContainerContentComponent);window.__smartedit__.addDecoratorPayload("Component","CollapsibleContainerHeaderComponent",{selector:"se-collapsible-container-header",template:` <ng-content></ng-content> `});t.CollapsibleContainerHeaderComponent=class CollapsibleContainerHeaderComponent{};t.CollapsibleContainerHeaderComponent=__decorate([n.Component({selector:"se-collapsible-container-header",template:` <ng-content></ng-content> `})],t.CollapsibleContainerHeaderComponent);t.CollapsibleContainerModule=class CollapsibleContainerModule{};t.CollapsibleContainerModule=__decorate([n.NgModule({imports:[h.TranslateModule.forChild(),g.CommonModule],declarations:[t.CollapsibleContainerComponent,t.CollapsibleContainerContentComponent,t.CollapsibleContainerHeaderComponent],entryComponents:[t.CollapsibleContainerComponent,t.CollapsibleContainerContentComponent,t.CollapsibleContainerHeaderComponent],exports:[t.CollapsibleContainerComponent,t.CollapsibleContainerContentComponent,t.CollapsibleContainerHeaderComponent]})],t.CollapsibleContainerModule);window.__smartedit__.addDecoratorPayload("Component","WaitDialogComponent",{template:`\n        <fd-dialog id="se-busy-indicator-dialog">\n            <fd-dialog-body>\n                <div class="panel panel-default ySEPanelSpinner">\n                    <div class="panel-body">\n                        <div class="spinner ySESpinner">\n                            <div class="fd-busy-indicator-extended">\n                                <fd-busy-indicator\n                                    [loading]="true"\n                                    size="l"\n                                    [label]="\n                                        modalRef.data.customLoadingMessageLocalizedKey ||\n                                            'se.wait.dialog.message' | translate\n                                    "></fd-busy-indicator>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </fd-dialog-body>\n        </fd-dialog>\n    `});t.WaitDialogComponent=class WaitDialogComponent{constructor(e){this.modalRef=e}};t.WaitDialogComponent=__decorate([n.Component({template:`\n        <fd-dialog id="se-busy-indicator-dialog">\n            <fd-dialog-body>\n                <div class="panel panel-default ySEPanelSpinner">\n                    <div class="panel-body">\n                        <div class="spinner ySESpinner">\n                            <div class="fd-busy-indicator-extended">\n                                <fd-busy-indicator\n                                    [loading]="true"\n                                    size="l"\n                                    [label]="\n                                        modalRef.data.customLoadingMessageLocalizedKey ||\n                                            'se.wait.dialog.message' | translate\n                                    "></fd-busy-indicator>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </fd-dialog-body>\n        </fd-dialog>\n    `}),__metadata("design:paramtypes",[y.DialogRef])],t.WaitDialogComponent);class TabsSelectAdapter{static transform(e,t){return{id:t,label:e.title,value:e,listItemClassName:e.hasErrors&&"sm-tab-error"}}}window.__smartedit__.addDecoratorPayload("Component","TabsComponent",{selector:"se-tabs",template:`<div class="se-tabset-wrapper"><nav fd-tab-nav class="nav nav-tabs se-tabset" role="tablist" *ngIf="isInitialized"><ng-container *ngIf="tabsList.length !== numTabsDisplayed"><ng-container *ngFor="let tab of (getVisibleTabs() | async); trackBy: trackTabById" [ngTemplateOutlet]="tabsetLink" [ngTemplateOutletContext]="{ $implicit: tab }"></ng-container></ng-container><ng-container *ngIf="tabsList && tabsList.length == numTabsDisplayed"><ng-container *ngFor="let tab of tabsList; trackBy: trackTabById" [ngTemplateOutlet]="tabsetLink" [ngTemplateOutletContext]="{ $implicit: tab }"></ng-container></ng-container><su-select class="se-tabset__select" *ngIf="tabsList.length > numTabsDisplayed && (getDropdownTabs() | async)" [items]="dropdownTabs" [isKeyboardControlEnabled]="false" [hasCustomTrigger]="true" (onItemSelected)="selectTab($event.value)"><li fd-list-item [ngClass]="{'active': isActiveInMoreTab()}" su-select-custom-trigger><a fd-list-link [ngClass]="{'sm-tab-error': dropDownHasErrors()}" class="dropdown-toggle"><span fd-list-title *ngIf="!isActiveInMoreTab()" class="multi-tabs__more-span">{{ 'se.ytabset.tabs.more' | translate }} </span><span fd-list-title *ngIf="isActiveInMoreTab()" class="multi-tabs__more-span">{{selectedTab.title | translate}} </span><span class="caret"></span></a></li></su-select><ng-template #tabsetLink let-tab><div fd-tab-item [ngClass]="{\n                    'active': tab.id === selectedTab.id,\n                    'se-tabset__tab--disabled': tab.disabled,\n                    'sm-tab-error': tab.hasErrors\n                }" [attr.tab-id]="tab.id" class="se-tabset__tab"><a fd-tab-link [ngClass]="{'sm-tab-error': tab.hasErrors}" class="se-tabset__link mycustomtabset" (click)="selectTab(tab)" *ngIf="!tab.message">{{tab.title | translate}}</a><se-tooltip [triggers]="['mouseover']" *ngIf="tab.message"><a fd-list-title se-tooltip-trigger [ngClass]="{'sm-tab-error': tab.hasErrors}" class="se-tabset__link" (click)="selectTab(tab)">{{tab.title | translate}} </a><span fd-list-title se-tooltip-body>{{ tab.message }}</span></se-tooltip></div></ng-template></nav><div class="se-tab-set__content-wrapper" *ngIf="selectedTab"><ng-container *ngFor="let tab of tabsList; trackBy: trackTabById"><se-tab [hidden]="tab.id !== selectedTab.id" [attr.tab-id]="tab.id" [tab]="tab" [model]="model"></se-tab></ng-container></div></div>`});t.TabsComponent=class TabsComponent{constructor(e){this.userTrackingService=e;this.tabsList=[];this.onTabSelected=new n.EventEmitter;this.tabChangedStream=new m.BehaviorSubject(null)}get isInitialized(){return!!this.tabsList&&this.tabsList.length>1&&!!this.selectedTab}isActiveInMoreTab(){return this.tabsList.findIndex((e=>e.id===this.selectedTab.id))>=this.numTabsDisplayed-1}ngOnChanges(e){const t=e.tabsList&&e.tabsList.currentValue&&!e.tabsList.previousValue||e.tabsList&&e.tabsList.firstChange&&!!e.tabsList.currentValue;const i=e.tabsList&&!!e.tabsList.previousValue&&!!e.tabsList.currentValue;if(this.tabsList){const e=this.tabsList.find((e=>e.active))||this.tabsList[0];if(!this.selectedTab||this.selectedTab&&this.selectedTab.id!==e.id){this.selectedTab=e;this.selectedTab.active=true}}if(t){this.tabsList=this.tabsList.map((e=>Object.assign(Object.assign({},e),{active:false,hasErrors:false})));this.tabChangedStream.next()}if(i){this.tabChangedStream.next()}this.getDropdownTabs().subscribe((e=>{this.dropdownTabs=e}))}selectTab(e){if(e&&e.id!==this.selectedTab.id){this.userTrackingService.trackingUserAction(Xi.ADD_COMPONENT,e.title);if(!this.selectedTab.active){this.findSelectedTab()}this.selectedTab.active=false;this.selectedTab=e;this.selectedTab.active=true;this.onTabSelected.emit(this.selectedTab.id)}}dropDownHasErrors(){const e=this.tabsList.slice(this.numTabsDisplayed-1);return e.some((e=>e.hasErrors))}findSelectedTab(){const e=this.tabsList.find((e=>e.active));if(e){this.selectedTab=e}}getDropdownTabs(){return this.tabChangedStream.pipe(v.map((()=>(this.tabsList||[]).slice(this.numTabsDisplayed-1).map(TabsSelectAdapter.transform))),v.distinctUntilChanged(((e,t)=>s.isEqual(e,t))))}getVisibleTabs(){return this.tabChangedStream.pipe(v.map((()=>(this.tabsList||[]).slice(0,this.numTabsDisplayed-1))),v.distinctUntilChanged(((e,t)=>s.isEqual(e,t))))}trackTabById(e){return e}};__decorate([n.Input(),__metadata("design:type",Object)],t.TabsComponent.prototype,"model",void 0);__decorate([n.Input(),__metadata("design:type",Array)],t.TabsComponent.prototype,"tabsList",void 0);__decorate([n.Input(),__metadata("design:type",Number)],t.TabsComponent.prototype,"numTabsDisplayed",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.TabsComponent.prototype,"onTabSelected",void 0);t.TabsComponent=__decorate([n.Component({selector:"se-tabs",template:`<div class="se-tabset-wrapper"><nav fd-tab-nav class="nav nav-tabs se-tabset" role="tablist" *ngIf="isInitialized"><ng-container *ngIf="tabsList.length !== numTabsDisplayed"><ng-container *ngFor="let tab of (getVisibleTabs() | async); trackBy: trackTabById" [ngTemplateOutlet]="tabsetLink" [ngTemplateOutletContext]="{ $implicit: tab }"></ng-container></ng-container><ng-container *ngIf="tabsList && tabsList.length == numTabsDisplayed"><ng-container *ngFor="let tab of tabsList; trackBy: trackTabById" [ngTemplateOutlet]="tabsetLink" [ngTemplateOutletContext]="{ $implicit: tab }"></ng-container></ng-container><su-select class="se-tabset__select" *ngIf="tabsList.length > numTabsDisplayed && (getDropdownTabs() | async)" [items]="dropdownTabs" [isKeyboardControlEnabled]="false" [hasCustomTrigger]="true" (onItemSelected)="selectTab($event.value)"><li fd-list-item [ngClass]="{'active': isActiveInMoreTab()}" su-select-custom-trigger><a fd-list-link [ngClass]="{'sm-tab-error': dropDownHasErrors()}" class="dropdown-toggle"><span fd-list-title *ngIf="!isActiveInMoreTab()" class="multi-tabs__more-span">{{ 'se.ytabset.tabs.more' | translate }} </span><span fd-list-title *ngIf="isActiveInMoreTab()" class="multi-tabs__more-span">{{selectedTab.title | translate}} </span><span class="caret"></span></a></li></su-select><ng-template #tabsetLink let-tab><div fd-tab-item [ngClass]="{\n                    'active': tab.id === selectedTab.id,\n                    'se-tabset__tab--disabled': tab.disabled,\n                    'sm-tab-error': tab.hasErrors\n                }" [attr.tab-id]="tab.id" class="se-tabset__tab"><a fd-tab-link [ngClass]="{'sm-tab-error': tab.hasErrors}" class="se-tabset__link mycustomtabset" (click)="selectTab(tab)" *ngIf="!tab.message">{{tab.title | translate}}</a><se-tooltip [triggers]="['mouseover']" *ngIf="tab.message"><a fd-list-title se-tooltip-trigger [ngClass]="{'sm-tab-error': tab.hasErrors}" class="se-tabset__link" (click)="selectTab(tab)">{{tab.title | translate}} </a><span fd-list-title se-tooltip-body>{{ tab.message }}</span></se-tooltip></div></ng-template></nav><div class="se-tab-set__content-wrapper" *ngIf="selectedTab"><ng-container *ngFor="let tab of tabsList; trackBy: trackTabById"><se-tab [hidden]="tab.id !== selectedTab.id" [attr.tab-id]="tab.id" [tab]="tab" [model]="model"></se-tab></ng-container></div></div>`}),__metadata("design:paramtypes",[IUserTrackingService])],t.TabsComponent);const sn=new n.InjectionToken("tab-data");window.__smartedit__.addDecoratorPayload("Component","TabComponent",{selector:"se-tab",template:`<ng-container *ngComponentOutlet="tab.component; injector: tabInjector"></ng-container>`});t.TabComponent=class TabComponent{constructor(e){this.injector=e;this.scopeStream=new m.BehaviorSubject(null)}ngOnChanges(e){const t=e.model&&!s.isEqual(e.model.previousValue,e.model.currentValue);const i=e.tab&&!s.isEqual(e.tab.previousValue,e.tab.currentValue);if(i||t){this.scopeStream.next({model:this.model,tabId:this.tab.id,tab:this.tab})}}ngOnInit(){this.tabInjector=n.Injector.create({providers:[{provide:sn,useValue:{model:this.model,tabId:this.tab.id,tab:this.tab}}],parent:this.injector})}};__decorate([n.Input(),__metadata("design:type",Object)],t.TabComponent.prototype,"tab",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.TabComponent.prototype,"model",void 0);t.TabComponent=__decorate([n.Component({selector:"se-tab",template:`<ng-container *ngComponentOutlet="tab.component; injector: tabInjector"></ng-container>`}),__metadata("design:paramtypes",[n.Injector])],t.TabComponent);t.FundamentalsModule=class FundamentalsModule{};t.FundamentalsModule=__decorate([n.NgModule({imports:[y.DialogModule,y.ButtonModule,w.BrowserAnimationsModule,E.FormsModule,y.PopoverModule,y.MenuModule,y.MessageStripModule,y.PaginationModule,y.BusyIndicatorModule],exports:[y.DialogModule,y.ButtonModule,y.FormModule,y.PopoverModule,y.MenuModule,y.MessageStripModule,y.PaginationModule,y.BusyIndicatorModule]})],t.FundamentalsModule);window.__smartedit__.addDecoratorPayload("Component","TooltipComponent",{selector:"se-tooltip",template:`\n        <fd-popover\n            [triggers]="triggers"\n            [placement]="placement"\n            [appendTo]="appendTo"\n            [noArrow]="!isChevronVisible"\n            [additionalBodyClass]="'se-tooltip-container'"\n            [ngClass]="additionalClasses"\n            class="se-tooltip">\n            <fd-popover-control>\n                <ng-content select="[se-tooltip-trigger]"></ng-content>\n            </fd-popover-control>\n            <fd-popover-body>\n                <div class="popover se-popover">\n                    <h3 class="se-popover__title" *ngIf="title">{{ title | translate }}</h3>\n\n                    <div class="se-popover__content">\n                        <ng-content select="[se-tooltip-body]"></ng-content>\n                    </div>\n                </div>\n            </fd-popover-body>\n        </fd-popover>\n    `});let an=class TooltipComponent{ngAfterViewInit(){this.popoverIsOpenChangeSubscription=this.popover.isOpenChange.subscribe((e=>{if(e){setTimeout((()=>this.popover.refreshPosition()))}}))}ngOnDestroy(){this.popoverIsOpenChangeSubscription.unsubscribe()}};__decorate([n.Input(),__metadata("design:type",Array)],an.prototype,"triggers",void 0);__decorate([n.Input(),__metadata("design:type",String)],an.prototype,"placement",void 0);__decorate([n.Input(),__metadata("design:type",String)],an.prototype,"title",void 0);__decorate([n.Input(),__metadata("design:type",n.ElementRef)],an.prototype,"appendTo",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],an.prototype,"isChevronVisible",void 0);__decorate([n.Input(),__metadata("design:type",Array)],an.prototype,"additionalClasses",void 0);__decorate([n.ViewChild(y.PopoverComponent,{static:false}),__metadata("design:type",y.PopoverComponent)],an.prototype,"popover",void 0);an=__decorate([n.Component({selector:"se-tooltip",template:`\n        <fd-popover\n            [triggers]="triggers"\n            [placement]="placement"\n            [appendTo]="appendTo"\n            [noArrow]="!isChevronVisible"\n            [additionalBodyClass]="'se-tooltip-container'"\n            [ngClass]="additionalClasses"\n            class="se-tooltip">\n            <fd-popover-control>\n                <ng-content select="[se-tooltip-trigger]"></ng-content>\n            </fd-popover-control>\n            <fd-popover-body>\n                <div class="popover se-popover">\n                    <h3 class="se-popover__title" *ngIf="title">{{ title | translate }}</h3>\n\n                    <div class="se-popover__content">\n                        <ng-content select="[se-tooltip-body]"></ng-content>\n                    </div>\n                </div>\n            </fd-popover-body>\n        </fd-popover>\n    `})],an);t.TooltipModule=class TooltipModule{};t.TooltipModule=__decorate([n.NgModule({imports:[g.CommonModule,t.FundamentalsModule,r.TranslationModule.forChild()],declarations:[an],entryComponents:[an],exports:[an]})],t.TooltipModule);t.TabsModule=class TabsModule{};t.TabsModule=__decorate([n.NgModule({imports:[g.CommonModule,r.SelectModule,t.TooltipModule,b.TabsModule,S.ListModule,r.TranslationModule.forChild()],declarations:[t.TabsComponent,t.TabComponent],entryComponents:[t.TabsComponent,t.TabComponent],exports:[t.TabsComponent,t.TabComponent]})],t.TabsModule);const rn=new n.InjectionToken("DATA_TABLE_COMPONENT_DATA");window.__smartedit__.addDecoratorPayload("Component","DataTableComponent",{selector:"se-data-table",styles:[`.se-paged-list-table.fd-table th{cursor:pointer}`],template:`<table class="se-paged-list-table fd-table"><thead><tr><th *ngFor="let column of columns" (click)="sortColumn(column)" [ngStyle]="{'width.': columnWidth + '%'}" [ngClass]="'se-paged-list__header-'+column.property" class="se-paged-list__header">{{ column.i18n | translate }} <span class="se-data-table__sort" *ngIf="visibleSortingHeader === column.property" [ngClass]="{ \n                        'sap-icon--sort-descending': headersSortingState[column.property],\n                        'sap-icon--sort-ascending': !headersSortingState[column.property] }"></span></th></tr></thead><tbody class="se-paged-list__table-body"><tr *ngFor="let item of items" class="se-paged-list-item"><td *ngFor="let column of columns" [ngClass]="'se-paged-list-item-'+column.property"><se-data-table-renderer [column]="column" [item]="item"></se-data-table-renderer></td></tr></tbody></table>`});t.DataTableComponent=class DataTableComponent{constructor(){this.onSortColumn=new n.EventEmitter;this.headersSortingState={}}ngOnInit(){this._configure()}sortColumn(e){if(e.sortable){this.columnToggleReversed=!this.columnToggleReversed;this.headersSortingState[e.property]=this.columnToggleReversed;this.visibleSortingHeader=e.property;this.currentPage=1;this.internalSortBy=e.property;this.columnSortMode=this.columnToggleReversed?t.SortDirections.Descending:t.SortDirections.Ascending;this.onSortColumn.emit({$columnKey:e,$columnSortMode:this.columnSortMode})}}_configure(){const e=100;this.columnWidth=e/this.columns.length;this.columnToggleReversed=this.sortStatus.reversed;this.columnSortMode=this.sortStatus.reversed?t.SortDirections.Descending:t.SortDirections.Ascending;this.headersSortingState[this.sortStatus.internalSortBy]=this.config.reversed;this.visibleSortingHeader=this.sortStatus.internalSortBy}};__decorate([n.Input(),__metadata("design:type",Array)],t.DataTableComponent.prototype,"columns",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.DataTableComponent.prototype,"config",void 0);__decorate([n.Input(),__metadata("design:type",Array)],t.DataTableComponent.prototype,"items",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.DataTableComponent.prototype,"sortStatus",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.DataTableComponent.prototype,"onSortColumn",void 0);t.DataTableComponent=__decorate([n.Component({selector:"se-data-table",styles:[`.se-paged-list-table.fd-table th{cursor:pointer}`],template:`<table class="se-paged-list-table fd-table"><thead><tr><th *ngFor="let column of columns" (click)="sortColumn(column)" [ngStyle]="{'width.': columnWidth + '%'}" [ngClass]="'se-paged-list__header-'+column.property" class="se-paged-list__header">{{ column.i18n | translate }} <span class="se-data-table__sort" *ngIf="visibleSortingHeader === column.property" [ngClass]="{ \n                        'sap-icon--sort-descending': headersSortingState[column.property],\n                        'sap-icon--sort-ascending': !headersSortingState[column.property] }"></span></th></tr></thead><tbody class="se-paged-list__table-body"><tr *ngFor="let item of items" class="se-paged-list-item"><td *ngFor="let column of columns" [ngClass]="'se-paged-list-item-'+column.property"><se-data-table-renderer [column]="column" [item]="item"></se-data-table-renderer></td></tr></tbody></table>`})],t.DataTableComponent);window.__smartedit__.addDecoratorPayload("Component","DataTableRendererComponent",{selector:"se-data-table-renderer",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`\n        <div *ngIf="column.component; else cellText">\n            <ng-container\n                *ngComponentOutlet="column.component; injector: componentInjector"></ng-container>\n        </div>\n        <ng-template #cellText\n            ><span>{{ item[column.property] }}</span></ng-template\n        >\n    `});let ln=class DataTableRendererComponent{constructor(e){this.injector=e}ngOnChanges(e){const t=e.column;if(t===null||t===void 0?void 0:t.currentValue.component){this.createInjector()}}createInjector(){const{column:e,item:t}=this;this.componentInjector=n.Injector.create({providers:[{provide:rn,useValue:{column:e,item:t}}],parent:this.injector})}};__decorate([n.Input(),__metadata("design:type",Object)],ln.prototype,"column",void 0);__decorate([n.Input(),__metadata("design:type",Object)],ln.prototype,"item",void 0);ln=__decorate([n.Component({selector:"se-data-table-renderer",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`\n        <div *ngIf="column.component; else cellText">\n            <ng-container\n                *ngComponentOutlet="column.component; injector: componentInjector"></ng-container>\n        </div>\n        <ng-template #cellText\n            ><span>{{ item[column.property] }}</span></ng-template\n        >\n    `}),__metadata("design:paramtypes",[n.Injector])],ln);let cn=class DataTableModule{};cn=__decorate([n.NgModule({imports:[g.CommonModule,r.TranslationModule.forChild()],declarations:[t.DataTableComponent,ln],entryComponents:[t.DataTableComponent,ln],exports:[t.DataTableComponent,ln]})],cn);window.__smartedit__.addDecoratorPayload("Component","DropdownMenuComponent",{selector:"se-dropdown-menu",template:`<fd-popover [triggers]="[]" [isOpen]="isOpen" [placement]="placement || 'bottom-end'" class="se-dropdown-more-menu"><fd-popover-control><div #toggleMenu><div *ngIf="!useProjectedAnchor; else projectedAnchor;" class="sap-icon--overflow se-dropdown-more-menu__toggle" title="{{ 'se.contextmenu.title.more' | translate }}"></div><ng-template #projectedAnchor><ng-content></ng-content></ng-template></div></fd-popover-control><fd-popover-body><ul fd-list class="se-dropdown-menu__list" [ngClass]="additionalClasses"><se-dropdown-menu-item *ngFor="let dropdownItem of clonedDropdownItems" [dropdownItem]="dropdownItem" [selectedItem]="selectedItem" (selectedItemChange)="selectedItemChange.emit($event)" class="fd-list__byline-left"></se-dropdown-menu-item></ul><div *ngIf="message" class="se-information">{{ message | translate }}</div></fd-popover-body></fd-popover>`,styles:[`se-dropdown-menu .fd-popover__popper{border:0}.se-information{padding:12px}.se-dropdown-more-menu__toggle{color:var(--sapInformativeColor)!important;cursor:pointer}.se-dropdown-more-menu__toggle.sap-icon--overflow{position:relative;bottom:3px;height:20px;line-height:36px}se-dropdown-menu-item li>*{width:100%!important}.se-dropdown-menu__list{display:flex;flex-direction:column;min-width:100px;border-radius:var(--sapElement_BorderCornerRadius)!important}.se-dropdown-menu__list se-dropdown-menu-item:first-child .se-dropdown-item,.se-dropdown-menu__list se-dropdown-menu-item:first-child .se-dropdown-item:hover{border-top-left-radius:var(--sapElement_BorderCornerRadius);border-top-right-radius:var(--sapElement_BorderCornerRadius)}.se-dropdown-menu__list se-dropdown-menu-item:last-child .se-dropdown-item,.se-dropdown-menu__list se-dropdown-menu-item:last-child .se-dropdown-item:hover{border-bottom-left-radius:var(--sapElement_BorderCornerRadius);border-bottom-right-radius:var(--sapElement_BorderCornerRadius);border-bottom:none!important}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item{border-bottom:none;padding:unset}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item{text-decoration:none!important;white-space:nowrap;color:var(--sapTextColor);width:100%;padding:10px 24px;border-bottom:var(--sapList_BorderWidth) solid var(--sapList_BorderColor)}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item.fd-has-color-status-3{color:var(--sapNegativeColor)}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a{order:99}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a:hover,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete:hover{color:var(--sapNegativeColor)}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a.se-dropdown-item--disabled,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a.se-dropdown-item--disabled:hover,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete.se-dropdown-item--disabled,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete.se-dropdown-item--disabled:hover{opacity:.4;padding-right:8px!important;background:var(--sapBaseColor)!important}.se-dropdown-item__delete-wrapper{display:flex;flex-direction:row;align-items:center;width:100%}.se-dropdown-item__delete-page-popover{margin-right:16px}.se-dropdown-item__delete-page-popover .sap-icon--message-error{color:var(--sapIndicationColor_5)}.se-dropdown-item__delete-link-wrapper{width:100%}.se-dropdown-item__delete-link-wrapper--disabled{cursor:not-allowed}`],encapsulation:n.ViewEncapsulation.None});t.DropdownMenuComponent=class DropdownMenuComponent{constructor(e,t){this.cd=e;this.yjQuery=t;this.selectedItemChange=new n.EventEmitter;this.useProjectedAnchor=false;this.isOpen=false;this.additionalClasses=[];this.isOpenChange=new n.EventEmitter;this.dropdownListSelector=".se-dropdown-menu__list";this.isSubscription=false}clickHandler(e){if(this.toggleMenuElement.nativeElement.contains(e.target)){e.stopPropagation();this.isOpen=!this.isOpen;this.cd.detectChanges();this.emitIsOpenChange();return}if(this.isOpen){this.isOpen=false;this.cd.detectChanges();this.emitIsOpenChange()}}ngOnChanges(e){const t=e.dropdownItems;if(t){this.clonedDropdownItems=t.currentValue.map((e=>Object.assign(Object.assign({},e),{condition:e.condition||(()=>true)}))).map((e=>this.setDefaultComponentIfNeeded(e)))}}ngDoCheck(){if(this.isOpen&&!this.isSubscription){const e=this.yjQuery(this.dropdownListSelector);if(e.length&&!e.height()){this.message="se.actions.without.permission"}this.isSubscription=true}}emitIsOpenChange(){this.isOpenChange.emit(this.isOpen)}setDefaultComponentIfNeeded(e){if(this.validateDropdownItem(e)==="callback"){return Object.assign(Object.assign({},e),{component:t.DropdownMenuItemDefaultComponent})}else{return e}}validateDropdownItem(e){const t=["callback","component"];const i=Object.keys(e);const o=i.filter((e=>t.includes(e)));if(o.length!==1){throw new Error('DropdownMenuComponent.validateDropdownItem - Dropdown Item must contain "callback" or "component"')}return o[0]}};__decorate([n.Input(),__metadata("design:type",Array)],t.DropdownMenuComponent.prototype,"dropdownItems",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.DropdownMenuComponent.prototype,"selectedItem",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.DropdownMenuComponent.prototype,"selectedItemChange",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.DropdownMenuComponent.prototype,"placement",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.DropdownMenuComponent.prototype,"useProjectedAnchor",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.DropdownMenuComponent.prototype,"isOpen",void 0);__decorate([n.Input(),__metadata("design:type",Array)],t.DropdownMenuComponent.prototype,"additionalClasses",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.DropdownMenuComponent.prototype,"isOpenChange",void 0);__decorate([n.ViewChild("toggleMenu",{static:true}),__metadata("design:type",n.ElementRef)],t.DropdownMenuComponent.prototype,"toggleMenuElement",void 0);__decorate([n.HostListener("document:click",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[MouseEvent]),__metadata("design:returntype",void 0)],t.DropdownMenuComponent.prototype,"clickHandler",null);t.DropdownMenuComponent=__decorate([n.Component({selector:"se-dropdown-menu",template:`<fd-popover [triggers]="[]" [isOpen]="isOpen" [placement]="placement || 'bottom-end'" class="se-dropdown-more-menu"><fd-popover-control><div #toggleMenu><div *ngIf="!useProjectedAnchor; else projectedAnchor;" class="sap-icon--overflow se-dropdown-more-menu__toggle" title="{{ 'se.contextmenu.title.more' | translate }}"></div><ng-template #projectedAnchor><ng-content></ng-content></ng-template></div></fd-popover-control><fd-popover-body><ul fd-list class="se-dropdown-menu__list" [ngClass]="additionalClasses"><se-dropdown-menu-item *ngFor="let dropdownItem of clonedDropdownItems" [dropdownItem]="dropdownItem" [selectedItem]="selectedItem" (selectedItemChange)="selectedItemChange.emit($event)" class="fd-list__byline-left"></se-dropdown-menu-item></ul><div *ngIf="message" class="se-information">{{ message | translate }}</div></fd-popover-body></fd-popover>`,styles:[`se-dropdown-menu .fd-popover__popper{border:0}.se-information{padding:12px}.se-dropdown-more-menu__toggle{color:var(--sapInformativeColor)!important;cursor:pointer}.se-dropdown-more-menu__toggle.sap-icon--overflow{position:relative;bottom:3px;height:20px;line-height:36px}se-dropdown-menu-item li>*{width:100%!important}.se-dropdown-menu__list{display:flex;flex-direction:column;min-width:100px;border-radius:var(--sapElement_BorderCornerRadius)!important}.se-dropdown-menu__list se-dropdown-menu-item:first-child .se-dropdown-item,.se-dropdown-menu__list se-dropdown-menu-item:first-child .se-dropdown-item:hover{border-top-left-radius:var(--sapElement_BorderCornerRadius);border-top-right-radius:var(--sapElement_BorderCornerRadius)}.se-dropdown-menu__list se-dropdown-menu-item:last-child .se-dropdown-item,.se-dropdown-menu__list se-dropdown-menu-item:last-child .se-dropdown-item:hover{border-bottom-left-radius:var(--sapElement_BorderCornerRadius);border-bottom-right-radius:var(--sapElement_BorderCornerRadius);border-bottom:none!important}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item{border-bottom:none;padding:unset}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item{text-decoration:none!important;white-space:nowrap;color:var(--sapTextColor);width:100%;padding:10px 24px;border-bottom:var(--sapList_BorderWidth) solid var(--sapList_BorderColor)}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item.fd-has-color-status-3{color:var(--sapNegativeColor)}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a{order:99}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a:hover,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete:hover{color:var(--sapNegativeColor)}.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a.se-dropdown-item--disabled,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete a.se-dropdown-item--disabled:hover,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete.se-dropdown-item--disabled,.se-dropdown-menu__list se-dropdown-menu-item .fd-list__item .se-dropdown-item__delete.se-dropdown-item--disabled:hover{opacity:.4;padding-right:8px!important;background:var(--sapBaseColor)!important}.se-dropdown-item__delete-wrapper{display:flex;flex-direction:row;align-items:center;width:100%}.se-dropdown-item__delete-page-popover{margin-right:16px}.se-dropdown-item__delete-page-popover .sap-icon--message-error{color:var(--sapIndicationColor_5)}.se-dropdown-item__delete-link-wrapper{width:100%}.se-dropdown-item__delete-link-wrapper--disabled{cursor:not-allowed}`],encapsulation:n.ViewEncapsulation.None}),__param(1,n.Inject(ko)),__metadata("design:paramtypes",[n.ChangeDetectorRef,Function])],t.DropdownMenuComponent);window.__smartedit__.addDecoratorPayload("Component","DropdownMenuItemComponent",{selector:"se-dropdown-menu-item",template:`<li fd-list-item *ngIf="dropdownItem.condition(selectedItem)" class="fd-list__byline-left" [ngClass]="dropdownItem.customCss" (click)="onClick()"><ng-container *ngComponentOutlet="dropdownItem.component; injector: dropdownItemInjector;"></ng-container></li>`});let dn=class DropdownMenuItemComponent{constructor(e){this.injector=e;this.selectedItemChange=new n.EventEmitter}ngOnInit(){this.createDropdownItemInjector()}onClick(){this.selectedItemChange.emit(this.dropdownItem)}createDropdownItemInjector(){const{selectedItem:e}=this;this.dropdownItemInjector=n.Injector.create({parent:this.injector,providers:[{provide:on,useValue:{dropdownItem:this.dropdownItem,selectedItem:e}}]})}};__decorate([n.Input(),__metadata("design:type",Object)],dn.prototype,"dropdownItem",void 0);__decorate([n.Input(),__metadata("design:type",Object)],dn.prototype,"selectedItem",void 0);__decorate([n.Output(),__metadata("design:type",Object)],dn.prototype,"selectedItemChange",void 0);dn=__decorate([n.Component({selector:"se-dropdown-menu-item",template:`<li fd-list-item *ngIf="dropdownItem.condition(selectedItem)" class="fd-list__byline-left" [ngClass]="dropdownItem.customCss" (click)="onClick()"><ng-container *ngComponentOutlet="dropdownItem.component; injector: dropdownItemInjector;"></ng-container></li>`}),__metadata("design:paramtypes",[n.Injector])],dn);t.DropdownMenuModule=class DropdownMenuModule{};t.DropdownMenuModule=__decorate([n.NgModule({imports:[g.CommonModule,t.FundamentalsModule,r.TranslationModule.forChild(),S.ListModule],declarations:[t.DropdownMenuComponent,dn,t.DropdownMenuItemDefaultComponent],entryComponents:[t.DropdownMenuComponent,t.DropdownMenuItemDefaultComponent],exports:[t.DropdownMenuComponent,dn]})],t.DropdownMenuModule);window.__smartedit__.addDecoratorPayload("Component","DynamicPagedListComponent",{selector:"se-dynamic-paged-list",template:`<div *ngIf="ready" class="se-dynamic-paged-list"><div class="fd-panel__body fd-panel__body--bleed"><se-data-table [columns]="columns" [config]="config" [items]="items" [sortStatus]="sortStatus" (onSortColumn)="orderByColumn($event)"></se-data-table></div><div class="fd-panel__footer"><se-pagination *ngIf="!!items.length" class="se-dynamic-list__pagination" [totalItems]="totalItems" [itemsPerPage]="config.itemsPerPage" [currentPage]="currentPage" (onChange)="onCurrentPageChange($event)"></se-pagination><span class="se-paged-list__page-count-wrapper se-paged-list__page-count-wrapper--footer"><span class="span-page-list__page-count-text">{{'se.pagelist.countsearchresult' | translate}} </span><span class="se-page-list__page-count">({{ totalItems }})</span></span></div></div><se-spinner [isSpinning]="!ready"></se-spinner>`});t.DynamicPagedListComponent=class DynamicPagedListComponent{constructor(e,t,i){this.logService=e;this.restServiceFactory=t;this.cdr=i;this.getApi=new n.EventEmitter;this.onItemsUpdate=new n.EventEmitter;this.api={reloadItems:()=>this.loadItems()}}ngOnInit(){this._validateInput();this.ready=false;this.totalItems=0;this.currentPage=1;this.columnSortMode=this.config.reversed?t.SortDirections.Descending:t.SortDirections.Ascending;this.internalSortBy=s.cloneDeep(this.config.sortBy);this.oldMask=this.mask;this.columns=[];this.sortStatus={internalSortBy:this.internalSortBy,reversed:this.config.reversed,currentPage:this.currentPage};this._buildColumnData();this.loadItems();this.getApi.emit(this.api)}ngOnChanges(e){const t=e.mask;if(!!t&&!t.firstChange&&this.oldMask!==this.mask){this.oldMask=this.mask;this.currentPage=1;this.loadItems()}}orderByColumn(e){this.internalSortBy=e.$columnKey.property;this.columnSortMode=e.$columnSortMode;this.config.reversed=this.columnSortMode===t.SortDirections.Descending;this.sortStatus.internalSortBy=this.internalSortBy;this.sortStatus.reversed=this.config.reversed;if(e.$columnKey.sortable){this.currentPage=1;this.sortStatus.currentPage=1;this.loadItems()}}loadItems(){this.ready=false;const e=Object.assign(Object.assign({},this.config.queryParams||{}),{currentPage:this.currentPage-1,mask:this.mask,pageSize:this.config.itemsPerPage,sort:`${this.internalSortBy}:${this.columnSortMode}`});return this.restServiceFactory.get(this.config.uri).page(e).then((e=>{this.items=e.results;if(this.items.length===0){this.logService.warn("PagedList: No items returned to display")}this.totalItems=e.pagination.totalCount;this.currentPage=parseInt(String(e.pagination.page),10)+1;this.ready=true;if(!this.cdr.destroyed){this.cdr.detectChanges()}this.onItemsUpdate.emit(e);return e}))}onCurrentPageChange(e){if(e===this.currentPage){return}this.currentPage=e;this.loadItems()}_validateInput(){if(!this.config){throw new Error("config object is required")}if(!(this.config.keys instanceof Array)){throw new Error("keys must be an array")}if(this.config.keys.length<1){throw new Error("dynamic paged list requires at least one key")}if(!this.config.uri){throw new Error("dynamic paged list requires a uri to fetch the list of items")}}_buildColumnData(){this.columns=this.config.keys.map((e=>Object.assign({},e)))}};__decorate([n.Input(),__metadata("design:type",Object)],t.DynamicPagedListComponent.prototype,"config",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.DynamicPagedListComponent.prototype,"mask",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.DynamicPagedListComponent.prototype,"getApi",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.DynamicPagedListComponent.prototype,"onItemsUpdate",void 0);t.DynamicPagedListComponent=__decorate([n.Component({selector:"se-dynamic-paged-list",template:`<div *ngIf="ready" class="se-dynamic-paged-list"><div class="fd-panel__body fd-panel__body--bleed"><se-data-table [columns]="columns" [config]="config" [items]="items" [sortStatus]="sortStatus" (onSortColumn)="orderByColumn($event)"></se-data-table></div><div class="fd-panel__footer"><se-pagination *ngIf="!!items.length" class="se-dynamic-list__pagination" [totalItems]="totalItems" [itemsPerPage]="config.itemsPerPage" [currentPage]="currentPage" (onChange)="onCurrentPageChange($event)"></se-pagination><span class="se-paged-list__page-count-wrapper se-paged-list__page-count-wrapper--footer"><span class="span-page-list__page-count-text">{{'se.pagelist.countsearchresult' | translate}} </span><span class="se-page-list__page-count">({{ totalItems }})</span></span></div></div><se-spinner [isSpinning]="!ready"></se-spinner>`}),__metadata("design:paramtypes",[r.LogService,r.RestServiceFactory,n.ChangeDetectorRef])],t.DynamicPagedListComponent);window.__smartedit__.addDecoratorPayload("Component","PaginationComponent",{selector:"se-pagination",template:`<fd-pagination class="se-pagination" [displayTotalItems]="displayTotalItems" [totalItems]="totalItems" [itemsPerPage]="totalItems === 1 ? 1 : itemsPerPage" [currentPage]="currentPage" (pageChangeStart)="onPageChanged($event)" nextLabel="{{ 'se.btn.nextpage.title' | translate }}" previousLabel="{{ 'se.btn.previouspage.title' | translate }}"></fd-pagination>`});t.PaginationComponent=class PaginationComponent{constructor(){this.displayTotalItems=false;this.onChange=new n.EventEmitter}onPageChanged(e){this.currentPage=e;this.onChange.emit(e)}};__decorate([n.Input(),__metadata("design:type",Number)],t.PaginationComponent.prototype,"totalItems",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.PaginationComponent.prototype,"displayTotalItems",void 0);__decorate([n.Input(),__metadata("design:type",Number)],t.PaginationComponent.prototype,"itemsPerPage",void 0);__decorate([n.Input(),__metadata("design:type",Number)],t.PaginationComponent.prototype,"currentPage",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.PaginationComponent.prototype,"onChange",void 0);t.PaginationComponent=__decorate([n.Component({selector:"se-pagination",template:`<fd-pagination class="se-pagination" [displayTotalItems]="displayTotalItems" [totalItems]="totalItems" [itemsPerPage]="totalItems === 1 ? 1 : itemsPerPage" [currentPage]="currentPage" (pageChangeStart)="onPageChanged($event)" nextLabel="{{ 'se.btn.nextpage.title' | translate }}" previousLabel="{{ 'se.btn.previouspage.title' | translate }}"></fd-pagination>`})],t.PaginationComponent);t.PaginationModule=class PaginationModule{};t.PaginationModule=__decorate([n.NgModule({imports:[t.FundamentalsModule,h.TranslateModule.forChild()],declarations:[t.PaginationComponent],exports:[t.PaginationComponent]})],t.PaginationModule);window.__smartedit__.addDecoratorPayload("Component","SpinnerComponent",{selector:"se-spinner",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`\n        <div\n            *ngIf="isSpinning"\n            class="se-spinner fd-busy-indicator-extended panel-body"\n            [ngClass]="{ 'se-spinner--fluid': isFluid }">\n            <div class="spinner">\n                <fd-busy-indicator [loading]="true" size="m"></fd-busy-indicator>\n            </div>\n        </div>\n    `});t.SpinnerComponent=class SpinnerComponent{constructor(){this.isFluid=true}};__decorate([n.Input(),__metadata("design:type",Boolean)],t.SpinnerComponent.prototype,"isSpinning",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SpinnerComponent.prototype,"isFluid",void 0);t.SpinnerComponent=__decorate([n.Component({selector:"se-spinner",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`\n        <div\n            *ngIf="isSpinning"\n            class="se-spinner fd-busy-indicator-extended panel-body"\n            [ngClass]="{ 'se-spinner--fluid': isFluid }">\n            <div class="spinner">\n                <fd-busy-indicator [loading]="true" size="m"></fd-busy-indicator>\n            </div>\n        </div>\n    `})],t.SpinnerComponent);t.SpinnerModule=class SpinnerModule{};t.SpinnerModule=__decorate([n.NgModule({imports:[g.CommonModule,R.BusyIndicatorModule],declarations:[t.SpinnerComponent],entryComponents:[t.SpinnerComponent],exports:[t.SpinnerComponent]})],t.SpinnerModule);t.DynamicPagedListModule=class DynamicPagedListModule{};t.DynamicPagedListModule=__decorate([n.NgModule({imports:[g.CommonModule,t.PaginationModule,cn,r.TranslationModule.forChild(),t.SpinnerModule],declarations:[t.DynamicPagedListComponent],entryComponents:[t.DynamicPagedListComponent],exports:[t.DynamicPagedListComponent]})],t.DynamicPagedListModule);window.__smartedit__.addDecoratorPayload("Component","InfiniteScrollingComponent",{selector:"se-infinite-scrolling",template:`<div #container class="se-infinite-scrolling__container" [ngClass]="dropDownContainerClass" fdInfiniteScroll (onScrollAction)="nextPage()" [scrollPercent]="distance" *ngIf="initiated"><div class="se-infinite-scrolling__holder" [ngClass]="dropDownClass"><div #content><ng-content></ng-content></div><div class="spinner-container"><se-spinner [isSpinning]="isLoading" [isFluid]="false"></se-spinner></div></div></div>`,styles:[`se-infinite-scrolling.se-infinite-scrolling--narrowed .se-infinite-scrolling__holder{padding:0 20px}se-infinite-scrolling .se-infinite-scrolling__container{overflow-y:auto;max-height:200px}se-infinite-scrolling .se-infinite-scrolling__holder{overflow-y:hidden}`],encapsulation:n.ViewEncapsulation.None});t.InfiniteScrollingComponent=class InfiniteScrollingComponent{constructor(e,t){this.discardablePromiseUtils=e;this.cdr=t;this.distance=80;this.itemsChange=new n.EventEmitter;this.containerId=ae.generateIdentifier();this.initiated=false;this.isLoading=false;this.internalItemsSelected=[]}ngOnInit(){this.init()}ngOnChanges(){this.context=this.context||this;this.init()}ngAfterViewInit(){this.initContentResizeObserver()}ngOnDestroy(){this.discardablePromiseUtils.clear(this.containerId);this.contentResizeObserver.disconnect()}nextPage(){if(this.pagingDisabled){return}this.pagingDisabled=true;this.currentPage=this.currentPage+1;this.mask=this.mask||"";this.isLoading=true;this.internalItemsSelected=this.context.selected||[];this.discardablePromiseUtils.apply(this.containerId,this.fetchPage(this.mask,this.pageSize,this.currentPage,this.internalItemsSelected),(e=>{e.results=e.results||[];e.results.forEach((e=>{e.technicalUniqueId=ae.encode(e)}));const t=s.differenceBy(e.results,this.context.items,"technicalUniqueId");if(t.length>0){this.context.items=[...this.context.items,...t||[]]}this.itemsChange.emit(this.context.items);this.pagingDisabled=this.isPagingDisabled(e);if(this.pagingDisabled){this.isLoading=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}this.tryToLoadNextPage(e)}))}scrollToTop(){if(this.containerElement){this.containerElement.nativeElement.scrollTop=0}}scrollToBottom(){if(this.containerElement){this.containerElement.nativeElement.scrollTop=this.containerElement.nativeElement.scrollHeight}}init(){const e=this.initiated;this.context.items=[];this.currentPage=-1;this.pagingDisabled=false;this.initiated=true;if(e){this.scrollToTop();this.nextPage()}}initContentResizeObserver(){this.contentResizeObserver=new N.ResizeObserver((e=>{const{contentRect:t}=e[0];const i=t.height===0;if(!this.pagingDisabled&&this.isLoading&&!i){if(this.shouldLoadNextPage()){this.nextPage()}else{this.isLoading=false;if(!this.cdr.destroyed){this.cdr.detectChanges()}}this.contentResizeObserver.disconnect()}}));this.contentResizeObserver.observe(this.contentElement.nativeElement)}shouldLoadNextPage(){const e=this.contentElement.nativeElement.offsetHeight;const t=this.containerElement.nativeElement.offsetHeight;return e<=t}isPagingDisabled(e){return e.pagination===undefined||e.pagination&&this.context.items.length===e.pagination.totalCount||e.pagination&&e.pagination.totalPages===e.pagination.page+1}tryToLoadNextPage(e){if(e.pagination===undefined||this.pagingDisabled){return}if(this.context.items.length===0||e.pagination.count<this.pageSize&&this.containerElement.nativeElement.offsetHeight!==0&&this.shouldLoadNextPage()){this.nextPage()}}};__decorate([n.Input(),__metadata("design:type",Number)],t.InfiniteScrollingComponent.prototype,"pageSize",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.InfiniteScrollingComponent.prototype,"mask",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.InfiniteScrollingComponent.prototype,"dropDownContainerClass",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.InfiniteScrollingComponent.prototype,"dropDownClass",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.InfiniteScrollingComponent.prototype,"distance",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.InfiniteScrollingComponent.prototype,"context",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.InfiniteScrollingComponent.prototype,"fetchPage",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.InfiniteScrollingComponent.prototype,"itemsChange",void 0);__decorate([n.ViewChild("container",{static:false}),__metadata("design:type",n.ElementRef)],t.InfiniteScrollingComponent.prototype,"containerElement",void 0);__decorate([n.ViewChild("content",{static:false}),__metadata("design:type",n.ElementRef)],t.InfiniteScrollingComponent.prototype,"contentElement",void 0);t.InfiniteScrollingComponent=__decorate([n.Component({selector:"se-infinite-scrolling",template:`<div #container class="se-infinite-scrolling__container" [ngClass]="dropDownContainerClass" fdInfiniteScroll (onScrollAction)="nextPage()" [scrollPercent]="distance" *ngIf="initiated"><div class="se-infinite-scrolling__holder" [ngClass]="dropDownClass"><div #content><ng-content></ng-content></div><div class="spinner-container"><se-spinner [isSpinning]="isLoading" [isFluid]="false"></se-spinner></div></div></div>`,styles:[`se-infinite-scrolling.se-infinite-scrolling--narrowed .se-infinite-scrolling__holder{padding:0 20px}se-infinite-scrolling .se-infinite-scrolling__container{overflow-y:auto;max-height:200px}se-infinite-scrolling .se-infinite-scrolling__holder{overflow-y:hidden}`],encapsulation:n.ViewEncapsulation.None}),__metadata("design:paramtypes",[t.DiscardablePromiseUtils,n.ChangeDetectorRef])],t.InfiniteScrollingComponent);t.InfiniteScrollingModule=class InfiniteScrollingModule{};t.InfiniteScrollingModule=__decorate([n.NgModule({imports:[y.InfiniteScrollModule,t.SpinnerModule,g.CommonModule],declarations:[t.InfiniteScrollingComponent],entryComponents:[t.InfiniteScrollingComponent],exports:[t.InfiniteScrollingComponent]})],t.InfiniteScrollingModule);function getLocalizedFilterFn(e){return t=>{if(typeof t==="string"){return t}else if(t){return t[e]||t[Object.keys(t)[0]]}else{return undefined}}}t.L10nPipe=class L10nPipe{constructor(e){this.l10nService=e}transform(e){return this.l10nService.languageSwitch$.pipe(v.startWith(null),v.pairwise(),v.tap((([e,t])=>{if(e!==t){this.filterFn=getLocalizedFilterFn(t)}})),v.map((()=>this.filterFn(e))))}};t.L10nPipe=__decorate([n.Pipe({name:"seL10n"}),__metadata("design:paramtypes",[t.L10nService])],t.L10nPipe);t.L10nPipeModule=class L10nPipeModule{};t.L10nPipeModule=__decorate([n.NgModule({declarations:[t.L10nPipe],exports:[t.L10nPipe],providers:[t.L10nPipe,se.initialize((e=>e.resolveLanguage()),[t.L10nService])]})],t.L10nPipeModule);class TreeNestedDataSource{constructor(){this._data=new m.BehaviorSubject([])}get(){return this._data.asObservable()}set(e){this._data.next(e)}}class TreeNodeItem{constructor(e){this.position=0;this.nodes=[];this.hasChildren=e.hasChildren;this.name=e.name;this.title=e.title;this.parentUid=e.parentUid;this.position=e.position;this.itemType=e.itemType;this.uid=e.uid;this.uuid=e.uuid;this.level=e.level;this.nodes=[]}setPosition(e){this.position=e;return this}setMouseHovered(e){this.mouseHovered=e;return this}setInitiated(e){this.initiated=e;return this}setLevel(e){this.level=e;return this}addNode(e){this.nodes=[...this.nodes,e.setParent(this)].map(((e,t)=>e.setPosition(t).setLevel(this.level+1)));this.updateHasChildren();return this}addNodes(e){this.nodes=[...this.nodes,...e.map((e=>e.setParent(this)))].map(((e,t)=>e.setPosition(t).setLevel(this.level+1)));this.updateHasChildren();return this}removeAllNodes(){this.nodes=[];this.updateHasChildren();return this}removeNode(e){this.nodes=this.nodes.filter((t=>t.uid!==e.uid)).map(((e,t)=>e.setPosition(t)));this.updateHasChildren();return this}setParent(e){this.parent=e;this.parentUid=e.uid;return this}toggle(){this.isExpanded=!this.isExpanded;return this}collapse(){this.isExpanded=false;return this}expand(){this.isExpanded=true;return this}collapseAll(){this.nodes.forEach((e=>this.collapseRecursively(e)))}expandAll(){this.nodes.forEach((e=>this.expandRecursively(e)))}collapseRecursively(e){e.collapse().nodes.forEach((e=>this.collapseRecursively(e)))}expandRecursively(e){e.expand().nodes.forEach((e=>this.expandRecursively(e)))}updateHasChildren(){this.hasChildren=!!this.nodes.length}}class NavigationNodeItem extends TreeNodeItem{constructor(e){super(e);this.entries=e.entries}}var pn;(function(e){e["CMSNavigationNode"]="CMSNavigationNode"})(pn||(pn={}));class TreeNodeItemFactory{get(e){switch(e.itemType){case pn.CMSNavigationNode:return new NavigationNodeItem(e);default:return new TreeNodeItem(e)}}}t.TreeService=class TreeService{constructor(e,t){this.restServiceFactory=e;this.treeNodeItemFactory=t;this.dataSource=new TreeNestedDataSource;this.$onTreeUpdated=new m.BehaviorSubject(false)}onTreeUpdated(){return this.$onTreeUpdated.pipe(v.filter((e=>!!e)))}init(e,t){if(e){this.nodesRestService=this.restServiceFactory.get(e)}this.setRoot(t)}rearrange(e,t,i){const o=t.nodes.filter((t=>t.uid!==e.uid));const n=[...o.slice(0,i),e,...o.slice(i,o.length)];e.parent.removeNode(e);t.removeAllNodes().addNodes(n);this.update()}fetchChildren(e){return __awaiter(this,void 0,void 0,(function*(){const t=e||this.root;if(t.initiated){this.update();return Promise.resolve(t.nodes)}else{const e=yield this.nodesRestService.get({parentUid:t.uid});const i=(eo.getDataFromResponse(e)||[]).map((e=>this.treeNodeItemFactory.get(e)));t.removeAllNodes().addNodes(i).setInitiated(true);this.update();return i}}))}toggle(e){return __awaiter(this,void 0,void 0,(function*(){e.toggle();return this.fetchChildren(e)}))}newChild(e){return __awaiter(this,void 0,void 0,(function*(){const t=e||this.root;const i=yield this.saveNode(t);if(!t.isExpanded){this.toggle(t)}else{const e=t.nodes.find((e=>e.uid===i.uid));if(!e){t.addNode(this.treeNodeItemFactory.get(i));this.update()}}}))}newSibling(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.saveNode(e.parent);e.parent.addNode(this.treeNodeItemFactory.get(t));this.update()}))}removeNode(e){return __awaiter(this,void 0,void 0,(function*(){yield this.nodesRestService.remove({identifier:e.uid});e.parent.removeNode(e);this.update()}))}update(){this.dataSource.set(null);this.dataSource.set(this.root.nodes);this.$onTreeUpdated.next(true)}expandAll(){this.root.expandAll();this.update()}collapseAll(){this.root.collapseAll();this.update()}getNodePositionById(e){return this.getNodeById(e).position}getNodeById(e,t){if(e===this.root.uid){return this.root}const i=t||this.root.nodes;for(const t of i){if(t.uid===e){return t}if(t.hasChildren){t.nodes=t.nodes||[];return this.getNodeById(e,t.nodes)}}return null}saveNode(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.nodesRestService.save({parentUid:e.uid,name:(e.name?e.name:e.uid)+e.nodes.length});return t}))}setRoot(e){this.root=this.treeNodeItemFactory.get({uid:e,name:"root",level:0})}};t.TreeService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory,TreeNodeItemFactory])],t.TreeService);class TreeDragAndDropEvent{constructor(e,t,i,o,n){this.sourceNode=e;this.destinationNodes=t;this.sourceParentNode=i;this.destinationParentNode=o;this.position=n}}const mn=new n.InjectionToken("TREE_NODE");let gn=class TreeDragAndDropService{constructor(e,t,i){this.confirmationModalService=e;this.alertService=t;this.treeService=i}init(e){this.config=e;this.isDragEnabled=!!e&&(!!e.onDropCallback||!!e.beforeDropCallback||!!e.allowDropCallback)}handleDrop(e){if(!this.config||!e.isPointerOverContainer){return Promise.resolve()}if(!this.allowDrop(e)){return Promise.resolve()}return this.beforeDrop(e).then((t=>{if(t===false){return}this.onDrop(e);this.rearrangeNodes(e)}))}rearrangeNodes(e){this.treeService.rearrange(e.item.data,e.container.data[0].parent,e.currentIndex)}onDrop(e){if(!this.config.onDropCallback){return}const t=new TreeDragAndDropEvent(e.item.data,e.container.data,e.item.data.parent,e.container.data[0].parent,e.currentIndex);return this.config.onDropCallback(t)}allowDrop(e){if(!this.config.allowDropCallback){return true}return this.config.allowDropCallback(new TreeDragAndDropEvent(e.item.data,e.container.data,e.item.data.parent,e.container.data[0].parent,e.currentIndex))}beforeDrop(e){if(!this.config.beforeDropCallback){return Promise.resolve()}const t=new TreeDragAndDropEvent(e.item.data,e.container.data,e.item.data.parent,e.container.data[0].parent,e.currentIndex);return this.config.beforeDropCallback(t).then((e=>{if(typeof e==="object"){if(e.confirmDropI18nKey){const t={description:e.confirmDropI18nKey};return this.confirmationModalService.confirm(t)}if(e.rejectDropI18nKey){this.alertService.showDanger({message:e.rejectDropI18nKey,minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"});return false}throw new Error("Unexpected return value for beforeDropCallback does not contain confirmDropI18nKey nor rejectDropI18nKey: "+e)}return e}))}};gn=__decorate([n.Injectable(),__metadata("design:paramtypes",[IConfirmationModalService,r.IAlertService,t.TreeService])],gn);window.__smartedit__.addDecoratorPayload("Component","TreeComponent",{selector:"se-tree",providers:[t.TreeService,gn,TreeNodeItemFactory],host:{class:"se-tree"},template:`<div class="categoryTable se-tree"><div class="se-tree__body"><div class="desktopLayout"><ol class="se-tree__nodes"><li *ngIf="(this.treeService.dataSource.get() | async).length === 0" class="se-tree__nodes--nodata">{{ 'se.ytree.no.nodes.to.display' | translate }}</li><li class="se-tree__nodes--item"><se-tree-node [source]="this.treeService.dataSource.get() | async"></se-tree-node></li></ol></div></div></div>`});t.TreeComponent=class TreeComponent{constructor(e,t){this.treeService=e;this.treeDragAndDropService=t;this.onTreeUpdated=new n.EventEmitter}ngOnInit(){this.setNodeActions();this.treeService.init(this.nodeUri,this.rootNodeUid);this.treeDragAndDropService.init(this.dragOptions);this.fetchData(this.treeService.root);this.treeService.onTreeUpdated().subscribe((()=>this.onTreeUpdated.emit(this.treeService.root.nodes)))}fetchData(e){return this.treeService.fetchChildren(e)}hasChildren(e){return e.hasChildren}collapseAll(){this.treeService.collapseAll()}expandAll(){this.treeService.expandAll()}remove(e){this.treeService.removeNode(e)}newSibling(e){this.treeService.newSibling(e)}refresh(e){e.setInitiated(false);return this.treeService.fetchChildren(e)}refreshParent(e){this.refresh(e.parent)}newChild(e){return __awaiter(this,void 0,void 0,(function*(){this.treeService.newChild(e)}))}getNodeById(e,t){return this.treeService.getNodeById(e,t)}get dragEnabled(){return this.treeDragAndDropService.isDragEnabled}setNodeActions(){Object.keys(this.nodeActions).forEach((e=>{this[e]=this.nodeActions[e].bind(this,this.treeService);this.nodeActions[e]=this.nodeActions[e].bind(this,this.treeService)}))}};__decorate([n.Input(),__metadata("design:type",String)],t.TreeComponent.prototype,"nodeTemplateUrl",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],t.TreeComponent.prototype,"nodeComponent",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.TreeComponent.prototype,"nodeUri",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.TreeComponent.prototype,"nodeActions",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.TreeComponent.prototype,"rootNodeUid",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.TreeComponent.prototype,"dragOptions",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.TreeComponent.prototype,"removeDefaultTemplate",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],t.TreeComponent.prototype,"showAsList",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.TreeComponent.prototype,"onTreeUpdated",void 0);t.TreeComponent=__decorate([n.Component({selector:"se-tree",providers:[t.TreeService,gn,TreeNodeItemFactory],host:{class:"se-tree"},template:`<div class="categoryTable se-tree"><div class="se-tree__body"><div class="desktopLayout"><ol class="se-tree__nodes"><li *ngIf="(this.treeService.dataSource.get() | async).length === 0" class="se-tree__nodes--nodata">{{ 'se.ytree.no.nodes.to.display' | translate }}</li><li class="se-tree__nodes--item"><se-tree-node [source]="this.treeService.dataSource.get() | async"></se-tree-node></li></ol></div></div></div>`}),__metadata("design:paramtypes",[t.TreeService,gn])],t.TreeComponent);window.__smartedit__.addDecoratorPayload("Component","TreeNodeComponent",{selector:"se-tree-node",template:`<ol class="se-tree-node__ol angular-ui-tree-nodes" cdkDropList (cdkDropListDropped)="onDrop($event)" [cdkDropListData]="source" [cdkDropListDisabled]="isDisabled"><li *ngFor="let node of source" cdkDrag [cdkDragData]="node" class="angular-ui-tree-node se-tree-node__li"><se-tree-node-renderer [node]="node"></se-tree-node-renderer></li></ol>`});let un=class TreeNodeComponent{constructor(e,t){this.treeDragAndDropService=e;this.logService=t}get isDisabled(){return!this.treeDragAndDropService.isDragEnabled}onDrop(e){this.treeDragAndDropService.handleDrop(e).catch((e=>{this.logService.debug(`TreeNodeComponent - onDrop: error: ${e}`)}))}};__decorate([n.Input(),__metadata("design:type",Array)],un.prototype,"source",void 0);un=__decorate([n.Component({selector:"se-tree-node",template:`<ol class="se-tree-node__ol angular-ui-tree-nodes" cdkDropList (cdkDropListDropped)="onDrop($event)" [cdkDropListData]="source" [cdkDropListDisabled]="isDisabled"><li *ngFor="let node of source" cdkDrag [cdkDragData]="node" class="angular-ui-tree-node se-tree-node__li"><se-tree-node-renderer [node]="node"></se-tree-node-renderer></li></ol>`}),__metadata("design:paramtypes",[gn,r.LogService])],un);const hn=10;window.__smartedit__.addDecoratorPayload("Component","TreeNodeRendererComponent",{selector:"se-tree-node-renderer",template:`<div class="tree-node tree-node-content se-tree-node angular-ui-tree-handle" [ngClass]="{\n        'hovered': node.mouseHovered,\n        'se-tree-node--first-level': isRootNodeDescendant,\n        'se-tree-node--selected': !collapsed\n    }" [ngStyle]="{\n        'padding-left': getPaddingLeft(node.level)\n    }" [attr.level]="node.level" (mouseover)="onMouseOver()" (mouseout)="onMouseOut()"><div *ngIf="!showAsList" class="se-tree-node__expander--wrapper col-xs-1 text-left"><a class="se-tree-node__expander btn" *ngIf="node.hasChildren" [attr.disabled]="isDisabled || null" (click)="toggle($event)"><span [ngClass]="{\n                    'sap-icon--slim-arrow-right': collapsed,\n                    'sap-icon--slim-arrow-down': !collapsed\n                }" title="{{ getNavigationTreeIconIsCollapse() | translate }}"></span></a></div><div *ngIf="displayDefaultTemplate" class="se-tree-node__name col-xs-5" [attr.title]="node.title | seL10n | async "><span>{{node.name}}</span><h6 *ngIf="node.title">{{node.title | seL10n | async }}</h6></div><ng-container *ngIf="tree.nodeComponent"><ng-container *ngComponentOutlet="tree.nodeComponent; injector: nodeComponentInjector"></ng-container></ng-container></div><se-tree-node [source]="node.nodes" *ngIf="node.nodes.length && node.isExpanded"></se-tree-node>`});t.TreeNodeRendererComponent=class TreeNodeRendererComponent{constructor(e,t,i){this.tree=e;this.treeService=t;this.injector=i}ngOnInit(){this.createNodeComponentInjector()}ngOnChanges(e){if(e.node){this.createNodeComponentInjector()}}toggle(e){e.stopPropagation();e.preventDefault();this.tree.isDropDisabled=true;this.treeService.toggle(this.node).then((()=>{this.tree.isDropDisabled=false}))}onMouseOver(){this.node.setMouseHovered(true);this.treeService.update()}onMouseOut(){this.node.setMouseHovered(false);this.treeService.update()}getPaddingLeft(e){return`${(e-1)*hn}px`}get showAsList(){return this.tree.showAsList}get isDisabled(){return this.tree.isDropDisabled}get collapsed(){return!this.node.isExpanded}get displayDefaultTemplate(){return!this.tree.removeDefaultTemplate}get isRootNodeDescendant(){return this.node.parentUid==="root"}getNavigationTreeIconIsCollapse(){return this.node.isExpanded?"se.arrowicon.collapse.title":"se.arrowicon.expand.title"}createNodeComponentInjector(){this.nodeComponentInjector=n.Injector.create({providers:[{provide:mn,useValue:this.node}],parent:this.injector})}};__decorate([n.Input(),__metadata("design:type",Object)],t.TreeNodeRendererComponent.prototype,"node",void 0);t.TreeNodeRendererComponent=__decorate([n.Component({selector:"se-tree-node-renderer",template:`<div class="tree-node tree-node-content se-tree-node angular-ui-tree-handle" [ngClass]="{\n        'hovered': node.mouseHovered,\n        'se-tree-node--first-level': isRootNodeDescendant,\n        'se-tree-node--selected': !collapsed\n    }" [ngStyle]="{\n        'padding-left': getPaddingLeft(node.level)\n    }" [attr.level]="node.level" (mouseover)="onMouseOver()" (mouseout)="onMouseOut()"><div *ngIf="!showAsList" class="se-tree-node__expander--wrapper col-xs-1 text-left"><a class="se-tree-node__expander btn" *ngIf="node.hasChildren" [attr.disabled]="isDisabled || null" (click)="toggle($event)"><span [ngClass]="{\n                    'sap-icon--slim-arrow-right': collapsed,\n                    'sap-icon--slim-arrow-down': !collapsed\n                }" title="{{ getNavigationTreeIconIsCollapse() | translate }}"></span></a></div><div *ngIf="displayDefaultTemplate" class="se-tree-node__name col-xs-5" [attr.title]="node.title | seL10n | async "><span>{{node.name}}</span><h6 *ngIf="node.title">{{node.title | seL10n | async }}</h6></div><ng-container *ngIf="tree.nodeComponent"><ng-container *ngComponentOutlet="tree.nodeComponent; injector: nodeComponentInjector"></ng-container></ng-container></div><se-tree-node [source]="node.nodes" *ngIf="node.nodes.length && node.isExpanded"></se-tree-node>`}),__param(0,n.Inject(n.forwardRef((()=>t.TreeComponent)))),__metadata("design:paramtypes",[t.TreeComponent,t.TreeService,n.Injector])],t.TreeNodeRendererComponent);t.NgTreeModule=class NgTreeModule{};t.NgTreeModule=__decorate([n.NgModule({imports:[L.DragDropModule,g.CommonModule,t.L10nPipeModule,r.TranslationModule.forChild()],declarations:[t.TreeComponent,t.TreeNodeRendererComponent,un],exports:[t.TreeComponent,un],entryComponents:[t.TreeComponent,t.TreeNodeRendererComponent]})],t.NgTreeModule);class EditableListNodeItem extends TreeNodeItem{constructor(e){super(e);this.thumbnail=e.thumbnail||{};this.id=e.id;this.code=e.code;this.catalogId=e.catalogId;this.catalogVersion=e.catalogVersion}}window.__smartedit__.addDecoratorPayload("Component","EditableListComponent",{selector:"se-editable-list",template:`<div [ngClass]="{ 'y-editable-list-disabled': !editable, 'se-editable-list-disabled': !editable }"><se-tree (onTreeUpdated)="handleTreeUpdated($event)" [removeDefaultTemplate]="true" [rootNodeUid]="rootId" [nodeTemplateUrl]="itemTemplateUrl" [nodeComponent]="itemComponent" [nodeActions]="actions" [dragOptions]="dragOptions" [showAsList]="true"></se-tree></div>`});t.EditableListComponent=class EditableListComponent{constructor(){this.refreshChange=new n.EventEmitter;this.itemsChange=new n.EventEmitter;this.dragOptions={};this.itemsOld=[]}ngOnInit(){this._enableDragAndDrop=()=>{this.dragOptions.allowDropCallback=e=>e.sourceNode.parentUid===this.rootId};this.actions=this.getTreeActions();this.refreshChange.emit((()=>this.actions.refreshList()));if(!this.itemTemplateUrl&&!this.itemComponent){this.itemComponent=t.EditableListDefaultItem}this.rootId="root"+this.id;if(this.editable===undefined){this.editable=true}if(this.editable===true){this._enableDragAndDrop()}}handleTreeUpdated(e){if(this.hasItemsChanged(this.itemsOld,e)){this.itemsOld=e;this.itemsChange.emit(e);this.actions.performUpdate()}}getDropdownItems(){return[{key:"se.ydropdownmenu.remove",callback:e=>{this.actions.removeItem(e)}},{key:"se.ydropdownmenu.move.up",condition:e=>this.actions.isMoveUpAllowed(e),callback:e=>{this.actions.moveUp(e)}},{key:"se.ydropdownmenu.move.down",condition:e=>this.actions.isMoveDownAllowed(e),callback:e=>{this.actions.moveDown(e)}}]}hasItemsChanged(e,t){const i=e.map((({uid:e})=>e));const o=t.map((({uid:e})=>e));return!s.isEqual(i,o)}getTreeActions(){const e=this.getDropdownItems();return{fetchData:(e,t)=>{const i=this.items.map((e=>new EditableListNodeItem(e)));i.forEach((e=>{if(e.id&&!e.uid){e.uid=e.id}e.setParent(t)}));t.removeAllNodes().addNodes(i);e.update();return Promise.resolve(t)},getDropdownItems:()=>e,removeItem(e,t){t.parent.removeNode(t);e.update()},moveUp(e,t){e.rearrange(t,e.root,t.position-1)},moveDown(e,t){e.rearrange(t,e.root,t.position+1)},isMoveUpAllowed(e,t){return t.position>0},isMoveDownAllowed(e,t){return e.root.nodes.length!==t.position+1},performUpdate:e=>{if(this.onChange){this.onChange()}},refreshList(e){this.fetchData(e.root)}}}};__decorate([n.Input(),__metadata("design:type",Function)],t.EditableListComponent.prototype,"refresh",void 0);__decorate([n.Input(),__metadata("design:type",Array)],t.EditableListComponent.prototype,"items",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.EditableListComponent.prototype,"onChange",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.EditableListComponent.prototype,"itemTemplateUrl",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],t.EditableListComponent.prototype,"itemComponent",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],t.EditableListComponent.prototype,"editable",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.EditableListComponent.prototype,"id",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.EditableListComponent.prototype,"refreshChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.EditableListComponent.prototype,"itemsChange",void 0);t.EditableListComponent=__decorate([n.Component({selector:"se-editable-list",template:`<div [ngClass]="{ 'y-editable-list-disabled': !editable, 'se-editable-list-disabled': !editable }"><se-tree (onTreeUpdated)="handleTreeUpdated($event)" [removeDefaultTemplate]="true" [rootNodeUid]="rootId" [nodeTemplateUrl]="itemTemplateUrl" [nodeComponent]="itemComponent" [nodeActions]="actions" [dragOptions]="dragOptions" [showAsList]="true"></se-tree></div>`})],t.EditableListComponent);window.__smartedit__.addDecoratorPayload("Component","EditableListDefaultItem",{selector:"se-editable-list-default-item",template:`\n        <div>\n            <span>{{ node.uid }}</span>\n            <se-dropdown-menu\n                *ngIf="parent.editable"\n                [dropdownItems]="parent.getDropdownItems()"\n                [selectedItem]="node"\n                class="pull-right se-tree-node__actions--more-menu"\n                title="{{ 'se.contextmenu.title.more' | translate }}"></se-dropdown-menu>\n        </div>\n    `});t.EditableListDefaultItem=class EditableListDefaultItem{constructor(e,t){this.parent=e;this.node=t}};t.EditableListDefaultItem=__decorate([n.Component({selector:"se-editable-list-default-item",template:`\n        <div>\n            <span>{{ node.uid }}</span>\n            <se-dropdown-menu\n                *ngIf="parent.editable"\n                [dropdownItems]="parent.getDropdownItems()"\n                [selectedItem]="node"\n                class="pull-right se-tree-node__actions--more-menu"\n                title="{{ 'se.contextmenu.title.more' | translate }}"></se-dropdown-menu>\n        </div>\n    `}),__param(1,n.Inject(mn)),__metadata("design:paramtypes",[t.EditableListComponent,Object])],t.EditableListDefaultItem);t.EditableListModule=class EditableListModule{};t.EditableListModule=__decorate([n.NgModule({imports:[g.CommonModule,t.NgTreeModule,t.DropdownMenuModule,r.TranslationModule.forChild()],declarations:[t.EditableListComponent,t.EditableListDefaultItem],entryComponents:[t.EditableListComponent,t.EditableListDefaultItem],exports:[t.EditableListComponent,t.EditableListDefaultItem]})],t.EditableListModule);t.MessageType=void 0;(function(e){e["danger"]="danger";e["info"]="info";e["success"]="success";e["warning"]="warning"})(t.MessageType||(t.MessageType={}));window.__smartedit__.addDecoratorPayload("Component","MessageComponent",{selector:"se-message",template:`\n        <div\n            [attr.message-id]="messageId"\n            class="fd-message-strip se-y-message"\n            role="alert"\n            [ngClass]="classes">\n            <div class="y-message-text">\n                <div class="y-message-info-title">\n                    <ng-content select="[se-message-title]"></ng-content>\n                </div>\n                <div class="y-message-info-description">\n                    <ng-content select="[se-message-description]"></ng-content>\n                </div>\n            </div>\n        </div>\n    `});t.MessageComponent=class MessageComponent{ngOnInit(){this.messageId=this.messageId||"y-message-default-id";switch(this.type){case t.MessageType.danger:this.classes="fd-message-strip--error";break;case t.MessageType.info:this.classes="fd-message-strip--information";break;case t.MessageType.success:this.classes="fd-message-strip--success";break;case t.MessageType.warning:this.classes="fd-message-strip--warning";break;default:this.classes="fd-message-strip--information"}}};__decorate([n.Input(),__metadata("design:type",String)],t.MessageComponent.prototype,"messageId",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.MessageComponent.prototype,"type",void 0);t.MessageComponent=__decorate([n.Component({selector:"se-message",template:`\n        <div\n            [attr.message-id]="messageId"\n            class="fd-message-strip se-y-message"\n            role="alert"\n            [ngClass]="classes">\n            <div class="y-message-text">\n                <div class="y-message-info-title">\n                    <ng-content select="[se-message-title]"></ng-content>\n                </div>\n                <div class="y-message-info-description">\n                    <ng-content select="[se-message-description]"></ng-content>\n                </div>\n            </div>\n        </div>\n    `})],t.MessageComponent);window.__smartedit__.addDecoratorPayload("Component","EventMessageComponent",{selector:"se-event-message",template:`\n        <div>\n            <se-message [type]="type" *ngIf="show">\n                <ng-container *ngIf="showTitle()" se-message-title>\n                    {{ title | translate }}\n                </ng-container>\n                <ng-container *ngIf="showDescription()" se-message-description>\n                    {{ description | translate }}\n                </ng-container>\n            </se-message>\n        </div>\n    `});t.EventMessageComponent=class EventMessageComponent{constructor(e){this.systemEventService=e;this.show=false}ngOnInit(){this.show=this.showToStart==="true"||this.showToStart===true;this.watchShowEventChange();this.watchHideEventChange()}ngOnDestroy(){this.removeShowEventHandler();this.removeHideEventHandler()}ngOnChanges(e){if(e.showEvent){this.watchShowEventChange()}if(e.hideEvent){this.watchHideEventChange()}}showDescription(){return typeof this.description==="string"&&this.description.length>0}showTitle(){return typeof this.title==="string"&&this.title.length>0}showEventHandler(e,t){if(t.description&&t.description.length){this.description=t.description}if(t.title&&t.title.length){this.title=t.title}this.show=true}removeHideEventHandler(){if(this.unregisterHideEventHandler){this.unregisterHideEventHandler()}}removeShowEventHandler(){if(this.unregisterShowEventHandler){this.unregisterShowEventHandler()}}watchShowEventChange(){this.removeShowEventHandler();this.unregisterShowEventHandler=this.systemEventService.subscribe(this.showEvent,((e,t)=>this.showEventHandler(e,t)))}watchHideEventChange(){this.removeHideEventHandler();this.unregisterHideEventHandler=this.systemEventService.subscribe(this.hideEvent,(()=>this.show=false))}};__decorate([n.Input(),__metadata("design:type",String)],t.EventMessageComponent.prototype,"type",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.EventMessageComponent.prototype,"title",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.EventMessageComponent.prototype,"description",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.EventMessageComponent.prototype,"showEvent",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.EventMessageComponent.prototype,"hideEvent",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.EventMessageComponent.prototype,"showToStart",void 0);t.EventMessageComponent=__decorate([n.Component({selector:"se-event-message",template:`\n        <div>\n            <se-message [type]="type" *ngIf="show">\n                <ng-container *ngIf="showTitle()" se-message-title>\n                    {{ title | translate }}\n                </ng-container>\n                <ng-container *ngIf="showDescription()" se-message-description>\n                    {{ description | translate }}\n                </ng-container>\n            </se-message>\n        </div>\n    `}),__metadata("design:paramtypes",[t.SystemEventService])],t.EventMessageComponent);t.MessageModule=class MessageModule{};t.MessageModule=__decorate([n.NgModule({imports:[g.CommonModule,h.TranslateModule.forChild()],declarations:[t.MessageComponent,t.EventMessageComponent],entryComponents:[t.MessageComponent,t.EventMessageComponent],exports:[t.MessageComponent,t.EventMessageComponent]})],t.MessageModule);window.__smartedit__.addDecoratorPayload("Component","MoreTextComponent",{selector:"se-more-text",template:`\n        <span id="y-more-text-payload" class="se-more-text__payload">{{ text }}</span>\n        <span\n            id="y-more-text-toggle"\n            class="se-more-text__toggle"\n            [ngClass]="{ 'se-more-text__toggle--capitalize': capitalizeLabel }"\n            (click)="showHideMoreText()"\n            *ngIf="isTruncated"\n            >{{ linkLabel }}</span\n        >\n    `,styles:[`.se-more-text__toggle--capitalize{text-transform:capitalize;color:var(--sapInformativeColor);cursor:pointer}`],providers:[TextTruncateService]});t.MoreTextComponent=class MoreTextComponent{constructor(e,t){this.textTruncateService=e;this.translate=t;this.capitalizeLabel=false;this.isTruncated=false;this.showingMore=false}ngOnInit(){this.limit=this.limit||100;this.moreLabelI18nKey=this.moreLabelI18nKey||"se.moretext.more.link";this.lessLabelI18nKey=this.lessLabelI18nKey||"se.moretext.less.link";this.truncatedText=this.textTruncateService.truncateToNearestWord(this.limit,this.text,this.ellipsis);this.isTruncated=this.truncatedText.isTruncated();this.translateLabels().subscribe((()=>{this.showHideMoreText()}))}showHideMoreText(){if(!this.isTruncated){return}this.text=this.showingMore?this.truncatedText.getUntruncatedText():this.truncatedText.getTruncatedText();this.linkLabel=this.showingMore?this.lessLabel:this.moreLabel;this.showingMore=!this.showingMore}translateLabels(){return m.zip(this.translate.get(this.moreLabelI18nKey),this.translate.get(this.lessLabelI18nKey)).pipe(v.tap((([e,t])=>{this.moreLabel=e;this.lessLabel=t})))}};__decorate([n.Input(),__metadata("design:type",String)],t.MoreTextComponent.prototype,"text",void 0);__decorate([n.Input(),__metadata("design:type",Number)],t.MoreTextComponent.prototype,"limit",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.MoreTextComponent.prototype,"moreLabelI18nKey",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.MoreTextComponent.prototype,"lessLabelI18nKey",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.MoreTextComponent.prototype,"ellipsis",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.MoreTextComponent.prototype,"capitalizeLabel",void 0);t.MoreTextComponent=__decorate([n.Component({selector:"se-more-text",template:`\n        <span id="y-more-text-payload" class="se-more-text__payload">{{ text }}</span>\n        <span\n            id="y-more-text-toggle"\n            class="se-more-text__toggle"\n            [ngClass]="{ 'se-more-text__toggle--capitalize': capitalizeLabel }"\n            (click)="showHideMoreText()"\n            *ngIf="isTruncated"\n            >{{ linkLabel }}</span\n        >\n    `,styles:[`.se-more-text__toggle--capitalize{text-transform:capitalize;color:var(--sapInformativeColor);cursor:pointer}`],providers:[TextTruncateService]}),__metadata("design:paramtypes",[TextTruncateService,h.TranslateService])],t.MoreTextComponent);t.MoreTextModule=class MoreTextModule{};t.MoreTextModule=__decorate([n.NgModule({imports:[g.CommonModule],declarations:[t.MoreTextComponent],entryComponents:[t.MoreTextComponent],exports:[t.MoreTextComponent]})],t.MoreTextModule);const _n=new n.InjectionToken("POPUP_OVERLAY_DATA");t.PopoverTrigger=void 0;(function(e){e["Hover"]="hover";e["Click"]="click"})(t.PopoverTrigger||(t.PopoverTrigger={}));window.__smartedit__.addDecoratorPayload("Component","PopupOverlayComponent",{selector:"se-popup-overlay",template:`<fd-popover [placement]="getPlacement()" [noArrow]="true" [triggers]="trigger && trigger.length ? [] : trigger" (isOpenChange)="handleOpenChange($event)" [additionalBodyClass]="'se-popup-overlay-container'" class="popup-overlay popover-outer" [ngClass]="popupOverlay.additionalClasses"><fd-popover-control><ng-content></ng-content></fd-popover-control><fd-popover-body #popoverBody class="popover-inner popup-overlay__inner"><ng-container *ngIf="isOpen"><ng-container *ngIf="popupOverlay.component"><ng-container *ngComponentOutlet="\n                        popupOverlay.component;\n                        injector: popupOverlayInjector\n                    "></ng-container></ng-container><ng-content select="[se-popup-overlay-body]"></ng-content></ng-container></fd-popover-body></fd-popover>`,styles:[`.se-popup-overlay-container{z-index:1060!important}`],encapsulation:n.ViewEncapsulation.None});t.PopupOverlayComponent=class PopupOverlayComponent{constructor(e){this.injector=e;this.popupOverlayOnShow=new n.EventEmitter;this.popupOverlayOnHide=new n.EventEmitter;this.trigger=[]}ngOnInit(){this.createInjector();this.setTrigger()}ngOnChanges(e){if(e.popupOverlayTrigger){this.setTrigger()}if(e.popupOverlayData){this.createInjector()}}handleOpenChange(e){return e?this.handleOpen():this.handleClose()}handleOpen(){this.isOpen=true;this.popupOverlayOnShow.emit()}handleClose(){this.isOpen=false;this.popupOverlayOnHide.emit()}getPlacement(){return`${this.popupOverlay.valign||"bottom"}-${this.getHorizontalAlign()}`}updatePosition(){this.popover.refreshPosition()}setTrigger(){if(this.popupOverlayTrigger===t.PopoverTrigger.Click){this.trigger=[this.popupOverlayTrigger]}if(this.popupOverlayTrigger===t.PopoverTrigger.Hover){this.trigger=["mouseenter","mouseleave"]}if(!this.popover){return}if(this.popupOverlayTrigger==="true"||this.popupOverlayTrigger===true){this.popover.open()}else{this.popover.close()}}getHorizontalAlign(){if(!this.popupOverlay.halign){return"start"}return this.popupOverlay.halign==="right"?"start":"end"}createInjector(){this.popupOverlayInjector=n.Injector.create({providers:[{provide:_n,useValue:this.popupOverlayData||{}}],parent:this.injector})}};__decorate([n.Input(),__metadata("design:type",Object)],t.PopupOverlayComponent.prototype,"popupOverlay",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.PopupOverlayComponent.prototype,"popupOverlayTrigger",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.PopupOverlayComponent.prototype,"popupOverlayData",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.PopupOverlayComponent.prototype,"popupOverlayOnShow",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.PopupOverlayComponent.prototype,"popupOverlayOnHide",void 0);__decorate([n.ViewChild(y.PopoverComponent,{static:false}),__metadata("design:type",y.PopoverComponent)],t.PopupOverlayComponent.prototype,"popover",void 0);t.PopupOverlayComponent=__decorate([n.Component({selector:"se-popup-overlay",template:`<fd-popover [placement]="getPlacement()" [noArrow]="true" [triggers]="trigger && trigger.length ? [] : trigger" (isOpenChange)="handleOpenChange($event)" [additionalBodyClass]="'se-popup-overlay-container'" class="popup-overlay popover-outer" [ngClass]="popupOverlay.additionalClasses"><fd-popover-control><ng-content></ng-content></fd-popover-control><fd-popover-body #popoverBody class="popover-inner popup-overlay__inner"><ng-container *ngIf="isOpen"><ng-container *ngIf="popupOverlay.component"><ng-container *ngComponentOutlet="\n                        popupOverlay.component;\n                        injector: popupOverlayInjector\n                    "></ng-container></ng-container><ng-content select="[se-popup-overlay-body]"></ng-content></ng-container></fd-popover-body></fd-popover>`,styles:[`.se-popup-overlay-container{z-index:1060!important}`],encapsulation:n.ViewEncapsulation.None}),__metadata("design:paramtypes",[n.Injector])],t.PopupOverlayComponent);t.PopupOverlayModule=class PopupOverlayModule{};t.PopupOverlayModule=__decorate([n.NgModule({imports:[g.CommonModule,y.PopoverModule],declarations:[t.PopupOverlayComponent],entryComponents:[t.PopupOverlayComponent],exports:[t.PopupOverlayComponent]})],t.PopupOverlayModule);const vn="max-height.px";window.__smartedit__.addDecoratorPayload("Component","PreventVerticalOverflowComponent",{selector:"se-prevent-vertical-overflow",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`\n        <div #container [ngStyle]="containerStyle">\n            <ng-content></ng-content>\n        </div>\n    `});t.PreventVerticalOverflowComponent=class PreventVerticalOverflowComponent{constructor(e,t){this.document=e;this.cdr=t;this.containerStyle={"max-height.px":null,overflow:null}}onWindowResize(){if(this.containerElement){this.onResize()}}ngAfterViewInit(){this.observer=new IntersectionObserver((([e])=>{if(e.isIntersecting){this.onResize()}}),{root:this.document,threshold:0});this.observer.observe(this.containerElement.nativeElement)}ngOnDestroy(){this.observer.unobserve(this.containerElement.nativeElement)}onResize(){const{top:e,height:t}=this.getContainerBoundingClientRect();if(e===0&&t===0){return}this.preventOverflow(e,t)}preventOverflow(e,t){const i=this.preventIfOverflowing(e,t);if(!i&&this.containerStyle[vn]){this.reset();const{top:e,height:t}=this.getContainerBoundingClientRect();this.preventIfOverflowing(e,t)}}preventIfOverflowing(e,t){if(this.isOverflowing(e,t)){this.prevent(e);return true}return false}isOverflowing(e,t){const i=this.getDocumentHeight();return i<e+t}prevent(e){const t=this.getDocumentHeight();const i=t-e;this.containerStyle[vn]=i;this.containerStyle.overflow="auto";if(!this.cdr.destroyed){this.cdr.detectChanges()}}reset(){this.containerStyle[vn]=null;this.containerStyle.overflow=null;if(!this.cdr.destroyed){this.cdr.detectChanges()}}getContainerBoundingClientRect(){return this.containerElement.nativeElement.getBoundingClientRect()}getDocumentHeight(){const{height:e}=this.document.documentElement.getBoundingClientRect();return e}};__decorate([n.ViewChild("container",{static:false}),__metadata("design:type",n.ElementRef)],t.PreventVerticalOverflowComponent.prototype,"containerElement",void 0);__decorate([n.HostListener("window:resize"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.PreventVerticalOverflowComponent.prototype,"onWindowResize",null);t.PreventVerticalOverflowComponent=__decorate([n.Component({selector:"se-prevent-vertical-overflow",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`\n        <div #container [ngStyle]="containerStyle">\n            <ng-content></ng-content>\n        </div>\n    `}),__param(0,n.Inject(g.DOCUMENT)),__metadata("design:paramtypes",[Document,n.ChangeDetectorRef])],t.PreventVerticalOverflowComponent);t.PreventVerticalOverflowModule=class PreventVerticalOverflowModule{};t.PreventVerticalOverflowModule=__decorate([n.NgModule({imports:[g.CommonModule],declarations:[t.PreventVerticalOverflowComponent],entryComponents:[t.PreventVerticalOverflowComponent],exports:[t.PreventVerticalOverflowComponent]})],t.PreventVerticalOverflowModule);window.__smartedit__.addDecoratorPayload("Component","HelpComponent",{selector:"se-help",template:`<se-tooltip [triggers]="['mouseenter', 'mouseleave']" placement="right" [isChevronVisible]="true" [title]="title" class="se-help"><span se-tooltip-trigger class="sap-icon--sys-help se-y-help-icon"></span><ng-content se-tooltip-body></ng-content></se-tooltip>`});t.HelpComponent=class HelpComponent{};__decorate([n.Input(),__metadata("design:type",String)],t.HelpComponent.prototype,"title",void 0);t.HelpComponent=__decorate([n.Component({selector:"se-help",template:`<se-tooltip [triggers]="['mouseenter', 'mouseleave']" placement="right" [isChevronVisible]="true" [title]="title" class="se-help"><span se-tooltip-trigger class="sap-icon--sys-help se-y-help-icon"></span><ng-content se-tooltip-body></ng-content></se-tooltip>`})],t.HelpComponent);t.HelpModule=class HelpModule{};t.HelpModule=__decorate([n.NgModule({imports:[g.CommonModule,t.TooltipModule],declarations:[t.HelpComponent],entryComponents:[t.HelpComponent],exports:[t.HelpComponent]})],t.HelpModule);window.__smartedit__.addDecoratorPayload("Component","ShortcutLinkComponent",{selector:"shortcut-link",template:`<ng-container #container><ng-template #defaultTemplate let-shortcutLink><div class="se-shortcut-link"><a class="se-shortcut-link__item" [ngClass]="{'se-shortcut-link__item--active': shortcutLink.active}" (click)="onClick(shortcutLink)">{{shortcutLink.titleI18nKey | translate}}</a></div></ng-template></ng-container>`});t.ShortcutLinkComponent=class ShortcutLinkComponent{constructor(e,t,i,o,n,s,a){this.router=e;this.location=t;this.resolver=i;this.experienceService=o;this.priorityService=n;this.systemEventService=s;this.userTrackingService=a}ngOnInit(){this.unregFn=this.systemEventService.subscribe(r.EVENTS.EXPERIENCE_UPDATE,(()=>this._createShortcutLink()))}ngOnDestroy(){this.unregFn()}ngAfterViewInit(){this._createShortcutLink()}onClick(e){this.userTrackingService.trackingUserAction(Xi.NAVIGATION,e.titleI18nKey);this.location.go(e.fullPath);this.router.navigateByUrl(e.fullPath)}_createShortcutLink(){const e=this.experienceService.getCurrentExperience();e.then((e=>{const t=this._getShortcutLinks(e);const i=this._orderByPriority(t);this._createShortcutLinkDynamicComponents(i)}))}_createShortcutLinkDynamicComponents(e){this.containerEntry.clear();e.forEach((e=>{if(e&&e.titleI18nKey){this.containerEntry.createEmbeddedView(this.defaultTemplate,{$implicit:e})}else if(e&&e.shortcutComponent){const t=this.resolver.resolveComponentFactory(e.shortcutComponent);const i=this.containerEntry.createComponent(t);i.instance.shortcutLink=e}}))}_getShortcutLinks(e){const t=this.location.path();return SeRouteService.routeShortcutConfigs.map((i=>{let o;const n=i.fullPath.replace(":siteId",e.catalogDescriptor.siteId).replace(":catalogId",e.catalogDescriptor.catalogId).replace(":catalogVersion",e.catalogDescriptor.catalogVersion);if(n.startsWith("/")){o=n===t}else{o=`/${n}`===t}const s=Object.assign({},i);s.fullPath=n;s.active=o;return s}))}_orderByPriority(e){e.forEach((e=>e.priority=e.priority||500));return this.priorityService.sort(e)}};__decorate([n.ViewChild("container",{read:n.ViewContainerRef,static:false}),__metadata("design:type",n.ViewContainerRef)],t.ShortcutLinkComponent.prototype,"containerEntry",void 0);__decorate([n.ViewChild("defaultTemplate",{read:n.TemplateRef,static:false}),__metadata("design:type",n.TemplateRef)],t.ShortcutLinkComponent.prototype,"defaultTemplate",void 0);t.ShortcutLinkComponent=__decorate([n.Component({selector:"shortcut-link",template:`<ng-container #container><ng-template #defaultTemplate let-shortcutLink><div class="se-shortcut-link"><a class="se-shortcut-link__item" [ngClass]="{'se-shortcut-link__item--active': shortcutLink.active}" (click)="onClick(shortcutLink)">{{shortcutLink.titleI18nKey | translate}}</a></div></ng-template></ng-container>`}),__metadata("design:paramtypes",[_.Router,g.Location,n.ComponentFactoryResolver,IExperienceService,t.PriorityService,t.SystemEventService,IUserTrackingService])],t.ShortcutLinkComponent);class SliderPanelZIndexHelper{getHighestZIndex(e){return Math.max(...this.getChildrenNodesFromTreeOrLeaf(e[0]).filter((e=>this.filterBlacklistedNodes(e))).map((e=>this.mapToZIndexIntegers(e))))}filterBlacklistedNodes(e){return!SliderPanelZIndexHelper.BLACKLISTED_NODE_NAMES.has(e.nodeName)}mapToZIndexIntegers(e){return parseInt(window.getComputedStyle(e).getPropertyValue("z-index"),10)||parseInt(e.style.zIndex,10)||0}getChildrenNodesFromTreeOrLeaf(e){return[e,...s.flatten(Array.from(e.children).map((e=>this.getChildrenNodesFromTreeOrLeaf(e))))]}}SliderPanelZIndexHelper.BLACKLISTED_NODE_NAMES=new Set(["SCRIPT","LINK","BASE"]);class SliderPanelService{constructor(e,t,i,o){this.element=e;this.window=t;this.configuration=i;this.yjQuery=o;this.inlineStyling={container:{},content:{}};this.sliderPanelDefaultConfiguration={slideFrom:"right",overlayDimension:"80%"};this.init()}updateContainerInlineStyling(e){const t=this.parent[0].getBoundingClientRect();const i={left:this.parent.css("border-left-width")?parseInt(this.parent.css("border-left-width").replace("px",""),10):0,top:this.parent.css("border-top-width")?parseInt(this.parent.css("border-top-width").replace("px",""),10):0};this.inlineStyling.container.height=this.parent[0].clientHeight+"px";this.inlineStyling.container.width=this.parent[0].clientWidth+"px";this.inlineStyling.container.left=(this.appendChildTarget.nodeName==="BODY"?Math.round(t.left+this.window.pageXOffset+i.left):0)+"px";this.inlineStyling.container.top=(this.appendChildTarget.nodeName==="BODY"?Math.round(t.top+this.window.pageYOffset+i.top):0)+"px";if(!e){this.inlineStyling.container.zIndex=this.sliderPanelConfiguration.zIndex?this.sliderPanelConfiguration.zIndex.toString():(this.returningHigherZIndex()+1).toString()}}returningHigherZIndex(){return(new SliderPanelZIndexHelper).getHighestZIndex(this.yjQuery("body"))}initializeParentRawElement(){const e=this.sliderPanelConfiguration.cssSelector?document.querySelector(this.sliderPanelConfiguration.cssSelector):null;this.parent=this.yjQuery(e||this.element.parent())}initializePanelConfiguration(){this.sliderPanelConfiguration=s.defaultsDeep(this.configuration,this.sliderPanelDefaultConfiguration)}initializeInlineStyles(){const e=["top","bottom"].indexOf(this.sliderPanelConfiguration.slideFrom)===-1?"width":"height";this.inlineStyling.content[e]=this.sliderPanelConfiguration.overlayDimension}initializeChildTarget(){let e=this.parent;let t=false;let i=0;for(i;e[0]&&e[0].nodeName!=="BODY";e=this.yjQuery(e.parent()),i++){const i=(e[0].getAttribute("class")||"").includes("fd-dialog__content");const o=e[0].getAttribute("id")==="y-modal-dialog";if(i||o){t=true;break}}this.appendChildTarget=t?e[0]:document.body}append(){this.yjQuery(this.appendChildTarget).append(this.element[0])}init(){this.initializePanelConfiguration();this.initializeParentRawElement();this.initializeInlineStyles();this.initializeChildTarget();this.append()}}t.SliderPanelServiceFactory=class SliderPanelServiceFactory{constructor(e){this.yjQuery=e}getNewServiceInstance(e,t,i){return new SliderPanelService(e,t,i,this.yjQuery)}};t.SliderPanelServiceFactory=__decorate([__param(0,n.Inject(ko)),__metadata("design:paramtypes",[Function])],t.SliderPanelServiceFactory);const fn={SLIDERPANEL_ANIMATED:"sliderpanel--animated",SLIDERPANEL_SLIDEPREFIX:"sliderpanel--slidefrom"};window.__smartedit__.addDecoratorPayload("Component","SliderPanelComponent",{selector:"se-slider-panel",template:`<div class="se-slider-panel-wrapper" *ngIf="isShown"><div class="se-slider-panel-container slide-in"><div class="se-slider-panel__header" *ngIf="sliderPanelConfiguration.modal"><span class="se-slider-panel__title" *ngIf="sliderPanelConfiguration.modal.title">{{ sliderPanelConfiguration.modal.title | translate }}</span> <button type="button" class="se-slider-panel__close-btn fd-button fd-button--transparent fd-dialog__close" aria-label="close" *ngIf="sliderPanelConfiguration.modal.showDismissButton" (click)="sliderPanelDismissAction()" title="{{ 'se.btn.close.title' | translate }}"><span class="sap-icon--decline"></span></button></div><div class="se-slider-panel__body"><ng-content></ng-content></div><div class="se-slider-panel__footer" *ngIf="sliderPanelConfiguration.modal && (sliderPanelConfiguration.modal.cancel || sliderPanelConfiguration.modal.save)"><button type="button" class="fd-button fd-button--emphasized se-slider-panel__footer-btn se-slider-panel__footer-btn--save" *ngIf="sliderPanelConfiguration.modal.save" (click)="sliderPanelConfiguration.modal.save.onClick()" [disabled]="isSaveDisabled()">{{ sliderPanelConfiguration.modal.save.label | translate }}</button> <button type="button" class="fd-button fd-button--transparent se-slider-panel__footer-btn se-slider-panel__footer-btn--cancel" *ngIf="sliderPanelConfiguration.modal.cancel" (click)="sliderPanelConfiguration.modal.cancel.onClick()">{{ sliderPanelConfiguration.modal.cancel.label | translate }}</button></div></div></div>`,styles:[`.se-slider-panel-wrapper{position:fixed;display:flex;justify-content:center;overflow:hidden;width:100%;top:0;left:0;z-index:999}.se-slider-panel-container{display:flex;flex-direction:column;transform:translateX(100%);-webkit-transform:translateX(100%);background-color:var(--sapBaseColor);border-radius:4px;width:650px}.se-slider-panel__header{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);height:53px}.se-slider-panel__header:first-child{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-slider-panel__body{padding:20px;overflow-y:auto;max-height:70vh;height:70vh;min-height:500px;flex:1 1 auto}.se-slider-panel__footer{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:flex-end;border-top:1px solid var(--sapGroup_ContentBorderColor);height:69px}.se-slider-panel__footer button{text-transform:capitalize;margin-left:12px}.slide-in{animation:slide-in .4s forwards;-webkit-animation:slide-in .4s forwards}@keyframes slide-in{100%{transform:translateX(0)}}@-webkit-keyframes slide-in{100%{-webkit-transform:translateX(0)}}:host-context(fd-dialog-container).sliderpanel--animated{position:fixed;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);align-items:center;display:flex;z-index:1000}:host-context(fd-dialog-container).sliderpanel--animated .se-slider-panel-wrapper{top:auto}:host-context(fd-dialog-container).sliderpanel--animated .se-slider-panel-wrapper .se-slider-panel__body{max-height:calc(100vh - 128px);min-height:auto}`]});t.SliderPanelComponent=class SliderPanelComponent{constructor(e,t,i,o,s){this.renderer=e;this.element=t;this.windowUtils=i;this.yjQuery=o;this.sliderPanelServiceFactory=s;this.sliderPanelHideChange=new n.EventEmitter;this.sliderPanelShowChange=new n.EventEmitter;this.isShownChange=new n.EventEmitter;this.inlineStyling={container:{},content:{}}}ngOnInit(){this.isShown=false;this.uniqueId=ae.generateIdentifier();this.sliderPanelService=this.sliderPanelServiceFactory.getNewServiceInstance(this.yjQuery(this.element.nativeElement),this.windowUtils.getWindow(),this.sliderPanelConfiguration);this.sliderPanelConfiguration=this.sliderPanelService.sliderPanelConfiguration;this.slideClassName=fn.SLIDERPANEL_SLIDEPREFIX+this.sliderPanelConfiguration.slideFrom;this.inlineStyling={container:this.sliderPanelService.inlineStyling.container,content:this.sliderPanelService.inlineStyling.content};setTimeout((()=>{this.sliderPanelShowChange.emit((()=>this.showSlider()));this.sliderPanelHideChange.emit((()=>this.hideSlider()))}));this.sliderPanelDismissAction=this.sliderPanelConfiguration.modal&&this.sliderPanelConfiguration.modal.dismiss&&this.sliderPanelConfiguration.modal.dismiss.onClick?this.sliderPanelConfiguration.modal.dismiss.onClick:this.hideSlider;this.addScreenResizeEventHandler();if(this.sliderPanelConfiguration.displayedByDefault){this.showSlider()}}ngOnDestroy(){this.yjQuery(this.windowUtils.getWindow()).off("resize.doResize")}hideSlider(){return new Promise((e=>{this.renderer.removeClass(this.element.nativeElement,fn.SLIDERPANEL_ANIMATED);this.isShown=false;this.isShownChange.emit(this.isShown);e()}))}showSlider(){return new Promise((e=>{this.sliderPanelService.updateContainerInlineStyling(false);this.inlineStyling.container=this.sliderPanelService.inlineStyling.container;let t=false;this.yjQuery("se-slider-panel.sliderpanel--animated .se-slider-panel-container").toArray().forEach((e=>{const i=this.yjQuery(e);if(!t){if(i.css("height")===this.inlineStyling.container.height&&i.css("width")===this.inlineStyling.container.width&&i.css("left")===this.inlineStyling.container.left&&i.css("top")===this.inlineStyling.container.top){t=true}}}));this.sliderPanelConfiguration.noGreyedOutOverlay=typeof this.sliderPanelConfiguration.noGreyedOutOverlay==="boolean"?this.sliderPanelConfiguration.noGreyedOutOverlay:t;this.isShown=true;this.isShownChange.emit(this.isShown);this.renderer.addClass(this.element.nativeElement,fn.SLIDERPANEL_ANIMATED);e()}))}isSaveDisabled(){if(this.sliderPanelConfiguration.modal&&this.sliderPanelConfiguration.modal.save&&this.sliderPanelConfiguration.modal.save.isDisabledFn){return this.sliderPanelConfiguration.modal.save.isDisabledFn()}return false}addScreenResizeEventHandler(){this.yjQuery(this.windowUtils.getWindow()).on("resize.sliderPanelRedraw_"+this.uniqueId,(()=>{if(this.isShown){setTimeout((()=>{this.sliderPanelService.updateContainerInlineStyling(true);this.inlineStyling.container=this.sliderPanelService.inlineStyling.container}),0)}}))}};__decorate([n.Input(),__metadata("design:type",Object)],t.SliderPanelComponent.prototype,"sliderPanelConfiguration",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.SliderPanelComponent.prototype,"sliderPanelHide",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.SliderPanelComponent.prototype,"sliderPanelShow",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.SliderPanelComponent.prototype,"sliderPanelHideChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.SliderPanelComponent.prototype,"sliderPanelShowChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.SliderPanelComponent.prototype,"isShownChange",void 0);__decorate([n.ContentChild(n.TemplateRef,{static:false}),__metadata("design:type",n.TemplateRef)],t.SliderPanelComponent.prototype,"content",void 0);t.SliderPanelComponent=__decorate([n.Component({selector:"se-slider-panel",template:`<div class="se-slider-panel-wrapper" *ngIf="isShown"><div class="se-slider-panel-container slide-in"><div class="se-slider-panel__header" *ngIf="sliderPanelConfiguration.modal"><span class="se-slider-panel__title" *ngIf="sliderPanelConfiguration.modal.title">{{ sliderPanelConfiguration.modal.title | translate }}</span> <button type="button" class="se-slider-panel__close-btn fd-button fd-button--transparent fd-dialog__close" aria-label="close" *ngIf="sliderPanelConfiguration.modal.showDismissButton" (click)="sliderPanelDismissAction()" title="{{ 'se.btn.close.title' | translate }}"><span class="sap-icon--decline"></span></button></div><div class="se-slider-panel__body"><ng-content></ng-content></div><div class="se-slider-panel__footer" *ngIf="sliderPanelConfiguration.modal && (sliderPanelConfiguration.modal.cancel || sliderPanelConfiguration.modal.save)"><button type="button" class="fd-button fd-button--emphasized se-slider-panel__footer-btn se-slider-panel__footer-btn--save" *ngIf="sliderPanelConfiguration.modal.save" (click)="sliderPanelConfiguration.modal.save.onClick()" [disabled]="isSaveDisabled()">{{ sliderPanelConfiguration.modal.save.label | translate }}</button> <button type="button" class="fd-button fd-button--transparent se-slider-panel__footer-btn se-slider-panel__footer-btn--cancel" *ngIf="sliderPanelConfiguration.modal.cancel" (click)="sliderPanelConfiguration.modal.cancel.onClick()">{{ sliderPanelConfiguration.modal.cancel.label | translate }}</button></div></div></div>`,styles:[`.se-slider-panel-wrapper{position:fixed;display:flex;justify-content:center;overflow:hidden;width:100%;top:0;left:0;z-index:999}.se-slider-panel-container{display:flex;flex-direction:column;transform:translateX(100%);-webkit-transform:translateX(100%);background-color:var(--sapBaseColor);border-radius:4px;width:650px}.se-slider-panel__header{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:space-between;border-bottom:1px solid var(--sapGroup_ContentBorderColor);height:53px}.se-slider-panel__header:first-child{font-size:1rem!important;line-height:1.25;font-weight:400;color:var(--sapTextColor)}.se-slider-panel__body{padding:20px;overflow-y:auto;max-height:70vh;height:70vh;min-height:500px;flex:1 1 auto}.se-slider-panel__footer{padding:20px;display:flex;flex-direction:row;align-items:center;justify-content:flex-end;border-top:1px solid var(--sapGroup_ContentBorderColor);height:69px}.se-slider-panel__footer button{text-transform:capitalize;margin-left:12px}.slide-in{animation:slide-in .4s forwards;-webkit-animation:slide-in .4s forwards}@keyframes slide-in{100%{transform:translateX(0)}}@-webkit-keyframes slide-in{100%{-webkit-transform:translateX(0)}}:host-context(fd-dialog-container).sliderpanel--animated{position:fixed;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);align-items:center;display:flex;z-index:1000}:host-context(fd-dialog-container).sliderpanel--animated .se-slider-panel-wrapper{top:auto}:host-context(fd-dialog-container).sliderpanel--animated .se-slider-panel-wrapper .se-slider-panel__body{max-height:calc(100vh - 128px);min-height:auto}`]}),__param(3,n.Inject(ko)),__metadata("design:paramtypes",[n.Renderer2,n.ElementRef,t.WindowUtils,Function,t.SliderPanelServiceFactory])],t.SliderPanelComponent);t.SliderPanelModule=class SliderPanelModule{};t.SliderPanelModule=__decorate([n.NgModule({imports:[g.CommonModule,r.TranslationModule.forChild()],declarations:[t.SliderPanelComponent],entryComponents:[t.SliderPanelComponent],providers:[t.SliderPanelServiceFactory],exports:[t.SliderPanelComponent]})],t.SliderPanelModule);t.ResizeObserverDirective=class ResizeObserverDirective{constructor(e){this.elementRef=e;this.onResize=new n.EventEmitter}ngOnInit(){this.startWatching()}ngOnDestroy(){this.observer.disconnect()}startWatching(){this.observer=new N.ResizeObserver((e=>this.internalOnResize(e)));this.observer.observe(this.elementRef.nativeElement)}internalOnResize(e){this.onResize.emit()}};__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.ResizeObserverDirective.prototype,"onResize",void 0);t.ResizeObserverDirective=__decorate([n.Directive({selector:"[seResizeObserver]"}),__metadata("design:paramtypes",[n.ElementRef])],t.ResizeObserverDirective);t.ResizeObserverModule=class ResizeObserverModule{};t.ResizeObserverModule=__decorate([n.NgModule({declarations:[t.ResizeObserverDirective],exports:[t.ResizeObserverDirective]})],t.ResizeObserverModule);class HasOperationPermissionBaseDirective{constructor(e,t,i){this.systemEventService=e;this.permissionService=t;this.logService=i}ngOnInit(){this.unregisterHandler=this.systemEventService.subscribe(r.EVENTS.PERMISSION_CACHE_CLEANED,this.refreshIsPermissionGranted.bind(this))}ngOnDestroy(){this.unregisterHandler()}ngOnChanges(e){if(e.hasOperationPermission&&e.hasOperationPermission.currentValue){this.permission=e.hasOperationPermission.currentValue;this.refreshIsPermissionGranted()}}set isPermissionGrantedHandler(e){this._isPermissionGrantedHandler=e}refreshIsPermissionGranted(){this.isPermissionGranted(this.permission).then((e=>{this._isPermissionGrantedHandler(e)}))}isPermissionGranted(e){return this.permissionService.isPermitted(this.validateAndPreparePermissions(e)).then((e=>e),(e=>{this.logService.error("Failed to retrieve authorization",e);return false})).then((e=>e))}validateAndPreparePermissions(e){if(typeof e!=="string"&&!Array.isArray(e)){throw new Error("Permission should be string or an array of objects")}return typeof e==="string"?this.toPermissions(e):e}toPermissions(e){return[{names:e.split(",")}]}}let yn=class HasOperationPermissionDirective extends HasOperationPermissionBaseDirective{constructor(e,t,i,o,n,s){super(i,o,n);this.templateRef=e;this.viewContainerRef=t;this.cdr=s;this.hasView=false;this.isPermissionGrantedHandler=this.getIsPermissionGrantedHandler()}ngOnInit(){super.ngOnInit()}ngOnChanges(e){super.ngOnChanges({hasOperationPermission:new n.SimpleChange(e.seHasOperationPermission.previousValue,e.seHasOperationPermission.currentValue,e.seHasOperationPermission.firstChange)})}ngOnDestroy(){super.ngOnDestroy()}getIsPermissionGrantedHandler(){return e=>{this.updateView(e)}}updateView(e){if(e&&!this.hasView){this.viewContainerRef.createEmbeddedView(this.templateRef);this.hasView=true}else if(!e&&this.hasView){this.viewContainerRef.clear()}this.cdr.markForCheck()}};__decorate([n.Input(),__metadata("design:type",Object)],yn.prototype,"seHasOperationPermission",void 0);yn=__decorate([n.Directive({selector:"[seHasOperationPermission]"}),__param(3,n.Inject(IPermissionService)),__metadata("design:paramtypes",[n.TemplateRef,n.ViewContainerRef,t.SystemEventService,IPermissionService,r.LogService,n.ChangeDetectorRef])],yn);t.HasOperationPermissionDirectiveModule=class HasOperationPermissionDirectiveModule{};t.HasOperationPermissionDirectiveModule=__decorate([n.NgModule({declarations:[yn],exports:[yn]})],t.HasOperationPermissionDirectiveModule);t.ClickOutsideDirective=class ClickOutsideDirective{constructor(e,t,i){this.document=e;this.host=t;this.iframeClickDetectionService=i;this.clickOutside=new n.EventEmitter;this.id=`clickOutsideIframeClick${ae.generateIdentifier()}`}onDocumentClick(e){if(e===this.host.nativeElement||this.host.nativeElement.contains(e)||this.popBody&&(this.popBody._elementRef.nativeElement.contains(e)||e===this.popBody._elementRef.nativeElement)||this.ignoreNotExistingTarget(e)){return}this.clickOutside.emit()}ngOnInit(){this.iframeClickDetectionService.registerCallback(this.id,(()=>this.onOutsideClick()))}ngOnDestroy(){this.iframeClickDetectionService.removeCallback(this.id)}ignoreNotExistingTarget(e){return!this.document.contains(e)}onOutsideClick(){this.clickOutside.emit()}};__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.ClickOutsideDirective.prototype,"clickOutside",void 0);__decorate([n.Input(),__metadata("design:type",y.PopoverBodyComponent)],t.ClickOutsideDirective.prototype,"popBody",void 0);__decorate([n.HostListener("document:click",["$event.target"]),__metadata("design:type",Function),__metadata("design:paramtypes",[HTMLElement]),__metadata("design:returntype",void 0)],t.ClickOutsideDirective.prototype,"onDocumentClick",null);t.ClickOutsideDirective=__decorate([n.Directive({selector:"[seClickOutside]"}),__param(0,n.Inject(g.DOCUMENT)),__metadata("design:paramtypes",[Document,n.ElementRef,IIframeClickDetectionService])],t.ClickOutsideDirective);t.ClickOutsideModule=class ClickOutsideModule{};t.ClickOutsideModule=__decorate([n.NgModule({imports:[g.CommonModule],declarations:[t.ClickOutsideDirective],exports:[t.ClickOutsideDirective]})],t.ClickOutsideModule);t.CustomComponentOutletDirective=class CustomComponentOutletDirective{constructor(e,t){this.elementRef=e;this.renderer=t;this.hasView=false}ngOnChanges(){this.updateView(this.componentName)}updateView(e){if(e&&!this.hasView){this.createView()}else if(!e&&this.hasView){this.removeView()}else if(e&&this.hasView){this.removeView();this.createView()}}createView(){const e=window.__smartedit__.getComponentDecoratorPayload(this.componentName);this.component=this.renderer.createElement(e.selector);this.renderer.appendChild(this.elementRef.nativeElement,this.component);this.hasView=true}removeView(){this.renderer.removeChild(this.elementRef.nativeElement,this.component);this.hasView=false}};__decorate([n.Input("seCustomComponentOutlet"),__metadata("design:type",String)],t.CustomComponentOutletDirective.prototype,"componentName",void 0);t.CustomComponentOutletDirective=__decorate([n.Directive({selector:"[seCustomComponentOutlet]"}),__metadata("design:paramtypes",[n.ElementRef,n.Renderer2])],t.CustomComponentOutletDirective);t.CustomComponentOutletDirectiveModule=class CustomComponentOutletDirectiveModule{};t.CustomComponentOutletDirectiveModule=__decorate([n.NgModule({declarations:[t.CustomComponentOutletDirective],exports:[t.CustomComponentOutletDirective]})],t.CustomComponentOutletDirectiveModule);t.ReversePipe=class ReversePipe{transform(e){if(!e){return undefined}return e.slice().reverse()}};t.ReversePipe=__decorate([n.Pipe({name:"seReverse"})],t.ReversePipe);t.ReversePipeModule=class ReversePipeModule{};t.ReversePipeModule=__decorate([n.NgModule({declarations:[t.ReversePipe],exports:[t.ReversePipe]})],t.ReversePipeModule);t.PropertyPipe=class PropertyPipe{transform(e,t){if(!e){return undefined}if(!t){return[...e]}return e.filter((e=>Object.keys(t).every((i=>e[i]===t[i]))))}};t.PropertyPipe=__decorate([n.Pipe({name:"seProperty"})],t.PropertyPipe);t.PropertyPipeModule=class PropertyPipeModule{};t.PropertyPipeModule=__decorate([n.NgModule({declarations:[t.PropertyPipe],exports:[t.PropertyPipe]})],t.PropertyPipeModule);var Sn;t.StartFromPipe=Sn=class StartFromPipe{static transform(e,t){return e?e.slice(Number(t)):[]}transform(e,t){return Sn.transform(e,t)}};t.StartFromPipe=Sn=__decorate([n.Pipe({name:"seStartFrom"})],t.StartFromPipe);t.StartFromPipeModule=class StartFromPipeModule{};t.StartFromPipeModule=__decorate([n.NgModule({declarations:[t.StartFromPipe],exports:[t.StartFromPipe]})],t.StartFromPipeModule);var Cn;t.FilterByFieldPipe=Cn=class FilterByFieldPipe{static transform(e,t,i,o){const n=o||s.noop;const a=[];if(!t){n(e);return e}const r=t.toLowerCase().split(" ");(e||[]).forEach((e=>{i=i||Object.keys(e);const t=i.map((t=>e[t])).filter((e=>typeof e==="string"||e instanceof String)).map((e=>e.toLowerCase()));const o=r.map((e=>!!t.find((t=>t.indexOf(e)>=0)))).filter((e=>!e));if(o.length===0){a.push(e)}}));n(a);return a}transform(e,t,i,o){return Cn.transform(e,t,i,o)}};t.FilterByFieldPipe=Cn=__decorate([n.Pipe({name:"seFilterByField"})],t.FilterByFieldPipe);t.FilterByFieldPipeModule=class FilterByFieldPipeModule{};t.FilterByFieldPipeModule=__decorate([n.NgModule({declarations:[t.FilterByFieldPipe],exports:[t.FilterByFieldPipe]})],t.FilterByFieldPipeModule);t.SharedComponentsModule=class SharedComponentsModule{};t.SharedComponentsModule=__decorate([n.NgModule({imports:[r.TranslationModule.forChild(),t.FundamentalsModule,g.CommonModule,E.FormsModule,r.SelectModule,r.LanguageDropdownModule,E.ReactiveFormsModule,t.CollapsibleContainerModule,t.MessageModule,t.NgTreeModule,t.HasOperationPermissionDirectiveModule,t.DropdownMenuModule,t.ResizeObserverModule,t.InfiniteScrollingModule,t.SpinnerModule,t.PopupOverlayModule,t.StartFromPipeModule,t.PaginationModule,t.TooltipModule,t.ReversePipeModule,t.EditableListModule,t.SliderPanelModule,r.LoginDialogModule,r.FundamentalModalTemplateModule,t.DynamicPagedListModule,cn,t.HelpModule,t.TabsModule,t.MoreTextModule,t.PreventVerticalOverflowModule,A.DialogModule],declarations:[t.WaitDialogComponent,t.ShortcutLinkComponent],entryComponents:[t.WaitDialogComponent,t.ShortcutLinkComponent],exports:[t.WaitDialogComponent,t.ShortcutLinkComponent,r.SelectModule,r.LanguageDropdownModule,t.MessageModule,t.NgTreeModule,t.CollapsibleContainerModule,t.HasOperationPermissionDirectiveModule,t.DropdownMenuModule,t.PopupOverlayModule,t.ResizeObserverModule,t.InfiniteScrollingModule,t.StartFromPipeModule,t.PaginationModule,t.TooltipModule,t.ReversePipeModule,t.EditableListModule,t.SpinnerModule,t.SliderPanelModule,r.LoginDialogModule,r.FundamentalModalTemplateModule,t.DynamicPagedListModule,cn,t.HelpModule,t.TabsModule,t.MoreTextModule,t.PreventVerticalOverflowModule]})],t.SharedComponentsModule);window.__smartedit__.addDecoratorPayload("Component","ActionableSearchItemComponent",{selector:"se-actionable-search-item",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-actionable-search-item]":"true"},template:`<div *ngIf="search" class="se-actionable-search-item"><div class="se-actionable-search-item__name">{{ search }}</div><button type="button" class="fd-button fd-button--transparent se-actionable-search-item__action-btn" (click)="onButtonClick()">{{ getActionText() | translate }}</button></div>`});t.ActionableSearchItemComponent=class ActionableSearchItemComponent{constructor(e){this.systemEventService=e;this.actionButtonClick=new n.EventEmitter;this.defaultEventId="yActionableSearchItem_ACTION_CREATE";this.defaultActionText="se.yationablesearchitem.action.create"}getActionText(){return this.actionText||this.defaultActionText}onButtonClick(){const e=this.eventId||this.defaultEventId;this.systemEventService.publishAsync(e,this.search||"");this.actionButtonClick.emit()}};__decorate([n.Input(),__metadata("design:type",String)],t.ActionableSearchItemComponent.prototype,"search",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.ActionableSearchItemComponent.prototype,"eventId",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.ActionableSearchItemComponent.prototype,"actionText",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.ActionableSearchItemComponent.prototype,"actionButtonClick",void 0);t.ActionableSearchItemComponent=__decorate([n.Component({selector:"se-actionable-search-item",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-actionable-search-item]":"true"},template:`<div *ngIf="search" class="se-actionable-search-item"><div class="se-actionable-search-item__name">{{ search }}</div><button type="button" class="fd-button fd-button--transparent se-actionable-search-item__action-btn" (click)="onButtonClick()">{{ getActionText() | translate }}</button></div>`}),__metadata("design:paramtypes",[t.SystemEventService])],t.ActionableSearchItemComponent);const bn=new n.InjectionToken("ITEM_COMPONENT_DATA");window.__smartedit__.addDecoratorPayload("Component","DefaultItemPrinterComponent",{selector:"se-default-item-printer",changeDetection:n.ChangeDetectionStrategy.OnPush,styles:[`.se-item-printer-text{vertical-align:middle;position:relative;max-width:100%;font-family:"72";color:var(--sapNeutralColor);display:inline-block}`],template:`<span fd-menu-title [attr.title]="((data.item.label || data.item.name) | seL10n | async) | translate" class="se-item-printer-text se-nowrap-ellipsis">{{ ((data.item.label || data.item.name) | seL10n | async) | translate }}</span>`});let In=class DefaultItemPrinterComponent{constructor(e){this.data=e}};In=__decorate([n.Component({selector:"se-default-item-printer",changeDetection:n.ChangeDetectionStrategy.OnPush,styles:[`.se-item-printer-text{vertical-align:middle;position:relative;max-width:100%;font-family:"72";color:var(--sapNeutralColor);display:inline-block}`],template:`<span fd-menu-title [attr.title]="((data.item.label || data.item.name) | seL10n | async) | translate" class="se-item-printer-text se-nowrap-ellipsis">{{ ((data.item.label || data.item.name) | seL10n | async) | translate }}</span>`}),__param(0,n.Inject(bn)),__metadata("design:paramtypes",[Object])],In);window.__smartedit__.addDecoratorPayload("Component","SearchInputComponent",{selector:"se-select-search-input",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-select-search-input]":"true"},template:`<div class="search"><input #searchInput type="search" class="search__input fd-input" [disabled]="isDisabled" [readOnly]="isReadOnly" [placeholder]="placeholder" [ngModel]="search" (ngModelChange)="onChange($event)" (keyup)="onKeyup($event)"/></div>`});let En=class SearchInputComponent{constructor(e,t){this.elementRef=e;this.sharedDataService=t;this.searchKeyup=new n.EventEmitter;this.searchChange=new n.EventEmitter}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.configurations=yield this.sharedDataService.get("configuration");this.initSearchInputFilter()}))}ngOnDestroy(){this.searchTermSubscription.unsubscribe()}get nativeElement(){return this.elementRef.nativeElement}get inputElement(){return this.searchInput.nativeElement}focus(){this.inputElement.focus()}onChange(e){this.isTypeAheadEnabled?this.searchTermSubject.next(e):this.searchChange.emit(e)}onKeyup(e){this.keyUpEvent=e;const t=e.target.value;this.isTypeAheadEnabled?this.searchTermSubject.next(t):this.searchKeyup.emit({event:this.keyUpEvent,value:t})}initSearchInputFilter(){this.searchTermSubject=new m.Subject;this.searchTerm$=this.searchTermSubject.asObservable().pipe(v.filter((e=>this.configurations&&this.configurations.typeAheadMiniSearchTermLength?e.length>0&&e.length>this.configurations.typeAheadMiniSearchTermLength:true)),v.debounceTime(this.configurations&&this.configurations.typeAheadDebounce||500),v.distinctUntilChanged());this.searchTermSubscription=this.searchTerm$.subscribe((e=>{this.searchKeyup.emit({event:this.keyUpEvent,value:e});this.searchChange.emit(e)}))}};__decorate([n.Input(),__metadata("design:type",Boolean)],En.prototype,"isDisabled",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],En.prototype,"isReadOnly",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],En.prototype,"isTypeAheadEnabled",void 0);__decorate([n.Input(),__metadata("design:type",String)],En.prototype,"placeholder",void 0);__decorate([n.Input(),__metadata("design:type",String)],En.prototype,"search",void 0);__decorate([n.Output(),__metadata("design:type",Object)],En.prototype,"searchKeyup",void 0);__decorate([n.Output(),__metadata("design:type",Object)],En.prototype,"searchChange",void 0);__decorate([n.ViewChild("searchInput",{static:false}),__metadata("design:type",n.ElementRef)],En.prototype,"searchInput",void 0);En=__decorate([n.Component({selector:"se-select-search-input",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-select-search-input]":"true"},template:`<div class="search"><input #searchInput type="search" class="search__input fd-input" [disabled]="isDisabled" [readOnly]="isReadOnly" [placeholder]="placeholder" [ngModel]="search" (ngModelChange)="onChange($event)" (keyup)="onKeyup($event)"/></div>`}),__metadata("design:paramtypes",[n.ElementRef,r.ISharedDataService])],En);window.__smartedit__.addDecoratorPayload("Component","SelectComponent",{selector:"se-select",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-select]":"true"},template:`<fd-select [style.display]="'none'"></fd-select><div [attr.id]="id + '-selector'" class="select-container" [ngClass]="{\n        'has-warning': hasWarning(),\n        'has-error': hasError()\n    }"><ng-container *ngIf="multiSelect; then multi; else singleSelect"></ng-container><ng-template #singleSelect><fd-popover [triggers]="['click']" [(isOpen)]="isOpen" [placement]="'bottom'" (isOpenChange)="onSingleSelectIsOpenChange($event)" fillControlMode="equal" [focusTrapped]="true" [focusAutoCapture]="true" [additionalBodyClass]="fullAdditionalBodyClass"><fd-popover-control><div class="selected-container fd-select-custom" [attr.has-selected-option]="!!selected || null"><button fd-button class="fd-select-button-custom toggle-button" [disabled]="isReadOnly" [fdMenu]="!isReadOnly"><span *ngIf="!selected; else selectedItem" class="selected-placeholder selected-item">{{ placeholder | translate }}</span><ng-template #selectedItem><div class="selected-item"><span *ngIf="controls" class="sap-icon--search">{{ placeholder | translate }}</span><se-item-printer *ngIf="selected" [attr.id]="id + '-selected'" [item]="selected" [component]="itemComponent" [selectComponentCtx]="this"></se-item-printer><span *ngIf="controls || showRemoveButton" class="sap-icon--sys-cancel selected-item__remove-button" (click)="removeSelectedOption($event, selected)"></span></div></ng-template></button></div></fd-popover-control><fd-popover-body><ul fd-list class="se-select-list-container"><ng-container *ngIf="searchEnabled && isOpen"><ng-container *ngTemplateOutlet="searchInputTemplate"></ng-container></ng-container><ng-container *ngTemplateOutlet="resultsHeader"></ng-container><ng-container *ngIf="isOpen"><ng-container *ngTemplateOutlet="selectListTemplate"></ng-container></ng-container></ul></fd-popover-body></fd-popover></ng-template><ng-template #multi><div [ngClass]="{'se-multi-select': selected && selected.length > 0}"><div class="selected-container se-selected-list"><ng-container *ngIf="selected && selected.length > 0"><div class="selected-list" cdkDropList (cdkDropListDropped)="onDrop($event)"><div *ngFor="let item of selected; trackBy: itemTrackBy" class="selected-list__item selected-item"><div cdkDrag><se-item-printer [item]="item" [component]="itemComponent" [selectComponentCtx]="this"></se-item-printer><div class="selected-list__placeholder" *cdkDragPlaceholder></div></div><span class="sap-icon--sys-cancel selected-item__remove-button selected-item-remove" (click)="removeSelectedOption($event, item)"></span></div></div></ng-container></div></div><fd-popover class="se-multi-select" [triggers]="[]" [closeOnOutsideClick]="false" [isOpen]="isOpen" [placement]="'bottom'" fillControlMode="equal" [focusTrapped]="true" [focusAutoCapture]="true" [additionalBodyClass]="fullAdditionalBodyClass"><fd-popover-control><ng-container *ngTemplateOutlet="searchInputTemplate"></ng-container></fd-popover-control><fd-popover-body><ul fd-list class="se-select-list-container"><ng-container *ngTemplateOutlet="resultsHeader"></ng-container><ng-container *ngIf="isOpen"><ng-container *ngTemplateOutlet="selectListTemplate"></ng-container></ng-container></ul></fd-popover-body></fd-popover></ng-template><ng-template #resultsHeader><se-select-results-header [search]="search" [resultsHeaderComponent]="resultsHeaderComponent" [resultsHeaderLabel]="resultsHeaderLabel" [displayResultsHeaderLabel]="showResultsHeaderLabel()" [actionableSearchItem]="actionableSearchItem" (actionButtonClick)="closeAndReset()"></se-select-results-header></ng-template><ng-template #searchInputTemplate><se-select-search-input [isDisabled]="isReadOnly" [isReadOnly]="multiSelect && !searchEnabled" [isTypeAheadEnabled]="!multiSelect" [placeholder]="showPlaceholder() ? (placeholder | translate) : ''" [search]="search" (searchKeyup)="onSearchInputKeyup($event.event, $event.value)" (searchChange)="onSearchInputChange($event)"></se-select-search-input></ng-template><ng-template #selectListTemplate><se-select-list [id]="id" [isPagedDropdown]="isPagedDropdown()" [fetchPage]="fetchStrategy.fetchPage" [search]="search" [items]="items" [selected]="selected" [excludeSelected]="multiSelect" [disableChoiceFn]="disableChoiceFn" [itemComponent]="itemComponent" [selectComponentCtx]="this" (optionClick)="onOptionClick($event)" (infiniteScrollItemsChange)="onInfiniteScrollItemsChange()"></se-select-list></ng-template></div>`,styles:[`.se-select:not(.se-select--paged) .se-select-list-container{overflow-y:auto;max-height:200px;width:auto}.se-select .select-container.has-warning .fd-select-button-custom,.se-select .select-container.has-warning .fd-select-button-custom:hover,.se-select .select-container.has-warning .selected-container{border-color:var(--sapWarningColor)}.se-select .select-container.has-error .fd-select-button-custom,.se-select .select-container.has-error .fd-select-button-custom:hover,.se-select .select-container.has-error .selected-container{border-color:var(--sapErrorColor)}.se-select .se-item-printer{width:100%}.se-select--single .selected-item{display:flex;width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;z-index:1}.se-select.is-disabled fd-popover,.se-select:disabled fd-popover,.se-select[aria-disabled=true] fd-popover{pointer-events:none;cursor:not-allowed;box-shadow:none;opacity:.65}.se-select.is-disabled .selected-item__remove-button,.se-select:disabled .selected-item__remove-button,.se-select[aria-disabled=true] .selected-item__remove-button{color:var(--sapNeutralColor)}.se-select .fd-popover-custom{display:block;position:relative;width:100%}.se-select .fd-popover-custom .fd-select-button-custom{text-align:unset;width:100%;color:var(--sapUiFieldTextColor)}.se-select .fd-popover-custom .fd-select-button-custom:hover{border-color:inherit}.se-select .fd-popover-custom .fd-select-button-custom:focus{box-shadow:none}.se-select .fd-popover-custom .fd-select-button-custom.toggle-button .fd-button.fd-select__button{position:absolute;right:0;border:none;height:100%;border-top-right-radius:.25rem}.se-select .fd-list{padding:0;max-width:unset}.se-select .sap-icon--search{align-self:center;margin-right:5px}.se-select .sap-icon--sys-cancel{display:flex;justify-content:flex-end;color:var(--sapContent_IconColor);padding-right:30px;line-height:1.875rem;z-index:1000}.se-select .se-multi-select .selected-container{border-radius:.125rem;border:1px solid var(--sapUiFieldBorderColor,#89919a)}.se-select .se-multi-select .selected-container.se-selected-list{border-bottom:none}.se-select .se-multi-select .selected-list{padding:0;margin:0;list-style:none;border-bottom:1px solid var(--sapUiFieldBorderColor,#89919a)}.se-select .se-multi-select .selected-list__item{display:grid;grid-template-columns:16fr 1fr;padding:8px 16px;align-items:center;min-height:36px}.se-select .se-multi-select .selected-list__placeholder{opacity:0}.se-select .se-multi-select .selected-item-remove{cursor:pointer}`]});t.SelectComponent=class SelectComponent{constructor(e,t,i){this.l10nService=e;this.logService=t;this.cdr=i;this.modelChange=new n.EventEmitter;this.controls=false;this.multiSelect=false;this.keepModelOnReset=false;this.isReadOnly=false;this.searchEnabled=true;this.resetSearchInput=true;this.showRemoveButton=false;this.getApi=new n.EventEmitter;this.resetChange=new n.EventEmitter;this.isOpen=false;this.items=[];this.search="";this.api={setValidationState:this.setValidationState.bind(this),resetValidationState:this.resetValidationState.bind(this)}}get isSingleCss(){return!this.multiSelect}get isMultiCss(){return this.multiSelect}get isPagedCss(){return this.isPagedDropdown()}clickHandler(e){if(!this.multiSelect){return}if(e.target===this.searchInputCmp.inputElement){e.stopPropagation();if(!this.isOpen){this.onMultiSelectIsOpenChange(true)}}else if(this.isOpen){this.onMultiSelectIsOpenChange(false)}}ngOnInit(){if(!this.placeholder){this.placeholder="se.genericeditor.sedropdown.placeholder"}if(this.fetchStrategy.fetchAll){this.initSearchInputFilter()}this.fullAdditionalBodyClass="se-select";if(this.additionalBodyClass){this.fullAdditionalBodyClass=`${this.fullAdditionalBodyClass} ${this.additionalBodyClass}`}this.fetchData();setTimeout((()=>{this.resetChange.emit(this.internalReset.bind(this))}));this.getApi.emit(this.api)}ngOnChanges(e){if(!this.itemComponent){this.itemComponent=In}this.isValidConfiguration();const t=e.model;const i=t&&t.currentValue!==this.modelChangeOld&&!t.firstChange;if(i){if(this.multiSelect&&this.isModelEmpty()){this.model=[]}this.fetchData()}}ngOnDestroy(){if(this.languageSwitchSubscription){this.languageSwitchSubscription.unsubscribe()}if(this.searchInputChangeSubject){this.searchInputChangeSubject.unsubscribe()}}onSingleSelectIsOpenChange(e){if(e){setTimeout((()=>{if(this.searchInputCmp){this.searchInputCmp.focus()}if(this.fetchStrategy.fetchAll){this.refreshOptions(this.search)}}))}else{this.resetOnClose()}}onSearchInputKeyup(e,t){this.internalKeyup(e,t)}onSearchInputChange(e){this.onSearchChange(e);if(this.searchInputChangeSubject){this.searchInputChangeSubject.next(e)}}onOptionClick(e){let t=false;if(this.multiSelect){const i=[...this.selected||[],e];this.setSelected(i);t=true}else if(!this.isItemSelected(e)){this.setSelected(e);t=true}this.internalOnSelect(e,e.id);if(t){this.internalOnChange()}this.closeAndReset()}onSearchChange(e){this.search=e}onDrop(e){L.moveItemInArray(this.selected,e.previousIndex,e.currentIndex);this.setSelected(this.selected);const t=e.previousIndex!==e.currentIndex;if(t){this.internalOnChange()}}removeSelectedOption(e,t){e.stopPropagation();const i=this.multiSelect?this.selected.filter((e=>e!==t)):undefined;if(this.multiSelect){if(!this.searchInputCmp.isDisabled){this.setSelected(i);this.internalOnRemove(t,t.id)}}else{this.setSelected(i);this.internalOnRemove(t,t.id)}if(this.isOpen){this.closeAndReset()}}closeAndReset(){this.close();this.resetOnClose()}showResultsHeaderLabel(){return this.items.length>0&&!!this.resultsHeaderLabel}onInfiniteScrollItemsChange(){}showPlaceholder(){return this.multiSelect||!this.multiSelect&&!!this.selected}itemTrackBy(e,t){return t.id}setValidationState(e){this.validationState=e;if(!this.cdr.destroyed){this.cdr.detectChanges()}}resetValidationState(){this.validationState=undefined;if(!this.cdr.destroyed){this.cdr.detectChanges()}}hasError(){return ti.VALIDATION_ERROR===this.validationState}hasWarning(){return ti.WARNING===this.validationState}fetchEntity(e){return this.fetchStrategy.fetchEntity(e).then((e=>{if(!e){this.logService.debug("fetchEntity was used to fetch the option identified by "+e+" but failed to find a match")}return e}))}updateModelIfNotFoundInItems(e){if(!this.keepModelOnReset){if(this.multiSelect){if(this.isModelEmpty()){this.setSelected([],false);return}const t=this.model.filter((t=>this.getItemByModel(e,t)));const i=s.isEqual(this.model,t);if(!i){this.updateModel(t);this.resolveAndSetSelected(e)}else{this.resolveAndSetSelected(e)}return}if(this.isModelEmpty()){this.setSelected(undefined,false);return}const t=this.getItemByModel(e);if(!t){this.setSelected(undefined)}else{this.resolveAndSetSelected(e)}}}refreshOptions(e){this.internalFetchAll(e).then((e=>{this.items=e;if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}isValidConfiguration(){if(this.resultsHeaderComponent&&this.resultsHeaderLabel){throw new Error(`Only one of "resultsHeaderComponent" or "resultsHeaderLabel" must be specified`)}if(!this.fetchStrategy.fetchAll&&!this.fetchStrategy.fetchPage){throw new Error("Neither fetchAll nor fetchPage have been specified in fetchStrategy")}if(this.fetchStrategy.fetchAll&&this.fetchStrategy.fetchPage){throw new Error("Only one of either fetchAll or fetchPage must be specified in fetchStrategy")}if(this.fetchStrategy.fetchPage&&this.model&&!this.fetchStrategy.fetchEntity&&!this.fetchStrategy.fetchEntities){throw new Error(`fetchPage has been specified in fetchStrategy but neither fetchEntity nor fetchEntities are available to load item identified by ${this.model}`)}if(this.isPagedDropdown()&&!this.keepModelOnReset){this.logService.debug("current Select is paged, so keepModelOnReset flag is ignored (it will always keep the model on reset).")}}internalKeyup(e,t){if(this.keyup){this.keyup(e,t)}}internalOnRemove(e,t){if(this.onRemove){this.onRemove(e,t)}this.internalOnChange()}internalOnChange(){if(this.onChange){this.onChange()}}internalOnSelect(e,t){if(this.onSelect){this.onSelect(e,t)}}internalFetchAll(e=""){return this.fetchStrategy.fetchAll(e).then((e=>{this.fetchAllItems=e;return[...e]}))}internalFetchEntities(){let e;if(!this.multiSelect){e=this.fetchEntity(this.model).then((e=>[e]))}else{if(this.fetchStrategy.fetchEntities){e=this.fetchStrategy.fetchEntities(this.model).then((e=>{if(e.length!==this.model.length){this.logService.debug(`!fetchEntities was used to fetch the options identified by ${JSON.stringify(this.model)} but failed to find all matches`)}return e}))}else{const t=this.model.map((e=>this.fetchEntity(e)));e=Promise.all(t)}}return e.then((e=>{const t=e.filter((e=>e!==null)).map((e=>{delete e.$promise;delete e.$resolved;e.technicalUniqueId=ae.encode(e);return e}));this.updateModelIfNotFoundInItems(t);this.internalOnChange();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}onMultiSelectIsOpenChange(e){this.isOpen=e;if(e){if(this.isPagedDropdown()){if(!this.cdr.destroyed){this.cdr.detectChanges()}return}this.refreshOptions(this.search)}else{this.resetOnClose()}}initSearchInputFilter(){this.searchInputChangeSubject=new m.Subject;this.searchInputChange$=this.searchInputChangeSubject.asObservable();this.languageSwitchSubscription=this.l10nService.languageSwitch$.subscribe((e=>{this.filterFn=getLocalizedFilterFn(e)}));this.searchInputChange$.pipe(v.filter((()=>typeof this.fetchStrategy.fetchAll!=="undefined")),v.tap((e=>{this.items=this.filterItemsBySearch(this.fetchAllItems,e);if(!this.cdr.destroyed){this.cdr.detectChanges()}})),v.debounceTime(500),v.switchMap((e=>this.internalFetchAll(e)))).subscribe((e=>{this.items=this.filterItemsBySearch(e,this.search);if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}filterItemsBySearch(e,t){return e.filter((e=>this.filterFn(e.label||e.name).trim().toUpperCase().includes(t.trim().toUpperCase())))}close(){this.isOpen=false}resetOnClose(){if(this.search&&this.resetSearchInput){this.search="";if(!this.cdr.destroyed){this.cdr.detectChanges()}if(this.fetchStrategy.fetchAll){this.refreshOptions(this.search)}}}fetchData(){if(!this.isPagedDropdown()){this.internalFetchAllAndCheckModel()}else if(!this.isModelEmpty()){this.internalFetchEntities()}}internalFetchAllAndCheckModel(){return this.internalFetchAll().then((e=>{this.updateModelIfNotFoundInItems(e);this.internalOnChange();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}getItemByModel(e,t=this.model){return e.find((e=>e.id===t))}getItemsByModel(e,t=this.model){return t.map((t=>this.getItemByModel(e,t))).filter((e=>!!e))}mapSelectedToModel(){return this.multiSelect?this.selected.map((e=>e.id)):this.selected.id}setSelected(e,t=true){this.selected=e;if(t){let e;if(this.selected){e=this.mapSelectedToModel()}this.updateModel(e)}}isItemSelected(e){if(!this.selected){return false}return e.id===this.selected.id}internalReset(e=false){this.items.length=0;if(e){this.selected=undefined;this.resetModel();return}if(!this.keepModelOnReset){this.fetchData()}}resetModel(){const e=this.multiSelect?[]:undefined;this.updateModel(e)}updateModel(e){this.model=e;this.modelChangeOld=this.model;this.modelChange.emit(e)}isPagedDropdown(){return!!this.fetchStrategy.fetchPage}isModelEmpty(){if(this.multiSelect){return!this.model||this.model&&this.model.length===0}else{return!this.model}}resolveAndSetSelected(e){const t=this.multiSelect?this.getItemsByModel(e):this.getItemByModel(e);this.setSelected(t,false)}};__decorate([n.HostBinding("class.se-select--single"),__metadata("design:type",Boolean),__metadata("design:paramtypes",[])],t.SelectComponent.prototype,"isSingleCss",null);__decorate([n.HostBinding("class.se-select--multi"),__metadata("design:type",Boolean),__metadata("design:paramtypes",[])],t.SelectComponent.prototype,"isMultiCss",null);__decorate([n.HostBinding("class.se-select--paged"),__metadata("design:type",Boolean),__metadata("design:paramtypes",[])],t.SelectComponent.prototype,"isPagedCss",null);__decorate([n.Input(),n.HostBinding("attr.id"),__metadata("design:type",String)],t.SelectComponent.prototype,"id",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"model",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.SelectComponent.prototype,"modelChange",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"fetchStrategy",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"controls",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"multiSelect",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"keepModelOnReset",void 0);__decorate([n.Input(),n.HostBinding("class.is-disabled"),__metadata("design:type",Object)],t.SelectComponent.prototype,"isReadOnly",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"actionableSearchItem",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],t.SelectComponent.prototype,"resultsHeaderComponent",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.SelectComponent.prototype,"resultsHeaderLabel",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.SelectComponent.prototype,"disableChoiceFn",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.SelectComponent.prototype,"placeholder",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.SelectComponent.prototype,"additionalBodyClass",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],t.SelectComponent.prototype,"itemComponent",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"searchEnabled",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"resetSearchInput",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.SelectComponent.prototype,"onChange",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.SelectComponent.prototype,"onRemove",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.SelectComponent.prototype,"onSelect",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.SelectComponent.prototype,"keyup",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.SelectComponent.prototype,"showRemoveButton",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.SelectComponent.prototype,"getApi",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.SelectComponent.prototype,"reset",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.SelectComponent.prototype,"resetChange",void 0);__decorate([n.ViewChild(En,{static:false}),__metadata("design:type",En)],t.SelectComponent.prototype,"searchInputCmp",void 0);__decorate([n.HostListener("document:click",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[MouseEvent]),__metadata("design:returntype",void 0)],t.SelectComponent.prototype,"clickHandler",null);t.SelectComponent=__decorate([n.Component({selector:"se-select",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-select]":"true"},template:`<fd-select [style.display]="'none'"></fd-select><div [attr.id]="id + '-selector'" class="select-container" [ngClass]="{\n        'has-warning': hasWarning(),\n        'has-error': hasError()\n    }"><ng-container *ngIf="multiSelect; then multi; else singleSelect"></ng-container><ng-template #singleSelect><fd-popover [triggers]="['click']" [(isOpen)]="isOpen" [placement]="'bottom'" (isOpenChange)="onSingleSelectIsOpenChange($event)" fillControlMode="equal" [focusTrapped]="true" [focusAutoCapture]="true" [additionalBodyClass]="fullAdditionalBodyClass"><fd-popover-control><div class="selected-container fd-select-custom" [attr.has-selected-option]="!!selected || null"><button fd-button class="fd-select-button-custom toggle-button" [disabled]="isReadOnly" [fdMenu]="!isReadOnly"><span *ngIf="!selected; else selectedItem" class="selected-placeholder selected-item">{{ placeholder | translate }}</span><ng-template #selectedItem><div class="selected-item"><span *ngIf="controls" class="sap-icon--search">{{ placeholder | translate }}</span><se-item-printer *ngIf="selected" [attr.id]="id + '-selected'" [item]="selected" [component]="itemComponent" [selectComponentCtx]="this"></se-item-printer><span *ngIf="controls || showRemoveButton" class="sap-icon--sys-cancel selected-item__remove-button" (click)="removeSelectedOption($event, selected)"></span></div></ng-template></button></div></fd-popover-control><fd-popover-body><ul fd-list class="se-select-list-container"><ng-container *ngIf="searchEnabled && isOpen"><ng-container *ngTemplateOutlet="searchInputTemplate"></ng-container></ng-container><ng-container *ngTemplateOutlet="resultsHeader"></ng-container><ng-container *ngIf="isOpen"><ng-container *ngTemplateOutlet="selectListTemplate"></ng-container></ng-container></ul></fd-popover-body></fd-popover></ng-template><ng-template #multi><div [ngClass]="{'se-multi-select': selected && selected.length > 0}"><div class="selected-container se-selected-list"><ng-container *ngIf="selected && selected.length > 0"><div class="selected-list" cdkDropList (cdkDropListDropped)="onDrop($event)"><div *ngFor="let item of selected; trackBy: itemTrackBy" class="selected-list__item selected-item"><div cdkDrag><se-item-printer [item]="item" [component]="itemComponent" [selectComponentCtx]="this"></se-item-printer><div class="selected-list__placeholder" *cdkDragPlaceholder></div></div><span class="sap-icon--sys-cancel selected-item__remove-button selected-item-remove" (click)="removeSelectedOption($event, item)"></span></div></div></ng-container></div></div><fd-popover class="se-multi-select" [triggers]="[]" [closeOnOutsideClick]="false" [isOpen]="isOpen" [placement]="'bottom'" fillControlMode="equal" [focusTrapped]="true" [focusAutoCapture]="true" [additionalBodyClass]="fullAdditionalBodyClass"><fd-popover-control><ng-container *ngTemplateOutlet="searchInputTemplate"></ng-container></fd-popover-control><fd-popover-body><ul fd-list class="se-select-list-container"><ng-container *ngTemplateOutlet="resultsHeader"></ng-container><ng-container *ngIf="isOpen"><ng-container *ngTemplateOutlet="selectListTemplate"></ng-container></ng-container></ul></fd-popover-body></fd-popover></ng-template><ng-template #resultsHeader><se-select-results-header [search]="search" [resultsHeaderComponent]="resultsHeaderComponent" [resultsHeaderLabel]="resultsHeaderLabel" [displayResultsHeaderLabel]="showResultsHeaderLabel()" [actionableSearchItem]="actionableSearchItem" (actionButtonClick)="closeAndReset()"></se-select-results-header></ng-template><ng-template #searchInputTemplate><se-select-search-input [isDisabled]="isReadOnly" [isReadOnly]="multiSelect && !searchEnabled" [isTypeAheadEnabled]="!multiSelect" [placeholder]="showPlaceholder() ? (placeholder | translate) : ''" [search]="search" (searchKeyup)="onSearchInputKeyup($event.event, $event.value)" (searchChange)="onSearchInputChange($event)"></se-select-search-input></ng-template><ng-template #selectListTemplate><se-select-list [id]="id" [isPagedDropdown]="isPagedDropdown()" [fetchPage]="fetchStrategy.fetchPage" [search]="search" [items]="items" [selected]="selected" [excludeSelected]="multiSelect" [disableChoiceFn]="disableChoiceFn" [itemComponent]="itemComponent" [selectComponentCtx]="this" (optionClick)="onOptionClick($event)" (infiniteScrollItemsChange)="onInfiniteScrollItemsChange()"></se-select-list></ng-template></div>`,styles:[`.se-select:not(.se-select--paged) .se-select-list-container{overflow-y:auto;max-height:200px;width:auto}.se-select .select-container.has-warning .fd-select-button-custom,.se-select .select-container.has-warning .fd-select-button-custom:hover,.se-select .select-container.has-warning .selected-container{border-color:var(--sapWarningColor)}.se-select .select-container.has-error .fd-select-button-custom,.se-select .select-container.has-error .fd-select-button-custom:hover,.se-select .select-container.has-error .selected-container{border-color:var(--sapErrorColor)}.se-select .se-item-printer{width:100%}.se-select--single .selected-item{display:flex;width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;z-index:1}.se-select.is-disabled fd-popover,.se-select:disabled fd-popover,.se-select[aria-disabled=true] fd-popover{pointer-events:none;cursor:not-allowed;box-shadow:none;opacity:.65}.se-select.is-disabled .selected-item__remove-button,.se-select:disabled .selected-item__remove-button,.se-select[aria-disabled=true] .selected-item__remove-button{color:var(--sapNeutralColor)}.se-select .fd-popover-custom{display:block;position:relative;width:100%}.se-select .fd-popover-custom .fd-select-button-custom{text-align:unset;width:100%;color:var(--sapUiFieldTextColor)}.se-select .fd-popover-custom .fd-select-button-custom:hover{border-color:inherit}.se-select .fd-popover-custom .fd-select-button-custom:focus{box-shadow:none}.se-select .fd-popover-custom .fd-select-button-custom.toggle-button .fd-button.fd-select__button{position:absolute;right:0;border:none;height:100%;border-top-right-radius:.25rem}.se-select .fd-list{padding:0;max-width:unset}.se-select .sap-icon--search{align-self:center;margin-right:5px}.se-select .sap-icon--sys-cancel{display:flex;justify-content:flex-end;color:var(--sapContent_IconColor);padding-right:30px;line-height:1.875rem;z-index:1000}.se-select .se-multi-select .selected-container{border-radius:.125rem;border:1px solid var(--sapUiFieldBorderColor,#89919a)}.se-select .se-multi-select .selected-container.se-selected-list{border-bottom:none}.se-select .se-multi-select .selected-list{padding:0;margin:0;list-style:none;border-bottom:1px solid var(--sapUiFieldBorderColor,#89919a)}.se-select .se-multi-select .selected-list__item{display:grid;grid-template-columns:16fr 1fr;padding:8px 16px;align-items:center;min-height:36px}.se-select .se-multi-select .selected-list__placeholder{opacity:0}.se-select .se-multi-select .selected-item-remove{cursor:pointer}`]}),__metadata("design:paramtypes",[t.L10nService,r.LogService,n.ChangeDetectorRef])],t.SelectComponent);window.__smartedit__.addDecoratorPayload("Component","ItemPrinterComponent",{selector:"se-item-printer",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-item-printer]":"true"},template:`<ng-container *ngComponentOutlet="component; injector: componentInjector"></ng-container>`});let wn=class ItemPrinterComponent{constructor(e){this.injector=e;this.isSelected=true}ngOnChanges(e){if(e.item){this.itemComponentData=this.createItemComponentData();if(this.component){this.componentInjector=this.createItemComponentInjector()}}}createItemComponentData(){return{item:this.item,selected:this.isSelected,select:this.selectComponentCtx}}createItemComponentInjector(){return n.Injector.create({parent:this.injector,providers:[{provide:bn,useValue:this.itemComponentData}]})}};__decorate([n.Input(),__metadata("design:type",Object)],wn.prototype,"item",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],wn.prototype,"component",void 0);__decorate([n.Input(),__metadata("design:type",t.SelectComponent)],wn.prototype,"selectComponentCtx",void 0);__decorate([n.Input(),__metadata("design:type",Object)],wn.prototype,"isSelected",void 0);wn=__decorate([n.Component({selector:"se-item-printer",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-item-printer]":"true"},template:`<ng-container *ngComponentOutlet="component; injector: componentInjector"></ng-container>`}),__metadata("design:paramtypes",[n.Injector])],wn);window.__smartedit__.addDecoratorPayload("Component","ResultsHeaderComponent",{selector:"se-select-results-header",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-select-results-header]":"true"},template:`<div *ngIf="showResultsHeaderItem() || resultsHeaderLabel || actionableSearchItem" class="results-header"><div *ngIf="showResultsHeaderItem()"><ng-container *ngComponentOutlet="resultsHeaderComponent"></ng-container></div><se-actionable-search-item *ngIf="actionableSearchItem" [search]="search" [eventId]="actionableSearchItem.eventId" [actionText]="actionableSearchItem.actionText" (actionButtonClick)="onActionButtonClick()"></se-actionable-search-item><li class="fd-menu__list-header" *ngIf="displayResultsHeaderLabel">{{ resultsHeaderLabel | translate }}</li></div>`,styles:[`.results-header .fd-menu__list-header{font-size:1rem!important;line-height:1.25;font-weight:400;padding:8px 12px;border-bottom:1px solid var(--sapGroup_ContentBorderColor);color:var(--sapNeutralColor);display:block;padding-left:24px}`]});let Tn=class ResultsHeaderComponent{constructor(){this.actionButtonClick=new n.EventEmitter}onActionButtonClick(){this.actionButtonClick.emit()}showResultsHeaderItem(){return typeof this.resultsHeaderComponent!=="undefined"}};__decorate([n.Input(),__metadata("design:type",String)],Tn.prototype,"search",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],Tn.prototype,"resultsHeaderComponent",void 0);__decorate([n.Input(),__metadata("design:type",String)],Tn.prototype,"resultsHeaderLabel",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],Tn.prototype,"displayResultsHeaderLabel",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Tn.prototype,"actionableSearchItem",void 0);__decorate([n.Output(),__metadata("design:type",Object)],Tn.prototype,"actionButtonClick",void 0);Tn=__decorate([n.Component({selector:"se-select-results-header",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-select-results-header]":"true"},template:`<div *ngIf="showResultsHeaderItem() || resultsHeaderLabel || actionableSearchItem" class="results-header"><div *ngIf="showResultsHeaderItem()"><ng-container *ngComponentOutlet="resultsHeaderComponent"></ng-container></div><se-actionable-search-item *ngIf="actionableSearchItem" [search]="search" [eventId]="actionableSearchItem.eventId" [actionText]="actionableSearchItem.actionText" (actionButtonClick)="onActionButtonClick()"></se-actionable-search-item><li class="fd-menu__list-header" *ngIf="displayResultsHeaderLabel">{{ resultsHeaderLabel | translate }}</li></div>`,styles:[`.results-header .fd-menu__list-header{font-size:1rem!important;line-height:1.25;font-weight:400;padding:8px 12px;border-bottom:1px solid var(--sapGroup_ContentBorderColor);color:var(--sapNeutralColor);display:block;padding-left:24px}`]})],Tn);window.__smartedit__.addDecoratorPayload("Component","SelectListComponent",{selector:"se-select-list",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-select-list]":"true"},template:`<se-infinite-scrolling *ngIf="isPagedDropdown; else selectList" [pageSize]="infiniteScrollingPageSize" [mask]="search" [fetchPage]="fetchPage" [context]="selectComponentCtx" (itemsChange)="onInfiniteScrollItemsChange()"><ng-container *ngTemplateOutlet="selectList"></ng-container></se-infinite-scrolling><ng-template #selectList><div [attr.id]="id +'-list'" suListKeyboardControl [suListKeyboardControlDisabledPredicate]="keyboardControlDisabledPredicate" (suListKeyboardControlEnterKeydown)="onEnterKeydown($event)" class="fd-list fd-list--selection" [ngClass]="{ 'fd-menu__list--basic': !isPagedDropdown }"><ng-container *ngFor="let item of items; trackBy: itemTrackBy"><li *ngIf="(excludeSelected && !isItemSelected(item)) || !excludeSelected" suListItemKeyboardControl class="se-select-list__item fd-list__item" [ngClass]="{'is-selected': !excludeSelected && isItemSelected(item), 'is-disabled': isItemDisabled(item)}"><a fd-list-title (click)="onOptionClick($event, item)" class="menu-option"><se-item-printer [item]="item" [isSelected]="false" [component]="itemComponent" [selectComponentCtx]="selectComponentCtx"></se-item-printer></a></li></ng-container></div></ng-template>`,styles:[`.se-select-list .fd-menu__list{position:relative;outline:0}.se-select-list .fd-menu__list--basic{max-height:200px;overflow-x:hidden;overflow-y:auto}.se-select-list__item{cursor:pointer}.se-select-list__item.fd-list__item{padding-left:0;padding-right:0}.se-select-list__item.is-selected{color:var(--sapSelectedColor)}.se-select-list__item.is-disabled .menu-option{cursor:not-allowed;opacity:.65}.se-select-list__item.is-disabled .menu-option:hover{background:0 0}.se-select-list__item .menu-option.fd-list__title{color:inherit;background:inherit;padding:.5rem 1.5rem}`]});let Pn=class SelectListComponent{constructor(){this.isPagedDropdown=false;this.excludeSelected=false;this.optionClick=new n.EventEmitter;this.infiniteScrollItemsChange=new n.EventEmitter;this.infiniteScrollingPageSize=10}keyboardControlDisabledPredicate(e){return e.getElement().classList.contains("is-disabled")}itemTrackBy(e,t){return t.id}isItemSelected(e){const t=Array.isArray(this.selected);if(!this.selected||t&&this.selected.length===0){return false}return t?!!this.selected.find((t=>t.id===e.id)):e.id===this.selected.id}onOptionClick(e,t){if(this.isItemDisabled(t)){e.stopPropagation();return}this.optionClick.emit(t)}onEnterKeydown(e){const t=this.getItems();const i=t[e];this.optionClick.emit(i)}isItemDisabled(e){return this.disableChoiceFn?this.disableChoiceFn(e):false}onInfiniteScrollItemsChange(){this.infiniteScrollItemsChange.emit()}getItems(){if(this.excludeSelected){return this.items.filter((e=>!this.isItemSelected(e)))}else{return this.items}}};__decorate([n.Input(),__metadata("design:type",String)],Pn.prototype,"id",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Pn.prototype,"isPagedDropdown",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Pn.prototype,"fetchPage",void 0);__decorate([n.Input(),__metadata("design:type",String)],Pn.prototype,"search",void 0);__decorate([n.Input(),__metadata("design:type",Array)],Pn.prototype,"items",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Pn.prototype,"selected",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Pn.prototype,"excludeSelected",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Pn.prototype,"disableChoiceFn",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],Pn.prototype,"itemComponent",void 0);__decorate([n.Input(),__metadata("design:type",t.SelectComponent)],Pn.prototype,"selectComponentCtx",void 0);__decorate([n.Output(),__metadata("design:type",Object)],Pn.prototype,"optionClick",void 0);__decorate([n.Output(),__metadata("design:type",Object)],Pn.prototype,"infiniteScrollItemsChange",void 0);Pn=__decorate([n.Component({selector:"se-select-list",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-select-list]":"true"},template:`<se-infinite-scrolling *ngIf="isPagedDropdown; else selectList" [pageSize]="infiniteScrollingPageSize" [mask]="search" [fetchPage]="fetchPage" [context]="selectComponentCtx" (itemsChange)="onInfiniteScrollItemsChange()"><ng-container *ngTemplateOutlet="selectList"></ng-container></se-infinite-scrolling><ng-template #selectList><div [attr.id]="id +'-list'" suListKeyboardControl [suListKeyboardControlDisabledPredicate]="keyboardControlDisabledPredicate" (suListKeyboardControlEnterKeydown)="onEnterKeydown($event)" class="fd-list fd-list--selection" [ngClass]="{ 'fd-menu__list--basic': !isPagedDropdown }"><ng-container *ngFor="let item of items; trackBy: itemTrackBy"><li *ngIf="(excludeSelected && !isItemSelected(item)) || !excludeSelected" suListItemKeyboardControl class="se-select-list__item fd-list__item" [ngClass]="{'is-selected': !excludeSelected && isItemSelected(item), 'is-disabled': isItemDisabled(item)}"><a fd-list-title (click)="onOptionClick($event, item)" class="menu-option"><se-item-printer [item]="item" [isSelected]="false" [component]="itemComponent" [selectComponentCtx]="selectComponentCtx"></se-item-printer></a></li></ng-container></div></ng-template>`,styles:[`.se-select-list .fd-menu__list{position:relative;outline:0}.se-select-list .fd-menu__list--basic{max-height:200px;overflow-x:hidden;overflow-y:auto}.se-select-list__item{cursor:pointer}.se-select-list__item.fd-list__item{padding-left:0;padding-right:0}.se-select-list__item.is-selected{color:var(--sapSelectedColor)}.se-select-list__item.is-disabled .menu-option{cursor:not-allowed;opacity:.65}.se-select-list__item.is-disabled .menu-option:hover{background:0 0}.se-select-list__item .menu-option.fd-list__title{color:inherit;background:inherit;padding:.5rem 1.5rem}`]})],Pn);t.SelectModule=class SelectModule{};t.SelectModule=__decorate([n.NgModule({imports:[g.CommonModule,E.FormsModule,L.DragDropModule,y.PopoverModule,y.ButtonModule,y.MenuModule,y.SelectModule,y.FormModule,t.InfiniteScrollingModule,t.L10nPipeModule,r.ListKeyboardControlModule,r.TranslationModule.forChild(),S.ListModule],declarations:[t.SelectComponent,In,wn,t.ActionableSearchItemComponent,Pn,En,Tn],entryComponents:[t.SelectComponent,In,wn,t.ActionableSearchItemComponent,Pn,En,Tn],exports:[t.SelectComponent]})],t.SelectModule);let On=class ContentManager{constructor(){this.onSuccess=new n.EventEmitter;this.onError=new n.EventEmitter;this.submitting=false}set option(e){this._onSave=e.onSave}save(){this.submitting=true;return this._onSave().pipe(v.finalize((()=>this.submitting=false)),v.tap((e=>{this.onSuccess.emit(e)})),v.catchError((e=>{this.onError.emit(e);return m.throwError(e)})))}};__decorate([n.Input("contentManager"),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],On.prototype,"option",null);__decorate([n.Output(),__metadata("design:type",Object)],On.prototype,"onSuccess",void 0);__decorate([n.Output(),__metadata("design:type",Object)],On.prototype,"onError",void 0);On=__decorate([n.Directive({selector:"[contentManager]"})],On);const createApi=e=>({setSubmitButtonText:t=>{e.submitButtonText=t},setCancelButtonText:t=>{e.cancelButtonText=t},setAlwaysShowSubmit:t=>{e.alwaysShowSubmit=t},setAlwaysShowReset:t=>{e.alwaysShowReset=t},setOnReset:t=>{e.onReset=t},setPreparePayload:t=>{e.preparePayload=t},setUpdateCallback:t=>{e.updateCallback=t},updateContent:t=>{e.form&&e.form.patchComponent(t)},getContent:()=>e.form?Ji.copy(e.form.component):undefined,onContentChange(){return},addContentChangeEvent:t=>{e.onChangeEvents.push(t);return()=>{const i=e.onChangeEvents.findIndex((e=>e===t));if(i>-1){e.onChangeEvents.splice(i,1)}}},triggerContentChangeEvents:()=>{e.onChangeEvents.forEach((t=>{t(Ji.copy(e.form.component))}))},clearMessages:()=>{e.form.removeValidationMessages()},switchToTabContainingQualifier:t=>{e.targetedQualifier=t},considerFormDirty:()=>{e.initialDirty=true},setInProgress:t=>{e.inProgress=t},isSubmitDisabled:()=>e.isSubmitDisabled(),getLanguages:()=>null,setAlwaysEnableSubmit:t=>{e.alwaysEnableSubmit=t}});const An=new n.InjectionToken("GENERIC_EDITOR_WIDGET_DATA");window.__smartedit__.addDecoratorPayload("Component","BooleanComponent",{selector:"se-boolean",template:`<div class="se-boolean fd-form__item fd-form__item--check"><span class="fd-toggle fd-toggle--xs fd-form__control"><label class="fd-form__label fd-switch fd-switch--compact" for="{{qualifierId}}-checkbox"><input type="checkbox" id="{{qualifierId}}-checkbox" class="se-boolean__input fd-switch__input" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.qualifier" [disabled]="!widget.field.editable" [(ngModel)]="widget.model[widget.qualifier]" (click)="checkboxOnClick($event.target)"/><div class="fd-switch__slider"><div class="fd-switch__track"><span class="fd-switch__handle" role="presentation" style="border-style: solid; border-width: 1px"></span></div></div></label></span><p *ngIf="widget.field.labelText && !widget.model[widget.qualifier]" class="se-boolean__text">{{widget.field.labelText| translate}}</p></div>`});t.BooleanComponent=class BooleanComponent{constructor(e,t){this.systemEventService=e;this.widget=t}ngOnInit(){this.eventId=`${this.widget.id}${this.widget.qualifier}${si}`;this.qualifierId=this.widget.qualifier+ae.generateIdentifier();if(this.widget.model[this.widget.qualifier]===undefined){const e=this.widget.field.defaultValue!==undefined?this.widget.field.defaultValue:false;this.widget.model[this.widget.qualifier]=e;this.widget.editor.pristine[this.widget.qualifier]=e}this.systemEventService.publishAsync(this.eventId,`${this.widget.model[this.widget.qualifier]}`)}checkboxOnClick(e){this.systemEventService.publishAsync(this.eventId,`${e.checked}`)}};t.BooleanComponent=__decorate([n.Component({selector:"se-boolean",template:`<div class="se-boolean fd-form__item fd-form__item--check"><span class="fd-toggle fd-toggle--xs fd-form__control"><label class="fd-form__label fd-switch fd-switch--compact" for="{{qualifierId}}-checkbox"><input type="checkbox" id="{{qualifierId}}-checkbox" class="se-boolean__input fd-switch__input" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.qualifier" [disabled]="!widget.field.editable" [(ngModel)]="widget.model[widget.qualifier]" (click)="checkboxOnClick($event.target)"/><div class="fd-switch__slider"><div class="fd-switch__track"><span class="fd-switch__handle" role="presentation" style="border-style: solid; border-width: 1px"></span></div></div></label></span><p *ngIf="widget.field.labelText && !widget.model[widget.qualifier]" class="se-boolean__text">{{widget.field.labelText| translate}}</p></div>`}),__param(1,n.Inject(An)),__metadata("design:paramtypes",[t.SystemEventService,Object])],t.BooleanComponent);t.BooleanModule=class BooleanModule{};t.BooleanModule=__decorate([n.NgModule({imports:[g.CommonModule,E.FormsModule,h.TranslateModule.forChild()],declarations:[t.BooleanComponent],entryComponents:[t.BooleanComponent],exports:[t.BooleanComponent]})],t.BooleanModule);let xn=class DateTimePickerLocalizationService{constructor(e){this.languageService=e}setLocale(e){this.languageService.getResolveLocale().then((t=>{const i=this.convertToDateTimePickerLocale(t);e.setLocale(i)}))}convertToDateTimePickerLocale(e){return e.replace("_","-")}};xn=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.LanguageService])],xn);const Dn={in:"id",zh:"zh-cn"};window.__smartedit__.addDecoratorPayload("Component","DateTimePickerComponent",{selector:"se-date-time-picker",template:`<fd-datetime-picker [state]="isInvalid() ? 'error' : 'success'" name="se-datetime-picker" [placeholder]="placeholderText | translate" [disabled]="isDisabled" [(ngModel)]="date" (ngModelChange)="handleDatePickerChange()" [allowNull]="true"></fd-datetime-picker>`,providers:[{provide:B.DatetimeAdapter,useClass:B.FdDatetimeAdapter},{provide:B.DATE_TIME_FORMATS,useValue:B.FD_DATETIME_FORMATS}]});let Rn=class DateTimePickerComponent{constructor(e,t,i){this.widget=e;this.localizationService=t;this.datetimeAdapter=i;this.placeholderText="se.componentform.select.date";this.date=B.FdDate.getToday();if(!!this.widget.model[this.widget.qualifier]){this.date=B.FdDate.getFdDateByDate(new Date(this.widget.model[this.widget.qualifier]))}else{this.handleDatePickerChange()}}ngOnInit(){this.localizationService.setLocale(this.datetimeAdapter)}handleDatePickerChange(){this.widget.model[this.widget.qualifier]=this.date?to.formatDateAsUtc(this.date.toString()):undefined}get isDisabled(){return this.widget.isFieldDisabled()}isInvalid(){return!this.date?false:!this.date.isDateValid()}};Rn=__decorate([n.Component({selector:"se-date-time-picker",template:`<fd-datetime-picker [state]="isInvalid() ? 'error' : 'success'" name="se-datetime-picker" [placeholder]="placeholderText | translate" [disabled]="isDisabled" [(ngModel)]="date" (ngModelChange)="handleDatePickerChange()" [allowNull]="true"></fd-datetime-picker>`,providers:[{provide:B.DatetimeAdapter,useClass:B.FdDatetimeAdapter},{provide:B.DATE_TIME_FORMATS,useValue:B.FD_DATETIME_FORMATS}]}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object,xn,B.DatetimeAdapter])],Rn);const Mn=new n.InjectionToken("resolvedLocaleToMomentLocaleMap");new n.InjectionToken("tooltipsMap");let kn=class DateTimePickerModule{};kn=__decorate([n.NgModule({imports:[g.CommonModule,E.FormsModule,j.DatetimePickerModule,G.MomentDatetimeModule,h.TranslateModule.forChild()],providers:[{provide:Mn,useValue:Dn},{provide:B.DatetimeAdapter,useClass:B.FdDatetimeAdapter},{provide:B.DATE_TIME_FORMATS,useValue:B.FD_DATETIME_FORMATS},t.LanguageService,xn],declarations:[Rn],entryComponents:[Rn],exports:[Rn]})],kn);window.__smartedit__.addDecoratorPayload("Component","DropdownItemPrinterComponent",{selector:"se-dropdown-item-printer",template:` <span>{{ data.item.label }}</span> `});let Nn=class DropdownItemPrinterComponent{constructor(e){this.data=e}};Nn=__decorate([n.Component({selector:"se-dropdown-item-printer",template:` <span>{{ data.item.label }}</span> `}),__param(0,n.Inject(bn)),__metadata("design:paramtypes",[Object])],Nn);window.__smartedit__.addDecoratorPayload("Component","DropdownComponent",{selector:"se-dropdown-wrapper",template:`\n        <se-select\n            [id]="data.field.qualifier"\n            class="se-generic-editor-dropdown"\n            [(model)]="data.model[data.qualifier]"\n            [searchEnabled]="false"\n            [fetchStrategy]="fetchStrategy"\n            [itemComponent]="itemComponent"\n            [placeholder]="'se.genericeditor.sedropdown.placeholder'"></se-select>\n    `});let Fn=class DropdownComponent{constructor(e){this.data=e;this.itemComponent=Nn;const{field:{options:t}}=e;this.fetchStrategy={fetchAll:()=>Promise.resolve(t)}}};Fn=__decorate([n.Component({selector:"se-dropdown-wrapper",template:`\n        <se-select\n            [id]="data.field.qualifier"\n            class="se-generic-editor-dropdown"\n            [(model)]="data.model[data.qualifier]"\n            [searchEnabled]="false"\n            [fetchStrategy]="fetchStrategy"\n            [itemComponent]="itemComponent"\n            [placeholder]="'se.genericeditor.sedropdown.placeholder'"></se-select>\n    `}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object])],Fn);window.__smartedit__.addDecoratorPayload("Component","EditableDropdownComponent",{selector:"se-editable-dropdown",template:`<se-generic-editor-dropdown [id]="data.id" [field]="data.field" [qualifier]="data.qualifier" [model]="data.model"></se-generic-editor-dropdown>`});let zn=class EditableDropdownComponent{constructor(e){this.data=e}};zn=__decorate([n.Component({selector:"se-editable-dropdown",template:`<se-generic-editor-dropdown [id]="data.id" [field]="data.field" [qualifier]="data.qualifier" [model]="data.model"></se-generic-editor-dropdown>`}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object])],zn);const Ln=new n.InjectionToken(ni);const Vn=new n.InjectionToken("DROPDOWN_IMPLEMENTATION_SUFFIX_TOKEN");const Un=new n.InjectionToken(si);class IGenericEditorDropdownServiceConstructor{constructor(e){}}function genericEditorDropdownComponentOnInit(){this.field.params=this.field.params||{};this.field.params.catalogId=this.field.params.catalogId||fe;this.field.params.catalogVersion=this.field.params.catalogVersion||ye;const e=this.GenericEditorDropdownService||this.SEDropdownService;this.dropdown=new e({field:this.field,qualifier:this.qualifier,model:this.model,id:this.id,onClickOtherDropdown:this.onClickOtherDropdown.bind(this),getApi:this.getApi});this.dropdown.init()}window.__smartedit__.addDecoratorPayload("Component","GenericEditorDropdownComponent",{selector:"se-generic-editor-dropdown",host:{"[class.se-generic-editor-dropdown]":"true"},template:`<se-select *ngIf="dropdown.initialized" [id]="dropdown.qualifier" (click)="dropdown.onClick()" [placeholder]="field.placeholder" [(model)]="model[qualifier]" [onChange]="dropdown.triggerAction" [fetchStrategy]="dropdown.fetchStrategy" [(reset)]="dropdown.reset" [multiSelect]="dropdown.isMultiDropdown" [controls]="dropdown.isMultiDropdown" [showRemoveButton]="showRemoveButton" [isReadOnly]="!field.editable" [itemComponent]="itemComponent" [resultsHeaderComponent]="resultsHeaderComponent" [actionableSearchItem]="actionableSearchItem" (resetChange)="onResetChange($event)"></se-select>`});t.GenericEditorDropdownComponent=class GenericEditorDropdownComponent{constructor(e){this.GenericEditorDropdownService=e;this.resetChange=new n.EventEmitter}ngOnChanges(){genericEditorDropdownComponentOnInit.call(this)}ngOnInit(){genericEditorDropdownComponentOnInit.call(this)}onClickOtherDropdown(){this.selectComponent.closeAndReset()}onResetChange(e){this.resetChange.emit(e)}};__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorDropdownComponent.prototype,"id",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.GenericEditorDropdownComponent.prototype,"field",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorDropdownComponent.prototype,"qualifier",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.GenericEditorDropdownComponent.prototype,"model",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],t.GenericEditorDropdownComponent.prototype,"showRemoveButton",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],t.GenericEditorDropdownComponent.prototype,"itemComponent",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],t.GenericEditorDropdownComponent.prototype,"resultsHeaderComponent",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.GenericEditorDropdownComponent.prototype,"actionableSearchItem",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.GenericEditorDropdownComponent.prototype,"reset",void 0);__decorate([n.Output(),__metadata("design:type",Object)],t.GenericEditorDropdownComponent.prototype,"resetChange",void 0);__decorate([n.ViewChild(t.SelectComponent,{static:false}),__metadata("design:type",t.SelectComponent)],t.GenericEditorDropdownComponent.prototype,"selectComponent",void 0);t.GenericEditorDropdownComponent=__decorate([n.Component({selector:"se-generic-editor-dropdown",host:{"[class.se-generic-editor-dropdown]":"true"},template:`<se-select *ngIf="dropdown.initialized" [id]="dropdown.qualifier" (click)="dropdown.onClick()" [placeholder]="field.placeholder" [(model)]="model[qualifier]" [onChange]="dropdown.triggerAction" [fetchStrategy]="dropdown.fetchStrategy" [(reset)]="dropdown.reset" [multiSelect]="dropdown.isMultiDropdown" [controls]="dropdown.isMultiDropdown" [showRemoveButton]="showRemoveButton" [isReadOnly]="!field.editable" [itemComponent]="itemComponent" [resultsHeaderComponent]="resultsHeaderComponent" [actionableSearchItem]="actionableSearchItem" (resetChange)="onResetChange($event)"></se-select>`}),__metadata("design:paramtypes",[IGenericEditorDropdownServiceConstructor])],t.GenericEditorDropdownComponent);const GenericEditorDropdownServiceFactory=(e,t,i,o,n,a,r,l,d)=>class{constructor(e){this.field=e.field;this.qualifier=e.qualifier;this.model=e.model;this.id=e.id;this.onClickOtherDropdown=e.onClickOtherDropdown;this.items=[]}init(){this.populatorName={options:r.constructor.name,uri:l.constructor.name,propertyType:this.field.propertyType+n,cmsStructureType:this.field.cmsStructureType+n,smarteditComponentType:{withQualifier:this.field.smarteditComponentType+this.field.qualifier+n,withQualifierForDowngradedService:s.camelCase(this.field.smarteditComponentType+this.field.qualifier+n),withoutQualifier:this.field.smarteditComponentType+n}};this.isMultiDropdown=this.field.collection?this.field.collection:false;this.triggerAction=this.triggerAction.bind(this);this.eventId=(this.id||"")+i;this.clickEventKey=(this.id||"")+o;if(this.field.dependsOn){a.subscribe(this.eventId,this._respondToChange.bind(this))}a.subscribe(this.clickEventKey,this._respondToOtherClicks.bind(this));const p=e.resolvePopulator(this.field,this.populatorName,r,l,d);if(!p){t.error("No dropdown populator found")}({instance:this.populator,isPaged:this.isPaged}=p);this.fetchStrategy={fetchEntity:this.fetchEntity.bind(this)};if(this.isPaged){this.fetchStrategy.fetchPage=this.fetchPage.bind(this)}else{this.fetchStrategy.fetchAll=this.fetchAll.bind(this)}this.initialized=true}triggerAction(){const e=this.items.filter((e=>e.id===this.model[this.qualifier]))[0];const t={qualifier:this.qualifier,optionObject:e};a.publishAsync(this.eventId,t)}onClick(){a.publishAsync(this.clickEventKey,this.field.qualifier)}fetchAll(e){return this.populator.fetchAll({field:this.field,model:this.model,selection:this.selection,search:e}).then((e=>{this.items=e;return this.items}))}fetchEntity(e){return this.populator.getItem({field:this.field,id:e,model:this.model})}fetchPage(e,i,o,n){return this.populator.fetchPage({field:this.field,model:this.model,selection:this.selection,search:e,pageSize:i,currentPage:o}).then((e=>{const t=eo.getKeyHoldingDataFromResponse(e);e.results=e[t];delete e[t];this.items=[...this.items,...e.results];if(this.isMultiDropdown&&n){return this.limitToNonSelectedItems(e,n)}else{return e}})).catch((e=>{t.error(`Failed to fetch items and paging information. ${e}`)}))}isInclude(e,t){let i=false;t.forEach((t=>{if(t.uid===e.uid){i=true}}));return i}limitToNonSelectedItems(e,t){const i=e.results.length;for(let o=i-1;o>=0;o--){const i=e.results[o];if(this.isInclude(i,t)){e.results.splice(o,1);e.pagination.count--}}return e}_respondToChange(e,t){if(this.field.dependsOn&&this.field.dependsOn.split(",").indexOf(t.qualifier)>-1){this.selection=t.optionObject;if(this.reset){this.reset()}}}_respondToOtherClicks(e,t){if(this.field.qualifier!==t&&typeof this.onClickOtherDropdown==="function"){this.onClickOtherDropdown(e,t)}}};class GenericEditorUtil{isFieldPaged(e=undefined){return e?e:false}resolvePopulatorByName(e,t,i,o){if(e===t.constructor.name){return t}if(e===i.constructor.name){return i}if(o&&o.length>0){return o.find((t=>t.constructor.name.toUpperCase()===e.toUpperCase()))}return undefined}isPopulatorPaged(e){return e.isPaged&&e.isPaged()}resolvePopulator(e,t,i,o,n){if(e.options&&e.uri){throw new Error("se.dropdown.contains.both.uri.and.options")}if(e.options){return{instance:this.resolvePopulatorByName(t.options,i,o,n),isPaged:false}}if(e.uri){return{instance:this.resolvePopulatorByName(t.uri,i,o,n),isPaged:this.isFieldPaged(e.paged)}}if(e.propertyType){const e=this.resolvePopulatorByName(t.propertyType,i,o,n);return{instance:e,isPaged:this.isPopulatorPaged(e)}}const s=this.resolvePopulatorByName(t.cmsStructureType,i,o,n);if(s){return{instance:s,isPaged:this.isFieldPaged(e.paged)}}const a=this.resolvePopulatorByName(t.smarteditComponentType.withQualifier,i,o,n);if(a){return{instance:a,isPaged:this.isPopulatorPaged(a)}}const r=this.resolvePopulatorByName(t.smarteditComponentType.withQualifierForDowngradedService,i,o,n);if(r){return{instance:r,isPaged:this.isPopulatorPaged(r)}}const l=this.resolvePopulatorByName(t.smarteditComponentType.withoutQualifier,i,o,n);if(l){return{instance:l,isPaged:this.isPopulatorPaged(l)}}return undefined}}class DropdownPopulatorInterface{constructor(e,t,i){this.lodash=e;this.languageService=t;this.translateService=i}getItem(e){return null}fetchAll(e){"proxyFunction";return null}fetchPage(e){"proxyFunction";return null}isPaged(){return false}populateAttributes(e,t,i){return this.lodash.map(e,(e=>{if(t&&this.lodash.isEmpty(e.id)){e.id=e[t]}if(i&&this.lodash.isEmpty(e.label)){const t=this.lodash.find(i,(t=>!this.lodash.isEmpty(e[t])));if(t){e.label=e[t]}}return e}))}search(e,t){return this.languageService.getResolveLocale().then((i=>this.lodash.filter(e,(e=>{let o;if(this.lodash.isObject(e.label)){i=e.label[i]?i:Object.keys(e.label)[0];o=e.label[i]}else{o=this.translateService?this.translateService.instant(e.label):e.label}return o&&o.toUpperCase().indexOf(t.toUpperCase())>-1}))))}}t.OptionsDropdownPopulator=class OptionsDropdownPopulator extends DropdownPopulatorInterface{constructor(e,t){super(K,e,t);this.languageService=e;this.translateService=t}fetchAll(e){const t=this.populateAttributes(e.field.options,e.field.idAttribute,e.field.labelAttributes);if(e.search){return this.search(t,e.search)}return Promise.resolve(t)}};t.OptionsDropdownPopulator=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.LanguageService,h.TranslateService])],t.OptionsDropdownPopulator);t.UriDropdownPopulator=class UriDropdownPopulator extends DropdownPopulatorInterface{constructor(e,t,i){super(K,t,i);this.restServiceFactory=e;this.languageService=t;this.translateService=i}fetchAll(e){let t;if(e.field.dependsOn){t=this._buildQueryParams(e.field.dependsOn,e.model)}return this.restServiceFactory.get(e.field.uri).get(t).then((t=>{const i=eo.getDataFromResponse(t);const o=this.populateAttributes(i,e.field.idAttribute,e.field.labelAttributes);if(e.search){return this.search(o,e.search)}return Promise.resolve(o)}))}fetchPage(e){let t={};if(e.field.dependsOn){t=this._buildQueryParams(e.field.dependsOn,e.model)}t.pageSize=e.pageSize;t.currentPage=e.currentPage;t.mask=e.search;if(e.field.params){this.lodash.extend(t,e.field.params)}return this.restServiceFactory.get(e.field.uri).get(t).then((t=>{const i=eo.getKeyHoldingDataFromResponse(t);t[i]=this.populateAttributes(t[i],e.field.idAttribute,e.field.labelAttributes);return Promise.resolve(t)}))}getItem(e){return this.restServiceFactory.get(e.field.uri).getById(e.id).then((t=>{t=this.populateAttributes([t],e.field.idAttribute,e.field.labelAttributes)[0];return Promise.resolve(t)}))}_buildQueryParams(e,t){const i=e.split(",").reduce(((e,i)=>{e[i]=t[i];return e}),{});return i}};t.UriDropdownPopulator=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory,t.LanguageService,h.TranslateService])],t.UriDropdownPopulator);t.DropdownPopulatorModule=class DropdownPopulatorModule{};t.DropdownPopulatorModule=__decorate([n.NgModule({providers:[t.OptionsDropdownPopulator,t.UriDropdownPopulator]})],t.DropdownPopulatorModule);const Bn=new n.InjectionToken("CustomDropdownPopulatorsToken");t.GenericEditorDropdownModule=class GenericEditorDropdownModule{};t.GenericEditorDropdownModule=__decorate([n.NgModule({imports:[g.CommonModule,t.SelectModule,t.DropdownPopulatorModule],declarations:[t.GenericEditorDropdownComponent],entryComponents:[t.GenericEditorDropdownComponent],exports:[t.GenericEditorDropdownComponent],providers:[{provide:Vn,useValue:ai},{provide:Ln,useValue:ni},{provide:Un,useValue:si},GenericEditorUtil,{provide:IGenericEditorDropdownServiceConstructor,useFactory:GenericEditorDropdownServiceFactory,deps:[GenericEditorUtil,r.LogService,Ln,Un,Vn,t.SystemEventService,t.OptionsDropdownPopulator,t.UriDropdownPopulator,[new n.Optional,Bn]]}]})],t.GenericEditorDropdownModule);let jn=class EditableDropdownModule{};jn=__decorate([n.NgModule({imports:[g.CommonModule,t.GenericEditorDropdownModule],declarations:[zn],entryComponents:[zn],exports:[zn]})],jn);window.__smartedit__.addDecoratorPayload("Component","EmailComponent",{selector:"se-email",template:`<input fd-form-control [ngClass]="{ 'is-invalid': widget.field.hasErrors, 'is-warning': widget.field.hasWarnings }" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.field.qualifier" [disabled]="widget.isFieldDisabled()" [(ngModel)]="widget.model[widget.qualifier]" [max]="255" type="email" id="{{widget.field.qualifier}}-shortstring"/>`});let Gn=class EmailComponent{constructor(e){this.widget=e}};Gn=__decorate([n.Component({selector:"se-email",template:`<input fd-form-control [ngClass]="{ 'is-invalid': widget.field.hasErrors, 'is-warning': widget.field.hasWarnings }" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.field.qualifier" [disabled]="widget.isFieldDisabled()" [(ngModel)]="widget.model[widget.qualifier]" [max]="255" type="email" id="{{widget.field.qualifier}}-shortstring"/>`}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object])],Gn);let Hn=class EmailModule{};Hn=__decorate([n.NgModule({imports:[g.CommonModule,h.TranslateModule.forChild(),E.FormsModule,H.FormModule],declarations:[Gn],entryComponents:[Gn],exports:[Gn]})],Hn);window.__smartedit__.addDecoratorPayload("Component","EnumItemPrinterComponent",{selector:"se-enum-item-printer",template:` <span id="enum-{{ data.select.id }}">{{ data.item.label }}</span> `});let Wn=class EnumItemPrinterComponent{constructor(e){this.data=e}};Wn=__decorate([n.Component({selector:"se-enum-item-printer",template:` <span id="enum-{{ data.select.id }}">{{ data.item.label }}</span> `}),__param(0,n.Inject(bn)),__metadata("design:paramtypes",[Object])],Wn);window.__smartedit__.addDecoratorPayload("Component","EnumComponent",{selector:"se-enum",template:`\n        <se-select\n            [id]="data.field.qualifier"\n            class="se-generic-editor-dropdown"\n            [(model)]="data.model[data.qualifier]"\n            [isReadOnly]="data.isFieldDisabled()"\n            [resetSearchInput]="false"\n            [fetchStrategy]="fetchStrategy"\n            [itemComponent]="itemComponent"\n            [placeholder]="'se.genericeditor.sedropdown.placeholder'"\n            [showRemoveButton]="true"></se-select>\n    `});let $n=class EnumComponent{constructor(e){this.data=e;this.itemComponent=Wn;const{editor:t,field:i,qualifier:o}=e;this.fetchStrategy={fetchAll:e=>__awaiter(this,void 0,void 0,(function*(){yield t.refreshOptions(i,o,e);const n=i.options[o];const s=n.map((e=>Object.assign(Object.assign({},e),{id:e.code})));return s}))}}};$n=__decorate([n.Component({selector:"se-enum",template:`\n        <se-select\n            [id]="data.field.qualifier"\n            class="se-generic-editor-dropdown"\n            [(model)]="data.model[data.qualifier]"\n            [isReadOnly]="data.isFieldDisabled()"\n            [resetSearchInput]="false"\n            [fetchStrategy]="fetchStrategy"\n            [itemComponent]="itemComponent"\n            [placeholder]="'se.genericeditor.sedropdown.placeholder'"\n            [showRemoveButton]="true"></se-select>\n    `}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object])],$n);const Kn="0.01";window.__smartedit__.addDecoratorPayload("Component","FloatComponent",{selector:"se-float",template:`<input pattern="^[-]?([0-9]*)(.[0-9]{1,5})?$" type="number" id="{{widget.field.qualifier}}-float" class="fd-form-control" [ngClass]="{ 'is-invalid': widget.field.hasErrors, 'is-warning': widget.field.hasWarnings }" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.field.qualifier" [disabled]="widget.isFieldDisabled()" [(ngModel)]="widget.model[widget.qualifier]" [step]="precision"/>`});let qn=class FloatComponent{constructor(e){this.widget=e;this.precision=Kn}};qn=__decorate([n.Component({selector:"se-float",template:`<input pattern="^[-]?([0-9]*)(.[0-9]{1,5})?$" type="number" id="{{widget.field.qualifier}}-float" class="fd-form-control" [ngClass]="{ 'is-invalid': widget.field.hasErrors, 'is-warning': widget.field.hasWarnings }" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.field.qualifier" [disabled]="widget.isFieldDisabled()" [(ngModel)]="widget.model[widget.qualifier]" [step]="precision"/>`}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object])],qn);let Yn=class FloatModule{};Yn=__decorate([n.NgModule({imports:[g.CommonModule,h.TranslateModule.forChild(),E.FormsModule],declarations:[qn],entryComponents:[qn],exports:[qn]})],Yn);window.__smartedit__.addDecoratorPayload("Component","LongStringComponent",{template:`\n        <textarea\n            class="fd-form__control"\n            style="width: 100%;"\n            [ngClass]="{ 'is-invalid': data.field.hasErrors, 'is-warning': data.field.hasWarnings }"\n            [placeholder]="data.field.tooltip || '' | translate"\n            [attr.name]="data.field.qualifier"\n            [disabled]="data.isFieldDisabled()"\n            [(ngModel)]="data.model[data.qualifier]"></textarea>\n    `,selector:"se-long-string"});let Zn=class LongStringComponent{constructor(e){this.data=e}};Zn=__decorate([n.Component({template:`\n        <textarea\n            class="fd-form__control"\n            style="width: 100%;"\n            [ngClass]="{ 'is-invalid': data.field.hasErrors, 'is-warning': data.field.hasWarnings }"\n            [placeholder]="data.field.tooltip || '' | translate"\n            [attr.name]="data.field.qualifier"\n            [disabled]="data.isFieldDisabled()"\n            [(ngModel)]="data.model[data.qualifier]"></textarea>\n    `,selector:"se-long-string"}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object])],Zn);window.__smartedit__.addDecoratorPayload("Component","NumberComponent",{selector:"se-number",template:`<input [min]="1" [ngClass]="{ 'is-invalid': widget.field.hasErrors, 'is-warning': widget.field.hasWarnings }" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.qualifier" [disabled]="widget.isFieldDisabled()" [(ngModel)]="widget.model[widget.qualifier]" id="{{widget.qualifier}}-number" class="fd-form-control fd-input" type="number"/>`});t.NumberComponent=class NumberComponent{constructor(e,t){this.systemEventService=e;this.widget=t;const i=`${this.widget.id}${this.widget.field.dependsOnField}${si}`;this.unRegClickValueChanged=this.systemEventService.subscribe(i,((e,t)=>this.onClickEvent(t)))}onClickEvent(e){this.widget.field.hideFieldWidget=e!==this.widget.field.dependsOnValue;if(this.widget.field.hideFieldWidget){this.widget.model[this.widget.qualifier]=null}}};t.NumberComponent=__decorate([n.Component({selector:"se-number",template:`<input [min]="1" [ngClass]="{ 'is-invalid': widget.field.hasErrors, 'is-warning': widget.field.hasWarnings }" [placeholder]="(widget.field.tooltip || '') | translate" [attr.name]="widget.qualifier" [disabled]="widget.isFieldDisabled()" [(ngModel)]="widget.model[widget.qualifier]" id="{{widget.qualifier}}-number" class="fd-form-control fd-input" type="number"/>`}),__param(1,n.Inject(An)),__metadata("design:paramtypes",[t.SystemEventService,Object])],t.NumberComponent);t.NumberModule=class NumberModule{};t.NumberModule=__decorate([n.NgModule({imports:[g.CommonModule,h.TranslateModule.forChild(),E.FormsModule],declarations:[t.NumberComponent],entryComponents:[t.NumberComponent],exports:[t.NumberComponent]})],t.NumberModule);const Xn=new n.InjectionToken("resolvedLocaleToCKEDITORLocaleMap");const Qn=new n.InjectionToken("richTextConfiguration");t.GenericEditorSanitizationService=class GenericEditorSanitizationService{constructor(e){this.domSanitizer=e}isSanitized(e){const t=document.createElement("div");const i=document.createElement("div");const o=this.domSanitizer.sanitize(n.SecurityContext.HTML,e).replace(/&#10;/g,"\n").replace(/&#160;/g,"").replace(/<br>/g,"<br />");t.innerHTML=o;const s=e.replace(/&#10;/g,"\n").replace(/&#160;/g,"").replace(/<br>/g,"<br />");i.innerHTML=s;return t.innerHTML===i.innerHTML}};t.GenericEditorSanitizationService=__decorate([n.Injectable(),__metadata("design:paramtypes",[f.DomSanitizer])],t.GenericEditorSanitizationService);t.RichTextFieldLocalizationService=class RichTextFieldLocalizationService{constructor(e,t){this.languageService=e;this.resolvedLocaleToCKEDITORLocaleMap=t}localizeCKEditor(){return this.languageService.getResolveLocale().then((e=>{CKEDITOR.config.language=this.convertResolvedToCKEditorLocale(e)}))}convertResolvedToCKEditorLocale(e){const t=this.resolvedLocaleToCKEDITORLocaleMap[e];if(t){return t}return e}};t.RichTextFieldLocalizationService=__decorate([__param(1,n.Inject(Xn)),__metadata("design:paramtypes",[t.LanguageService,Object])],t.RichTextFieldLocalizationService);class RichTextLoaderService{constructor(){this.loadPromise=new Promise((e=>{this.checkLoadedInterval=setInterval((()=>{if(CKEDITOR.status==="loaded"){e();clearInterval(this.checkLoadedInterval);this.checkLoadedInterval=null}}),100)}))}load(){return this.loadPromise}}window.__smartedit__.addDecoratorPayload("Component","RichTextFieldComponent",{selector:"se-rich-text-field",template:`<textarea #textarea class="fd-form__control" [ngClass]="{'has-error': widget.field.hasErrors}" name="{{widget.field.qualifier}}-{{widget.qualifier}}" [disabled]="widget.isFieldDisabled()" [(ngModel)]="widget.model[widget.qualifier]" (change)="reassignUserCheck()"></textarea><div *ngIf="requiresUserCheck()"><div id="richTextWarningMessage" [hidden]="widget.field.isUserChecked"><span fd-object-status [status]="'critical'" [glyph]="'message-warning'" class="se-generic-editor__warning" label="{{'se.editor.richtext.message.warning' | translate}}"></span></div><input id="richTextWarningCheckBox" type="checkbox" [(ngModel)]="widget.field.isUserChecked" (click)="checkboxOnClick($event.target)"/> <span [ngClass]="{'warning-check-msg': true, 'not-checked': widget.editor.hasFrontEndValidationErrors && !widget.field.isUserChecked}">{{'se.editor.richtext.check' | translate}}</span></div>`});t.RichTextFieldComponent=class RichTextFieldComponent{constructor(e,t,i,o,n,s){this.widget=e;this.seRichTextLoaderService=t;this.seRichTextConfiguration=i;this.genericEditorSanitizationService=o;this.seRichTextFieldLocalizationService=n;this.settingsService=s}ngAfterViewInit(){return this.settingsService.get("cms.components.allowUnsafeJavaScript").then((e=>this.seRichTextLoaderService.load().then((()=>{this.seRichTextConfiguration.allowedContent=e==="true";this.editorInstance=CKEDITOR.replace(this.textarea.nativeElement,this.seRichTextConfiguration);this.seRichTextFieldLocalizationService.localizeCKEditor();if(this.editorInstance){this.editorInstance.on("change",(()=>this.onChange()));this.editorInstance.on("mode",(()=>this.onMode()));CKEDITOR.on("instanceReady",(e=>this.onInstanceReady(e)))}}))))}ngOnDestroy(){if(this.editorInstance&&CKEDITOR.instances[this.editorInstance.name]){CKEDITOR.instances[this.editorInstance.name].destroy()}}onChange(){setTimeout((()=>{this.widget.model[this.widget.qualifier]=this.editorInstance.getData();this.reassignUserCheck();this.toggleSubmitButton(this.requiresUserCheck()&&!this.widget.field.isUserChecked)}))}onMode(){if(this.editorInstance.mode==="source"){const e=this.editorInstance.editable();e.attachListener(e,"input",(()=>{this.editorInstance.fire("change")}))}}onInstanceReady(e){const t=CKEDITOR.dtd;const i=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t.$nonBodyContent),t.$block),t.$listItem),t.$tableContent),{br:1});for(const t of Object.keys(i)){e.editor.dataProcessor.writer.setRules(t,{indent:false,breakBeforeOpen:false,breakAfterOpen:false,breakBeforeClose:false,breakAfterClose:false})}e.editor.dataProcessor.writer.lineBreakChars="";e.editor.dataProcessor.writer.indentationChars=""}requiresUserCheck(){let e=false;for(const t in this.widget.field.requiresUserCheck){if(this.widget.field.requiresUserCheck.hasOwnProperty(t)){e=e||this.widget.field.requiresUserCheck[t]}}return e}reassignUserCheck(){if(this.widget.model&&this.widget.qualifier&&this.widget.model[this.widget.qualifier]){const e=this.genericEditorSanitizationService.isSanitized(this.widget.model[this.widget.qualifier]);this.widget.field.requiresUserCheck=this.widget.field.requiresUserCheck||{};this.widget.field.requiresUserCheck[this.widget.qualifier]=!e}else{this.widget.field.requiresUserCheck=this.widget.field.requiresUserCheck||{};this.widget.field.requiresUserCheck[this.widget.qualifier]=false}}checkboxOnClick(e){this.toggleSubmitButton(!e.checked)}toggleSubmitButton(e){this.widget.editor.api.setInProgress(e)}};__decorate([n.ViewChild("textarea",{static:false}),__metadata("design:type",n.ElementRef)],t.RichTextFieldComponent.prototype,"textarea",void 0);t.RichTextFieldComponent=__decorate([n.Component({selector:"se-rich-text-field",template:`<textarea #textarea class="fd-form__control" [ngClass]="{'has-error': widget.field.hasErrors}" name="{{widget.field.qualifier}}-{{widget.qualifier}}" [disabled]="widget.isFieldDisabled()" [(ngModel)]="widget.model[widget.qualifier]" (change)="reassignUserCheck()"></textarea><div *ngIf="requiresUserCheck()"><div id="richTextWarningMessage" [hidden]="widget.field.isUserChecked"><span fd-object-status [status]="'critical'" [glyph]="'message-warning'" class="se-generic-editor__warning" label="{{'se.editor.richtext.message.warning' | translate}}"></span></div><input id="richTextWarningCheckBox" type="checkbox" [(ngModel)]="widget.field.isUserChecked" (click)="checkboxOnClick($event.target)"/> <span [ngClass]="{'warning-check-msg': true, 'not-checked': widget.editor.hasFrontEndValidationErrors && !widget.field.isUserChecked}">{{'se.editor.richtext.check' | translate}}</span></div>`}),__param(0,n.Inject(An)),__param(2,n.Inject(Qn)),__metadata("design:paramtypes",[Object,RichTextLoaderService,Object,t.GenericEditorSanitizationService,t.RichTextFieldLocalizationService,t.SettingsService])],t.RichTextFieldComponent);t.RichTextFieldModule=class RichTextFieldModule{};t.RichTextFieldModule=__decorate([n.NgModule({imports:[g.CommonModule,E.FormsModule,h.TranslateModule.forChild(),W.ObjectStatusModule],providers:[t.GenericEditorSanitizationService,t.RichTextFieldLocalizationService,RichTextLoaderService,t.SettingsService,{provide:Xn,useValue:{in:"id",es_CO:"es"}},{provide:Qn,useValue:{toolbar:"full",toolbar_full:[{name:"basicstyles",items:["Bold","Italic","Strike","Underline"]},{name:"paragraph",items:["BulletedList","NumberedList","Blockquote"]},{name:"editing",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"links",items:["Link","Unlink","Anchor"]},{name:"tools",items:["SpellChecker","Maximize"]},"/",{name:"styles",items:["Format","Font","FontSize","TextColor","PasteText","PasteFromWord","RemoveFormat"]},{name:"insert",items:["Image","Table","SpecialChar"]},{name:"forms",items:["Outdent","Indent"]},"/",{name:"clipboard",items:["Undo","Redo"]},{name:"document",items:["PageBreak","Source"]}],disableNativeSpellChecker:false,height:"100px",width:"100%",autoParagraph:false,basicEntities:false,fillEmptyBlocks:false,extraAllowedContent:"div(*)[role]",extraPlugins:"colorbutton, colordialog, font",font_names:"Arial/Arial, Helvetica, sans-serif;Times New Roman/Times New Roman, Times, serif;Verdana",fontSize_sizes:"10/10px;12/12px;14/14px;16/16px;18/18px;20/20px;22/22px;24/24px;36/36px;48/48px;",protectedSource:[/\r|\n|\r\n|\t/g]}}],declarations:[t.RichTextFieldComponent],entryComponents:[t.RichTextFieldComponent],exports:[t.RichTextFieldComponent]})],t.RichTextFieldModule);window.__smartedit__.addDecoratorPayload("Component","ShortStringComponent",{template:`\n        <input\n            type="text"\n            fd-form-control\n            [state]="data.field.hasErrors ? 'error' : ''"\n            id="{{ data.field.qualifier }}-shortstring"\n            [attr.name]="data.field.qualifier"\n            [disabled]="data.isFieldDisabled()"\n            [(ngModel)]="data.model[data.qualifier]"\n            [ngClass]="{\n                'is-warning': data.field.hasWarnings\n            }" />\n    `,selector:"se-short-string"});t.ShortStringComponent=class ShortStringComponent{constructor(e){this.data=e}};t.ShortStringComponent=__decorate([n.Component({template:`\n        <input\n            type="text"\n            fd-form-control\n            [state]="data.field.hasErrors ? 'error' : ''"\n            id="{{ data.field.qualifier }}-shortstring"\n            [attr.name]="data.field.qualifier"\n            [disabled]="data.isFieldDisabled()"\n            [(ngModel)]="data.model[data.qualifier]"\n            [ngClass]="{\n                'is-warning': data.field.hasWarnings\n            }" />\n    `,selector:"se-short-string"}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object])],t.ShortStringComponent);window.__smartedit__.addDecoratorPayload("Component","TextComponent",{template:` <p [id]="data.field.qualifier + '-text'">{{ data.model[data.qualifier] }}</p> `,selector:"se-component-text"});let Jn=class TextComponent{constructor(e){this.data=e}};Jn=__decorate([n.Component({template:` <p [id]="data.field.qualifier + '-text'">{{ data.model[data.qualifier] }}</p> `,selector:"se-component-text"}),__param(0,n.Inject(An)),__metadata("design:paramtypes",[Object])],Jn);var es;const ts="0.01";t.EditorFieldMappingService=es=class EditorFieldMappingService{constructor(e){this.logService=e;this._editorsFieldMapping=[];this._fieldsTabsMapping=[]}addFieldMapping(e,t,i,o){this._addMapping(e,t,i,o,this._editorsFieldMapping)}getEditorFieldMapping(e,t){let i=this._getMapping(e,t,this._editorsFieldMapping);if(!i){this.logService.warn("editorFieldMappingService - Cannot find suitable field mapping for type ",e.cmsStructureType);i=null}else if(i&&i.template){i.template=this._cleanTemplate(i.template)}return i}addFieldTabMapping(e,t,i,o){this._addMapping(e,t,i,o,this._fieldsTabsMapping)}getFieldTabMapping(e,t){return this._getMapping(e,t,this._fieldsTabsMapping)}_addMapping(e,t,i,o,n){e=this._validateField(e);t=this._validateField(t);i=this._validateField(i);const a={structureTypeMatcher:e,componentTypeMatcher:t,discriminatorMatcher:i,value:o};s.remove(n,(o=>o.structureTypeMatcher===e&&o.componentTypeMatcher===t&&o.discriminatorMatcher===i));n.push(a)}_validateField(e){if(e===null){e=es.WILDCARD}else if(typeof e!=="string"&&typeof e!=="function"){throw new Error("editorFieldMappingService: Mapping matcher must be of type string or function.")}return e}_getMapping(e,t,i){let o=null;let n=0;i.forEach((i=>{const s=this._evaluateMapping(i,e,t);if(s>n){o=i.value;n=s}}));return o}_evaluateMapping(e,t,i){let o;let n;let s=es.MATCH.NONE;const a=this._evaluateMatcher(e.structureTypeMatcher,t.cmsStructureType,t,i);if(a!==es.MATCH.NONE){o=this._evaluateMatcher(e.componentTypeMatcher,t.smarteditComponentType,t,i);if(o!==es.MATCH.NONE){n=this._evaluateMatcher(e.discriminatorMatcher,t.qualifier,t,i)}}if(a!==es.MATCH.NONE&&o!==es.MATCH.NONE&&n!==es.MATCH.NONE){s=a+o+n}return s}_evaluateMatcher(e,t,i,o){if(typeof e==="string"){if(e===es.WILDCARD){return es.MATCH.PARTIAL}else{return this._exactValueMatchPredicate(e,t)?es.MATCH.EXACT:es.MATCH.NONE}}else{return e(t,i,o)?es.MATCH.EXACT:es.MATCH.NONE}}_registerDefaultFieldMappings(){if(!this._initialized){this._initialized=true;this.addFieldMapping("Boolean",null,null,{component:t.BooleanComponent});this.addFieldMapping("ShortString",null,null,{component:t.ShortStringComponent,validators:{notBlank:(e,t,i,o)=>!!i?!!i:undefined}});this.addFieldMapping("Text",null,null,{component:Jn});this.addFieldMapping("LongString",null,null,{component:Zn});this.addFieldMapping("RichText",null,null,{component:t.RichTextFieldComponent});this.addFieldMapping("Number",null,null,{component:t.NumberComponent});this.addFieldMapping("Float",null,null,{component:qn});this.addFieldMapping("Dropdown",null,null,{component:Fn});this.addFieldMapping("EditableDropdown",null,null,{component:zn});this.addFieldMapping("DateTime",null,null,{component:Rn});this.addFieldMapping("Enum",null,null,{component:$n});this.addFieldMapping("Email",null,null,{component:Gn,validators:{email:(e,t,i,o)=>true}})}}_cleanTemplate(e){const t=e?e.lastIndexOf("/"):-1;if(t!==-1){e=e.substring(t+1)}return e}_exactValueMatchPredicate(e,t){return e===t}};t.EditorFieldMappingService.WILDCARD="*";t.EditorFieldMappingService.MATCH={NONE:0,PARTIAL:1,EXACT:4};t.EditorFieldMappingService=es=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.LogService])],t.EditorFieldMappingService);var is;t.FetchEnumDataHandler=is=class FetchEnumDataHandler{constructor(e){this.restServiceFactory=e;this.restServiceForEnum=this.restServiceFactory.get(ii)}static resetForTests(){is.cache={}}findByMask(e,t){return(is.cache[e.cmsStructureEnumType]?Promise.resolve(is.cache[e.cmsStructureEnumType]):Promise.resolve(this.restServiceForEnum.get({enumClass:e.cmsStructureEnumType}))).then((i=>{is.cache[e.cmsStructureEnumType]=i;return is.cache[e.cmsStructureEnumType].enums.filter((e=>r.stringUtils.isBlank(t)||e.label.toUpperCase().indexOf(t.toUpperCase())>-1))}))}getById(e,t){return null}};t.FetchEnumDataHandler.cache={};t.FetchEnumDataHandler=is=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory])],t.FetchEnumDataHandler);t.GenericEditorFactoryService=class GenericEditorFactoryService{constructor(e,t,i,o,n,s,a){s._registerDefaultFieldMappings();this.genericEditorConstructor=class extends DefaultGenericEditor{constructor(s){super(s,e,t,i,o,n,a)}}}getGenericEditorConstructor(){return this.genericEditorConstructor}};t.GenericEditorFactoryService=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.RestServiceFactory,t.LanguageService,r.ISharedDataService,t.SystemEventService,r.LogService,t.EditorFieldMappingService,t.FetchEnumDataHandler])],t.GenericEditorFactoryService);class DefaultGenericEditor{constructor(e,t,i,o,n,s,a){this.restServiceFactory=t;this.languageService=i;this.sharedDataService=o;this.systemEventService=n;this.logService=s;this.fetchEnumDataHandler=a;this.schema$=new m.BehaviorSubject(null);this.data$=new m.BehaviorSubject(null);this.submitButtonText="se.componentform.actions.submit";this.cancelButtonText="se.componentform.actions.cancel";this.api=createApi(this);this.onSubmit=e=>{if(this.smarteditComponentId){e.identifier=this.smarteditComponentId}if(this.editorCRUDService&&!this.smarteditComponentId&&this.structure&&this.structure.type&&!e.type){e.type=this.structure.type}return this.preparePayload(e).then((t=>{const updateOrSaveEditor=()=>this.smarteditComponentId?this.editorCRUDService.update(t):this.editorCRUDService.save(t);const i=this.editorCRUDService?updateOrSaveEditor():Promise.resolve(t);return i.then((function(t){return{payload:e,response:t}}))}))};this.submit$=()=>m.from(this.submit(this.form.component));this.onSuccess=e=>{let t;if(e.response){t=Ji.copy(e.response)}else{t=Ji.copy(e.payload)}delete t.identifier;if(!this.smarteditComponentId&&e.response){this.smarteditComponentId=e.response.uuid}this.form&&this.form.removeValidationMessages();this.inProgress=false;if(this.updateCallback){this.updateCallback(t,e.response)}};this.onFailure=e=>{this.form.removeValidationMessages();const t=e.error?e.error.errors:[];this.form.displayValidationMessages(t,true);const i=this.form.collectUnrelatedValidationMessages(t);if(i.length>0){this.systemEventService.publishAsync(ei,{messages:i,sourceGenericEditorId:this.id})}this.inProgress=false};this.isSubmitDisabled=()=>{if(this.inProgress){return true}else if(!this.isDirty()||!this.isValid()){return!this.alwaysEnableSubmit}else{return false}};this._validate(e);this.id=e.id;this.inProgress=false;this.smarteditComponentType=e.smarteditComponentType;this.smarteditComponentId=e.smarteditComponentId;this.editorStackId=e.editorStackId||this.id;this.updateCallback=e.updateCallback;this.structure=e.structure;this.onChangeEvents=[];if(e.structureApi){this.editorStructureService=this.restServiceFactory.get(e.structureApi)}this.uriContext=e.uriContext;if(e.contentApi){this.editorCRUDService=this.restServiceFactory.get(e.contentApi)}this.initialContent=K.cloneDeep(e.content);this.initialDirty=false;if(e.customOnSubmit){this.onSubmit=e.customOnSubmit}this._unregisterUnrelatedMessagesEvent=this.systemEventService.subscribe(ei,this._handleUnrelatedValidationMessages.bind(this));this.element=e.element}get pristine(){return this.form?this.form.pristine:undefined}get nativeForm(){return this.element.querySelector("form")}setForm(e){this.form=e;this.form.group.valueChanges.subscribe((()=>{this.api.triggerContentChangeEvents()}))}_finalize(){this._unregisterUnrelatedMessagesEvent();this.popEditorFromStack()}popEditorFromStack(){if(!this.editorStackId){return}this.systemEventService.publishAsync(t.GenericEditorStackService.EDITOR_POP_FROM_STACK_EVENT,{editorStackId:this.editorStackId})}reset(e){this.form&&this.form.removeValidationMessages();const t=this.editorStructureService?this.editorStructureService.get({smarteditComponentType:this.smarteditComponentType}):Promise.resolve(this.structure);return this._getUriContext().then((e=>Promise.all([this.api.getLanguages()||this.languageService.getLanguagesForSite(e[Se]),t.then((e=>this._convertStructureArray(e))),Promise.resolve(e)]))).then((([t,i,o])=>{const n={languages:t,structure:i,uriContext:o,id:this.id,smarteditComponentType:this.smarteditComponentType,targetedQualifier:this.targetedQualifier};this.schema$.next(n);this.data$.next(e?e:this.pristine)}))}fetch(){const fetchPayload=()=>this.smarteditComponentId?this.editorCRUDService.getById(this.smarteditComponentId).then((e=>e||{})):Promise.resolve({});if(!this.initialDirty){return this.initialContent?Promise.resolve(this.initialContent):fetchPayload()}return Promise.resolve({})}load(){return this.fetch().then((e=>this.reset(e)),(e=>{this.logService.error("GenericEditor.load failed");this.logService.error(e)}))}getComponent(){return this.form&&this.form.component||null}preparePayload(e){return Promise.resolve(this.form.sanitizedPayload(e))}submit(e){this.form.removeValidationMessages();this.hasFrontEndValidationErrors=false;if(!this.form.fieldsAreUserChecked()){this.hasFrontEndValidationErrors=true;return Promise.reject(true)}else if(this.isValid(true)){this.inProgress=true;return this.onSubmit(e)}else{this.logService.warn("GenericEditor.submit() - unable to submit form. Form is unexpectedly invalid.");return Promise.reject({})}}refreshOptions(e,t,i){return new Promise((o=>{let n;let s;if(e.localized){n=this.form.component[e.qualifier][t];s=t}else{n=this.form.component[e.qualifier];s=e.qualifier}e.initiated=e.initiated||[];e.options=e.options||{};if(e.cmsStructureType==="Enum"){e.initiated.push(s)}if(e.initiated.indexOf(s)>-1){if(i.length>2||e.cmsStructureType==="Enum"){return this.fetchEnumDataHandler.findByMask(e,i).then((t=>{e.options[s]=t;o()}))}}else if(n){return this.fetchEnumDataHandler.getById(e,n).then((t=>{e.options[s]=[t];e.initiated.push(s);o()}))}else{e.initiated.push(s)}return o()}))}isDirty(e,t){return this.initialDirty||(this.form?this.form.isDirty(e,t):false)}isValid(e=false){if(e){const t=this.form.collectFrontEndValidationErrors(e,this.nativeForm);this.form.removeFrontEndValidationMessages();this.form.displayValidationMessages(t,e)}return!!this.form&&this.form.group.valid}watchFormErrors(e){this.form.watchErrors(e)}init(){return this.load().then((()=>{if(this.initialDirty){this.form.patchComponent(this.initialContent||{});this.data$.next(this.initialContent||{})}this._pushEditorToStack();this.systemEventService.publishAsync(Xt,this.id)}))}_validate(e){if(ae.isBlank(e.structureApi)&&!e.structure){throw new Error("genericEditor.configuration.error.no.structure")}else if(!ae.isBlank(e.structureApi)&&e.structure){throw new Error("genericEditor.configuration.error.2.structures")}}_getUriContext(){return Promise.resolve(this.uriContext?this.uriContext:this.sharedDataService.get(Mi).then((e=>({[Se]:e.siteDescriptor.uid,[fe]:e.catalogDescriptor.catalogId,[ye]:e.catalogDescriptor.catalogVersion}))))}_convertStructureArray(e){const t=e.structures||e.componentTypes;if(K.isArray(t)){if(t.length>1){throw new Error("init: Invalid structure, multiple structures returned")}e=t[0]}return e}_handleUnrelatedValidationMessages(e,t){if(t.targetGenericEditorId&&t.targetGenericEditorId!==this.id){return}if(t.sourceGenericEditorId&&t.sourceGenericEditorId===this.id){return}this.form.removeValidationMessages();this.form.displayValidationMessages(t.messages,true)}_pushEditorToStack(){this.systemEventService.publishAsync(t.GenericEditorStackService.EDITOR_PUSH_TO_STACK_EVENT,{editorId:this.id,editorStackId:this.editorStackId,component:this.form.component,componentType:this.smarteditComponentType})}}const os=new Set(["id","smarteditComponentId","smarteditComponentType","structureApi","structure","contentApi","content","uriContext","updateCallback","customOnSubmit","editorStackId","modalHeaderTitle"]);window.__smartedit__.addDecoratorPayload("Component","GenericEditorComponent",{selector:"se-generic-editor",template:`<ng-template let-state [formBuilder]="{schema$: editor.schema$, data$: editor.data$}" (stateCreated)="setFormState($event)"><div class="se-generic-editor"><se-generic-editor-breadcrumb></se-generic-editor-breadcrumb><ng-container *ngIf="state; else noSupport"><form novalidate #nativeForm class="no-enter-submit se-generic-editor__form" [contentManager]="{onSave: editor.submit$}" (onSuccess)="editor.onSuccess($event)" (onError)="editor.onFailure($event)"><div class="modal-header se-generic-editor__header" *ngIf="modalHeaderTitle"><h4 class="modal-title">{{modalHeaderTitle| translate}}</h4></div><div class="se-generic-editor__body"><ng-container [formRenderer]="state.group"></ng-container></div><div class="se-generic-editor__footer dialog-footer" *ngIf="editor && showCommands()"><button fd-button id="submit" name="submit" options="emphasized" *ngIf="showSubmit()" [seSubmitBtn]="editor.isSubmitDisabled" [label]="editor.submitButtonText | translate"></button> <button fd-button id="cancel" type="button" options="light" *ngIf="showCancel()" (click)="_reset()">{{editor.cancelButtonText | translate}}</button></div></form></ng-container><ng-template #noSupport><div class="se-generic-editor__body"><se-message type="info" id="GenericEditor.NoEditingSupportDisclaimer"><ng-container se-message-description>{{ 'se.editor.notification.editing.not.supported' | translate }}</ng-container></se-message></div></ng-template></div></ng-template>`});t.GenericEditorComponent=class GenericEditorComponent{constructor(e,t,i){this.elementRef=e;this.genericEditorFactoryService=t;this.waitDialogService=i;this.submit=null;this.reset=null;this.isDirty=null;this.isValid=null;this.getApi=new n.EventEmitter;this.submitChange=new n.EventEmitter;this.resetChange=new n.EventEmitter;this.isValidChange=new n.EventEmitter;this.isDirtyChange=new n.EventEmitter;this.editor=null;this.componentForm=new E.FormGroup({});this.formInitialized$=new m.BehaviorSubject(null);this.formSet$=new m.BehaviorSubject(false);this.isSubmitDisabled=()=>this.editor.isSubmitDisabled()}set nativeForm(e){if(!e){return}this.formInitialized$.next(e.nativeElement)}ngOnChanges(e){const t=!!Object.keys(e).find((e=>os.has(e)));if(!t){return}if(this.editor){this.editor._finalize()}const i=this.genericEditorFactoryService.getGenericEditorConstructor();this.editor=new i({id:this.id||ae.generateIdentifier(),smarteditComponentType:this.smarteditComponentType,smarteditComponentId:this.smarteditComponentId,editorStackId:this.editorStackId,structureApi:this.structureApi,structure:this.structure,contentApi:this.contentApi,updateCallback:this.updateCallback,content:this.content,uriContext:this.uriContext,customOnSubmit:this.customOnSubmit,element:this.elementRef.nativeElement});this.getApi.emit(this.editor.api);this.editor.init()}ngOnInit(){this.waitDialogService.hideWaitModal();this.showResetButton=s.isNull(this.reset);this.showSubmitButton=s.isNull(this.submit);setTimeout((()=>{this.submitChange.emit((()=>this.contentManager.save().toPromise().then((e=>e.response))));this.isValidChange.emit((()=>this._isValid()));this.isDirtyChange.emit((()=>this._isDirty()));this.resetChange.emit((()=>this._reset()))}));m.combineLatest([this.formSet$,this.formInitialized$]).pipe(v.filter((e=>e.every((e=>!!e)))),v.take(1)).subscribe((([e,t])=>this.editor.watchFormErrors(t)))}ngOnDestroy(){this.editor._finalize();this.waitDialogService.hideWaitModal()}setFormState(e){this.editor.setForm(e);this.formSet$.next(true)}showCommands(){return this.showCancel()||this.showSubmit()}showCancel(){return this.editor.alwaysShowReset||this.showResetButton===true&&this.editor.isDirty()&&this.editor.isValid()}showSubmit(){return this.editor.alwaysShowSubmit||this.showSubmitButton===true&&this.editor.isDirty()&&this.editor.isValid()}_reset(){return __awaiter(this,void 0,void 0,(function*(){if(this.editor.onReset&&this.editor.onReset()===false){return null}return this.editor.reset()}))}_isValid(){return this.editor.isValid()}_isDirty(){return this.editor?this.editor.isDirty():false}};__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorComponent.prototype,"id",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorComponent.prototype,"smarteditComponentId",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorComponent.prototype,"smarteditComponentType",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorComponent.prototype,"structureApi",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.GenericEditorComponent.prototype,"structure",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorComponent.prototype,"contentApi",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.GenericEditorComponent.prototype,"content",void 0);__decorate([n.Input(),__metadata("design:type",Promise)],t.GenericEditorComponent.prototype,"uriContext",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.GenericEditorComponent.prototype,"submit",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.GenericEditorComponent.prototype,"reset",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.GenericEditorComponent.prototype,"isDirty",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.GenericEditorComponent.prototype,"isValid",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.GenericEditorComponent.prototype,"updateCallback",void 0);__decorate([n.Input(),__metadata("design:type",Function)],t.GenericEditorComponent.prototype,"customOnSubmit",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorComponent.prototype,"editorStackId",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorComponent.prototype,"modalHeaderTitle",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.GenericEditorComponent.prototype,"getApi",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.GenericEditorComponent.prototype,"submitChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.GenericEditorComponent.prototype,"resetChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.GenericEditorComponent.prototype,"isValidChange",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],t.GenericEditorComponent.prototype,"isDirtyChange",void 0);__decorate([n.ViewChild("nativeForm",{static:false,read:n.ElementRef}),__metadata("design:type",n.ElementRef),__metadata("design:paramtypes",[n.ElementRef])],t.GenericEditorComponent.prototype,"nativeForm",null);__decorate([n.ViewChild(On,{static:false}),__metadata("design:type",On)],t.GenericEditorComponent.prototype,"contentManager",void 0);t.GenericEditorComponent=__decorate([n.Component({selector:"se-generic-editor",template:`<ng-template let-state [formBuilder]="{schema$: editor.schema$, data$: editor.data$}" (stateCreated)="setFormState($event)"><div class="se-generic-editor"><se-generic-editor-breadcrumb></se-generic-editor-breadcrumb><ng-container *ngIf="state; else noSupport"><form novalidate #nativeForm class="no-enter-submit se-generic-editor__form" [contentManager]="{onSave: editor.submit$}" (onSuccess)="editor.onSuccess($event)" (onError)="editor.onFailure($event)"><div class="modal-header se-generic-editor__header" *ngIf="modalHeaderTitle"><h4 class="modal-title">{{modalHeaderTitle| translate}}</h4></div><div class="se-generic-editor__body"><ng-container [formRenderer]="state.group"></ng-container></div><div class="se-generic-editor__footer dialog-footer" *ngIf="editor && showCommands()"><button fd-button id="submit" name="submit" options="emphasized" *ngIf="showSubmit()" [seSubmitBtn]="editor.isSubmitDisabled" [label]="editor.submitButtonText | translate"></button> <button fd-button id="cancel" type="button" options="light" *ngIf="showCancel()" (click)="_reset()">{{editor.cancelButtonText | translate}}</button></div></form></ng-container><ng-template #noSupport><div class="se-generic-editor__body"><se-message type="info" id="GenericEditor.NoEditingSupportDisclaimer"><ng-container se-message-description>{{ 'se.editor.notification.editing.not.supported' | translate }}</ng-container></se-message></div></ng-template></div></ng-template>`}),__metadata("design:paramtypes",[n.ElementRef,t.GenericEditorFactoryService,IWaitDialogService])],t.GenericEditorComponent);var ns;t.GenericEditorTabService=ns=class GenericEditorTabService{constructor(){this._tabsConfiguration={};this._defaultTabPredicates=[]}configureTab(e,t){this._tabsConfiguration[e]=t}getTabConfiguration(e){const t=this._tabsConfiguration[e];return t?t:null}sortTabs(e){return e.sort(((e,t)=>{const i=this.getTabPriority(e);const o=this.getTabPriority(t);if(o-i!==0){return o-i}else{if(e.id<t.id){return-1}else if(e.id>t.id){return 1}return 0}}))}getComponentTypeDefaultTab(e){let t=null;this._defaultTabPredicates.some((i=>{t=i(e);return t!==null}));return t!==null?t:ns.DEFAULT_TAB_ID}addComponentTypeDefaultTabPredicate(e){if(!e||typeof e!=="function"){throw new Error("genericEditorTabService - provided predicate must be a function.")}this._defaultTabPredicates.push(e)}getTabPriority(e){const t=e.id;if(!t){throw new Error("genericEditorTabService - Every tab must have an id.")}let i=ns.MIN_PRIORITY;if(this._tabsConfiguration[t]&&this._tabsConfiguration[t].priority){i=this._tabsConfiguration[t].priority}return i}};t.GenericEditorTabService.MIN_PRIORITY=0;t.GenericEditorTabService.DEFAULT_TAB_ID="default";t.GenericEditorTabService=ns=__decorate([n.Injectable()],t.GenericEditorTabService);const parseValidationMessage=e=>{const t=new RegExp("[a-zA-Z]+: ([|{)([a-zA-Z0-9]+)(]|}).?","g");const i=e.match(t)||[];return i.reduce(((e,t)=>{e.message=e.message.replace(t,"").trim();const i=t.split(":")[0].trim().toLowerCase();const o=t.split(":")[1].match(/[a-zA-Z0-9]+/g)[0];e[i]=o;return e}),{message:e})};t.SeValidationMessageParser=class SeValidationMessageParser{parse(e){return parseValidationMessage(e)}};t.SeValidationMessageParser=__decorate([n.Injectable()],t.SeValidationMessageParser);function isBlankValidator(){return e=>{const t=e.value&&e.value.length>0&&""===K.trim(e.value);return t?{isBlank:{value:e.value}}:null}}window.__smartedit__.addDecoratorPayload("Component","GenericEditorBreadcrumbComponent",{selector:"se-generic-editor-breadcrumb",template:`\n        <div class="se-ge-breadcrumb">\n            <ng-container *ngIf="showBreadcrumb()">\n                <div\n                    *ngFor="let breadcrumbItem of getEditorsStack(); let i = index"\n                    class="se-ge-breadcrumb__item">\n                    <div class="se-ge-breadcrumb__data">\n                        <span class="se-ge-breadcrumb__title">\n                            {{ getComponentName(breadcrumbItem) | translate }}\n                        </span>\n                        <span class="se-ge-breadcrumb__info">\n                            {{ breadcrumbItem.componentType | translate }}\n                        </span>\n                    </div>\n\n                    <div class="se-ge-breadcrumb__divider" *ngIf="i < getEditorsStack().length - 1">\n                        <i class="sap-icon--navigation-right-arrow"></i>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n    `});t.GenericEditorBreadcrumbComponent=class GenericEditorBreadcrumbComponent{constructor(e,t){this.genericEditorStackService=e;this.ge=t}getEditorsStack(){if(!this.editorsStack){this.editorsStack=this.genericEditorStackService.getEditorsStack(this.ge.editorStackId)}return this.editorsStack}showBreadcrumb(){return this.getEditorsStack()&&this.getEditorsStack().length>1}getComponentName(e){if(!e.component.name){return"se.breadcrumb.name.empty"}return e.component.name}};t.GenericEditorBreadcrumbComponent=__decorate([n.Component({selector:"se-generic-editor-breadcrumb",template:`\n        <div class="se-ge-breadcrumb">\n            <ng-container *ngIf="showBreadcrumb()">\n                <div\n                    *ngFor="let breadcrumbItem of getEditorsStack(); let i = index"\n                    class="se-ge-breadcrumb__item">\n                    <div class="se-ge-breadcrumb__data">\n                        <span class="se-ge-breadcrumb__title">\n                            {{ getComponentName(breadcrumbItem) | translate }}\n                        </span>\n                        <span class="se-ge-breadcrumb__info">\n                            {{ breadcrumbItem.componentType | translate }}\n                        </span>\n                    </div>\n\n                    <div class="se-ge-breadcrumb__divider" *ngIf="i < getEditorsStack().length - 1">\n                        <i class="sap-icon--navigation-right-arrow"></i>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n    `}),__param(1,n.Inject(n.forwardRef((()=>t.GenericEditorComponent)))),__metadata("design:paramtypes",[t.GenericEditorStackService,t.GenericEditorComponent])],t.GenericEditorBreadcrumbComponent);window.__smartedit__.addDecoratorPayload("Component","GenericEditorDynamicFieldComponent",{selector:"se-ge-dynamic-field",styles:[`\n            :host {\n                display: block;\n            }\n        `],template:`\n        <se-generic-editor-field\n            [formControl]="form"\n            [field]="field"\n            [model]="component"\n            [qualifier]="qualifier"\n            [id]="id"></se-generic-editor-field>\n    `});let ss=class GenericEditorDynamicFieldComponent{constructor(e){this.cdr=e}ngAfterViewChecked(){if(!this.cdr.destroyed){this.cdr.detectChanges()}}};__decorate([r.DynamicForm(),__metadata("design:type",r.FormField)],ss.prototype,"form",void 0);__decorate([r.DynamicInput(),__metadata("design:type",Object)],ss.prototype,"component",void 0);__decorate([r.DynamicInput(),__metadata("design:type",Object)],ss.prototype,"field",void 0);__decorate([r.DynamicInput(),__metadata("design:type",String)],ss.prototype,"qualifier",void 0);__decorate([r.DynamicInput(),__metadata("design:type",String)],ss.prototype,"id",void 0);ss=__decorate([n.Component({selector:"se-ge-dynamic-field",styles:[`\n            :host {\n                display: block;\n            }\n        `],template:`\n        <se-generic-editor-field\n            [formControl]="form"\n            [field]="field"\n            [model]="component"\n            [qualifier]="qualifier"\n            [id]="id"></se-generic-editor-field>\n    `}),__metadata("design:paramtypes",[n.ChangeDetectorRef])],ss);window.__smartedit__.addDecoratorPayload("Component","GenericEditorTabComponent",{selector:"se-ge-tab",template:`<div class="se-generic-editor__row ySErow" *ngFor="let field of fields" [ngClass]="'se-generic-editor__row--' + field.qualifier"><label [id]="field.qualifier + '-label'" class="se-control-label" *ngIf="!field.hideFieldWidget && !field.hidePrefixLabel && field.i18nKey" [hidden]="field.hideFieldWidget && field.hidePrefixLabel" [ngClass]="{ required: field.required }">{{ field.i18nKey | lowercase | translate }}</label><se-help class="se-help-tooltip" *ngIf="field.tooltip"><span>{{ field.tooltip | translate }}</span></se-help><div class="ySEGenericEditorFieldStructure" [hidden]="field.hideFieldWidget" [id]="field.qualifier" [attr.data-cms-field-qualifier]="field.qualifier" [attr.data-cms-structure-type]="field.cmsStructureType"><ng-template [formRenderer]="getForm(field.qualifier)"></ng-template></div></div>`});let as=class GenericEditorTabComponent{constructor(e,t,i){this.cdr=e;this.ge=t;this.data=i}ngOnInit(){const{model:e,tabId:t}=this.data;this.fields=e.getInput("fieldsMap")[t];const i=e.controls[t];this.forms=i.controls;this._subscription=i.statusChanges.subscribe((()=>{const e=s.values(this.forms).some((e=>{const t=e.getInput("field");return t.messages&&t.messages.length>0}));this.data.tab.hasErrors=e}));Object.keys(this.forms).forEach((e=>{this.forms[e].setInput("id",this.ge.editor.id)}))}ngAfterViewChecked(){if(!this.cdr.destroyed){this.cdr.detectChanges()}}ngOnDestroy(){this._subscription.unsubscribe()}getForm(e){return this.forms[e]}};as=__decorate([n.Component({selector:"se-ge-tab",template:`<div class="se-generic-editor__row ySErow" *ngFor="let field of fields" [ngClass]="'se-generic-editor__row--' + field.qualifier"><label [id]="field.qualifier + '-label'" class="se-control-label" *ngIf="!field.hideFieldWidget && !field.hidePrefixLabel && field.i18nKey" [hidden]="field.hideFieldWidget && field.hidePrefixLabel" [ngClass]="{ required: field.required }">{{ field.i18nKey | lowercase | translate }}</label><se-help class="se-help-tooltip" *ngIf="field.tooltip"><span>{{ field.tooltip | translate }}</span></se-help><div class="ySEGenericEditorFieldStructure" [hidden]="field.hideFieldWidget" [id]="field.qualifier" [attr.data-cms-field-qualifier]="field.qualifier" [attr.data-cms-structure-type]="field.cmsStructureType"><ng-template [formRenderer]="getForm(field.qualifier)"></ng-template></div></div>`}),__param(2,n.Inject(sn)),__metadata("design:paramtypes",[n.ChangeDetectorRef,t.GenericEditorComponent,Object])],as);const createValidatorMap=(e,t,i,o,n)=>Object.keys(e||{}).reduce(((s,a)=>Object.assign(Object.assign({},s),{[a]:e[a](t,i,o,n)})),{});class RootSchemaDataMapper{constructor(e,t,i){this.mappers=e;this.tabs=t;this.fieldsMap=i}toValue(){return this.mappers.reduce(((e,t)=>{e[t.id]=t.toValue();return e}),{})}toSchema(){return{type:"group",component:"tabs",schemas:this.mappers.reduce(((e,t)=>{e[t.id]=t.toSchema();return e}),{}),inputs:{tabs:this.tabs,fieldsMap:this.fieldsMap}}}}const rs="$$internal";class InternalProperty{constructor(){this._map=new Map}watch(e,t){this._map.set(e,t);return()=>{this._map.delete(e)}}trigger(e,t){if(this._map.has(e)){this._map.get(e)(t)}}}const proxifyDataObject=e=>{const t=new InternalProperty;Object.defineProperty(e,rs,{get:()=>t});return new Proxy(e,{set(e,t,i){e[t]=i;e[rs].trigger(t,i);return true}})};const ls=new Set(K.values(ti));const cs={SHORT_STRING:"ShortString",LONG_STRING:"LongString"};class GenericEditorState{constructor(e,t,i,o,n,s,a,r,l){this.id=e;this.group=t;this.component=i;this.proxiedComponent=o;this.pristine=n;this.tabs=s;this.fields=a;this.languages=r;this.parameters=l;this.removeValidationMessages=()=>{this.fields.forEach((e=>{e.messages=undefined;e.hasErrors=false;e.hasWarnings=false}))};this._qualifierFieldMap=this.fields.reduce(((e,t)=>{e.set(t.qualifier,t);return e}),new Map);this._formFields=this._buildFormFieldsArray(this.group)}removeFrontEndValidationMessages(){this.fields.forEach((e=>{if(!Array.isArray(e.messages)){return}const t=(e.messages||[]).filter((e=>e.fromSubmit===undefined?true:e.fromSubmit));e.messages=t.length?t:undefined;e.hasErrors=this._containsValidationMessageType(e.messages,ti.VALIDATION_ERROR);e.hasWarnings=this._containsValidationMessageType(e.messages,ti.WARNING)}))}validationMessageBelongsToCurrentInstance(e){return this._qualifierFieldMap.has(e.subject)}collectUnrelatedValidationMessages(e){return e.filter((e=>this._isValidationMessageType(e.type)&&!this.validationMessageBelongsToCurrentInstance(e)))}watchErrors(e){const t=this._formFields.map((e=>e.statusChanges.pipe(v.startWith(null))));m.combineLatest([...t,this.group.statusChanges.pipe(v.startWith(null))]).pipe(v.distinctUntilChanged(((e,t)=>K.isEqual(e,t))),v.map((()=>this.collectFrontEndValidationErrors(false,e)))).subscribe((e=>{this.removeFrontEndValidationMessages();this.displayValidationMessages(e,false)}))}collectFrontEndValidationErrors(e,t){e=e||false;return this._formFields.reduce(((i,o)=>{const n=o.getInput("field");if((()=>{const e=Array.from(t||[]).find((e=>e.getAttribute("name")===n.qualifier));return!!e&&!e.checkValidity()})()){i.push({type:ti.VALIDATION_ERROR,subject:n.qualifier,message:"se.editor.htmlo.validation.error",fromSubmit:e,isNonPristine:this.isDirty(n.qualifier)})}if(o.getError("required")&&o.touched||o.getError("isBlank")&&o.touched){if(n.localized){const t=o.getInput("id");i.push({type:ti.VALIDATION_ERROR,subject:n.qualifier,message:"se.componentform.required.field",language:t,fromSubmit:e,isNonPristine:this.isDirty(n.qualifier,t)})}else{i.push({type:ti.VALIDATION_ERROR,subject:n.qualifier,message:"se.componentform.required.field",fromSubmit:e,isNonPristine:this.isDirty(n.qualifier)})}}return i}),[])}displayValidationMessages(e,t){e.filter((e=>this._isValidationMessageType(e.type)&&(t||e.isNonPristine))).forEach((e=>{e.type=e.type||ti.VALIDATION_ERROR;const t=this._qualifierFieldMap.get(e.subject);if(!t){return}if(!t.messages){t.messages=[]}const i=K.merge(e,this._getParseValidationMessage(e.message));i.marker=t.localized?i.language:t.qualifier;i.type=e.type;i.uniqId=ae.encode(i);const o=t.messages.find((e=>e.uniqId===i.uniqId));if(!o){t.messages.push(i);if(i.type===ti.VALIDATION_ERROR){t.hasErrors=true}else if(i.type===ti.WARNING){t.hasWarnings=true}}else{K.merge(o,i)}}));K.values(this.group.controls).forEach((e=>{e.updateValueAndValidity({emitEvent:true})}));return Promise.resolve()}isDirty(e,t){this._bcPristine=this._buildComparable(this.fields,this.pristine);const i=this._buildComparable(this.fields,this.component);const o=e?t?this._bcPristine[e][t]:this._bcPristine[e]:this._bcPristine;const n=e?t?i[e][t]:i[e]:i;return!K.isEqual(o,n)}fieldsAreUserChecked(){return this.fields.every((e=>{let t=false;for(const i in e.requiresUserCheck){if(e.requiresUserCheck.hasOwnProperty(i)){t=t||e.requiresUserCheck[i]}}return!t||e.isUserChecked}))}patchComponent(e){this._qualifierFieldMap.forEach((({localized:t,qualifier:i})=>{if(t&&e[i]){e[i]=proxifyDataObject(e[i])}}));Object.assign(this.proxiedComponent,e)}sanitizedPayload(e=this.component){this.fields.filter((e=>e.cmsStructureType===cs.LONG_STRING||e.cmsStructureType===cs.SHORT_STRING||typeof e.customSanitize==="function")).forEach((({qualifier:t,localized:i,customSanitize:o})=>{if(e[t]!==undefined&&t in e){if(o){e[t]=o(e[t],ae.sanitize);return}}}));return e}switchToTabContainingQualifier(e){if(!e){return}this.tabs.forEach((t=>{t.active=!!this.group.get([t.id,e])}))}_getParseValidationMessage(e){return parseValidationMessage(e)}_containsValidationMessageType(e,t){if(!Array.isArray(e)){return false}return e.some((e=>e.type===t&&this.validationMessageBelongsToCurrentInstance(e)))}_isValidationMessageType(e){return ls.has(e)}_buildComparable(e,t){if(!t){return t}const i={};e.forEach((e=>{let o=t[e.qualifier];if(e.localized){o=o;const t={};K.forEach(o,((i,o)=>{if(!K.isUndefined(i)){t[o]=this._buildFieldComparable(i,e)}}));i[e.qualifier]=t}else{o=t[e.qualifier];i[e.qualifier]=this._buildFieldComparable(o,e)}}));K.forEach(t,((t,o)=>{const n=!e.some((e=>e.qualifier===o));if(n){i[o]=t}}));return K.omitBy(i,K.isUndefined)}_buildFieldComparable(e,t){switch(t.cmsStructureType){case"RichText":return e!==undefined?ae.sanitizeHTML(e):null;case"Boolean":return e!==undefined?e:false;default:return e}}_buildFormFieldsArray(e,t=[]){if(e instanceof r.FormField){t.push(e);return t}if(e instanceof r.FormGrouping){Object.keys(e.controls).forEach((i=>{const o=e.controls[i];this._buildFormFieldsArray(o,t)}));return t}return t}}class FieldSchemaDataMapper{constructor(e,t,i,o){this.id=e;this.structure=t;this.required=i;this.component=o}toValue(){return this.component[this.id]}toSchema(){return{type:"field",component:"field",validators:Object.assign({required:this.required&&this.structure.editable||undefined},createValidatorMap(this.structure.validators,this.id,this.structure,this.required,this.component)),inputs:{id:this.id,field:this.structure,qualifier:this.id,component:this.component}}}}class LocalizedSchemaDataMapper{constructor(e,t,i,o,n){this.id=e;this.mappers=t;this.structure=i;this.languages=o;this.component=n}toValue(){return this.mappers.reduce(((e,t)=>{e[t.id]=t.toValue();return e}),{})}toSchema(){return{type:"group",component:"localized",schemas:this.mappers.reduce(((e,t)=>{e[t.id]=t.toSchema();return e}),{}),inputs:{field:this.structure,languages:this.languages,component:this.component}}}}class TabSchemaDataMapper{constructor(e,t){this.id=e;this.mappers=t}toValue(){return this.mappers.reduce(((e,t)=>{e[t.id]=t.toValue();return e}),{})}toSchema(){return{type:"group",persist:false,schemas:this.mappers.reduce(((e,t)=>{e[t.id]=t.toSchema();return e}),{})}}}const createFieldMapper=(e,t,i,o)=>new FieldSchemaDataMapper(e,t,i,o);const createLocalizedMapper=(e,t,i)=>{if(i[e.qualifier]===undefined){i[e.qualifier]={}}i[e.qualifier]=proxifyDataObject(i[e.qualifier]);const o=t.map((({isocode:t,required:o})=>createFieldMapper(t,e,e.required&&o,i[e.qualifier])));return new LocalizedSchemaDataMapper(e.qualifier,o,e,t,i)};const createTabMapper=(e,t,i,o)=>{const n=t.map((e=>{if(e.localized){return createLocalizedMapper(e,i,o)}return createFieldMapper(e.qualifier,e,e.required,o)}));return new TabSchemaDataMapper(e,n)};const createRootMapper=(e,t,i,o)=>{const n=s.toPairs(e).map((([e,o])=>createTabMapper(e,o,i,t)));return new RootSchemaDataMapper(n,o,e)};let ds=class GenericEditorStateBuilderService{constructor(e,t,i,o){this.editorFieldMappingService=e;this.genericEditorTabService=t;this.translateService=i;this.schemaCompiler=o}buildState(e,t){const i=this._fieldAdaptor(t);const o=[];const n=i.reduce(((e,i)=>{let n=this.editorFieldMappingService.getFieldTabMapping(i,t.structure);if(!n){n=this.genericEditorTabService.getComponentTypeDefaultTab(t.structure)}if(!e[n]){e[n]=[];o.push({id:n,title:"se.genericeditor.tab."+n+".title",component:as})}e[n].push(i);return e}),{});this.genericEditorTabService.sortTabs(o);const s={siteId:t.uriContext[Se],catalogId:t.uriContext[fe],catalogVersion:t.uriContext[ye]};const a=Ji.copy(e);const r=proxifyDataObject(a);const l=this._createMapper(n,r,t.languages,o);const d=this.schemaCompiler.compileGroup(l.toValue(),l.toSchema());const p=new GenericEditorState(t.id,d,a,r,Ji.copy(e),o,i,t.languages,s);p.switchToTabContainingQualifier(t.targetedQualifier);return p}_createMapper(e,t,i,o){return createRootMapper(e,t,i,o)}_fieldAdaptor(e){const t=e.structure;return t.attributes.map((i=>{const o=this.editorFieldMappingService.getEditorFieldMapping(i,t);const n=Object.assign(i,o);if(n.editable===undefined){n.editable=true}if(!n.postfixText){const e=(t.type?t.type.toLowerCase():"")+"."+i.qualifier.toLowerCase()+".postfix.text";const o=this.translateService.instant(e);n.postfixText=o!==e?o:""}n.smarteditComponentType=e.smarteditComponentType;return n}))}};ds=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.EditorFieldMappingService,t.GenericEditorTabService,h.TranslateService,r.SchemaCompilerService])],ds);let ps=class FormBuilderDirective{constructor(e,t,i){this.templateRef=e;this.viewContainer=t;this.stateBuilderService=i;this.stateCreated=new n.EventEmitter}set formBuilder(e){this._dispose();this._subscription=m.combineLatest([e.data$,e.schema$]).subscribe(this._onDataStream.bind(this))}ngOnDestroy(){this._dispose()}_onDataStream([e,t]){if(!e||!t){return}this.viewContainer.clear();if(!t.structure){this.viewContainer.createEmbeddedView(this.templateRef,{$implicit:null});return}const i=this.stateBuilderService.buildState(e,t);this.stateCreated.emit(i);this.viewContainer.createEmbeddedView(this.templateRef,{$implicit:i})}_dispose(){this._subscription&&this._subscription.unsubscribe();this.viewContainer.clear()}};__decorate([n.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],ps.prototype,"formBuilder",null);__decorate([n.Output(),__metadata("design:type",Object)],ps.prototype,"stateCreated",void 0);ps=__decorate([n.Directive({selector:"[formBuilder]"}),__metadata("design:paramtypes",[n.TemplateRef,n.ViewContainerRef,ds])],ps);var ms;window.__smartedit__.addDecoratorPayload("Component","GenericEditorFieldComponent",{selector:"se-generic-editor-field",providers:[{provide:E.NG_VALUE_ACCESSOR,useExisting:n.forwardRef((()=>ms)),multi:true}],template:`<div [attr.validation-id]="field.qualifier" class="ySEField"><ng-container *ngIf="field.component"><ng-container *ngComponentOutlet="field.component; injector: widgetInjector"></ng-container></ng-container><se-generic-editor-field-messages [field]="field" [qualifier]="qualifier"></se-generic-editor-field-messages><div *ngIf="field.postfix" class="ySEText ySEFieldPostfix">{{ field.postfix | translate }}</div></div>`});t.GenericEditorFieldComponent=ms=class GenericEditorFieldComponent{constructor(e,t,i){this.elementRef=e;this.injector=t;this.ge=i}writeValue(e){this.model[this.qualifier]=e}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}ngOnInit(){this.createInjector();this._unWatch=this.model[rs].watch(this.qualifier,(e=>{if(this._onChange&&this._onTouched){this._onTouched();this._onChange(e)}}))}ngOnDestroy(){this._unWatch()}ngAfterViewInit(){if(!this.field.template){return}const e=document.createElement("se-template-ge-widget");this.elementRef.nativeElement.editor=this.ge.editor;this.elementRef.nativeElement.model=this.model;this.elementRef.nativeElement.field=this.field;this.elementRef.nativeElement.qualifier=this.qualifier;this.elementRef.nativeElement.id=this.id;this.elementRef.nativeElement.editorStackId=this.ge.editor.editorStackId;this.elementRef.nativeElement.isFieldDisabled=()=>this.isFieldDisabled();this.elementRef.nativeElement.$ctrl=this;this.geWidget.nativeElement.appendChild(e)}isFieldDisabled(){let e=this.field.editable;if(this.field.localized){e=this.field.editable&&this.field.isLanguageEnabledMap[this.qualifier]}return!e}createInjector(){this.widgetInjector=n.Injector.create({parent:this.injector,providers:[{provide:An,useValue:{id:this.id,field:this.field,model:this.model,editor:this.ge.editor,qualifier:this.qualifier,isFieldDisabled:()=>this.isFieldDisabled()}}]})}};__decorate([n.Input(),__metadata("design:type",Object)],t.GenericEditorFieldComponent.prototype,"field",void 0);__decorate([n.Input(),__metadata("design:type",Object)],t.GenericEditorFieldComponent.prototype,"model",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorFieldComponent.prototype,"qualifier",void 0);__decorate([n.Input(),__metadata("design:type",String)],t.GenericEditorFieldComponent.prototype,"id",void 0);__decorate([n.ViewChild("widget",{read:n.ElementRef,static:false}),__metadata("design:type",n.ElementRef)],t.GenericEditorFieldComponent.prototype,"geWidget",void 0);t.GenericEditorFieldComponent=ms=__decorate([n.Component({selector:"se-generic-editor-field",providers:[{provide:E.NG_VALUE_ACCESSOR,useExisting:n.forwardRef((()=>ms)),multi:true}],template:`<div [attr.validation-id]="field.qualifier" class="ySEField"><ng-container *ngIf="field.component"><ng-container *ngComponentOutlet="field.component; injector: widgetInjector"></ng-container></ng-container><se-generic-editor-field-messages [field]="field" [qualifier]="qualifier"></se-generic-editor-field-messages><div *ngIf="field.postfix" class="ySEText ySEFieldPostfix">{{ field.postfix | translate }}</div></div>`}),__param(2,n.Inject(n.forwardRef((()=>t.GenericEditorComponent)))),__metadata("design:paramtypes",[n.ElementRef,n.Injector,t.GenericEditorComponent])],t.GenericEditorFieldComponent);window.__smartedit__.addDecoratorPayload("Component","GenericEditorFieldMessagesComponent",{selector:"se-generic-editor-field-messages",template:`<div *ngIf="errors?.length > 0" style="display: grid"><span *ngFor="let error of errors" class="se-generic-editor__error se-help-block--has-error help-block fd-form__message fd-form__message--error">{{ error | translate}}</span></div><div *ngIf="warnings?.length > 0" style="display: grid"><span *ngFor="let warning of warnings" class="se-generic-editor__warning se-help-block--has-warning help-block fd-form__message fd-form__message--warning">{{ warning | translate }}</span></div>`});let gs=class GenericEditorFieldMessagesComponent{constructor(){this.previousMessages=null}ngDoCheck(){if(this.field){const e=JSON.stringify(this.field.messages);if(this.previousMessages!==e){this.previousMessages=e;this.errors=this.getFilteredMessagesByType(ti.VALIDATION_ERROR);this.warnings=this.getFilteredMessagesByType(ti.WARNING)}}}getFilteredMessagesByType(e){return(this.field.messages||[]).filter((t=>t.marker===this.qualifier&&!t.format&&t.type===e)).map((e=>e.message))}};__decorate([n.Input(),__metadata("design:type",Object)],gs.prototype,"field",void 0);__decorate([n.Input(),__metadata("design:type",String)],gs.prototype,"qualifier",void 0);gs=__decorate([n.Component({selector:"se-generic-editor-field-messages",template:`<div *ngIf="errors?.length > 0" style="display: grid"><span *ngFor="let error of errors" class="se-generic-editor__error se-help-block--has-error help-block fd-form__message fd-form__message--error">{{ error | translate}}</span></div><div *ngIf="warnings?.length > 0" style="display: grid"><span *ngFor="let warning of warnings" class="se-generic-editor__warning se-help-block--has-warning help-block fd-form__message fd-form__message--warning">{{ warning | translate }}</span></div>`})],gs);window.__smartedit__.addDecoratorPayload("Component","GenericEditorFieldWrapperComponent",{selector:"se-generic-editor-field-wrapper",template:` <ng-template [formRenderer]="form"></ng-template> `});let us=class GenericEditorFieldWrapperComponent{constructor({model:e,tabId:t,tab:i}){this.form=e.controls[t];this._subscription=this.form.statusChanges.subscribe((e=>{i.hasErrors=e==="INVALID"}))}ngOnDestroy(){this._subscription.unsubscribe()}};us=__decorate([n.Component({selector:"se-generic-editor-field-wrapper",template:` <ng-template [formRenderer]="form"></ng-template> `}),__param(0,n.Inject(sn)),__metadata("design:paramtypes",[Object])],us);window.__smartedit__.addDecoratorPayload("Component","LocalizedElementComponent",{selector:"se-localized-element",styles:[`\n            :host {\n                display: block;\n            }\n        `],template:`<se-tabs *ngIf="tabs" class="multi-tabs-editor" [model]="form" [tabsList]="tabs" [numTabsDisplayed]="6"></se-tabs>`});let hs=class LocalizedElementComponent{constructor(e){this.sessionService=e}onDynamicInputChange(){this._createLocalizedTabs()}ngDoCheck(){if(this.tabs&&this.field.messages!==this._previousMessages){this._previousMessages=this.field.messages;const e=this.field.messages?this.field.messages.filter((e=>e.type===ti.VALIDATION_ERROR)).reduce(((e,t)=>{e[t.language]=true;return e}),{}):{};this.tabs=this.tabs.map((function(t){const i=e[t.id];t.hasErrors=i!==undefined?i:false;return t}))}}_createLocalizedTabs(){return __awaiter(this,void 0,void 0,(function*(){this.field.isLanguageEnabledMap={};const{readableLanguages:e,writeableLanguages:t}=yield this.sessionService.getCurrentUser();const i=new Set(e);const o=new Set(t);this.tabs=this.languages.filter((e=>i.has(e.isocode))).map((({isocode:e,required:t})=>{this.field.isLanguageEnabledMap[e]=o.has(e);const i=`${e.toUpperCase()}${this.field.editable&&this.field.required&&t?"*":""}`;return{title:i,id:e,component:us}}))}))}};__decorate([r.DynamicForm(),__metadata("design:type",r.FormGrouping)],hs.prototype,"form",void 0);__decorate([r.DynamicInput(),__metadata("design:type",Object)],hs.prototype,"field",void 0);__decorate([r.DynamicInput(),__metadata("design:type",Object)],hs.prototype,"component",void 0);__decorate([r.DynamicInput(),__metadata("design:type",Array)],hs.prototype,"languages",void 0);hs=__decorate([n.Component({selector:"se-localized-element",styles:[`\n            :host {\n                display: block;\n            }\n        `],template:`<se-tabs *ngIf="tabs" class="multi-tabs-editor" [model]="form" [tabsList]="tabs" [numTabsDisplayed]="6"></se-tabs>`}),__metadata("design:paramtypes",[r.ISessionService])],hs);window.__smartedit__.addDecoratorPayload("Component","GenericEditorRootTabsComponent",{selector:"se-ge-root-tabs",styles:[`\n            :host {\n                display: block;\n            }\n        `],template:`\n        <se-tabs\n            class="se-generic-editor__tabs"\n            [model]="form"\n            [tabsList]="tabs"\n            [numTabsDisplayed]="3"></se-tabs>\n    `});let _s=class GenericEditorRootTabsComponent{};__decorate([r.DynamicForm(),__metadata("design:type",r.FormGrouping)],_s.prototype,"form",void 0);__decorate([r.DynamicInput(),__metadata("design:type",Array)],_s.prototype,"tabs",void 0);_s=__decorate([n.Component({selector:"se-ge-root-tabs",styles:[`\n            :host {\n                display: block;\n            }\n        `],template:`\n        <se-tabs\n            class="se-generic-editor__tabs"\n            [model]="form"\n            [tabsList]="tabs"\n            [numTabsDisplayed]="3"></se-tabs>\n    `})],_s);let vs=class SubmitBtnDirective{constructor(e){this.cm=e}get disabled(){return this.cm.submitting||this.isDisabled&&this.isDisabled()}save(e){e.preventDefault();this.cm.save().subscribe()}};__decorate([n.Input("seSubmitBtn"),__metadata("design:type",Function)],vs.prototype,"isDisabled",void 0);__decorate([n.HostBinding("disabled"),__metadata("design:type",Boolean),__metadata("design:paramtypes",[])],vs.prototype,"disabled",null);__decorate([n.HostListener("click",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Event]),__metadata("design:returntype",void 0)],vs.prototype,"save",null);vs=__decorate([n.Directive({selector:"[seSubmitBtn]"}),__metadata("design:paramtypes",[On])],vs);t.GenericEditorWidgetModule=class GenericEditorWidgetModule{};t.GenericEditorWidgetModule=__decorate([n.NgModule({imports:[g.CommonModule,kn,t.BooleanModule,r.TranslationModule.forChild(),E.FormsModule,t.RichTextFieldModule,t.SelectModule,Yn,t.NumberModule,Hn,jn,H.FormModule],declarations:[t.ShortStringComponent,Zn,$n,Wn,Fn,Nn,Jn],entryComponents:[t.ShortStringComponent,Zn,$n,Wn,Fn,Nn,Jn]})],t.GenericEditorWidgetModule);t.SeGenericEditorModule=class SeGenericEditorModule{};t.SeGenericEditorModule=__decorate([n.NgModule({schemas:[n.CUSTOM_ELEMENTS_SCHEMA],imports:[g.CommonModule,t.YjqueryModule,E.FormsModule,E.ReactiveFormsModule,t.FundamentalsModule,t.SharedComponentsModule,t.GenericEditorWidgetModule,t.SelectModule,t.GenericEditorDropdownModule,r.TranslationModule.forChild(),r.FormBuilderModule.forRoot({validators:{required:()=>E.Validators.required,email:()=>E.Validators.email,notBlank:()=>isBlankValidator()},types:{tabs:_s,localized:hs,field:ss}})],providers:[t.GenericEditorFactoryService,t.EditorFieldMappingService,t.FetchEnumDataHandler,t.GenericEditorStackService,t.GenericEditorTabService,t.SeValidationMessageParser,ds],declarations:[ss,t.GenericEditorComponent,as,hs,t.GenericEditorFieldComponent,gs,us,t.GenericEditorBreadcrumbComponent,ps,On,_s,vs],entryComponents:[t.GenericEditorComponent,as,hs,t.GenericEditorFieldComponent,gs,us,t.GenericEditorBreadcrumbComponent],exports:[t.GenericEditorComponent,t.GenericEditorWidgetModule,t.GenericEditorDropdownModule]})],t.SeGenericEditorModule);t.GenericEditorMediaType=void 0;(function(e){e["VIDEO"]="video";e["IMAGE"]="image";e["PDF_DOCUMENT"]="pdf";e["DEFAULT"]=""})(t.GenericEditorMediaType||(t.GenericEditorMediaType={}));window.__smartedit__.addDecoratorPayload("Component","HeaderLanguageDropdownComponent",{selector:"header-language-dropdown",template:`\n        <ul role="menu" class="fd-menu__list se-language-selector">\n            <li *ngIf="selectedLanguage" class="fd-menu__item">\n                <a\n                    class="yToolbarActions__dropdown-element se-language-selector__element--selected fd-menu__link">\n                    <span class="fd-menu__title"> {{ selectedLanguage.name }} </span>\n                </a>\n            </li>\n            <ng-container *ngFor="let language of items">\n                <li\n                    *ngIf="selectedLanguage.isoCode !== language.value.isoCode"\n                    class="fd-menu__item">\n                    <a\n                        class="yToolbarActions__dropdown-element se-language-selector__element fd-menu__link"\n                        (click)="onSelectedLanguage(language)">\n                        <span class="fd-menu__title"> {{ language.value.name }} </span>\n                    </a>\n                </li>\n            </ng-container>\n        </ul>\n    `});t.HeaderLanguageDropdownComponent=class HeaderLanguageDropdownComponent extends r.LanguageDropdown{constructor(e,t,i){super(e,t,i);this.languageService=e;this.crossFrameEventService=t;this.logService=i;this.languageSortStrategy="none"}};t.HeaderLanguageDropdownComponent=__decorate([n.Component({selector:"header-language-dropdown",template:`\n        <ul role="menu" class="fd-menu__list se-language-selector">\n            <li *ngIf="selectedLanguage" class="fd-menu__item">\n                <a\n                    class="yToolbarActions__dropdown-element se-language-selector__element--selected fd-menu__link">\n                    <span class="fd-menu__title"> {{ selectedLanguage.name }} </span>\n                </a>\n            </li>\n            <ng-container *ngFor="let language of items">\n                <li\n                    *ngIf="selectedLanguage.isoCode !== language.value.isoCode"\n                    class="fd-menu__item">\n                    <a\n                        class="yToolbarActions__dropdown-element se-language-selector__element fd-menu__link"\n                        (click)="onSelectedLanguage(language)">\n                        <span class="fd-menu__title"> {{ language.value.name }} </span>\n                    </a>\n                </li>\n            </ng-container>\n        </ul>\n    `}),__metadata("design:paramtypes",[t.LanguageService,t.CrossFrameEventService,r.LogService])],t.HeaderLanguageDropdownComponent);window.__smartedit__.addDecoratorPayload("Component","ConfirmDialogComponent",{selector:"se-confirm-dialog",template:`<ng-container *ngIf="config"><se-message *ngIf="config.message" [type]="config.message.type" [messageId]="config.message.id"><ng-container se-message-description><span [translate]="config.message.text"></span></ng-container></se-message><div id="confirmationModalDescription" [ngClass]="{ 'fd-has-margin-top-small' : config.message }" [translate]="config.description" [translateParams]="config.descriptionPlaceholders"></div></ng-container>`});t.ConfirmDialogComponent=class ConfirmDialogComponent{constructor(e){this.modalManager=e}ngOnInit(){this.modalManager.getModalData().pipe(v.take(1)).subscribe((e=>this.config=e))}};t.ConfirmDialogComponent=__decorate([n.Component({selector:"se-confirm-dialog",template:`<ng-container *ngIf="config"><se-message *ngIf="config.message" [type]="config.message.type" [messageId]="config.message.id"><ng-container se-message-description><span [translate]="config.message.text"></span></ng-container></se-message><div id="confirmationModalDescription" [ngClass]="{ 'fd-has-margin-top-small' : config.message }" [translate]="config.description" [translateParams]="config.descriptionPlaceholders"></div></ng-container>`}),__metadata("design:paramtypes",[r.ModalManagerService])],t.ConfirmDialogComponent);t.ConfirmDialogModule=class ConfirmDialogModule{};t.ConfirmDialogModule=__decorate([n.NgModule({imports:[g.CommonModule,r.TranslationModule.forChild(),t.MessageModule],declarations:[t.ConfirmDialogComponent],entryComponents:[t.ConfirmDialogComponent]})],t.ConfirmDialogModule);const fs=new n.InjectionToken("CLIENT_PAGED_LIST_CELL_COMPONENT_DATA_TOKEN");window.__smartedit__.addDecoratorPayload("Component","ClientPagedListCellComponent",{selector:"se-client-paged-list-cell",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<ng-container *ngIf="key.component; else cellText"><ng-container *ngComponentOutlet="key.component; injector: componentInjector"></ng-container></ng-container><ng-template #cellText><span>{{ item[key.property] }}</span></ng-template>`});let ys=class ClientPagedListCellComponent{constructor(e){this.injector=e}ngOnInit(){this.createComponentInjector()}createComponentInjector(){this.componentInjector=n.Injector.create({parent:this.injector,providers:[{provide:fs,useValue:{item:this.item,key:this.key}}]})}};__decorate([n.Input(),__metadata("design:type",Object)],ys.prototype,"item",void 0);__decorate([n.Input(),__metadata("design:type",Object)],ys.prototype,"key",void 0);ys=__decorate([n.Component({selector:"se-client-paged-list-cell",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<ng-container *ngIf="key.component; else cellText"><ng-container *ngComponentOutlet="key.component; injector: componentInjector"></ng-container></ng-container><ng-template #cellText><span>{{ item[key.property] }}</span></ng-template>`}),__metadata("design:paramtypes",[n.Injector])],ys);window.__smartedit__.addDecoratorPayload("Component","ClientPagedListComponent",{selector:"se-client-paged-list",changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[t.FilterByFieldPipe,t.StartFromPipe,g.SlicePipe],template:`<div class="fluid-container se-paged-list-result"><p class="se-page-list__page-count" *ngIf="displayCount"><span>({{ totalItems }} {{ 'se.pagelist.countsearchresult' | translate }})</span></p><table class="se-paged-list-table table table-striped table-hover fd-table"><thead><tr><th *ngFor="let key of keys; trackBy: keysTrackBy" (click)="onOrderByColumn(key.property)" [ngStyle]="{ 'width': columnWidth + '%' }" class="se-paged-list__header" [ngClass]="'se-paged-list__header-' + key.property"><ng-container *ngIf="key.i18n">{{ key.i18n | translate }} <span class="header-icon" [hidden]="visibleSortingHeader !== key.property" [ngClass]="{\n                          'sap-icon--navigation-down-arrow': headersSortingState[key.property],\n                          'sap-icon--navigation-up-arrow': !headersSortingState[key.property]\n                      }"></span></ng-container></th><th class="se-paged-list__header"></th><th class="se-paged-list__header" *ngIf="dropdownItems"></th></tr></thead><tbody class="se-paged-list__table-body"><tr *ngFor="let item of filteredItems" class="se-paged-list-item"><td *ngFor="let key of keys" [ngClass]="'se-paged-list-item-' + key.property"><se-client-paged-list-cell [item]="item" [key]="key"></se-client-paged-list-cell></td><td><se-tooltip *ngIf="item.icon" [triggers]="['mouseenter', 'mouseleave']" [placement]="'bottom'" [title]="'se.icon.tooltip.visibility' | translate: { numberOfRestrictions: item.icon.numberOfRestrictions }" [isChevronVisible]="true"><img [src]="item.icon.src" se-tooltip-trigger/></se-tooltip></td><ng-container *ngIf="dropdownItems"><td *seHasOperationPermission="'se.edit.page'" class="paged-list-table__body__td paged-list-table__body__td-menu"><se-dropdown-menu [dropdownItems]="dropdownItems" [selectedItem]="item" class="pull-right"></se-dropdown-menu></td></ng-container></tr></tbody></table><div class="pagination-container"><se-pagination [totalItems]="totalItems < itemsPerPage ? itemsPerPage : totalItems" [itemsPerPage]="itemsPerPage" (onChange)="onCurrentPageChange($event)" [currentPage]="currentPage"></se-pagination></div></div>`});let Ss=class ClientPagedListComponent{constructor(e,t,i,o){this.cdr=e;this.filterByFieldPipe=t;this.startFromPipe=i;this.slicePipe=o;this.reversed=false;this.displayCount=false;this.totalItems=0;this.currentPage=1;this.headersSortingState={}}ngOnChanges(e){if(e.items||e.query||e.itemFilterKeys||e.itemsPerPage){if(e.query){this.currentPage=1}this.filteredItems=this.filterItems();this.totalItems=e.query&&e.query.currentValue?this.filteredItems.length:this.items.length}if(e.keys){this.columnWidth=100/(this.keys.length||1)}if(e.reversed){this.columnToggleReversed=this.reversed}if(e.sortBy){this.headersSortingState=Object.assign(Object.assign({},this.headersSortingState),{[this.sortBy]:this.columnToggleReversed});this.visibleSortingHeader=this.sortBy;this.items=Ji.sortBy(this.items,this.sortBy,this.columnToggleReversed);this.filteredItems=this.filterItems()}}keysTrackBy(e,t){return t.property}onOrderByColumn(e){this.columnToggleReversed=!this.columnToggleReversed;this.headersSortingState[e]=this.columnToggleReversed;this.visibleSortingHeader=e;this.items=Ji.sortBy(this.items,e,this.columnToggleReversed);this.filteredItems=this.filterItems();if(!this.cdr.destroyed){this.cdr.detectChanges()}}onCurrentPageChange(e){this.currentPage=e;this.filteredItems=this.filterItems();if(!this.cdr.destroyed){this.cdr.detectChanges()}}filterItems(){const e=this.itemFilterKeys||[];const t=this.filterByFieldPipe.transform(this.items,this.query,e);const i=(this.currentPage-1)*this.itemsPerPage;const o=this.startFromPipe.transform(t,i);const n=this.slicePipe.transform(o,0,this.itemsPerPage);return n}};__decorate([n.Input(),__metadata("design:type",Array)],Ss.prototype,"items",void 0);__decorate([n.Input(),__metadata("design:type",Array)],Ss.prototype,"itemFilterKeys",void 0);__decorate([n.Input(),__metadata("design:type",Array)],Ss.prototype,"keys",void 0);__decorate([n.Input(),__metadata("design:type",Number)],Ss.prototype,"itemsPerPage",void 0);__decorate([n.Input(),__metadata("design:type",String)],Ss.prototype,"sortBy",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Ss.prototype,"reversed",void 0);__decorate([n.Input(),__metadata("design:type",String)],Ss.prototype,"query",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Ss.prototype,"displayCount",void 0);__decorate([n.Input(),__metadata("design:type",Array)],Ss.prototype,"dropdownItems",void 0);Ss=__decorate([n.Component({selector:"se-client-paged-list",changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[t.FilterByFieldPipe,t.StartFromPipe,g.SlicePipe],template:`<div class="fluid-container se-paged-list-result"><p class="se-page-list__page-count" *ngIf="displayCount"><span>({{ totalItems }} {{ 'se.pagelist.countsearchresult' | translate }})</span></p><table class="se-paged-list-table table table-striped table-hover fd-table"><thead><tr><th *ngFor="let key of keys; trackBy: keysTrackBy" (click)="onOrderByColumn(key.property)" [ngStyle]="{ 'width': columnWidth + '%' }" class="se-paged-list__header" [ngClass]="'se-paged-list__header-' + key.property"><ng-container *ngIf="key.i18n">{{ key.i18n | translate }} <span class="header-icon" [hidden]="visibleSortingHeader !== key.property" [ngClass]="{\n                          'sap-icon--navigation-down-arrow': headersSortingState[key.property],\n                          'sap-icon--navigation-up-arrow': !headersSortingState[key.property]\n                      }"></span></ng-container></th><th class="se-paged-list__header"></th><th class="se-paged-list__header" *ngIf="dropdownItems"></th></tr></thead><tbody class="se-paged-list__table-body"><tr *ngFor="let item of filteredItems" class="se-paged-list-item"><td *ngFor="let key of keys" [ngClass]="'se-paged-list-item-' + key.property"><se-client-paged-list-cell [item]="item" [key]="key"></se-client-paged-list-cell></td><td><se-tooltip *ngIf="item.icon" [triggers]="['mouseenter', 'mouseleave']" [placement]="'bottom'" [title]="'se.icon.tooltip.visibility' | translate: { numberOfRestrictions: item.icon.numberOfRestrictions }" [isChevronVisible]="true"><img [src]="item.icon.src" se-tooltip-trigger/></se-tooltip></td><ng-container *ngIf="dropdownItems"><td *seHasOperationPermission="'se.edit.page'" class="paged-list-table__body__td paged-list-table__body__td-menu"><se-dropdown-menu [dropdownItems]="dropdownItems" [selectedItem]="item" class="pull-right"></se-dropdown-menu></td></ng-container></tr></tbody></table><div class="pagination-container"><se-pagination [totalItems]="totalItems < itemsPerPage ? itemsPerPage : totalItems" [itemsPerPage]="itemsPerPage" (onChange)="onCurrentPageChange($event)" [currentPage]="currentPage"></se-pagination></div></div>`}),__metadata("design:paramtypes",[n.ChangeDetectorRef,t.FilterByFieldPipe,t.StartFromPipe,g.SlicePipe])],Ss);t.ClientPagedListModule=class ClientPagedListModule{};t.ClientPagedListModule=__decorate([n.NgModule({imports:[g.CommonModule,t.PaginationModule,t.FundamentalsModule,t.TooltipModule,t.DropdownMenuModule,t.HasOperationPermissionDirectiveModule,t.FilterByFieldPipeModule,t.StartFromPipeModule,r.TranslationModule.forChild()],entryComponents:[Ss],declarations:[Ss,ys],exports:[Ss]})],t.ClientPagedListModule);const Cs=new n.InjectionToken("MEDIA_FILE_SELECTOR_CUSTOM_TOKEN");const bs=new n.InjectionToken("MEDIA_FILE_SELECTOR_CUSTOM_INJECTOR_TOKEN");const Is={UPLOAD:"se.media.format.upload",REPLACE:"se.media.format.replace",UNDER_EDIT:"se.media.format.under.edit",REMOVE:"se.media.format.remove"};const Es=new n.InjectionToken("MEDIA_SELECTOR_I18N_KEY_TOKEN");const ws=new n.InjectionToken("MEDIA_UPLOAD_FIELDS_CUSTOM_TOKEN");const Ts=new n.InjectionToken("MEDIA_ADVANCED_PROPERTIES_CUSTOM_TOKEN");let Ps=class ExperienceInterceptor{constructor(e,t,i){this.sharedDataService=e;this.stringUtils=t;this.httpUtils=i}intercept(e,t){if(!Ue.test(e.url)){return t.handle(e)}return m.from(this.sharedDataService.get(Mi)).pipe(v.switchMap((i=>{if(!i){return t.handle(e)}const o={};o.CONTEXT_SITE_ID_WITH_COLON=i.siteDescriptor.uid;o.CONTEXT_CATALOG_VERSION_WITH_COLON=i.catalogDescriptor.catalogVersion;o.CONTEXT_CATALOG_WITH_COLON=i.catalogDescriptor.catalogId;o[Se]=i.siteDescriptor.uid;o[ye]=i.catalogDescriptor.catalogVersion;o[fe]=i.catalogDescriptor.catalogId;o[Ie]=i.pageContext?i.pageContext.siteId:i.siteDescriptor.uid;o[be]=i.pageContext?i.pageContext.catalogVersion:i.catalogDescriptor.catalogVersion;o[Ce]=i.pageContext?i.pageContext.catalogId:i.catalogDescriptor.catalogId;const n=e.clone({url:this.stringUtils.replaceAll(e.url,o),params:e.params&&typeof e.params==="object"?this.httpUtils.transformHttpParams(e.params,o):e.params});return t.handle(n)})))}};Ps=__decorate([n.Injectable(),__metadata("design:paramtypes",[r.ISharedDataService,r.StringUtils,r.HttpUtils])],Ps);t.SmarteditConstantsModule=class SmarteditConstantsModule{};t.SmarteditConstantsModule=__decorate([n.NgModule({providers:[{provide:oo,useValue:ve},{provide:no,useValue:Ti}]})],t.SmarteditConstantsModule);const Os=new n.InjectionToken("gatewayProxiedAnnotationFactoryToKen");const As=new n.InjectionToken("cachedAnnotationFactoryToken");const xs=new n.InjectionToken("cacheConfigAnnotationFactoryToken");const Ds=new n.InjectionToken("invalidateCacheAnnotationFactoryToken");const Rs=new n.InjectionToken("operationContextAnnotationFactoryToken");t.SmarteditCommonsModule=class SmarteditCommonsModule{};t.SmarteditCommonsModule=__decorate([n.NgModule({imports:[t.FundamentalsModule,$.LocationUpgradeModule.config(),t.YjqueryModule,t.SeGenericEditorModule,t.WizardModule,t.SmarteditConstantsModule],providers:[t.SmarteditBootstrapGateway,t.LanguageServiceGateway,t.LanguageService,{provide:r.LANGUAGE_SERVICE,useClass:t.LanguageService},{provide:ISlotRestrictionsService,useClass:t.SlotRestrictionsService},{provide:IEditorModalService,useClass:t.EditorModalService},{provide:IPageInfoService,useClass:PageInfoService},{provide:IFileValidation,useClass:t.FileValidationService},{provide:IMediaToUpload,useClass:t.MediaUploaderService},{provide:IMediaService,useClass:t.MediaService},t.TimerService,t.DiscardablePromiseUtils,se.provideValues({SSO_LOGOUT_ENTRY_POINT:Le,SSO_AUTHENTICATION_ENTRY_POINT:Fe,SSO_OAUTH2_AUTHENTICATION_ENTRY_POINT:ze,SMARTEDIT_RESOURCE_URI_REGEXP:Be,SMARTEDIT_ROOT:je,SMARTEDIT_INNER_FILES:Oi,SMARTEDIT_INNER_FILES_POST:Ai,[r.OPERATION_CONTEXT_TOKEN]:Re,[r.WHO_AM_I_RESOURCE_URI_TOKEN]:ke,[r.I18N_RESOURCE_URI_TOKEN]:Me}),{provide:d.HTTP_INTERCEPTORS,useClass:Ps,multi:true},{provide:ISyncPollingService,useClass:t.SyncPollingService},{provide:r.IModalService,useClass:r.ModalService},{provide:r.ISettingsService,useClass:t.SettingsService},t.SliderPanelServiceFactory,r.LogService,r.BrowserService,r.FingerPrintingService,r.CacheEngine,r.CacheService,r.CloneableUtils,t.CrossFrameEventService,{provide:r.LoginDialogResourceProvider,useValue:qe},{provide:r.LANGUAGE_SERVICE_CONSTANTS,useValue:{LANGUAGE_RESOURCE_URI:Bt,I18N_LANGUAGES_RESOURCE_URI:Kt}},{provide:r.EVENT_SERVICE,useFactory:e=>e,deps:[t.CrossFrameEventService]},{provide:t.CrossFrameEventServiceGateway.crossFrameEventServiceGatewayToken,useClass:t.CrossFrameEventServiceGateway},r.OperationContextService,r.BooleanUtils,r.CryptographicUtils,r.FunctionsUtils,r.HttpUtils,NodeUtils,r.PromiseUtils,t.JQueryUtilsService,{provide:r.StringUtils,useClass:StringUtils},StringUtils,r.UrlUtils,{provide:r.WindowUtils,useClass:t.WindowUtils},t.WindowUtils,t.SystemEventService,t.PriorityService,t.GatewayFactory,t.GatewayProxy,t.InterceptorHelper,{provide:Os,useFactory:GatewayProxiedAnnotationFactory,deps:[t.GatewayProxy]},{provide:As,useFactory:r.CachedAnnotationFactory,deps:[r.CacheService]},{provide:xs,useFactory:r.CacheConfigAnnotationFactory,deps:[r.LogService]},{provide:Ds,useFactory:r.InvalidateCacheAnnotationFactory,deps:[r.CacheService]},{provide:Rs,useFactory:r.OperationContextAnnotationFactory,deps:[n.Injector,r.OperationContextService,r.OPERATION_CONTEXT_TOKEN]},r.RestServiceFactory,t.PermissionsRestService,t.AuthorizationService,r.FileMimeTypeService,r.FileReaderService,r.FileValidatorFactory,r.ModalService,t.WorkflowService,t.WorkflowTasksPollingService,t.CmsitemsRestService,t.PageVersioningService,t.PageVersionSelectionService,t.CMSModesService,t.PageContentSlotsService,t.SlotSharedService,t.ComponentMenuService,{provide:"seFileValidationServiceConstants",useValue:tn},se.initialize(((e,t,i,o,n)=>{}),[Os,As,xs,Ds,Rs]),se.bootstrap(((e,t,i,o,n)=>{e.register(r.booleanUtils.areAllTruthy(operationContextInteractivePredicate,r.retriableErrorPredicate),t).register(r.booleanUtils.areAllTruthy(operationContextNonInteractivePredicate,r.retriableErrorPredicate),i).register(r.booleanUtils.areAllTruthy(operationContextCMSPredicate,r.timeoutErrorPredicate,r.updatePredicate),i).register(r.booleanUtils.areAllTruthy(operationContextToolingPredicate,r.timeoutErrorPredicate,r.updatePredicate),o);n.register(Bt,Re.TOOLING)}),[r.RetryInterceptor,r.DefaultRetryStrategy,r.ExponentialRetryStrategy,r.LinearRetryStrategy,r.OperationContextService,r.LogService])]})],t.SmarteditCommonsModule);Object.defineProperty(t,"ALERT_CONFIG_DEFAULTS",{enumerable:true,get:function(){return r.ALERT_CONFIG_DEFAULTS}});Object.defineProperty(t,"ALERT_CONFIG_DEFAULTS_TOKEN",{enumerable:true,get:function(){return r.ALERT_CONFIG_DEFAULTS_TOKEN}});Object.defineProperty(t,"AbstractCachedRestService",{enumerable:true,get:function(){return r.AbstractCachedRestService}});Object.defineProperty(t,"Alert",{enumerable:true,get:function(){return r.Alert}});Object.defineProperty(t,"AlertModule",{enumerable:true,get:function(){return r.AlertModule}});Object.defineProperty(t,"AuthenticationService",{enumerable:true,get:function(){return r.AuthenticationService}});Object.defineProperty(t,"BaseAlertFactory",{enumerable:true,get:function(){return r.AlertFactory}});Object.defineProperty(t,"BaseAlertService",{enumerable:true,get:function(){return r.AlertService}});Object.defineProperty(t,"BrowserService",{enumerable:true,get:function(){return r.BrowserService}});Object.defineProperty(t,"CacheAction",{enumerable:true,get:function(){return r.CacheAction}});Object.defineProperty(t,"CacheConfig",{enumerable:true,get:function(){return r.CacheConfig}});Object.defineProperty(t,"CacheConfigAnnotationFactory",{enumerable:true,get:function(){return r.CacheConfigAnnotationFactory}});Object.defineProperty(t,"CacheService",{enumerable:true,get:function(){return r.CacheService}});Object.defineProperty(t,"Cached",{enumerable:true,get:function(){return r.Cached}});Object.defineProperty(t,"CachedAnnotationFactory",{enumerable:true,get:function(){return r.CachedAnnotationFactory}});Object.defineProperty(t,"CloneableUtils",{enumerable:true,get:function(){return r.CloneableUtils}});Object.defineProperty(t,"CryptographicUtils",{enumerable:true,get:function(){return r.CryptographicUtils}});Object.defineProperty(t,"DEFAULT_AUTHENTICATION_ENTRY_POINT",{enumerable:true,get:function(){return r.DEFAULT_AUTHENTICATION_ENTRY_POINT}});Object.defineProperty(t,"DEFAULT_AUTH_MAP",{enumerable:true,get:function(){return r.DEFAULT_AUTH_MAP}});Object.defineProperty(t,"DEFAULT_CREDENTIALS_MAP",{enumerable:true,get:function(){return r.DEFAULT_CREDENTIALS_MAP}});Object.defineProperty(t,"DEFAULT_LANGUAGE_ISO",{enumerable:true,get:function(){return r.DEFAULT_LANGUAGE_ISO}});Object.defineProperty(t,"EVENTS",{enumerable:true,get:function(){return r.EVENTS}});Object.defineProperty(t,"EVENT_SERVICE",{enumerable:true,get:function(){return r.EVENT_SERVICE}});Object.defineProperty(t,"EvictionTag",{enumerable:true,get:function(){return r.EvictionTag}});Object.defineProperty(t,"FileMimeTypeService",{enumerable:true,get:function(){return r.FileMimeTypeService}});Object.defineProperty(t,"FileReaderService",{enumerable:true,get:function(){return r.FileReaderService}});Object.defineProperty(t,"FileValidatorFactory",{enumerable:true,get:function(){return r.FileValidatorFactory}});Object.defineProperty(t,"FingerPrintingService",{enumerable:true,get:function(){return r.FingerPrintingService}});Object.defineProperty(t,"FunctionsUtils",{enumerable:true,get:function(){return r.FunctionsUtils}});Object.defineProperty(t,"FundamentalModalTemplateModule",{enumerable:true,get:function(){return r.FundamentalModalTemplateModule}});Object.defineProperty(t,"HttpBackendService",{enumerable:true,get:function(){return r.HttpBackendService}});Object.defineProperty(t,"HttpErrorInterceptorService",{enumerable:true,get:function(){return r.HttpErrorInterceptorService}});Object.defineProperty(t,"HttpInterceptorModule",{enumerable:true,get:function(){return r.HttpInterceptorModule}});Object.defineProperty(t,"HttpUtils",{enumerable:true,get:function(){return r.HttpUtils}});Object.defineProperty(t,"I18N_RESOURCE_URI_TOKEN",{enumerable:true,get:function(){return r.I18N_RESOURCE_URI_TOKEN}});Object.defineProperty(t,"I18N_ROOT_RESOURCE_URI",{enumerable:true,get:function(){return r.I18N_ROOT_RESOURCE_URI}});Object.defineProperty(t,"IAlertService",{enumerable:true,get:function(){return r.IAlertService}});Object.defineProperty(t,"IAlertServiceType",{enumerable:true,get:function(){return r.IAlertServiceType}});Object.defineProperty(t,"IAuthenticationManagerService",{enumerable:true,get:function(){return r.IAuthenticationManagerService}});Object.defineProperty(t,"IAuthenticationService",{enumerable:true,get:function(){return r.IAuthenticationService}});Object.defineProperty(t,"IBrowserService",{enumerable:true,get:function(){return r.BrowserService}});Object.defineProperty(t,"IModalService",{enumerable:true,get:function(){return r.IModalService}});Object.defineProperty(t,"ISessionService",{enumerable:true,get:function(){return r.ISessionService}});Object.defineProperty(t,"ISettingsService",{enumerable:true,get:function(){return r.ISettingsService}});Object.defineProperty(t,"ISharedDataService",{enumerable:true,get:function(){return r.ISharedDataService}});Object.defineProperty(t,"IStorageService",{enumerable:true,get:function(){return r.IStorageService}});Object.defineProperty(t,"ITranslationsFetchService",{enumerable:true,get:function(){return r.ITranslationsFetchService}});Object.defineProperty(t,"InvalidateCache",{enumerable:true,get:function(){return r.InvalidateCache}});Object.defineProperty(t,"InvalidateCacheAnnotationFactory",{enumerable:true,get:function(){return r.InvalidateCacheAnnotationFactory}});Object.defineProperty(t,"LANDING_PAGE_PATH",{enumerable:true,get:function(){return r.LANDING_PAGE_PATH}});Object.defineProperty(t,"LogService",{enumerable:true,get:function(){return r.LogService}});Object.defineProperty(t,"ModalButtonAction",{enumerable:true,get:function(){return r.ModalButtonAction}});Object.defineProperty(t,"ModalButtonStyle",{enumerable:true,get:function(){return r.ModalButtonStyle}});Object.defineProperty(t,"ModalManagerService",{enumerable:true,get:function(){return r.ModalManagerService}});Object.defineProperty(t,"ModalService",{enumerable:true,get:function(){return r.ModalService}});Object.defineProperty(t,"OPERATION_CONTEXT_TOKEN",{enumerable:true,get:function(){return r.OPERATION_CONTEXT_TOKEN}});Object.defineProperty(t,"OperationContextAnnotationFactory",{enumerable:true,get:function(){return r.OperationContextAnnotationFactory}});Object.defineProperty(t,"OperationContextRegistered",{enumerable:true,get:function(){return r.OperationContextRegistered}});Object.defineProperty(t,"OperationContextService",{enumerable:true,get:function(){return r.OperationContextService}});Object.defineProperty(t,"ParentWindowUtils",{enumerable:true,get:function(){return r.WindowUtils}});Object.defineProperty(t,"PermissionErrorInterceptor",{enumerable:true,get:function(){return r.PermissionErrorInterceptor}});Object.defineProperty(t,"PromiseUtils",{enumerable:true,get:function(){return r.PromiseUtils}});Object.defineProperty(t,"ResponseAdapterInterceptor",{enumerable:true,get:function(){return r.ResponseAdapterInterceptor}});Object.defineProperty(t,"RestServiceFactory",{enumerable:true,get:function(){return r.RestServiceFactory}});Object.defineProperty(t,"RetryInterceptor",{enumerable:true,get:function(){return r.RetryInterceptor}});Object.defineProperty(t,"SELECTED_LANGUAGE",{enumerable:true,get:function(){return r.SELECTED_LANGUAGE}});Object.defineProperty(t,"SSOAuthenticationHelper",{enumerable:true,get:function(){return r.SSOAuthenticationHelper}});Object.defineProperty(t,"SWITCH_LANGUAGE_EVENT",{enumerable:true,get:function(){return r.SWITCH_LANGUAGE_EVENT}});Object.defineProperty(t,"SeTranslationModule",{enumerable:true,get:function(){return r.TranslationModule}});Object.defineProperty(t,"TranslationModule",{enumerable:true,get:function(){return r.TranslationModule}});Object.defineProperty(t,"URIBuilder",{enumerable:true,get:function(){return r.URIBuilder}});Object.defineProperty(t,"UnauthorizedErrorInterceptor",{enumerable:true,get:function(){return r.UnauthorizedErrorInterceptor}});Object.defineProperty(t,"UrlUtils",{enumerable:true,get:function(){return r.UrlUtils}});Object.defineProperty(t,"WHO_AM_I_RESOURCE_URI_TOKEN",{enumerable:true,get:function(){return r.WHO_AM_I_RESOURCE_URI_TOKEN}});Object.defineProperty(t,"annotationService",{enumerable:true,get:function(){return r.annotationService}});Object.defineProperty(t,"booleanUtils",{enumerable:true,get:function(){return r.booleanUtils}});Object.defineProperty(t,"commonNgZone",{enumerable:true,get:function(){return r.commonNgZone}});Object.defineProperty(t,"functionsUtils",{enumerable:true,get:function(){return r.functionsUtils}});Object.defineProperty(t,"httpUtils",{enumerable:true,get:function(){return r.httpUtils}});Object.defineProperty(t,"promiseUtils",{enumerable:true,get:function(){return r.promiseUtils}});Object.defineProperty(t,"urlUtils",{enumerable:true,get:function(){return r.urlUtils}});t.ALL_ACTIVE_THEMES_URI=Zi;t.ALL_PERSPECTIVE=fi;t.ANNOUNCEMENT_DATA=ao;t.AbstractDecorator=AbstractDecorator;t.ApiUtils=ApiUtils;t.CATALOG_DETAILS_COLUMNS=ci;t.CATALOG_DETAILS_ITEM_DATA=jo;t.CATALOG_VERSION_PERMISSIONS_RESOURCE_URI_CONSTANT=De;t.CATALOG_VERSION_UUID_ATTRIBUTE=ct;t.CLICK_DROPDOWN=si;t.CLICK_DROPDOWN_TOKEN=Un;t.CLIENT_PAGED_LIST_CELL_COMPONENT_DATA_TOKEN=fs;t.CLOSE_CTX_MENU=Oe;t.CMSITEMS_UPDATE_EVENT=zi;t.CMSWEBSERVICES_PATH=Ue;t.CMS_EVENT_OPEN_PAGE_WORKFLOW_MENU=Fi;t.COLLAPSIBLE_DEFAULT_CONFIGURATION=nn;t.COMPONENT_CLASS=dt;t.CONFIGURATION_URI=Ge;t.CONTAINER_ID_ATTRIBUTE=pt;t.CONTAINER_TYPE_ATTRIBUTE=xt;t.CONTENT_SLOT_TYPE=wt;t.CONTEXTUAL_MENU_ITEM_DATA=ie;t.CONTEXT_CATALOG=fe;t.CONTEXT_CATALOG_VERSION=ye;t.CONTEXT_SITE_ID=Se;t.CONTRACT_CHANGE_LISTENER_COMPONENT_PROCESS_STATUS=gt;t.CONTRACT_CHANGE_LISTENER_PROCESS_EVENTS=ut;t.CSS_CLASSNAMES=fn;t.CTX_MENU_DROPDOWN_IS_OPEN=Ae;t.CURRENT_USER_THEME_URI=Yi;t.CustomDropdownPopulatorsToken=Bn;t.CustomHandlingStrategy=CustomHandlingStrategy;t.DATA_TABLE_COMPONENT_DATA=rn;t.DATE_CONSTANTS=li;t.DEFAULT_AUTHENTICATION_CLIENT_ID=Ne;t.DEFAULT_GENERIC_EDITOR_FLOAT_PRECISION=ts;t.DEFAULT_LANGUAGE=Pe;t.DINameUtils=DINameUtils;t.DOMAIN_TOKEN=re;t.DO_NOT_USE_STORAGE_MANAGER_TOKEN=Bo;t.DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME=Ei;t.DROPDOWN_IMPLEMENTATION_SUFFIX=oi;t.DROPDOWN_IMPLEMENTATION_SUFFIX_TOKEN=Vn;t.DROPDOWN_MENU_ITEM_DATA=on;t.DROPDOWN_POPULATOR=ai;t.DateUtils=DateUtils;t.DropdownPopulatorInterface=DropdownPopulatorInterface;t.ELEMENT_UUID_ATTRIBUTE=pe;t.ENUM_RESOURCE_URI=ii;t.EVENT_CONTENT_CATALOG_UPDATE=Pi;t.EVENT_INNER_FRAME_CLICKED=lt;t.EVENT_NOTIFICATION_CHANGED=We;t.EVENT_OPEN_IN_PAGE_TREE=ji;t.EVENT_OUTER_FRAME_CLICKED=rt;t.EVENT_OVERALL_REFRESH_TREE_NODE=Hi;t.EVENT_PAGE_TREE_COMPONENT_SELECTED=Bi;t.EVENT_PAGE_TREE_PANEL_SWITCH=Vi;t.EVENT_PAGE_TREE_SLOT_NEED_UPDATE=Wi;t.EVENT_PAGE_TREE_SLOT_SELECTED=Ui;t.EVENT_PART_REFRESH_TREE_NODE=Gi;t.EVENT_PERSPECTIVE_ADDED=Qe;t.EVENT_PERSPECTIVE_CHANGED=Ye;t.EVENT_PERSPECTIVE_REFRESHED=Xe;t.EVENT_PERSPECTIVE_UNLOADING=Ze;t.EVENT_PERSPECTIVE_UPDATED=Je;t.EVENT_SMARTEDIT_COMPONENT_UPDATED=nt;t.EVENT_STRICT_PREVIEW_MODE_REQUESTED=it;t.EVENT_THEME_CHANGED=tt;t.EVENT_THEME_SAVED=et;t.EXPERIENCE_STORAGE_KEY=Mi;t.EXTENDED_VIEW_PORT_MARGIN=ve;t.EXTENDED_VIEW_PORT_MARGIN_TOKEN=oo;t.EditableListNodeItem=EditableListNodeItem;t.FILE_VALIDATION_CONFIG=tn;t.FrequentlyChangingContentName=go;t.GENERIC_EDITOR_LOADED_EVENT=Xt;t.GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT=ei;t.GENERIC_EDITOR_WIDGET_DATA=An;t.GatewayProxied=Do;t.GatewayProxiedAnnotationFactory=GatewayProxiedAnnotationFactory;t.GenericEditorDropdownServiceFactory=GenericEditorDropdownServiceFactory;t.GenericEditorUtil=GenericEditorUtil;t.HEART_BEAT_TIMEOUT_THRESHOLD_MS=Ti;t.HEART_BEAT_TIMEOUT_THRESHOLD_MS_TOKEN=no;t.HIDE_SLOT_MENU=we;t.HIDE_TOOLBAR_ITEM_CONTEXT=ui;t.HasOperationPermissionBaseDirective=HasOperationPermissionBaseDirective;t.I18N_LANGUAGES_RESOURCE_URI=Kt;t.I18N_RESOURCE_URI=Me;t.IAnnouncementService=IAnnouncementService;t.ICatalogDetailsService=ICatalogDetailsService;t.ICatalogService=ICatalogService;t.ICatalogVersionPermissionService=ICatalogVersionPermissionService;t.IConfirmationModalService=IConfirmationModalService;t.IContextualMenuService=IContextualMenuService;t.ID_ATTRIBUTE=me;t.IDecoratorService=IDecoratorService;t.IDragAndDropCrossOrigin=IDragAndDropCrossOrigin;t.IDragEventType=Vo;t.IEditorModalService=IEditorModalService;t.IExperienceService=IExperienceService;t.IFeatureService=IFeatureService;t.IFileValidation=IFileValidation;t.IGenericEditorDropdownServiceConstructor=IGenericEditorDropdownServiceConstructor;t.IIframeClickDetectionService=IIframeClickDetectionService;t.IMediaService=IMediaService;t.IMediaToUpload=IMediaToUpload;t.INotificationMouseLeaveDetectionService=INotificationMouseLeaveDetectionService;t.INotificationService=INotificationService;t.IPageInfoService=IPageInfoService;t.IPageService=IPageService;t.IPageTreeNodeService=IPageTreeNodeService;t.IPageTreeService=IPageTreeService;t.IPermissionService=IPermissionService;t.IPerspectiveService=IPerspectiveService;t.IPositionRegistry=IPositionRegistry;t.IPreviewService=IPreviewService;t.IRenderService=IRenderService;t.IResizeListener=IResizeListener;t.IRestServiceFactory=IRestServiceFactory;t.ISlotRestrictionsService=ISlotRestrictionsService;t.ISmartEditContractChangeListener=ISmartEditContractChangeListener;t.IStorageGateway=IStorageGateway;t.IStorageManager=IStorageManager;t.IStorageManagerFactory=IStorageManagerFactory;t.IStorageManagerGateway=IStorageManagerGateway;t.IStoragePropertiesService=IStoragePropertiesService;t.ISyncPollingService=ISyncPollingService;t.ITEM_COMPONENT_DATA_TOKEN=bn;t.IToolbarService=IToolbarService;t.IToolbarServiceFactory=IToolbarServiceFactory;t.IUrlService=IUrlService;t.IUserTrackingService=IUserTrackingService;t.IWaitDialogService=IWaitDialogService;t.LANGUAGE_RESOURCE_URI=Bt;t.LINKED_DROPDOWN=ni;t.LINKED_DROPDOWN_TOKEN=Ln;t.LOGOUT=_e;t.MEDIAS_PATH=Ri;t.MEDIA_ADVANCED_PROPERTIES_CUSTOM_TOKEN=Ts;t.MEDIA_FILE_SELECTOR_CUSTOM_INJECTOR_TOKEN=bs;t.MEDIA_FILE_SELECTOR_CUSTOM_TOKEN=Cs;t.MEDIA_FOLDER_PATH=ki;t.MEDIA_PATH=Di;t.MEDIA_RESOURCE_URI=xi;t.MEDIA_SELECTOR_I18N_KEY=Is;t.MEDIA_SELECTOR_I18N_KEY_TOKEN=Es;t.MEDIA_UPLOAD_FIELDS_CUSTOM_TOKEN=ws;t.MUTATION_TYPES=xe;t.MessageGateway=MessageGateway;t.NG_ROUTE_PREFIX=ue;t.NG_ROUTE_WILDCARD=he;t.NONE_PERSPECTIVE=vi;t.NamespacedStorageManager=NamespacedStorageManager;t.NavigationNodeItem=NavigationNodeItem;t.NodeUtils=NodeUtils;t.OPEN_PAGE_WORKFLOW_MENU=Ni;t.OPERATION_CONTEXT=Re;t.OVERLAY_COMPONENT_CLASS=Et;t.OVERLAY_DISABLED_EVENT=Te;t.OVERLAY_ID=at;t.OVERLAY_RERENDERED_EVENT=ht;t.ObjectUtils=ObjectUtils;t.PAGES_CONTENT_SLOT_RESOURCE_URI=Li;t.PAGE_CONTEXT_CATALOG=Ce;t.PAGE_CONTEXT_CATALOG_VERSION=be;t.PAGE_CONTEXT_SITE_ID=Ie;t.PAGE_TREE_NODE_CLASS=qi;t.PAGE_TREE_PANEL_WIDTH_COOKIE_NAME=$i;t.PAGE_TREE_SLOT_EXPANDED_EVENT=Ki;t.PERSPECTIVE_SELECTOR_WIDGET_KEY=ot;t.POPUP_OVERLAY_DATA=_n;t.PREVIEW_RESOURCE_URI=Ve;t.PREVIOUS_USERNAME_HASH=Ke;t.PRODUCT_LIST_RESOURCE_API=gi;t.PRODUCT_RESOURCE_API=mi;t.PageInfoService=PageInfoService;t.REFRESH_CONTEXTUAL_MENU_ITEMS_EVENT=$e;t.RESOLVED_LOCALE_TO_CKEDITOR_LOCALE_MAP=Xn;t.RICH_TEXT_CONFIGURATION=Qn;t.RarelyChangingContentName=ho;t.RichTextLoaderService=RichTextLoaderService;t.SCROLL_AREA_CLASS=bi;t.SEND_MOUSE_POSITION_THROTTLE=yi;t.SETTINGS_URI=He;t.SHOW_SLOT_MENU=Ee;t.SHOW_TOOLBAR_ITEM_CONTEXT=hi;t.SITES_RESOURCE_URI=ri;t.SMARTEDITCONTAINER_COMPONENT_NAME=ce;t.SMARTEDITLOADER_COMPONENT_NAME=le;t.SMARTEDIT_ATTRIBUTE_PREFIX=_t;t.SMARTEDIT_COMPONENT_NAME=de;t.SMARTEDIT_COMPONENT_PROCESS_STATUS=yt;t.SMARTEDIT_DRAG_AND_DROP_EVENTS=_i;t.SMARTEDIT_ELEMENT_HOVERED=Ci;t.SMARTEDIT_IFRAME_DRAG_AREA=Ii;t.SMARTEDIT_IFRAME_WRAPPER_ID=wi;t.SMARTEDIT_INNER_FILES=Oi;t.SMARTEDIT_INNER_FILES_POST=Ai;t.SMARTEDIT_LOGIN_DIALOG_RESOURCES=qe;t.SMARTEDIT_RESOURCE_URI_REGEXP=Be;t.SMARTEDIT_ROOT=je;t.SSO_AUTHENTICATION_ENTRY_POINT=Fe;t.SSO_LOGOUT_ENTRY_POINT=Le;t.SSO_OAUTH2_AUTHENTICATION_ENTRY_POINT=ze;t.STORAGE_PROPERTIES_TOKEN=Uo;t.STORE_FRONT_CONTEXT=pi;t.ScriptUtils=ScriptUtils;t.SeCustomComponent=SeCustomComponent;t.SeEntryModule=SeEntryModule;t.SeRouteService=SeRouteService;t.SmarteditErrorHandler=SmarteditErrorHandler;t.StorageManagerFactory=StorageManagerFactory;t.StorageNamespaceConverter=StorageNamespaceConverter;t.StringUtils=StringUtils;t.TAB_DATA=sn;t.THROTTLE_SCROLLING_DELAY=Si;t.TOOLBAR_ITEM=mo;t.TREE_NODE=mn;t.TYPES_RESOURCE_URI=di;t.TYPE_ATTRIBUTE=ge;t.TextTruncateService=TextTruncateService;t.Timer=Timer;t.TreeDragAndDropEvent=TreeDragAndDropEvent;t.TreeNestedDataSource=TreeNestedDataSource;t.TreeNodeItem=TreeNodeItem;t.TruncatedText=TruncatedText;t.USER_TRACKING_FUNCTIONALITY=Xi;t.USER_TRACKING_KEY_MAP=Qi;t.UUID_ATTRIBUTE=bt;t.VALIDATION_MESSAGE_TYPES=ti;t.WHO_AM_I_RESOURCE_URI=ke;t.WIZARD_API=lo;t.WIZARD_MANAGER=ro;t.WizardService=WizardService;t.YJQUERY_TOKEN=ko;t.apiUtils=eo;t.authorizationEvictionTag=vo;t.catalogEvictionTag=So;t.catalogSyncedEvictionTag=yo;t.cmsitemsEvictionTag=$o;t.cmsitemsUri=Wo;t.contentCatalogUpdateEvictionTag=Po;t.dateUtils=to;t.diNameUtils=ee;t.frequentlyChangingContent=uo;t.genericEditorDropdownComponentOnInit=genericEditorDropdownComponentOnInit;t.getLocalizedFilterFn=getLocalizedFilterFn;t.isBlankValidator=isBlankValidator;t.moduleUtils=se;t.nodeUtils=Q;t.objectToArray=objectToArray;t.objectUtils=Ji;t.operationContextCMSPredicate=operationContextCMSPredicate;t.operationContextInteractivePredicate=operationContextInteractivePredicate;t.operationContextNonInteractivePredicate=operationContextNonInteractivePredicate;t.operationContextToolingPredicate=operationContextToolingPredicate;t.pageChangeEvictionTag=wo;t.pageCreationEvictionTag=Co;t.pageDeletionEvictionTag=bo;t.pageEvictionTag=To;t.pageRestoredEvictionTag=Eo;t.pageUpdateEvictionTag=Io;t.parseComponentSelector=parseComponentSelector;t.parseValidationMessage=parseValidationMessage;t.perspectiveChangedEvictionTag=Oo;t.rarelyChangingContent=_o;t.registerCustomComponents=registerCustomComponents;t.scriptUtils=io;t.seCustomComponents=te;t.stringUtils=ae;t.userEvictionTag=fo;t.windowUtils=ne;t.yjQueryServiceFactory=yjQueryServiceFactory},18681:(e,t,i)=>{"use strict";var o=i(43412)["lW"];Object.defineProperty(t,"__esModule",{value:true});var n=i(32709);var s=i(12549);var a=i(54526);var r=i(22630);var l=i(67564);var d=i(66791);var p=i(30178);var m=i(93620);var g=i(38102);var u=i(72093);var h=i(19662);var _=i(51132);var v=i(9501);var f=i(70658);var y=i(40648);var S=i(6242);var b=i(78471);var E=i(99662);var w=i(37100);function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}function _interopNamespace(e){if(e&&e.__esModule)return e;var t=Object.create(null);if(e){Object.keys(e).forEach((function(i){if(i!=="default"){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,o.get?o:{enumerable:true,get:function(){return e[i]}})}}))}t["default"]=e;return Object.freeze(t)}var A=_interopNamespace(r);var R=_interopDefaultLegacy(_);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __param(e,t){return function(i,o){t(i,o,e)}}function __metadata(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}var N;t.ThemeSwitchService=N=class ThemeSwitchService{constructor(e,t,i,o){this.alertService=e;this._themesService=t;this.restServiceFactory=i;this.crossFrameEventService=o;this.sessionStorage=window.sessionStorage;this.themeRestService=this.restServiceFactory.get(s.CURRENT_USER_THEME_URI);this.crossFrameEventService.subscribe(s.EVENTS.REAUTH_STARTED,(()=>{this.selectedTheme=N.lightTheme;this.crossFrameEventService.publish(s.EVENT_THEME_CHANGED)}));this.crossFrameEventService.subscribe(s.EVENTS.LOGOUT,(()=>{this.selectedTheme=N.lightTheme;this.crossFrameEventService.publish(s.EVENT_THEME_CHANGED)}))}getCurrentUserTheme(){return __awaiter(this,void 0,void 0,(function*(){return(yield this.themeRestService.get()).code}))}selectTheme(e){return __awaiter(this,void 0,void 0,(function*(){if(!e){this.selectedTheme=yield this.getCurrentUserTheme();this.setThemeSession()}this.crossFrameEventService.publish(s.EVENT_THEME_CHANGED);e=e?e:this.getThemeSession();this.selectedTheme=e;this.cssUrl=this._themesService.setTheme(e);this.cssCustomUrl=this._themesService.setCustomTheme(e);N.cssStringUrl=`/${this.cssUrl.changingThisBreaksApplicationSecurity}`;N.cssCustomStringUrl=`/${this.cssCustomUrl.changingThisBreaksApplicationSecurity}`}))}setThemeSession(){if(this.selectedTheme){this.sessionStorage.setItem("theme",this.selectedTheme)}}saveTheme(){return __awaiter(this,void 0,void 0,(function*(){try{yield this.restServiceFactory.get(s.CURRENT_USER_THEME_URI,"code").update({code:this.selectedTheme});this.setThemeSession();this.crossFrameEventService.publish(s.EVENT_THEME_SAVED);return Promise.resolve()}catch(e){this.selectTheme(this.getThemeSession());this.generateAndAlertErrorMessage();return Promise.reject()}}))}getThemeSession(){if(this.sessionStorage.getItem("theme")&&this.sessionStorage.getItem("theme")!=="undefined"){return this.sessionStorage.getItem("theme")}else{return null}}generateAndAlertErrorMessage(){this.alertService.showDanger({message:"se.cms.theme.save.error",minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"})}};t.ThemeSwitchService.lightTheme="sap_fiori_3";t.ThemeSwitchService=N=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.IAlertService,s.ThemesService,s.RestServiceFactory,s.CrossFrameEventService])],t.ThemeSwitchService);var L;(function(e){e[e["SMARTEDITCONTAINER"]=0]="SMARTEDITCONTAINER";e[e["SMARTEDIT"]=1]="SMARTEDIT"})(L||(L={}));t.ConfigurationExtractorService=class ConfigurationExtractorService{constructor(e){this.logService=e}extractSEContainerModules(e){return this._getAppsAndLocations(e,L.SMARTEDITCONTAINER)}extractSEModules(e){return this._getAppsAndLocations(e,L.SMARTEDIT)}orderApplications(e){const t=e.filter((e=>!e.extends));const i=e.filter((e=>!!e.extends)).filter((t=>{const i=e.findIndex((e=>e.name===t.extends));if(i===-1){this.logService.error(`Application ${t.name} located at ${t.location} is ignored because it extends an unknown application '${t.extends}'; SmartEdit functionality may be compromised.`)}return i>-1}));return this._addExtendingAppsInOrder(t,i)}_addExtendingAppsInOrder(e,t,i){i=i||1;const o=[];t.forEach((t=>{const n=e.findIndex((e=>e.name===t.extends));if(n>-1){this.logService.debug(`pass ${i}, ${t.name} requiring ${t.extends} found it at index ${n} (${e.map((e=>e.name))})`);e.splice(n+1,0,t)}else{this.logService.debug(`pass ${i}, ${t.name} requiring ${t.extends} did not find it  (${e.map((e=>e.name))})`);o.push(t)}}));if(o.length){return this._addExtendingAppsInOrder(e,o,++i)}else{return e}}_getAppsAndLocations(e,t){let i;switch(t){case L.SMARTEDITCONTAINER:i="smartEditContainerLocation";break;case L.SMARTEDIT:i="smartEditLocation";break}const o=A.map(e,((e,t)=>({key:t,value:e}))).reduce(((t,o)=>{if(o.key.indexOf("applications")===0&&typeof o.value[i]==="string"){const n={};n.name=o.key.split(".")[1];const s=o.value[i];if(/^https?\:\/\//.test(s)){n.location=s}else{n.location=e.domain+s}const a=o.value.extends;if(a){n.extends=a}t.applications.push(n);t.authenticationMap=A.merge(t.authenticationMap,o.value.authenticationMap)}else if(o.key==="authenticationMap"){t.authenticationMap=A.merge(t.authenticationMap,o.value)}return t}),{applications:[],authenticationMap:{}});return o}};t.ConfigurationExtractorService=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.LogService])],t.ConfigurationExtractorService);t.BootstrapService=class BootstrapService{constructor(e,t,i,o,n,s,a,r,l){this.configurationExtractorService=e;this.sharedDataService=t;this.logService=i;this.httpClient=o;this.promiseUtils=n;this.smarteditBootstrapGateway=s;this.moduleUtils=a;this.SMARTEDIT_INNER_FILES=r;this.SMARTEDIT_INNER_FILES_POST=l}bootstrapContainerModules(e){const t=this.promiseUtils.defer();const i=this.configurationExtractorService.extractSEContainerModules(e);const o=this.configurationExtractorService.orderApplications(i.applications);this.logService.debug("outerAppLocations are:",o);this.sharedDataService.set("authenticationMap",i.authenticationMap);this.sharedDataService.set("credentialsMap",e["authentication.credentials"]);const n=this._getConstants(e);this._getValidApplications(o).then((e=>{s.scriptUtils.injectJS().execute({srcs:e.map((e=>e.location)),callback:()=>{const i=[...window.__smartedit__.pushedModules];["personalizationsmarteditContainer","merchandisingsmarteditContainer","personalizationsearchsmarteditContainer","personalizationpromotionssmarteditContainer","cmssmarteditContainer"].forEach((t=>{e.push({name:t,location:""})}));e.forEach((e=>{const t=this.moduleUtils.getNgModule(e.name);if(t){i.push(t)}}));t.resolve({modules:i,constants:n})}})}));return t.promise}bootstrapSEApp(e){const i=this.configurationExtractorService.extractSEModules(e);const o=this.configurationExtractorService.orderApplications(i.applications);this.sharedDataService.set("authenticationMap",i.authenticationMap);this.sharedDataService.set("credentialsMap",e["authentication.credentials"]);const n={properties:this._getConstants(e),js:[{src:e.smarteditroot+"/static-resources/thirdparties/blockumd/blockumd.js"},{src:e.smarteditroot+"/static-resources/dist/smartedit-new/vendors.js"},{src:e.smarteditroot+"/static-resources/thirdparties/ckeditor/ckeditor.js"},{src:e.smarteditroot+"/static-resources/dist/smartedit-new/smartedit.js"}],css:[e.smarteditroot+t.ThemeSwitchService.cssStringUrl,e.smarteditroot+t.ThemeSwitchService.cssCustomStringUrl,e.smarteditroot+"/static-resources/dist/smartedit-new/main.css"]};return this._getValidApplications(o).then((e=>{["personalizationsmartedit","merchandisingsmartedit","personalizationsearchsmartedit","personalizationpromotionssmartedit","cmssmartedit"].forEach((t=>{e.push({name:t,location:""})}));if(false){}n.js=n.js.concat(e.map((e=>{const t={src:e.location};return t})));if(false){}n.properties.applications=e.map((e=>e.name));this.smarteditBootstrapGateway.getInstance().publish("bundle",{resources:n})}))}_getConstants(e){return{domain:e.domain,smarteditroot:e.smarteditroot}}_getValidApplications(e){return Promise.all(e.map((e=>{const t=this.promiseUtils.defer();this.httpClient.get(e.location,{responseType:"text"}).subscribe((()=>{t.resolve(e)}),(i=>{this.logService.error(`Failed to load application '${e.name}' from location ${e.location}; SmartEdit functionality may be compromised.`);t.resolve()}));return t.promise}))).then((e=>A.merge(A.compact(e))))}};t.BootstrapService=__decorate([__param(7,n.Inject("SMARTEDIT_INNER_FILES")),__param(8,n.Inject("SMARTEDIT_INNER_FILES_POST")),__metadata("design:paramtypes",[t.ConfigurationExtractorService,s.ISharedDataService,s.LogService,a.HttpClient,s.PromiseUtils,s.SmarteditBootstrapGateway,s.ModuleUtils,Array,Array])],t.BootstrapService);t.LoadConfigManagerService=class LoadConfigManagerService{constructor(e,t,i,o,n,a){this.sharedDataService=t;this.logService=i;this.promiseUtils=o;this.SMARTEDIT_RESOURCE_URI_REGEXP=n;this.SMARTEDIT_ROOT=a;this.restService=e.get(s.CONFIGURATION_URI)}loadAsArray(){const e=this.promiseUtils.defer();this.restService.query().then((t=>{e.resolve(this._parse(t))}),(t=>{this.logService.log("Fail to load the configurations.",t);e.reject()}));return e.promise}loadAsObject(){const e=this.promiseUtils.defer();this.loadAsArray().then((t=>{try{const i=this._convertToObject(t);this.sharedDataService.set("configuration",i);e.resolve(i)}catch(i){this.logService.error("LoadConfigManager.loadAsObject - _convertToObject failed to load configuration:",t);this.logService.error(i);e.reject()}}));return e.promise}_convertToObject(e){const t=e.reduce(((e,t)=>{try{if(typeof e[t.key]!=="undefined"){this.logService.error("LoadConfigManager._convertToObject() - duplicate configuration keys found: "+t.key)}e[t.key]=JSON.parse(t.value)}catch(e){this.logService.error("item _key_ from configuration contains unparsable JSON data _value_ and was ignored".replace("_key_",t.key).replace("_value_",t.value))}return e}),{});try{t.domain=this.SMARTEDIT_RESOURCE_URI_REGEXP.exec(this._getLocation())[1]}catch(e){throw new Error(`location ${this._getLocation()} doesn't match the expected pattern ${this.SMARTEDIT_RESOURCE_URI_REGEXP}`)}t.smarteditroot=t.domain+"/"+this.SMARTEDIT_ROOT;return t}_getLocation(){return document.location.href}_parse(e){const t=A.cloneDeep(e);Object.keys(t).forEach((e=>{try{t[e]=JSON.parse(t[e])}catch(e){}}));return t}};t.LoadConfigManagerService=__decorate([s.OperationContextRegistered(s.CONFIGURATION_URI,"TOOLING"),__param(4,n.Inject("SMARTEDIT_RESOURCE_URI_REGEXP")),__param(5,n.Inject("SMARTEDIT_ROOT")),__metadata("design:paramtypes",[s.RestServiceFactory,s.ISharedDataService,s.LogService,s.PromiseUtils,RegExp,String])],t.LoadConfigManagerService);const B={timeout:2e4,closeable:true};let j=class AnnouncementService extends s.IAnnouncementService{constructor(e){super();this.logService=e;this.announcements$=new l.BehaviorSubject([])}showAnnouncement(e){this.validateAnnouncementConfig(e);const t=r.clone(e);t.id=s.stringUtils.encode(e);t.timeout=!!t.timeout&&t.timeout>0?t.timeout:B.timeout;if(t.timeout>0){t.timer=setTimeout((()=>{this._closeAnnouncement(t)}),t.timeout)}this.announcements$.next([...this.announcements$.getValue(),t]);return Promise.resolve(t.id)}getAnnouncements(){return this.announcements$.asObservable()}closeAnnouncement(e){const t=this.announcements$.getValue().find((t=>t.id===e));if(t){this._closeAnnouncement(t)}return Promise.resolve()}_closeAnnouncement(e){if(e.timer){clearTimeout(e.timer)}const t=this.announcements$.getValue();const i=t.filter((t=>t.id!==e.id));this.announcements$.next(i)}validateAnnouncementConfig(e){const{message:t,component:i}=e;if(!t&&!i){this.logService.warn("AnnouncementService.validateAnnouncementConfig - announcement must contain at least a message or component property",e)}if(t&&i){throw new Error("AnnouncementService.validateAnnouncementConfig - either message or component must be provided")}}};j=__decorate([s.GatewayProxied("showAnnouncement","closeAnnouncement"),n.Injectable(),__metadata("design:paramtypes",[s.LogService])],j);let G=class NotificationService{constructor(e,t){this.systemEventService=e;this.logService=t;this.notificationsChangeAction=new l.BehaviorSubject(undefined);this.notifications=new l.BehaviorSubject([]);this.initNotificationsChangeAction()}ngOnDestroy(){this.notifications.unsubscribe();this.notificationsChangeAction.unsubscribe()}pushNotification(e){const t={type:"PUSH",payload:e};this.notificationsChangeAction.next(t);return Promise.resolve()}removeNotification(e){const t={type:"REMOVE",payload:{id:e}};this.notificationsChangeAction.next(t);return Promise.resolve()}removeAllNotifications(){const e={type:"REMOVE_ALL"};this.notificationsChangeAction.next(e);return Promise.resolve()}isNotificationDisplayed(e){return!!this.getNotification(e)}getNotification(e){return this.notifications.getValue().find((t=>t.id===e))}getNotifications(){return this.notifications.asObservable()}initNotificationsChangeAction(){this.notificationsChangeAction.pipe(d.distinctUntilChanged(((e,t)=>this.emitWhenActionIsAvailable(t))),d.skip(1),d.map((e=>this.resolveNotifications(e)))).subscribe((e=>{this.notifications.next(e);this.systemEventService.publishAsync(s.EVENT_NOTIFICATION_CHANGED)}))}emitWhenActionIsAvailable(e){const{payload:t}=e;const i=(e.type==="PUSH"||e.type==="REMOVE")&&this.getNotification(t.id);switch(e.type){case"PUSH":if(i){this.logService.debug(`Notification already exists for id:"${t.id}"`);return true}return false;case"REMOVE":if(!i){this.logService.debug(`Attempt to remove a non existing notification for id:"${t.id}"`);return true}return false;case"REMOVE_ALL":default:return false}}resolveNotifications(e){const{payload:t}=e;switch(e.type){case"PUSH":return[...this.notifications.getValue(),t];case"REMOVE":return this.notifications.getValue().filter((e=>e.id!==t.id));case"REMOVE_ALL":default:return[]}}};G=__decorate([s.GatewayProxied("pushNotification","removeNotification","removeAllNotifications"),__metadata("design:paramtypes",[s.SystemEventService,s.LogService])],G);let H=class NotificationMouseLeaveDetectionService extends s.INotificationMouseLeaveDetectionService{constructor(e,t,i){super();this.document=e;this.windowUtils=t;this.logService=i;this.notificationPanelBounds=null;this.mouseLeaveCallback=null;this._onMouseMove=this._onMouseMove.bind(this)}startDetection(e,t,i){this.validateBounds(e);if(!i){throw new Error("Callback function is required")}this.notificationPanelBounds=e;this.mouseLeaveCallback=i;this.document.addEventListener("mousemove",this._onMouseMove);if(t){this.validateBounds(t);this._remoteStartDetection(t)}return Promise.resolve()}stopDetection(){this.document.removeEventListener("mousemove",this._onMouseMove);this.notificationPanelBounds=null;this.mouseLeaveCallback=null;if(this.windowUtils.getGatewayTargetFrame()){this._remoteStopDetection().catch((e=>{this.logService.debug(`NotificationMouseLeaveDetectionService - stopDetection: ${JSON.stringify(e)}`)}))}return Promise.resolve()}_callCallback(){this._getCallback().then((e=>{if(e){e()}}));return Promise.resolve()}_getBounds(){return Promise.resolve(this.notificationPanelBounds)}_getCallback(){return Promise.resolve(this.mouseLeaveCallback)}validateBounds(e){if(!e){throw new Error("Bounds are required for mouse leave detection")}if(!e.hasOwnProperty("x")){throw new Error("Bounds must contain the x coordinate")}if(!e.hasOwnProperty("y")){throw new Error("Bounds must contain the y coordinate")}if(!e.hasOwnProperty("width")){throw new Error("Bounds must contain the width dimension")}if(!e.hasOwnProperty("height")){throw new Error("Bounds must contain the height dimension")}}};H=__decorate([s.GatewayProxied("stopDetection","_remoteStartDetection","_remoteStopDetection","_callCallback"),n.Injectable(),__param(0,n.Inject(p.DOCUMENT)),__metadata("design:paramtypes",[Document,s.WindowUtils,s.LogService])],H);t.DelegateRestService=class DelegateRestService{constructor(e){this.restServiceFactory=e}delegateForSingleInstance(e,t,i,o,n,s){const a=this.restServiceFactory.get(i,o);if(n){a.activateMetadata()}return a.getMethodForSingleInstance(e)(t,s)}delegateForArray(e,t,i,o,n,s){const a=this.restServiceFactory.get(i,o);if(n){a.activateMetadata()}return a.getMethodForArray(e)(t,s)}delegateForPage(e,t,i,o,n){const s=this.restServiceFactory.get(t,i);if(o){s.activateMetadata()}return s.page(e,n)}delegateForQueryByPost(e,t,i,o,n,s){const a=this.restServiceFactory.get(i,o);if(n){a.activateMetadata()}return a.queryByPost(e,t,s)}};t.DelegateRestService=__decorate([s.GatewayProxied(),__metadata("design:paramtypes",[s.IRestServiceFactory])],t.DelegateRestService);const W=[{orientation:"vertical",key:"se.deviceorientation.vertical.label",default:true},{orientation:"horizontal",key:"se.deviceorientation.horizontal.label"}];const $=[{iconClass:"sap-icon--iphone",type:"phone",width:480,name:"Mobile Portrait"},{iconClass:"sap-icon--iphone-2",type:"wide-phone",width:600,name:"Mobile Landscape"},{iconClass:"sap-icon--ipad",type:"tablet",width:700,name:"Tablet Portrait"},{iconClass:"sap-icon--ipad-2",type:"wide-tablet",width:1024,name:"Tablet Landscape"},{iconClass:"sap-icon--sys-monitor",type:"desktop",width:1200,name:"Desktop"},{iconClass:"hyicon hyicon-wide-screen",type:"wide-desktop",width:"100%",default:true,name:"Widescreen"}];let K=class IframeManagerService{constructor(e,t,i,o,n){this.logService=e;this.httpClient=t;this.yjQuery=i;this.windowUtils=o;this.sharedDataService=n}setCurrentLocation(e){this.currentLocation=e}getIframe(){return this.yjQuery(this.windowUtils.getSmarteditIframe())}isCrossOrigin(){return this.windowUtils.isCrossOrigin(this.currentLocation)}load(e,t,i){if(t){return this._getPageAsync(e).then((()=>{this.getIframe().attr("src",e)}),(e=>{if(e.status===404){this.getIframe().attr("src",i);return}this.logService.error(`IFrameManagerService.load - _getPageAsync failed with error ${e}`)}))}else{this.logService.debug("iframeManagerService::load - loading storefront url:",e);this.getIframe().attr("src",e);return Promise.resolve()}}loadPreview(e,t){this.windowUtils.setTrustedIframeDomain(e);this.logService.debug("loading storefront iframe with preview ticket:",t);let i;if(!/.+\.html/.test(e)){i=this._appendURISuffix(e)}else{i=Promise.resolve(e)}return i.then((i=>{const o=i+(i.indexOf("?")===-1?"?":"&")+"cmsTicketId="+t;if(this._mustLoadAsSuch(e)){return this.load(o)}else{const e=this.isCrossOrigin();return(e?Promise.resolve({}):this._getPageAsync(o)).then((()=>this.load(this.currentLocation,!e,o)),(e=>this.logService.error("failed to load preview",e)))}}))}apply(e,t){let i;let o;let n=true;if(t&&t.orientation){n=t.orientation==="vertical"}if(e){i=n?e.width:e.height;o=n?e.height:e.width;this.getIframe().removeClass().addClass("device-"+(n?"vertical":"horizontal")+" device-default")}else{this.getIframe().removeClass()}this.getIframe().css({width:i||"100%",height:o||"100%",display:"block",margin:"auto"})}applyDefault(){const e=$.find((e=>e.default));const t=W.find((e=>e.default));this.apply(e,t)}_mustLoadAsSuch(e){return!this.currentLocation||s.urlUtils.getURI(e)===s.urlUtils.getURI(this.currentLocation)||"cmsTicketId"in s.urlUtils.parseQuery(this.currentLocation)}_getPageAsync(e){return this.httpClient.get(e,{observe:"body",responseType:"text"}).toPromise()}_appendURISuffix(e){const t=e.split("?");return this.sharedDataService.get("configuration").then((e=>{if(!e||!e.storefrontPreviewRoute){this.logService.debug("SmartEdit configuration for 'storefrontPreviewRoute' is not found. Fallback to default value: '"+IframeManagerService.DEFAULT_PREVIEW_ROUTE+"'");return IframeManagerService.DEFAULT_PREVIEW_ROUTE}return e.storefrontPreviewRoute})).then((e=>t[0].replace(/(.+)([^\/])$/g,"$1$2/"+e).replace(/(.+)\/$/g,"$1/"+e)+(t.length===2?"?"+t[1]:"")))}};K.DEFAULT_PREVIEW_ROUTE="cx-preview";K=__decorate([__param(2,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[s.LogService,a.HttpClient,Function,s.WindowUtils,s.ISharedDataService])],K);let Y=class DragAndDropCrossOrigin extends s.IDragAndDropCrossOrigin{constructor(e,t,i){super();this.yjQuery=e;this.crossFrameEventService=t;this.iframeManagerService=i;this.onDragStart=()=>{if(!this.isEnabled()){return}this.crossFrameEventService.publish(s.SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_CROSS_ORIGIN_START);this.syncIframeDragArea().show().off("dragover").on("dragover",(e=>{e.preventDefault();const t=this.getPositionRelativeToIframe(e.pageX,e.pageY);this.throttledSendMousePosition(t);return false})).off("drop").on("drop",(e=>{e.preventDefault();e.stopPropagation();const t=this.getPositionRelativeToIframe(e.pageX,e.pageY);this.crossFrameEventService.publish(s.SMARTEDIT_DRAG_AND_DROP_EVENTS.DROP_ELEMENT,t);return false}))};this.onDragEnd=()=>{if(!this.isEnabled()){return}this.getIframeDragArea().off("dragover").off("drop").hide()};this.sendMousePosition=e=>{this.crossFrameEventService.publish(s.SMARTEDIT_DRAG_AND_DROP_EVENTS.TRACK_MOUSE_POSITION,e)}}initialize(){this.throttledSendMousePosition=A.throttle(this.sendMousePosition,s.SEND_MOUSE_POSITION_THROTTLE);this.crossFrameEventService.subscribe(s.SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_START,this.onDragStart);this.crossFrameEventService.subscribe(s.SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_END,this.onDragEnd);this.crossFrameEventService.subscribe(s.DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.START,(()=>{if(this.isEnabled()){this.iframeManagerService.getIframe().css("pointer-events","none")}}));this.crossFrameEventService.subscribe(s.DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.END,(()=>{if(this.isEnabled()){this.iframeManagerService.getIframe().css("pointer-events","auto")}}))}isEnabled(){return this.iframeManagerService.isCrossOrigin()}getIframeDragArea(){return this.yjQuery("#"+s.SMARTEDIT_IFRAME_DRAG_AREA)}getPositionRelativeToIframe(e,t){const i=this.getIframeDragArea().offset();return{x:e-i.left,y:t-i.top}}syncIframeDragArea(){this.getIframeDragArea().width(this.iframeManagerService.getIframe().width());this.getIframeDragArea().height(this.iframeManagerService.getIframe().height());const e=this.iframeManagerService.getIframe().offset();this.getIframeDragArea().css({top:e.top,left:e.left});return this.getIframeDragArea()}};Y=__decorate([__param(0,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[Function,s.CrossFrameEventService,K])],Y);let Z=class SiteService{constructor(e){this.SITES_FOR_CATALOGS_URI="/cmswebservices/v1/sites/catalogs";this.cache=null;this.siteRestService=e.get(s.SITES_RESOURCE_URI);this.sitesForCatalogsRestService=e.get(this.SITES_FOR_CATALOGS_URI)}getAccessibleSites(){return this.siteRestService.get({}).then((e=>e.sites))}getSites(){return this.getAccessibleSites().then((e=>{const t=e.reduce(((e,t)=>[...e||[],...t.contentCatalogs]),[]);return this.sitesForCatalogsRestService.save({catalogIds:t}).then((e=>{this.cache=e.sites;return this.cache}))}))}getSiteById(e){return this.getSites().then((t=>t.find((t=>t.uid===e))))}};__decorate([s.Cached({actions:[s.rarelyChangingContent],tags:[s.authorizationEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],Z.prototype,"getAccessibleSites",null);__decorate([s.Cached({actions:[s.rarelyChangingContent],tags:[s.authorizationEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],Z.prototype,"getSites",null);Z=__decorate([s.OperationContextRegistered("SITES_RESOURCE_URI","CMS"),__metadata("design:paramtypes",[s.RestServiceFactory])],Z);let Q=class ExperienceService extends s.IExperienceService{constructor(e,t,i,o,n,a,r,d,p,m,g){super();this.seStorageManager=e;this.storagePropertiesService=t;this.logService=i;this.crossFrameEventService=o;this.siteService=n;this.previewService=a;this.catalogService=r;this.languageService=d;this.sharedDataService=p;this.iframeManagerService=m;this.routingService=g;this.storageLoaded$=new l.BehaviorSubject(false);e.getStorage({storageId:s.EXPERIENCE_STORAGE_KEY,storageType:t.getProperty("STORAGE_TYPE_SESSION_STORAGE")}).then((e=>{this.experienceStorage=e;this.storageLoaded$.next(true)}))}buildAndSetExperience(e){const t=e.siteId;const i=e.catalogId;const o=e.catalogVersion;const n=e.productCatalogVersions;return Promise.all([this.siteService.getSiteById(t),this.catalogService.getContentCatalogsForSite(t),this.catalogService.getProductCatalogsForSite(t),this.languageService.getLanguagesForSite(t)]).then((([s,a,r,l])=>{const d=a.find((e=>e.catalogId===i));const p=d?d.versions.find((e=>e.version===o)):null;if(!p){return Promise.reject(`no catalogVersionDescriptor found for ${i} catalogId and ${o} catalogVersion`)}const m=[];r.forEach((e=>{const t=e.versions.find((e=>n?n.indexOf(e.uuid)>-1:e.active===true));m.push({catalog:e.catalogId,catalogName:e.name,catalogVersion:t.version,active:t.active,uuid:t.uuid})}));const g=e.language?l.find((t=>t.isocode===e.language)):l[0];const u=A.cloneDeep(e);delete u.siteId;delete u.catalogId;delete u.catalogVersion;u.siteDescriptor=s;u.catalogDescriptor={catalogId:i,catalogVersion:p.version,catalogVersionUuid:p.uuid,name:d.name,siteId:t,active:p.active};u.languageDescriptor=g;u.time=u.time||null;u.productCatalogVersions=m;return this.setCurrentExperience(u)}))}updateExperiencePageId(e){return this.getCurrentExperience().then((t=>{if(!t){return null}t.pageId=e;return this.setCurrentExperience(t).then((()=>this.reloadPage()))}))}loadExperience(e){return this.buildAndSetExperience(e).then((()=>this.reloadPage()))}reloadPage(){this.routingService.reload(s.STORE_FRONT_CONTEXT)}updateExperiencePageContext(e,t){return this.getCurrentExperience().then((i=>this.catalogService.getContentCatalogsForSite(i.catalogDescriptor.siteId).then((o=>{if(!i){return null}const n=o.reduce(((e,t)=>{if(t.parents&&t.parents.length){t.parents.forEach((t=>{e.push(t)}))}return e}),[...o]);const s=A.flatten(n.map((e=>e.versions.map((t=>{t.catalogName=e.name||e.catalogName;t.catalogId=e.catalogId;return t}))))).find((t=>t.uuid===e));return this.catalogService.getCurrentSiteID().then((e=>{i.pageId=t;i.pageContext={catalogId:s.catalogId,catalogName:s.catalogName,catalogVersion:s.version,catalogVersionUuid:s.uuid,siteId:e,active:s.active};return this.setCurrentExperience(i)}))})))).then((e=>{this.crossFrameEventService.publish(s.EVENTS.PAGE_CHANGE,e);return e}))}getCurrentExperience(){return this.storageLoaded$.pipe(d.filter((e=>e)),d.take(1),d.mergeMap((()=>this.experienceStorage.get(s.EXPERIENCE_STORAGE_KEY)))).toPromise()}setCurrentExperience(e){return this.getCurrentExperience().then((t=>{this.previousExperience=t;return this.experienceStorage.put(e,s.EXPERIENCE_STORAGE_KEY).then((()=>this.sharedDataService.set(s.EXPERIENCE_STORAGE_KEY,e).then((()=>e))))}))}hasCatalogVersionChanged(){return this.getCurrentExperience().then((e=>this.previousExperience===undefined||e.catalogDescriptor.catalogId!==this.previousExperience.catalogDescriptor.catalogId||e.catalogDescriptor.catalogVersion!==this.previousExperience.catalogDescriptor.catalogVersion))}initializeExperience(){this.iframeManagerService.setCurrentLocation(null);return this.getCurrentExperience().then((e=>{if(!e){this.routingService.go("/");return null}return this.updateExperience()}),(e=>{this.logService.error("ExperienceService.initializeExperience() - failed to retrieve experience");return Promise.reject(e)}))}updateExperience(e){return this.getCurrentExperience().then((t=>{t=A.cloneDeep(t);A.merge(t,e);return this.previewService.getResourcePathFromPreviewUrl(t.siteDescriptor.previewUrl).then((e=>{const i=this._convertExperienceToPreviewData(t,e);return this.previewService.createPreview(i).then((e=>{window.__smartedit__.smartEditBootstrapped={};this.iframeManagerService.loadPreview(e.resourcePath,e.ticketId);return this.setCurrentExperience(t)}),(e=>{this.logService.error("iframeManagerService.updateExperience() - failed to update experience");return Promise.reject(e)}))}),(e=>{this.logService.error("ExperienceService.updateExperience() - failed to retrieve resource path");return Promise.reject(e)}))}),(e=>{this.logService.error("ExperienceService.updateExperience() - failed to retrieve current experience");return Promise.reject(e)}))}compareWithCurrentExperience(e){if(!e){return Promise.resolve(false)}return this.getCurrentExperience().then((t=>{if(!t){return Promise.resolve(false)}if(t.pageId===e.pageId&&t.siteDescriptor.uid===e.siteId&&t.catalogDescriptor.catalogId===e.catalogId&&t.catalogDescriptor.catalogVersion===e.catalogVersion){return Promise.resolve(true)}return Promise.resolve(false)}))}};Q=__decorate([s.GatewayProxied("loadExperience","updateExperiencePageContext","getCurrentExperience","hasCatalogVersionChanged","buildRefreshedPreviewUrl","compareWithCurrentExperience"),__param(3,n.Inject(s.EVENT_SERVICE)),__metadata("design:paramtypes",[s.IStorageManager,s.IStoragePropertiesService,s.LogService,s.CrossFrameEventService,Z,s.IPreviewService,s.ICatalogService,s.LanguageService,s.ISharedDataService,K,s.SmarteditRoutingService])],Q);let J=class FeatureService extends s.IFeatureService{constructor(e,t,i){super(t,i);this.toolbarServiceFactory=e;this.logService=i;this.features=[]}getFeatureProperty(e,t){const i=this._getFeatureByKey(e);return Promise.resolve(i?i[t]:null)}getFeatureKeys(){return this.features.map((e=>e.key))}addToolbarItem(e){const t=this.toolbarServiceFactory.getToolbarService(e.toolbarId);e.enablingCallback=function(){this.addItems([e])}.bind(t);e.disablingCallback=function(){this.removeItemByKey(e.key)}.bind(t);return this.register(e)}_registerAliases(e){const t=this._getFeatureByKey(e.key);if(!t){e.id=o.from(e.key).toString("base64");this.features.push(e)}return Promise.resolve()}_getFeatureByKey(e){return this.features.find((t=>t.key===e))}};J=__decorate([s.GatewayProxied("_registerAliases","addToolbarItem","register","enable","disable","_remoteEnablingFromInner","_remoteDisablingFromInner","addDecorator","getFeatureProperty","addContextualMenuButton"),__metadata("design:paramtypes",[s.IToolbarServiceFactory,s.CloneableUtils,s.LogService])],J);let ee=class PageInfoService extends s.IPageInfoService{constructor(){super()}};ee=__decorate([s.GatewayProxied("getPageUID","getPageUUID","getCatalogVersionUUIDFromPage","isSameCatalogVersionOfPageAndPageTemplate"),__metadata("design:paramtypes",[])],ee);let te=class PreviewService extends s.IPreviewService{constructor(e,t,i,o){super(o);this.log=e;this.loadConfigManagerService=t;this.restServiceFactory=i;this.ticketIdIdentifier="ticketId"}createPreview(e){return __awaiter(this,void 0,void 0,(function*(){const t=["catalogVersions","resourcePath"];this.validatePreviewDataAttributes(e,t);yield this.prepareRestService();try{const t=yield this.previewRestService.save(e);return s.objectUtils.copy(t)}catch(e){this.log.error("PreviewService.createPreview() - Error creating preview");return Promise.reject(e)}}))}updatePreview(e){return __awaiter(this,void 0,void 0,(function*(){const t=["catalogVersions","resourcePath","ticketId"];this.validatePreviewDataAttributes(e,t);yield this.prepareRestService();try{return yield this.previewByticketRestService.update(e)}catch(e){this.log.error("PreviewService.updatePreview() - Error updating preview");return Promise.reject(e)}}))}getResourcePathFromPreviewUrl(e){return this.prepareRestService().then((()=>this.urlUtils.getAbsoluteURL(this.domain,e)))}prepareRestService(){if(!this.previewRestService||!this.previewByticketRestService){return this.loadConfigManagerService.loadAsObject().then((e=>{const t=e.previewTicketURI||s.PREVIEW_RESOURCE_URI;this.previewRestService=this.restServiceFactory.get(t);this.previewByticketRestService=this.restServiceFactory.get(t,this.ticketIdIdentifier);this.domain=e.domain}),(e=>{this.log.error("PreviewService.getRestService() - Error loading configuration");return Promise.reject(e)}))}return Promise.resolve()}validatePreviewDataAttributes(e,t){if(t){t.forEach((t=>{if(A.isEmpty(e[t])){throw new Error(`ValidatePreviewDataAttributes - ${t} is empty`)}}))}}};te=__decorate([s.GatewayProxied(),__metadata("design:paramtypes",[s.LogService,t.LoadConfigManagerService,s.RestServiceFactory,s.UrlUtils])],te);let ie=class PerspectiveService extends s.IPerspectiveService{constructor(e,t,i,o,n,a,r,l){super();this.routingService=e;this.logService=t;this.systemEventService=i;this.featureService=o;this.waitDialogService=n;this.storageService=a;this.crossFrameEventService=r;this.permissionService=l;this.PERSPECTIVE_COOKIE_NAME="smartedit-perspectives";this.INITIAL_SWITCHTO_ARG="INITIAL_SWITCHTO_ARG";this.data={activePerspective:undefined,previousPerspective:undefined,previousSwitchToArg:this.INITIAL_SWITCHTO_ARG};this.immutablePerspectives=[];this.perspectives=[];this._addDefaultPerspectives();this._registerEventHandlers();this.NON_PERSPECTIVE_OBJECT={key:s.NONE_PERSPECTIVE,nameI18nKey:"",features:[]}}register(e){this._validate(e);let t=this._findByKey(e.key);if(!t){this._addPerspectiveSelectorWidget(e);t=e;t.isHotkeyDisabled=!!e.isHotkeyDisabled;this.immutablePerspectives.push(t);this.perspectives.push(t);this.systemEventService.publishAsync(s.EVENT_PERSPECTIVE_ADDED)}else{t.features=s.objectUtils.uniqueArray(t.features||[],e.features||[]);t.perspectives=s.objectUtils.uniqueArray(t.perspectives||[],e.perspectives||[]);t.permissions=s.objectUtils.uniqueArray(t.permissions||[],e.permissions||[]);this.systemEventService.publishAsync(s.EVENT_PERSPECTIVE_UPDATED)}return Promise.resolve()}getPerspectives(){const e=[];this.immutablePerspectives.forEach((t=>{let i;if(t.permissions&&t.permissions.length>0){i=this.permissionService.isPermitted([{names:t.permissions}])}else{i=Promise.resolve(true)}e.push(i)}));return Promise.all(e).then((e=>this.immutablePerspectives.filter(((t,i)=>e[i]))))}hasActivePerspective(){return Promise.resolve(Boolean(this.data.activePerspective))}getActivePerspective(){return this.data.activePerspective?Object.assign({},this._findByKey(this.data.activePerspective.key)):null}isEmptyPerspectiveActive(){return Promise.resolve(!!this.data.activePerspective&&this.data.activePerspective.key===s.NONE_PERSPECTIVE)}switchTo(e){if(!this._changeActivePerspective(e)){this.waitDialogService.hideWaitModal();return Promise.resolve()}this._handleUnloadEvent(e);this.waitDialogService.showWaitModal();const t=[];if(this.data.previousPerspective){this._fetchAllFeatures(this.data.previousPerspective,t)}const i=[];this._fetchAllFeatures(this.data.activePerspective,i);t.filter((e=>!i.some((t=>e===t)))).forEach((e=>{this.featureService.disable(e)}));const o=[];i.filter((e=>!t.some((t=>e===t)))).forEach((e=>{o.push(this._enableOrDisableFeature(e))}));return Promise.all(o).then((()=>{if(this.data.activePerspective.key===s.NONE_PERSPECTIVE){this.waitDialogService.hideWaitModal()}this.crossFrameEventService.publish(s.EVENT_PERSPECTIVE_CHANGED,this.data.activePerspective.key!==s.NONE_PERSPECTIVE)}))}selectDefault(){return this.getPerspectives().then((e=>this.storageService.getValueFromLocalStorage(this.PERSPECTIVE_COOKIE_NAME,true).then((t=>{const i=e.find((e=>e.key===t));let o;let n;if(!i){this.logService.warn('Cannot select mode "'+t+'" It might not exist or is restricted.');const e=this._findByKey(t);if(!!e){this._disableAllFeaturesForPerspective(e)}o=this.NON_PERSPECTIVE_OBJECT;n=this.NON_PERSPECTIVE_OBJECT}else{const e=this._findByKey(t);o=e?e:this.NON_PERSPECTIVE_OBJECT;n=this.data.previousPerspective?this.data.previousPerspective:o}if(o.key!==this.NON_PERSPECTIVE_OBJECT.key){this._disableAllFeaturesForPerspective(o)}return this.switchTo(n.key)}))))}refreshPerspective(){return this.getPerspectives().then((e=>{const t=this.getActivePerspective();if(!t){return this.selectDefault()}else{this.perspectives=e;if(!this._findByKey(t.key)){return this.switchTo(s.NONE_PERSPECTIVE)}else{const e=[];const i=[];this._fetchAllFeatures(t,e);e.forEach((e=>{i.push(this._enableOrDisableFeature(e))}));return Promise.all(i).then((()=>{this.waitDialogService.hideWaitModal();this.crossFrameEventService.publish(s.EVENT_PERSPECTIVE_REFRESHED,t.key!==s.NONE_PERSPECTIVE)}))}}}))}getActivePerspectiveKey(){const e=this.getActivePerspective();return Promise.resolve(e?e.key:null)}isHotkeyEnabledForActivePerspective(){const e=this.getActivePerspective();return Promise.resolve(e&&!e.isHotkeyDisabled)}_addPerspectiveSelectorWidget(e){e.features=e.features||[];if(e.features.indexOf(s.PERSPECTIVE_SELECTOR_WIDGET_KEY)===-1){e.features.unshift(s.PERSPECTIVE_SELECTOR_WIDGET_KEY)}}_addDefaultPerspectives(){this.register({key:s.NONE_PERSPECTIVE,nameI18nKey:"se.perspective.none.name",isHotkeyDisabled:true,descriptionI18nKey:"se.perspective.none.description.disabled"});this.register({key:s.ALL_PERSPECTIVE,nameI18nKey:"se.perspective.all.name",descriptionI18nKey:"se.perspective.all.description"})}_registerEventHandlers(){this.systemEventService.subscribe(s.EVENTS.LOGOUT,this._clearPerspectiveFeatures.bind(this));this.crossFrameEventService.subscribe(s.EVENTS.USER_HAS_CHANGED,this._clearPerspectiveFeatures.bind(this));this.routingService.routeChangeSuccess().subscribe((e=>{const t=this.routingService.getCurrentUrlFromEvent(e);if((t||"").includes(s.STORE_FRONT_CONTEXT)){this._clearPerspectiveFeatures()}}))}_validate(e){if(s.stringUtils.isBlank(e.key)){throw new Error("perspectiveService.configuration.key.error.required")}if(s.stringUtils.isBlank(e.nameI18nKey)){throw new Error("perspectiveService.configuration.nameI18nKey.error.required")}if([s.NONE_PERSPECTIVE,s.ALL_PERSPECTIVE].indexOf(e.key)===-1&&(s.stringUtils.isBlank(e.features)||e.features.length===0)){throw new Error("perspectiveService.configuration.features.error.required")}}_findByKey(e){return this.perspectives.find((t=>t.key===e))}_fetchAllFeatures(e,t){if(!t){t=[]}if(e.key===s.ALL_PERSPECTIVE){s.objectUtils.uniqueArray(t,this.featureService.getFeatureKeys()||[])}else{s.objectUtils.uniqueArray(t,e.features||[]);(e.perspectives||[]).forEach((e=>{const i=this._findByKey(e);if(i){this._fetchAllFeatures(i,t)}else{this.logService.debug("nested perspective "+e+" was not found in the registry")}}))}}_enableOrDisableFeature(e){return this.featureService.getFeatureProperty(e,"permissions").then((t=>{if(!Array.isArray(t)){t=[]}return this.permissionService.isPermitted([{names:t}]).then((t=>{if(t){this.featureService.enable(e)}else{this.featureService.disable(e)}}))}))}_handleUnloadEvent(e){if(e!==this.data.previousSwitchToArg&&this.data.previousSwitchToArg!==this.INITIAL_SWITCHTO_ARG){this.crossFrameEventService.publish(s.EVENT_PERSPECTIVE_UNLOADING,this.data.previousSwitchToArg)}this.data.previousSwitchToArg=e}_retrievePerspective(e){if(this.data.activePerspective&&this.data.activePerspective.key===e){return null}const t=this._findByKey(e);if(!t){throw new Error("switchTo() - Couldn't find perspective with key "+e)}return t}_changeActivePerspective(e){const t=this._retrievePerspective(e);if(t){this.data.previousPerspective=this.data.activePerspective;this.data.activePerspective=t;this.storageService.setValueInLocalStorage(this.PERSPECTIVE_COOKIE_NAME,t.key,true)}return t}_disableAllFeaturesForPerspective(e){const t=[];this._fetchAllFeatures(e,t);t.forEach((e=>{this.featureService.disable(e)}))}_clearPerspectiveFeatures(){const e=[];if(this.data&&this.data.activePerspective){this._fetchAllFeatures(this.data.activePerspective,e)}e.forEach((e=>{this.featureService.disable(e)}));return Promise.resolve()}};ie=__decorate([s.GatewayProxied("register","switchTo","hasActivePerspective","isEmptyPerspectiveActive","selectDefault","refreshPerspective","getActivePerspectiveKey","isHotkeyEnabledForActivePerspective"),__metadata("design:paramtypes",[s.SmarteditRoutingService,s.LogService,s.SystemEventService,s.IFeatureService,s.IWaitDialogService,s.IStorageService,s.CrossFrameEventService,s.IPermissionService])],ie);t.SessionService=class SessionService extends s.ISessionService{constructor(e,t,i,o){super();this.$log=e;this.storageService=i;this.cryptographicUtils=o;this.USER_DATA_URI="/cmswebservices/v1/users/:userUid";this.whoAmIService=t.get(s.WHO_AM_I_RESOURCE_URI);this.userRestService=t.get(this.USER_DATA_URI)}getCurrentUserDisplayName(){return this.getCurrentUserData().then((e=>e.displayName))}getCurrentUsername(){return this.getCurrentUserData().then((e=>e.uid))}getCurrentUser(){return this.getCurrentUserData()}hasUserChanged(){const e=Promise.resolve(this.cachedUserHash?this.cachedUserHash:this.storageService.getItem(s.PREVIOUS_USERNAME_HASH));return e.then((e=>this.whoAmIService.get({}).then((t=>!!e&&e!==this.cryptographicUtils.sha1Hash(t.uid)))))}setCurrentUsername(){return this.whoAmIService.get({}).then((e=>{this.cachedUserHash=this.cryptographicUtils.sha1Hash(e.uid);this.storageService.setItem(s.PREVIOUS_USERNAME_HASH,this.cachedUserHash)}))}getCurrentUserData(){return this.whoAmIService.get({}).then((e=>this.userRestService.get({userUid:e.uid}).then((t=>({uid:t.uid,displayName:e.displayName,readableLanguages:t.readableLanguages,writeableLanguages:t.writeableLanguages}))))).catch((e=>{this.$log.warn("[SessionService]: Can't load session information",e);return null}))}};__decorate([s.Cached({actions:[s.rarelyChangingContent],tags:[s.userEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],t.SessionService.prototype,"getCurrentUserData",null);t.SessionService=__decorate([s.GatewayProxied("getCurrentUsername","getCurrentUserDisplayName","hasUserChanged","setCurrentUsername","getCurrentUser"),__metadata("design:paramtypes",[s.LogService,s.RestServiceFactory,s.IStorageService,s.CryptographicUtils])],t.SessionService);t.SharedDataService=class SharedDataService extends s.ISharedDataService{constructor(){super();this.storage={}}get(e){return Promise.resolve(this.storage[e])}set(e,t){this.storage[e]=t;return Promise.resolve()}update(e,t){return this.get(e).then((i=>t(i).then((t=>this.set(e,t)))))}remove(e){const t=this.storage[e];delete this.storage[e];return Promise.resolve(t)}containsKey(e){return Promise.resolve(A.has(this.storage,e))}};t.SharedDataService=__decorate([s.GatewayProxied(),n.Injectable(),__metadata("design:paramtypes",[])],t.SharedDataService);t.StorageService=class StorageService extends s.IStorageService{constructor(e,t,i,o){super();this.logService=e;this.windowUtils=t;this.cryptographicUtils=i;this.fingerPrintingService=o;this.SMARTEDIT_SESSIONS="smartedit-sessions";this.CUSTOM_PROPERTIES="custom_properties"}isInitialized(){const e=this.getAuthTokens();return Promise.resolve(A.values(A.omit(e,[this.CUSTOM_PROPERTIES])).length>0)}storeAuthToken(e,t){const i=this.getAuthTokens();i[e]=t;this._setSmarteditSessions(i);return Promise.resolve()}getAuthToken(e){const t=this.getAuthTokens();return Promise.resolve(t[e])}removeAuthToken(e){const t=this.getAuthTokens();delete t[e];this._setSmarteditSessions(t);return Promise.resolve()}removeAllAuthTokens(){this._removeAllAuthTokens();return Promise.resolve()}getValueFromCookie(e,t){throw new Error("getValueFromCookie deprecated since 1905, use getValueFromLocalStorage")}getValueFromLocalStorage(e,t){return Promise.resolve(this._getValueFromLocalStorage(e,t))}getAuthTokens(){const e=this.windowUtils.getWindow().localStorage.getItem(this.SMARTEDIT_SESSIONS);let t;if(e){try{const i=this.cryptographicUtils.aesDecrypt(e,this.fingerPrintingService.getFingerprint());t=JSON.parse(decodeURIComponent(escape(i)))}catch(e){this.logService.info("Failed to read authentication token. Forcing a re-authentication.")}}return t||{}}putValueInCookie(e,t,i){throw new Error("putValueInCookie deprecated since 1905, use setValueInLocalStorage")}setValueInLocalStorage(e,t,i){return Promise.resolve(this._setValueInLocalStorage(e,t,i))}setItem(e,t){const i=this.getAuthTokens();i[this.CUSTOM_PROPERTIES]=i[this.CUSTOM_PROPERTIES]||{};i[this.CUSTOM_PROPERTIES][e]=t;this._setSmarteditSessions(i);return Promise.resolve()}getItem(e){const t=this.getAuthTokens();t[this.CUSTOM_PROPERTIES]=t[this.CUSTOM_PROPERTIES]||{};return Promise.resolve(t[this.CUSTOM_PROPERTIES][e])}_removeAllAuthTokens(){const e=this.getAuthTokens();const t=A.pick(e,[this.CUSTOM_PROPERTIES]);this._setSmarteditSessions(t)}_getValueFromLocalStorage(e,t){const i=this.windowUtils.getWindow().localStorage.getItem(e);let o=null;if(i){try{o=JSON.parse(t?decodeURIComponent(escape(window.atob(i))):i)}catch(e){this.logService.error("Failed during deserialization ",e)}}return o}_setSmarteditSessions(e){const t=o.from(decodeURIComponent(encodeURIComponent(JSON.stringify(e)))).toString("base64");const i=this.cryptographicUtils.aesBase64Encrypt(t,this.fingerPrintingService.getFingerprint());this.windowUtils.getWindow().localStorage.setItem(this.SMARTEDIT_SESSIONS,i)}_setValueInLocalStorage(e,t,i){let n=JSON.stringify(t);n=i?o.from(decodeURIComponent(encodeURIComponent(n))).toString("base64"):n;this.windowUtils.getWindow().localStorage.setItem(e,n)}};t.StorageService=__decorate([s.GatewayProxied("isInitialized","storeAuthToken","getAuthToken","removeAuthToken","removeAllAuthTokens","storePrincipalIdentifier","getPrincipalIdentifier","removePrincipalIdentifier","getValueFromCookie","getValueFromLocalStorage"),n.Injectable(),__metadata("design:paramtypes",[s.LogService,s.WindowUtils,s.CryptographicUtils,s.FingerPrintingService])],t.StorageService);let oe=class PermissionsRegistrationService{constructor(e,t){this.permissionService=e;this.sharedDataService=t}registerRulesAndPermissions(){this.permissionService.registerRule({names:["se.slot.belongs.to.page"],verify:e=>this.sharedDataService.get(s.EXPERIENCE_STORAGE_KEY).then((t=>t.pageContext&&t.pageContext.catalogVersionUuid===e[0].context.slotCatalogVersionUuid))});this.permissionService.registerPermission({aliases:["se.slot.not.external"],rules:["se.slot.belongs.to.page"]})}};oe=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.IPermissionService,s.ISharedDataService])],oe);let ne=class CatalogService extends s.ICatalogService{constructor(e,t,i,o,n,s,a){super();this.logService=e;this.sharedDataService=t;this.siteService=i;this.urlService=o;this.contentCatalogRestService=n;this.productCatalogRestService=s;this.storageService=a;this.SELECTED_SITE_COOKIE_NAME="seselectedsite"}getContentCatalogsForSite(e){return this.contentCatalogRestService.get({siteUID:e}).then((e=>e.catalogs))}getCatalogByVersion(e,t){return this.getContentCatalogsForSite(e).then((e=>e.filter((e=>e.versions.some((e=>e.version===t))))))}isContentCatalogVersionNonActive(e){return this._getContext(e).then((e=>this.getContentCatalogsForSite(e[s.CONTEXT_SITE_ID]).then((t=>{const i=t.find((t=>t.catalogId===e[s.CONTEXT_CATALOG]));const o=i?i.versions.find((t=>t.version===e[s.CONTEXT_CATALOG_VERSION])):null;if(!o){throw new Error(`Invalid uriContext ${e}, cannot find catalog version.`)}return!o.active}))))}getContentCatalogActiveVersion(e){return this._getContext(e).then((e=>this.getContentCatalogsForSite(e[s.CONTEXT_SITE_ID]).then((t=>{const i=t.find((t=>t.catalogId===e[s.CONTEXT_CATALOG]));const o=i?i.versions.find((e=>e.active)):null;if(!o){throw new Error(`Invalid uriContext ${e}, cannot find catalog version.`)}return o.version}))))}getActiveContentCatalogVersionByCatalogId(e){return this._getContext().then((t=>this.getContentCatalogsForSite(t[s.CONTEXT_SITE_ID]).then((t=>{const i=t.find((t=>t.catalogId===e));const o=i?i.versions.find((e=>e.active)):null;if(!o){throw new Error(`Invalid content catalog ${e}, cannot find any active catalog version.`)}return o.version}))))}getContentCatalogVersion(e){return this._getContext(e).then((e=>this.getContentCatalogsForSite(e[s.CONTEXT_SITE_ID]).then((t=>{const i=t.find((t=>t.catalogId===e[s.CONTEXT_CATALOG]));if(!i){throw new Error("no catalog "+e[s.CONTEXT_CATALOG]+" found for site "+e[s.CONTEXT_SITE_ID])}const o=i.versions.find((t=>t.version===e[s.CONTEXT_CATALOG_VERSION]));if(!o){throw new Error(`no catalogVersion ${e[s.CONTEXT_CATALOG_VERSION]} for catalog ${e[s.CONTEXT_CATALOG]} and site ${e[s.CONTEXT_SITE_ID]}`)}o.catalogName=i.name;o.catalogId=i.catalogId;return o}))))}getCurrentSiteID(){return this.storageService.getValueFromLocalStorage(this.SELECTED_SITE_COOKIE_NAME,false)}getDefaultSiteForContentCatalog(e){return this.siteService.getSites().then((t=>{const i=t.filter((t=>{const i=A.last(t.contentCatalogs);return i&&i===e}));if(i.length===0){this.logService.warn(`[catalogService] - No default site found for content catalog ${e}`)}else if(i.length>1){this.logService.warn(`[catalogService] - Many default sites found for content catalog ${e}`)}return i[0]}))}getCatalogVersionByUuid(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.getContentCatalogsGrouped(e,t);const o=A.reduce(i,((e,t)=>e.concat(t)),[]);const n=A.flatten(o.map((e=>A.cloneDeep(e.versions).map((t=>{t.catalogName=e.name;t.catalogId=e.catalogId;return t}))))).filter((i=>e===i.uuid&&(!t||t===i.siteDescriptor.uid)))[0];if(!n){const i="Cannot find catalog version with UUID "+e+(t?" in site "+t:"");throw new Error(i)}return this.getCurrentSiteID().then((e=>{n.siteId=e;return n}))}))}getAllContentCatalogsGroupedById(){return this.siteService.getSites().then((e=>{const t=e.map((e=>this.getContentCatalogsForSite(e.uid).then((t=>{t.forEach((t=>{t.versions=t.versions.map((t=>{t.siteDescriptor=e;return t}))}));return t}))));return Promise.all(t)}))}getProductCatalogsBySiteKey(e){return this._getContext().then((t=>this.getProductCatalogsForSite(t[e])))}getProductCatalogsForSite(e){return this.productCatalogRestService.get({siteUID:e}).then((e=>e.catalogs))}getActiveProductCatalogVersionByCatalogId(e){return this.getProductCatalogsBySiteKey(s.CONTEXT_SITE_ID).then((t=>{const i=t.find((t=>t.catalogId===e));const o=i?i.versions.find((e=>e.active)):null;if(!o){throw new Error(`Invalid product catalog ${e}, cannot find any active catalog version.`)}return o.version}))}getCatalogVersionUUid(e){return this.getContentCatalogVersion(e).then((e=>e.uuid))}retrieveUriContext(e){return this._getContext(e)}returnActiveCatalogVersionUIDs(e){return e.reduce(((e,t)=>{e.push(t.versions.find((e=>e.active)).uuid);return e}),[])}isCurrentCatalogMultiCountry(){return this.sharedDataService.get(s.EXPERIENCE_STORAGE_KEY).then((e=>{if(e&&e.siteDescriptor&&e.catalogDescriptor){const t=e.siteDescriptor.uid;const i=e.catalogDescriptor.catalogId;return this.getContentCatalogsForSite(t).then((e=>{const t=e.find((e=>e.catalogId===i));return Promise.resolve(t&&t.parents&&t.parents.length?true:false)}))}return false}))}_getContext(e){return e?Promise.resolve(e):this.sharedDataService.get(s.EXPERIENCE_STORAGE_KEY).then((e=>{if(!e){throw new Error("catalogService was not provided with a uriContext and could not retrive an experience from sharedDataService")}return this.urlService.buildUriContext(e.siteDescriptor.uid,e.catalogDescriptor.catalogId,e.catalogDescriptor.catalogVersion)}))}getContentCatalogsGrouped(e,t){return __awaiter(this,void 0,void 0,(function*(){let i=[];const o=yield this.getCurrentSiteID();if(t!==undefined||o!==undefined){const n=yield this.getContentCatalogsForSite(t!==undefined?t:o);const s=yield this.siteService.getSiteById(t!==undefined?t:o);let a=false;n.forEach((t=>{t.versions.forEach((t=>{if(t.uuid===e){t.siteDescriptor=s;a=true}}))}));if(a){i.push(n)}}if(i.length===0){i=yield this.getAllContentCatalogsGroupedById()}return i}))}};__decorate([s.Cached({actions:[s.rarelyChangingContent],tags:[s.catalogEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],ne.prototype,"getProductCatalogsForSite",null);__decorate([s.Cached({actions:[s.rarelyChangingContent],tags:[s.pageChangeEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],ne.prototype,"isCurrentCatalogMultiCountry",null);ne=__decorate([s.GatewayProxied(),n.Injectable(),__metadata("design:paramtypes",[s.LogService,s.ISharedDataService,Z,s.IUrlService,s.ContentCatalogRestService,s.ProductCatalogRestService,s.IStorageService])],ne);let se=class UrlService extends s.IUrlService{constructor(e,t,i){super();this.router=e;this.location=t;this.windowUtils=i}openUrlInPopup(e){const t=this.windowUtils.getWindow().open(e,"_blank","toolbar=no, scrollbars=yes, resizable=yes");t.focus()}path(e){this.location.go(e);this.router.navigateByUrl(e)}};se=__decorate([s.GatewayProxied("openUrlInPopup","path"),n.Injectable(),__metadata("design:paramtypes",[m.Router,p.Location,s.WindowUtils])],se);let ae=class WaitDialogService extends s.IWaitDialogService{constructor(e){super();this.modalService=e;this.modalRef=null}showWaitModal(e){const t={component:s.WaitDialogComponent,data:{customLoadingMessageLocalizedKey:e},config:{backdropClickCloseable:false,dialogPanelClass:"se-wait-spinner-dialog",focusTrapped:false}};if(this.modalRef===null){this.modalRef=this.modalService.open(t)}}hideWaitModal(){if(this.modalRef!=null){this.modalRef.close();this.modalRef=null}}};ae=__decorate([s.GatewayProxied(),__metadata("design:paramtypes",[s.ModalService])],ae);class MemoryStorage{constructor(){this.data={}}clear(){this.data={};return Promise.resolve(true)}dispose(){return Promise.resolve(true)}find(e){return this.get(e).then((e=>[e]))}get(e){return Promise.resolve(this.data[this.getKey(e)])}getLength(){return Promise.resolve(Object.keys(this.data).length)}put(e,t){this.data[this.getKey(t)]=e;return Promise.resolve(true)}remove(e){const t=this.data[this.getKey(e)];delete this.data[this.getKey(e)];return Promise.resolve(t)}entries(){const e=[];Object.keys(this.data).forEach((t=>{e.push([JSON.parse(t),this.data[t]])}));return Promise.resolve(e)}getKey(e){return JSON.stringify(e)}}class MemoryStorageController{constructor(e){this.storages={};this.storageType=e.getProperty("STORAGE_TYPE_IN_MEMORY")}getStorage(e){let t=this.storages[e.storageId];if(!t){t=new MemoryStorage}this.storages[e.storageId]=t;return Promise.resolve(t)}deleteStorage(e){delete this.storages[e];return Promise.resolve(true)}getStorageIds(){return Promise.resolve(Object.keys(this.storages))}}class WebStorage{constructor(e,t){this.controller=e;this.storageConfiguration=t}static ERR_INVALID_QUERY_OBJECT(e,t){return new Error(`WebStorage exception for storage [${t}]. Invalid key [${e}]`)}clear(){this.controller.saveStorageData({});return Promise.resolve(true)}find(e){if(e===undefined){throw WebStorage.ERR_INVALID_QUERY_OBJECT(e,this.storageConfiguration.storageId)}return this.get(e).then((e=>[e]))}get(e){return this.controller.getStorageData().then((t=>{const i=this.getKeyFromQueryObj(e);return Promise.resolve(t[i])}))}put(e,t){return this.controller.getStorageData().then((i=>{i[this.getKeyFromQueryObj(t)]=e;this.controller.saveStorageData(i);return Promise.resolve(true)}))}remove(e){if(e===undefined){throw WebStorage.ERR_INVALID_QUERY_OBJECT(e,this.storageConfiguration.storageId)}const t=this.get(e);return this.controller.getStorageData().then((i=>{delete i[this.getKeyFromQueryObj(e)];this.controller.saveStorageData(i);return t}))}getLength(){return this.controller.getStorageData().then((e=>Promise.resolve(Object.keys(e).length)))}dispose(){return Promise.resolve(true)}entries(){const e=[];return new Promise((t=>{this.controller.getStorageData().then((i=>{Object.keys(i).forEach((t=>{e.push([JSON.parse(t),i[t]])}));t(e)}))}))}getKeyFromQueryObj(e){return JSON.stringify(e)}}class WebStorageBridge{constructor(e,t){this.controller=e;this.configuration=t}saveStorageData(e){return this.controller.saveStorageData(this.configuration.storageId,e)}getStorageData(){return this.controller.getStorageData(this.configuration.storageId)}}class AbstractWebStorageController{getStorage(e){const t=new WebStorageBridge(this,e);const i=new WebStorage(t,e);const o=i.dispose;i.dispose=()=>this.deleteStorage(e.storageId).then((()=>o()));return Promise.resolve(i)}deleteStorage(e){const t=this.getWebStorageContainer();delete t[e];this.setWebStorageContainer(t);return Promise.resolve(true)}getStorageIds(){const e=Object.keys(this.getWebStorageContainer());return Promise.resolve(e)}saveStorageData(e,t){const i=this.getWebStorageContainer();i[e]=t;this.setWebStorageContainer(i);return Promise.resolve(true)}getStorageData(e){const t=this.getWebStorageContainer();if(t[e]){return Promise.resolve(t[e])}return Promise.resolve({})}setWebStorageContainer(e){this.getStorageApi().setItem(this.getStorageRootKey(),JSON.stringify(e))}getWebStorageContainer(){const e=this.getStorageApi().getItem(this.getStorageRootKey());if(!e){return{}}return JSON.parse(e)}}class LocalStorageController extends AbstractWebStorageController{constructor(e){super();this.storagePropertiesService=e;this.storageType=this.storagePropertiesService.getProperty("STORAGE_TYPE_LOCAL_STORAGE")}getStorageApi(){return window.localStorage}getStorageRootKey(){return this.storagePropertiesService.getProperty("LOCAL_STORAGE_ROOT_KEY")}}class SessionStorageController extends AbstractWebStorageController{constructor(e){super();this.storagePropertiesService=e;this.storageType=this.storagePropertiesService.getProperty("STORAGE_TYPE_SESSION_STORAGE")}getStorageApi(){return window.sessionStorage}getStorageRootKey(){return this.storagePropertiesService.getProperty("SESSION_STORAGE_ROOT_KEY")}}let re=class StorageManagerGateway{constructor(e){this.storageManager=e}getStorageSanitityCheck(e){return this.storageManager.getStorage(e).then((()=>true),(()=>false))}deleteExpiredStorages(e){return this.storageManager.deleteExpiredStorages(e)}deleteStorage(e,t){return this.storageManager.deleteStorage(e,t)}hasStorage(e){return this.storageManager.hasStorage(e)}getStorage(e){throw new Error(`getStorage() is not supported from the StorageManagerGateway, please use the storage manager directly`)}registerStorageController(e){throw new Error(`registerStorageController() is not supported from the StorageManagerGateway, please use the storage manager directly`)}};re=__decorate([s.GatewayProxied("getStorageSanitityCheck","deleteExpiredStorages","deleteStorage","hasStorage"),__param(0,n.Inject(s.DO_NOT_USE_STORAGE_MANAGER_TOKEN)),__metadata("design:paramtypes",[s.IStorageManager])],re);let le=class StorageGateway{constructor(e){this.storageManager=e}handleStorageRequest(e,t,i){return new Promise(((o,n)=>{this.storageManager.getStorage(e).then((e=>o(e[t](...i))),(e=>n(e)))}))}};le=__decorate([s.GatewayProxied(),__param(0,n.Inject(s.DO_NOT_USE_STORAGE_MANAGER_TOKEN)),__metadata("design:paramtypes",[s.IStorageManager])],le);class MetaDataMapStorage{constructor(e){this.storageKey=e}getAll(){const e=[];const t=this.getDataFromStore();Object.keys(t).forEach((i=>{e.push(t[i])}));return e}get(e){return this.getDataFromStore()[e]}put(e,t){const i=this.getDataFromStore();i[e]=t;this.setDataInStore(i)}remove(e){const t=this.getDataFromStore();delete t[e];this.setDataInStore(t)}removeAll(){window.localStorage.removeItem(this.storageKey)}getDataFromStore(){try{const e=window.localStorage.getItem(this.storageKey);if(e===null){return{}}return JSON.parse(e)}catch(e){return{}}}setDataInStore(e){window.localStorage.setItem(this.storageKey,JSON.stringify(e))}}var ce;let de=ce=class StorageManager{constructor(e,t){this.logService=e;this.storagePropertiesService=t;this.storageControllers={};this.storages={};this.storageMetaDataMap=new MetaDataMapStorage(this.storagePropertiesService.getProperty("LOCAL_STORAGE_KEY_STORAGE_MANAGER_METADATA"))}static ERR_NO_STORAGE_TYPE_CONTROLLER(e){return new Error(`StorageManager Error: Cannot create storage. No Controller available to handle type [${e}]`)}registerStorageController(e){this.storageControllers[e.storageType]=e}getStorage(e){this.setDefaultStorageOptions(e);const t=this.hasStorage(e.storageId);let i=Promise.resolve(true);if(t){const t=this.storageMetaDataMap.get(e.storageId);i=this.verifyMetaData(t,e)}return new Promise(((t,o)=>{i.then((()=>{if(this.storages[e.storageId]){this.updateStorageMetaData(e);t(this.storages[e.storageId])}else{this.getStorageController(e.storageType).getStorage(e).then((i=>{this.applyDisposeDecorator(e.storageId,i);this.updateStorageMetaData(e);this.storages[e.storageId]=i;t(i)}))}})).catch((e=>o(e)))}))}hasStorage(e){return!!this.storageMetaDataMap.get(e)}deleteStorage(e,t=false){delete this.storages[e];if(!this.hasStorage(e)){return Promise.resolve(true)}const i=this.storageMetaDataMap.get(e);if(i){let o;try{o=this.getStorageController(i.storageType)}catch(i){if(t){this.storageMetaDataMap.remove(e)}return Promise.resolve(true)}return o.deleteStorage(e).then((()=>{this.storageMetaDataMap.remove(e);return Promise.resolve(true)}))}else{return Promise.resolve(true)}}deleteExpiredStorages(e=false){const t=[];const i=this.storageMetaDataMap.getAll();i.forEach((i=>{if(this.isStorageExpired(i)){t.push(this.deleteStorage(i.storageId,e))}}));return Promise.all(t).then((()=>true),(()=>false))}updateStorageMetaData(e){this.storageMetaDataMap.put(e.storageId,{storageId:e.storageId,storageType:e.storageType,storageVersion:e.storageVersion,lastAccess:Date.now()})}isStorageExpired(e){const t=Date.now()-e.lastAccess;let i=e.expiresAfterIdle;if(i===undefined){i=this.storagePropertiesService.getProperty("STORAGE_IDLE_EXPIRY")}return t>=i}applyDisposeDecorator(e,t){const i=t.dispose;t.dispose=()=>this.deleteStorage(e).then((()=>i()))}getStorageController(e){const t=this.storageControllers[e];if(!t){throw ce.ERR_NO_STORAGE_TYPE_CONTROLLER(e)}return t}verifyMetaData(e,t){if(e.storageVersion!==t.storageVersion){this.logService.warn(`StorageManager - Removing old storage version for storage ${e.storageId}`);return this.deleteStorage(e.storageId)}if(e.storageType!==t.storageType){this.logService.warn(`StorageManager - Detected a change in storage type for existing storage. Removing old storage with id ${t.storageId}`);return this.deleteStorage(e.storageId)}return Promise.resolve(true)}setDefaultStorageOptions(e){if(!e.storageVersion||e.storageVersion.length<=0){e.storageVersion="0"}}};de=ce=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.LogService,s.IStoragePropertiesService])],de);const pe={STORAGE_IDLE_EXPIRY:1e3*60*60*24*30,STORAGE_TYPE_LOCAL_STORAGE:"se.storage.type.localstorage",STORAGE_TYPE_SESSION_STORAGE:"se.storage.type.sessionstorage",STORAGE_TYPE_IN_MEMORY:"se.storage.type.inmemory",LOCAL_STORAGE_KEY_STORAGE_MANAGER_METADATA:"se.storage.storagemanager.metadata",LOCAL_STORAGE_ROOT_KEY:"se.storage.root",SESSION_STORAGE_ROOT_KEY:"se.storage.root"};let me=class StoragePropertiesService{constructor(e){this.properties=A.cloneDeep(pe);e.forEach((e=>{A.merge(this.properties,e)}))}getProperty(e){return this.properties[e]}};me=__decorate([n.Injectable(),__param(0,n.Inject(s.STORAGE_PROPERTIES_TOKEN)),__metadata("design:paramtypes",[Array])],me);var ge;let ue=ge=class StorageModule{static forRoot(e={}){return{ngModule:ge,providers:[{provide:s.STORAGE_PROPERTIES_TOKEN,multi:true,useValue:e}]}}};ue=ge=__decorate([n.NgModule({providers:[{provide:s.IStoragePropertiesService,useClass:me},{provide:s.DO_NOT_USE_STORAGE_MANAGER_TOKEN,useClass:de},{provide:s.IStorageGateway,useClass:le},{provide:s.IStorageManagerGateway,useClass:re},{provide:s.IStorageManagerFactory,useFactory:(e,t)=>new s.StorageManagerFactory(t),deps:[s.LogService,s.DO_NOT_USE_STORAGE_MANAGER_TOKEN]},{provide:s.IStorageManager,useFactory:e=>e.getStorageManager("se.nsp"),deps:[s.IStorageManagerFactory]},s.moduleUtils.initialize(((e,t)=>{t.registerStorageController(new LocalStorageController(e));t.registerStorageController(new SessionStorageController(e));t.registerStorageController(new MemoryStorageController(e))}),[s.IStoragePropertiesService,s.IStorageManager])]})],ue);var he;const _e="se.permission.service.default.rule";let ve=he=class PermissionService extends s.IPermissionService{constructor(e,t,i){super();this.logService=e;this.systemEventService=t;this.crossFrameEventService=i;this._registerEventHandlers()}static resetForTests(){he.rules=[];he.permissionsRegistry=[];he.cachedResults={}}static hasCacheRegion(e){return he.cachedResults.hasOwnProperty(e)}static getCacheRegion(e){return he.cachedResults[e]}getPermission(e){return he.permissionsRegistry.find((t=>t.aliases.indexOf(e)>-1))}unregisterDefaultRule(){const e=this._getRule(_e);if(e){he.rules.splice(he.rules.indexOf(e),1)}}registerPermission(e){this._validatePermission(e);he.permissionsRegistry.push({aliases:e.aliases,rules:e.rules})}hasCachedResult(e,t){return he.hasCacheRegion(e)&&he.getCacheRegion(e).hasOwnProperty(t)}clearCache(){he.cachedResults={};this.crossFrameEventService.publish(s.EVENTS.PERMISSION_CACHE_CLEANED).catch((e=>{this.logService.debug(`PermissionService - clearCache: ${e}`)}))}isPermitted(e){const t=this._mapRuleNameToPermissionNames(e);const i=this._getRulePromises(t);const o=Object.keys(i);const n=o.map((e=>i[e]));const onSuccess=e=>{const i=o.reduce(((t,i,o)=>{t[i]=e[o];return t}),{});this._updateCache(t,i);return true};const onError=e=>{if(e===false){return e}this.logService.error(e);return e===undefined?false:e};return Promise.all(n).then(onSuccess,onError)}_addRulePromise(e,t,i){const o=this._getRule(i);const n=t[i];const s=this._generateCacheKey(n);let a;if(this.hasCachedResult(i,s)){a=Promise.resolve(this._getCachedResult(i,s))}else{a=this._callRuleVerify(o.names.join("-"),n).then((e=>e?Promise.resolve(true):Promise.reject(false)))}e[i]=a}_isPermissionNameValid(e){const t=/^[A-Za-z0-9_\-]+\.[A-Za-z0-9_\-\.]+/;return t.test(e)}_getRulePromises(e){const t={};Object.keys(e).forEach((i=>{this._addRulePromise.call(this,t,e,i)}));return t}_hasDefaultRule(){return!!this._getRule(_e)}_getCachedResult(e,t){return he.hasCacheRegion(e)?he.getCacheRegion(e)[t]:null}_generateCacheKey(e){return JSON.stringify(e.sort(((e,t)=>{const i=e.name;const o=t.name;return i===o?0:i<o?-1:1})))}_removeDuplicatePermissionNames(e){Object.keys(e).forEach((t=>{e[t]=e[t].filter((i=>{const o=e[t].find((e=>e.name===i.name));if(o===i){return true}else{const e=o.context;const t=i.context;return JSON.stringify(e)!==JSON.stringify(t)}}))}))}_mapRuleNameToPermissionNames(e){const t={};e.forEach((e=>{if(!e.names){throw Error("Requested Permission requires at least one name")}const i=e.names;const o=e.context;i.forEach((e=>{this._populateRulePermissionNames(t,e,o)}))}));this._removeDuplicatePermissionNames(t);return t}_populateRulePermissionNames(e,t,i){const o=this.getPermission(t);const n=!!o&&!!o.rules&&o.rules.length>0;if(n){o.rules.forEach((o=>{this._addPermissionName(e,o,t,i)}))}else if(this._hasDefaultRule()){this._addPermissionName(e,_e,t,i)}else{throw Error("Permission has no rules")}}_addPermissionName(e,t,i,o){const n=this._getRule(t);if(!n){throw Error("Permission found but no rule found named: "+t)}t=n.names[0];if(!e.hasOwnProperty(t)){e[t]=[]}e[t].push({name:i,context:o})}_getRule(e){return he.rules.find((t=>t.names.indexOf(e)>-1))}_validationRule(e){e.names.forEach((e=>{if(this._getRule(e)){throw Error("Rule already exists: "+e)}}))}_validatePermission(e){if(!(e.aliases instanceof Array)){throw Error("Permission aliases must be an array")}if(e.aliases.length<1){throw Error("Permission requires at least one alias")}if(!(e.rules instanceof Array)){throw Error("Permission rules must be an array")}if(e.rules.length<1){throw Error("Permission requires at least one rule")}e.aliases.forEach((e=>{if(this.getPermission(e)){throw Error("Permission already exists: "+e)}if(!this._isPermissionNameValid(e)){throw Error("Permission aliases must be prefixed with namespace and a full stop")}}));e.rules.forEach((e=>{if(!this._getRule(e)){throw Error("Permission found but no rule found named: "+e)}}))}_updateCache(e,t){Object.keys(t).forEach((i=>{const o=this._generateCacheKey(e[i]);const n=t[i];this._addCachedResult(i,o,n)}))}_addCachedResult(e,t,i){if(!he.hasCacheRegion(e)){he.cachedResults[e]={}}he.cachedResults[e][t]=i}_registerRule(e){this._validationRule(e);if(e.names&&e.names.length&&e.names.indexOf(_e)>-1){throw Error("Register default rule using permissionService.registerDefaultRule()")}he.rules.push({names:e.names})}_registerDefaultRule(e){this._validationRule(e);if(e.names&&e.names.length&&e.names.indexOf(_e)===-1){throw Error("Default rule name must be DEFAULT_RULE_NAME")}he.rules.push({names:e.names})}_callRuleVerify(e,t){if(this.ruleVerifyFunctions&&this.ruleVerifyFunctions[e]){return this.ruleVerifyFunctions[e].verify(t)}return this._remoteCallRuleVerify(e,t)}_registerEventHandlers(){this.crossFrameEventService.subscribe(s.EVENTS.USER_HAS_CHANGED,this.clearCache.bind(this));this.systemEventService.subscribe(s.EVENTS.EXPERIENCE_UPDATE,this.clearCache.bind(this));this.crossFrameEventService.subscribe(s.EVENTS.PAGE_CHANGE,this.clearCache.bind(this));this.crossFrameEventService.subscribe(s.EVENT_PERSPECTIVE_CHANGED,this.clearCache.bind(this))}_remoteCallRuleVerify(e,t){"proxyFunction";return null}};ve.rules=[];ve.permissionsRegistry=[];ve.cachedResults={};ve=he=__decorate([s.GatewayProxied("isPermitted","clearCache","registerPermission","unregisterDefaultRule","registerDefaultRule","registerRule","_registerRule","_remoteCallRuleVerify","_registerDefaultRule"),__metadata("design:paramtypes",[s.LogService,s.SystemEventService,s.CrossFrameEventService])],ve);let fe=class CatalogVersionPermissionRestService{constructor(e,t){this.restServiceFactory=e;this.sessionService=t;this.URI="/permissionswebservices/v1/permissions/catalogs/search"}getCatalogVersionPermissions(e,t){this.validateParams(e,t);return this.sessionService.getCurrentUsername().then((i=>{const o=this.restServiceFactory.get(this.URI);return o.queryByPost({principalUid:i},{catalogId:e,catalogVersion:t}).then((({permissionsList:e})=>e[0]||{}))}))}validateParams(e,t){if(!e){throw new Error("catalog.version.permission.service.catalogid.is.required")}if(!t){throw new Error("catalog.version.permission.service.catalogversion.is.required")}}};__decorate([s.Cached({actions:[s.rarelyChangingContent],tags:[s.userEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[String,String]),__metadata("design:returntype",Promise)],fe.prototype,"getCatalogVersionPermissions",null);fe=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.RestServiceFactory,s.ISessionService])],fe);window.__smartedit__.addDecoratorPayload("Component","HeartBeatAlertComponent",{selector:"se-heartbeat-alert",template:`<div><span>{{ 'se.heartbeat.failure1' | translate }}</span> <span><a style="cursor:pointer" (click)="switchToPreviewMode()">{{ 'se.heartbeat.failure2' | translate }}</a></span></div>`});let ye=class HeartBeatAlertComponent{constructor(e,t,i){this.alertRef=e;this.perspectiveService=t;this.crossFrameEventService=i}switchToPreviewMode(){this.alertRef.dismiss();this.perspectiveService.switchTo(s.NONE_PERSPECTIVE);this.crossFrameEventService.publish(s.EVENT_STRICT_PREVIEW_MODE_REQUESTED,true)}};ye=__decorate([n.Component({selector:"se-heartbeat-alert",template:`<div><span>{{ 'se.heartbeat.failure1' | translate }}</span> <span><a style="cursor:pointer" (click)="switchToPreviewMode()">{{ 'se.heartbeat.failure2' | translate }}</a></span></div>`}),__param(2,n.Inject(s.EVENT_SERVICE)),__metadata("design:paramtypes",[u.AlertRef,s.IPerspectiveService,s.CrossFrameEventService])],ye);let Se=class AlertFactory extends s.BaseAlertFactory{constructor(e,t,i){super(e,t,i)}createAlert(e){e=this.getAlertConfigFromStringOrConfig(e);return super.createAlert(e)}createInfo(e){e=this.getAlertConfigFromStringOrConfig(e);e.type=s.IAlertServiceType.INFO;return super.createInfo(e)}createDanger(e){e=this.getAlertConfigFromStringOrConfig(e);e.type=s.IAlertServiceType.DANGER;return super.createDanger(e)}createWarning(e){e=this.getAlertConfigFromStringOrConfig(e);e.type=s.IAlertServiceType.WARNING;return super.createWarning(e)}createSuccess(e){e=this.getAlertConfigFromStringOrConfig(e);e.type=s.IAlertServiceType.SUCCESS;return super.createSuccess(e)}getAlertConfigFromStringOrConfig(e){if(typeof e==="string"){return{message:e,minWidth:"",mousePersist:true,duration:1e3,dismissible:true,width:"300px"}}const t=e;return Object.assign({},t)}};Se=__decorate([n.Injectable(),__param(2,n.Inject(s.ALERT_CONFIG_DEFAULTS_TOKEN)),__metadata("design:paramtypes",[u.AlertService,g.TranslateService,u.AlertConfig])],Se);let Ce=class AlertService extends s.BaseAlertService{constructor(e){super(e);this._alertFactory=e}showAlert(e){e=this._alertFactory.getAlertConfigFromStringOrConfig(e);super.showAlert(e)}showInfo(e){e=this._alertFactory.getAlertConfigFromStringOrConfig(e);super.showInfo(e)}showDanger(e){e=this._alertFactory.getAlertConfigFromStringOrConfig(e);super.showDanger(e)}showWarning(e){e=this._alertFactory.getAlertConfigFromStringOrConfig(e);super.showWarning(e)}showSuccess(e){e=this._alertFactory.getAlertConfigFromStringOrConfig(e);super.showSuccess(e)}};Ce=__decorate([s.GatewayProxied(),n.Injectable(),__metadata("design:paramtypes",[Se])],Ce);t.AlertServiceModule=class AlertServiceModule{};t.AlertServiceModule=__decorate([n.NgModule({imports:[s.AlertModule],providers:[Se,{provide:s.IAlertService,useClass:Ce}]})],t.AlertServiceModule);var be;let Ie=be=class HeartBeatService{constructor(e,t,i,o,n,a,r,l){this.HEART_BEAT_TIMEOUT_THRESHOLD_MS=e;this.routingService=i;this.windowUtils=o;this.crossFrameEventService=a;this.sharedDataService=l;this.reconnectingInProgress=false;this.resetAndStop=()=>{this.reconnectingInProgress=false;if(this.cancellableTimeoutTimer){clearTimeout(this.cancellableTimeoutTimer);this.cancellableTimeoutTimer=null}this.reconnectingAlert.hide();this.reconnectedAlert.hide()};this.connectionLost=()=>{this.resetAndStop();if(!!this.windowUtils.getGatewayTargetFrame()){this.reconnectingAlert.show()}this.reconnectingInProgress=true};this.reconnectingAlert=n.createInfo({component:ye,duration:-1,dismissible:false,minWidth:"",mousePersist:true,width:"300px"});this.reconnectedAlert=n.createInfo({message:t.instant("se.heartbeat.reconnection"),duration:1e3,minWidth:"",mousePersist:true,dismissible:true,width:"300px"});const d=r.createGateway(be.HEART_BEAT_GATEWAY_ID);d.subscribe(be.HEART_BEAT_MSG_ID,(()=>this.heartBeatReceived()));this.crossFrameEventService.subscribe(s.EVENTS.PAGE_CHANGE,(()=>{this.resetAndStop();return this.heartBeatReceived()}));this.routingService.routeChangeSuccess().subscribe((e=>{const t=this.routingService.getCurrentUrlFromEvent(e);if(t===s.STORE_FRONT_CONTEXT){return this.heartBeatReceived()}return Promise.resolve()}));this.routingService.routeChangeStart().subscribe((()=>{this.resetAndStop()}))}heartBeatReceived(){const e=this.reconnectingInProgress;this.resetAndStop();if(e){if(!!this.windowUtils.getGatewayTargetFrame()){this.reconnectedAlert.show()}this.reconnectingInProgress=false;this.crossFrameEventService.publish(s.EVENT_STRICT_PREVIEW_MODE_REQUESTED,false)}return this.sharedDataService.get("configuration").then((({heartBeatTimeoutThreshold:e})=>{if(!e){e=this.HEART_BEAT_TIMEOUT_THRESHOLD_MS}this.cancellableTimeoutTimer=this.windowUtils.runTimeoutOutsideAngular(this.connectionLost,+e)}))}};Ie.HEART_BEAT_GATEWAY_ID="heartBeatGateway";Ie.HEART_BEAT_MSG_ID="heartBeat";Ie=be=__decorate([n.Injectable(),__param(0,n.Inject(s.HEART_BEAT_TIMEOUT_THRESHOLD_MS_TOKEN)),__metadata("design:paramtypes",[Number,g.TranslateService,s.SmarteditRoutingService,s.WindowUtils,Se,s.CrossFrameEventService,s.GatewayFactory,s.ISharedDataService])],Ie);let Ee=class ConfigurationService{constructor(e,t,i){this.logService=e;this.loadConfigManagerService=t;this.restServiceFactory=i;this.ABSOLUTE_URI_NOT_APPROVED="URI_EXCEPTION";this.ABSOLUTE_URI_REGEX=/(\"[A-Za-z]+:\/|\/\/)/;this.configuration=[];this.editorCRUDService=this.restServiceFactory.get(s.CONFIGURATION_URI,"key")}addEntry(){const e={key:"",value:"",isNew:true,uuid:A.uniqueId()};this.configuration=[e,...this.configuration||[]]}removeEntry(e,t){if(e.isNew){this.configuration=this.configuration.filter((t=>!t.isNew||t.key!==e.key))}else{t.form.markAsDirty();e.toDelete=true}}filterConfiguration(){return(this.configuration||[]).filter((e=>!e.toDelete))}filterErrorConfiguration(){return(this.configuration||[]).filter((e=>e.hasErrors))}validateUserInput(e){if(!e.value){return}e.requiresUserCheck=!!e.value.match(this.ABSOLUTE_URI_REGEX)}submit(e){if(!e.dirty||!this.isValid(e)){return Promise.reject([])}e.form.markAsPristine();return Promise.all(this.configuration.map(((e,t)=>this.reconstructConfigurationEntry(e,t))))}init(e){this.loadCallback=e||A.noop;return this.loadAndPresent()}reconstructConfigurationEntry(e,t){const i=s.objectUtils.copy(e);let o;i.secured=false;delete i.toDelete;delete i.errors;delete i.uuid;try{if(e.toDelete){o="remove"}else if(i.isNew){o="save";i.value=this.validate(i)}else{o="update";i.value=this.validate(i)}}catch(t){e.hasErrors=true;if(t instanceof s.Errors.ParseError){this.addValueError(e,"se.configurationform.json.parse.error")}return Promise.reject({})}delete i.isNew;e.hasErrors=false;return this.editorCRUDService[o](i).then((()=>{switch(o){case"save":delete e.isNew;break;case"remove":this.configuration.splice(t,1);break}return Promise.resolve({})}),(()=>{this.addValueError(e,"configurationform.save.error");return Promise.reject({})}))}reset(e){this.configuration=s.objectUtils.copy(this.pristine);if(e){e.form.markAsPristine()}if(this.loadCallback){this.loadCallback()}}addError(e,t,i){e.hasErrors=true;e.errors=e.errors||{};e.errors[t]=e.errors[t]||[];e.errors[t].push({message:i})}addKeyError(e,t){this.addError(e,"keys",t)}addValueError(e,t){this.addError(e,"values",t)}prettify(e){const t=s.objectUtils.copy(e);t.forEach((e=>{try{e.value=JSON.stringify(JSON.parse(e.value),null,2)}catch(t){this.addValueError(e,"se.configurationform.json.parse.error")}}));return t}loadAndPresent(){return new Promise(((e,t)=>this.loadConfigManagerService.loadAsArray().then((t=>{this.pristine=this.prettify(t.map((e=>Object.assign(Object.assign({},e),{uuid:A.uniqueId()}))));this.reset();e()}),(()=>{this.logService.log("load failed");t()}))))}isValid(e){let t=false;this.configuration.forEach((e=>{delete e.errors}));this.configuration.forEach((e=>{if(s.stringUtils.isBlank(e.key)){this.addKeyError(e,"se.configurationform.required.entry.error");e.hasErrors=true;t=true}if(s.stringUtils.isBlank(e.value)){this.addValueError(e,"se.configurationform.required.entry.error");e.hasErrors=true;t=true}}));return!t&&e.valid&&!this.configuration.reduce(((e,t)=>{if(e.keys.indexOf(t.key)>-1){this.addKeyError(t,"se.configurationform.duplicate.entry.error");e.errors=true}else{e.keys.push(t.key)}return e}),{keys:[],errors:false}).errors}validate(e){if(e.requiresUserCheck&&!e.isCheckedByUser){throw new Error(this.ABSOLUTE_URI_NOT_APPROVED)}else{try{return JSON.stringify(JSON.parse(e.value))}catch(t){throw new s.Errors.ParseError(e.value)}}}};Ee=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.LogService,t.LoadConfigManagerService,s.RestServiceFactory])],Ee);let we=class IframeClickDetectionService extends s.IIframeClickDetectionService{constructor(){super();this.callbacks={}}registerCallback(e,t){this.callbacks[e]=t;return this.removeCallback.bind(this,e)}removeCallback(e){if(this.callbacks[e]){delete this.callbacks[e];return true}return false}onIframeClick(){for(const e in this.callbacks){if(this.callbacks.hasOwnProperty(e)){this.callbacks[e]()}}}};we=__decorate([s.GatewayProxied("onIframeClick"),n.Injectable(),__metadata("design:paramtypes",[])],we);let Te=class RenderService extends s.IRenderService{constructor(e,t,i,o,n,s,a,r,l){super(e,i,o,n,s,t,a,r,l);this.yjQuery=e;this.crossFrameEventService=t;this.systemEventService=i;this.logService=l}blockRendering(e){this.renderingBlocked=e}isRenderingBlocked(){return Promise.resolve(this.renderingBlocked||false)}};Te=__decorate([s.GatewayProxied("blockRendering","isRenderingBlocked","renderSlots","renderComponent","renderRemoval","toggleOverlay","refreshOverlayDimensions","renderPage"),__param(0,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[Function,s.CrossFrameEventService,s.SystemEventService,s.INotificationService,s.IPageInfoService,s.IPerspectiveService,s.WindowUtils,s.ModalService,s.LogService])],Te);window.__smartedit__.addDecoratorPayload("Injectable","TranslationsFetchService",{providedIn:"root"});t.TranslationsFetchService=class TranslationsFetchService extends s.ITranslationsFetchService{constructor(e,t){super();this.httpClient=e;this.promiseUtils=t;this.ready=false}get(e){return this.httpClient.get(`${s.RestServiceFactory.getGlobalBasePath()}${s.I18N_RESOURCE_URI}/${e}`,{responseType:"json"}).pipe(d.map((e=>e.value?e.value:e))).toPromise().then((e=>{this.ready=true;return e}))}isReady(){return Promise.resolve(this.ready)}waitToBeReady(){return this.promiseUtils.resolveToCallbackWhenCondition((()=>this.ready),(()=>{}))}};__decorate([s.Cached({actions:[s.rarelyChangingContent]}),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Promise)],t.TranslationsFetchService.prototype,"get",null);t.TranslationsFetchService=__decorate([s.GatewayProxied(),n.Injectable({providedIn:"root"}),__metadata("design:paramtypes",[a.HttpClient,s.PromiseUtils])],t.TranslationsFetchService);var Pe;(function(e){e["READ"]="read";e["WRITE"]="write"})(Pe||(Pe={}));let Oe=class CatalogVersionPermissionService extends s.ICatalogVersionPermissionService{constructor(e,t){super();this.catalogVersionPermissionRestService=e;this.catalogService=t}hasPermission(e,t,i,o){return __awaiter(this,void 0,void 0,(function*(){const[n,s]=yield Promise.all([this.shouldIgnoreCatalogPermissions(e,t,i,o),this.catalogVersionPermissionRestService.getCatalogVersionPermissions(t,i)]);if(this.isCatalogVersionPermissionResponse(s)){const t=s.permissions.find((t=>t.key===e));const i=t?t.value:"false";return i==="true"||n}return false}))}hasSyncPermissionFromCurrentToActiveCatalogVersion(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.catalogService.retrieveUriContext();return yield this.hasSyncPermissionToActiveCatalogVersion(e[s.CONTEXT_CATALOG],e[s.CONTEXT_CATALOG_VERSION])}))}hasSyncPermissionToActiveCatalogVersion(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.catalogService.getActiveContentCatalogVersionByCatalogId(e);return yield this.hasSyncPermission(e,t,i)}))}hasSyncPermission(e,t,i){return __awaiter(this,void 0,void 0,(function*(){const o=yield this.catalogVersionPermissionRestService.getCatalogVersionPermissions(e,t);if(this.isCatalogVersionPermissionResponse(o)&&o.syncPermissions&&o.syncPermissions.length>0){const e=o.syncPermissions.some((e=>e?e.canSynchronize===true&&e.targetCatalogVersion===i:false));return e}return false}))}hasWritePermissionOnCurrent(){return this.hasCurrentCatalogPermission(Pe.WRITE)}hasReadPermissionOnCurrent(){return this.hasCurrentCatalogPermission(Pe.READ)}hasWritePermission(e,t){return this.hasPermission(Pe.WRITE,e,t)}hasReadPermission(e,t){return this.hasPermission(Pe.READ,e,t)}shouldIgnoreCatalogPermissions(e,t,i,o){return __awaiter(this,void 0,void 0,(function*(){const n=o&&e===Pe.READ?this.catalogService.getActiveContentCatalogVersionByCatalogId(t):Promise.resolve();const s=yield n;return s===i}))}hasCurrentCatalogPermission(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.catalogService.retrieveUriContext();return yield this.hasPermission(e,t[s.CONTEXT_CATALOG],t[s.CONTEXT_CATALOG_VERSION],t[s.CONTEXT_SITE_ID])}))}isCatalogVersionPermissionResponse(e){return!A.isEmpty(e)}};Oe=__decorate([s.GatewayProxied("hasWritePermission","hasReadPermission","hasWritePermissionOnCurrent","hasReadPermissionOnCurrent"),__metadata("design:paramtypes",[fe,s.ICatalogService])],Oe);let Ae=class PreviewDatalanguageDropdownPopulator extends s.DropdownPopulatorInterface{constructor(e){super(A,e)}fetchAll(e){if(e.model[e.field.dependsOn]){const t=e.model[e.field.dependsOn].split("|")[0];return this.getLanguageDropdownChoices(t,e.search)}return Promise.resolve([])}getLanguageDropdownChoices(e,t){return __awaiter(this,void 0,void 0,(function*(){try{const i=yield this.languageService.getLanguagesForSite(e);let o=i.map((({isocode:e,nativeName:t})=>{const i={};i.id=e;i.label=t;return i}));if(t){o=o.filter((e=>e.label.toUpperCase().indexOf(t.toUpperCase())>-1))}return o}catch(e){throw new Error(e)}}))}};Ae=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.LanguageService])],Ae);let xe=class PreviewDatapreviewCatalogDropdownPopulator extends s.DropdownPopulatorInterface{constructor(e,t,i,o){super(A,o);this.catalogService=e;this.sharedDataService=t;this.l10nPipe=i}fetchAll(e){return this.initCatalogVersionDropdownChoices(e.search)}initCatalogVersionDropdownChoices(e){return __awaiter(this,void 0,void 0,(function*(){try{const t=yield this.sharedDataService.get(s.EXPERIENCE_STORAGE_KEY);const i=t.siteDescriptor;const o=yield this.getDropdownChoices(i,e);const n=A.flatten(o).sort(((e,t)=>e.label.localeCompare(t.label)));return n}catch(e){throw new Error(e)}}))}getDropdownChoices(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.catalogService.getContentCatalogsForSite(e.uid);const o=A.flatten(i).map((t=>this.getTranslatedCatalogVersionsOptions(e,t)));const n=yield Promise.all(A.flatten(o));return n.filter((e=>t?e.label.toUpperCase().includes(t.toUpperCase()):true))}))}getTranslatedCatalogVersionsOptions(e,t){return t.versions.map((i=>__awaiter(this,void 0,void 0,(function*(){const o=yield this.l10nPipe.transform(t.name).pipe(d.take(1)).toPromise();return{id:`${e.uid}|${t.catalogId}|${i.version}`,label:`${o} - ${i.version}`}}))))}};xe=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.ICatalogService,s.ISharedDataService,s.L10nPipe,s.LanguageService])],xe);var De;t.CatalogAwareRouteResolverHelper=De=class CatalogAwareRouteResolverHelper{constructor(e,t,i,o,n,s){this.logService=e;this.route=t;this.systemEventService=i;this.experienceService=o;this.sharedDataService=n;this.catalogVersionPermissionService=s}static executeAndCheckCatalogPermissions(e,t,i,o,n){return n().then((()=>e.hasReadPermissionOnCurrent().then((e=>{if(!e){t.info("no permission to access the storefront view with this experience");return Promise.reject()}return i.hasCatalogVersionChanged().then((e=>{if(e){o.publishAsync(s.EVENTS.EXPERIENCE_UPDATE)}return true}))}),(()=>{t.info("failed to evaluate permissions to access the storefront view with this experience");return Promise.reject()}))),(e=>{t.error("could not retrieve experience from storage or route params",e);throw new Error(e)}))}static checkExperienceIsSet(e,t){return new Promise(((i,o)=>{e.getCurrentExperience().then((e=>{if(!e){return o()}t.set(s.EXPERIENCE_STORAGE_KEY,e);return i(e)}))}))}static buildExperienceFromRoute(e,t){return e.buildAndSetExperience(t).then((e=>{if(!e){return Promise.reject()}return e}))}storefrontResolve(){return this.executeAndCheckCatalogPermissions((()=>this.checkExperienceIsSet()))}experienceFromPathResolve(e){return this.executeAndCheckCatalogPermissions((()=>this.buildExperienceFromRoute(e)))}executeAndCheckCatalogPermissions(e){return De.executeAndCheckCatalogPermissions(this.catalogVersionPermissionService,this.logService,this.experienceService,this.systemEventService,e)}checkExperienceIsSet(){return De.checkExperienceIsSet(this.experienceService,this.sharedDataService)}buildExperienceFromRoute(e){return De.buildExperienceFromRoute(this.experienceService,e||this.route.snapshot.params)}};t.CatalogAwareRouteResolverHelper=De=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.LogService,m.ActivatedRoute,s.SystemEventService,s.IExperienceService,s.ISharedDataService,s.ICatalogVersionPermissionService])],t.CatalogAwareRouteResolverHelper);let Re=class StorefrontPageGuard{constructor(e,t){this.catalogAwareResolverHelper=e;this.routing=t}canActivate(){return this.catalogAwareResolverHelper.storefrontResolve().catch((()=>{this.routing.go("/");return false}))}};Re=__decorate([n.Injectable(),__metadata("design:paramtypes",[t.CatalogAwareRouteResolverHelper,s.SmarteditRoutingService])],Re);t.ProductService=class ProductService{constructor(e,t){this.restServiceFactory=e;this.languageService=t;this.productService=this.restServiceFactory.get(s.PRODUCT_RESOURCE_API);this.productListService=this.restServiceFactory.get(s.PRODUCT_LIST_RESOURCE_API)}findProducts(e,t){return __awaiter(this,void 0,void 0,(function*(){this._validateProductCatalogInfo(e);const i=yield this.languageService.getResolveLocale();const o=yield this.productListService.get({catalogId:e.catalogId,catalogVersion:e.catalogVersion,text:t.mask,pageSize:t.pageSize,currentPage:t.currentPage,langIsoCode:i});return o}))}getProductById(e,t){return this.productService.get({siteUID:e,productUID:t})}_validateProductCatalogInfo(e){if(!e.catalogId){throw new Error("[productService] - catalog ID missing.")}if(!e.catalogVersion){throw new Error("[productService] - catalog version missing.")}}};__decorate([s.Cached({actions:[s.rarelyChangingContent],tags:[s.userEvictionTag]}),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],t.ProductService.prototype,"findProducts",null);t.ProductService=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.RestServiceFactory,s.LanguageService])],t.ProductService);let Me=class ComponentHandlerService extends s.IComponentHandlerService{constructor(e){super(e)}};Me=__decorate([s.GatewayProxied("isExternalComponent","reloadInner"),__param(0,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[Function])],Me);window.__smartedit__.addDecoratorPayload("Component","ConfigurationModalComponent",{selector:"se-configuration-modal",template:`<div id="editConfigurationsBody" class="se-config"><form #form="ngForm" novalidate><div class="se-config__sub-header"><span class="se-config__sub-title">{{'se.configurationform.label.keyvalue' | translate}}</span> <button class="fd-button fd-button--compact" type="button" (click)="editor.addEntry()">{{ "se.general.configuration.add.button" | translate }}</button></div><div class="se-config__error" *ngIf="editor.filterErrorConfiguration().length > 0"><span class="error-input help-block">{{'se.configurationform.contain.error'|translate}}</span></div><div class="se-config__entry" *ngFor="let entry of editor.filterConfiguration(); let $index = index"><div class="se-config__entry-data"><div class="se-config__entry-key"><input type="text" [ngClass]="{\n                            'is-error': entry.errors &&  entry.errors.keys && entry.errors.keys.length > 0,\n                            'se-config__entry-key--disabled': !entry.isNew }" name="{{entry.key}}_{{entry.uuid}}_key" placeholder="{{'se.configurationform.header.key.name' | translate}}" [(ngModel)]="entry.key" [required]="true" [disabled]="!entry.isNew" class="se-config__entry-key-input fd-input fd-form__control" [title]="entry.key"/><ng-container *ngIf="entry.errors && entry.errors.keys"><span id="{{entry.key}}_error_{{$index}}" *ngFor="let error of entry.errors.keys; let $index = index" class="error-input help-block">{{error.message|translate}}</span></ng-container></div><div class="se-config__entry-value"><textarea [ngClass]="{'is-error': entry.errors && entry.errors.values && entry.errors.values.length>0}" name="{{entry.key}}_{{entry.uuid}}_value" placeholder="{{'se.configurationform.header.value.name' | translate}}" [(ngModel)]="entry.value" [required]="true" class="se-config__entry-text-area fd-input fd-form__control" (change)="editor.validateUserInput(entry)"></textarea><div *ngIf="entry.requiresUserCheck"><input id="{{entry.key}}_absoluteUrl_check_{{$index}}" type="checkbox" name="{{entry.key}}_{{entry.uuid}}_isCheckedByUser" [(ngModel)]="entry.isCheckedByUser" class="fd-input se-config__entry-value-checkbox"/> <span id="{{entry.key}}_absoluteUrl_msg_{{$index}}" [ngClass]="{\n                                'warning-check-msg': true,\n                                'not-checked': entry.hasErrors && !entry.isCheckedByUser\n                            }">{{'se.configurationform.absoluteurl.check' | translate}}</span></div><ng-container *ngIf="entry.errors && entry.errors.values && entry.errors.values"><span id="{{entry.key}}_error_{{$index}}" *ngFor="let error of entry.errors.values; let $index = index" class="error-input help-block">{{error.message|translate}}</span></ng-container></div></div><button type="button" id="{{entry.key}}_removeButton_{{$index}}" class="se-config__entry-remove-btn fd-button fd-button--transparent sap-icon--delete" (click)="editor.removeEntry(entry, form);"></button></div></form></div>`});let ke=class ConfigurationModalComponent{constructor(e,t,i){this.editor=e;this.modalManager=t;this.confirmationModalService=i}ngOnInit(){this.editor.init();this.form.statusChanges.subscribe((()=>{if(this.form.valid&&this.form.dirty){this.modalManager.enableButton("save")}if(this.form.invalid||!this.form.dirty){this.modalManager.disableButton("save")}}));this.modalManager.addButtons([{id:"save",style:s.ModalButtonStyle.Primary,label:"se.cms.component.confirmation.modal.save",callback:()=>l.from(this.onSave()),disabled:true},{id:"cancel",label:"se.cms.component.confirmation.modal.cancel",style:s.ModalButtonStyle.Default,action:s.ModalButtonAction.Dismiss,callback:()=>l.from(this.onCancel())}])}trackByFn(e,t){return t.uuid}onCancel(){const{dirty:e}=this.form;const t={description:"se.editor.cancel.confirm"};if(!e){return Promise.resolve()}return this.confirmationModalService.confirm(t).then((()=>this.modalManager.close(null)))}onSave(){return this.editor.submit(this.form).then((()=>{this.modalManager.close(null)}))}};__decorate([n.ViewChild("form",{static:true}),__metadata("design:type",h.NgForm)],ke.prototype,"form",void 0);ke=__decorate([n.Component({selector:"se-configuration-modal",template:`<div id="editConfigurationsBody" class="se-config"><form #form="ngForm" novalidate><div class="se-config__sub-header"><span class="se-config__sub-title">{{'se.configurationform.label.keyvalue' | translate}}</span> <button class="fd-button fd-button--compact" type="button" (click)="editor.addEntry()">{{ "se.general.configuration.add.button" | translate }}</button></div><div class="se-config__error" *ngIf="editor.filterErrorConfiguration().length > 0"><span class="error-input help-block">{{'se.configurationform.contain.error'|translate}}</span></div><div class="se-config__entry" *ngFor="let entry of editor.filterConfiguration(); let $index = index"><div class="se-config__entry-data"><div class="se-config__entry-key"><input type="text" [ngClass]="{\n                            'is-error': entry.errors &&  entry.errors.keys && entry.errors.keys.length > 0,\n                            'se-config__entry-key--disabled': !entry.isNew }" name="{{entry.key}}_{{entry.uuid}}_key" placeholder="{{'se.configurationform.header.key.name' | translate}}" [(ngModel)]="entry.key" [required]="true" [disabled]="!entry.isNew" class="se-config__entry-key-input fd-input fd-form__control" [title]="entry.key"/><ng-container *ngIf="entry.errors && entry.errors.keys"><span id="{{entry.key}}_error_{{$index}}" *ngFor="let error of entry.errors.keys; let $index = index" class="error-input help-block">{{error.message|translate}}</span></ng-container></div><div class="se-config__entry-value"><textarea [ngClass]="{'is-error': entry.errors && entry.errors.values && entry.errors.values.length>0}" name="{{entry.key}}_{{entry.uuid}}_value" placeholder="{{'se.configurationform.header.value.name' | translate}}" [(ngModel)]="entry.value" [required]="true" class="se-config__entry-text-area fd-input fd-form__control" (change)="editor.validateUserInput(entry)"></textarea><div *ngIf="entry.requiresUserCheck"><input id="{{entry.key}}_absoluteUrl_check_{{$index}}" type="checkbox" name="{{entry.key}}_{{entry.uuid}}_isCheckedByUser" [(ngModel)]="entry.isCheckedByUser" class="fd-input se-config__entry-value-checkbox"/> <span id="{{entry.key}}_absoluteUrl_msg_{{$index}}" [ngClass]="{\n                                'warning-check-msg': true,\n                                'not-checked': entry.hasErrors && !entry.isCheckedByUser\n                            }">{{'se.configurationform.absoluteurl.check' | translate}}</span></div><ng-container *ngIf="entry.errors && entry.errors.values && entry.errors.values"><span id="{{entry.key}}_error_{{$index}}" *ngFor="let error of entry.errors.values; let $index = index" class="error-input help-block">{{error.message|translate}}</span></ng-container></div></div><button type="button" id="{{entry.key}}_removeButton_{{$index}}" class="se-config__entry-remove-btn fd-button fd-button--transparent sap-icon--delete" (click)="editor.removeEntry(entry, form);"></button></div></form></div>`}),__metadata("design:paramtypes",[Ee,s.ModalManagerService,s.IConfirmationModalService])],ke);let Ne=class ConfigurationModalService{constructor(e){this.modalService=e}editConfiguration(){this.modalService.open({templateConfig:{title:"se.modal.administration.configuration.edit.title"},component:ke,config:{focusTrapped:false,backdropClickCloseable:false}})}};Ne=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.IModalService])],Ne);let Fe=class PageTreeNodeService extends s.IPageTreeNodeService{constructor(){super()}};Fe=__decorate([s.GatewayProxied("getSlotNodes","scrollToElement","existedSmartEditElement"),__metadata("design:paramtypes",[])],Fe);let ze=class PageTreeService extends s.IPageTreeService{constructor(){super()}registerTreeComponent(e){this.item=e;return Promise.resolve()}getTreeComponent(){return Promise.resolve(this.item)}};ze=__decorate([s.GatewayProxied("registerTreeComponent","getTreeComponent"),__metadata("design:paramtypes",[])],ze);let Le=class SmarteditServicesModule{};Le=__decorate([n.NgModule({imports:[s.DragAndDropServiceModule,s.SmarteditCommonsModule,t.AlertServiceModule],providers:[Ie,t.BootstrapService,t.ConfigurationExtractorService,t.DelegateRestService,s.RestServiceFactory,Ee,Ne,Ae,xe,fe,Oe,t.CatalogAwareRouteResolverHelper,Re,s.SmarteditRoutingService,{provide:s.IComponentHandlerService,useClass:Me},{provide:s.ICatalogVersionPermissionService,useClass:Oe},{provide:s.IPermissionService,useClass:ve},{provide:s.IPageInfoService,useClass:ee},{provide:s.IRestServiceFactory,useClass:s.RestServiceFactory},{provide:s.IRenderService,useClass:Te},{provide:s.IAnnouncementService,useClass:j},{provide:s.IPerspectiveService,useClass:ie},{provide:s.IFeatureService,useClass:J},{provide:s.INotificationMouseLeaveDetectionService,useClass:H},{provide:s.IWaitDialogService,useClass:ae},{provide:s.IPreviewService,useClass:te},{provide:s.IDragAndDropCrossOrigin,useClass:Y},oe,{provide:s.INotificationService,useClass:G},{provide:s.IPageTreeNodeService,useClass:Fe},{provide:s.IPageTreeService,useClass:ze},{provide:s.CustomDropdownPopulatorsToken,useClass:xe,multi:true},{provide:s.CustomDropdownPopulatorsToken,useClass:Ae,multi:true},t.ProductService,s.moduleUtils.initialize((e=>{}),[s.IPreviewService])]})],Le);let Ve=class ConfirmationModalService extends s.IConfirmationModalService{constructor(e){super();this.modalService=e}confirm(e){const t=this.modalService.open({component:s.ConfirmDialogComponent,data:e,config:{focusTrapped:false,dialogPanelClass:"se-confirmation-dialog",container:document.querySelector("[uib-modal-window]")||"body"},templateConfig:{title:e.title||"se.confirmation.modal.title",buttons:this.getButtons(e),isDismissButtonVisible:true}});return new Promise(((e,i)=>t.afterClosed.subscribe(e,i)))}getButtons(e){return[{id:"confirmOk",label:"se.confirmation.modal.ok",style:s.ModalButtonStyle.Primary,action:s.ModalButtonAction.Close,callback:()=>l.of(true)},!e.showOkButtonOnly&&{id:"confirmCancel",label:"se.confirmation.modal.cancel",style:s.ModalButtonStyle.Default,action:s.ModalButtonAction.Dismiss,callback:()=>l.of(false)}].filter((e=>!!e))}};Ve=__decorate([s.GatewayProxied("confirm"),__metadata("design:paramtypes",[s.IModalService])],Ve);class ToolbarService extends s.IToolbarService{constructor(e,t,i,o){super(i,o);this.gatewayId=e;this.onAliasesChange=null;t.initForService(this,["addAliases","removeItemByKey","removeAliasByKey","_removeItemOnInner","triggerActionOnInner"])}addAliases(e){this.aliases=this.aliases.map((t=>this.get(e,t)||t));this.aliases=[...this.aliases||[],...(e||[]).filter((e=>!this.get(this.aliases,e)))];this.aliases=this.sortAliases(this.aliases);if(this.onAliasesChange){this.onAliasesChange(this.aliases)}}removeItemByKey(e){if(e in this.actions){delete this.actions[e]}else{this._removeItemOnInner(e)}this.removeAliasByKey(e)}removeAliasByKey(e){let t=0;for(;t<this.aliases.length;t++){if(this.aliases[t].key===e){break}}if(t<this.aliases.length){this.aliases.splice(t,1)}if(this.onAliasesChange){this.onAliasesChange(this.aliases)}}setOnAliasesChange(e){this.onAliasesChange=e}triggerAction(e){if(e&&this.actions[e.key]){this.actions[e.key].call(e);return}this.triggerActionOnInner(e)}get(e,t){return e.find((({key:e})=>e===t.key))}sortAliases(e){let t=false;let i=`In ${this.gatewayId} the items `;let o=null;const n=[...e||[]].sort(((e,n)=>{if(e.priority===n.priority&&e.section===n.section){o=e.section;i+=`${e.key} and ${n.key} `;t=true;return e.key>n.key?1:-1}return e.priority-n.priority}));if(t){this.logService.warn(`WARNING: ${i}have the same priority withing section:${o}`)}return n}}let Ue=class ToolbarServiceFactory{constructor(e,t,i){this.gatewayProxy=e;this.logService=t;this.permissionService=i;this.toolbarServicesByGatewayId={}}getToolbarService(e){if(!this.toolbarServicesByGatewayId[e]){this.toolbarServicesByGatewayId[e]=new ToolbarService(e,this.gatewayProxy,this.logService,this.permissionService)}return this.toolbarServicesByGatewayId[e]}};Ue=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.GatewayProxy,s.LogService,s.IPermissionService])],Ue);var Be;window.__smartedit__.addDecoratorPayload("Component","ToolbarComponent",{selector:"se-toolbar",template:`<div class="se-toolbar" [ngClass]="cssClass"><div class="se-toolbar__left"><div *ngFor="let item of aliases | seProperty:{section:'left'}; trackBy: trackByFn" class="se-template-toolbar se-template-toolbar__left {{item.className}}"><se-toolbar-section-item [item]="item"></se-toolbar-section-item></div></div><div class="se-toolbar__middle"><div *ngFor="let item of aliases | seProperty:{section:'middle'}; trackBy: trackByFn" class="se-template-toolbar se-template-toolbar__middle {{item.className}}"><se-toolbar-section-item [item]="item"></se-toolbar-section-item></div></div><div class="se-toolbar__right"><div *ngFor="let item of aliases | seProperty:{section:'right'}; trackBy: trackByFn" class="se-template-toolbar se-template-toolbar__right {{item.className}}"><se-toolbar-section-item [item]="item"></se-toolbar-section-item></div></div></div>`});let je=Be=class ToolbarComponent{constructor(e,t,i,o,n,s,a){this.toolbarServiceFactory=e;this.iframeClickDetectionService=t;this.systemEventService=i;this.injector=o;this.cdr=n;this.routingService=s;this.userTrackingService=a;this.imageRoot="";this.aliases=[];this.unregCloseActions=null;this.unregCloseAll=null;this.unregRecalcPermissions=null}ngOnInit(){this.setup()}ngOnDestroy(){var e,t,i;this.closeAllActionItems();(e=this.unregCloseActions)===null||e===void 0?void 0:e.call(this);(t=this.unregCloseAll)===null||t===void 0?void 0:t.call(this);(i=this.unregRecalcPermissions)===null||i===void 0?void 0:i.call(this)}triggerAction(e,t){t.preventDefault();this.userTrackingService.trackingUserAction(s.USER_TRACKING_FUNCTIONALITY.TOOL_BAR,e.key);this.toolbarService.triggerAction(e)}getItemVisibility(e){return e.component&&(e.isOpen||e.keepAliveOnClose)}isOnStorefront(){return this.routingService.absUrl().includes(s.STORE_FRONT_CONTEXT)}createInjector(e){return n.Injector.create({parent:this.injector,providers:[{provide:s.TOOLBAR_ITEM,useValue:e}]})}trackByFn(e,t){return t.key}closeAllActionItems(){this.aliases.forEach((e=>{e.isOpen=false}))}populatePermissions(){return __awaiter(this,void 0,void 0,(function*(){const e=this.aliases.map((e=>this.toolbarService._populateIsPermissionGranted(e)));this.aliases=yield Promise.all(e)}))}setup(){this.buildAliases();this.populatePermissions();this.registerCallbacks()}buildAliases(){this.toolbarService=this.toolbarServiceFactory.getToolbarService(this.toolbarName);this.toolbarService.setOnAliasesChange((e=>{this.aliases=e;if(!this.cdr.destroyed){this.cdr.detectChanges()}}));this.aliases=this.toolbarService.getAliases()}registerCallbacks(){this.unregCloseActions=this.iframeClickDetectionService.registerCallback(Be.CLOSE_ALL_ACTION_ITEMS+this.toolbarName,(()=>this.closeAllActionItems()));this.unregCloseAll=this.systemEventService.subscribe(s.EVENTS.PAGE_SELECTED,(()=>this.closeAllActionItems()));this.unregRecalcPermissions=this.systemEventService.subscribe(s.EVENTS.PERMISSION_CACHE_CLEANED,(()=>this.populatePermissions()))}};je.CLOSE_ALL_ACTION_ITEMS="closeAllActionItems";__decorate([n.Input(),__metadata("design:type",String)],je.prototype,"cssClass",void 0);__decorate([n.Input(),__metadata("design:type",String)],je.prototype,"toolbarName",void 0);__decorate([n.Input(),__metadata("design:type",Object)],je.prototype,"imageRoot",void 0);je=Be=__decorate([n.Component({selector:"se-toolbar",template:`<div class="se-toolbar" [ngClass]="cssClass"><div class="se-toolbar__left"><div *ngFor="let item of aliases | seProperty:{section:'left'}; trackBy: trackByFn" class="se-template-toolbar se-template-toolbar__left {{item.className}}"><se-toolbar-section-item [item]="item"></se-toolbar-section-item></div></div><div class="se-toolbar__middle"><div *ngFor="let item of aliases | seProperty:{section:'middle'}; trackBy: trackByFn" class="se-template-toolbar se-template-toolbar__middle {{item.className}}"><se-toolbar-section-item [item]="item"></se-toolbar-section-item></div></div><div class="se-toolbar__right"><div *ngFor="let item of aliases | seProperty:{section:'right'}; trackBy: trackByFn" class="se-template-toolbar se-template-toolbar__right {{item.className}}"><se-toolbar-section-item [item]="item"></se-toolbar-section-item></div></div></div>`}),__metadata("design:paramtypes",[s.IToolbarServiceFactory,s.IIframeClickDetectionService,s.SystemEventService,n.Injector,n.ChangeDetectorRef,s.SmarteditRoutingService,s.IUserTrackingService])],je);window.__smartedit__.addDecoratorPayload("Component","ToolbarActionComponent",{selector:"se-toolbar-action",template:`<div *ngIf="item.isPermissionGranted"><div *ngIf="item.type == type.ACTION" class="toolbar-action"><button fd-button type="button" [ngClass]="{\n                'toolbar-action--button--compact': isCompact,\n                'toolbar-action--button': !isCompact\n            }" class="btn fd-button" (click)="toolbar.triggerAction(item, $event)" attr.aria-label="{{ item.name | translate}}" id="{{toolbar.toolbarName}}_option_{{item.key}}_btn" title="{{ item.name | translate}}"><span *ngIf="item.iconClassName" id="{{toolbar.toolbarName}}_option_{{item.key}}_btn_iconclass" class="{{item.iconClassName}}" [ngClass]="{ 'se-toolbar-actions__icon': isCompact }"></span> <img *ngIf="!item.iconClassName && item.icons" id="{{toolbar.toolbarName}}_option_{{item.key}}" src="{{toolbar.imageRoot}}{{item.icons[0]}}" class="file" title="{{item.name | translate}}" alt="{{item.name | translate}}"/> <span *ngIf="!isCompact" class="toolbar-action-button__txt" id="{{toolbar.toolbarName}}_option_{{item.key}}_btn_lbl">{{item.name | translate}}</span></button></div><fd-popover class="se-toolbar-action__wrapper toolbar-action toolbar-action--hybrid" *ngIf="item.type === type.HYBRID_ACTION" [attr.data-item-key]="item.key" [noArrow]="false" [placement]="placement" [(isOpen)]="item.isOpen" [fixedPosition]="true"><fd-popover-control><button fd-button *ngIf="item.iconClassName || item.icons" type="button" class="btn fd-button" [ngClass]="{\n                    'toolbar-action--button--compact': isCompact,\n                    'toolbar-action--button': !isCompact\n                }" [disabled]="disabled" id="{{toolbar.toolbarName}}_option_{{item.key}}_btn" attr.aria-label="{{ item.name | translate}}" [attr.aria-expanded]="item.isOpen" (click)="toolbar.triggerAction(item, $event)" title="{{ item.name | translate}}"><span *ngIf="item.iconClassName" class="{{item.iconClassName}}" [ngClass]="{ 'se-toolbar-actions__icon': isCompact }"></span> <img *ngIf="!item.iconClassName && item.icons" id="{{toolbar.toolbarName}}_option_{{item.key}}" src="{{toolbar.imageRoot}}{{item.icons[0]}}" class="file" title="{{item.name | translate}}" alt="{{item.name | translate}}"/> <span *ngIf="!isCompact" class="toolbar-action-button__txt">{{item.name | translate}}</span></button></fd-popover-control><fd-popover-body role="listbox" class="se-toolbar-action__body" [ngClass]="{\n                'toolbar-action--include--compact': isCompact,\n                'toolbar-action--include': !isCompact  \n            }"><se-prevent-vertical-overflow><ng-container *ngComponentOutlet="item.component; injector: actionInjector"></ng-container></se-prevent-vertical-overflow></fd-popover-body></fd-popover></div>`});let Ge=class ToolbarActionComponent{constructor(e){this.toolbar=e;this.type=s.ToolbarItemType}ngOnInit(){this.setup()}ngOnChanges(e){if(e.item){this.setup()}}get isCompact(){return this.item.actionButtonFormat==="compact"}get placement(){if(this.item.section===s.ToolbarSection.left||this.item.section===s.ToolbarSection.middle){return"bottom-start"}else if(this.item.section===s.ToolbarSection.right){return"bottom-end"}switch(this.item.dropdownPosition){case s.ToolbarDropDownPosition.left:return"bottom-start";case s.ToolbarDropDownPosition.right:return"bottom-end";default:return"bottom"}}setup(){this.actionInjector=this.toolbar.createInjector(this.item)}};__decorate([n.Input(),__metadata("design:type",Object)],Ge.prototype,"item",void 0);Ge=__decorate([n.Component({selector:"se-toolbar-action",template:`<div *ngIf="item.isPermissionGranted"><div *ngIf="item.type == type.ACTION" class="toolbar-action"><button fd-button type="button" [ngClass]="{\n                'toolbar-action--button--compact': isCompact,\n                'toolbar-action--button': !isCompact\n            }" class="btn fd-button" (click)="toolbar.triggerAction(item, $event)" attr.aria-label="{{ item.name | translate}}" id="{{toolbar.toolbarName}}_option_{{item.key}}_btn" title="{{ item.name | translate}}"><span *ngIf="item.iconClassName" id="{{toolbar.toolbarName}}_option_{{item.key}}_btn_iconclass" class="{{item.iconClassName}}" [ngClass]="{ 'se-toolbar-actions__icon': isCompact }"></span> <img *ngIf="!item.iconClassName && item.icons" id="{{toolbar.toolbarName}}_option_{{item.key}}" src="{{toolbar.imageRoot}}{{item.icons[0]}}" class="file" title="{{item.name | translate}}" alt="{{item.name | translate}}"/> <span *ngIf="!isCompact" class="toolbar-action-button__txt" id="{{toolbar.toolbarName}}_option_{{item.key}}_btn_lbl">{{item.name | translate}}</span></button></div><fd-popover class="se-toolbar-action__wrapper toolbar-action toolbar-action--hybrid" *ngIf="item.type === type.HYBRID_ACTION" [attr.data-item-key]="item.key" [noArrow]="false" [placement]="placement" [(isOpen)]="item.isOpen" [fixedPosition]="true"><fd-popover-control><button fd-button *ngIf="item.iconClassName || item.icons" type="button" class="btn fd-button" [ngClass]="{\n                    'toolbar-action--button--compact': isCompact,\n                    'toolbar-action--button': !isCompact\n                }" [disabled]="disabled" id="{{toolbar.toolbarName}}_option_{{item.key}}_btn" attr.aria-label="{{ item.name | translate}}" [attr.aria-expanded]="item.isOpen" (click)="toolbar.triggerAction(item, $event)" title="{{ item.name | translate}}"><span *ngIf="item.iconClassName" class="{{item.iconClassName}}" [ngClass]="{ 'se-toolbar-actions__icon': isCompact }"></span> <img *ngIf="!item.iconClassName && item.icons" id="{{toolbar.toolbarName}}_option_{{item.key}}" src="{{toolbar.imageRoot}}{{item.icons[0]}}" class="file" title="{{item.name | translate}}" alt="{{item.name | translate}}"/> <span *ngIf="!isCompact" class="toolbar-action-button__txt">{{item.name | translate}}</span></button></fd-popover-control><fd-popover-body role="listbox" class="se-toolbar-action__body" [ngClass]="{\n                'toolbar-action--include--compact': isCompact,\n                'toolbar-action--include': !isCompact  \n            }"><se-prevent-vertical-overflow><ng-container *ngComponentOutlet="item.component; injector: actionInjector"></ng-container></se-prevent-vertical-overflow></fd-popover-body></fd-popover></div>`}),__param(0,n.Inject(n.forwardRef((()=>je)))),__metadata("design:paramtypes",[je])],Ge);window.__smartedit__.addDecoratorPayload("Component","ToolbarActionOutletComponent",{selector:"se-toolbar-action-outlet",template:`\n        <div\n            class="se-template-toolbar__action-template"\n            [ngClass]="{\n                'se-toolbar-action': isSectionRight,\n                'se-toolbar-action--active': isSectionRight && isPermitionGranted\n            }">\n            <ng-container *ngIf="item.component && item.type === type.TEMPLATE">\n                <ng-container\n                    *ngComponentOutlet="item.component; injector: actionInjector"></ng-container>\n            </ng-container>\n\n            \x3c!--ACTION and HYBRID_ACTION types--\x3e\n\n            <div *ngIf="item.type !== type.TEMPLATE">\n                <se-toolbar-action [item]="item"></se-toolbar-action>\n            </div>\n        </div>\n    `});let He=class ToolbarActionOutletComponent{constructor(e){this.toolbar=e;this.type=s.ToolbarItemType}ngOnInit(){this.setup()}ngOnChanges(e){if(e.item){this.setup()}}get isSectionRight(){return this.item.section===s.ToolbarSection.right}get isPermitionGranted(){return this.item.isPermissionGranted}setup(){this.actionInjector=this.toolbar.createInjector(this.item)}};__decorate([n.Input(),__metadata("design:type",Object)],He.prototype,"item",void 0);He=__decorate([n.Component({selector:"se-toolbar-action-outlet",template:`\n        <div\n            class="se-template-toolbar__action-template"\n            [ngClass]="{\n                'se-toolbar-action': isSectionRight,\n                'se-toolbar-action--active': isSectionRight && isPermitionGranted\n            }">\n            <ng-container *ngIf="item.component && item.type === type.TEMPLATE">\n                <ng-container\n                    *ngComponentOutlet="item.component; injector: actionInjector"></ng-container>\n            </ng-container>\n\n            \x3c!--ACTION and HYBRID_ACTION types--\x3e\n\n            <div *ngIf="item.type !== type.TEMPLATE">\n                <se-toolbar-action [item]="item"></se-toolbar-action>\n            </div>\n        </div>\n    `}),__param(0,n.Inject(n.forwardRef((()=>je)))),__metadata("design:paramtypes",[je])],He);window.__smartedit__.addDecoratorPayload("Component","ToolbarItemContextComponent",{selector:"se-toolbar-item-context",template:`\n        <div\n            *ngIf="displayContext"\n            id="toolbar_item_context_{{ itemKey }}_btn"\n            class="se-toolbar-actionable-item-context"\n            [ngClass]="{ 'se-toolbar-actionable-item-context--open': isOpen }">\n            <div *ngIf="contextComponent" class="se-toolbar-actionable-context__btn">\n                <ng-container *ngComponentOutlet="contextComponent"></ng-container>\n            </div>\n        </div>\n    `});let We=class ToolbarItemContextComponent{constructor(e){this.crossFrameEventService=e;this.displayContext=false}ngOnInit(){this.registerCallbacks()}ngOnDestroy(){this.unregShowContext();this.unregHideContext()}showContext(e){this.displayContext=e}registerCallbacks(){this.unregShowContext=this.crossFrameEventService.subscribe(s.SHOW_TOOLBAR_ITEM_CONTEXT,((e,t)=>{if(t===this.itemKey){this.showContext(true)}}));this.unregHideContext=this.crossFrameEventService.subscribe(s.HIDE_TOOLBAR_ITEM_CONTEXT,((e,t)=>{if(t===this.itemKey){this.showContext(false)}}))}};__decorate([n.Input(),__metadata("design:type",String)],We.prototype,"itemKey",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],We.prototype,"isOpen",void 0);__decorate([n.Input(),__metadata("design:type",n.Type)],We.prototype,"contextComponent",void 0);We=__decorate([n.Component({selector:"se-toolbar-item-context",template:`\n        <div\n            *ngIf="displayContext"\n            id="toolbar_item_context_{{ itemKey }}_btn"\n            class="se-toolbar-actionable-item-context"\n            [ngClass]="{ 'se-toolbar-actionable-item-context--open': isOpen }">\n            <div *ngIf="contextComponent" class="se-toolbar-actionable-context__btn">\n                <ng-container *ngComponentOutlet="contextComponent"></ng-container>\n            </div>\n        </div>\n    `}),__param(0,n.Inject(s.EVENT_SERVICE)),__metadata("design:paramtypes",[s.CrossFrameEventService])],We);window.__smartedit__.addDecoratorPayload("Component","ToolbarSectionItemComponent",{selector:"se-toolbar-section-item",host:{class:"se-toolbar-section-item"},template:`\n        <se-toolbar-action-outlet [item]="item"></se-toolbar-action-outlet>\n        <se-toolbar-item-context\n            *ngIf="item.contextComponent"\n            class="se-template-toolbar__context-template"\n            [attr.data-item-key]="item.key"\n            [itemKey]="item.key"\n            [isOpen]="item.isOpen"\n            [contextComponent]="item.contextComponent"></se-toolbar-item-context>\n    `});let $e=class ToolbarSectionItemComponent{};__decorate([n.Input(),__metadata("design:type",Object)],$e.prototype,"item",void 0);$e=__decorate([n.Component({selector:"se-toolbar-section-item",host:{class:"se-toolbar-section-item"},template:`\n        <se-toolbar-action-outlet [item]="item"></se-toolbar-action-outlet>\n        <se-toolbar-item-context\n            *ngIf="item.contextComponent"\n            class="se-template-toolbar__context-template"\n            [attr.data-item-key]="item.key"\n            [itemKey]="item.key"\n            [isOpen]="item.isOpen"\n            [contextComponent]="item.contextComponent"></se-toolbar-item-context>\n    `})],$e);window.__smartedit__.addDecoratorPayload("Component","DeviceSupportWrapperComponent",{selector:"se-device-support-wrapper",template:`\n        <inflection-point-selector\n            *ngIf="toolbar.isOnStorefront()"\n            class="toolbar-action"></inflection-point-selector>\n    `});let Ke=class DeviceSupportWrapperComponent{constructor(e){this.toolbar=e}};Ke=__decorate([n.Component({selector:"se-device-support-wrapper",template:`\n        <inflection-point-selector\n            *ngIf="toolbar.isOnStorefront()"\n            class="toolbar-action"></inflection-point-selector>\n    `}),__param(0,n.Inject(n.forwardRef((()=>je)))),__metadata("design:paramtypes",[je])],Ke);window.__smartedit__.addDecoratorPayload("Component","ExperienceSelectorButtonComponent",{selector:"se-experience-selector-button",template:`<fd-popover class="se-experience-selector" [(isOpen)]="status.isOpen" (isOpenChange)="resetExperienceSelector()" [closeOnOutsideClick]="false" [triggers]="['click']" [placement]="'bottom-end'"><fd-popover-control><div class="se-experience-selector__control"><se-tooltip [placement]="'bottom'" [triggers]="['mouseenter', 'mouseleave']" *ngIf="isCurrentPageFromParent" class="se-experience-selector__tooltip"><span se-tooltip-trigger class="se-experience-selector__btn--globe"><span class="sap-icon--globe se-experience-selector__btn--globe--icon"></span></span><div se-tooltip-body>{{ parentCatalogVersion }}</div></se-tooltip><button class="se-experience-selector__btn" id="experience-selector-btn"><span [attr.title]="experienceText" class="se-experience-selector__btn-text se-nowrap-ellipsis">{{ experienceText }} </span><span class="se-experience-selector__btn-arrow sap-icon--navigation-down-arrow" title="{{ getNavigationArrowIconIsCollapse() | translate }}"></span></button></div></fd-popover-control><fd-popover-body><div class="se-experience-selector__dropdown" role="menu"><se-experience-selector [experience]="experience" [dropdownStatus]="status" [(resetExperienceSelector)]="resetExperienceSelector"></se-experience-selector></div></fd-popover-body></fd-popover>`,providers:[s.L10nPipe]});let qe=class ExperienceSelectorButtonComponent{constructor(e,t,i,o,n){this.systemEventService=e;this.crossFrameEventService=t;this.locale=i;this.sharedDataService=o;this.l10nPipe=n;this.status={isOpen:false};this.isCurrentPageFromParent=false}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){yield this.updateExperience();yield this.setExperienceText();this.unregFn=this.systemEventService.subscribe(s.EVENTS.EXPERIENCE_UPDATE,(()=>__awaiter(this,void 0,void 0,(function*(){yield this.updateExperience();yield this.setExperienceText()}))));this.unRegNewPageContextEventFn=this.crossFrameEventService.subscribe(s.EVENTS.PAGE_CHANGE,((e,t)=>{this.setPageFromParent(t)}))}))}ngOnDestroy(){this.unregFn();this.unRegNewPageContextEventFn()}updateExperience(){return __awaiter(this,void 0,void 0,(function*(){this.experience=yield this.sharedDataService.get(s.EXPERIENCE_STORAGE_KEY)}))}setPageFromParent(e){return __awaiter(this,void 0,void 0,(function*(){const{pageContext:{catalogName:t,catalogVersion:i,catalogVersionUuid:o},catalogDescriptor:{catalogVersionUuid:n}}=e;const s=yield this.l10nPipe.transform(t).pipe(d.take(1)).toPromise();this.parentCatalogVersion=`${s} (${i})`;this.isCurrentPageFromParent=n!==o}))}getNavigationArrowIconIsCollapse(){return this.status.isOpen?"se.arrowicon.collapse.title":"se.arrowicon.expand.title"}setExperienceText(){return __awaiter(this,void 0,void 0,(function*(){if(!this.experience){this.experienceText=""}const{catalogDescriptor:{name:e,catalogVersion:t},languageDescriptor:{nativeName:i},time:o}=this.experience;const n=new p.DatePipe(this.locale);const a=o?`  |  ${n.transform(R["default"](o).isValid()?o:R["default"].now(),s.DATE_CONSTANTS.ANGULAR_SHORT)}`:"";const[r,l]=yield Promise.all([this.l10nPipe.transform(e).pipe(d.take(1)).toPromise(),this.getProductCatalogVersionTextByUuids()]);this.experienceText=`${r} - ${t}  |  ${i}${a}${l}`}))}getProductCatalogVersionTextByUuids(){return __awaiter(this,void 0,void 0,(function*(){const{productCatalogVersions:e}=this.experience;const t="";const i=e.map((({catalogName:e,catalogVersion:t})=>__awaiter(this,void 0,void 0,(function*(){const i=yield this.l10nPipe.transform(e).pipe(d.take(1)).toPromise();return`${i} (${t})`}))));const o=yield Promise.all(i);return[t].concat(o).join(" | ")}))}};qe=__decorate([n.Component({selector:"se-experience-selector-button",template:`<fd-popover class="se-experience-selector" [(isOpen)]="status.isOpen" (isOpenChange)="resetExperienceSelector()" [closeOnOutsideClick]="false" [triggers]="['click']" [placement]="'bottom-end'"><fd-popover-control><div class="se-experience-selector__control"><se-tooltip [placement]="'bottom'" [triggers]="['mouseenter', 'mouseleave']" *ngIf="isCurrentPageFromParent" class="se-experience-selector__tooltip"><span se-tooltip-trigger class="se-experience-selector__btn--globe"><span class="sap-icon--globe se-experience-selector__btn--globe--icon"></span></span><div se-tooltip-body>{{ parentCatalogVersion }}</div></se-tooltip><button class="se-experience-selector__btn" id="experience-selector-btn"><span [attr.title]="experienceText" class="se-experience-selector__btn-text se-nowrap-ellipsis">{{ experienceText }} </span><span class="se-experience-selector__btn-arrow sap-icon--navigation-down-arrow" title="{{ getNavigationArrowIconIsCollapse() | translate }}"></span></button></div></fd-popover-control><fd-popover-body><div class="se-experience-selector__dropdown" role="menu"><se-experience-selector [experience]="experience" [dropdownStatus]="status" [(resetExperienceSelector)]="resetExperienceSelector"></se-experience-selector></div></fd-popover-body></fd-popover>`,providers:[s.L10nPipe]}),__param(2,n.Inject(n.LOCALE_ID)),__metadata("design:paramtypes",[s.SystemEventService,s.CrossFrameEventService,String,s.ISharedDataService,s.L10nPipe])],qe);window.__smartedit__.addDecoratorPayload("Component","InflectionPointSelectorComponent",{selector:"inflection-point-selector",template:`<div class="se-inflection-point dropdown" [class.open]="isOpen" id="inflectionPtDropdown"><button type="button" class="se-inflection-point__toggle" (click)="toggleDropdown($event)" aria-pressed="false" [attr.aria-expanded]="isOpen" title="{{'se.device.support.selector.btn' | translate}}"><span [ngClass]="getIconClass()" class="se-inflection-point___selected"></span></button><div class="se-inflection-point-dropdown"><nav><ul class="fd-menu__list" role="menu"><li *ngFor="let choice of points" class="fd-menu__item inflection-point__device" [ngClass]="{selected: isSelected(choice)}" id="se-device-{{choice.type}}" (click)="selectPoint(choice)" title="{{choice.name | translate}}"><span [ngClass]="getIconClass(choice)"></span></li></ul></nav></div></div>`});let Ye=class InflectionPointSelectorComponent{constructor(e,t,i,o,n){this.systemEventService=e;this.iframeManagerService=t;this.iframeClickDetectionService=i;this.yjQuery=o;this.userTrackingService=n;this.currentPointSelected=$.find((e=>e.default));this.points=$;this.isOpen=false}ngOnInit(){this.iframeClickDetectionService.registerCallback("inflectionPointClose",(()=>this.isOpen=false));const e=s.windowUtils.getWindow();this.documentClick$=l.fromEvent(e.document,"click").pipe(d.filter((e=>this.yjQuery(e.target).parents("inflection-point-selector").length<=0&&this.isOpen))).subscribe((e=>this.isOpen=false));this.unRegFn=this.systemEventService.subscribe(s.OVERLAY_DISABLED_EVENT,(()=>this.isOpen=false))}ngOnDestroy(){this.unRegFn();this.documentClick$.unsubscribe()}selectPoint(e){this.userTrackingService.trackingUserAction(s.USER_TRACKING_FUNCTIONALITY.INFLECTION,e.type);this.currentPointSelected=e;this.isOpen=!this.isOpen;if(e!==undefined){this.iframeManagerService.apply(e)}}toggleDropdown(e){e.preventDefault();e.stopPropagation();this.isOpen=!this.isOpen}getIconClass(e){if(e!==undefined){return e.iconClass}else{return this.currentPointSelected.iconClass}}isSelected(e){if(e!==undefined){return e.type===this.currentPointSelected.type}return false}};Ye=__decorate([n.Component({selector:"inflection-point-selector",template:`<div class="se-inflection-point dropdown" [class.open]="isOpen" id="inflectionPtDropdown"><button type="button" class="se-inflection-point__toggle" (click)="toggleDropdown($event)" aria-pressed="false" [attr.aria-expanded]="isOpen" title="{{'se.device.support.selector.btn' | translate}}"><span [ngClass]="getIconClass()" class="se-inflection-point___selected"></span></button><div class="se-inflection-point-dropdown"><nav><ul class="fd-menu__list" role="menu"><li *ngFor="let choice of points" class="fd-menu__item inflection-point__device" [ngClass]="{selected: isSelected(choice)}" id="se-device-{{choice.type}}" (click)="selectPoint(choice)" title="{{choice.name | translate}}"><span [ngClass]="getIconClass(choice)"></span></li></ul></nav></div></div>`}),__param(2,n.Inject(s.IIframeClickDetectionService)),__param(3,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[s.SystemEventService,K,we,Function,s.IUserTrackingService])],Ye);window.__smartedit__.addDecoratorPayload("Component","ExperienceSelectorComponent",{selector:"se-experience-selector",template:`<se-generic-editor *ngIf="isReady" [smarteditComponentType]="smarteditComponentType" [smarteditComponentId]="smarteditComponentId" [structureApi]="structureApi" [content]="content" [contentApi]="contentApi" (getApi)="getApi($event)"></se-generic-editor>`,providers:[s.L10nPipe]});let Ze=class ExperienceSelectorComponent{constructor(e,t,i,o,s,a,r,l,d){this.systemEventService=e;this.siteService=t;this.sharedDataService=i;this.iframeClickDetectionService=o;this.iframeManagerService=s;this.experienceService=a;this.catalogService=r;this.l10nPipe=l;this.userTrackingService=d;this.resetExperienceSelectorChange=new n.EventEmitter;this.modalHeaderTitle="se.experience.selector.header";this.siteCatalogs={}}ngOnInit(){setTimeout((()=>{this.resetExperienceSelectorChange.emit((()=>this.resetExperienceSelectorFn()))}));this.unRegCloseExperienceFn=this.iframeClickDetectionService.registerCallback("closeExperienceSelector",(()=>{if(this.dropdownStatus&&this.dropdownStatus.isOpen){this.dropdownStatus.isOpen=false}}));this.unRegFn=this.systemEventService.subscribe("OVERLAY_DISABLED",(()=>{if(this.dropdownStatus&&this.dropdownStatus.isOpen){this.dropdownStatus.isOpen=false}}))}ngOnDestroy(){if(this.unRegFn){this.unRegFn()}if(this.unRegCloseExperienceFn){this.unRegCloseExperienceFn()}}preparePayload(e){return __awaiter(this,void 0,void 0,(function*(){[this.siteCatalogs.siteId,this.siteCatalogs.catalogId,this.siteCatalogs.catalogVersion]=e.previewCatalog.split("|");const t=yield this.catalogService.getProductCatalogsForSite(this.siteCatalogs.siteId);const{domain:i}=yield this.sharedDataService.get("configuration");const{previewUrl:o,uid:n}=yield this.siteService.getSiteById(this.siteCatalogs.siteId);const{language:a,time:r,pageId:l,productCatalogVersions:d}=e;this.siteCatalogs.productCatalogs=t;this.siteCatalogs.productCatalogVersions=d;this.userTrackingService.trackingUserAction(s.USER_TRACKING_FUNCTIONALITY.TOOL_BAR,"update Experience");return Object.assign(Object.assign({},e),{resourcePath:s.urlUtils.getAbsoluteURL(i,o),catalogVersions:[...this._getProductCatalogsByUuids(d),{catalog:this.siteCatalogs.catalogId,catalogVersion:this.siteCatalogs.catalogVersion}],siteId:n,language:a,time:r,pageId:l})}))}updateCallback(e,t){return __awaiter(this,void 0,void 0,(function*(){const{siteId:i,catalogId:o,catalogVersion:n,productCatalogVersions:a}=this.siteCatalogs;const{time:r}=e;const{pageId:l,language:d,ticketId:p}=t;this.smarteditComponentId=null;this.dropdownStatus.isOpen=false;const m=Object.assign(Object.assign({},t),{siteId:i,catalogId:o,catalogVersion:n,productCatalogVersions:a,time:s.dateUtils.formatDateAsUtc(r),pageId:l,language:d});const g=yield this.experienceService.buildAndSetExperience(m);yield this.sharedDataService.set(s.EXPERIENCE_STORAGE_KEY,g);this.systemEventService.publishAsync(s.EVENTS.EXPERIENCE_UPDATE);this.iframeManagerService.loadPreview(g.siteDescriptor.previewUrl,p)}))}getApi(e){e.setPreparePayload(this.preparePayload.bind(this));e.setUpdateCallback(this.updateCallback.bind(this));e.setAlwaysShowSubmit(true);e.setAlwaysShowReset(true);e.setSubmitButtonText("se.componentform.actions.apply");e.setCancelButtonText("se.componentform.actions.cancel");e.setOnReset((()=>{this.dropdownStatus.isOpen=false;return this.dropdownStatus.isOpen}))}_getProductCatalogsByUuids(e){return this.siteCatalogs.productCatalogs.map((({versions:t,catalogId:i})=>({catalogVersion:t.find((({uuid:t})=>e.indexOf(t)>-1)).version,catalog:i})))}resetExperienceSelectorFn(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.sharedDataService.get(s.EXPERIENCE_STORAGE_KEY);const t=yield this.sharedDataService.get("configuration");this.smarteditComponentType="PreviewData";this.smarteditComponentId=null;this.structureApi=s.TYPES_RESOURCE_URI+"?code=:smarteditComponentType&mode=DEFAULT";this.contentApi=t&&t.previewTicketURI||s.PREVIEW_RESOURCE_URI;const i=yield this.l10nPipe.transform(e.siteDescriptor.name).pipe(d.take(1)).toPromise();this.content=Object.assign(Object.assign({},e),{activeSite:i,time:e.time,pageId:e.pageId,productCatalogVersions:e.productCatalogVersions.map((e=>e.uuid)),language:e.languageDescriptor.isocode,previewCatalog:`${e.siteDescriptor.uid}|${e.catalogDescriptor.catalogId}|${e.catalogDescriptor.catalogVersion}`});if(!this.isReady){this.isReady=true}}))}};__decorate([n.Input(),__metadata("design:type",Object)],Ze.prototype,"experience",void 0);__decorate([n.Input(),__metadata("design:type",Object)],Ze.prototype,"dropdownStatus",void 0);__decorate([n.Input(),__metadata("design:type",Function)],Ze.prototype,"resetExperienceSelector",void 0);__decorate([n.Output(),__metadata("design:type",n.EventEmitter)],Ze.prototype,"resetExperienceSelectorChange",void 0);Ze=__decorate([n.Component({selector:"se-experience-selector",template:`<se-generic-editor *ngIf="isReady" [smarteditComponentType]="smarteditComponentType" [smarteditComponentId]="smarteditComponentId" [structureApi]="structureApi" [content]="content" [contentApi]="contentApi" (getApi)="getApi($event)"></se-generic-editor>`,providers:[s.L10nPipe]}),__metadata("design:paramtypes",[s.SystemEventService,Z,s.ISharedDataService,s.IIframeClickDetectionService,K,s.IExperienceService,s.ICatalogService,s.L10nPipe,s.IUserTrackingService])],Ze);const Xe="static-resources/images/";window.__smartedit__.addDecoratorPayload("Component","ThemeSwitchComponent",{selector:"fd-theme-switch",template:`<fd-grid-list [layoutPattern]="layoutPattern" selectionMode="singleSelect" (selectionChange)="onSelectionChange($event)"><fd-grid-list-item *ngFor="let item of list" [value]="item.id" [noPadding]="true" (press)="press($event)" [selected]="item.selected"><fd-grid-list-item-toolbar *ngIf="item.toolbarText">{{ item.toolbarText }}</fd-grid-list-item-toolbar><img [id]="item.id" [src]="item.url" [alt]="item.toolbarText"/></fd-grid-list-item></fd-grid-list>`,styles:[`fd-theme-switch .fd-grid-list{margin-top:30px}fd-theme-switch .fd-grid-list fd-grid-list-item{height:180px}fd-theme-switch .fd-grid-list fd-grid-list-item img{height:100%}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None});let Qe=class ThemeSwitchComponent{constructor(e,t,i,o){this._themesService=e;this._themeSwitchService=t;this.modalManager=i;this.confirmationModalService=o;this.themes=this._themesService.getThemes();this.list=this.themes.themes.map((e=>({id:e.code,toolbarText:e.name,url:`${Xe}${e.code}.png`,selected:this._themeSwitchService.selectedTheme===e.code})));this.layoutPattern="XL3-L3-M2-S1"}ngOnInit(){this.modalManager.addButtons([{id:"save",style:s.ModalButtonStyle.Primary,label:"se.cms.component.confirmation.modal.save",callback:()=>l.from(this.onSave()),disabled:true},{id:"cancel",label:"se.cms.component.confirmation.modal.cancel",style:s.ModalButtonStyle.Default,action:s.ModalButtonAction.Dismiss,callback:()=>l.from(this.onCancel())}])}onSelectionChange(e){if(!e.removed.length){return}if(e.selection[0]!==this._themeSwitchService.getThemeSession()){this.modalManager.enableButton("save")}else{this.modalManager.disableButton("save")}this._themeSwitchService.selectTheme(e.selection[0])}onCancel(){const e=this.modalManager.getButtons();const t=0;let i;e.forEach((e=>{i=!e[t].disabled}));const o={description:"se.editor.cancel.confirm"};if(!i){this.modalManager.close(null);return Promise.resolve()}return this.confirmationModalService.confirm(o).then((()=>{if(this._themeSwitchService.getThemeSession()!==this._themeSwitchService.selectedTheme){this._themeSwitchService.selectTheme(this._themeSwitchService.getThemeSession())}this.modalManager.close(null)}))}onSave(){if(this._themeSwitchService.getThemeSession()!==this._themeSwitchService.selectedTheme){this._themeSwitchService.saveTheme()}this.modalManager.close(null);return Promise.resolve()}};Qe=__decorate([n.Component({selector:"fd-theme-switch",template:`<fd-grid-list [layoutPattern]="layoutPattern" selectionMode="singleSelect" (selectionChange)="onSelectionChange($event)"><fd-grid-list-item *ngFor="let item of list" [value]="item.id" [noPadding]="true" (press)="press($event)" [selected]="item.selected"><fd-grid-list-item-toolbar *ngIf="item.toolbarText">{{ item.toolbarText }}</fd-grid-list-item-toolbar><img [id]="item.id" [src]="item.url" [alt]="item.toolbarText"/></fd-grid-list-item></fd-grid-list>`,styles:[`fd-theme-switch .fd-grid-list{margin-top:30px}fd-theme-switch .fd-grid-list fd-grid-list-item{height:180px}fd-theme-switch .fd-grid-list fd-grid-list-item img{height:100%}`],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),__metadata("design:paramtypes",[s.ThemesService,t.ThemeSwitchService,s.ModalManagerService,s.IConfirmationModalService])],Qe);window.__smartedit__.addDecoratorPayload("Component","UserAccountComponent",{selector:"se-user-account",template:`<div class="se-user-account-dropdown"><div class="se-user-account-dropdown__role">{{ 'se.toolbar.useraccount.role' | translate }}</div><div class="user-account-dropdown__name">{{username}}</div><div class="divider"></div><a class="se-theme-switch__link fd-menu__item" (click)="themeSwitch()"><fd-icon role="presentation" class="sap-icon--palette ng-star-inserted"></fd-icon><span fd-menu-title="" class="fd-menu__title">{{'se.modal.administration.theme.switch.title' | translate}} </span></a><a class="se-sign-out__link fd-menu__item" (click)="signOut()"><fd-icon role="presentation" class="sap-icon--log ng-star-inserted"></fd-icon><span fd-menu-title="" class="fd-menu__title">{{'se.toolbar.useraccount.signout' | translate}}</span></a></div>`});let Je=class UserAccountComponent{constructor(e,t,i,o,n,s){this.authenticationService=e;this.iframeManagerService=t;this.crossFrameEventService=i;this.sessionService=o;this.modalService=n;this.themesService=s}ngOnInit(){this.unregUserChanged=this.crossFrameEventService.subscribe(s.EVENTS.USER_HAS_CHANGED,(()=>this.getUsername()));this.getUsername();this.crossFrameEventService.subscribe(s.SWITCH_LANGUAGE_EVENT,(()=>this.themesService.initThemes()))}ngOnDestroy(){this.unregUserChanged()}signOut(){this.authenticationService.logout();this.iframeManagerService.setCurrentLocation(null)}themeSwitch(){this.modalService.open({templateConfig:{title:"se.modal.administration.theme.switch.title"},component:Qe,config:{focusTrapped:false,backdropClickCloseable:false,width:"650px",height:"380px"}})}getUsername(){this.sessionService.getCurrentUserDisplayName().then((e=>{this.username=e}))}};Je=__decorate([n.Component({selector:"se-user-account",template:`<div class="se-user-account-dropdown"><div class="se-user-account-dropdown__role">{{ 'se.toolbar.useraccount.role' | translate }}</div><div class="user-account-dropdown__name">{{username}}</div><div class="divider"></div><a class="se-theme-switch__link fd-menu__item" (click)="themeSwitch()"><fd-icon role="presentation" class="sap-icon--palette ng-star-inserted"></fd-icon><span fd-menu-title="" class="fd-menu__title">{{'se.modal.administration.theme.switch.title' | translate}} </span></a><a class="se-sign-out__link fd-menu__item" (click)="signOut()"><fd-icon role="presentation" class="sap-icon--log ng-star-inserted"></fd-icon><span fd-menu-title="" class="fd-menu__title">{{'se.toolbar.useraccount.signout' | translate}}</span></a></div>`}),__metadata("design:paramtypes",[s.IAuthenticationService,K,s.CrossFrameEventService,s.ISessionService,s.IModalService,s.ThemesService])],Je);window.__smartedit__.addDecoratorPayload("Component","ExperienceSelectorWrapperComponent",{selector:"se-experience-selector-wrapper",template:`\n        <se-experience-selector-button\n            *ngIf="toolbar.isOnStorefront()"></se-experience-selector-button>\n    `});let et=class ExperienceSelectorWrapperComponent{constructor(e){this.toolbar=e}};et=__decorate([n.Component({selector:"se-experience-selector-wrapper",template:`\n        <se-experience-selector-button\n            *ngIf="toolbar.isOnStorefront()"></se-experience-selector-button>\n    `}),__param(0,n.Inject(n.forwardRef((()=>je)))),__metadata("design:paramtypes",[je])],et);window.__smartedit__.addDecoratorPayload("Component","LogoComponent",{selector:"se-logo",template:`\n        <div class="se-app-logo">\n            <img\n                src="static-resources/images/SAP_scrn_R.png"\n                class="se-logo-image"\n                width="48"\n                height="24"\n                title="{{ 'se.logo.title' | translate }}" />\n            <div class="se-logo-text">{{ 'se.application.name' | translate }}</div>\n        </div>\n    `});let tt=class LogoComponent{};tt=__decorate([n.Component({selector:"se-logo",template:`\n        <div class="se-app-logo">\n            <img\n                src="static-resources/images/SAP_scrn_R.png"\n                class="se-logo-image"\n                width="48"\n                height="24"\n                title="{{ 'se.logo.title' | translate }}" />\n            <div class="se-logo-text">{{ 'se.application.name' | translate }}</div>\n        </div>\n    `})],tt);var it=Object.defineProperty,ot=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var X=(e,t,i)=>t in e?it(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,F=(e,t)=>{for(var i in t||(t={}))rt.call(t,i)&&X(e,i,t[i]);if(at)for(var i of at(t))lt.call(t,i)&&X(e,i,t[i]);return e},z=(e,t)=>ot(e,nt(t));var At=(e,t,i)=>(X(e,typeof t!="symbol"?t+"":t,i),i);var St=(e,t,i)=>new Promise(((o,n)=>{var V=e=>{try{I(i.next(e))}catch(e){n(e)}},D=e=>{try{I(i.throw(e))}catch(e){n(e)}},I=e=>e.done?o(e.value):Promise.resolve(e.value).then(V,D);I((i=i.apply(e,t)).next())}));(function(){const e=window,t=e.ShadowRoot&&(e.ShadyCSS===void 0||e.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),o=new WeakMap;class C{constructor(e,t,o){if(this._$cssResult$=!0,o!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const i=this.t;if(t&&e===void 0){const t=i!==void 0&&i.length===1;t&&(e=o.get(i)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),t&&o.set(i,e))}return e}toString(){return this.cssText}}const V=e=>new C(typeof e=="string"?e:e+"",void 0,i),D=(e,...t)=>{const o=e.length===1?e[0]:t.reduce(((t,i,o)=>t+(e=>{if(e._$cssResult$===!0)return e.cssText;if(typeof e=="number")return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[o+1]),e[0]);return new C(o,e,i)},I=(i,o)=>{t?i.adoptedStyleSheets=o.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):o.forEach((t=>{const o=document.createElement("style"),n=e.litNonce;n!==void 0&&o.setAttribute("nonce",n),o.textContent=t.cssText,i.appendChild(o)}))},n=t?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return V(t)})(e):e;var s;const a=window,r=a.trustedTypes,l=r?r.emptyScript:"",d=a.reactiveElementPolyfillSupport,p={toAttribute(e,t){switch(t){case Boolean:e=e?l:null;break;case Object:case Array:e=e==null?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=e!==null;break;case Number:i=e===null?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},st=(e,t)=>t!==e&&(t==t||e==e),m={attribute:!0,type:String,converter:p,reflect:!1,hasChanged:st};class x extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;(t=this.h)!==null&&t!==void 0||(this.h=[]),this.h.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,i)=>{const o=this._$Ep(i,t);o!==void 0&&(this._$Ev.set(o,i),e.push(o))})),e}static createProperty(e,t=m){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const i=typeof e=="symbol"?Symbol():"__"+e,o=this.getPropertyDescriptor(e,i,t);o!==void 0&&Object.defineProperty(this.prototype,e,o)}}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(o){const n=this[e];this[t]=o,this.requestUpdate(e,n,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||m}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const i of t)this.createProperty(i,e[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(n(e))}else e!==void 0&&t.push(n(e));return t}static _$Ep(e,t){const i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(e=this.constructor.h)===null||e===void 0||e.forEach((e=>e(this)))}addController(e){var t,i;((t=this._$ES)!==null&&t!==void 0?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((i=e.hostConnected)===null||i===void 0||i.call(e))}removeController(e){var t;(t=this._$ES)===null||t===void 0||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=(e=this.shadowRoot)!==null&&e!==void 0?e:this.attachShadow(this.constructor.shadowRootOptions);return I(t,this.constructor.elementStyles),t}connectedCallback(){var e;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)===null||e===void 0||e.forEach((e=>{var t;return(t=e.hostConnected)===null||t===void 0?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)===null||e===void 0||e.forEach((e=>{var t;return(t=e.hostDisconnected)===null||t===void 0?void 0:t.call(e)}))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EO(e,t,i=m){var o;const n=this.constructor._$Ep(e,i);if(n!==void 0&&i.reflect===!0){const s=(((o=i.converter)===null||o===void 0?void 0:o.toAttribute)!==void 0?i.converter:p).toAttribute(t,i.type);this._$El=e,s==null?this.removeAttribute(n):this.setAttribute(n,s),this._$El=null}}_$AK(e,t){var i;const o=this.constructor,n=o._$Ev.get(e);if(n!==void 0&&this._$El!==n){const e=o.getPropertyOptions(n),s=typeof e.converter=="function"?{fromAttribute:e.converter}:((i=e.converter)===null||i===void 0?void 0:i.fromAttribute)!==void 0?e.converter:p;this._$El=n,this[n]=s.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,i){let o=!0;e!==void 0&&(((i=i||this.constructor.getPropertyOptions(e)).hasChanged||st)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),i.reflect===!0&&this._$El!==e&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(e,i))):o=!1),!this.isUpdatePending&&o&&(this._$E_=this._$Ej())}_$Ej(){return St(this,null,(function*(){this.isUpdatePending=!0;try{yield this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending}))}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),(e=this._$ES)===null||e===void 0||e.forEach((e=>{var t;return(t=e.hostUpdate)===null||t===void 0?void 0:t.call(e)})),this.update(i)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)===null||t===void 0||t.forEach((e=>{var t;return(t=e.hostUpdated)===null||t===void 0?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){this._$EC!==void 0&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}x.finalized=!0,x.elementProperties=new Map,x.elementStyles=[],x.shadowRootOptions={mode:"open"},d==null||d({ReactiveElement:x}),((s=a.reactiveElementVersions)!==null&&s!==void 0?s:a.reactiveElementVersions=[]).push("1.4.1");var g;const u=window,h=u.trustedTypes,_=h?h.createPolicy("lit-html",{createHTML:e=>e}):void 0,v=`lit$${(Math.random()+"").slice(9)}$`,f="?"+v,y=`<${f}>`,S=document,O=(e="")=>S.createComment(e),T=e=>e===null||typeof e!="object"&&typeof e!="function",b=Array.isArray,Pt=e=>b(e)||typeof(e==null?void 0:e[Symbol.iterator])=="function",E=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,w=/-->/g,A=/>/g,R=RegExp(`>|[ \t\n\f\r](?:([^\\s"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),N=/'/g,L=/"/g,B=/^(?:script|style|textarea|title)$/i,kt=e=>(t,...i)=>({_$litType$:e,strings:t,values:i}),j=kt(1),G=Symbol.for("lit-noChange"),H=Symbol.for("lit-nothing"),W=new WeakMap,Ct=(e,t,i)=>{var o,n;const s=(o=i==null?void 0:i.renderBefore)!==null&&o!==void 0?o:t;let a=s._$litPart$;if(a===void 0){const e=(n=i==null?void 0:i.renderBefore)!==null&&n!==void 0?n:null;s._$litPart$=a=new q(t.insertBefore(O(),e),e,void 0,i!=null?i:{})}return a._$AI(e),a},$=S.createTreeWalker(S,129,null,!1),It=(e,t)=>{const i=e.length-1,o=[];let n,s=t===2?"<svg>":"",a=E;for(let t=0;t<i;t++){const i=e[t];let r,l,d=-1,p=0;for(;p<i.length&&(a.lastIndex=p,l=a.exec(i),l!==null);)p=a.lastIndex,a===E?l[1]==="!--"?a=w:l[1]!==void 0?a=A:l[2]!==void 0?(B.test(l[2])&&(n=RegExp("</"+l[2],"g")),a=R):l[3]!==void 0&&(a=R):a===R?l[0]===">"?(a=n!=null?n:E,d=-1):l[1]===void 0?d=-2:(d=a.lastIndex-l[2].length,r=l[1],a=l[3]===void 0?R:l[3]==='"'?L:N):a===L||a===N?a=R:a===w||a===A?a=E:(a=R,n=void 0);const m=a===R&&e[t+1].startsWith("/>")?" ":"";s+=a===E?i+y:d>=0?(o.push(r),i.slice(0,d)+"$lit$"+i.slice(d)+v+m):i+v+(d===-2?(o.push(void 0),t):m)}const r=s+(e[i]||"<?>")+(t===2?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[_!==void 0?_.createHTML(r):r,o]};class U{constructor({strings:e,_$litType$:t},i){let o;this.parts=[];let n=0,s=0;const a=e.length-1,r=this.parts,[l,d]=It(e,t);if(this.el=U.createElement(l,i),$.currentNode=this.el.content,t===2){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;(o=$.nextNode())!==null&&r.length<a;){if(o.nodeType===1){if(o.hasAttributes()){const e=[];for(const t of o.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(v)){const i=d[s++];if(e.push(t),i!==void 0){const e=o.getAttribute(i.toLowerCase()+"$lit$").split(v),t=/([.?@])?(.*)/.exec(i);r.push({type:1,index:n,name:t[2],strings:e,ctor:t[1]==="."?Tt:t[1]==="?"?Ut:t[1]==="@"?qt:M})}else r.push({type:6,index:n})}for(const t of e)o.removeAttribute(t)}if(B.test(o.tagName)){const e=o.textContent.split(v),t=e.length-1;if(t>0){o.textContent=h?h.emptyScript:"";for(let i=0;i<t;i++)o.append(e[i],O()),$.nextNode(),r.push({type:2,index:++n});o.append(e[t],O())}}}else if(o.nodeType===8)if(o.data===f)r.push({type:2,index:n});else{let e=-1;for(;(e=o.data.indexOf(v,e+1))!==-1;)r.push({type:7,index:n}),e+=v.length-1}n++}}static createElement(e,t){const i=S.createElement("template");return i.innerHTML=e,i}}function P(e,t,i=e,o){var n,s,a,r;if(t===G)return t;let l=o!==void 0?(n=i._$Cl)===null||n===void 0?void 0:n[o]:i._$Cu;const d=T(t)?void 0:t._$litDirective$;return(l==null?void 0:l.constructor)!==d&&((s=l==null?void 0:l._$AO)===null||s===void 0||s.call(l,!1),d===void 0?l=void 0:(l=new d(e),l._$AT(e,i,o)),o!==void 0?((a=(r=i)._$Cl)!==null&&a!==void 0?a:r._$Cl=[])[o]=l:i._$Cu=l),l!==void 0&&(t=P(e,l._$AS(e,t.values),l,o)),t}class Ot{constructor(e,t){this.v=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(e){var t;const{el:{content:i},parts:o}=this._$AD,n=((t=e==null?void 0:e.creationScope)!==null&&t!==void 0?t:S).importNode(i,!0);$.currentNode=n;let s=$.nextNode(),a=0,r=0,l=o[0];for(;l!==void 0;){if(a===l.index){let t;l.type===2?t=new q(s,s.nextSibling,this,e):l.type===1?t=new l.ctor(s,l.name,l.strings,this,e):l.type===6&&(t=new Lt(s,this,e)),this.v.push(t),l=o[++r]}a!==(l==null?void 0:l.index)&&(s=$.nextNode(),a++)}return n}m(e){let t=0;for(const i of this.v)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class q{constructor(e,t,i,o){var n;this.type=2,this._$AH=H,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=o,this._$C_=(n=o==null?void 0:o.isConnected)===null||n===void 0||n}get _$AU(){var e,t;return(t=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&t!==void 0?t:this._$C_}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&e.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=P(this,e,t),T(e)?e===H||e==null||e===""?(this._$AH!==H&&this._$AR(),this._$AH=H):e!==this._$AH&&e!==G&&this.$(e):e._$litType$!==void 0?this.T(e):e.nodeType!==void 0?this.k(e):Pt(e)?this.O(e):this.$(e)}S(e,t=this._$AB){return this._$AA.parentNode.insertBefore(e,t)}k(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}$(e){this._$AH!==H&&T(this._$AH)?this._$AA.nextSibling.data=e:this.k(S.createTextNode(e)),this._$AH=e}T(e){var t;const{values:i,_$litType$:o}=e,n=typeof o=="number"?this._$AC(e):(o.el===void 0&&(o.el=U.createElement(o.h,this.options)),o);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===n)this._$AH.m(i);else{const e=new Ot(n,this),t=e.p(this.options);e.m(i),this.k(t),this._$AH=e}}_$AC(e){let t=W.get(e.strings);return t===void 0&&W.set(e.strings,t=new U(e)),t}O(e){b(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,o=0;for(const n of e)o===t.length?t.push(i=new q(this.S(O()),this.S(O()),this,this.options)):i=t[o],i._$AI(n),o++;o<t.length&&(this._$AR(i&&i._$AB.nextSibling,o),t.length=o)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;this._$AM===void 0&&(this._$C_=e,(t=this._$AP)===null||t===void 0||t.call(this,e))}}class M{constructor(e,t,i,o,n){this.type=1,this._$AH=H,this._$AN=void 0,this.element=e,this.name=t,this._$AM=o,this.options=n,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=H}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,i,o){const n=this.strings;let s=!1;if(n===void 0)e=P(this,e,t,0),s=!T(e)||e!==this._$AH&&e!==G,s&&(this._$AH=e);else{const o=e;let a,r;for(e=n[0],a=0;a<n.length-1;a++)r=P(this,o[i+a],t,a),r===G&&(r=this._$AH[a]),s||(s=!T(r)||r!==this._$AH[a]),r===H?e=H:e!==H&&(e+=(r!=null?r:"")+n[a+1]),this._$AH[a]=r}s&&!o&&this.P(e)}P(e){e===H?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}}class Tt extends M{constructor(){super(...arguments),this.type=3}P(e){this.element[this.name]=e===H?void 0:e}}const K=h?h.emptyScript:"";class Ut extends M{constructor(){super(...arguments),this.type=4}P(e){e&&e!==H?this.element.setAttribute(this.name,K):this.element.removeAttribute(this.name)}}class qt extends M{constructor(e,t,i,o,n){super(e,t,i,o,n),this.type=5}_$AI(e,t=this){var i;if((e=(i=P(this,e,t,0))!==null&&i!==void 0?i:H)===G)return;const o=this._$AH,n=e===H&&o!==H||e.capture!==o.capture||e.once!==o.once||e.passive!==o.passive,s=e!==H&&(o===H||n);n&&this.element.removeEventListener(this.name,this,o),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;typeof this._$AH=="function"?this._$AH.call((i=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&i!==void 0?i:this.element,e):this._$AH.handleEvent(e)}}class Lt{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){P(this,e)}}const Y=u.litHtmlPolyfillSupport;Y==null||Y(U,q),((g=u.litHtmlVersions)!==null&&g!==void 0?g:u.litHtmlVersions=[]).push("2.3.1");var Z,Q;class k extends x{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const i=super.createRenderRoot();return(e=(t=this.renderOptions).renderBefore)!==null&&e!==void 0||(t.renderBefore=i.firstChild),i}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Ct(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!1)}render(){return G}}k.finalized=!0,k._$litElement$=!0,(Z=globalThis.litElementHydrateSupport)===null||Z===void 0||Z.call(globalThis,{LitElement:k});const J=globalThis.litElementPolyfillSupport;J==null||J({LitElement:k}),((Q=globalThis.litElementVersions)!==null&&Q!==void 0?Q:globalThis.litElementVersions=[]).push("3.2.2");function Nt(e,t,i){arguments.length===2&&(i=!0);let o=e;const n=(t||"").split("/");for(const e of n){if(!Object.prototype.hasOwnProperty.call(o,e)){if(!i)return;o[e]={}}o=o[e]}return o}function Rt(e,t,i){let o=e;if(t==="")throw new Error("Path cannot be empty");const n=(t||"").split("/"),s=n.length;return n.forEach(((e,t)=>{Object.prototype.hasOwnProperty.call(o,e)||(o[e]={}),t===s-1&&(o[e]=i),o=o[e]})),o}function vt(e,t){let i=e;const o=(t||"").split("/"),n=o.length;o.forEach(((e,t)=>{!Object.prototype.hasOwnProperty.call(i,e)||(t===n-1?delete i[e]:i=i[e])}))}function Mt(e,t){if(typeof t!="string"||t.length===0)return null;const i=t.split("/");let o="",n=e;for(let e=0;e<i.length;e++){const t=i[e];if(!Object.prototype.hasOwnProperty.call(n,t))return o+(o.length===0?"":"/")+t;n=n[t],o+=(e===0?"":"/")+t}return t===o?null:o}const ee="surveyTriggerButton";function Ht(e){const{interceptUrl:t,globalObj:i,surveyLaunchMethod:o}=e;return new Promise(((n,s)=>{if(!t){s(new Error("No intercept URL was provided. This is a mandatory parameter."));return}try{if(!i.document||!i.document.body)throw new Error("Cannot inject elements in the document: document.body is not available.");let s=null;switch(o){case"invisibleButton":if(document.getElementById(ee))throw new Error(`An element with id ${ee} already exists in this page. The survey won't be launched unless the existing button is removed or its id is renamed.`);s=Qt();break;case"qsiApi":break;default:throw new Error(`Unsupported launch method: ${o}.`)}if(mt(i))i.QSI.API.load().then((()=>{const t=ft(e,s,null);n(t)}));else{Ft(t,i);const c=()=>{const t=ft(e,s,c);n(t)};i.addEventListener("qsi_js_loaded",c,!1)}}catch(e){s(e)}}))}function ft(e,t,i){const o=e.globalObj;if(!o.QSI.API)throw new Error("Cannot create api context: QSI.API is not available in the global scope");return{QSI:o.QSI,setParameters:new Set([]),globalObj:o,destroyed:!1,firstNonExistingRoot:Mt(o,e.contextRootPath),contextRootPath:e.contextRootPath,contextParamPaths:jt(e.contextParamPaths,e.customContextParamPaths),surveyLaunchMethod:e.surveyLaunchMethod,apiLoadedListener:i,invisibleButtonElement:t}}function mt(e){return!!(e.QSI&&e.QSI.API&&typeof e.QSI.API.unload=="function")}function jt(e,t){return Object.keys(e||{}).reduce(((t,i)=>(t[i]=e[i],t)),JSON.parse(JSON.stringify(t||{})))}function Qt(){const e=document.createElement("button");return e.setAttribute("id","surveyTriggerButton"),e.style.display="none",document.body.appendChild(e),e}function Ft(e,t){const i=t.document.createElement("script");i.type="text/javascript",i.src=e,t.document.body.appendChild(i)}function zt(e,t){const i=Nt(e.globalObj,e.contextRootPath);Object.keys(t).forEach((o=>{const n=e.contextParamPaths[o]||o;Rt(i,n,t[o]),e.setParameters.add(o)}))}function Vt(e){if(e.setParameters.size===0)throw new Error("Cannot start a survey without context parameters. Call setContextParameters first.");if(e.surveyLaunchMethod==="invisibleButton"){e.invisibleButtonElement&&e.invisibleButtonElement.dispatchEvent(new Event("click"));return}e.QSI.API.unload(),e.QSI.API.load().then(e.QSI.API.run.bind(e.QSI.API))}function Dt(e){mt(e)&&e.QSI.API.unload(),e.apiLoadedListener&&e.globalObj.removeEventListener("qsi_js_loaded",e.apiLoadedListener);let t=e.contextRootPath;e.firstNonExistingRoot?vt(e.globalObj,e.firstNonExistingRoot):e.setParameters.forEach((i=>{const o=e.contextParamPaths[i];o&&(t=`${t}/${o}`),vt(e.globalObj,t)})),e.invisibleButtonElement&&e.invisibleButtonElement.remove(),e.destroyed=!0}const te={init:Ht,destroy:Dt,setContextParameters:zt,startSurvey:Vt},ie="cx-qtx-sbtn-timestamp",oe="cx-qtx-sbtn-localstorage-test";function Gt(e){if(!!e.enabled)try{e.globalObj.localStorage.setItem(ie,+new Date)}catch(e){return}}function Zt(e){try{return e.globalObj.localStorage.getItem(ie)}catch(e){return null}}function Wt(e){var t;if(typeof e._IS_LOCAL_STORAGE_AVAILABLE_CACHE=="boolean")return e._IS_LOCAL_STORAGE_AVAILABLE_CACHE;const i=(t=e==null?void 0:e.globalObj)==null?void 0:t.localStorage;let o;try{i.setItem(oe,"true"),i.removeItem(oe),o=!0}catch(e){o=!1}return e._IS_LOCAL_STORAGE_AVAILABLE_CACHE=o,o}function Jt(e){return new Promise(((t,i)=>{var o;if(!e.enabled){t(!1);return}if(!Wt(e)){t(!1);return}const n=(o=e==null?void 0:e.range)==null?void 0:o.type;if(n!=="months"){i(new Error(`Invalid range type configured: ${n}`));return}const s=(new Date).getMonth()+1,a=Yt(e).indexOf(s)>=0,r=Zt(e);if(!r){t(a);return}const l=parseInt(r,10),d=new Date(l).getMonth()+1;t(a&&s!==d)}))}function Yt(e){var t,i;return((t=e==null?void 0:e.range)==null?void 0:t.type)==="months"?(i=e==null?void 0:e.range)==null?void 0:i.value.map((e=>window.parseInt(e,10))):[]}const ne={saveUserInteractionTime:Gt,determineNotificationStatus:Jt};class $t extends k{constructor(){super(),this._version="2.0.1",this.apiContext=null,this.notifyUser=null,this.surveyLaunchMethod="invisibleButton",this.contextParams={},this.fiori3Compatible=!1,this.interceptUrl="",this.contextRootPath="sap/qtx",this.notificationConfig={enabled:!0,range:{type:"months",value:[2,5,8,11]}},this.title="Give Feedback",this.ariaLabel="Give Feedback",this.contextParamPaths={Q_Language:"appcontext/languageTag",language:"appcontext/languageTag",appFrameworkVersion:"appcontext/appFrameworkVersion",theme:"appcontext/theme",appId:"appcontext/appId",appVersion:"appcontext/appVersion",technicalAppComponentId:"appcontext/technicalAppComponentId",appTitle:"appcontext/appTitle",appSupportInfo:"appcontext/appSupportInfo",tenantId:"session/tenantId",tenantRole:"session/tenantRole",appFrameworkId:"appcontext/appFrameworkId",productName:"session/productName",platformType:"session/platformType",pushSrcType:"push/pushSrcType",pushSrcAppId:"push/pushSrcAppId",pushSrcTrigger:"push/pushSrcTrigger",clientAction:"appcontext/clientAction",previousTheme:"appcontext/previousTheme",followUpCount:"appcontext/followUpCount",deviceType:"device/type",orientation:"device/orientation",osName:"device/osName",browserName:"device/browserName"},this.customContextParamPaths={}}static get properties(){return{title:{type:String,attribute:"title",reflect:!1},ariaLabel:{type:String,attribute:"aria-label",reflect:!1},surveyLaunchMethod:{type:String,attribute:"survey-launch-method",reflect:!1},notifyUser:{type:Boolean,attribute:"notify-user",reflect:!0},notificationConfig:{type:Object,attribute:"notification-config",reflect:!0},interceptUrl:{type:String,attribute:"intercept-url",reflect:!0},customContextParamPaths:{type:Object,attribute:"custom-context-param-paths",reflect:!0},contextParamPaths:{type:Object,attribute:"context-param-paths",reflect:!0},contextRootPath:{type:String,attribute:"context-root-path",reflect:!0},contextParams:{type:Object,attribute:"context-params",reflect:!0},fiori3Compatible:{type:Boolean,attribute:"fiori3-compatible",reflect:!0}}}_onClick(){this._turnOffNotification(),ne.saveUserInteractionTime(z(F({},this.notificationConfig),{globalObj:window})),this._runSurvey()}_turnOffNotification(){this.notifyUser=!1,this.requestUpdate()}_runSurvey(){this._getAPIContext().then((e=>{const t=this.contextParams;this.apiContext=e,te.setContextParameters(this.apiContext,t),te.startSurvey(this.apiContext)}),(e=>{console.log(e)}))}_getAPIContext(){return this.apiContext?Promise.resolve(this.apiContext):te.init({interceptUrl:this.interceptUrl,globalObj:window,contextRootPath:this.contextRootPath,contextParamPaths:this.contextParamPaths,customContextParamPaths:this.customContextParamPaths,surveyLaunchMethod:this.surveyLaunchMethod})}setContextParams(e){this.contextParams=JSON.parse(JSON.stringify(e))}updateContextParam(e,t){this.contextParams[e]=t}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this._onClick),this.setAttribute("aria-hidden","true"),ne.determineNotificationStatus(z(F({},this.notificationConfig),{globalObj:window})).then((e=>{this.notifyUser===null&&(this.notifyUser=e,this.requestUpdate())}),(e=>{console.log(e)}))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this._onClick),this.apiContext&&(te.destroy(this.apiContext),this.apiContext=null)}render(){return j`
            <slot>
                <button
                    class="qtxSurveyFallbackButton"
                    title="${this.title}"
                    aria-label="${this.ariaLabel}"
                >
                </button>
            </slot>
        `}static get styles(){return D`/*
 * Prevent focus effect on the host, the button only should be focussed.
 */
:host(:focus) {
    outline: none;
    box-shadow: none;
}
:host(:focus) .qtxSurveyFallbackButton {
    background-color: initial;
}
.qtxSurveyFallbackButton {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    width: var(--qtxSurveyButton_Size, 2rem);
    height: var(--qtxSurveyButton_Size, 2rem);
    outline: none;
    shape-rendering: geometricprecision;
    /* Fiori Next buttons have transitions */
    -webkit-transition: 0.3s ease-in-out;
    transition: 0.3s ease-in-out;
    font-weight: 400;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    margin: 0;
    border: 0;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    cursor: pointer;
    position: relative;
    padding: 6px;
    -webkit-box-shadow: none;
    box-shadow: none;
    border-radius: var(--sapButton_BorderCornerRadius, 0.5rem);
    background: 0 0;
}
.qtxSurveyFallbackButton.is-focus,
.qtxSurveyFallbackButton:focus {
    z-index: 5;
    background: var(--sapShell_Hover_Background, transparent);
    outline: 0;
    border-color: #fff;
    -webkit-box-shadow: 0 0 2px rgba(27, 144, 255, 0.16),
        0 8px 16px rgba(27, 144, 255, 0.16), 0 0 0 0.125rem #1b90ff,
        inset 0 0 0 0.125rem #fff;
    box-shadow: 0 0 2px rgba(27, 144, 255, 0.16),
        0 8px 16px rgba(27, 144, 255, 0.16), 0 0 0 0.125rem #1b90ff,
        inset 0 0 0 0.125rem #fff;
}
:host([fiori3-compatible]) .qtxSurveyFallbackButton {
    /*
     * Fiori 3: use correct sizing
     */
    width: var(--qtxSurveyButton_Size, 2.25rem);
    height: var(--qtxSurveyButton_Size, 2.25rem);
    /*
     * Fiori 3: disable Fiori Next transitions + box shadow
     */
    -webkit-transition: none;
    transition: none;
    box-shadow: none;
    -webkit-box-shadow: none;
}
:host([fiori3-compatible]):host(:hover) .qtxSurveyFallbackButton {
    box-shadow: none;
    -webkit-box-shadow: none;
}
:host([fiori3-compatible]):host(:active) .qtxSurveyFallbackButton {
    box-shadow: none;
    -webkit-box-shadow: none;
}
/*
 * Fiori3: create visible focus area
 */
:host([fiori3-compatible]):host(:focus) .qtxSurveyFallbackButton:after {
    content: "";
    position: absolute;
    width: auto;
    height: auto;
    top: 0.0625rem;
    left: 0.0625rem;
    right: 0.0625rem;
    bottom: 0.0625rem;
    border: var(--sapContent_FocusWidth, 0.0625rem) dotted
        var(--sapContent_ContrastFocusColor, #fff);
    border-radius: 4px;
}
:host(:hover) .qtxSurveyFallbackButton {
    background-color: var(--sapShell_Hover_Background, transparent);
    -webkit-box-shadow: 0 0 2px rgba(131, 150, 168, 0.16),
        0 8px 16px rgba(131, 150, 168, 0.16);
    box-shadow: 0 0 2px rgba(131, 150, 168, 0.16),
        0 8px 16px rgba(131, 150, 168, 0.16);
}
:host(:hover) path {
    stroke: var(--sapShell_Active_TextColor, #475e75);
}
:host(:hover) .eye,
:host(:hover) .foregroundIcon {
    fill: var(--sapShell_Active_TextColor, #475e75);
    stroke: transparent;
}
:host(:active) .qtxSurveyFallbackButton {
    -webkit-box-shadow: 0 0 2px rgba(131, 150, 168, 0.16),
        0 2px 4px rgba(131, 150, 168, 0.16);
    box-shadow: 0 0 2px rgba(131, 150, 168, 0.16),
        0 2px 4px rgba(131, 150, 168, 0.16);
    background: var(--sapShell_Active_Background, #fff);
}
:host([notify-user]) .smiley,
:host([notify-user]) .backgroundCircle {
    fill: var(
        --qtxSurveyButton_NotificationColor,
        #64edd2
    ); /* Teal 2 */
}
:host([notify-user][fiori3-compatible]) .smiley,
:host([notify-user][fiori3-compatible]) .backgroundCircle {
    fill: var(
        --qtxSurveyButton_NotificationColor,
        var(--sapIndicationColor_6, #0f828f)
    );
}
:host([fiori3-compatible]) .pathGroup {
    transform: scale(var(--qtxSurveyButton_IconScale, 1))
        translate(0, var(--qtxSurveyButton_IconOffsetY, 0));
}
.pathGroup {
    transform: scale(var(--qtxSurveyButton_IconScale, 1))
        translate(0, var(--qtxSurveyButton_IconOffsetY, 0));
    transform-origin: center;
    fill: none;
}
path {
    stroke: var(--sapShell_InteractiveTextColor, #5b738b);
    stroke-width: 2px;
    vector-effect: non-scaling-stroke;
}
.eye,
.foregroundIcon {
    fill: var(--sapShell_InteractiveTextColor, #5b738b);
    stroke: transparent;
}
.qtxSurveyFallbackButton::after,
.qtxSurveyFallbackButton::before {
    -webkit-box-sizing: inherit;
    box-sizing: inherit;
    font-size: inherit;
}
.qtxSurveyFallbackButton.is-pressed,
.qtxSurveyFallbackButton[aria-pressed="true"] {
    -webkit-box-shadow: 0 0 2px rgba(131, 150, 168, 0.16),
        0 2px 4px rgba(131, 150, 168, 0.16);
    box-shadow: 0 0 2px rgba(131, 150, 168, 0.16),
        0 2px 4px rgba(131, 150, 168, 0.16);
    background: var(--sapShell_Active_Background, #fff);
}
`}}At($t,"shadowRootOptions",z(F({},k.shadowRootOptions),{mode:"closed",delegatesFocus:"true"})),window.customElements.define("cx-qtx-survey-button",$t)})();window.__smartedit__.addDecoratorPayload("Component","QualtricsComponent",{selector:"se-qualtrics",template:`\n        <cx-qtx-survey-button\n            fiori3-compatible="true"\n            [attr.aria-hidden]="false"\n            attr.aria-label="{{ 'se.toolbar.qualtrics.button.arialabel' | translate }}"\n            style="--qtxSurveyButton_Size:40px; --sapContent_ContrastFocusColor: transparent;"\n            title="{{ 'se.toolbar.qualtrics.title' | translate }}"\n            [attr.intercept-url]="interceptUrl"\n            [attr.context-params]="contextParamsString"\n            (click)="onClick()">\n            <button type="button" class="fd-button">\n                <span class="sap-icon--feedback"></span>\n            </button>\n        </cx-qtx-survey-button>\n    `});let ct=class QualtricsComponent{constructor(e,t,i){this.translateService=e;this.settingService=t;this.userTrackingService=i;this.interceptUrl="";this.contextParamsString="";this.contextParams={}}ngOnDestroy(){document.querySelector("cx-qtx-survey-button").remove()}ngOnInit(){this.contextParams=this._getFixedContextParams();this.settingService.load().then((e=>{const t=`${e["modelt.customer.code"]}-${e["modelt.project.code"]}-${e["modelt.environment.code"]}`;const i=e["modelt.environment.type"];const o=e["build.version.api"];this.contextParamsString=JSON.stringify(Object.assign(Object.assign({},this.contextParams),{tenantId:t,tenantRole:i,appVersion:o}));this.interceptUrl=e["smartedit.qualtrics.interceptUrl"]}));this.translateService.onLangChange.subscribe((e=>{const t=e.lang;const i=e.translations["se.application.name"];this.contextParamsString=JSON.stringify(Object.assign(Object.assign({},this.contextParams),{language:t,productName:i}))}))}onClick(){this.userTrackingService.trackingUserAction(s.USER_TRACKING_FUNCTIONALITY.HEADER_TOOL,"Give Feedback")}_getFixedContextParams(){return{appFrameworkId:4,appFrameworkVersion:n.VERSION.full,appId:"SmartEdit",appTitle:"SmartEdit",appSupportInfo:"CEC-COM-ADM-SEDIT",pushSrcType:2}}};ct=__decorate([n.Component({selector:"se-qualtrics",template:`\n        <cx-qtx-survey-button\n            fiori3-compatible="true"\n            [attr.aria-hidden]="false"\n            attr.aria-label="{{ 'se.toolbar.qualtrics.button.arialabel' | translate }}"\n            style="--qtxSurveyButton_Size:40px; --sapContent_ContrastFocusColor: transparent;"\n            title="{{ 'se.toolbar.qualtrics.title' | translate }}"\n            [attr.intercept-url]="interceptUrl"\n            [attr.context-params]="contextParamsString"\n            (click)="onClick()">\n            <button type="button" class="fd-button">\n                <span class="sap-icon--feedback"></span>\n            </button>\n        </cx-qtx-survey-button>\n    `}),__metadata("design:paramtypes",[g.TranslateService,s.SettingsService,s.IUserTrackingService])],ct);let dt=class TopToolbarsModule{};dt=__decorate([n.NgModule({schemas:[n.CUSTOM_ELEMENTS_SCHEMA],imports:[u.PopoverModule,p.CommonModule,s.SeGenericEditorModule,g.TranslateModule.forChild(),s.TooltipModule],declarations:[s.HeaderLanguageDropdownComponent,Je,Ye,qe,Ze,Ke,et,tt,ct],entryComponents:[s.HeaderLanguageDropdownComponent,Je,Ye,qe,Ze,Ke,et,tt,ct],exports:[s.HeaderLanguageDropdownComponent,Je,Ye,qe,Ze,Ke,et,tt,ct]})],dt);t.ToolbarModule=class ToolbarModule{};t.ToolbarModule=__decorate([n.NgModule({imports:[dt,p.CommonModule,g.TranslateModule.forChild(),s.PropertyPipeModule,s.ResizeObserverModule,u.PopoverModule,s.ClickOutsideModule,s.PreventVerticalOverflowModule],providers:[{provide:s.IToolbarServiceFactory,useClass:Ue}],declarations:[Ge,He,je,We,$e],entryComponents:[Ge,He,je,We,$e],exports:[Ge,He,je,We,$e]})],t.ToolbarModule);let pt=class UserTrackingService extends s.IUserTrackingService{constructor(e,t,i){super();this.windowUtils=e;this.settingService=t;this.logService=i;this.CUSTOMER_KEY="modelt.customer.code";this.PROJECT_KEY="modelt.project.code";this.ENVIRONMENT_KEY="modelt.environment.code";this.TRACKING_URL_KEY="smartedit.click.tracking.server.url";this.DEFAULT_CUSTOMER="localCustomer";this.DEFAULT_PROJECT="localProject";this.DEFAULT_ENVIRONMENT="localEnvironment";this.DEFAULT_TRACKING_URL="https://license.hybris.com/collect";this.isInitialized=false}initConfiguration(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.settingService.getBoolean("smartedit.default.click.tracking.enabled");if(!e){this.isInitialized=false;return}if(this.isEnvInitialized()){const e=yield this.getSiteId();let t=yield this.settingService.get(this.TRACKING_URL_KEY);t=t!==undefined?t:this.DEFAULT_TRACKING_URL;this._paq.push(["setTrackerUrl",t]);this._paq.push(["setSiteId",e]);this.isInitialized=true}else{this.isInitialized=false;this.logService.warn("User tracking is enabled and tracking tool is not initialized.")}}))}trackingUserAction(e,t){if(this.isInitialized){if(s.USER_TRACKING_KEY_MAP.has(t)){t=s.USER_TRACKING_KEY_MAP.get(t)}this._paq.push(["trackEvent","SmartEdit",e,t])}}isEnvInitialized(){this._paq=this.windowUtils.getWindow()._paq;return this._paq===undefined?false:this._paq.push!==undefined}getSiteId(){return __awaiter(this,void 0,void 0,(function*(){let e=yield this.settingService.get(this.CUSTOMER_KEY);e=e!==undefined?e:this.DEFAULT_CUSTOMER;let t=yield this.settingService.get(this.PROJECT_KEY);t=t!==undefined?t:this.DEFAULT_PROJECT;let i=yield this.settingService.get(this.ENVIRONMENT_KEY);i=i!==undefined?i:this.DEFAULT_ENVIRONMENT;return`${e}-${t}-${i}`}))}};pt=__decorate([s.GatewayProxied("initConfiguration","trackingUserAction"),n.Injectable(),__metadata("design:paramtypes",[s.WindowUtils,s.ISettingsService,s.LogService])],pt);window.__smartedit__.addDecoratorPayload("Component","AnnouncementBoardComponent",{selector:"se-announcement-board",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<ng-container *ngIf="(announcements$ | async) as announcements"><div class="se-announcement-board"><se-announcement *ngFor="\n                let announcement of (announcements | seReverse);\n                trackBy: announcementTrackBy;\n                let i = index\n            " id="se-announcement-{{ i }}" [announcement]="announcement"></se-announcement></div></ng-container>`});let gt=class AnnouncementBoardComponent{constructor(e){this.announcementService=e}ngOnInit(){this.announcements$=this.announcementService.getAnnouncements()}announcementTrackBy(e,t){return t.id}};gt=__decorate([n.Component({selector:"se-announcement-board",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<ng-container *ngIf="(announcements$ | async) as announcements"><div class="se-announcement-board"><se-announcement *ngFor="\n                let announcement of (announcements | seReverse);\n                trackBy: announcementTrackBy;\n                let i = index\n            " id="se-announcement-{{ i }}" [announcement]="announcement"></se-announcement></div></ng-container>`}),__param(0,n.Inject(s.IAnnouncementService)),__metadata("design:paramtypes",[j])],gt);window.__smartedit__.addDecoratorPayload("Component","AnnouncementComponent",{selector:"se-announcement",changeDetection:n.ChangeDetectionStrategy.OnPush,animations:[S.trigger("fadeAnimation",[S.transition(":enter",[S.style({opacity:0,transform:"rotateY(90deg)"}),S.animate("0.5s"),S.style({opacity:1,transform:"translateX(0px)"})]),S.transition(":leave",[S.animate("0.25s"),S.style({opacity:"0",transform:"translateX(100%)"})])])],template:`<div class="se-announcement-content"><span *ngIf="isCloseable()" class="sap-icon--decline se-announcement-close" (click)="closeAnnouncement()"></span><div *ngIf="hasMessage()"><h4 *ngIf="hasMessageTitle()">{{ announcement.messageTitle | translate }}</h4><span>{{ announcement.message | translate }}</span></div><ng-container *ngIf="hasComponent()"><ng-container *ngComponentOutlet="announcement.component; injector: announcementInjector"></ng-container></ng-container></div>`});let ut=class AnnouncementComponent{constructor(e,t){this.announcementService=e;this.injector=t}get fadeAnimation(){return true}ngOnChanges(){this.createAnnouncementInjector()}hasComponent(){return this.announcement.hasOwnProperty("component")}hasMessage(){return this.announcement.hasOwnProperty("message")}hasMessageTitle(){return this.announcement.hasOwnProperty("messageTitle")}isCloseable(){return this.announcement.hasOwnProperty("closeable")?this.announcement.closeable:B.closeable}closeAnnouncement(){this.announcementService.closeAnnouncement(this.announcement.id)}createAnnouncementInjector(){this.announcementInjector=n.Injector.create({parent:this.injector,providers:[{provide:s.ANNOUNCEMENT_DATA,useValue:Object.assign({id:this.announcement.id},this.announcement.data)}]})}};__decorate([n.Input(),__metadata("design:type",Object)],ut.prototype,"announcement",void 0);__decorate([n.HostBinding("@fadeAnimation"),__metadata("design:type",Boolean),__metadata("design:paramtypes",[])],ut.prototype,"fadeAnimation",null);ut=__decorate([n.Component({selector:"se-announcement",changeDetection:n.ChangeDetectionStrategy.OnPush,animations:[S.trigger("fadeAnimation",[S.transition(":enter",[S.style({opacity:0,transform:"rotateY(90deg)"}),S.animate("0.5s"),S.style({opacity:1,transform:"translateX(0px)"})]),S.transition(":leave",[S.animate("0.25s"),S.style({opacity:"0",transform:"translateX(100%)"})])])],template:`<div class="se-announcement-content"><span *ngIf="isCloseable()" class="sap-icon--decline se-announcement-close" (click)="closeAnnouncement()"></span><div *ngIf="hasMessage()"><h4 *ngIf="hasMessageTitle()">{{ announcement.messageTitle | translate }}</h4><span>{{ announcement.message | translate }}</span></div><ng-container *ngIf="hasComponent()"><ng-container *ngComponentOutlet="announcement.component; injector: announcementInjector"></ng-container></ng-container></div>`}),__metadata("design:paramtypes",[s.IAnnouncementService,n.Injector])],ut);window.__smartedit__.addDecoratorPayload("Component","HotkeyNotificationComponent",{selector:"se-hotkey-notification",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div class="se-notification__hotkey"><div *ngFor="let key of hotkeyNames; let last = last"><div class="se-notification__hotkey--key"><span>{{ key }}</span></div><span *ngIf="!last" class="se-notification__hotkey__icon--add">+</span></div><div class="se-notification__hotkey--text"><div class="se-notification__hotkey--title">{{ title }}</div><div class="se-notification__hotkey--message">{{ message }}</div></div></div>`});let ht=class HotkeyNotificationComponent{};__decorate([n.Input(),__metadata("design:type",Array)],ht.prototype,"hotkeyNames",void 0);__decorate([n.Input(),__metadata("design:type",String)],ht.prototype,"title",void 0);__decorate([n.Input(),__metadata("design:type",String)],ht.prototype,"message",void 0);ht=__decorate([n.Component({selector:"se-hotkey-notification",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div class="se-notification__hotkey"><div *ngFor="let key of hotkeyNames; let last = last"><div class="se-notification__hotkey--key"><span>{{ key }}</span></div><span *ngIf="!last" class="se-notification__hotkey__icon--add">+</span></div><div class="se-notification__hotkey--text"><div class="se-notification__hotkey--title">{{ title }}</div><div class="se-notification__hotkey--message">{{ message }}</div></div></div>`})],ht);window.__smartedit__.addDecoratorPayload("Component","PerspectiveSelectorHotkeyNotificationComponent",{selector:"se-perspective-selector-hotkey-notification",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<se-hotkey-notification [hotkeyNames]="['esc']" [title]="'se.application.status.hotkey.title' | translate" [message]="'se.application.status.hotkey.message' | translate"></se-hotkey-notification>`});let _t=class PerspectiveSelectorHotkeyNotificationComponent{};_t=__decorate([s.SeCustomComponent(),n.Component({selector:"se-perspective-selector-hotkey-notification",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<se-hotkey-notification [hotkeyNames]="['esc']" [title]="'se.application.status.hotkey.title' | translate" [message]="'se.application.status.hotkey.message' | translate"></se-hotkey-notification>`})],_t);let yt=class HotkeyNotificationModule{};yt=__decorate([n.NgModule({imports:[p.CommonModule,s.TranslationModule.forChild()],declarations:[ht,_t],entryComponents:[ht,_t]})],yt);window.__smartedit__.addDecoratorPayload("Component","InvalidRouteComponent",{selector:"empty",template:"<div>This page doesn't exist</div>"});let bt=class InvalidRouteComponent{};bt=__decorate([n.Component({selector:"empty",template:"<div>This page doesn't exist</div>"})],bt);const Et="legacyApp";const wt="sap_fiori_3";window.__smartedit__.addDecoratorPayload("Component","SmarteditcontainerComponent",{selector:s.SMARTEDITCONTAINER_COMPONENT_NAME,template:`\n        <link rel="stylesheet" *ngIf="cssUrl && !defaultTheme" [href]="cssUrl" />\n        <link rel="stylesheet" *ngIf="cssCustomUrl && !defaultTheme" [href]="cssCustomUrl" />\n        <router-outlet></router-outlet>\n        <div ng-attr-id="${Et}">\n            <se-announcement-board></se-announcement-board>\n            <se-notification-panel></se-notification-panel>\n            <div ng-view></div>\n        </div>\n    `});let xt=class SmarteditcontainerComponent{constructor(e,t,i,o,n){this.translateService=e;this.elementRef=i;this.themeSwitchService=o;this.crossFrameEventService=n;this.legacyAppName=Et;this.legacyAppName=Et;this.setApplicationTitle();s.registerCustomComponents(t);this.crossFrameEventService.subscribe(s.EVENTS.TOKEN_STORED,(()=>{o.selectTheme(null)}));this.crossFrameEventService.subscribe(s.EVENT_THEME_CHANGED,(()=>{this.getThemeCss()}))}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){Array.prototype.slice.call(document.body.childNodes).filter((e=>!this.isAppComponent(e)&&!this.isSmarteditLoader(e))).forEach((e=>{this.legacyAppNode.appendChild(e)}));yield this.themeSwitchService.selectTheme(null);this.getThemeCss()}))}setApplicationTitle(){this.translateService.get("se.application.name").subscribe((e=>{document.title=e}))}get legacyAppNode(){return this.elementRef.nativeElement.querySelector(`div[ng-attr-id="${this.legacyAppName}"]`)}isAppComponent(e){return e.nodeType===Node.ELEMENT_NODE&&e.tagName===s.SMARTEDITCONTAINER_COMPONENT_NAME.toUpperCase()}isSmarteditLoader(e){return e.nodeType===Node.ELEMENT_NODE&&(e.id==="smarteditloader"||e.tagName===s.SMARTEDITLOADER_COMPONENT_NAME.toUpperCase())}getThemeCss(){this.cssUrl=this.themeSwitchService.cssUrl;this.cssCustomUrl=this.themeSwitchService.cssCustomUrl;this.defaultTheme=this.themeSwitchService.selectedTheme===wt?true:false}};xt=__decorate([n.Component({selector:s.SMARTEDITCONTAINER_COMPONENT_NAME,template:`\n        <link rel="stylesheet" *ngIf="cssUrl && !defaultTheme" [href]="cssUrl" />\n        <link rel="stylesheet" *ngIf="cssCustomUrl && !defaultTheme" [href]="cssCustomUrl" />\n        <router-outlet></router-outlet>\n        <div ng-attr-id="${Et}">\n            <se-announcement-board></se-announcement-board>\n            <se-notification-panel></se-notification-panel>\n            <div ng-view></div>\n        </div>\n    `}),__metadata("design:paramtypes",[g.TranslateService,n.Injector,n.ElementRef,t.ThemeSwitchService,s.CrossFrameEventService])],xt);window.__smartedit__.addDecoratorPayload("Component","NotificationComponent",{selector:"se-notification",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div class="se-notification" id="{{ id }}" *ngIf="notification"><div [seCustomComponentOutlet]="notification.componentName"></div></div>`});let Bt=class NotificationComponent{ngOnInit(){this.id=this.notification&&this.notification.id?"se-notification-"+this.notification.id:""}};__decorate([n.Input(),__metadata("design:type",Object)],Bt.prototype,"notification",void 0);Bt=__decorate([n.Component({selector:"se-notification",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<div class="se-notification" id="{{ id }}" *ngIf="notification"><div [seCustomComponentOutlet]="notification.componentName"></div></div>`})],Bt);window.__smartedit__.addDecoratorPayload("Component","NotificationPanelComponent",{selector:"se-notification-panel",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<ng-container *ngIf="(notifications$ | async) as notifications"><div class="se-notification-panel" *ngIf="notifications.length > 0" [ngClass]="{'is-mouseover': isMouseOver}" (mouseenter)="onMouseEnter()"><div><se-notification *ngFor="let notification of (notifications | seReverse)" [notification]="notification"></se-notification></div></div></ng-container>`});let Kt=class NotificationPanelComponent{constructor(e,t,i,o,n,s,a,r){this.notificationService=e;this.notificationMouseLeaveDetectionService=t;this.systemEventService=i;this.iframeManagerService=o;this.windowUtils=n;this.element=s;this.yjQuery=a;this.cd=r;this.notificationPanelBounds=null;this.iFrameNotificationPanelBounds=null;this.addMouseMoveEventListenerTimeout=null}ngOnInit(){this.notifications$=this.notificationService.getNotifications();this.isMouseOver=false;this.windowUtils.getWindow().addEventListener("resize",(()=>this.onResize()));this.unRegisterNotificationChangedEventHandler=this.systemEventService.subscribe(s.EVENT_NOTIFICATION_CHANGED,(()=>this.onNotificationChanged()))}ngAfterViewInit(){this.$element=this.yjQuery(this.element.nativeElement)}ngOnDestroy(){this.windowUtils.getWindow().removeEventListener("resize",(()=>this.onResize()));this.notificationMouseLeaveDetectionService.stopDetection();this.unRegisterNotificationChangedEventHandler()}onMouseEnter(){this.isMouseOver=true;this.cd.detectChanges();if(!this.hasBounds()){this.calculateBounds()}this.addMouseMoveEventListenerTimeout=this.addMouseMoveEventListenerTimeout||setTimeout((()=>this.addMouseMoveEventListener()),10)}onMouseLeave(){this.isMouseOver=false;this.cd.detectChanges()}getIFrame(){return this.iframeManagerService.getIframe()[0]}getNotificationPanel(){return this.$element.find(".se-notification-panel")}calculateNotificationPanelBounds(){const e=this.getNotificationPanel();const t=e.position();this.notificationPanelBounds={x:Math.floor(t.left),y:Math.floor(t.top),width:Math.floor(e.width()),height:Math.floor(e.height())}}calculateIFrameNotificationPanelBounds(){const e=this.getIFrame();if(e){this.iFrameNotificationPanelBounds={x:this.notificationPanelBounds.x-e.offsetLeft,y:this.notificationPanelBounds.y-e.offsetTop,width:this.notificationPanelBounds.width,height:this.notificationPanelBounds.height}}}calculateBounds(){this.calculateNotificationPanelBounds();this.calculateIFrameNotificationPanelBounds()}invalidateBounds(){this.notificationPanelBounds=null;this.iFrameNotificationPanelBounds=null}hasBounds(){const e=!!this.notificationPanelBounds;const t=this.getIFrame()?!!this.iFrameNotificationPanelBounds:true;return e&&t}cancelDetection(){this.invalidateBounds();this.notificationMouseLeaveDetectionService.stopDetection();if(this.isMouseOver){this.onMouseLeave()}}onResize(){this.cancelDetection()}onNotificationChanged(){if(!this.isMouseOver){this.cancelDetection()}}addMouseMoveEventListener(){this.addMouseMoveEventListenerTimeout=null;this.notificationMouseLeaveDetectionService.startDetection(this.notificationPanelBounds,this.iFrameNotificationPanelBounds,(()=>this.onMouseLeave()))}};Kt=__decorate([n.Component({selector:"se-notification-panel",changeDetection:n.ChangeDetectionStrategy.OnPush,template:`<ng-container *ngIf="(notifications$ | async) as notifications"><div class="se-notification-panel" *ngIf="notifications.length > 0" [ngClass]="{'is-mouseover': isMouseOver}" (mouseenter)="onMouseEnter()"><div><se-notification *ngFor="let notification of (notifications | seReverse)" [notification]="notification"></se-notification></div></div></ng-container>`}),__param(0,n.Inject(s.INotificationService)),__param(1,n.Inject(s.INotificationMouseLeaveDetectionService)),__param(6,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[G,H,s.SystemEventService,K,s.WindowUtils,n.ElementRef,Function,n.ChangeDetectorRef])],Kt);let Xt=class NotificationPanelModule{};Xt=__decorate([n.NgModule({imports:[Le,s.SharedComponentsModule,p.CommonModule,s.CustomComponentOutletDirectiveModule],declarations:[Kt,Bt],exports:[Kt]})],Xt);const ei="sites-id";window.__smartedit__.addDecoratorPayload("Component","LandingPageComponent",{selector:"se-landing-page",template:`<div class="se-toolbar-group"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar></div><div class="se-landing-page"><div class="se-landing-page-actions"><div class="se-landing-page-container"><h1 class="se-landing-page-title">{{ 'se.landingpage.title' | translate }}</h1><div class="se-landing-page-site-selection" *ngIf="model"><se-generic-editor-dropdown [field]="field" [qualifier]="qualifier" [model]="model" [id]="sitesId"></se-generic-editor-dropdown></div><p class="se-landing-page-label">{{ 'se.landingpage.label' | translate }}</p></div></div><p class="se-landing-page-container se-landing-page-sub-header">Content Catalogs</p><div class="se-landing-page-container se-landing-page-catalogs"><div class="se-landing-page-catalog" *ngFor="let catalog of catalogs; let isLast = last"><se-catalog-details [catalog]="catalog" [siteId]="model.site" [isCatalogForCurrentSite]="isLast"></se-catalog-details></div></div><img src="static-resources/images/best-run-sap-logo.svg" class="se-landing-page-footer-logo" title="{{ 'se.logo.title' | translate }}"/></div>`});let ti=class LandingPageComponent{constructor(e,t,i,o,n,a,r,l){this.siteService=e;this.catalogService=t;this.systemEventService=i;this.storageService=o;this.alertService=n;this.route=a;this.location=r;this.yjQuery=l;this.sitesId=ei;this.qualifier="site";this.catalogs=[];this.SELECTED_SITE_COOKIE_NAME="seselectedsite";this.unregisterUserChangesEventHandler=this.systemEventService.subscribe(s.EVENTS.USER_HAS_CHANGED,(()=>{this.init()}))}ngOnInit(){this.init()}ngOnDestroy(){var e,t;(e=this.unregisterSitesDropdownEventHandler)===null||e===void 0?void 0:e.call(this);(t=this.unregisterUserChangesEventHandler)===null||t===void 0?void 0:t.call(this)}init(){var e;if(this.paramMapSubscription){this.paramMapSubscription.unsubscribe()}else{this.removeStorefrontCssClass()}this.paramMapSubscription=this.route.paramMap.subscribe((e=>{this.getCurrentSiteId(e.get("siteId")).then((e=>{this.setModel(e)}))}));this.siteService.getAccessibleSites().then((e=>{this.field={idAttribute:"uid",labelAttributes:["name"],editable:true,paged:false,options:e}}));(e=this.unregisterSitesDropdownEventHandler)===null||e===void 0?void 0:e.call(this);this.unregisterSitesDropdownEventHandler=this.systemEventService.subscribe(this.sitesId+s.LINKED_DROPDOWN,this.selectedSiteDropdownEventHandler.bind(this))}getCurrentSiteId(e){return this.storageService.getValueFromLocalStorage(this.SELECTED_SITE_COOKIE_NAME,false).then((t=>this.siteService.getAccessibleSites().then((i=>{const o=i.some((t=>t.uid===e));if(o){this.setSelectedSite(e);this.updateRouteToRemoveSite();return e}else{if(e){this.alertService.showInfo("se.landingpage.site.url.error");this.updateRouteToRemoveSite()}const o=i.some((e=>e.uid===t));if(!o){const e=i.length>0?i[0].uid:null;return e}else{return t}}}))))}updateRouteToRemoveSite(){this.location.replaceState("")}removeStorefrontCssClass(){const e=this.yjQuery(document.querySelector("body"));if(e.hasClass("is-storefront")){e.removeClass("is-storefront")}if(e.hasClass("is-safari")){e.removeClass("is-safari")}}selectedSiteDropdownEventHandler(e,t){if(t.optionObject){const e=t.optionObject.id;this.setSelectedSite(e);this.loadCatalogsBySite(e);this.setModel(e)}else{this.catalogs=[]}}setSelectedSite(e){this.storageService.setValueInLocalStorage(this.SELECTED_SITE_COOKIE_NAME,e,false)}loadCatalogsBySite(e){this.catalogService.getContentCatalogsForSite(e).then((e=>this.catalogs=e))}setModel(e){if(this.model){this.model[this.qualifier]=e}else{this.model={[this.qualifier]:e}}}};ti=__decorate([n.Component({selector:"se-landing-page",template:`<div class="se-toolbar-group"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar></div><div class="se-landing-page"><div class="se-landing-page-actions"><div class="se-landing-page-container"><h1 class="se-landing-page-title">{{ 'se.landingpage.title' | translate }}</h1><div class="se-landing-page-site-selection" *ngIf="model"><se-generic-editor-dropdown [field]="field" [qualifier]="qualifier" [model]="model" [id]="sitesId"></se-generic-editor-dropdown></div><p class="se-landing-page-label">{{ 'se.landingpage.label' | translate }}</p></div></div><p class="se-landing-page-container se-landing-page-sub-header">Content Catalogs</p><div class="se-landing-page-container se-landing-page-catalogs"><div class="se-landing-page-catalog" *ngFor="let catalog of catalogs; let isLast = last"><se-catalog-details [catalog]="catalog" [siteId]="model.site" [isCatalogForCurrentSite]="isLast"></se-catalog-details></div></div><img src="static-resources/images/best-run-sap-logo.svg" class="se-landing-page-footer-logo" title="{{ 'se.logo.title' | translate }}"/></div>`}),__param(7,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[Z,s.ICatalogService,s.SystemEventService,s.IStorageService,s.IAlertService,m.ActivatedRoute,p.Location,Function])],ti);window.__smartedit__.addDecoratorPayload("Component","StorefrontPageComponent",{selector:"se-storefront-page",template:`<div class="se-toolbar-group"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar><se-toolbar cssClass="se-toolbar--experience" imageRoot="imageRoot" toolbarName="smartEditExperienceToolbar"></se-toolbar><se-toolbar [ngClass]="{'se-toolbar--perspective-hidden': !isReady}" cssClass="se-toolbar--perspective" imageRoot="imageRoot" toolbarName="smartEditPerspectiveToolbar"></se-toolbar></div><div id="js_iFrameWrapper" class="iframeWrapper"><div class="wrap"><div *ngIf="showPageTreeList()" id="page-tree-container" [ngStyle]="{'width': width}" class="page-tree__list"><se-page-tree-container></se-page-tree-container></div><div *ngIf="showPageTreeList()" class="splitter-tree-panel" resizer="#page-tree-container"></div><div class="iframe-panel"><iframe id="ySmartEditFrame" src=""></iframe><div id="ySmartEditFrameDragArea"></div></div></div></div>`,styles:[`.wrap{display:flex;justify-content:flex-start;flex-wrap:nowrap;height:100%}.page-tree__list{height:100%;padding:16px 0 16px 8px;min-width:20%;max-width:40%;flex:0 0 auto}.iframe-panel{width:100%;height:100%;flex:1 1 auto}.splitter-tree-panel{flex:0 0 auto;width:8px;cursor:col-resize}.se-toolbar--perspective-hidden{visibility:hidden}`]});let ii=class StorefrontPageComponent{constructor(e,t,i,o,n,s,a,r){this.browserService=e;this.iframeManagerService=t;this.experienceService=i;this.yjQuery=o;this.crossFrameEventService=n;this.storageService=s;this.perspectiveService=a;this.smarteditBootstrapGateway=r;this.PAGE_TREE_PANEL_OPEN_COOKIE_NAME="smartedit-page-tree-panel-open";this.isPageTreePanelOpen=false;this.isReady=false;this.width="20%"}ngOnDestroy(){if(this.unregisterPageTreePanelSwitch){this.unregisterPageTreePanelSwitch()}if(this.unregisterOpenInPageTree){this.unregisterOpenInPageTree()}if(this.unregisterPerspectiveChanged){this.unregisterPerspectiveChanged()}}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.iframeManagerService.applyDefault();yield this.experienceService.initializeExperience();this.yjQuery(document.body).addClass("is-storefront");if(this.browserService.isSafari()){this.yjQuery(document.body).addClass("is-safari")}const e=this.perspectiveService.getActivePerspective();if(e&&e.key===s.CMSModesService.ADVANCED_PERSPECTIVE_KEY){yield this.getPageTreePanelStatus();yield this.getPageTreePanelWidth()}this.unregisterPageTreePanelSwitch=this.crossFrameEventService.subscribe(s.EVENT_PAGE_TREE_PANEL_SWITCH,this.handlePageTreePanelSwitch.bind(this));this.unregisterOpenInPageTree=this.crossFrameEventService.subscribe(s.EVENT_OPEN_IN_PAGE_TREE,this.handleOpenInPageTree.bind(this));this.unregisterPerspectiveChanged=this.crossFrameEventService.subscribe(s.EVENT_PERSPECTIVE_CHANGED,this.handlePerspectiveChanged.bind(this));this.smarteditBootstrapGateway.getInstance().subscribe("smartEditReady",this.setPerspectiveToolbarVisible.bind(this))}))}showPageTreeList(){return this.isPageTreePanelOpen}updateStorage(){this.storageService.setValueInLocalStorage(this.PAGE_TREE_PANEL_OPEN_COOKIE_NAME,this.isPageTreePanelOpen,true)}setPerspectiveToolbarVisible(){this.isReady=true}handlePageTreePanelSwitch(){return __awaiter(this,void 0,void 0,(function*(){this.isPageTreePanelOpen=!this.isPageTreePanelOpen;if(this.isPageTreePanelOpen){yield this.getPageTreePanelWidth()}this.updateStorage()}))}handleOpenInPageTree(){return __awaiter(this,void 0,void 0,(function*(){if(!this.isPageTreePanelOpen){this.isPageTreePanelOpen=true;yield this.getPageTreePanelWidth();this.updateStorage()}}))}handlePerspectiveChanged(){return __awaiter(this,void 0,void 0,(function*(){const e=this.perspectiveService.getActivePerspective();if(e&&e.key===s.CMSModesService.ADVANCED_PERSPECTIVE_KEY){yield this.getPageTreePanelStatus();yield this.getPageTreePanelWidth()}else{this.isPageTreePanelOpen=false}}))}getPageTreePanelWidth(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.storageService.getValueFromLocalStorage(s.PAGE_TREE_PANEL_WIDTH_COOKIE_NAME,true);if(!!e){this.width=e+"px"}}))}getPageTreePanelStatus(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.storageService.getValueFromLocalStorage(this.PAGE_TREE_PANEL_OPEN_COOKIE_NAME,true);this.isPageTreePanelOpen=e}))}};ii=__decorate([n.Component({selector:"se-storefront-page",template:`<div class="se-toolbar-group"><se-toolbar cssClass="se-toolbar--shell" imageRoot="imageRoot" toolbarName="smartEditHeaderToolbar"></se-toolbar><se-toolbar cssClass="se-toolbar--experience" imageRoot="imageRoot" toolbarName="smartEditExperienceToolbar"></se-toolbar><se-toolbar [ngClass]="{'se-toolbar--perspective-hidden': !isReady}" cssClass="se-toolbar--perspective" imageRoot="imageRoot" toolbarName="smartEditPerspectiveToolbar"></se-toolbar></div><div id="js_iFrameWrapper" class="iframeWrapper"><div class="wrap"><div *ngIf="showPageTreeList()" id="page-tree-container" [ngStyle]="{'width': width}" class="page-tree__list"><se-page-tree-container></se-page-tree-container></div><div *ngIf="showPageTreeList()" class="splitter-tree-panel" resizer="#page-tree-container"></div><div class="iframe-panel"><iframe id="ySmartEditFrame" src=""></iframe><div id="ySmartEditFrameDragArea"></div></div></div></div>`,styles:[`.wrap{display:flex;justify-content:flex-start;flex-wrap:nowrap;height:100%}.page-tree__list{height:100%;padding:16px 0 16px 8px;min-width:20%;max-width:40%;flex:0 0 auto}.iframe-panel{width:100%;height:100%;flex:1 1 auto}.splitter-tree-panel{flex:0 0 auto;width:8px;cursor:col-resize}.se-toolbar--perspective-hidden{visibility:hidden}`]}),__param(3,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[s.BrowserService,K,s.IExperienceService,Function,s.CrossFrameEventService,s.IStorageService,s.IPerspectiveService,s.SmarteditBootstrapGateway])],ii);window.__smartedit__.addDecoratorPayload("Component","PageTreeContainerComponent",{selector:"se-page-tree-container",template:`<div *ngIf="component" class="page-tree-container"><ng-container *ngComponentOutlet="component"></ng-container></div>`,styles:[`.page-tree-container{height:100%}`]});let oi=class PageTreeContainerComponent{constructor(e){this.pageTreeService=e}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.pageTreeService.getTreeComponent();this.component=e.component}))}};oi=__decorate([n.Component({selector:"se-page-tree-container",template:`<div *ngIf="component" class="page-tree-container"><ng-container *ngComponentOutlet="component"></ng-container></div>`,styles:[`.page-tree-container{height:100%}`]}),__metadata("design:paramtypes",[s.IPageTreeService])],oi);const ni="MULTI_PRODUCT_CATALOGS_UPDATED";window.__smartedit__.addDecoratorPayload("Component","MultiProductCatalogVersionConfigurationComponent",{selector:"se-multi-product-catalog-version-configuration",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-multi-product-catalog-version-configuration]":"true"},template:`<div class="form-group se-multi-product-catalog-version-selector__label">{{'se.product.catalogs.multiple.list.header' | translate}}</div><div class="se-multi-product-catalog-version-selector__catalog form-group" *ngFor="let productCatalog of productCatalogs"><label class="se-control-label se-multi-product-catalog-version-selector__catalog-name" id="{{ productCatalog.catalogId }}-label">{{ productCatalog.name | seL10n | async }}</label><div class="se-multi-product-catalog-version-selector__catalog-version"><se-select [id]="productCatalog.catalogId" [(model)]="productCatalog.selectedItem" [onChange]="updateModel()" [fetchStrategy]="productCatalog.fetchStrategy"></se-select></div></div>`});let si=class MultiProductCatalogVersionConfigurationComponent{constructor(e,t){this.modalManager=e;this.systemEventService=t;this.doneButtonId="done"}ngOnInit(){this.modalManager.getModalData().pipe(d.take(1)).subscribe((e=>{this.selectedCatalogVersions=e.selectedCatalogVersions;this.productCatalogs=e.productCatalogs.map((e=>{const t=e.versions.map((e=>Object.assign(Object.assign({},e),{id:e.uuid,label:e.version})));return Object.assign(Object.assign({},e),{versions:t,fetchStrategy:{fetchAll:()=>Promise.resolve(t)},selectedItem:e.versions.find((e=>this.selectedCatalogVersions.includes(e.uuid))).uuid})}))}));this.modalManager.setDismissCallback((()=>this.onCancel()));this.modalManager.addButtons([{id:this.doneButtonId,label:"se.confirmation.modal.done",style:s.ModalButtonStyle.Primary,action:s.ModalButtonAction.None,disabled:true,callback:()=>l.from(this.onSave())},{id:"cancel",label:"se.confirmation.modal.cancel",style:s.ModalButtonStyle.Default,action:s.ModalButtonAction.Dismiss,callback:()=>l.from(this.onCancel())}])}updateModel(){return()=>{const e=this.productCatalogs.map((e=>e.selectedItem));this.updateSelection(e)}}updateSelection(e){if(!r.isEqual(e,this.selectedCatalogVersions)){this.updatedCatalogVersions=e;this.modalManager.enableButton(this.doneButtonId)}else{this.modalManager.disableButton(this.doneButtonId)}}onCancel(){this.modalManager.close(null);return Promise.resolve()}onSave(){this.systemEventService.publishAsync(ni,this.updatedCatalogVersions);this.modalManager.close(null);return Promise.resolve()}};si=__decorate([n.Component({selector:"se-multi-product-catalog-version-configuration",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-multi-product-catalog-version-configuration]":"true"},template:`<div class="form-group se-multi-product-catalog-version-selector__label">{{'se.product.catalogs.multiple.list.header' | translate}}</div><div class="se-multi-product-catalog-version-selector__catalog form-group" *ngFor="let productCatalog of productCatalogs"><label class="se-control-label se-multi-product-catalog-version-selector__catalog-name" id="{{ productCatalog.catalogId }}-label">{{ productCatalog.name | seL10n | async }}</label><div class="se-multi-product-catalog-version-selector__catalog-version"><se-select [id]="productCatalog.catalogId" [(model)]="productCatalog.selectedItem" [onChange]="updateModel()" [fetchStrategy]="productCatalog.fetchStrategy"></se-select></div></div>`}),__metadata("design:paramtypes",[s.ModalManagerService,s.SystemEventService])],si);window.__smartedit__.addDecoratorPayload("Component","MultiProductCatalogVersionSelectorComponent",{selector:"se-multi-product-catalog-version-selector",providers:[s.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-multi-product-catalog-version-selector]":"true"},template:`<se-tooltip [placement]="'bottom'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true" class="se-products-catalog-select-multiple__tooltip"><div id="multi-product-catalog-versions-selector" se-tooltip-trigger (click)="onClickSelector()" class="se-products-catalog-select-multiple"><input type="text" [value]="multiProductCatalogVersionsSelectedOptions$ | async" class="fd-input se-products-catalog-select-multiple__catalogs se-nowrap-ellipsis" [name]="'productCatalogVersions'" readonly="readonly"/> <span class="hyicon hyicon-optionssm se-products-catalog-select-multiple__icon"></span></div><div class="se-product-catalogs-tooltip" se-tooltip-body><div class="se-product-catalogs-tooltip__h">{{ ('se.product.catalogs.selector.headline.tooltip' || '') | translate }}</div><div class="se-product-catalog-info" *ngFor="let productCatalog of productCatalogs">{{ getCatalogNameCatalogVersionLabel(productCatalog.catalogId) | async }}</div></div></se-tooltip>`});let ai=class MultiProductCatalogVersionSelectorComponent{constructor(e,t,i){this.l10nPipe=e;this.modalService=t;this.systemEventService=i;this.selectedProductCatalogVersionsChange=new n.EventEmitter;this.multiProductCatalogVersionsSelectedOptions$=new l.BehaviorSubject("")}ngOnInit(){this.$unRegEventForMultiProducts=this.systemEventService.subscribe(ni,((e,t)=>this.updateProductCatalogVersionsModel(e,t)))}ngOnDestroy(){if(this.$unRegEventForMultiProducts){this.$unRegEventForMultiProducts()}}ngOnChanges(){this.setMultiVersionSelectorTexts(this.productCatalogs)}onClickSelector(){this.modalService.open({component:si,data:{productCatalogs:this.productCatalogs,selectedCatalogVersions:this.selectedProductCatalogVersions},templateConfig:{title:"se.modal.product.catalog.configuration"},config:{dialogPanelClass:"modal-md modal-stretched"}})}getCatalogNameCatalogVersionLabel(e){const t=this.catalogNameCatalogVersionLabelMap.get(e);return this.l10nPipe.transform(t.name).pipe(d.map((e=>`${e} (${t.version})`)))}setMultiVersionSelectorTexts(e){this.catalogNameCatalogVersionLabelMap=this.buildCatalogNameCatalogVersionLabelMap(e,this.selectedProductCatalogVersions);this.setMultiProductCatalogVersionsSelectedOptions(e)}buildCatalogNameCatalogVersionLabelMap(e,t){const i=new Map;e.forEach((e=>{const o=e.versions.find((e=>t&&t.includes(e.uuid)));if(o){i.set(e.catalogId,{name:e.name,version:o.version})}}));return i}setMultiProductCatalogVersionsSelectedOptions(e){if(e){const e=Array.from(this.catalogNameCatalogVersionLabelMap).map((e=>this.getCatalogNameCatalogVersionLabel(e[0])));l.combineLatest(e).pipe(d.take(1),d.map((e=>e.join(", ")))).subscribe((e=>this.multiProductCatalogVersionsSelectedOptions$.next(e)))}else{this.multiProductCatalogVersionsSelectedOptions$.next("")}}updateProductCatalogVersionsModel(e,t){this.selectedProductCatalogVersionsChange.emit(t)}};__decorate([n.Input(),__metadata("design:type",Array)],ai.prototype,"productCatalogs",void 0);__decorate([n.Input(),__metadata("design:type",Array)],ai.prototype,"selectedProductCatalogVersions",void 0);__decorate([n.Output(),__metadata("design:type",Object)],ai.prototype,"selectedProductCatalogVersionsChange",void 0);ai=__decorate([n.Component({selector:"se-multi-product-catalog-version-selector",providers:[s.L10nPipe],changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-multi-product-catalog-version-selector]":"true"},template:`<se-tooltip [placement]="'bottom'" [triggers]="['mouseenter', 'mouseleave']" [isChevronVisible]="true" class="se-products-catalog-select-multiple__tooltip"><div id="multi-product-catalog-versions-selector" se-tooltip-trigger (click)="onClickSelector()" class="se-products-catalog-select-multiple"><input type="text" [value]="multiProductCatalogVersionsSelectedOptions$ | async" class="fd-input se-products-catalog-select-multiple__catalogs se-nowrap-ellipsis" [name]="'productCatalogVersions'" readonly="readonly"/> <span class="hyicon hyicon-optionssm se-products-catalog-select-multiple__icon"></span></div><div class="se-product-catalogs-tooltip" se-tooltip-body><div class="se-product-catalogs-tooltip__h">{{ ('se.product.catalogs.selector.headline.tooltip' || '') | translate }}</div><div class="se-product-catalog-info" *ngFor="let productCatalog of productCatalogs">{{ getCatalogNameCatalogVersionLabel(productCatalog.catalogId) | async }}</div></div></se-tooltip>`}),__metadata("design:paramtypes",[s.L10nPipe,s.IModalService,s.SystemEventService])],ai);window.__smartedit__.addDecoratorPayload("Component","ProductCatalogVersionsSelectorComponent",{selector:"se-product-catalog-versions-selector",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-product-catalog-versions-selector]":"true"},template:`<ng-container *ngIf="isReady"><se-select *ngIf="isSingleVersionSelector" [id]="geData.qualifier" [(model)]="geData.model.productCatalogVersions[0]" [(reset)]="reset" [fetchStrategy]="fetchStrategy"></se-select><se-multi-product-catalog-version-selector *ngIf="isMultiVersionSelector" [productCatalogs]="productCatalogs" [(selectedProductCatalogVersions)]="geData.model[geData.qualifier]"></se-multi-product-catalog-version-selector></ng-container>`});let ri=class ProductCatalogVersionsSelectorComponent{constructor(e,t,i,o){this.geData=e;this.catalogService=t;this.systemEventService=i;this.cdr=o}ngOnInit(){return __awaiter(this,void 0,void 0,(function*(){this.contentCatalogVersionId=r.cloneDeep(this.geData.model.previewCatalog);if(this.contentCatalogVersionId){this.isReady=false;this.isSingleVersionSelector=false;this.isMultiVersionSelector=false;const e=(this.geData.id||"")+s.LINKED_DROPDOWN;this.$unRegSiteChangeEvent=this.systemEventService.subscribe(e,((e,t)=>this.resetSelector(e,t)));yield this.setContent()}return Promise.resolve()}))}ngOnDestroy(){if(this.$unRegSiteChangeEvent){this.$unRegSiteChangeEvent()}}resetSelector(e,t){return __awaiter(this,void 0,void 0,(function*(){if(t.qualifier==="previewCatalog"&&t.optionObject&&this.contentCatalogVersionId!==t.optionObject.id){this.contentCatalogVersionId=t.optionObject.id;const e=this.getSiteUIDFromContentCatalogVersionId(this.contentCatalogVersionId);const i=yield this.catalogService.getProductCatalogsForSite(e);const o=yield Promise.resolve(this.catalogService.returnActiveCatalogVersionUIDs(i));this.geData.model[this.geData.qualifier]=o;if(this.isSingleVersionSelector){this.reset()}this.setContent()}}))}setContent(){return __awaiter(this,void 0,void 0,(function*(){const setContent=()=>__awaiter(this,void 0,void 0,(function*(){this.productCatalogs=yield this.catalogService.getProductCatalogsForSite(this.getSiteUIDFromContentCatalogVersionId(this.contentCatalogVersionId));if(this.productCatalogs.length===0){return}if(this.productCatalogs.length===1){this.fetchStrategy={fetchAll:()=>{const e=this.parseSingleCatalogVersion(this.productCatalogs[0].versions);return Promise.resolve(e)}};this.isSingleVersionSelector=true;this.isMultiVersionSelector=false;this.isReady=true;return}this.isSingleVersionSelector=false;this.isMultiVersionSelector=true;this.isReady=true}));yield setContent();if(!this.cdr.destroyed){this.cdr.detectChanges()}}))}getSiteUIDFromContentCatalogVersionId(e){return e.split("|")[0]}parseSingleCatalogVersion(e){return e.map((e=>({id:e.uuid,label:e.version})))}};ri=__decorate([n.Component({selector:"se-product-catalog-versions-selector",changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"[class.se-product-catalog-versions-selector]":"true"},template:`<ng-container *ngIf="isReady"><se-select *ngIf="isSingleVersionSelector" [id]="geData.qualifier" [(model)]="geData.model.productCatalogVersions[0]" [(reset)]="reset" [fetchStrategy]="fetchStrategy"></se-select><se-multi-product-catalog-version-selector *ngIf="isMultiVersionSelector" [productCatalogs]="productCatalogs" [(selectedProductCatalogVersions)]="geData.model[geData.qualifier]"></se-multi-product-catalog-version-selector></ng-container>`}),__param(0,n.Inject(s.GENERIC_EDITOR_WIDGET_DATA)),__metadata("design:paramtypes",[Object,s.ICatalogService,s.SystemEventService,n.ChangeDetectorRef])],ri);let li=class ProductCatalogVersionModule{};li=__decorate([n.NgModule({imports:[p.CommonModule,h.FormsModule,b.FormModule,s.L10nPipeModule,s.TranslationModule.forChild(),s.SelectModule,s.TooltipModule],declarations:[ri,si,ai],entryComponents:[ri,si,ai],providers:[s.moduleUtils.initialize((e=>{e.addFieldMapping("ProductCatalogVersionsSelector",null,null,{component:ri})}),[s.EditorFieldMappingService])]})],li);window.__smartedit__.addDecoratorPayload("Component","SitesLinkComponent",{selector:"sites-link",template:`<div (click)="goToSites()" class="se-sites-link {{cssClass}}"><a class="se-sites-link__text">{{'se.toolbar.sites' | translate}}</a></div>`});let ci=class SitesLinkComponent{constructor(e,t,i){this.routingService=e;this.iframeManagerService=t;this.userTrackingService=i;this.iconCssClass="sap-icon--navigation-right-arrow"}goToSites(){this.userTrackingService.trackingUserAction(s.USER_TRACKING_FUNCTIONALITY.NAVIGATION,"Sites");this.iframeManagerService.setCurrentLocation(null);this.routingService.go("/")}};__decorate([n.Input(),__metadata("design:type",String)],ci.prototype,"cssClass",void 0);__decorate([n.Input(),__metadata("design:type",Object)],ci.prototype,"iconCssClass",void 0);__decorate([n.Input(),__metadata("design:type",Object)],ci.prototype,"shortcutLink",void 0);ci=__decorate([n.Component({selector:"sites-link",template:`<div (click)="goToSites()" class="se-sites-link {{cssClass}}"><a class="se-sites-link__text">{{'se.toolbar.sites' | translate}}</a></div>`}),__metadata("design:paramtypes",[s.SmarteditRoutingService,K,s.IUserTrackingService])],ci);let di=class ResizerDirective{constructor(e,t){this.storageService=e;this.yjQuery=t;this.instanceId="rsz_"+(new Date).getTime()}onMouseDown(e){e.preventDefault();const t=this.yjQuery(this.resizer);const i=t.css("transition");const o={x:e.clientX,width:t.width()};t.css("transition","none");const n=`mousemove.${this.instanceId}`;const a=`mouseup.${this.instanceId}`;const r=`selectstart.${this.instanceId}`;this.yjQuery(document).on(n,(e=>{const i=e;const n=o.width+i.clientX-o.x;t.width(n)}));this.yjQuery(document).on(a,(e=>{e.stopPropagation();e.preventDefault();this.yjQuery(document).off(n);this.yjQuery(document).off(a);this.yjQuery(document).off(r);t.css("transition",i);this.yjQuery("iframe").css("pointer-events","auto");this.storageService.setValueInLocalStorage(s.PAGE_TREE_PANEL_WIDTH_COOKIE_NAME,t.outerWidth(),true)}));this.yjQuery(document).on(r,(e=>{e.stopPropagation();e.preventDefault()}));this.yjQuery("iframe").css("pointer-events","none")}};__decorate([n.Input(),__metadata("design:type",String)],di.prototype,"resizer",void 0);__decorate([n.HostListener("mousedown",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[MouseEvent]),__metadata("design:returntype",void 0)],di.prototype,"onMouseDown",null);di=__decorate([n.Directive({selector:"[resizer]"}),__param(1,n.Inject(s.YJQUERY_TOKEN)),__metadata("design:paramtypes",[s.IStorageService,Function])],di);window.__smartedit__.addDecoratorPayload("Component","PerspectiveSelectorComponent",{selector:"se-perspective-selector",template:`<fd-popover [(isOpen)]="isOpen" [closeOnOutsideClick]="false" [triggers]="['click']" *ngIf="hasActivePerspective()" class="se-perspective-selector" [placement]="'bottom-end'" [disabled]="isDisabled" [options]="popperOptions"><fd-popover-control><div class="se-perspective-selector__trigger"><se-tooltip [isChevronVisible]="true" [triggers]="['mouseenter', 'mouseleave']" *ngIf="isTooltipVisible()"><span se-tooltip-trigger id="perspectiveTooltip" class="sap-icon--hint se-perspective-selector__hotkey-tooltip--icon"></span><div se-tooltip-body>{{ activePerspective.descriptionI18nKey | translate }}</div></se-tooltip><button class="se-perspective-selector__btn" [disabled]="isDisabled">{{getActivePerspectiveName() | translate}} <span class="se-perspective-selector__btn-arrow sap-icon--navigation-down-arrow" title="{{ getNavigationArrowIconIsCollapse() | translate }}"></span></button></div></fd-popover-control><fd-popover-body><ul fd-list class="se-perspective__list" [ngClass]="{'se-perspective__list--tooltip': isTooltipVisible()}" role="menu"><li fd-list-item *ngFor="let choice of getDisplayedPerspectives()" class="se-perspective__list-item fd-has-padding-none"><a fd-list-link class="fd-menu__link se-perspective__list-item-text" (click)="selectPerspective($event, choice.key);">{{choice.nameI18nKey | translate}}</a></li></ul></fd-popover-body></fd-popover>`});let pi=class PerspectiveSelectorComponent{constructor(e,t,i,o,n,s,a){this.logService=e;this.yjQuery=t;this.perspectiveService=i;this.iframeClickDetectionService=o;this.systemEventService=n;this.crossFrameEventService=s;this.userTrackingService=a;this.isOpen=false;this.popperOptions={placement:"bottom-start",modifiers:{preventOverflow:{enabled:true,escapeWithReference:true,boundariesElement:"viewport"},applyStyle:{gpuAcceleration:false}}};this.isDisabled=false;this.perspectives=[];this.displayedPerspectives=[];this.activePerspective=null}onDocumentClick(e){this.onClickHandler(e)}ngOnInit(){this.activePerspective=null;this.iframeClickDetectionService.registerCallback("perspectiveSelectorClose",(()=>this.closeDropdown()));this.unRegOverlayDisabledFn=this.systemEventService.subscribe("OVERLAY_DISABLED",(()=>this.closeDropdown()));this.unRegPerspectiveAddedFn=this.systemEventService.subscribe(s.EVENT_PERSPECTIVE_ADDED,(()=>this.onPerspectiveAdded()));this.unRegPerspectiveChgFn=this.crossFrameEventService.subscribe(s.EVENT_PERSPECTIVE_CHANGED,(()=>this.refreshPerspectives()));this.unRegPerspectiveRefreshFn=this.crossFrameEventService.subscribe(s.EVENT_PERSPECTIVE_REFRESHED,(()=>this.refreshPerspectives()));this.unRegUserHasChanged=this.crossFrameEventService.subscribe(s.EVENTS.USER_HAS_CHANGED,(()=>this.onPerspectiveAdded()));this.unRegStrictPreviewModeToggleFn=this.crossFrameEventService.subscribe(s.EVENT_STRICT_PREVIEW_MODE_REQUESTED,((e,t)=>this.togglePerspectiveSelector(t)));this.onPerspectiveAdded()}ngOnDestroy(){this.unRegOverlayDisabledFn();this.unRegPerspectiveAddedFn();this.unRegPerspectiveChgFn();this.unRegPerspectiveRefreshFn();this.unRegUserHasChanged();this.unRegStrictPreviewModeToggleFn()}selectPerspective(e,t){e.preventDefault();this.userTrackingService.trackingUserAction(s.USER_TRACKING_FUNCTIONALITY.SELECT_PERSPECTIVE,t);try{this.perspectiveService.switchTo(t);this.closeDropdown()}catch(e){this.logService.error("selectPerspective() - Cannot select perspective.",e)}}getDisplayedPerspectives(){return this.displayedPerspectives}getActivePerspectiveName(){return this.activePerspective?this.activePerspective.nameI18nKey:""}hasActivePerspective(){return this.activePerspective!==null}isTooltipVisible(){return!!this.activePerspective&&!!this.activePerspective.descriptionI18nKey&&this.checkTooltipVisibilityCondition()}getNavigationArrowIconIsCollapse(){return this.isOpen?"se.arrowicon.collapse.title":"se.arrowicon.expand.title"}checkTooltipVisibilityCondition(){if(this.activePerspective.key!==s.NONE_PERSPECTIVE||this.activePerspective.key===s.NONE_PERSPECTIVE&&this.isDisabled){return true}return false}filterPerspectives(e){return e.filter((e=>{const t=this.activePerspective&&e.key===this.activePerspective.key;const i=e.key===s.ALL_PERSPECTIVE;return!t&&!i}))}closeDropdown(){this.isOpen=false}onPerspectiveAdded(){this.perspectiveService.getPerspectives().then((e=>{this.perspectives=e;this.displayedPerspectives=this.filterPerspectives(this.perspectives)}))}refreshPerspectives(){this.perspectiveService.getPerspectives().then((e=>{this.perspectives=e;this._refreshActivePerspective();this.displayedPerspectives=this.filterPerspectives(this.perspectives)}))}_refreshActivePerspective(){this.activePerspective=this.perspectiveService.getActivePerspective()}onClickHandler(e){if(this.yjQuery(e.target).parents(".se-perspective-selector").length<=0&&this.isOpen){this.closeDropdown()}}togglePerspectiveSelector(e){this.isDisabled=e}};__decorate([n.Input(),__metadata("design:type",Object)],pi.prototype,"isOpen",void 0);__decorate([n.HostListener("document:click",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Event]),__metadata("design:returntype",void 0)],pi.prototype,"onDocumentClick",null);pi=__decorate([n.Component({selector:"se-perspective-selector",template:`<fd-popover [(isOpen)]="isOpen" [closeOnOutsideClick]="false" [triggers]="['click']" *ngIf="hasActivePerspective()" class="se-perspective-selector" [placement]="'bottom-end'" [disabled]="isDisabled" [options]="popperOptions"><fd-popover-control><div class="se-perspective-selector__trigger"><se-tooltip [isChevronVisible]="true" [triggers]="['mouseenter', 'mouseleave']" *ngIf="isTooltipVisible()"><span se-tooltip-trigger id="perspectiveTooltip" class="sap-icon--hint se-perspective-selector__hotkey-tooltip--icon"></span><div se-tooltip-body>{{ activePerspective.descriptionI18nKey | translate }}</div></se-tooltip><button class="se-perspective-selector__btn" [disabled]="isDisabled">{{getActivePerspectiveName() | translate}} <span class="se-perspective-selector__btn-arrow sap-icon--navigation-down-arrow" title="{{ getNavigationArrowIconIsCollapse() | translate }}"></span></button></div></fd-popover-control><fd-popover-body><ul fd-list class="se-perspective__list" [ngClass]="{'se-perspective__list--tooltip': isTooltipVisible()}" role="menu"><li fd-list-item *ngFor="let choice of getDisplayedPerspectives()" class="se-perspective__list-item fd-has-padding-none"><a fd-list-link class="fd-menu__link se-perspective__list-item-text" (click)="selectPerspective($event, choice.key);">{{choice.nameI18nKey | translate}}</a></li></ul></fd-popover-body></fd-popover>`}),__param(1,n.Inject(s.YJQUERY_TOKEN)),__param(5,n.Inject(s.EVENT_SERVICE)),__metadata("design:paramtypes",[s.LogService,Function,s.IPerspectiveService,s.IIframeClickDetectionService,s.SystemEventService,s.CrossFrameEventService,s.IUserTrackingService])],pi);window.__smartedit__.addDecoratorPayload("Component","CatalogHierarchyModalComponent",{selector:"se-catalog-hierarchy-modal",template:`<div class="se-catalog-hierarchy-header"><span>{{ 'se.catalog.hierarchy.modal.tree.header' | translate }}</span></div><div *ngIf="this.catalogs$ | async as catalogs" class="se-catalog-hierarchy-body"><se-catalog-hierarchy-node *ngFor="let catalog of catalogs; let i = index" [catalog]="catalog" [index]="i" [isLast]="i === catalogs.length - 1" [siteId]="siteId" (siteSelect)="onSiteSelected()"></se-catalog-hierarchy-node></div>`});let mi=class CatalogHierarchyModalComponent{constructor(e){this.modalService=e}ngOnInit(){this.catalogs$=this.modalService.getModalData().pipe(d.take(1)).toPromise().then((({catalog:e})=>[...e.parents,e]))}onSiteSelected(){this.modalService.close()}};mi=__decorate([n.Component({selector:"se-catalog-hierarchy-modal",template:`<div class="se-catalog-hierarchy-header"><span>{{ 'se.catalog.hierarchy.modal.tree.header' | translate }}</span></div><div *ngIf="this.catalogs$ | async as catalogs" class="se-catalog-hierarchy-body"><se-catalog-hierarchy-node *ngFor="let catalog of catalogs; let i = index" [catalog]="catalog" [index]="i" [isLast]="i === catalogs.length - 1" [siteId]="siteId" (siteSelect)="onSiteSelected()"></se-catalog-hierarchy-node></div>`}),__metadata("design:paramtypes",[s.ModalManagerService])],mi);window.__smartedit__.addDecoratorPayload("Component","CatalogDetailsComponent",{selector:"se-catalog-details",template:`<div class="se-catalog-details" [attr.data-catalog]="catalog.name | seL10n | async"><div class="se-catalog-header"><div class="se-catalog-header-flex"><div class="se-catalog-details__header">{{ catalog.name | seL10n | async }}</div><div *ngIf="catalog.parents?.length"><a fd-link href="javascript:void(0)" (click)="onOpenCatalogHierarchy()">{{ 'se.landingpage.catalog.hierarchy' | translate }}</a></div></div></div><div class="se-catalog-details__content"><se-catalog-version-details *ngFor="let catalogVersion of sortedCatalogVersions" [catalog]="catalog" [catalogVersion]="catalogVersion" [activeCatalogVersion]="activeCatalogVersion" [siteId]="siteId"></se-catalog-version-details></div></div>`});let gi=class CatalogDetailsComponent{constructor(e){this.modalService=e;this.catalogDividerImage="static-resources/images/icon_catalog_arrow.png"}ngOnInit(){this.activeCatalogVersion=this.catalog.versions.find((e=>e.active));this.sortedCatalogVersions=this.getSortedCatalogVersions();this.collapsibleConfiguration={expandedByDefault:this.isCatalogForCurrentSite}}onOpenCatalogHierarchy(){this.modalService.open({component:mi,data:{catalog:this.catalog},templateConfig:{title:"se.catalog.hierarchy.modal.title",isDismissButtonVisible:true}})}getSortedCatalogVersions(){return[this.activeCatalogVersion,...this.catalog.versions.filter((e=>!e.active))]}};__decorate([n.Input(),__metadata("design:type",Object)],gi.prototype,"catalog",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],gi.prototype,"isCatalogForCurrentSite",void 0);__decorate([n.Input(),__metadata("design:type",String)],gi.prototype,"siteId",void 0);gi=__decorate([n.Component({selector:"se-catalog-details",template:`<div class="se-catalog-details" [attr.data-catalog]="catalog.name | seL10n | async"><div class="se-catalog-header"><div class="se-catalog-header-flex"><div class="se-catalog-details__header">{{ catalog.name | seL10n | async }}</div><div *ngIf="catalog.parents?.length"><a fd-link href="javascript:void(0)" (click)="onOpenCatalogHierarchy()">{{ 'se.landingpage.catalog.hierarchy' | translate }}</a></div></div></div><div class="se-catalog-details__content"><se-catalog-version-details *ngFor="let catalogVersion of sortedCatalogVersions" [catalog]="catalog" [catalogVersion]="catalogVersion" [activeCatalogVersion]="activeCatalogVersion" [siteId]="siteId"></se-catalog-version-details></div></div>`}),__metadata("design:paramtypes",[s.ModalService])],gi);let ui=class CatalogNavigateToSite{constructor(e){this.systemEvent=e}navigate(e){this.systemEvent.publishAsync(ei+s.LINKED_DROPDOWN,{qualifier:"site",optionObject:{contentCatalogs:[],uid:e,id:e,label:{},name:{},previewUrl:""}})}};ui=__decorate([n.Injectable(),__metadata("design:paramtypes",[s.SystemEventService])],ui);window.__smartedit__.addDecoratorPayload("Component","CatalogHierarchyNodeMenuItemComponent",{changeDetection:n.ChangeDetectionStrategy.OnPush,selector:"se-catalog-hierarchy-node-menu-item",template:`\n        <a fd-list-link class="se-dropdown-item" (click)="onSiteSelect()">\n            {{ name | seL10n | async }}\n        </a>\n    `});let hi=class CatalogHierarchyNodeMenuItemComponent{constructor(e,t){this.activateSite=e;const{name:i,uid:o}=t.dropdownItem;this.name=i;this.uid=o}onSiteSelect(){this.activateSite.navigate(this.uid)}};hi=__decorate([n.Component({changeDetection:n.ChangeDetectionStrategy.OnPush,selector:"se-catalog-hierarchy-node-menu-item",template:`\n        <a fd-list-link class="se-dropdown-item" (click)="onSiteSelect()">\n            {{ name | seL10n | async }}\n        </a>\n    `}),__param(1,n.Inject(s.DROPDOWN_MENU_ITEM_DATA)),__metadata("design:paramtypes",[ui,Object])],hi);window.__smartedit__.addDecoratorPayload("Component","CatalogHierarchyNodeComponent",{changeDetection:n.ChangeDetectionStrategy.OnPush,selector:"se-catalog-hierarchy-node",template:`<div class="se-cth-node-name" [style.padding-left.px]="15 * index" [style.padding-right.px]="15 * index" [class.se-cth-node-name__last]="isLast"><fd-icon glyph="navigation-down-arrow"></fd-icon>{{ (isLast ? catalog.name : catalog.catalogName) | seL10n | async }}&nbsp; <span *ngIf="isLast">({{ 'se.catalog.hierarchy.modal.tree.this.catalog' | translate}})</span></div><div class="se-cth-node-sites"><ng-container><ng-container *ngIf="hasOneSite; else hasManySites"><a class="se-cth-node-anchor" href="" (click)="onNavigateToSite(catalog.sites[0].uid)">{{ catalog.sites[0].name | seL10n | async }}<fd-icon glyph="navigation-right-arrow"></fd-icon></a></ng-container><ng-template #hasManySites><se-dropdown-menu [dropdownItems]="dropdownItems" useProjectedAnchor="1" (selectedItemChange)="siteSelect.emit()"><span class="se-cth-node-anchor">{{ this.catalog.sites.length }} Sites<fd-icon glyph="navigation-down-arrow"></fd-icon></span></se-dropdown-menu></ng-template></ng-container></div>`});let _i=class CatalogHierarchyNodeComponent{constructor(e){this.navigateToSite=e;this.siteSelect=new n.EventEmitter}ngOnChanges(){this.dropdownItems=this.getDropdownItems()}onNavigateToSite(e){this.navigateToSite.navigate(e);this.siteSelect.emit()}get hasOneSite(){return this.catalog.sites.length===1}getDropdownItems(){return this.catalog.sites.map((e=>Object.assign(Object.assign({},e),{component:hi})))}};__decorate([n.Input(),__metadata("design:type",Number)],_i.prototype,"index",void 0);__decorate([n.Input(),__metadata("design:type",Object)],_i.prototype,"catalog",void 0);__decorate([n.Input(),__metadata("design:type",String)],_i.prototype,"siteId",void 0);__decorate([n.Input(),__metadata("design:type",Boolean)],_i.prototype,"isLast",void 0);__decorate([n.Output(),__metadata("design:type",Object)],_i.prototype,"siteSelect",void 0);_i=__decorate([n.Component({changeDetection:n.ChangeDetectionStrategy.OnPush,selector:"se-catalog-hierarchy-node",template:`<div class="se-cth-node-name" [style.padding-left.px]="15 * index" [style.padding-right.px]="15 * index" [class.se-cth-node-name__last]="isLast"><fd-icon glyph="navigation-down-arrow"></fd-icon>{{ (isLast ? catalog.name : catalog.catalogName) | seL10n | async }}&nbsp; <span *ngIf="isLast">({{ 'se.catalog.hierarchy.modal.tree.this.catalog' | translate}})</span></div><div class="se-cth-node-sites"><ng-container><ng-container *ngIf="hasOneSite; else hasManySites"><a class="se-cth-node-anchor" href="" (click)="onNavigateToSite(catalog.sites[0].uid)">{{ catalog.sites[0].name | seL10n | async }}<fd-icon glyph="navigation-right-arrow"></fd-icon></a></ng-container><ng-template #hasManySites><se-dropdown-menu [dropdownItems]="dropdownItems" useProjectedAnchor="1" (selectedItemChange)="siteSelect.emit()"><span class="se-cth-node-anchor">{{ this.catalog.sites.length }} Sites<fd-icon glyph="navigation-down-arrow"></fd-icon></span></se-dropdown-menu></ng-template></ng-container></div>`}),__metadata("design:paramtypes",[ui])],_i);window.__smartedit__.addDecoratorPayload("Component","CatalogVersionDetailsComponent",{selector:"se-catalog-version-details",template:`<div class="se-catalog-version-container" [attr.data-catalog-version]="catalogVersion.version"><div class="se-catalog-version-container__left"><se-catalog-versions-thumbnail-carousel [catalogVersion]="catalogVersion" [catalog]="catalog" [siteId]="siteId"></se-catalog-versions-thumbnail-carousel><div><div class="se-catalog-version-container__name">{{catalogVersion.version}}</div><div class="se-catalog-version-container__left__templates"><div class="se-catalog-version-container__left__template" *ngFor="let item of leftItems; let isLast = last"><se-catalog-version-item-renderer [item]="item" [siteId]="siteId" [catalog]="catalog" [catalogVersion]="catalogVersion" [activeCatalogVersion]="activeCatalogVersion"></se-catalog-version-item-renderer><div class="se-catalog-version-container__divider" *ngIf="!isLast"></div></div></div></div></div><div class="se-catalog-version-container__right"><div class="se-catalog-version-container__right__template" *ngFor="let item of rightItems"><se-catalog-version-item-renderer [item]="item" [siteId]="siteId" [catalog]="catalog" [catalogVersion]="catalogVersion" [activeCatalogVersion]="activeCatalogVersion"></se-catalog-version-item-renderer></div></div></div>`});let vi=class CatalogVersionDetailsComponent{constructor(e){this.catalogDetailsService=e}ngOnInit(){const{left:e,right:t}=this.catalogDetailsService.getItems();this.leftItems=e;this.rightItems=t}};__decorate([n.Input(),__metadata("design:type",Object)],vi.prototype,"catalog",void 0);__decorate([n.Input(),__metadata("design:type",Object)],vi.prototype,"catalogVersion",void 0);__decorate([n.Input(),__metadata("design:type",Object)],vi.prototype,"activeCatalogVersion",void 0);__decorate([n.Input(),__metadata("design:type",String)],vi.prototype,"siteId",void 0);vi=__decorate([n.Component({selector:"se-catalog-version-details",template:`<div class="se-catalog-version-container" [attr.data-catalog-version]="catalogVersion.version"><div class="se-catalog-version-container__left"><se-catalog-versions-thumbnail-carousel [catalogVersion]="catalogVersion" [catalog]="catalog" [siteId]="siteId"></se-catalog-versions-thumbnail-carousel><div><div class="se-catalog-version-container__name">{{catalogVersion.version}}</div><div class="se-catalog-version-container__left__templates"><div class="se-catalog-version-container__left__template" *ngFor="let item of leftItems; let isLast = last"><se-catalog-version-item-renderer [item]="item" [siteId]="siteId" [catalog]="catalog" [catalogVersion]="catalogVersion" [activeCatalogVersion]="activeCatalogVersion"></se-catalog-version-item-renderer><div class="se-catalog-version-container__divider" *ngIf="!isLast"></div></div></div></div></div><div class="se-catalog-version-container__right"><div class="se-catalog-version-container__right__template" *ngFor="let item of rightItems"><se-catalog-version-item-renderer [item]="item" [siteId]="siteId" [catalog]="catalog" [catalogVersion]="catalogVersion" [activeCatalogVersion]="activeCatalogVersion"></se-catalog-version-item-renderer></div></div></div>`}),__metadata("design:paramtypes",[s.ICatalogDetailsService])],vi);window.__smartedit__.addDecoratorPayload("Component","CatalogVersionItemRendererComponent",{selector:"se-catalog-version-item-renderer",template:`\n        <ng-container>\n            <div *ngIf="item.component">\n                <ng-container\n                    *ngComponentOutlet="item.component; injector: itemInjector"></ng-container>\n            </div>\n        </ng-container>\n    `});let fi=class CatalogVersionItemRendererComponent{constructor(e){this.injector=e}ngOnInit(){this.createInjector()}ngOnChanges(){this.createInjector()}createInjector(){if(!this.item.component){return}this.itemInjector=n.Injector.create({parent:this.injector,providers:[{provide:s.CATALOG_DETAILS_ITEM_DATA,useValue:{siteId:this.siteId,catalog:this.catalog,catalogVersion:this.catalogVersion,activeCatalogVersion:this.activeCatalogVersion}}]})}};__decorate([n.Input(),__metadata("design:type",Object)],fi.prototype,"item",void 0);__decorate([n.Input(),__metadata("design:type",Object)],fi.prototype,"catalog",void 0);__decorate([n.Input(),__metadata("design:type",Object)],fi.prototype,"catalogVersion",void 0);__decorate([n.Input(),__metadata("design:type",Object)],fi.prototype,"activeCatalogVersion",void 0);__decorate([n.Input(),__metadata("design:type",String)],fi.prototype,"siteId",void 0);fi=__decorate([n.Component({selector:"se-catalog-version-item-renderer",template:`\n        <ng-container>\n            <div *ngIf="item.component">\n                <ng-container\n                    *ngComponentOutlet="item.component; injector: itemInjector"></ng-container>\n            </div>\n        </ng-container>\n    `}),__metadata("design:paramtypes",[n.Injector])],fi);window.__smartedit__.addDecoratorPayload("Component","CatalogVersionsThumbnailCarouselComponent",{selector:"se-catalog-versions-thumbnail-carousel",template:`<div class="se-active-catalog-thumbnail"><div class="se-active-catalog-version-container__thumbnail" (click)="onClick()"><div class="se-active-catalog-version-container__thumbnail__default-img"><div class="se-active-catalog-version-container__thumbnail__img" [ngStyle]="{'background-image': 'url(' + catalogVersion.thumbnailUrl + ')'}"></div></div></div></div>`});let yi=class CatalogVersionsThumbnailCarouselComponent{constructor(e){this.experienceService=e}onClick(){this.experienceService.loadExperience({siteId:this.siteId,catalogId:this.catalog.catalogId,catalogVersion:this.catalogVersion.version})}};__decorate([n.Input(),__metadata("design:type",Object)],yi.prototype,"catalog",void 0);__decorate([n.Input(),__metadata("design:type",Object)],yi.prototype,"catalogVersion",void 0);__decorate([n.Input(),__metadata("design:type",String)],yi.prototype,"siteId",void 0);yi=__decorate([n.Component({selector:"se-catalog-versions-thumbnail-carousel",template:`<div class="se-active-catalog-thumbnail"><div class="se-active-catalog-version-container__thumbnail" (click)="onClick()"><div class="se-active-catalog-version-container__thumbnail__default-img"><div class="se-active-catalog-version-container__thumbnail__img" [ngStyle]="{'background-image': 'url(' + catalogVersion.thumbnailUrl + ')'}"></div></div></div></div>`}),__metadata("design:paramtypes",[s.IExperienceService])],yi);window.__smartedit__.addDecoratorPayload("Component","HomePageLinkComponent",{selector:"se-home-page-link",template:`<div class="home-link-container"><a href="javascript:void(0)" class="fd-link home-link-item__link se-catalog-version__link" (click)="onClick()">{{ 'se.landingpage.homepage' | translate }}</a></div>`});let Si=class HomePageLinkComponent{constructor(e,t,i){this.experienceService=e;this.userTrackingService=t;this.data=i}onClick(){const{siteId:e,catalog:{catalogId:t},catalogVersion:{version:i}}=this.data;this.experienceService.loadExperience({siteId:e,catalogId:t,catalogVersion:i});this.userTrackingService.trackingUserAction(s.USER_TRACKING_FUNCTIONALITY.NAVIGATION,i+" - HomePage")}};Si=__decorate([n.Component({selector:"se-home-page-link",template:`<div class="home-link-container"><a href="javascript:void(0)" class="fd-link home-link-item__link se-catalog-version__link" (click)="onClick()">{{ 'se.landingpage.homepage' | translate }}</a></div>`}),__param(2,n.Inject(s.CATALOG_DETAILS_ITEM_DATA)),__metadata("design:paramtypes",[s.IExperienceService,s.IUserTrackingService,Object])],Si);class CatalogDetailsService{constructor(){this._customItems={left:[{component:Si}],right:[]}}addItems(e,t){if(t===s.CATALOG_DETAILS_COLUMNS.RIGHT){this._customItems.right=this._customItems.right.concat(e)}else{this._customItems.left=this._customItems.left.splice(0);this._customItems.left.splice(this._customItems.left.length-1,0,...e)}}getItems(){return this._customItems}}let Ci=class CatalogDetailsModule{};Ci=__decorate([n.NgModule({imports:[p.CommonModule,s.CollapsibleContainerModule,s.L10nPipeModule,E.LinkModule,s.SharedComponentsModule,u.IconModule,g.TranslateModule.forChild(),w.ListModule],providers:[{provide:s.ICatalogDetailsService,useClass:CatalogDetailsService},ui],declarations:[Si,gi,vi,yi,fi,mi,_i,hi],entryComponents:[yi,vi,Si,gi,fi,mi,_i,hi],exports:[gi]})],Ci);const bi=[{path:"",shortcutComponent:ci,component:ti},{path:"sites/:siteId",component:ti},{path:"storefront",canActivate:[Re],priority:30,titleI18nKey:"se.route.storefront.title",component:ii},{path:s.NG_ROUTE_WILDCARD,component:bt}];const smarteditContainerFactory=e=>{let i=class Smarteditcontainer{};i=__decorate([n.NgModule({schemas:[n.CUSTOM_ELEMENTS_SCHEMA],imports:[v.BrowserModule,f.BrowserAnimationsModule,h.FormsModule,h.ReactiveFormsModule,a.HttpClientModule,s.FundamentalsModule,s.SeGenericEditorModule,s.SharedComponentsModule,s.ClientPagedListModule,s.FilterByFieldPipeModule,Xt,ue.forRoot(),t.ToolbarModule,Ci,s.SelectModule,yt,li,s.ConfirmDialogModule,y.GridListModule,s.HttpInterceptorModule.forRoot(s.UnauthorizedErrorInterceptor,s.ResourceNotFoundErrorInterceptor,s.RetryInterceptor,s.NonValidationErrorInterceptor,s.PreviewErrorInterceptor,s.PermissionErrorInterceptor),s.SeTranslationModule.forRoot(t.TranslationsFetchService),Le,...e.modules,s.SeRouteService.provideNgRoute(bi,{useHash:true,initialNavigation:"enabledNonBlocking",onSameUrlNavigation:"reload"})],declarations:[xt,bt,ci,Qe,ut,gt,ke,pi,ye,ti,ii,oi,di],entryComponents:[xt,ci,Qe,ut,ke,pi,ye,ti,ii,oi],exports:[di],providers:[{provide:n.ErrorHandler,useClass:s.SmarteditErrorHandler},Z,s.SSOAuthenticationHelper,s.moduleUtils.provideValues(e.constants),{provide:m.UrlHandlingStrategy,useClass:s.CustomHandlingStrategy},{provide:p.APP_BASE_HREF,useValue:""},K,{provide:s.IAuthenticationManagerService,useClass:s.AuthenticationManager},{provide:s.IAuthenticationService,useClass:s.AuthenticationService},{provide:s.IConfirmationModalService,useClass:Ve},{provide:s.ISharedDataService,useClass:t.SharedDataService},s.SeRouteService,{provide:s.ISessionService,useClass:t.SessionService},{provide:s.IStorageService,useClass:t.StorageService},{provide:s.IUrlService,useClass:se},{provide:s.IIframeClickDetectionService,useClass:we},{provide:s.ICatalogService,useClass:ne},{provide:s.IExperienceService,useClass:Q},{provide:s.IUserTrackingService,useClass:pt},s.SmarteditRoutingService,s.ContentCatalogRestService,s.ProductCatalogRestService,t.LoadConfigManagerService,s.ThemesService,t.ThemeSwitchService,s.moduleUtils.bootstrap(smarteditContainerBootstrap,[s.IAuthenticationService,s.GatewayProxy,s.IFeatureService,Ne,s.IToolbarServiceFactory,t.LoadConfigManagerService,s.GatewayFactory,s.SmarteditBootstrapGateway,s.YJQUERY_TOKEN,K,s.IWaitDialogService,t.ThemeSwitchService,s.PromiseUtils,t.BootstrapService,s.ISharedDataService,s.IModalService,s.IRenderService,Ie,s.SmarteditRoutingService,s.IUserTrackingService]),s.moduleUtils.initialize(smarteditContainerInitialize,[t.DelegateRestService,a.HttpClient,s.RestServiceFactory,oe,s.IPermissionService,s.AuthorizationService])],bootstrap:[xt]})],i);return i};function smarteditContainerBootstrap(e,t,i,o,n,a,r,l,d,p,m,g,u,h,_,v,f,y,S,b){t.initForService(e,["filterEntryPoints","isAuthEntryPoint","authenticate","logout","isReAuthInProgress","setReAuthInProgress","isAuthenticated"],s.diNameUtils.buildServiceName(s.AuthenticationService));r.initListener();S.init();S.routeChangeSuccess().subscribe((e=>{v.dismissAll()}));a.loadAsObject().then((e=>{_.set("defaultToolingLanguage",e.defaultToolingLanguage);_.set("maxUploadFileSize",e.maxUploadFileSize);if(!!e.typeAheadDebounce){_.set("typeAheadDebounce",e.typeAheadDebounce)}if(!!e.typeAheadMiniSearchTermLength){_.set("typeAheadMiniSearchTermLength",e.typeAheadMiniSearchTermLength)}}));i.addToolbarItem({toolbarId:"smartEditPerspectiveToolbar",key:s.PERSPECTIVE_SELECTOR_WIDGET_KEY,nameI18nKey:"se.perspective.selector.widget",type:"TEMPLATE",priority:1,section:"left",component:pi});const E=n.getToolbarService("smartEditHeaderToolbar");E.addItems([{key:"headerToolbar.logoTemplate",type:s.ToolbarItemType.TEMPLATE,component:tt,priority:1,section:s.ToolbarSection.left},{key:"headerToolbar.userAccountTemplate",type:s.ToolbarItemType.HYBRID_ACTION,iconClassName:"sap-icon--customer",component:Je,priority:1,actionButtonFormat:"compact",section:s.ToolbarSection.right,dropdownPosition:s.ToolbarDropDownPosition.right,nameI18nKey:"se.toolbar.useraccount.button.arialabel"},{key:"headerToolbar.languageSelectorTemplate",type:s.ToolbarItemType.HYBRID_ACTION,iconClassName:"sap-icon--world",component:s.HeaderLanguageDropdownComponent,priority:3,actionButtonFormat:"compact",section:s.ToolbarSection.right,dropdownPosition:s.ToolbarDropDownPosition.center,nameI18nKey:"se.languageselector.dropdown.button.arialabel"},{key:"headerToolbar.configurationTemplate",type:s.ToolbarItemType.ACTION,actionButtonFormat:"compact",iconClassName:"sap-icon--action-settings",callback:()=>{o.editConfiguration()},priority:4,section:s.ToolbarSection.right,permissions:["smartedit.configurationcenter.read"],nameI18nKey:"se.toolbar.configuration.button.arialabel"},{key:"headerToolbar.qualtricTemplate",type:s.ToolbarItemType.TEMPLATE,priority:2,section:s.ToolbarSection.right,component:ct}]);const w=n.getToolbarService("smartEditExperienceToolbar");w.addItems([{key:"se.cms.shortcut",type:s.ToolbarItemType.TEMPLATE,component:s.ShortcutLinkComponent,priority:1,section:s.ToolbarSection.left},{key:"experienceToolbar.deviceSupportTemplate",type:s.ToolbarItemType.TEMPLATE,component:Ke,priority:1,section:s.ToolbarSection.right},{type:s.ToolbarItemType.TEMPLATE,key:"experienceToolbar.experienceSelectorTemplate",component:et,priority:1,section:s.ToolbarSection.middle}]);function offSetStorefront(){d(s.SMARTEDIT_IFRAME_WRAPPER_ID).css("padding-top",d(".se-toolbar-group").height()+"px")}function getBootstrapNamespace(){if(window.__smartedit__.smartEditBootstrapped){window.__smartedit__.smartEditBootstrapped={}}return window.__smartedit__.smartEditBootstrapped}l.getInstance().subscribe("loading",((e,t)=>{const i=u.defer();p.setCurrentLocation(t.location);m.showWaitModal();const o=getBootstrapNamespace();delete o[t.location];return i.promise}));l.getInstance().subscribe("unloading",((e,t)=>{const i=u.defer();m.showWaitModal();return i.promise}));l.getInstance().subscribe("bootstrapSmartEdit",((e,t)=>{offSetStorefront();const i=u.defer();const o=getBootstrapNamespace();if(!o[t.location]){o[t.location]=true;a.loadAsObject().then((e=>{h.bootstrapSEApp(e);i.resolve()}))}else{i.resolve()}return i.promise}));l.getInstance().subscribe("smartEditReady",(function(){const e=u.defer();e.resolve();m.hideWaitModal();return e.promise}));b.initConfiguration()}function smarteditContainerInitialize(e,t,i,o,n,s){n.registerDefaultRule({names:[_e],verify:e=>{const t=e.map((e=>e.name));return s.hasGlobalPermissions(t)}});o.registerRulesAndPermissions()}if(true){n.enableProdMode()}t.smarteditContainerFactory=smarteditContainerFactory},54206:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=i(54526);var n=i(32709);var s=i(19662);var a=i(9501);var r=i(68403);var l=i(12549);var d=i(18681);function __decorate(e,t,i,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)if(a=e[r])s=(n<3?a(s):n>3?a(t,i,s):a(t,i))||s;return n>3&&s&&Object.defineProperty(t,i,s),s}function __awaiter(e,t,i,o){function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function fulfilled(e){try{step(o.next(e))}catch(e){n(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){n(e)}}function step(e){e.done?i(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))}const p="legacy-loader";window.__smartedit__.addDecoratorPayload("Component","SmarteditloaderComponent",{selector:l.SMARTEDITLOADER_COMPONENT_NAME,template:`<${p}></${p}>`});let m=class SmarteditloaderComponent{};m=__decorate([n.Component({selector:l.SMARTEDITLOADER_COMPONENT_NAME,template:`<${p}></${p}>`})],m);const SmarteditLoaderFactory=e=>{let t=class Smarteditloader{};t=__decorate([n.NgModule({schemas:[n.CUSTOM_ELEMENTS_SCHEMA],imports:[a.BrowserModule,s.FormsModule,s.ReactiveFormsModule,o.HttpClientModule,l.SmarteditCommonsModule,l.SharedComponentsModule,...e,d.AlertServiceModule,l.HttpInterceptorModule.forRoot(l.UnauthorizedErrorInterceptor,l.RetryInterceptor,l.ResourceNotFoundErrorInterceptor),l.SeTranslationModule.forRoot(d.TranslationsFetchService)],providers:[l.moduleUtils.provideValues({SSO_CLIENT_ID:l.DEFAULT_AUTHENTICATION_CLIENT_ID}),l.SSOAuthenticationHelper,d.ConfigurationExtractorService,l.ThemesService,d.ThemeSwitchService,{provide:n.ErrorHandler,useClass:l.SmarteditErrorHandler},d.DelegateRestService,l.RestServiceFactory,{provide:l.IAuthenticationService,useClass:l.AuthenticationService},{provide:l.ISessionService,useClass:d.SessionService},{provide:l.ISharedDataService,useClass:d.SharedDataService},{provide:l.IStorageService,useClass:d.StorageService},d.BootstrapService,d.LoadConfigManagerService,l.moduleUtils.bootstrap(((e,t,i,o)=>{if(e.isSSODialog()){e.completeDialog()}else{t.loadAsObject().then((e=>{i.bootstrapContainerModules(e).then((e=>{const t=document.querySelector(l.SMARTEDITLOADER_COMPONENT_NAME);t.parentNode.insertBefore(document.createElement(l.SMARTEDITCONTAINER_COMPONENT_NAME),t);r.platformBrowserDynamic().bootstrapModule(d.smarteditContainerFactory(e),{ngZone:l.commonNgZone}).then((e=>{})).catch((e=>o.error(e)))}))}))}}),[l.SSOAuthenticationHelper,d.LoadConfigManagerService,d.BootstrapService,l.LogService])],declarations:[m],entryComponents:[m],bootstrap:[m]})],t);return t};const setGlobalBasePathURL=()=>__awaiter(void 0,void 0,void 0,(function*(){try{const e=yield window.fetch(l.SETTINGS_URI);const t=yield e.json();if(t["smartedit.globalBasePath"]){l.RestServiceFactory.setGlobalBasePath(String(t["smartedit.globalBasePath"]))}}catch(e){console.log("Failure on loading Settings URL")}return Promise.resolve()}));window.smarteditJQuery(document).ready((()=>{if(!document.querySelector(l.SMARTEDITLOADER_COMPONENT_NAME)){document.body.appendChild(document.createElement(l.SMARTEDITLOADER_COMPONENT_NAME))}const e=[...window.__smartedit__.pushedModules];setGlobalBasePathURL().then((()=>{r.platformBrowserDynamic().bootstrapModule(SmarteditLoaderFactory(e),{ngZone:l.commonNgZone}).catch((()=>console.log("Failed on setting global basePath URL")))}))}));t.ng=SmarteditLoaderFactory},71747:(e,t,i)=>{var o=i(36092);var n=i(22630);if(!window.smarteditJQuery&&o&&o.noConflict){window.smarteditJQuery=o.noConflict()}window.smarteditLodash=n.noConflict()},83519:(e,t,i)=>{"use strict";i.r(t)},2596:(e,t,i)=>{"use strict";i.r(t)},56751:(e,t,i)=>{"use strict";i.r(t)},61668:(e,t,i)=>{"use strict";i.r(t)},99439:(e,t,i)=>{"use strict";i.r(t)},87217:(e,t,i)=>{"use strict";i.r(t)},2437:(e,t,i)=>{"use strict";i.r(t)},65546:(e,t,i)=>{"use strict";i.r(t)},80091:(e,t,i)=>{var o={"./af":90322,"./af.js":90322,"./ar":36936,"./ar-dz":47846,"./ar-dz.js":47846,"./ar-kw":14844,"./ar-kw.js":14844,"./ar-ly":30609,"./ar-ly.js":30609,"./ar-ma":41760,"./ar-ma.js":41760,"./ar-sa":21609,"./ar-sa.js":21609,"./ar-tn":94816,"./ar-tn.js":94816,"./ar.js":36936,"./az":56927,"./az.js":56927,"./be":20467,"./be.js":20467,"./bg":52854,"./bg.js":52854,"./bm":57612,"./bm.js":57612,"./bn":63636,"./bn-bd":16512,"./bn-bd.js":16512,"./bn.js":63636,"./bo":4910,"./bo.js":4910,"./br":75907,"./br.js":75907,"./bs":20714,"./bs.js":20714,"./ca":2709,"./ca.js":2709,"./cs":81993,"./cs.js":81993,"./cv":45597,"./cv.js":45597,"./cy":31826,"./cy.js":31826,"./da":55896,"./da.js":55896,"./de":77960,"./de-at":40538,"./de-at.js":40538,"./de-ch":11141,"./de-ch.js":11141,"./de.js":77960,"./dv":10501,"./dv.js":10501,"./el":33641,"./el.js":33641,"./en-au":22069,"./en-au.js":22069,"./en-ca":28443,"./en-ca.js":28443,"./en-gb":47868,"./en-gb.js":47868,"./en-ie":39444,"./en-ie.js":39444,"./en-il":97025,"./en-il.js":97025,"./en-in":45983,"./en-in.js":45983,"./en-nz":59346,"./en-nz.js":59346,"./en-sg":44610,"./en-sg.js":44610,"./eo":43536,"./eo.js":43536,"./es":9489,"./es-do":50214,"./es-do.js":50214,"./es-mx":26570,"./es-mx.js":26570,"./es-us":54657,"./es-us.js":54657,"./es.js":9489,"./et":42230,"./et.js":42230,"./eu":23757,"./eu.js":23757,"./fa":81505,"./fa.js":81505,"./fi":83450,"./fi.js":83450,"./fil":13887,"./fil.js":13887,"./fo":64757,"./fo.js":64757,"./fr":50782,"./fr-ca":57358,"./fr-ca.js":57358,"./fr-ch":53170,"./fr-ch.js":53170,"./fr.js":50782,"./fy":90116,"./fy.js":90116,"./ga":99305,"./ga.js":99305,"./gd":37434,"./gd.js":37434,"./gl":35192,"./gl.js":35192,"./gom-deva":71383,"./gom-deva.js":71383,"./gom-latn":67159,"./gom-latn.js":67159,"./gu":23057,"./gu.js":23057,"./he":50506,"./he.js":50506,"./hi":62151,"./hi.js":62151,"./hr":73685,"./hr.js":73685,"./hu":90299,"./hu.js":90299,"./hy-am":73828,"./hy-am.js":73828,"./id":20339,"./id.js":20339,"./is":66646,"./is.js":66646,"./it":16612,"./it-ch":71105,"./it-ch.js":71105,"./it.js":16612,"./ja":21302,"./ja.js":21302,"./jv":3325,"./jv.js":3325,"./ka":15675,"./ka.js":15675,"./kk":50272,"./kk.js":50272,"./km":31015,"./km.js":31015,"./kn":56697,"./kn.js":56697,"./ko":81103,"./ko.js":81103,"./ku":56548,"./ku.js":56548,"./ky":39143,"./ky.js":39143,"./lb":30124,"./lb.js":30124,"./lo":37483,"./lo.js":37483,"./lt":97523,"./lt.js":97523,"./lv":80542,"./lv.js":80542,"./me":57938,"./me.js":57938,"./mi":23031,"./mi.js":23031,"./mk":58894,"./mk.js":58894,"./ml":80838,"./ml.js":80838,"./mn":86644,"./mn.js":86644,"./mr":76982,"./mr.js":76982,"./ms":38959,"./ms-my":91174,"./ms-my.js":91174,"./ms.js":38959,"./mt":73268,"./mt.js":73268,"./my":81006,"./my.js":81006,"./nb":39029,"./nb.js":39029,"./ne":92075,"./ne.js":92075,"./nl":80895,"./nl-be":12121,"./nl-be.js":12121,"./nl.js":80895,"./nn":50975,"./nn.js":50975,"./oc-lnc":22233,"./oc-lnc.js":22233,"./pa-in":81937,"./pa-in.js":81937,"./pl":23574,"./pl.js":23574,"./pt":95192,"./pt-br":93125,"./pt-br.js":93125,"./pt.js":95192,"./ro":97397,"./ro.js":97397,"./ru":28042,"./ru.js":28042,"./sd":86920,"./sd.js":86920,"./se":64945,"./se.js":64945,"./si":76725,"./si.js":76725,"./sk":47730,"./sk.js":47730,"./sl":18397,"./sl.js":18397,"./sq":17394,"./sq.js":17394,"./sr":49447,"./sr-cyrl":49655,"./sr-cyrl.js":49655,"./sr.js":49447,"./ss":7242,"./ss.js":7242,"./sv":23265,"./sv.js":23265,"./sw":43291,"./sw.js":43291,"./ta":78645,"./ta.js":78645,"./te":10011,"./te.js":10011,"./tet":13696,"./tet.js":13696,"./tg":69535,"./tg.js":69535,"./th":46680,"./th.js":46680,"./tk":916,"./tk.js":916,"./tl-ph":33231,"./tl-ph.js":33231,"./tlh":559,"./tlh.js":559,"./tr":18124,"./tr.js":18124,"./tzl":54087,"./tzl.js":54087,"./tzm":76903,"./tzm-latn":85311,"./tzm-latn.js":85311,"./tzm.js":76903,"./ug-cn":64182,"./ug-cn.js":64182,"./uk":63022,"./uk.js":63022,"./ur":74849,"./ur.js":74849,"./uz":17978,"./uz-latn":97799,"./uz-latn.js":97799,"./uz.js":17978,"./vi":97243,"./vi.js":97243,"./x-pseudo":48528,"./x-pseudo.js":48528,"./yo":42938,"./yo.js":42938,"./zh-cn":92026,"./zh-cn.js":92026,"./zh-hk":75664,"./zh-hk.js":75664,"./zh-mo":28697,"./zh-mo.js":28697,"./zh-tw":27538,"./zh-tw.js":27538};function webpackContext(e){var t=webpackContextResolve(e);return i(t)}function webpackContextResolve(e){if(!i.o(o,e)){var t=new Error("Cannot find module '"+e+"'");t.code="MODULE_NOT_FOUND";throw t}return o[e]}webpackContext.keys=function webpackContextKeys(){return Object.keys(o)};webpackContext.resolve=webpackContextResolve;e.exports=webpackContext;webpackContext.id=80091},3229:(e,t,i)=>{"use strict";var o;o={value:true};i(36254);i(98138);i(90248);i(51285);i(43691);i(93003);i(13286);i(64355);i(83668);i(41322);i(4406);i(61700);i(9357);i(40915);i(72320);i(11416);i(41545);i(13741);i(70095);i(26404);i(64555);i(84509);i(66121);i(78795);window.jQuery=i(36092);i(71747);i(87217);i(2437);i(18681);i(56751);i(41187);i(83519);i(80824);i(65546);i(54206);i(61668);i(85951);i(2596);i(72372);i(99439);i(70448)},43471:()=>{}};var t={};function __webpack_require__(i){var o=t[i];if(o!==undefined){return o.exports}var n=t[i]={id:i,loaded:false,exports:{}};e[i].call(n.exports,n,n.exports,__webpack_require__);n.loaded=true;return n.exports}__webpack_require__.m=e;(()=>{var e=[];__webpack_require__.O=(t,i,o,n)=>{if(i){n=n||0;for(var s=e.length;s>0&&e[s-1][2]>n;s--)e[s]=e[s-1];e[s]=[i,o,n];return}var a=Infinity;for(var s=0;s<e.length;s++){var[i,o,n]=e[s];var r=true;for(var l=0;l<i.length;l++){if((n&1===0||a>=n)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](i[l])))){i.splice(l--,1)}else{r=false;if(n<a)a=n}}if(r){e.splice(s--,1);var d=o();if(d!==undefined)t=d}}return t}})();(()=>{__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;__webpack_require__.d(t,{a:t});return t}})();(()=>{__webpack_require__.d=(e,t)=>{for(var i in t){if(__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{__webpack_require__.g=function(){if(typeof globalThis==="object")return globalThis;try{return this||new Function("return this")()}catch(e){if(typeof window==="object")return window}}()})();(()=>{__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{__webpack_require__.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();(()=>{__webpack_require__.nmd=e=>{e.paths=[];if(!e.children)e.children=[];return e}})();(()=>{var e={986:0};__webpack_require__.O.j=t=>e[t]===0;var webpackJsonpCallback=(t,i)=>{var[o,n,s]=i;var a,r,l=0;if(o.some((t=>e[t]!==0))){for(a in n){if(__webpack_require__.o(n,a)){__webpack_require__.m[a]=n[a]}}if(s)var d=s(__webpack_require__)}if(t)t(i);for(;l<o.length;l++){r=o[l];if(__webpack_require__.o(e,r)&&e[r]){e[r][0]()}e[r]=0}return __webpack_require__.O(d)};var t=self["webpackChunksmarteditmaster"]=self["webpackChunksmarteditmaster"]||[];t.forEach(webpackJsonpCallback.bind(null,0));t.push=webpackJsonpCallback.bind(null,t.push.bind(t))})();var i=__webpack_require__.O(undefined,[216],(()=>__webpack_require__(3229)));i=__webpack_require__.O(i)})();